{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the Bug Fables Internal Docs","text":"<p>Use the links on your left to naviguate this documentation. The table of contents of the document you are on will be on your right.</p> <p>This site defaults to dark mode, but you can toggle it to light mode by clicking the icon on the left of the search bar.</p> <p>Every document will have an eye icon to consult its source md file on GitHub and a pencil icon to edit it on your fork if you want to submit a pull request.</p>"},{"location":"#note-regarding-the-113-update","title":"Note regarding the 1.1.3 update","text":"<p>These documentation aren't yet updated with the changes included in 1.1.3. Most of them impacts SetText. They will be updated at a later time.</p>"},{"location":"Game%20files%20structure/","title":"Bug Fables files structure","text":"<p>Since Bug Fables is a Unity game, it shares a lot of similarities with other games made with this engine. This document will primarily focus on the Steam version, but other versions should have a similar structure.</p>"},{"location":"Game%20files%20structure/#locating-the-install-location","title":"Locating the install location","text":"<p>Let's first see what a Bug Fables install looks like. If you installed the game on Steam, you can access this folder directly by going into the game's properties (access it via a right click in your games's library). From there, check the Local Files section and you should see the location shown with a button to browse it. If you installed the game on GOG or the Epic Games Stores, check where those platforms installs their games to locate it. If you have it from itch.io, it's simply where you extracted the game.</p>"},{"location":"Game%20files%20structure/#an-overview-of-the-files-structure","title":"An overview of the files structure","text":"<p>This is how a typical install of the game looks:</p> <p></p> <p>The Managed folder under the Data folder contains many DLL files like this:</p> <p></p> <p>While it might seem like there's a lot of files, most of them are actually copied from Unity and the actual game is only contained in a few files.</p>"},{"location":"Game%20files%20structure/#a-breakdown-of-the-files","title":"A breakdown of the files","text":"<p>Let's start at the root folder:</p> <ul> <li><code>Bug Fables_Data</code>: This is where most of the game's assets and codes are located alongside data provided by the Unity engine.</li> <li><code>Mono</code>: This is where Unity's custom version of the Mono runtime is located (in the Embeded runtime subfolder) alongside some configurations to it (located in the etc subfolder). This is directly provided by Unity. On XBOX PC, this folder is called <code>MonoBleedingEdge</code> as it uses a newer version of Mono. Consoles versions do not use Mono and instead uses IL2CPP which is a propreatary compilation pipeline Unity provides and is required for consoles support.</li> <li><code>Bug Fables.exe</code>: This is actually Unity's player executable renamed to match the game's name. It is also directly provided by Unity despite its name.</li> <li><code>config.dat</code>: This is generated by the game at runtime on the first boot. It contains all the global settings configuration as well as other informations such as the language choice and which modifier code has already been entered (used to list the code allowed via the secret menu).</li> <li><code>save0/1/2.dat</code>: The save files generated by the game. <code>save0</code> is the first slot, <code>save1</code> is the second slot and <code>save2</code> is the third slot. There can also be saves with the name <code>backup</code> which is actually the game's previous save before its corresponding regular save file. This is the game's redundancy mechanism: if the current file somehow becomes corrupted, the game will falback to the backup version. For more info, check Save File.</li> <li><code>UnityCrashHandler64,exe</code>: This file is provided by Unity. It's a small program that is meant to be called whenever Unity player crashes. It will contain the game's icon with a red exclamation mark if it is executing.</li> <li><code>UnityPlayer.dll</code>: This is most of Unity's player code. The executable mentioned above uses it and it constitutes the core Unity code compiled in C++. The C# scripting merely is an interface to this code.</li> <li><code>version.txt</code>: This is just a text file with the game's version number. This file isn't actually used anywhere in the game. It is very likely just present to indicate the version without needing to boot the game.</li> <li><code>WinPixEventRuntime.dll</code>: This file is provided by Unity. It seems to be a library for debugging and profiling DirectX games.</li> </ul> <p>As you can see, only the Data folder actually contains the game. The only thing coming from the game are the exe's icon as well as the presence of the steam api dll.</p>"},{"location":"Game%20files%20structure/#bug-fables_data","title":"Bug Fables_Data","text":"<p>Since this is where the actual game resides, we need to specifically talk about its structure.</p> <ul> <li><code>Managed</code>: This folder contains all the compiled C# code (otherwise known as \"Managed\" code). Only 2 files are compiled from Unity: <code>Assembly-CSharp.dll</code> and <code>Assembly-CSharp-firstpass.dll</code>. The rest are all Unity's own library (which ends up interfacing with <code>UnityPlayer.dll</code>) and some core library needed for running .NET in unity (<code>System.dll</code>, <code>System.Core.dll</code>, <code>mscorlib.dll</code> and <code>Mono.Security.dll</code>). These files aren't present on consoles versions because it uses IL2CPP instead.<ul> <li><code>Assembly-CSharp.dll</code>: This contains ALL the game's specific code. All the contents of this files are made by Moonsprout and it contains all the game's logic and every components's code.</li> <li><code>Assembly-CSharp-firstpass.dll</code>: This only contains the Steamworks.NET code which is open source and it allows to integrate Steamworks into Unity games. The reason for the name has to do with this being used as a plugin which requires a different step in the build process. <code>Assembly-CSharp.dll</code> refferences this file.</li> </ul> </li> <li><code>Plugins</code>: This is where libraries loaded by the game are located. Only the Steam dll should be present which is provided by Valve through Steamworks. Steamworks.NET directly uses this file to invoke Steam's api.</li> <li><code>Ressources</code>: Only contains Unity's default ressources which is directly provided by Unity.</li> <li><code>app.info</code>: This is a simple file generated at build time containing the information provided to Unity at compilation which is the application name and the company name.</li> <li><code>boot.config</code>: This is a file generated at build time containing some build configuration. It is possible to edit this file to change how the game will behave such as enabling the Unity debug server and setting the mono's runtime version between <code>legacy</code> and <code>latest</code>.</li> <li><code>data.unity3d</code> and <code>ressources.ressource</code>: These are compressed files containing all the assets of the game. Their content are entirely made by Moonsprout which Unity compiled and compressed.</li> </ul> <p>That should basically cover all of it.</p>"},{"location":"Game%20files%20structure/#conclusion","title":"Conclusion","text":"<p>The important part to understand is that the \"game\" is actually mostly 4 files with one being a third party module, Steamworks.NET and some minor customisations. The rest is just Unity and it's even possible to get these files from an actual Unity 2018.4.12f1 installation. Because of this, it is possible to change some files around to change a release build into a development build with debugging support. It's even possible with some decompilation work to upgrade the mono runtime to the newer version that newer versions of Unity uses. For more information on these procedures, check the wiki of this repository.</p>"},{"location":"Battle%20system/ActionCommands/","title":"ActionCommands","text":"<p>This enum represents all the different action commands implemented in the game through battle actions. The value control the logic of DoCommand.</p> Value Name Description 0 None UNREFERENCED 1 PressKey An UNUSED and broken simple key press prompt. This command cannot be succeeded. 2 HoldKeyBar UNREFERENCED 3 RandomPressKeys UNREFERENCED 4 TappingKey An input mashing prompt where the input can be one of the 4 main ones (Confirm, Cancel, Switch Party or Show HUD) or be a prompt where the player needs to alternate between the left and right input (with caveats, see the sections below for details). Each correct input press increases <code>barfill</code> from 0.0 to 1.0. The goal of the command is to make <code>barfill</code> reach 1.0 before the <code>timer</code> expires. 5 HoldKeyCountdown A hold input prompt with a number of evenly separated timepoints. The goal of the command is to hold a certain input by the second timepoint and release it before the last timepoint ends. If the input isn't held by the second timepoint or it's released before the last timepoint begins or it's never released before the last timepoint ends, the command results in a failure. This command has forgiveness logic in <code>demomode</code> which makes it impossible to fail by guiding the player's input. 6 RandomPressKeysTimer UNREFERENCED 7 RandomTappingKeys UNREFERENCED 8 RandomTappingKeysTimer UNREFERENCED 9 RandomPressBar A prompt to press the Confirm input timed in such a way that a cursor who goes back and forth on a bar lands in a specific target area. The goal of the command is to hit the input when the cursor falls in that area. The command is failed when the cursor falls outside of the target or if the input isn't pressed before <code>timer</code> expires. This command features forgiveness logic in <code>demomode</code> where it is impossible to fail the command. 10 RandomTappingBar A variation of <code>TappingKey</code> where the mashing input prompt has a random starting one between Confirm, Cancel or Switch Party (it is not possible to use left/right mode). The input will change to a random one periodically at random intervals. This action command is UNUSED under normal gameplay. 11 RandomPressKeyTimer An input prompt of a concealed input that is only revealed after a certain amount of timepoints passes. The goal of the command is to press the input when it is revealed on the last timepoint within 45.0 frames. If any other game inputs (even those outside of the random pool) are pressed during those 45.0 frames or if multiple inputs are pressed at the same time than the correct one or if no inputs is pressed, the command is a failure. 12 MultiPressBar An UNUSED and stripped down version of RandomPressBar where the cursor only does one sweep of the bar and it has reduced functionality. 13 LongRandomBar A multi press input prompt spread over multiple timepoints as a cursor sweeps once through a bar containing the timepoints which are randomly generated. The goal of the command is to press Confirm while the cursor is close enough to the timepoint and hit as many as possible. A timepoint is not hit if no inputs was pressed or if the input was pressed while the cursor was too far off the timepoint. This command cannot be failed: it doesn't use <code>commandsuccess</code> for the outcome, but rather <code>successfullchain</code> which will report the amount of timepoints that was hit sucessfully. 14 SequentialKeys A series of simple random input prompts that have to be pressed in sequence in a row. The goal of the command is to press all inputs in the sequence correctly in a row under a certain amount of time. If too much time passes without completing all inputs or if the wrong input is pressed, the command is a failure. This command supports 2 optional features: the ability to make it go on infinetely until success and a feature that hides future inputs until all previous ones are entered correctly. 15 Crosshairs A simple Confirm input prompt consisting of a ring that renders on an actor with its matching crosshair moving from a random position towards it which is then repeated multiple times. The goal of the command is to press Confirm when the crosshair falls inside its ring visually and to hit all of the Confirm inputs correctly in a row. If no Confirm inputs is done for any crosshairs or if Confirm is pressed too early, the command is a failure. 16 PressKeyTimer An single input press prompt that lasts a certain amount of frames. The goal of the command is to press the correct input (and only the correct one) on the last 30.0 frames of the command. If no input is taken for the entire duration or if the input is pressed before the last 30.0 frames or if any other inputs recognised by the game is pressed at any point (even if done at the same time than the correct one), the command will be failed. This command has caveats about its UI."},{"location":"Battle%20system/ApplyBadges/","title":"ApplyBadges","text":"<p>This method applies all the static medals effects defined in their data for the whole player party. It belongs to MainManager.</p> <p>It first starts by resetting instance.<code>speedup</code> (an UNUSED field) to true and instance.<code>maxtp</code> to instance.<code>basetp</code>.</p> <p>ResetPlayerStats is called on player party member which resets fields to defaults:</p> Field Value set <code>lockitems</code> false <code>lockskills</code> false <code>locktri</code> false <code>lockrelayreceive</code> false <code>maxhp</code> <code>basehp</code> <code>atk</code> <code>baseatk</code> <code>def</code> <code>basedef</code> <code>poisonres</code> 0 <code>sleepres</code> 0 <code>freezeres</code> 0 <code>numbres</code> 0 <p>After, all the <code>BadgeEffects</code> of every applicable medals are applied just as described in the medal effects data documentation.</p> <p>Finally, instance.<code>tp</code> is clamped from 0 to instance.<code>maxtp</code> and every player party member's <code>hp</code> is clamped from 0 to their <code>maxhp</code>.</p>"},{"location":"Battle%20system/ApplyStatBonus/","title":"ApplyStatBonus","text":"<p>This method's purpose is to recalculate all player party member's stats based on all the bonuses that was accumulated so far. It belongs to MainManager.</p> <p>It starts by calling ResetStats which resets all the stats to their starting value which are the following:</p> <ul> <li><code>basehp</code>: 7 except for the <code>Beetle</code> animid where it's 9</li> <li><code>baseatk</code>: 2</li> <li><code>basedef</code>: 0</li> <li>Additionally, it also resets instance.<code>basetp</code> to 10</li> </ul> <p>From there, the method only does anything if there's any <code>statbonus</code> (NOTE: This means the ApplyBadges call at the end is also skipped if there's none).</p> <p>The method will then go through each <code>statbonus</code> and apply them as described in stat bonus save file line by using the following fields (all player party members are impacted by the bonus if it targets the party):</p> <ul> <li><code>basehp</code> for HP bonuses</li> <li><code>baseatk</code> for attack bonuses</li> <li><code>basedef</code> for defense bonuses</li> <li>instance.<code>basetp</code> for TP bonuses</li> </ul> <p>After this, ApplyBadges is called.</p>"},{"location":"Battle%20system/Battle%20state/","title":"Battle state","text":"<p>These fields describes the state of the battle. Some fields belongs to MainManager, but are mostly BattleControl related.</p>"},{"location":"Battle%20system/Battle%20state/#battlecontrol-fields","title":"BattleControl fields","text":"<p>This is all the BattleControl fields.</p>"},{"location":"Battle%20system/Battle%20state/#battle-setup-information","title":"Battle setup information","text":"Name Type Public? Description battlemap GameObject Yes The parent of all the battles objects notably the battle map prefab. This is a game object named <code>Battle</code> created on StartBattle caller NPCControl No The Enemy NPCControl whose encounters caused this battle. This is set to the calledfrom value sent to StartBattle. If it's null, no encounter caused this battle and it was started manually sadv int No The starting advantage value. Set to the sent adv value of StartBattle, but adv is set to this field if it's a retry. The only recognised value is 3 which means the enemy party has the advantage, other values do nothing sdata StartUpData No The StartUpData stored during StartBattle when <code>saveddata</code> is false. Restored on StartBattle for a retry saveddata bool No Whether the <code>sdata</code> have been saved and are ready for restoration. Set to true at the very end of StartBattle canflee bool Yes Whether fleeing is allowed as well as retry when a GameOver occurs. Set to the canescape value sent to StartBattle"},{"location":"Battle%20system/Battle%20state/#battle-flow","title":"Battle flow","text":"Name Type Public? Description action bool Yes If true, it means an action coroutine or a method controls the battle flow making it an uncontrolled flow. Set to false on StartBattle inevent bool Yes Tells if an EventDialogue is in progress or not. If one is, we enter an uncontrolled flow calleventnext int No If not negative, the EventDialogue whose id is this value will be done on the next uncontrolled flow. This is only used in conjuction with an enemy party member's eventonfall when it triggers cancelupdate bool Yes Whether updates are disabled which only happen when some kind of terminal event occurs that changes the flow to a terminal flow. Set to false on StartBattle alreadyending bool Yes Tells when the battle is about to end via GameOver or AddExperience. Set to false on StartBattle. This protects against potential double terminal flow changes enemy bool Yes Whether we're in the enemy phase or not (false means we're in the player phase) of the turn of a controlled flow or processing a hitaction or processing a delproj. Set to false on StartBattle mainturn Coroutine No The AdvanceMainTurn coroutine if one is in progress (null if it's not) delprojs DelayedProjectileData[] Yes The delayed projectiles currently active turns int No The amount of completed main turns advanced by AdvanceMainTurn. Set to 0 on StartBattle demomode bool No If true, indicates the battle operates in tutorial mode. Used for the combat tutorials process and Spuder EventDialogues gameover Coroutine No The current GameOver coroutine is one is in progress (null if it's not). Set to null on StartBattle halfload bool Yes Whether or not StartBattle roughly got done half of the starting process. This is set to true right after calling SetLastTurns and it's used by the game to yield until this goes to true avaliableplayers int No The amount of players that are considered free by GetFreePlayerAmmount. Set to the current amount on StartBattle and updated in specific situations currentturn int Yes Determine the <code>playerdata</code> index currently selected for an action. -1 means no one is selected yet, being below <code>playerdata</code> length means that player index is selected and being at length or above means all players have taken their actions and the player phase is over. Set to -1 on StartBattle lastturns int[] No The state of the player index selection cycle which starts with an array with a length of the amount of free players - 1. Advancing it means either assigning the first free slot (-1) to the player being selected or shift the elements such that it falls on the latest while the oldest is removed receivedrelay bool[] No An array indicating which player index got relayed to via Relay which allows the <code>tiredpart</code> to be rendered whenever <code>tired</code> gets above 0 during UpdateAnim actedthisturn bool No Tells if PlayerTurn was called at least once during the turn implying at least one player could act. Set back to false on AdvanceMainTurn noaction int No The amount of main turns in a row where <code>actedthisturn</code> was false. If it reaches 5 without game over, the inactive failsafe triggers in AdvanceMainTurn attackedally int No The <code>playerdata</code> index that was attacked while the <code>FavoriteOne</code> medal was equipped on them which will cause it to take effect during AdvanceMainTurn. If this medal isn't applicable, the value is -1 firststrike bool No Whether or not the enemy is currently acting as part of the enemy party getting the starting advantage during StartBattle summonnewenemy bool No If true, it means that the game is in the process of summoning an enemy from the <code>extraenemies</code> to <code>enemydata</code> via SummonEnemy, called duing CheckDead. This prevents SummonEnemy to set <code>checkingdead</code> to null once completed to not interfere with the ongoing CheckDead and it also allows CheckDead to wait the summon is over selfsacrifice bool No If true, it indicates that the enemy party member killed themselves during their DoAction which changes CleanKill and the post action logic of DoAction eatenkill bool Yes If true, it indicates that a player party member was killed by a <code>Pitcher</code> enemy by draining their HP which allows AdvanceMainTurn to handle this special case lastdamage int No The last final amount of damage done at the end of DoDamage damagethisturn int No The amount of damage the player party inflicted in the current main turn. If it gets higher than flagvar 41 (highest damage in one turn), the flagvar value is set to it before resetting the value of damagethisturn in AdvanceMainTurn charmcooldown int No The amount of main turns that needs to pass for UseCharm to process the next charm even if one is available and could have been processed otherwise. Set to a random integer between 3 and 7 inclusive after a charm has been processed and decremented on AdvanceMainTurn"},{"location":"Battle%20system/Battle%20state/#actors-information","title":"Actors information","text":"Name Type Public? Description partypointer int[] Yes The mapping from battle order formation to <code>playerdata</code> index. Aligned with the correct order on StartBattle and changed on SwitchParty or SwitchPos. Check the battle party addressing documentation for more details partyentities EntityControl[] No Set to all the <code>playerdata</code> battleentity on StartBattle alldata BattleData[] Yes All the <code>playerdata</code> followed by all the <code>enemydata</code> appended together. Set by RefreshAllData which is only called during StartBattle enemydata BattleData[] Yes The first enemy party members data with a length up to 4 (the extra ones are stored in <code>extraenemies</code>). Set to a new list with the same length as the sent enemyids on StartBattle (after it was truncated to the first 4) and then filled with the actual enemy data extraenemies List No This contains the list of enemy ids that overflows the maximum amount of enemies allowed in <code>enemydata</code> which is 4. It is initialised as such on StartBattle reservedata List No The list of enemies who are no longer part of <code>enemydata</code> because they had died and were moved there by CheckDead since their deathtype indicated they should be moved there. Doing so prevents a full destruction which allows the enemy to be revived later or to visually have a death animation without disappearing. Reset to a new list on StartBattle enemyfled bool No Whether at least one enemy party member fled the battle or not during DoAction lastaddedid int No The last enemy party member index added via AddNewEnemy tempslot BattleData No The last enemy to be added in <code>enemydata</code> according to NewEnemy if the sent animation value isn't <code>None</code> deadenemypos List No The list of the positions of previously dead enemies as found by CheckDead. It is only used by CheckDead in case <code>extraenemies</code> needs to be summoned in the place of the dead ones at the same positions they were before deadmembers int[] No The array of player party members indexes whose <code>hp</code> is 0 or below as returned by GetDeadParty. Used during RevivePlayer to decide whether to resucitate the player party member"},{"location":"Battle%20system/Battle%20state/#attack-and-flow-modifiers","title":"Attack and flow modifiers","text":"Name Type Public? Description dontusecharge bool No If true, the <code>charge</code> of the enemy party member will not be reset to 0 on EndEnemyTurn nonphyscal bool No If true, indicate to the damage pipeline that the damages aren't physical which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal nolifesteal bool Yes If true, disables the effects of the <code>LifeSteal</code> medal during the damage pipeline lockmmatter bool Yes If true, prevents the <code>MiracleMatter</code> medal to take effect. Set to false on StartBattle"},{"location":"Battle%20system/Battle%20state/#actions-commands-and-blocking","title":"Actions commands and blocking","text":"Name Type Public? Description actionroutine Coroutine No Tracks the progress of a DoCommand coroutine doingaction bool Yes If true, an action command is in progress successfulchain int No The amount of sucessful inputs perfomred in a <code>LongRandomBar</code> action commands during DoCommand presskey int No A general purpose input id for use in DoCommand barfill float No A number between 0.0 and 1.0 that tells the ratio of an action command's bar's filled portion which is managed by DoCommand infinitecommand bool No If true, action commands processed by DoCommand will use their infinite variant. NOTE: Only the SequentialKeys support this feature killinput bool No Used for the <code>PressKey</code> action command that when set to true, DoCommand will stop listening for inputs commandsuccess bool Yes Tells if the last action command succeeded or tell if the player is currently blocking ignoring FRAMEONE (tracked by GetBlock) buttons ButtonSprite[] No A general purpose array of ButtonSprites for use in DoCommand commandsprites SpriteRenderer[] No A general purpose SpriteRenderer array for use in DoCommand or other action commands related needs helpboxid int No The id of the current action command whose description should be rendered in <code>helpbox</code> by CreateHelpBox helpbox DialogueAnim No The 9box containing the action command description whose id is <code>helpboxid</code> rendered by CreateHelpBox superblockedthisframe float No A short lived cooldown in frames that allows a super block to still count until it expires, check GetBlock to learn more. Used in the damage pipeline and maintained by LateUpdate blockcooldown float No The amount of frames left that a block can be processed ignoring FRAMEONE, check GetBlock for more details hasblocked bool No If true, the damage pipeline detected the player blocked the attack with a valid block (even if FRAMEONE rules would have prevented it). This is only used in HardSeedVenus, a coroutine specific to the <code>VenusBoss</code> enemy overridechallengeblock bool Yes Normally, standard blocks are disallowed when flags 615 and 15 are true (FRAMEONE is active while past the first tutorial fight), but if this field is true, it allows to override that behavior to allow them regardless of these conditions being fufilled or not"},{"location":"Battle%20system/Battle%20state/#targetting","title":"Targetting","text":"Name Type Public? Description avaliabletargets BattleData[] No An ephemeral array of actors to track possible targets for an action which is frequently set by calling GetAvailableTargets forceattack int No The player party member's animid index that will be forced to be returned during GetRandomAvaliablePlayer. This is only set in the course of the <code>Taunt</code> skill during its DoAction logic playertargetID int No The player party member index whom is currently targetted by the enemy party member. If it's -1, the enemy isn't targetting anyone playertargetentity EntityControl No An actor to use for targetting purposes, but typically used as a shorthand to <code>playerdata[playertargetID]</code> during enemy actions. NOTE: despite the name, it can be an enemy party member as enemies can sometimes target other enemy party members outside of the damage pipeline targetedenemy int No Indicates the enemy party member index that <code>Beetle</code> will target when using his basic attack or the <code>HeavyStrike</code> skill during DoAction target int No The index of the selected target when selecting a player or enemy"},{"location":"Battle%20system/Battle%20state/#chompy-informations","title":"Chompy informations","text":"Name Type Public? Description chompy EntityControl No If flags 402 is true (Chompy is with Team Snakemouth), this is initialised to a new entity created via CreateNewEntity with name <code>chompy</code> with the <code>ChompyChan</code> animid on StartBattle chompyattack Coroutine Yes The coroutine of Chompy if it's in progress (null if it's not) chompyaction bool No Tells if Chompy is in progress or not chompyattacked bool No Tells if Chompy has completed during the player phase when applicable coptions List No The list of action options available during Chompy: 0 is basic attack, 1 is do nothing, 2 is the ribbon specific attack and 3 is change ribbon chompyoption int No The last chosen <code>coption</code> the last time Chompy was called chompylock bool No If true, it prevents Chompy to be a part of the player phase even if it would normally be allowed. This is only used during DoAction specifically for the <code>Centipede</code> enemy"},{"location":"Battle%20system/Battle%20state/#ai-party-informations","title":"AI party informations","text":"Name Type Public? Description aiparty EntityControl No The entity that was created as part of AddAI if one was created aiattacked bool No Tells if AIAttack has completed during the player phase when applicable"},{"location":"Battle%20system/Battle%20state/#exp-and-berries","title":"EXP and berries","text":"Name Type Public? Description estimatedexp int No The sum of all the calculated <code>enemydata</code>'s <code>exp</code> expreward int No The amount of EXP cumulated in the course of the battle that will be granted if the battle is won. Set to 0 on StartBattle oldexp int No The last value of <code>expreward</code> observed since the last RefreshEXP. If it differs with the current one, RefreshEXP will be called on the next applicable Update leveled bool No Indicates that AddExperience detected a rank up situation moneyreward int No The amount of berries that will be dropped after the battle. Set to 0 on StartBattle"},{"location":"Battle%20system/Battle%20state/#ui-naviguation","title":"UI naviguation","text":"Name Type Public? Description currentaction Pick Yes The current menu being naviguated by the player. Set to <code>BaseAction</code> on StartBattle currentchoice Actions Yes The current action being selected on the <code>BaseAction</code> menu. Set to <code>Attack</code> on StartBattle itemarea AttackArea No Tells what actors are selectable to perform the current action maxoptions int No The amount of available <code>option</code> on the main vine menu lastoption int No The last selected <code>option</code> on the main vine menu selecteditem int No The selected <code>listvar</code> option from an ItemList, set by SetItem vineoption int No Equivalent to <code>maxoption</code>, but for the main vine menu value option int Yes The current vine menu option. 0 is attack, 1 is skills, 2 is items, 3 is strategies and 4 is turn relay. Set to 0 on StartBattle. This can also be the index of an enemy or player target being selected. NOTE: the vine order is reversed in game as left goes up and right goes down in the option index with wrap around excludeself bool Yes If true, it will cause the <code>currentturn</code> player to not be selectable in a <code>currentaction</code> of <code>SelectPlayer</code> in GetChoiceInput tempskill int Yes The skill id that was confirmed from skills selection in SetItem lastskill int No The last skill id used, set to <code>selecteditem</code> before its usage when confirmed in GetChoiceInput lastaction int No The last action chosen by a player party member. Set to <code>option</code> on AdvanceMainTurn which keeps the last selected vine menu options since the last one chosen on the new turn idletimer int No The amount of frames since the player idled which is used in the EXP counter update turncooldown float No The amount of FixedUpdate cycles left before GetChoiceInput calls are allowed during PlayerTurn. Set to 5.0 in SetItem and CancelList caninputcooldown float No A general purpose input cooldown in amount of frames left before expiring. Notably, it has an important role in GetBlock"},{"location":"Battle%20system/Battle%20state/#ui-rendering","title":"UI rendering","text":"Name Type Public? Description vinebase Transform No A GameObject named <code>Base</code> childed to <code>choicevine</code> choicevine Transform No A GameObject named <code>Vine</code> that is the root of the vines UI objects, childed to the <code>battlemap</code> and initialised on CreateVine as part of PlayerTurn vineicons SpriteRenderer[] No The vine icons of the vine menu, childs of <code>vinebase</code> cursor Transform No The selection leaf cursor. Initialised on CreateCursor which is only called on StartBattle switchicon Transform No The parent of the UI objects that composes the switch icon which is a GameObject named <code>switchicon</code> childed to the <code>GUICamera</code>. Initialised on StartBattle fronticon SpriteRenderer No The SpriteRenderer of the UI object named <code>attackicon</code> childed to the <code>GUICamera</code> that corresponds to the icon the front party member has. Initialised on StartBattle hexpcounter Transform No The EXP counter shown when idling for 200+ frames when <code>currentaction</code> is <code>BaseAction</code>. Created on the first controlled update flow expholder Transform No A GameObject named <code>expholder</code> childed to the <code>GUICamera</code> with tag <code>DelAftBtl</code> (destroyed on ReturnToOverworld) that holds the EXP orbs cumulated in the battle for visual rendering lvicon Transform No The EXP icon sprite used in the UI during AddExperience hideenemyhp bool Yes If true, the <code>hpbar</code> of every enemy party members's battleentity gets disabled on RefreshEnemyHP actiontext SpriteRenderer No The UI element for the game to indicate the current action being selected which is the SpriteRenderer of a new GameObject named <code>ActionText</code> childed to the <code>GUICamera</code>. Initialised on StartBattle smallexporbs Transform[] No The array of smaller orbs (one per 1 EXP below 10 remaining) which are instances of <code>Prefabs/Objects/ExpOrbGUI</code> rendered as child of the <code>expholder</code> bigexporbs Transform[] No The array of larger orbs (one per 10 EXP) which are instances of <code>Prefabs/Objects/ExpOrbGUI</code> rendered as child of the <code>expholder</code> longcancel bool No Whether the Cancel input is considered wider for rendering or not. Set to the return of InputIO.LongButton(5) on StartBattle. This is involved during the rendering of the <code>switchicon</code> cancelb ButtonSprite No A ButtonSprite of the cancel input for use in UpdateText"},{"location":"Battle%20system/Battle%20state/#visual-effects","title":"Visual effects","text":"Name Type Public? Description wordroutine Coroutine No Tracks the progress of a ShowSuccessWord coroutine commandword SpriteRenderer No The word SpriteRenderer used in ShowSuccessWord combo int No The amount of consecutive successful action commands performed which influences visual and audio effects informing of the input successes damcounters List No All of the currently rendered damage counters maintained by CounterAnimation, a sub coroutine of ShowDamageCounter. Set to a new list on StartBattle defaultcounteroffset Vector3 No Always set to (0.0, 1.25, 0.0) for use in DoDamage when calculating the start of the ShowDamageCounter call counterspriteindex int[] No Indicates the <code>guisprites</code> indexes of the different counter used in ShowDamageCounter. This is always {8, 40, 101} partymiddle Vector3 No Always set to (-4.5, 0.0, 0.0) for use in DoAction tiredpart Transform[] No Set to a new array of the transform of instances of <code>Prefabs/Particles/Tired</code> on StartBattle belonging to each <code>playerdata</code> battleentity (each is childed to their battleentity) The length is thus the same than <code>playerdata</code> tskybox Material No The RenderSettings.skybox saved on StartBattle. This is used for restoring later in case of a retry fogdist float No The value of RenderSettings.fogEndDistance saved on StartBattle if the current one needs to change. Restored from this field during ReturnToOverworld if it had a value above 0.0 dimmer SpriteRenderer No A giant black colored sprite that covers everything behind the transition during load. Initialised on StartBattle after the fade in transition and disabled with a clear color just before the fade out one charmdance Sprite[] No The sprites Charmy uses during UseCharm. Always set to sprite 98 and 99 of <code>Sprites/Entities/moth0</code> on StartBattle"},{"location":"Battle%20system/Battle%20state/#music","title":"Music","text":"Name Type Public? Description overworldmusic AudioClip No On StartBattle, this is set to MainManager.<code>music[0]</code>.clip if the map.<code>music[0]</code> exists and map.<code>musicid</code> is not negative. This is used for restoring the music on ReturnToOverworld overmusic float No If <code>overworldmusic</code> was saved, the time of that music is saved on this field if MainManager.<code>keepmusicafterbattle</code> is true. This is also used for restore on ReturnToOverworld keepmusic bool Yes Towards the end of ReturnToOverworld when instance.<code>inevent</code> is true, it is possible to skip the default behavior of fading the current music to silence by having this field set to true before ReturnToOverworld ends which will leave the current music playing instead"},{"location":"Battle%20system/Battle%20state/#camera","title":"Camera","text":"Name Type Public? Description campos Vector3 No The <code>camtargetpos</code> that will be set when SetDefaultCamera is called, normally Vector3.zero camoffset Vector3 No The <code>camoffset</code> that will be set when SetDefaultCamera is called, normally MainManager.<code>battlecampos</code> oldcamoffset Vector3 No Set to instance.<code>camoffset</code> on StartBattle when it's not a retry. This is used for restore later on ReturnToOverWorld oldcamrotation Vector3 No Set to instance.<code>camangleoffset</code> on StartBattle when it's not a retry. This is used for restore later on ReturnToOverWorld oldcamspeed float No Saved to instance.<code>camspeed</code> on StartBattle when it's not a retry. This is used for restore later on ReturnToOverWorld"},{"location":"Battle%20system/Battle%20state/#misc-coroutines-tracking","title":"Misc coroutines tracking","text":"Name Type Public? Description checkingdead Coroutine Yes Store diverse coroutines to track their progression (NOTE: despite the name, it's not just for CheckDead) enemybounce Coroutine[] No A general purpose coroutines array for use in DoAction that is made to track EnemyBounce and SummonArtifact tryenemyheal Coroutine No Tracks the progress of a TryHealEnemyItem and EnemyFlee coroutines spitout Coroutine No The SpitOut coroutine if one is in progress which is a coroutine used by the <code>Pitcher</code> enemy. It is null if it's not in progress gottaspit bool Yes When calling SpitOut (a coroutine specific to the <code>Pitcher</code> enemy), this needs to be set to false whenever <code>Pitcher</code> should spit out the player party member trapped within them startdrop bool Yes When a Drop calls occurs, the coroutine will eventually wait for this field to become true so it can proceed with the drops"},{"location":"Battle%20system/Battle%20state/#spying","title":"Spying","text":"Name Type Public? Description disablespy bool Yes If true, spying is disabled and cannot be performed on any enemy scopeequipped bool No Whether or not the <code>HPScope</code> medal is equipped. Set as such on StartBattle"},{"location":"Battle%20system/Battle%20state/#general-purpose","title":"General purpose","text":"Name Type Public? Description tempdata int Yes A general purpose integer for use in DoAction meant to be set externally. This is only used for the <code>Spuder</code> enemy extraentities EntityControl[] Yes A general purpose array of entities. This is only used when a <code>VenusBoss</code> enemy is involved"},{"location":"Battle%20system/Battle%20state/#unused-fields","title":"Unused fields","text":"<p>These fields are never referenced or never used in any meaningful ways.</p> Name Type Public? Description weakenemyfound bool No UNUSED, this is only set to false at the start of DoAction and to true on TryHealEnemyItem when a heal occured, but the field is never read making it unused actionid int No UNUSED, this is only read during the damage pipeline, but never written to making it unused oldmusicchannel int No UNUSED counter int No UNUSED selection int No UNUSED specialdefeat bool Yes UNUSED firstaction bool Yes UNUSED currententity EntityControl No UNUSED oldcamtarget Transform No UNUSED, Set to instance.<code>camtarget</code> on StartBattle when it's not a retry guicooldown float No UNUSED (there is logic in Update implicating it was supposed to be a cooldown that exhausts only during an Update controlled battle, but it is never practically used anywhere else making it practically unused)"},{"location":"Battle%20system/Battle%20state/#mainmanager-fields","title":"MainManager fields","text":"<p>These fields belongs to MainManager, but they are mostly related to BattleControl's state and either have influences on the battle or they are reporting the result of the battle.</p>"},{"location":"Battle%20system/Battle%20state/#player-party","title":"Player party","text":"Name Type Static? Description playerdata BattleData[] No The battle data of the players. The game keeps track of them constantly even outside of battle, but StartBattle resets their fields to a default state tp int No The amount of TP the player party has (usually clamped from 0 to <code>maxtp</code>) tpt int No The displayed amount of TP the player party has in the HUD maxtp int No The maximum amount of TP the player can have (this is <code>basetp</code> + the medals effects from ApplyBadges) basetp int No The base maximum amount of TP the player can have (this is normally 10 + all the bonuses applied from ApplyStatBonus) bp int No The amount of MP the player party has, clamped to <code>maxbp</code> maxbp int No The maximum amount of MP the player party has partylevel int No The player party's rank, starts at 1 and maxes out at 27 under normal gameplay partyexp int No The amount of EXP the player party has (this amount is only the one applicable for the current rank's progression) neededexp int No The amount of EXP needed for the player party to rank up (in other words, <code>partyexp</code> needs to reach this value to rank up). This starts at 100"},{"location":"Battle%20system/Battle%20state/#battle-modifiers","title":"Battle modifiers","text":"Name Type Static? Description haltbattleload bool Yes If this is set to true right after StartBattle starts by the caller, StartBattle will wait that it goes to false right after the fade in transition played battlelossevent bool Yes Tells if ReturnToOverworld should be called without flee if DeadParty happens"},{"location":"Battle%20system/Battle%20state/#battle-state-and-results","title":"Battle state and results","text":"Name Type Static? Description battle BattleControl Yes The current battle (null if no battle is in progress). Set on StartBattle when it's null (meaning it wasn't a retry) inbattle bool No Whether we are in battle or not. Set to true on StartBattle after the fade out transition and set to false in a terminal case where we know the battle will end without retry partyorder int[] No The list of player party members by their animid ordered by their formation in the overworld. Used to align the <code>partypointer</code> on StartBattle battlenoexp bool Yes Whether the last battle yielded no EXP. Set to false on StartBattle battlefled bool Yes Tells if the battle ended by fleeing battleenemyfled bool Yes Whether the battle ended while <code>enemyfled</code> was true without <code>expreward</code>. Set to false on StartBattle. This won't be set to true for an Enemy NPCControl encounter if any <code>GoldenSeedling</code> enemy were defeated lastdefeated List No The list of enemy ids that were defeated in the last battle (amended when applicable by CheckDead) lastitemuser int Yes The last player party member's <code>trueid</code> who used an item via UseItem lastdefeated List No The list of enemy ids that CheckDead detected were killed due to their <code>hp</code> reaching 0 or below. Set to a new list on StartBattle and reset to a new list after processing drops during the Death of the Enemy NPCControl if the battle was caused by a regular encounter battleresult bool Yes Whether the battle ended by winning (fleeing don't count) Set to true on StartBattle and set to false during TryFlee (when succeeding) and during DeadParty firstbattleaction bool No This is only set to true on the first StartBattle call since the last save load and it is used to apply an optimisation that involves a dummy DoAction call. This is only needed on the first StartBattle call so when true, this optimisation doesn't happen again"},{"location":"Battle%20system/BattleControl/","title":"BattleControl","text":"<p>BattleControl is a component whose logic contain the entire battle system of the game. This makes it the most monolithic component of the game, but it is also relatively isolated because most of its members are private. The current battle is stored in instance.<code>battle</code> with the ability to query if we are in one by checking if it's not null or instance.<code>inbattle</code> being true. Some logic belongs in MainManager, but the vast majority belongs to BattleControl which means this will mostly be documenting BattleControl.</p> <p>For details on BattleControl's fields, consult the battle state documentation.</p>"},{"location":"Battle%20system/BattleControl/#terminology","title":"Terminology","text":"<p>This system is the most complex in the game and as such, it is very easy to confuse terms for the purpose of documenting it. Due to this, there will be some standard terms with a consistent definition to reduce ambiguities as much as possible.</p> <p>Here are all the terms that will be used throughout the battle system documentation:</p> <ul> <li><code>player party member</code>: A <code>playerdata</code> element which is a BattleData corresponding to one of the player party members. It can be thought as someone part of the player's side of the battle. These elements are also used in the overworld, but the battle system documentation will focus on their roles during a battle</li> <li><code>enemy party member</code>: An <code>enemydata</code> element which is a BattleData corresponding to one of the enemy party members. It can be thought as one of the enemies fought during the battle and is part of the enemy's side. These elements are only used during a battle</li> <li><code>player party</code>: Refers to the the aggregate of all <code>playerdata</code> elements. This can be thought of as everyone from the player's side</li> <li><code>enemy party</code>: Refers to the aggregate of all <code>enemydata</code> elements. This can be thought of as all the enemies fought in the battle</li> <li><code>party</code>: Refers to either side of the battle (player or enemy)</li> <li><code>actor</code>: Refers to any party members no matter which side they are on</li> <li><code>action</code>: Refers to what an actor can do during the battle. In more concrete turn, anything that normally consumes an actor turn (usually through <code>cantmove</code>) counts as an action</li> <li><code>move</code>: Refer to a series of tasks an enemy action performs at the expense of others.</li> <li>player phase: Refers to the processing of all the player party's actions and all logic associated with it. More details in its documentation</li> <li>enemy phase: Refers to the processing of all the enemy party's actions and all logic associated with it. More details in its documentation</li> <li>turn end phase: Refers to the special phase that happens after the player and enemy phases where the main turn is advanced and finished</li> <li><code>phase</code>: Refers to any of the 3 phases</li> <li>main turn: Refers to the processing of all 3 phases as a unit which starts on the player phase and ends after the turn end phase. More details about a main turn's lifecycle in its documentation</li> <li><code>actor turn</code>: Refers to an individual's actor's concept of turn which includes their actions and ends with its turn advancement including their <code>cantmove</code> change. The actor turn is consumed by DoAction for player party members (with additional processing in EndPlayerTurn) or EndEnemyTurn for enemy party members and it is advanced to the next one by AdvanceTurnEntity</li> </ul>"},{"location":"Battle%20system/BattleControl/#execution-flow","title":"Execution flow","text":"<p>There is only one way to start a battle: starting a StartBattle coroutine. This will perform a wide variety of setup and fields initialisation to start the battle from a fresh state. This will not be recalled unless a Retry occur which is the opt-in ability to recreate the battle from the existing one, but preserving the StartUpData. The caller is able to further configure the battle as needed either by setting battle.<code>haltbattleload</code> to true to make the coroutine stop early or by yielding on battle.<code>halfload</code> to wait the coroutine stops later on on the caller side and configure it that way.</p> <p>After the battle is fully started (which may include enemy actions if they got the advantage), Update takes over. From there, its flow can be in one of 3 states from now on:</p> <ul> <li>Controlled flow (the one the battle starts at after StartBattle is done)</li> <li>Uncontrolled flow (delegates the control of the battle to another method or coroutine)</li> <li>Terminal flow (relegates control almost completely when the battle is about to end such that it can end or be retried properly)</li> </ul> <p>The key point to understand how a battle flows is the first 2 flows are constantly toggled with each other. Update is the main dispatcher that runs by default, but it's only making sure the usual flow is respected. Most of the heavy lifting is done by a coroutine or a method taking control.</p>"},{"location":"Battle%20system/BattleControl/#action-coroutines","title":"Action coroutines","text":"<p>Whenever something complex needs to happen such as an attack, battle.<code>action</code> (or battle.<code>inevent</code>) is set to true which switches to an uncontrolled flow as the coroutine or method takes most control away from Update. Update has very reduced logic during this, notably handling blocking during the enemy phase. Eventually, the procedure gets done so battle.<code>action</code> (or <code>inevent</code>) gets set back to false switching to a controlled flow. A coroutine which sets battle.<code>action</code> to true is refered to as an action coroutine.</p> <p>Here are all the action coroutines defined in the battle system:</p> <ul> <li>Tattle</li> <li>SwitchParty</li> <li>SwitchPos</li> <li>Relay</li> <li>UseItem</li> <li>DoAction</li> <li>CheckDead</li> <li>Chompy</li> <li>AIAttack</li> <li>AdvanceMainTurn</li> <li>TryFlee</li> </ul> <p>DoNothing is notably NOT an action coroutine because it is handled directly in place during player UI handling.</p> <p>The interesting point these have in common is with the exception of doing nothing from a player party member, these represents all actions that can possibly be taken by an actor. Notably, DoAction covers every single attacks in the entire game from every actor. This is why BattleControl can be caracterised as a coroutine driven system: while it does have an Update, it only acts as a dispatcher for the coroutines mentioned above.</p>"},{"location":"Battle%20system/BattleControl/#battle-events","title":"Battle events","text":"<p>Separatly from this, but still features an uncontrolled flow is EventDialogue which is a coroutine that processes some kind of events or cutscenes. The only difference with an action coroutine is instead of setting battle.<code>action</code> to true, it sets battle.<code>inevent</code> to true instead, but it has similar effects. These are triggered on specific conditions and behave very similarily to events, but are specialised to handle the ongoing battle.</p>"},{"location":"Battle%20system/BattleControl/#terminal-coroutines","title":"Terminal coroutines","text":"<p>A terminal flow is reserved for cases where the battle will end for sure in some ways and it features battle.<code>cancelupdate</code> or instance.<code>inbattle</code> being set to false. It features almost no control from Update and instead, the terminal coroutine controls the battle completely. This is done both for retries, losses and wins.</p> <p>Here are all the terminal coroutines:</p> <ul> <li>GameOver</li> <li>ReturnToOverworld</li> <li>DeadParty (this one is a wrapper to GameOver and ReturnToOverworld)</li> <li>AddExperience</li> </ul> <p>They act similarly to action coroutines, but with even more control which is needed to properly end the battle or retry it.</p> <p>Additionally, there are also wrapper methods available that will call some of the above and also change to a terminal flow:</p> <ul> <li>EndBattleWon (wraps AddExperience)</li> <li>ExitBattle (wraps ReturnToOverWorld, part of AddExperience)</li> </ul>"},{"location":"Battle%20system/BattleControl/#main-turn-flow","title":"Main turn flow","text":"<p>As this is a turn based battle system, it has a concept of turns. A main turn is composed of 3 phases executed in order:</p> <ul> <li>Player phase</li> <li>Enemy phase</li> <li>Turn end phase</li> </ul> <p>The player phase is the most involved mainly handling UI naviguations on top of player actions. It is only active when battle,<code>enemy</code> is false.</p> <p>The enemy phase mostly involves each enemies doing their action when <code>enemy</code> is true, but before AdvanceMainTurn runs which is the procedure that advances the main turn and allows a fresh one to start again.</p> <p>Each actor also have their own concept of turns called actor turn. An actor turn is composed of their action and other advancement logic such as the <code>cantmove</code> advance. <code>cantmove</code> is a multi purpose actor turn counter that serves as the way for the game to track that an actor can act, needs to wait before being able to, or has multiple actions available. The actor turn advancement notably includes logic associated with the conditions currently inflicted on the actor among other details.</p> <p>When all the actor turns available are consumed, the actor needs to wait their actor turn gets advanced which is done by AdvanceTurnEntity and it is only called as part of AdvanceMainTurn during the turn end phase.</p>"},{"location":"Battle%20system/BattleControl/#hitactions","title":"hitactions","text":"<p>There is a notable exception to this flow: an enemy is able to do what's known as a hitaction. A hitaction occurs when the field of the same name on the enemy party member is true which causes the next Update cycle to process a temporary DoAction call on the enemy while placing <code>enemy</code> to true. Check the documentation for more information on this feature.</p>"},{"location":"Battle%20system/BattleControl/#the-firststrike-system","title":"The firststrike system","text":"<p>Another exception to the main turn flow can occur during StartBattle where the enemy party is able to act before the player party. This is called a <code>firststrike</code>, check the documentation to learn more about how this system works.</p>"},{"location":"Battle%20system/BattleControl/#damage-pipeline","title":"Damage pipeline","text":"<p>During the course of the battle, damages might be processed for various reasons such as attacks or using an item. These damages are processed by the damage pipeline which has a single entry point: DoDamage. This method takes in a target, an optional attacker belonging to the opposte party of the target (it is possible to have damages comes from no actor, but friendly fire attacks aren't possible) and a base amount to inflict. This amount may change for various reasons as part of the damage calculation logic which is held in CalculateBaseDamage. </p> <p>The damage might have more effects processed after its calculation for example, by applying some medals that act on it. It is greatly influenced by the property parameter and the enemy party members's weakness field, a list of AttackProperty that applies to this enemy party member.</p> <p>It should be noted however that the caller of DoDamage is free to perform any logic that goes beyond the scope of the damage pipeline which happens very frequently in actions's logic. The damage pipeline have known design shortcomings that limits its usage, check the documentation about them to learn more.</p>"},{"location":"Battle%20system/BattleControl/#actor-state","title":"Actor state","text":"<p>The player party's stats are in instance.<code>playerdata</code> (which the whole game uses elsewhere in various places) while the enemy party's are specifically inside BattleControl and is called <code>enemydata</code>.  The <code>playerdata</code> array has complex addressing methods, more info can be found at the <code>playerdata</code> addressing documentation</p> <p>They are both the same type: a struct called BattleData which means some fields have different meanings depending if it's a player party member or an enemy party member and some fields are only relevant for one of the 2.</p> <p>More details on the fields can be consulted in the BattleData documentation.</p>"},{"location":"Battle%20system/BattleControl/#other-unity-events","title":"Other Unity events","text":"<p>Besides Update, this component has a LateUpdate and a FixedUpdate, but they only update UI informations visually and are therefore much more minor in terms of importance.</p>"},{"location":"Battle%20system/DoCommand/","title":"DoCommand","text":"<p>This coroutine contains all the logic to process any action commands which are commands to be performed during a battle action. Its runtime is tracked by <code>doingaction</code> being true which allows the caller to yield until it goes to false when it's done.</p> <pre><code>private IEnumerator DoCommand(float timer, ActionCommands commandtype, float[] data)\n</code></pre>"},{"location":"Battle%20system/DoCommand/#parameters","title":"Parameters","text":"<ul> <li><code>timer</code>: A parameter to send to the action command. Its specific meaning varies depending on the command.</li> <li><code>commandtype</code>: The ActionCommands to process</li> <li><code>data</code>: General purpose array that controls the action commands</li> </ul>"},{"location":"Battle%20system/DoCommand/#procedure","title":"Procedure","text":"<p>There are 4 parts to the coroutine, 2 of them depends on the commandtype.</p>"},{"location":"Battle%20system/DoCommand/#mainmanagermashcommandalt-override","title":"MainManager.<code>mashcommandalt</code> override","text":"<p>If MainManager.<code>mashcommandalt</code> is true (meaning the game settings has Sequential Keys set), it overrides some parameters sent to the coroutine:</p> <ul> <li>timer: If it's 0 or lower, it's overriden to 300.0. NOTE: while the <code>timer</code> gets overriden regardless of the commandtype, in practice, this will only affect TappingKey assuming correct usage because it is the only action command that supports a negative <code>timer</code> value as being valid. It does however mean that if a negative <code>timer</code> value is incorrectly sent, this logic will apply</li> <li>commandtype: If it's TappingKey or RandomTappingBar, it is overriden to SequentialKeys</li> <li>data: This can be overriden depending on the commandtype (not overriden if it isn't in the list):<ul> <li>TappingKey: overriden to a new array with one element being <code>data[9]</code> if it exists or the value 6.0 if it doesn't.</li> <li>RandomTappingBar: overriden to a new array with 2 elements being 6.0 and 1.0 respectively</li> </ul> </li> </ul>"},{"location":"Battle%20system/DoCommand/#setup","title":"Setup","text":"<p>This starts by having <code>doingaction</code> set to true and <code>commandsucess</code> set to false which signals to the rest of the battle system that an action command is in progress and its result has yet to be determined, but is assumed false for now.</p> <p>Some local variables are also initialised here which can be used by the specific commandtype:</p> <ul> <li>internaldata: set to a new array of float of one element</li> <li>initialtimer: set to the timer parameter</li> <li>infinite: set to true only if timer is exactly -1.0 (false otherwise)</li> <li>letters: set to null (this is a TextMesh array)</li> </ul> <p>What follows depends on the specific commandtype. Consult the ActionCommands's indvidual pages to learn more. This phase involves initialising action commands related fields.</p>"},{"location":"Battle%20system/DoCommand/#execution","title":"Execution","text":"<p>This phase entire depends on the specific commandtype. Consult the ActionCommands's indvidual pages to learn more. This phase involves the actual execution of the action command. When it is done, the command is finished and a result has been determined which will be stored in <code>commandsuccess</code>.</p>"},{"location":"Battle%20system/DoCommand/#cleanup","title":"Cleanup","text":"<p>No matter the command type, this phase occurs after its execution:</p> <ul> <li>A frame is yielded</li> <li>FinishAction is called which does the following:<ul> <li><code>actionroutine</code> is stopped if it was present and set to null (this is usually this coroutine's instance)</li> <li>All <code>commandsprites</code> that exists are destroyed</li> <li>All <code>buttons</code> that exists are destroyed</li> <li><code>doingaction</code> is set to false which signal to the rest of the battle system that there's no longer an action command in progress</li> </ul> </li> </ul>"},{"location":"Battle%20system/DoCommand/#known-issues-with-getblock","title":"Known issues with GetBlock","text":"<p>While action commands are used for player actions, some enemy actions makes use of it, but in an unexpected fashion that is worth to explain. When this happens, DoCommand gets started by DoAction during the enemy phase.</p> <p>Due to how Unity manages coroutines, for a given frame, this will be the order they will get to execute their part:</p> <ol> <li>GetBlock (it is always first because Update always run before coroutines)</li> <li>DoAction (it is started first)</li> <li>DoCommand (it is started second)</li> </ol> <p>Please note that this execution order assumes that both coroutines are set to execute on that frame (for example, both could yield a frame making them scheduled to run on the next one). The coroutines are in starting order because both are defined in the same script (BattleControl) and on the same instance (MainManager.<code>battle</code>).</p> <p>This order is very problematic when started by DoAction because of how a typical action would flow. Here's how a typical timeline of events would proceed:</p> <ol> <li>Update starts DoAction with the enemy party member, this puts the battle in an uncontrolled flow</li> <li>While the action is ongoing, GetBlock runs regularly meaning <code>blockcooldown</code> and <code>caninputcooldown</code> updates as they normally do with the blocking logic</li> <li>Eventually, DoAction starts DoCommand. This will cause GetBlock to have its logic locked because <code>doingaction</code> goes to true and that makes GetBlock not perform any blocking logic during the duration of DoCommand. Effectively, <code>blockcooldown</code> and <code>caninputcooldown</code> are frozen: they will not change and report the same state than the frame DoCommand was called (GetBlock was called right before DoAction started DoCommand on this frame)</li> <li>The action command executes, but GetBlock cannot executes its regular blocking logic while it's ongoing</li> <li>Eventually, DoCommand is done and sets <code>doingaction</code> to false which unlocks GetBlock's logic. However, because DoCommand is the last coroutine in the ordering, this is the last interesting event that happens in this frame.</li> <li>A new frame starts. GetBlock goes first, but because it's unlocked now, it will perform a stray blocking state update which has effects on the regular block timing as explained below</li> <li>DoAction goes after and it is unblocked too due to <code>doingaction</code> going to false. If DoDamage gets called before the next yield (which is what commonly happens), then the blocking result will be locked in and nothing can influence it anymore as it will be used in the damage pipeline.</li> </ol> <p>Step 6 in this timeline is crucial: it effectively splits the timing window of the block into 2 distinct ones:</p> <ol> <li>The first are the ~18 frames (~3.0 for a super block) leading up to the moment DoCommand is called</li> <li>The second is the exact frame that GetBlock gets called while DoCommand just finished the frame before</li> </ol> <p>The first window is essentially the regular one, but with 1 frame removed because this frame is now in a distinct window that occurs AFTER the action command rather than right before. Due to <code>caninputcooldown</code> however, it is not possible to attempt to hit both windows: if the player tries to hit the first window and less than ~36 frames passes until DoCommand starts, the anti spam feature will prevent any attempt to hit the second window. In other words: the player may attempt the first OR the second window, but not both (if they do, the first window will be the effective results).</p>"},{"location":"Battle%20system/RefreshSkills/","title":"RefreshSkills","text":"<p>This method allows to refresh the skills list of all the player party members. The lists depends on flags, medals equipped and others. It belongs to MainManager.</p> <p>The method will go over each player party member and reset their <code>skills</code> to a new list before filling them with the ones they are allowed to have if the conditions are fufilled. Most of them are specific to each animid (only <code>Bee</code>, <code>Beetle</code> and <code>Moth</code> can have skills), but some of them are common with the same conditions to have it. </p> <p>The order they will be presented is the same order they will be checked and added if the condition is fufilled. The <code>Name</code> column is the name of the value in the <code>Skills</code> enum. To see the entire list of skills defined in the game by id order, check the skills documentation.</p>"},{"location":"Battle%20system/RefreshSkills/#bees-skills","title":"<code>Bee</code>'s skills","text":"Id Name Condition 34 FieldBeemerang instance.<code>battle</code> is null and flag 11 is true 35 FieldHalt instance.<code>battle</code> is null and flag 21 is true 36 FieldFly instance.<code>battle</code> is null and flag 19 is true 2 BeeRangMultiHit None, this is always granted 18 HurricaneBeemerang flag 21 is true 44 HeavyThrow The <code>HeavyThrow</code> medal is equipped 16 NeedleToss instance.<code>partylevel</code> is 11 or above 24 NeedlePincer instance.<code>partylevel</code> is 15 or above 5 BeeFly flags 19 is true 26 IceBeemerang flag 544 is true 31 IceSphere flag 533 is true 11 SecretStash instance.<code>partylevel</code> is 2 or above 45 SharingStash flag 445 is true 33 Sturdy The <code>Tardigrade</code> is equipped on <code>Bee</code> 48 HardCharge The <code>HardCharge</code> is equipped on <code>Bee</code> 46 RoyalDecree <code>AntQueen</code> is a follower or the current maps is <code>TestRoom</code> or flag 594 is true (During the fight near the refrigerator or the fire construct fight in chatper 7)"},{"location":"Battle%20system/RefreshSkills/#beetles-skills","title":"<code>Beetle</code>'s skills","text":"Id Name Condition 37 FieldHorn instance.<code>battle</code> is null and flag 17 is true 49 FirstDash instance.<code>battle</code> is null, flag 699 is true and flag 39 is false 38 FieldDash instance.<code>battle</code> is null and flag 39 is true 39 FieldDig instance.<code>battle</code> is null and flag 18 is true 3 BeetleTaunt None, this is always granted 32 HeavyStrike instance.<code>partylevel</code> is 4 or above 6 BeetleDig flag 18 is true 10 HornDash flag 699 is true 5 BeeFly flag 19 is true 27 IceDrill flag 17 is true 31 IceSphere flag 533 is true 9 PeebleToss The <code>MightyPeeble</code> medal is equipped 19 PebbleTossPlus The <code>MightierPebble</code> medal is equipped 43 PepTalk flag 98 is true 33 Sturdy The <code>Tardigrade</code> medal is equipped on <code>Beetle</code> 48 HardCharge The <code>HardCharge</code> medal is equipped on <code>Beetle</code> 46 RoyalDecree <code>AntQueen</code> is a follower or the current maps is <code>TestRoom</code> or flag 594 is true (During the fight near the refrigerator or the fire construct fight in chatper 7)"},{"location":"Battle%20system/RefreshSkills/#moths-skills","title":"<code>Moth</code>'s skills","text":"Id Name Condition 40 FieldFreeze instance.<code>battle</code> is null 42 FieldShield instance.<code>battle</code> is null and flag 20 is true 41 FieldIcecle instance.<code>battle</code> is null and flag 171 is true 4 Icefall None, this is always granted 21 FrigidCoffin instance.<code>partylevel</code> is 6 or above 25 IceRain flag 171 is true 27 IceDrill flag 17 is true 26 IceBeemerang flag 544 is true 31 IceSphere flag 533 is true 17 BubbleShieldLite flag 160 is true 7 BubbleShield flag 20 is true 8 Empower The <code>ChargeUp</code> medal is equipped 22 ChargeUpPlus The <code>ChargeUp2</code> medal is equipped 14 AttackUp The <code>Empower</code> medal is equipped 23 EmpowerPlus The <code>Empower2</code> medal is equipped 15 DefenseUp The <code>Fortify</code> medal is equipped 30 DefenseUpPlus The <code>Fortify2</code> medal is equipped 28 AttackDown The <code>Emfeeble</code> medal is equipped 29 AttackDownPlus The <code>Emfeeble2</code> medal is equipped 12 DefenseBreak1 The <code>Depower1</code> medal is equipped 13 DefenseBreakAll The <code>Depower2</code> medal is equipped 47 Cleanse instance.<code>partylevel</code> is 13 or above 33 Sturdy The <code>Tardigrade</code> medal is equipped on <code>Moth</code> 48 HardCharge The <code>HardCharge</code> medal is equipped on <code>Moth</code> 46 RoyalDecree <code>AntQueen</code> is a follower or the current maps is <code>TestRoom</code> or flag 594 is true (During the fight near the refrigerator or the fire construct fight in chatper 7)"},{"location":"Battle%20system/StartBattle/","title":"StartBattle","text":"<p>This is a public coroutine that serves as the only way for the game to start a battle.</p> <pre><code>public static IEnumerator StartBattle(int[] enemyids, int stageid, int adv, string music, NPCControl calledfrom, bool canescape)\n</code></pre>"},{"location":"Battle%20system/StartBattle/#parameters","title":"Parameters","text":"<ul> <li><code>enemyids</code>: The list of enemies id that the player party will be against. If it contains more than 4 elements, all the ones after the 4th one will be placed in <code>extraeenmies</code> and the fight will be against the first 4 for now by setting <code>enemydata</code> to them. This is subject to be overriden by EnemyCheck during the start process</li> <li><code>stageid</code>: The BattleMaps to use for the battle, will be overriden to the ice version if the calledfrom.entity is <code>inice</code> and the stageid is <code>SandCastle</code> or <code>SandCastleDark</code>. If -1 is sent, the stage is determined by instance.<code>battlestage</code> which the MapControl initialised on its Start</li> <li><code>adv</code>: Decides whose party has the advantage. This will be set to battle.<code>sadv</code>. Only the value 3 does anything and it's to give the enemy party a firststrike. Other values are allowed, but do not change anything</li> <li><code>music</code>: The name of the music to use for the battle. This is ignored if map.<code>nobattlemusic</code> is true. If it's null, the music is determined automatically based on the BattleMaps and some conditions</li> <li><code>calledfrom</code>: The Enemy NPCControl that caused this battle if any. If it's null, it means no NPCControl caused it and the battle was started manually. This will be set to battle.<code>caller</code></li> <li><code>canescape</code>: Whether the player is allowed to flee or not. This will be set to battle.<code>canflee</code>. This also tells if the player is allowed to Retry the battle on GameOver</li> </ul>"},{"location":"Battle%20system/StartBattle/#procedure","title":"Procedure","text":"<p>The procedure for starting a battle is very complex and there's multiple logic to it which is sequentially performed. The caller is able to interupt it at 2 places to configure the battle further: one early on by setting MainManager.<code>haltbattleload</code> to true which stalls the coroutine until set to false and one later on by yielding on battle.<code>halfload</code> becoming true.</p> <p>The phases will be documented in their own page where they are defined on the boundaries of those interuption points. Here are the phases in order and a link to their details:</p> <ul> <li>Pre haltbattleload</li> <li>Post haltbattleload</li> <li>Post halfload</li> </ul>"},{"location":"Battle%20system/StartUpData/","title":"StartUpData","text":"<p>All these values are saved into <code>sdata</code> when StartBattle is called while <code>saveddata</code> was false.</p> Name Type Description flagvar int[] All the flagvar enemies int[] The sent enemyids value to StartBattle (after EnemyCheck ran when calledfrom doesn't exists or its <code>eventid</code> is 0 or beloe) items int[] instance.<code>items[0]</code> which are all the standard items inventory hp int[] All the <code>playerdata</code>'s <code>hp</code> atk int[] All the <code>playerdata</code>'s <code>atk</code> def int[] All the <code>playerdata</code>'s <code>def</code> keyitem int[] instance.<code>items[1]</code> which are all the key items inventory flags bool[] All the flags partyitemuse bool[] All the <code>playerdata</code>'s <code>lockitems</code> stage int The sent stageid from StartBattle tp int instance.<code>tp</code> adv int The sent adv from StartBattle maxtp int instance.<code>maxtp</code> music string This is either the sent music from StartBattle or MainManager.<code>music[0]</code>.clip.name. It will set it to the former if the sent music isn't null / empty or MainManager.<code>music[0]</code> is null or not playing. It will be set to the latter otherwise called NPCControl The calledfrom sent from StartBattle encounter int[,] instance.<code>enemyencounter</code> psc List All the <code>playerdata</code>'s conditions esc List All the <code>enemydata</code>'s conditions enemyweakness List&lt;AttackProperty[]&gt; All the <code>enemydata</code>'s weakness (if the <code>weakness</code> field is null, null is the only element set)"},{"location":"Battle%20system/playerdata%20addressing/","title":"<code>playerdata</code> addressing","text":"<p>The player party members are all stored in <code>playerdata</code>, but the way the game addresses it is complex and involves multiple layers depending on if it's during a battle or not.</p> <p>Let's first explain why is there multiple way to address the player party and how it relates to the array itself.</p>"},{"location":"Battle%20system/playerdata%20addressing/#playerdatas-layout","title":"<code>playerdata</code>'s layout","text":"<p>At its core, <code>playerdata</code> is an array. This means that no matter what, a member can only be addressed by its index which starts at 0 and ends at the amount of player party members members - 1.</p> <p>This by itself is very limiting for varying reasons because the game needs to keep track of the player switching the order and the game also needs to sometime address a member by using an animid instead of a particular position in the formation.</p> <p>Due to this, 2 fields exists on each BattleData that covers addressing everyone in every way at least in the overworld (meaning these semantics are only for player party members despite those fields existing for enemy party members). Here's the fields and what they do:</p> <ul> <li><code>trueid</code>: The animid of the player party member since the last time ChangeParty was called which creates or recreates the entire party. This value never changes for a particular <code>playerdata</code> element until ChangeParty is called which recreates the whole array.</li> <li><code>animid</code>: The visually rendered animids in the overworld. This value initially starts as the same as <code>trueid</code>, but if the player switches the order, the animids are rotated between all elements of <code>playerdata</code>. This means this value not only allows the switch to work since the visual rendering changes accordingly, but it also allows the game to know who is actually in front when taking into account player switches.</li> </ul> <p>To understand better how these fields work, we need to explain how ChangeParty works.</p>"},{"location":"Battle%20system/playerdata%20addressing/#a-general-explanation-of-changeparty","title":"A general explanation of ChangeParty","text":"<p>MainManager.ChangeParty is a method that takes an array of animids that forms the party. It will completely recreate <code>playerdata</code> with the animids sent in the same order they were sent. This is not a trivial operation: there are heavy restrictions imposed on the moment it is possible (usually during events or save loading) and it is potentially destructive because <code>playerdata</code> gets completely wiped and reinitialised.</p> <p>Due to this, ChangeParty imposes some rules that lasts until the next time ChangeParty is called (which isn't common as said above):</p> <ul> <li>The <code>playerdata</code> indexes are always in the order the animids was sent on ChangeParty</li> <li>The <code>trueid</code> fields are always going to have the same value for a given <code>playerdata</code> index and they will always match the ones sent to ChangeParty</li> </ul> <p>These 2 rules are always true, no matter what situation the game is in and no matter how many times the player switches whether the player is in the overworld or in battle.</p> <p>This gives different methods of addressing in the overworld and in battle because the methods in which they allows to switch the formation are very different and mostly not linked.</p>"},{"location":"Battle%20system/playerdata%20addressing/#methods-of-addressing-overworld","title":"Methods of addressing (overworld)","text":"<p>To understand how addressing the party works in the overworld, it must be understood that an overworld party switch only rotates a single field of each <code>playerdata</code>: the <code>animid</code> field. In a sense, this means this switch is \"fake\" because no actual field changes besides the <code>animid</code> which only changes what's being rendered since it changes the animation controller. As far as the data is concerned, the party hasn't changed since the last ChangeParty, hence why <code>trueid</code> is named as such: it is the ACTUAL animid of the member that can never change and ignores overworld formation.</p> <p>Combined with the rules of ChangeParty mentioned above, it gives 3 ways to address the party in the overworld. Let's explore each of them.</p>"},{"location":"Battle%20system/playerdata%20addressing/#by-playerdata-index-directly","title":"By <code>playerdata</code> index directly","text":"<p>This allows to address the party in formation order disregarding overworld switches. The element 0 for example is always the lead party member while element 1 is always the one following the lead. This happens because the only field that gets changed during a switch is the <code>animid</code> field, but the entity itself is unchanged. Since the initial ChangeParty order of the party also never changes, this is what allows the index to refer to party members by their position in the overworld formations.</p> <p>This method of addressing simply involves indexing the <code>playerdata</code> array directly. It is the simplest way to address the party.</p>"},{"location":"Battle%20system/playerdata%20addressing/#by-the-player-party-members-trueid","title":"By the player party member's <code>trueid</code>","text":"<p>This allows to address the party by animid, but in a deterministic order that ignores overworld switches. The order preserved by the <code>trueid</code> field is always the animids assigned during ChangeParty. This means the order the <code>trueid</code> are relative to their <code>playerdata</code> index is fixed, even if the player decides to switch in the overworld or the battle. Incidentally, only the <code>trueid</code> are saved on the save file which means the specific formation isn't saved, only the one of the last ChangeParty.</p> <p>Addressing this way can take multiple forms since an index needs to be passed after all, but it usually involves looping through the array in index order and fetching the <code>trueid</code> for each element which gives this deterministic ChangeParty order.</p>"},{"location":"Battle%20system/playerdata%20addressing/#by-the-player-party-members-animid","title":"By the player party member's <code>animid</code>","text":"<p>This allows to address the party by the actual animid that is rendered after considering overworld switches. This is needed if the game needs to care specifically about the animid AND its position in the formation to determine for example the animid of the member in front taking into account the player switches. Since this field is more volatile, it's not suited for having a deterministic order: this field is used during a player switch and as such, their order relative to player indexes is free to be changed by the player.</p> <p>Addressing this way can take multiple forms since an index needs to be passed after all, but it usually involves indexing the array which gives a member with a specific formation position and fetch their <code>animid</code> which tells which party member it represents.</p>"},{"location":"Battle%20system/playerdata%20addressing/#methods-of-addressing-durring-battle","title":"Methods of addressing (durring battle)","text":"<p>While the overworld ways of addressing the party are sufficient for the overworld, they aren't a good fit during battle because the game wants to disociate the overworld party order with the battle one. This is required because the actual overworld order must not change after the battle is over for various reasons.</p> <p>Due to this, 2 fields are introduced to allow to \"fake\" a different view of the party that is reserved specifically for battles:</p> <ul> <li>instance.<code>partyorder</code>: This array contains the animids ordered by the <code>animid</code> fields of <code>playerdata</code>'s elements. In other words, it's the rendered overworld party order after considering overworld switches. It is updated on ChangeParty and everytime the player switches the formation, but is otherwise only used by StartBattle</li> <li><code>partypointer</code>: This array maps battle formation position to <code>playerdata</code> indexes and it is always composed of 3 elements (which is the maximum amount of player party members). It is affected during a battle party switch or swap (which occurs as part of SwitchParty and SwitchPos)</li> </ul> <p>Initially, <code>partypointer</code> is initialised to {0, 1, 2} on StartBattle. Later on in that coroutine, it will try to align <code>partypointer</code> and <code>partyorder</code> so they contain matching arrays with the player party being aligned with this. This alignement is done by calling a fast SwitchParty repeatedly until they both align (no call is done if they already happened to align).</p> <p>This works because a switch during battle works differently than in the overworld. If the overworld only involved rotating the <code>animid</code> fields, in battle, a switch only involves rotating the <code>partypointer</code> elements. This alone doesn't switch anything so what SwitchParty and SwitchPos do after the switch is to also update the <code>playerdata</code> elements with some information, but notably, it changes the position of the <code>battleentity</code>. This means that as far as the entities are concerned, a switch truly took place as far as the data and physical positions are concerned, but as far as the <code>animid</code> are concerned, they are left unchanged leaving no visual changes like in the overworld. It just provides a different view of the same <code>playerdata</code> array.</p> <p>This has no effect in the overworld because the <code>battleentity</code> isn't the <code>entity</code> field for the player party, but it means that the party now aligns with the overworld order without actually changing anything that affects the overworld. This leads to a fundamental rule about <code>partypointer</code>: it will always act as a mapper from battle formation position to <code>playerdata</code> index.</p> <p>This works because after StartBattle, <code>partypointer</code> will hold the same order as how the party was visually in the overworld, but it's now completely disconnected from the overworld party formation. This means that as long as formation position are addressed using the <code>partypointer</code>, it will always match with battle formation order. It also means that BattleControl cannot mess with the <code>animid</code> fields for player party members because changing those will affect the overworld.</p> <p>This leads to different ways to address the party. Let's explore them.</p>"},{"location":"Battle%20system/playerdata%20addressing/#by-playerdata-index-directly_1","title":"By <code>playerdata</code> index directly","text":"<p>The <code>battleentity</code> of the <code>playerdata</code> array will always be in <code>trueid</code> order no matter way. This essentially means that by addressing by <code>playerdata</code> index, it addresses by <code>trueid</code>, but only if it specifically concerns their <code>battleentity</code> which is separate from their <code>entity</code>. For example, GetSingleTarget sets <code>playertargetID</code> to the <code>playerdata</code> index of the targetted player party member, but the same information tells who was targetted because this number is the <code>trueid</code> of the element too. It also represents the <code>animid</code> of the <code>battleentity</code> for the same reasons.</p> <p>Effectively, it's a way to address by <code>trueid</code> as long as it only concerns the <code>battleentity</code>.</p>"},{"location":"Battle%20system/playerdata%20addressing/#by-the-player-party-members-trueid_1","title":"By the player party member's <code>trueid</code>","text":"<p>Addressing by <code>trueid</code> becomes much more interesting in battle because since the party order didn't change any <code>animid</code> fields, it means <code>partypointer</code> resolves to the <code>trueid</code> and it now means it acomplishes a similar goal than what the overworld <code>animid</code> addressing means.</p> <p>In practice, it means the <code>trueid</code> can be thought of as the same than the actual <code>animid</code> field in the overworld. In fact, the battleentity.<code>animid</code> values originally get set to the <code>playerdata</code>'s <code>trueid</code> values on StartBattle. Essentially, anything that required a specific animid (such as checking a if a medal is equipped on a member with a particular animid) is best suited for this addressing method.</p>"},{"location":"Battle%20system/playerdata%20addressing/#by-partypointer","title":"By <code>partypointer</code>","text":"<p>Another benefit of <code>partypointer</code> is this array allows to map battle formation order to <code>playerdata</code> order. This means that for example <code>playerdata[partyorder[0]]</code> always return the player party member in the front in battle irregardless of the overworld formation while <code>playerdata[partyorder[playerdata.length - 1]]</code> always return the one on furthest back. This addressing method is best suited where the battle formation matters such as targetting.</p> <p>A benefit to this is it simplifies the procedure of SwitchParty and SwitchPos because all that's needed is to rotate the <code>partypointer</code> elements and update the battleentities accordingly (mainly their position).</p> <p>One thing to be cautious of: <code>partypointer</code> always has 3 elements, but there might not be 3 <code>playerdata</code> elements. If there's 2 or 1, care must be taken to check that the <code>partypointer</code> index falls within the bounds of <code>playerdata</code> first before addressing this way.</p>"},{"location":"Battle%20system/playerdata%20addressing/#by-battleentityanimid","title":"By battleentity.<code>animid</code>","text":"<p>While the <code>animid</code> field isn't as useful as it's essentially the same than <code>trueid</code>, it is still possible to address by the rendered animid. It works in a similar way than the overworld version, but it uses the battleentity.<code>animid</code> instead because the battleentity is now the only one that holds the information about the true rendered animid. In other words, use battleentity.<code>animid</code> instead of <code>animid</code> for this purpose.</p>"},{"location":"Battle%20system/Action%20commands/Crosshairs/","title":"Crosshairs","text":"<p>A simple Confirm input prompt consisting of a ring that renders on an actor with its matching crosshair moving from a random position towards it which is then repeated multiple times. The goal of the command is to press Confirm when the crosshair falls inside its ring visually and to hit all of the Confirm inputs correctly in a row. If no Confirm inputs is done for any crosshairs or if Confirm is pressed too early, the command is a failure.</p>"},{"location":"Battle%20system/Action%20commands/Crosshairs/#timer-usage","title":"<code>timer</code> usage","text":"<p>The amount of frames the first crosshair will move before the command is considered a failure. -1.0 is not a supported value for this action command. This frames amount never changes for all crosshairs if <code>data[3]</code> doesn't exist and if it does, it will decrease by <code>data[3]</code> after each successful crosshair.</p>"},{"location":"Battle%20system/Action%20commands/Crosshairs/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: The amount of crosshairs to hit for the command to succeed</li> <li><code>data[1]</code>: The actor index that the crosshairs will target on. The party depends on the value:<ul> <li>If it's 0 or higher, it's an <code>enemydata</code> index</li> <li>If it's less than 0, its absolute value - 1 is a <code>playerdata</code> index</li> </ul> </li> <li><code>data[2]</code>: This is both the distance the crosshair will be from the target before heading towards it and it also determines the range of each component of the generated starting position's vector (between - (2 * <code>data[2]</code>) and 2 * <code>data[2]</code>)</li> <li><code>data[3]</code>: The amount of frames that gets removed of the total time the crosshair will move after each sucessful Confirm press. This is optional: no frames are removed if this value doesn't exist</li> </ul>"},{"location":"Battle%20system/Action%20commands/Crosshairs/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li><code>presskey</code> is set to 4</li> <li>The <code>Crosshair</code> sound is played on <code>sounds[9]</code> with 0.5 volume on loop</li> <li><code>commandsprites</code> is set to a new array of 2 elements where each is the SpriteRenderer of a new UI object named <code>crossX</code> where <code>X</code> is the index childed to the <code>battlemap</code> with a scale of Vector3.one using the <code>guisprites[41]</code> sprite (a white cross with a dot in the center) with a sortorder of 10 + index on layer 15 (<code>3DUI</code>). The local position depends on <code>data[1]</code>:<ul> <li>If it's at least 0, it's the <code>enemydata</code>'s battleentity position at index <code>data[1]</code> (truncated to int) + (Vector3.up * (the enemy party member's battleentity.<code>height</code> - 1.0) + the enemy party member's <code>cursoroffset</code>). However, if the enemy party member's position is <code>Underground</code>, it's the enemy party member's battleentity position + (0.0, 0.5, 0.0)</li> <li>Otherwise (meaning <code>data[1]</code> is negative), the logic is the same, but the <code>enemydata</code> index is the absolute value of <code>data[1]</code> - 1 and the local position doesn't change if the enemy party member's position is <code>Underground</code></li> </ul> </li> <li><code>commandsprites[0]</code>.sprite is set to <code>guisprites[93]</code> (a white crosshair's ring)</li> </ul>"},{"location":"Battle%20system/Action%20commands/Crosshairs/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>There's 3 parts to the execution phase: before the <code>timer</code> loop which has some initialisation, the <code>timer</code> loop itself and after the <code>timer</code> loop where there's cleanups.</p>"},{"location":"Battle%20system/Action%20commands/Crosshairs/#before-timer-loop","title":"Before <code>timer</code> loop","text":"<ul> <li><code>combo</code> is set to 0</li> <li>The actor's entity corresponding to the command's target is obtained (the enemy party member if <code>data[1]</code> is 0 or above, the player party member otherwise)</li> <li>The amount of remaining crosshairs is stored in a local int and initialised to <code>data[0]</code></li> <li><code>caninputcooldown</code> is set to 10.0</li> <li>A starting crosshair position is generated which is done by doing the following:<ul> <li>Generate a random vector where each component is between - (2 * <code>data[2]</code>) and 2 * <code>data[2]</code> (via MainManager.RandomVector)</li> <li>Clamp the magnitude of the vector to be <code>data[2]</code> (via calling MainManager.ClampMagnitude from <code>data[2]</code> to <code>data[2]</code>)</li> <li>Add the <code>commandsprites[0]</code>'s position (the crosshair's ring)</li> <li>Repeat if the x/y distance to <code>commandsprites[0]</code>'s position (the crosshair's ring) is less than <code>data[2]</code>. NOTE: This is an inneficient way to reject any vectors whose z has an absolute value that is too high. It shouldn't have been considered in the vector's generation, but instead of doing that, the sample is rejected</li> </ul> </li> </ul>"},{"location":"Battle%20system/Action%20commands/Crosshairs/#timer-loop","title":"<code>timer</code> loop","text":"<p>This loop goes on until <code>timer</code> expires which happens when no Confirm inputs was done for enough time to fail the command. It will be exited early if an early fail happens or if a success happens.</p> <p>This is what happens inside the loop:</p> <ul> <li>Both <code>commandsprites</code> (the crosshair and its ring) has their z angles incremented by 7x the game's frametime so they continuously rotate</li> <li><code>commandsprites[1]</code> (the crosshair) has its position set to a lerpUnclamped from the starting position generated (with the z being the <code>commandsprites[0]</code> one which is the crosshair's ring) to <code>commandsprites[0]</code>.position (the crosshair's ring) with an unclamped factor of (1.0 - <code>timer</code> / initialtimer) * 1.15. This essentially makes the crosshair travel towards its ring, but it will overshoot intentionally the position by 15% which allows the crosshair to go slightly past the center of its ring</li> <li>If the distance between both <code>commandsprites</code> is less than 0.75, <code>commandsprites[1]</code> (the crosshair)'s color is set to pure green. This is only updated for every 3 frames tracked by <code>timer</code> floored % 3 being 0</li> <li>If Confirm was pressed without hold and <code>caninputcooldown</code> expired (normally not for the first 10.0 frames of the loop), the input is handled by either failing or moving on to the next crosshair:<ul> <li>If the distance between both <code>commandsprites</code> is more than 0.85, the command is failed by calling PlayBuzzer followed by setting <code>commandsprites[1]</code> (the crosshair)'s color is set to pure red and breaking out of the <code>timer</code> loop early</li> <li>If <code>wordroutine</code> isn't in progress, it is stopped and <code>commandword</code> is destroyed</li> <li><code>wordroutine</code> is set to a new ShowSuccessWord call for the targetted entity without block or super</li> <li><code>commandsprites[1]</code> (the crosshair)'s color is set to pure white</li> <li>A new starting crosshair position is generated using the same scheme than the first one and assigned to it</li> <li>The amount of remaining crosshairs is decremented</li> <li>If <code>data[3]</code> existed, initialtimer is decreased by it (effectively, it removes this much amount of frames for the duration of the next crosshair)</li> <li><code>timer</code> is set to initialtimer</li> <li><code>combo</code> is incremented (this will be used when showing the next success word)</li> <li>The volume of <code>sounds[9]</code> (<code>Crosshair</code> sound) is saved, then temporarilly set to 0.0</li> <li>The <code>ACBeep</code> sound is played with a pitch of 0.9 + <code>combo</code> / 10.0 and a volume of 1.0 - 0.075 * <code>combo</code></li> <li>0.05 seconds are yielded</li> <li>The volume of <code>sounds[9]</code> (<code>Crosshair</code> sound) is restored</li> <li><code>caninputcooldown</code> is reset to 10.0 frames</li> </ul> </li> <li>If there's no more remaining crosshair, the command is succeeded by doing the following:<ul> <li>Both <code>commandsprites</code> are disabled</li> <li><code>commandsuccess</code> is set to true</li> <li>Break out of the <code>timer</code> loop early</li> </ul> </li> <li>If <code>caninputcooldown</code> hasn't expired yet, it is decreased by the game's frametime</li> <li><code>timer</code> is decreased by the game's frametime</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Action%20commands/Crosshairs/#after-timer-loop","title":"After <code>timer</code> loop","text":"<ul> <li><code>sounds[9]</code> is stopped (<code>Crosshair</code> sound)</li> <li><code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done)</li> <li>If <code>commandsuccess</code> is false (the command was failed), <code>commandsprites[1]</code>.color (the crosshair) is set to pure red. Otherwise (the command was succeeded), the <code>AtkSuccess</code> sound is played</li> <li>0.5 seconds are yielded</li> </ul>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/","title":"HoldKeyCountdown","text":"<p>A hold input prompt with a number of evenly separated timepoints. The goal of the command is to hold a certain input by the second timepoint and release it before the last timepoint ends. If the input isn't held by the second timepoint or it's released before the last timepoint begins or it's never released before the last timepoint ends, the command results in a failure. This command has forgiveness logic in <code>demomode</code> which makes it impossible to fail by guiding the player's input.</p>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#timer-usage","title":"<code>timer</code> usage","text":"<p>This is the amount of time in frames between each timepoints. -1.0 is not a supported value for this action command. This also doubles as the time window the player must be releasing the input on the last timepoint.</p>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: The amount of timepoints to use (including the last one). NOTE: This must be higher than 1 or a division by 0 exception will be thrown</li> <li><code>data[1]</code>: The <code>presskey</code> input value the player must be holding and releasing to succeed the command</li> </ul>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li><code>presskey</code> is set to <code>data[1]</code></li> <li><code>buttons</code> is set to a new array with one element being the ButtonSprite of a new GameObject named <code>Button</code> which has SetUp called on it with the following:<ul> <li>buttonid: <code>presskey</code></li> <li>onlytype: -1</li> <li>description: empty</li> <li>position: (-0.8, 1.0, 10.0)</li> <li>iconsise: (0.75, 0.75, 0.75)</li> <li>sortorder: 2</li> <li>parentobj: <code>GUICamera</code></li> </ul> </li> <li><code>commandsprites</code> is set to a new array with 1 + <code>data[0]</code> elements where the first one is the SpriteRenderer of a new UI object named <code>barholder</code> childed to the <code>GUICamera</code> with a local position of (-7.0, 1.0, 10.0), scale of Vector3.one using the <code>guisprites[62]</code> sprite (small bar container) with a sortorder of 0</li> <li>CreatePips(1) is called which initialises each elements of <code>commandsprites</code> after the first one (if any exists) to be the SpriteRenderer of a new UI object named <code>pointX</code> where <code>X</code> is the index of the element childed to <code>commandsprites[0]</code> with a local position of (x, 0.0, 0.0) where x is a lerp from 0.0 to 4.5 with a factor being the ratio of element's index - 1 over <code>commandsprites</code>.length - 2, scale of (0.5, 0.5, 1.0) (or Vector3.one if it's the last element) using the <code>guisprites[59]</code> (white circle) sprite (<code>guisprites[42]</code> (white hexagon) if it's the last element) with a sortorder of 1 + the element's index and a color of 7F7F7F (fully opaque gray)</li> </ul>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>This will first yield for 0.15 seconds and then do a loop from 0 to <code>data[0]</code> + 1. This means the loop will execute once for each timepoints and an additional one for counting the last one.</p> <p>The rest is what is contained in the loop.</p>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#preparations","title":"Preparations","text":"<ul> <li><code>timer</code> is reset to its initial value when DoCommand was called</li> <li>If this is the last loop iteration, <code>buttons[0]</code>.<code>basesprite</code>.color is set to pure white, otherewise, it's set to 7F7F7F (gray fully opaque)</li> </ul>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#timer-loop","title":"<code>timer</code> loop","text":"<p>There is an inner while loop that goes on while <code>timer</code> hasn't expired yet (decreased by the game's frametime followed by a frame yield on each iteration). The only thing this loop does is idle for all outer loop iterations, except the last one.</p> <p>On the last outer loop iteration, if by this point, <code>presskey</code> wasn't held, the inner loop will break on the next frame by setting <code>timer</code> to 0.0 (the next frame yield still goes through, but it ends prematurely after). This has the purpose to break out early in a success condition.</p>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#demomode-release-forgiveness","title":"<code>demomode</code> release forgiveness","text":"<p>Normally, if by the time the last iterations of the <code>timer</code> loop ends, the player is still holding <code>presskey</code>, the command is a fail. However, in <code>demomode</code>, there is a forgiveness feature where on the final outer loop iteration, all frames are yielded while <code>presskey</code> is held. This will idle infinetely until it is released which will result in success.</p>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#success-condition-checks","title":"Success condition checks","text":"<p>This is where the command checks if it is done or not and if it is, what result it should be. It proceeds like the following:</p> <ul> <li>If it's the last iteration and <code>presskey</code> is no longer held, this is a success which will do the following:<ul> <li><code>commandsuccess</code> is set to true</li> <li><code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done)</li> <li>0.3 seconds are yielded</li> </ul> </li> <li>Otherwise, if it's the second iteration or later (meaning between second and before last one) while <code>presskey</code> isn't held, this is a failure condition:<ul> <li>If on <code>demomode</code>, there is a forgiveness where the command will yield all frames until <code>presskey</code> is held</li> <li>Otherwise, <code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done) followed by an abrupt break of the outer loop</li> </ul> </li> </ul>"},{"location":"Battle%20system/Action%20commands/HoldKeyCountdown/#ui-updates","title":"UI updates","text":"<p>The final step of the loop is that the <code>commandsprite</code> whose index is this iteration's index + 1 will have its color changed to pure yellow followed by the <code>ACBeep</code> sound being played (or <code>ACReady</code> if it's the second to last iteration). This essentially gives the visual feedback of the different timepoints with a different one on the last one.</p>"},{"location":"Battle%20system/Action%20commands/LongRandomBar/","title":"LongRandomBar","text":"<p>A multi press input prompt spread over multiple timepoints as a cursor sweeps once through a bar containing the timepoints which are randomly generated. The goal of the command is to press Confirm while the cursor is close enough to the timepoint and hit as many as possible. A timepoint is not hit if no inputs was pressed or if the input was pressed while the cursor was too far off the timepoint. This command cannot be failed: it doesn't use <code>commandsuccess</code> for the outcome, but rather <code>successfullchain</code> which will report the amount of timepoints that was hit sucessfully.</p>"},{"location":"Battle%20system/Action%20commands/LongRandomBar/#timer-usage","title":"<code>timer</code> usage","text":"<p>The percentage of the full bar to advance the cursor on each frame. This must be higher than 0.0 and lower than 1.0 for the command to work correctly (-1.0 is not supported). A typical value the game uses for this is 0.01 meaning the bar sweep will last for 100.0 frames.</p>"},{"location":"Battle%20system/Action%20commands/LongRandomBar/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: The amount of timepoints to have on the bar after truncation to int. NOTE: This needs to be at least 1 for the command to work and it must not exceed 4 or it will become possible that 2 timepoints overlap. See the section below for details. Also, never put a decimal portion of the value of .5 or higher because it will lead to an exception being thrown</li> <li><code>data[1]</code>: Determines the first timepoint's minimum position. NOTE: This must be between 0.0 and 2.0625, otherwise, it's possible that the first timepoint overlap with another. See the section below for details</li> </ul>"},{"location":"Battle%20system/Action%20commands/LongRandomBar/#known-range-math-issues","title":"Known range math issues","text":"<p>The math done to calculate the range the timepoints will fall into is broken. It only works cumutively from left to right and the only guarantee the logic gives is that the first timepoint's max range is 2.0625 and the last timepoint's max range is 8.25 (the bar's entire range is from 0.0 to 8.55).</p> <p>Anything else is determined either by config or by harcoding based on the previous range:</p> <ul> <li>The first's min range is the value of <code>data[1]</code> which means it must not exceed 2.0625 in order to not have an overlap</li> <li>Each timepoints after the first one has a min range equal to the previous timepoint + 1.0</li> <li>Each timepoint from the second one to the second to last one has a max range of 8.25 / (<code>data[0]</code> - timepoint index)</li> </ul> <p>That second and third clauses creates problems when there are 5 or more timepoints because it now becomes possible that 2 timepoints overlap due to incorrect range math. At 4, it's still wrong, but by coincidence, the worst case only involves the second point having a reduced possible range, but it is guaranteed to not overlap. Overlapping is not handled well by the logic and will look visually erreneous.</p> <p>Therefore, it leads to the following recommendations to avoid overlaps:</p> <ul> <li><code>data[0]</code> must be lower than 4, but it also needs to be higher than 1 for relatively distributed ranges, and higher than 0 for the command to function in general (1 will have a single point at the start of the bar, but nor further than ~25% in).</li> <li><code>data[1]</code> must be between 0.0 and 2.0625</li> </ul>"},{"location":"Battle%20system/Action%20commands/LongRandomBar/#known-hexagon-ui-issue","title":"Known hexagon UI issue","text":"<p>Due to the game using hexagon shaped indicator for the timepoint, it becomes visually ambiguous the exact range of each timepoints. Visually, it was found with empirical testing that the range falls within the vertical rectangle of the hexagon and must not fall into the 2 small triangles on the left and right. The cursor should be touching any of the 2 shades of grey.</p>"},{"location":"Battle%20system/Action%20commands/LongRandomBar/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li><code>presskey</code> is set to 4</li> <li><code>successfulchain</code> is set to 0</li> <li><code>buttons</code> is set to a new array with one element being the ButtonSprite of a new GameObject named <code>Button</code> which has SetUp called on it with the following:<ul> <li>buttonid: <code>presskey</code></li> <li>onlytype: -1</li> <li>description: empty</li> <li>position: (-5.2, 2.35, 10.0)</li> <li>iconsise: (0.75, 0.75, 0.75)</li> <li>sortorder: 2</li> <li>parentobj: <code>GUICamera</code></li> </ul> </li> <li><code>commandsprites</code> is set to a new array with 3 + <code>data[0]</code> elements, here are the first 3 elements:<ul> <li>0: The SpriteRenderer of a new UI object named <code>barbottom</code> childed to the <code>GUICamera</code> with a local position of (-4.45, 2.4, 10.0), scale of Vector3.one using the <code>guisprites[81]</code> sprite (long bar UI container) with a sortorder of 0</li> <li>1: The SpriteRenderer of a new UI object named <code>barslide</code> childed to the <code>commandsprites[0]</code> with a local position of Vector3.zero, scale of (0.0, 1.0, 1.0) using the <code>guisprites[82]</code> sprite (white bar) with a sortorder of 1 and a color of pure yellow</li> <li>2: The SpriteRenderer of a new UI object named <code>cursor</code> childed to the <code>commandsprites[0]</code> with a local position of Vector3.zero, scale of (0.5, 0.5, 0.5) using the <code>cursorsprite[0]</code> sprite (the leaf UI cursor) with a sortorder of 20 and with angles of (180.0, 0.0, 90.0) (it points down)</li> </ul> </li> <li>internaldata is set to a new float array with length of <code>data[0]</code> (this local will contain the timepoints)</li> <li>For each internaldata elements:<ul> <li>The element is initialised to a random number between the previous one + 1.0 and 8.25 / <code>data[0]</code> - the index (if it's the first element, it's random between <code>data[1]</code> and 2.0625)</li> <li><code>commandsprites[3 + X]</code> (where <code>X</code> is the index) is initialised to be the SpriteRenderer of a new UI object named <code>Button</code> childed to the <code>commandsprites[0]</code> with a local position of (<code>internaldata[Y]</code>, 0.0, 0.1) where Y is the index, scale of (0.65, 0.65, 0.65) using the <code>guisprites[42]</code> sprite (white hexagon) with a sortorder of 2 + index and with a color of 7F7F7F (gray fully opaque)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Action%20commands/LongRandomBar/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>First, 0.35 seconds are yielded.</p> <p>From there, all the execution phase occurs in a while loop that goes on while the cursor is still sweeping the bar. How this is determined is a local float starting at 0.0 and growing by a fraction of the game's frametime every iterations until it reaches 1.0 where the loop ends. That faction is <code>timer</code>.</p> <p>Essentially, the local float reports the percentage of completion of the bar from 0.0 to 1.0 and if it reaches 1.0, the execution ends. This local will be referred as t.</p> <p>The current timepoint is tracked by a local int that starts at 0 and the amount of them by <code>data[0]</code> being rounded to int (not truncated).</p> <p>Here's what happens inside the loop:</p> <ul> <li><code>commandsprites[1]</code> (the bar) x scale is set to t. NOTE: This will put the bar so that it approximetly aligns with the cursor, but this is slightly off due to the different positioning schemes</li> <li><code>commandsprites[2]</code> local x position is set to t * 8.55 (this places the cursor alongside the actual point we are on the bar)</li> <li>The following happens as long as we didn't got past the last timepoint:<ul> <li>If t * 8.55 (the cursor position) is past the current timepoint + 1.0, the timepoint was not hit (that + 1..0 means there will be a slight delay between when the cursor goes too far and the time the game informs the player):<ul> <li><code>commandsprites[3 + timepoint index]</code>.color is set to pure red</li> <li>PlayBuzzer is called</li> <li>The current timepoint is advanced by incrementing it</li> </ul> </li> <li>If <code>presskey</code> is pressed without hold while we still haven't gotten past the last timepoint, what happens depends on the distance between the timepoint and t * 8.55 (the cursor's position). If it's less than 0.45, <code>successfullchain</code> is incremented and <code>commandsprites[3 + timepoint index]</code>.color is set to pure yellow. If it's more, it's set to red instead and PlayBuzzer is called instead of incrementing <code>successfullchain</code>. In other words, the input counts as a success if it was pressed close enough to the timepoint and failed otherwise</li> <li>The current timepoint is advanced by incrementing it</li> <li>The <code>ACBeep</code> sound is played (or <code>ACReady</code> if it was the last timepoint)</li> </ul> </li> <li>t is incremented by a fraction of the game's frametime (that fraction is <code>timer</code>)</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Action%20commands/MultiPressBar/","title":"MultiPressBar","text":"<p>An UNUSED and stripped down version of RandomPressBar where the cursor only does one sweep of the bar and it has reduced functionality.</p>"},{"location":"Battle%20system/Action%20commands/MultiPressBar/#timer-usage","title":"<code>timer</code> usage","text":"<p>This is the amount of frames that the cursor sweep will take. -1.0 is not supported for this command and will result in an immediate failure of the command.</p>"},{"location":"Battle%20system/Action%20commands/MultiPressBar/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: The same as RandomPressBar</li> <li><code>data[1]</code>: The same as RandomPressBar</li> <li><code>data[2]</code>: The same as RandomPressBar</li> <li><code>data[3]</code>: The fraction of the game's frametime to decrease <code>timer</code> by on each frame</li> </ul>"},{"location":"Battle%20system/Action%20commands/MultiPressBar/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<p>The same as RandomPressBar.</p>"},{"location":"Battle%20system/Action%20commands/MultiPressBar/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>Mostly the same as RandomPressBar, but with reduced functionality:</p> <ul> <li><code>timer</code> isn't doubled at the start of the execution phase</li> <li>There is no <code>Crosshair</code> sound played</li> <li>The cursor only goes from the left of the bar to the right and only once (the command is over when it reaches the rightmost spot)</li> <li>There is no <code>demomode</code> forgiveness: if the Confirm input is pressed while the cursor is outside the target, it's a failure. Additionally, if Confirm isn't pressed before <code>timer</code> expires, it won't restart the command</li> </ul>"},{"location":"Battle%20system/Action%20commands/PressKey/","title":"PressKey","text":"<p>An UNUSED and broken simple key press prompt. This command cannot be succeeded.</p> <p>NOTE: This action command's logic is broken and is UNUSED under normal gameplay, but the logic remains present</p>"},{"location":"Battle%20system/Action%20commands/PressKey/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: The input id to prompt a press for without hold</li> <li><code>data[1]</code>: If higher than 0.0, <code>commandsprites[0]</code> is disabled. This is optional, <code>commandsprites[0]</code> remains enabled if no value exists</li> </ul>"},{"location":"Battle%20system/Action%20commands/PressKey/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li><code>presskey</code> is set to <code>data[0]</code></li> <li><code>commandsprites</code> is set to a new SpriteRenderer array with one element being the SpriteRenderer of a new UI object named <code>Button</code> childed to the <code>GUICamera</code> with a local position of (-6.0, 1.4, 10.0), scale of (1.3, 1.3, 1.3) using the <code>guisprites[42]</code> sprite (white hexagon) with a sortorder of 20</li> <li>If <code>data[1]</code> exists and is higher than 0.0, <code>commandsprites[0]</code> is disabled</li> </ul>"},{"location":"Battle%20system/Action%20commands/PressKey/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>First, a local inputcooldown variable is initialsed to 0.0.</p> <p>From there, there the whole logic happens inside a while loop that terminates whenever <code>killinput</code> gets set to true which only happens when a result was decided (NOTE: this doesn't do anything in practice because a manual break is done in these cases anyway). This is what happens inside the loop:</p> <ul> <li>If <code>caninputcooldown</code> is above 0.0, <code>commandsprites[0]</code>.color is set to pure yellow or to BFBFBF (light gray) otherwise. NOTE: this field isn't initialised by then and it will most likely be 0.0 already</li> <li>If the key whose id is <code>presskey</code> is pressed (no hold), the input is only accepted if <code>caninputcooldown</code> is above 0.0 and the local inputcooldown is 0 or below. If this isn't respected, the input is rejected and instead, the local inputcooldown is set to 20.0. NOTE: since <code>caninputcooldown</code> can't get above 0.0 here, this means it is impossible to have the input process, but because it was the only way to succeed the command, it means it's impossible to succeed this command. If it was going to be accepted, the following would have happened:<ul> <li><code>doingaction</code> is set to false</li> <li><code>commandsuccess</code> is set to true</li> <li><code>caninputcooldown</code> is set to 0.0</li> <li>1 second is yielded</li> <li><code>killinput</code> is set to true</li> <li>The logic breaks out of the loop</li> </ul> </li> <li>Otherwise (<code>presskey</code> wasn't pressed without hold), if any keys are pressed (input -4), the command is failed by doing the following:<ul> <li><code>commandsuccess</code> is set to false</li> <li><code>killinput</code> is set to true</li> <li><code>doingaction</code> is set to false</li> <li><code>caninputcooldown</code> is set to 0.0</li> <li>1 second is yielded</li> <li>The logic breaks out of the loop</li> </ul> </li> <li>If the local inputcooldown is above 0.0, it is decreased by the game's frametime</li> <li><code>caninputcooldown</code> is decreased by the game's frametime. NOTE: this happens even if it is 0.0 or below</li> <li>A frame is yielded</li> </ul> <p>After the loop is done, <code>commandsprites[0]</code>.color is set to BFBFBF (light gray).</p>"},{"location":"Battle%20system/Action%20commands/PressKeyTimer/","title":"PressKeyTimer","text":"<p>An single input press prompt that lasts a certain amount of frames. The goal of the command is to press the correct input (and only the correct one) on the last 30.0 frames of the command. If no input is taken for the entire duration or if the input is pressed before the last 30.0 frames or if any other inputs recognised by the game is pressed at any point (even if done at the same time than the correct one), the command will be failed. This command has caveats about its UI.</p>"},{"location":"Battle%20system/Action%20commands/PressKeyTimer/#timer-usage","title":"<code>timer</code> usage","text":"<p>The amount of frames that the action command will last in total. No matter what value this is, the last 30.0 frames is the window where a press of the correct input will result in a success. This means that if <code>timer</code> is 30.0 or lower, every frames of the action commands will accept a correct input and succeed the command. -1.0 is not supported and will result in an immediate failure of the command.</p>"},{"location":"Battle%20system/Action%20commands/PressKeyTimer/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: The input the player needs to press on the last 30.0 frames to succeed the command</li> </ul>"},{"location":"Battle%20system/Action%20commands/PressKeyTimer/#known-issues-with-the-ui-indicators","title":"Known issues with the UI indicators","text":"<p>There are 2 visual feedbacks that this command provides to assist the player with the timing window:</p> <ul> <li>The input glyph becomes white only during the last 30.0 frames. It remains gray otherwise</li> <li>There's an hexagon ring that progressively constricts itself around the yellow hexagon where the input glyph is located and it's supposed to line up with the yellow hexagon only during the last 30.0 frames</li> </ul> <p>While the input glyph color is always correct and can be relied upon to visualise the timing window, the same cannot be said for the hexagon ring. It seems to only reliably works when the <code>timer</code> is 60.0, but anything higher or lower (which the game can do in practice) and it starts to show unexpected visuals. If it's lower, the ring will visually be quite far off from aligning with the yellow hexagon, but still consider inputs to be a success. If it's higher, the ring could be well within the yellow hexagon and still not count.</p> <p>This is due to the way the ring is scaled: it's done linearly over the initialtimer, but this isn't correct to do. The last 30.0 frames of a <code>timer</code> of 60.0 means it's 50% of the way while as for say 45.0, it's 33.33% of the way. This is therefore not something linear, but the game assumes it is which causes visual errors with the ring's timing alignement.</p> <p>It means that this command can only work visually when <code>timer</code> is 60.0. If it's not, the input glyph can still be used, but the ring can be missleading as it's not great to visually indicate the timing.</p>"},{"location":"Battle%20system/Action%20commands/PressKeyTimer/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li><code>presskey</code> is set to <code>data[0]</code></li> <li><code>commandsprites</code> is set to a new SpriteRenderer array with 2 elements:<ul> <li>0: The SpriteRenderer of a new UI object named <code>hexagon</code> childed to the <code>GUICamera</code> with a local position of (-5.5, 1.5, 10.0), scale of (1.5, 1.5, 1.5) using the <code>guisprites[42]</code> sprite (white hexagon) with a sortorder of 0 and a color of pure yellow</li> <li>1: The SpriteRenderer of a new UI object named <code>hexagon outline</code> childed to the <code>commandsprites[0]</code> with a local position of Vector3.zero, scale of (2.0, 2.0, 2.0) using the <code>guisprites[80]</code> sprite (a white hexagon ring) with a sortorder of 1</li> </ul> </li> <li><code>buttons</code> is set to a new array with one element being the ButtonSprite of a new GameObject named <code>Button</code> which has SetUp called on it with the following:<ul> <li>buttonid: <code>presskey</code></li> <li>onlytype: -1</li> <li>description: empty</li> <li>position: (0.0, 0.0, 0.0)</li> <li>iconsise: (0.75, 0.75, 0.75)</li> <li>sortorder: 5</li> <li>parentobj: <code>commandsprites[0]</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Action%20commands/PressKeyTimer/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>All the logic in this command occurs in a while loop that goes on as long as <code>timer</code> hasn't expired yet:</p> <ul> <li><code>commandsprites[1]</code> (the hexagon ring) scale is set to a lerp from 2.0 * Vector3.one to Vector3.one with a factor of 1.0 - <code>timer</code> / initialtimer - 0.1. NOTE: This is incorrect, see the section above about the known visual issues to learn more</li> <li><code>buttons[0]</code>.<code>basesprite</code>.color (the input glyph's color) is set to 7F7F7F (gray) unless <code>timer</code> is less than 30.0 in which case, it's set to pure white</li> <li>As long as no incorrect inputs was pressed:<ul> <li>If the correct input is pressed without hold, <code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done). After, one of 2 scenarios is possible (for either, a yield of 0.5 seconds occur after):<ul> <li>If <code>timer</code> has more than 30.0 frames left (the input was hit too early) or another input was pressed alongside the correct one, the command is failed by calling PlayBuzzer followed by setting <code>commandsprites[0]</code>.color (the hexagon) to pure red</li> <li>Otheriwse, the command is succeeded by playing the <code>Ding2</code> sound followed by setting <code>commandsuccess</code> to true and setting <code>commandsprites[0]</code>.color (the hexagon) to pure green</li> </ul> </li> <li>Otherwise, if any of the inputs the game recognises was pressed without hold, the command is failed by doing the following (but it will still continue, it just will idle for the rest of the loop iterations):<ul> <li><code>commandsuccess</code> is set to false</li> <li>PlayBuzzer is called</li> <li><code>commandsprites[0]</code>.color (the hexagon) is set to pure red</li> </ul> </li> </ul> </li> <li><code>timer</code> is decreased by the game's frametime</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressBar/","title":"RandomPressBar","text":"<p>A prompt to press the Confirm input timed in such a way that a cursor who goes back and forth on a bar lands in a specific target area. The goal of the command is to hit the input when the cursor falls in that area. The command is failed when the cursor falls outside of the target or if the input isn't pressed before <code>timer</code> expires. This command features forgiveness logic in <code>demomode</code> where it is impossible to fail the command.</p>"},{"location":"Battle%20system/Action%20commands/RandomPressBar/#timer-usage","title":"<code>timer</code> usage","text":"<p>This is the amount of frames allowed before considering the commmand a failure (not applicable in <code>demomode</code>) when <code>data[3]</code> is 2.0 (being higher or lower means that a \"frame\" takes more or less time). -1.0 is not supported for this command and will result in an immediate failure of the command.</p>"},{"location":"Battle%20system/Action%20commands/RandomPressBar/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: The lower bound of the starting bar target area in percentage (from 0.0 to 100.0)</li> <li><code>data[1]</code>: The upper bound of the starting bar target area in percentage (from 0.0 to 100.0)</li> <li><code>data[2]</code>: The length of the bar target area in percentage (from 0.0 to 100.0)</li> <li><code>data[3]</code>: The fraction of the game's frametime to decrease <code>timer</code> by on each frame. It also serve as a multiplier to how fast the cursor moves back and forth. An expected value for this is 2.0 because <code>timer</code> gets doubled which would compensate for this.</li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressBar/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li><code>presskey</code> is set to 4 (Confirm)</li> <li><code>buttons</code> is set to a new array with one element being the ButtonSprite of a new GameObject named <code>Button</code> which has SetUp called on it with the following:<ul> <li>buttonid: <code>presskey</code></li> <li>onlytype: -1</li> <li>description: empty</li> <li>position: (-0.8, 1.0, 10.0)</li> <li>iconsise: (0.75, 0.75, 0.75)</li> <li>sortorder: 2</li> <li>parentobj: <code>GUICamera</code></li> </ul> </li> <li>internaldata is set to a new array of 2 elements:<ul> <li>0: A random float between <code>data[0]</code> and <code>data[1]</code></li> <li>1: 0.0</li> </ul> </li> <li><code>commandsprites</code> is set to a new array with 4 elements:<ul> <li>0: The SpriteRenderer of a new UI object named <code>barbottom</code> childed to the <code>GUICamera</code> with a local position of (-7.0, 1.0, 10.0), scale of (5.0, 1.0, 1.0) using the <code>guisprites[58]</code> sprite (a white small bar) with a sortorder of 0 and a color of clear (all transparent black)</li> <li>1: The SpriteRenderer of a new UI object named <code>barmiddle</code> childed to the <code>commandsprites[0]</code> with a local position of (<code>internaldata[0]</code> / 100.0, 0.0, 0.0), scale of (<code>data[2]</code> / 100.0, 1.0, 1.0) using the <code>guisprites[58]</code> sprite (a white small bar) with a sortorder of 1 and a color of 60E275 (mostly clear green)</li> <li>2: The SpriteRenderer of a new UI object named <code>cursor</code> childed to the <code>commandsprites[0]</code> with a local position of (0.0, 0.25, 0.0), scale of (0.45, 0.1, 1.0) using the <code>cursorsprite[0]</code> sprite (the leaf cursor sprite) with a sortorder of 2 and with angles of (0.0, 0.0, 270.0) which rotates it such that it is pointing down</li> <li>3: The SpriteRenderer of a new UI object named <code>barholder</code> childed to the <code>GUICamera</code> with a local position of (-7.0, 1.0, 10.0), scale of Vector3.one using the <code>guisprites[62]</code> sprite (a small UI bar container) with a sortorder of 0</li> </ul> </li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressBar/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>This execution mostly occurs in a while loop with logic before and after.</p>"},{"location":"Battle%20system/Action%20commands/RandomPressBar/#before-timer-loop","title":"Before <code>timer</code> loop","text":"<ul> <li>0.35 seconds are yielded</li> <li>The <code>Crosshair</code> sound is played on <code>sounds[9]</code> with 0.9 pitch and 0.25 volume on loop</li> <li><code>timer</code> is doubled (this compensate for the expected value of 2.0 of <code>data[3]</code>)</li> <li>A temptimer local float is set to 0.0 which tracks where the cursor should fall into in relation to initialtimer</li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressBar/#timer-loop","title":"<code>timer</code> loop","text":"<p>This is a while loop that executes as long as <code>timer</code> hasn't expired yet:</p> <ul> <li><code>commandsprites[2]</code> (the cursor) local x position gets set to temptimer / initialtimer</li> <li>If <code>presskey</code> is pressed without hold, there are 3 possible scenarios (mutually exclusive, the first one applies):<ul> <li>If <code>commandsprites[2]</code> (the cursor) local x position * 100.0 is between internaldata[0] and internaldata[0] + <code>data[2]</code> (meaning it's in the target area), the command succeeds by doing the following:<ul> <li><code>commandsuccess</code> is set to true</li> <li><code>buttons[0]</code>.<code>basesprite</code>.color is set to 7F7F7F (gray fully opaque)</li> <li><code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done)</li> <li><code>sounds[9]</code> (the <code>Crosshair</code> sound) is stopped</li> <li>A second is yielded</li> <li>Break out of the loop</li> </ul> </li> <li>Otherwise, if we are in <code>demomode</code>, PlayBuzzer is called. This is the forgiveness feature because this would have normally failed the command</li> <li>Otherwise (the cursor is outside of the target while we aren't in <code>demomode</code>), the command is failed by doing the following:<ul> <li><code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done)</li> <li><code>sounds[9]</code> (the <code>Crosshair</code> sound) is stopped</li> <li>A second is yielded</li> <li>Break out of the loop</li> </ul> </li> </ul> </li> <li><code>timer</code> is decreased by a fraction of the game's frametime contained in <code>data[3]</code> (this is normally 2.0 which compensates from the fact its value was doubled earlier)</li> <li>temptimer is incremented by a fraction of the game's frametime. This fraction is <code>data[3]</code>, but if <code>timer</code> / initialtimer is 1.0 or lower (meaning the cursor is on the way back), the fraction is -1 * <code>data[3]</code> instead so it will decrease instead of increasing</li> <li>If we are in <code>demomode</code> while the <code>timer</code> expired, <code>timer</code> is reset to initialtimer * 2.0 and temptimer is reset to 0.0. This essentially restarts the command as if nothing happened without failing</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressBar/#after-timer-loop","title":"After <code>timer</code> loop","text":"<ul> <li><code>sounds[9]</code> (the <code>Crosshair</code> sound) is stopped</li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressKeyTimer/","title":"RandomPressKeyTimer","text":"<p>An input prompt of a concealed input that is only revealed after a certain amount of timepoints passes. The goal of the command is to press the input when it is revealed on the last timepoint within 45.0 frames. If any other game inputs (even those outside of the random pool) are pressed during those 45.0 frames or if multiple inputs are pressed at the same time than the correct one or if no inputs is pressed, the command is a failure.</p>"},{"location":"Battle%20system/Action%20commands/RandomPressKeyTimer/#timer-usage","title":"<code>timer</code> usage","text":"<p>This is the amount of frames between the timepoints with the exception of the last one which always takes 45.0 frames. -1.0 is not supported and will result in a failure of the command.</p>"},{"location":"Battle%20system/Action%20commands/RandomPressKeyTimer/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: Decides the sets of inputs in the random pool:<ul> <li>0.0: Random between 4 and 6 inclusive (Confirm, Cancel and Switch party)</li> <li>1.0: Random between 0 and 3 inclusive (only the 4 directional inputs)</li> <li>2.0: Random between 0 and 6 inclusive</li> </ul> </li> <li><code>data[1]</code>: The amount of timepoints to use including the last one. NOTE: This must be higher than 1 or an exception will be thrown</li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressKeyTimer/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li><code>presskey</code> is set to a value that depends on <code>data[0]</code> (check the <code>data</code> array section above for details)</li> <li><code>commandsprites</code> is set to a new array with 2 + <code>data[1]</code> elements where the first one is the SpriteRenderer of a new UI object named <code>barholder</code> childed to the <code>GUICamera</code> with a local position of (-7.0, 1.0, 10.0), scale of Vector3.one using the <code>guisprites[62]</code> sprite (UI bar container) with a sortorder of 0</li> <li>CreatePips(2) is called which initialises each elements of <code>commandsprites</code> after the second one (if any exists) to be the SpriteRenderer of a new UI object named <code>pointX</code> where <code>X</code> is the index of the element childed to <code>commandsprites[0]</code> with a local position of (x, 0.0, 0.0) where x is a lerp from 0.0 to 4.5 with the factor being the ratio of element's index - 2 over <code>commandsprites</code>.length - 3, scale of (0.5, 0.5, 1.0) (or Vector3.one if it's the last element) using the <code>guisprites[59]</code> sprite (a white cirlce) (or <code>guisprites[42]</code> (white hexagon) if it's the last element) with a sortorder of 1 + the element's index and a color of 7F7F7F (fully opaque gray)</li> <li>letters is set to a new array of one element childed to the last <code>commandsprites</code> which has the following initialisation:<ul> <li>SetFont is called on it with fontid 0 (<code>BubblegumSans</code>)</li> <li>text of <code>?</code></li> <li>local position of Vector3.zero</li> <li>scale of (0.1, 0.1, 1.0)</li> <li>layer of 5 (<code>UI</code>)</li> <li>anchor of <code>MiddleCenter</code></li> <li>MeshRenderer has a sortingOrder of 30</li> </ul> </li> <li><code>buttons</code> is set to a new array with one element being the ButtonSprite of a new GameObject named <code>Button</code> (disabled for now) which has SetUp called on it with the following:<ul> <li>buttonid: <code>presskey</code></li> <li>onlytype: -1</li> <li>description: empty</li> <li>position: (0.0, 0.0, 0.0)</li> <li>iconsise: (0.75, 0.75, 0.75)</li> <li>sortorder: 50</li> <li>parentobj: The last <code>commandsprites</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressKeyTimer/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>This begins by yielding for 0.15 seconds.</p> <p>From there, the entire execution is contained in a loop that runs for <code>data[1]</code> + 1 times. The loop is only exited when an outcome has been determined.</p>"},{"location":"Battle%20system/Action%20commands/RandomPressKeyTimer/#before-inner-timer-loop","title":"Before inner <code>timer</code> loop","text":"<ul> <li><code>timer</code> gets set to initialtimer</li> <li>If this is the last loop iteration, the input is revealed by doing the following:<ul> <li>The <code>ACReady</code> sound is played</li> <li><code>timer</code> gets set to 45.0</li> <li><code>buttons[0]</code> gets enabled (this reveals the input to press)</li> <li><code>letters[0]</code> (the <code>?</code>) gets destroyed if it's still present</li> </ul> </li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressKeyTimer/#inner-timer-loop","title":"Inner <code>timer</code> loop","text":"<p>Most of the core logic of the command occurs between 2 timepoints which is tracked by this inner loop. It goes on until <code>timer</code> expires.</p> <p>What happens here depends if it's the last outer iteration or not. If it's not, <code>timer</code> gets decreased by the game's frametime and a frame is yielded (this is basically just an idle loop).</p> <p>If it's the last outer iteration however, 3 possible things can happen (mutually exclusive, the first one happens per inner loop iteration):</p> <ul> <li>If <code>presskey</code> is pressed without hold and it is the only one pressed without hold, the commmand is a success:<ul> <li><code>commandsuccess</code> is set to true</li> <li><code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done)</li> <li>The command breaks out of the <code>timer</code> loop</li> </ul> </li> <li>Otherwise, if any of the game's recognised inputs is pressed except <code>presskey</code>, the command is a failure:<ul> <li><code>commandsuccess</code> is set to false</li> <li><code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done)</li> <li>The command breaks out of the <code>timer</code> loop</li> </ul> </li> <li>If neither of the above applies, this is just an idle iteration where <code>timer</code> is decreased by the game's frametime followed by a frame yield</li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomPressKeyTimer/#after-timer-loop","title":"After <code>timer</code> loop","text":"<p>The corresponding <code>commandsprites</code> of the current timepoint has its color set to pure yellow and if it's not the last iteration, the <code>ACBeep</code> sound is played.</p>"},{"location":"Battle%20system/Action%20commands/RandomTappingBar/","title":"RandomTappingBar","text":"<p>A variation of TappingKey where the mashing input prompt has a random starting one between Confirm, Cancel or Switch Party (it is not possible to use left/right mode). The input will change to a random one periodically at random intervals. This action command is UNUSED under normal gameplay.</p> <p>NOTE: This action command will be overriden to SequentialKeys if MainManager.<code>mashcommandalt</code> is true (the game settings are configured for Sequential Keys commands instead of the mashing ones). It will have a <code>data</code> of {6.0, 1.0} meaning a series of 6 inputs where all future inputs are hidden</p> <p>NOTE: This action command exceptionally sets <code>overridechallengeblock</code> to true which allows regular blocks to be processed in DoDamage when FRAMEONE is active. This only happens if the action command was not overriden to SequentialKeys.</p>"},{"location":"Battle%20system/Action%20commands/RandomTappingBar/#timer-usage","title":"<code>timer</code> usage","text":"<p>Same as TappingKey.</p>"},{"location":"Battle%20system/Action%20commands/RandomTappingBar/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: This does nothing, but its value must be present or an exception will be thrown</li> <li><code>data[1]</code>: Same as TappingKey</li> <li><code>data[2]</code>: Same as TappingKey</li> <li><code>data[3]</code>: Same as TappingKey</li> </ul>"},{"location":"Battle%20system/Action%20commands/RandomTappingBar/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<p>The same as TappingKey, but <code>presskey</code>'s initial value is random between 4 and 6 inclusive instead of being the value of <code>data[0]</code>.</p>"},{"location":"Battle%20system/Action%20commands/RandomTappingBar/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>The same as TappingKey, but <code>presskey</code> now changes to a random value between 4 and 6 inclusive at random interval.</p> <p>The interval is tracked by a local variable called keytimer which has a starting value being a random number between 70.0 and 100.0 inclusive. It is decreased by the game's frametime each frame of the while loop. When it expires:</p> <ul> <li><code>presskey</code> changes to a random value between 4 and 6 (the input becomes Confirm, Cancel or Switch Party)</li> <li>All the <code>buttons</code> have their enablement updated so only the <code>presskey</code> one is enabled and the rest disabled</li> <li>keytimer is set to be a random number between 70.0 and 150.0 inclusive</li> </ul> <p>Other than this, no other changes are done to the logic.</p>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/","title":"SequentialKeys","text":"<p>A series of simple random input prompts that have to be pressed in sequence in a row. The goal of the command is to press all inputs in the sequence correctly in a row under a certain amount of time. If too much time passes without completing all inputs or if the wrong input is pressed, the command is a failure. This command supports 2 optional features: the ability to make it go on infinetely until success and a feature that hides future inputs until all previous ones are entered correctly.</p>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#infinitecommand-feature","title":"<code>infinitecommand</code> feature","text":"<p>This is the only action command to support the <code>infinitecommand</code> feature. DoAction resets this field to false when called, but an action can set it to true to opt in to the infinite feature. This allows the command to never end until it is succeeded meaning it will restart if it is failed. NOTE: This feature doesn't work correctly if the command is configured to hide future inputs because it will not reset their visibility if the command is failed.</p>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#timer-usage","title":"<code>timer</code> usage","text":"<p>The amount of frames of the total time allowed to enter all the inputs before the command is failed. -1.0 is not supported and it will result in the immediate failure of the command (or a softlock if <code>infinitecommand</code> is true).</p>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: The amount of inputs that must be pressed correctly in a row for the command to be succeeded</li> <li><code>data[1]</code>: This value does nothing, but its existance allows to opt-in to a feature where all the inputs except the first one are hidden and the next one will get revealed as correct inputs are entered. This feature is optional: to opt out of it, <code>data[1]</code> must not exist</li> </ul>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#odd-results-output","title":"Odd results output","text":"<p>This command changes 3 results fields, but 2 of them are unexpected:</p> <ul> <li><code>commandsuccess</code>: Reports success or failure as usual, nothing unexpected</li> <li><code>combo</code>: Reports the amount of inputs correctly pressed in a row. Resets to 0 each failure of an <code>infinitecommand</code>. While this field is normally used for ShowSuccessWord, its value will get written to by this command</li> <li><code>barfill</code>: Reports 1.0 on success. On failure, it reports an unexpected value being a value lerped from 0.0 to 1.0 with a factor being the last input index correctly pressed / 6.0</li> </ul>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li><code>overridechallengeblock</code> is set to true</li> <li>The <code>Barfill</code> sound is played on <code>sounds[9]</code> with a volume of 0.5 on loop</li> <li><code>commandsprites</code> is set to a new array with 3 + ((int)<code>data[0]</code> - 1) elements (or just 3 if <code>data</code> has only 1 element), here are the first 3 elements:<ul> <li>0: The SpriteRenderer of a new UI object named <code>barbottom</code> childed to the <code>GUICamera</code> with a local position of (-7.0, 1.0, 10.0), scale of Vector3.one using the <code>guisprites[62]</code> sprite (small UI bar container) with a sortorder of 0</li> <li>1: The SpriteRenderer of a new UI object named <code>bar</code> childed to the <code>commandsprites[2]</code> (it was created before this one) with a local position of Vector3.zero, scale of Vector3.one using the <code>guisprites[58]</code> sprite (white bar) with a sortorder of 10 and a color of pure yellow</li> <li>2: The SpriteRenderer of a new UI object named <code>barbottomsmall</code> childed to the <code>commandsprites[0]</code> with a local position of (2.0, 1.0, -0.1), scale of (2.0, 1.0, 1.0) using the <code>guisprites[64]</code> sprite (small red bar) with a sortorder of 2</li> </ul> </li> <li>intdata is set to a new array with length being <code>data[0]</code> where each elements is set to be a random number between 0 and 6 inclusive</li> <li><code>buttons</code> is set to a new array with length <code>data[0]</code> where each is initialised to the ButtonSprite of a new GameObject named <code>ButtonX</code> where <code>X</code> is the index, <code>shrunkkey</code> set to true if the matching intdata is a LongButton (left unchanged otherwise) and it has SetUp called on it with the following:<ul> <li>buttonid: The matching intdata element</li> <li>onlytype: -1</li> <li>description: empty</li> <li>position: (x, y, 0.8) where:<ul> <li>x is a lerp between 0.0 - offset to 5.0 + offset with a factor of 1.0 / (<code>data[0]</code> - 1.0) * index. offset is 0.0 unless one of the intdata is a LongButton where it's 0.45</li> <li>y is 0.0 unless it is the first <code>buttons</code> or <code>data</code> has exactly 1 element where the value is 999.0 instead</li> </ul> </li> <li>iconsise: (0.65, 0.65, 0.65)</li> <li>sortorder: 2</li> <li>parentobj: <code>commandsprites[0]</code></li> </ul> </li> <li>If <code>data</code> has more than 1 element,  every <code>commandsprites</code> with an index of 3 or higher are initialised to the SpriteRenderer of a new UI object named <code>q</code> childed to the <code>commandsprites[0]</code> with a local position of (x, 0.0, 8.0) where x is a lerp from 0.0 to 5.0 with a factor of 1.0 / (<code>data[0]</code> - 1.0) * (index - 2), scale of (0.75, 0.75, 0.75) using the <code>guisprites[171]</code> sprite (a question mark sprite) with a sortorder of 10</li> <li><code>presskey</code> is set to <code>intdata[0]</code></li> </ul>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>The entire execution phase is enclosed in a while(true) loop with the exception that after the loop is done, <code>sounds[9]</code> (<code>Barfill</code> sound) is stopped.</p> <p>There are 3 parts inside this loop: setup, <code>timer</code> loop and reset.</p>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#setup","title":"Setup","text":"<ul> <li>The index of the current input index is tracked by a local int starting at 0</li> <li><code>combo</code> is set to 0</li> <li>A frame is yielded</li> <li>All <code>buttons</code> except the first one has their <code>basesprite</code>.color set to gray</li> </ul>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#timer-loop","title":"<code>timer</code> loop","text":"<ul> <li><code>sounds[9]</code> (<code>Barfill</code> sound)'s pitch is set to 0.5 + (1.0 - <code>timer</code> / initialtimer) clamped from 1.0 to 1.5 (the pitch gets higher as <code>timer</code> goes down)</li> <li><code>commandsprites[1]</code> (the decreasing bar)'s x scale is set to <code>timer</code> / initialtime</li> <li>If the current input (tracked in <code>intdata</code>) is pressed without hold, the current input is advanced by doing the following:<ul> <li>The corresponding <code>buttons</code> of the current input's <code>basecolor</code>.color is set to pure green</li> <li>If <code>data[1]</code> exists (future inputs were hidden) and we aren't on the last input:<ul> <li>The next <code>buttons</code>'s input's local position is set to the corresponding <code>commandsprites</code> one (which has a question mark sprite)</li> <li>The corresponding <code>commandsprites</code> (question mark sprite) is disabled</li> </ul> </li> <li>The current input index is incremented</li> <li><code>combo</code> is incremented</li> <li><code>barfill</code> is set to a lerp from 0.0 to 1.0 with a factor of the current input index / 6.0</li> <li>A sound is played depending on the new input index:<ul> <li>If it's not the last one, the <code>ACBeep</code> sound is played at a pitch of 1.0 + 0.1 * current input index (the pitch gets higher the later the input is)</li> <li>If it's the last one, the <code>ACReady</code> sound is played at 1.0 pitch</li> </ul> </li> <li>If the new input index isn't the last one, the corresponding <code>buttons</code> of the current input's <code>basecolor</code>.color is set to pure white</li> </ul> </li> <li>Otherwise, if any inputs the game recognises is pressed without hold, the command is failed by doing the following:<ul> <li>The corresponding <code>buttons</code> of the current input's <code>basecolor</code>.color is set to pure red</li> <li><code>commandsuccess</code> is set to false</li> <li>PlayBuzzer is called</li> <li>If it's not an infinite command:<ul> <li><code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done)</li> <li><code>sounds[9]</code> (<code>Barfill</code> sound) is stopped</li> </ul> </li> <li>0.5 seconds are yielded</li> <li>We break out of the <code>timer</code> loop (this will break out of the outer loop too if it's not an <code>infinitecommand</code>)</li> </ul> </li> <li>If we are past the last input in intdata, the command is succeeded by doing the following:<ul> <li><code>commandsuccess</code> is set to true</li> <li><code>doingaction</code> is set to false (this will be interpreted as DoCommand being done, but it isn't technically done. This however shouldn't matter in practice because the rest of the coroutine is just cleanup so it is logically done)</li> <li><code>inifinitecommand</code> is reset to false</li> <li><code>barfill</code> is set to 1.0</li> <li><code>sounds[9]</code> (<code>Barfill</code> sound) is stopped</li> <li>0.5 seconds are yielded</li> <li>We break out of the <code>timer</code> loop (this will also break out of the outer loop because of <code>commandsuccess</code> being true)</li> </ul> </li> <li><code>timer</code> is decreased by the game's frametime</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Action%20commands/SequentialKeys/#reset","title":"Reset","text":"<p>If we reach this point, it means an outcome was determined and if it is a success by <code>commandsuccess</code> being true, then we break out of the loop and the action command is done.</p> <p>If it was a fail, then it depends on <code>infinitecommand</code>: if it's false, then we break out of the loop early, but if it's true, a new iteration of the loop is prepared by doing the following because the command will continue infinetely as long as it isn't succeeded:</p> <ul> <li><code>timer</code> is reset to initialtimer</li> <li><code>barfill</code> is reset to 0.0</li> <li><code>buttons[0].basesprite</code>.color is set reset to pure white</li> </ul>"},{"location":"Battle%20system/Action%20commands/TappingKey/","title":"TappingKey","text":"<p>An input mashing prompt where the input can be one of the 4 main ones (Confirm, Cancel, Switch Party or Show HUD) or be a prompt where the player needs to alternate between the left and right input (with caveats, see the sections below for details). Each correct input press increases <code>barfill</code> from 0.0 to 1.0. The goal of the command is to make <code>barfill</code> reach 1.0 before the <code>timer</code> expires.</p> <p>NOTE: This action command will be overriden to SequentialKeys if MainManager.<code>mashcommandalt</code> is true (the game settings are configured for Sequential Keys commands instead of the mashing ones). If <code>data[9]</code> exists, the SequentialKeys command will have a <code>data</code> of {<code>data[9]</code>} which allows to configure the number of inputs (without hiding the future inputs) in case of override. If <code>data[9]</code> doesn't exist, the command will have a <code>data</code> of {6.0} meaning a series of 6 inputs without hiding the future inputs.</p> <p>NOTE: This action command exceptionally sets <code>overridechallengeblock</code> to true which allows regular blocks to be processed in DoDamage when FRAMEONE is active. This only happens if the action command was not overriden to SequentialKeys.</p>"},{"location":"Battle%20system/Action%20commands/TappingKey/#timer-usage","title":"<code>timer</code> usage","text":"<p>This represents the amount of frames to give to the player before the command fails. A value of -1.0 means inifnite time where it is not possible to fail the command.</p>"},{"location":"Battle%20system/Action%20commands/TappingKey/#data-array","title":"<code>data</code> array","text":"<ul> <li><code>data[0]</code>: If after being truncated to int, it's -1, this is a left/right input mashing prompt. If it's between 0 and 3 inclusive after truncating to int, it's an input mashing prompt whose id corresponds to the value + 4. NOTE: any value of 4.0 or above is considered invalid and will cause an exception to be thrown. This is because only the 4 face buttons inputs (confirm, cancel, switch and show HUD) are supported which have ids from 4 to 7</li> <li><code>data[1]</code>: A multiplier that controls how much <code>barfill</code> is incremented each correct input press. It changes the fraction of the game's frametime to use in the calculation formula meaning 1.0 will use the game's frametime directly. Additionally, if <code>data[0]</code> is not -1 after being truncated to int, <code>data[2]</code> will effectively be clamped from 0.005 to 0.0025 * <code>data[1]</code> when calculating the decrease of <code>barfill</code> every frame. The specific increase formula of <code>barfill</code> on a correct input press depends on the game's settings:<ul> <li>With VSync off and the framerate set to 60 FPS, 1.0 means <code>barfill</code> increases by the game's frametime / 80.0</li> <li>With VSync off and the framerate set to 30 FPS, 1.0 means <code>barfill</code> increases by the game's frametime / 40.0</li> <li>With Vsync on, 1.0 means <code>barfill</code> increases by the game's frametime / 80.0 * (The monitor's refresh rate / 60.0). NOTE: This implies that the monitor's refresh rate acts as a multiplier on top of <code>data[1]</code>'s value if VSync is on</li> </ul> </li> <li><code>data[2]</code>: If <code>data[0]</code> is not -1 after being truncated to int, <code>barfill</code> will decrease every frame by a fraction of the game's frametime equal to 0.005 * this value. However, when calculating the decrease, it will be clamped from 0.005 to 0.0025 * <code>data[1]</code>. If <code>data[0]</code> is -1 after being truncated to int, this does nothing</li> <li><code>data[3]</code>: This value does nothing, but its existence in the array is mandatory because if it is not present, it becomes impossible for the command to succeed, even if <code>barfill</code> reaches 1.0</li> <li><code>data[9]</code>: See the note above about the SequentialKeys override. This value only applies here and it does require to supply dummy values from <code>data[4]</code> through <code>data[8]</code> if its usage is desired, but it is optional and it won't apply if the override doesn't</li> </ul>"},{"location":"Battle%20system/Action%20commands/TappingKey/#high-level-explanation","title":"High level explanation","text":"<p>Since the logic of this action command is complex, a high level explanation is provided. For the details, check the setup and execution phase's details.</p> <p>There are 2 ways to operate this action command: either <code>data[0]</code> after being truncated to int is -1 or it isn't (but still lands between 0 and 3 inclusive). </p> <p>If it is -1, it's a left/right mashing prompt where <code>barfill</code> only increments when left and right are pressed one after the other. The rate of increment is controlled by <code>data[1]</code> (typical values used under normal gameplay are between 6.0 and 8.0). <code>data[2]</code> is unused in this mode, but still must exist because <code>data[3]</code> needs to exist in order for the command to function (otherwise, it's impossible to succeed the command).</p> <p>If it's between 0 and 3 inclusive, it's a single input mashing prompt where the input whose id is 4 + <code>data[0]</code> needs to be pressed in order for <code>barfill</code> to increase (same usage of <code>data[1]</code> here than in the left/right mashing prompt). However, this mode also makes <code>barfill</code> decrease at a rate controlled by <code>data[2]</code>, but that rate cannot exceed half of <code>data[1]</code>. Typical values are similar than <code>data[1]</code>'s values.</p> <p>Each mode features 2 <code>commandsprites</code>: one for the bar's container and one for the bar itself. The bar's x scaling will get adjusted depending on <code>barfill</code> which is itself clamped from 0.0 to 1.0 (0.0 being empty and 1.0 being fully filled). Additionally, as an additional audio feedback, as <code>barfill</code> gets higher, so does the pitch of a looping <code>Barfill</code> sound that will go from 1.0 to 2.0.</p> <p>To succeed the command (assuming <code>data[3]</code> exists), <code>barfill</code> must reach 1.0 before the timer sent expires or the command is failed. There is no timer if it is -1.0 meaning the command cannot be failed in such a situation.</p>"},{"location":"Battle%20system/Action%20commands/TappingKey/#leftright-mashing-prompt","title":"Left/right mashing prompt","text":"<p>This mode features:</p> <ul> <li><code>presskey</code> starting at 2 (left) and its value swaps between 2 (left) and 3 (right) whenever an input is accepted</li> <li>2 <code>buttons</code> which shows the left and right glyphs. They will periodically alternate between being white and gray every 8 frames, but this is only for visual indication purposes: it doesn't affect the logic in any way</li> </ul> <p>The way this works is the starting value of <code>presskey</code> is 2 (left) and it is the input that will always be accepted before moving on to the next one. In an ideal scenario, the player starts with left which increases <code>barfill</code> and causes <code>presskey</code> to become 3 (right) which the player can press and make <code>presskey</code> become 2 (left) again. This continues until the bar is filled or timer expires.</p> <p>However, the game allows for 1 input of tolerance as a grace input. It means for only a single time in a row, even if <code>presskey</code> is 2 (left), the game will accept up to 1 right input and even count it towards increasing <code>barfill</code>. The same happens for the reverse: if <code>presskey</code> is 3 (right), up to 1 left input is allowed. This can only be granted once in a row: once a grace input is taken, the game will no longer accept any inputs except the <code>presskey</code> one. This allows the player to completely skip one input, but still get back on track on the next one. It incidentally allows to double tap each input because the incorrect one is allowed each time.</p> <p>There are some caveats with this mashing prompt however:</p> <ul> <li>Due to the tolerance logic on keyboard, it is possible to press both left and right input at the same time every time and still have it registered because the game will prioritise the correct input, but will still allow the incorrect one once before the next correct input press</li> <li>Due to an issue with MainManager's call to InputIO on controllers, if the player manages to swap the left/rights input to be pressed/released within a frame (such as flicking a D-pad), the game will not register the new inputs even if the correct one is being pressed. This is because the mash prompt only accept non holding inputs and MainManager does not distinguish on controllers (not keyboards) between left or right being held. It only signals to the game that either is held or neither are which isn't sufficient for this. This can lead to frequent inputs drops.</li> </ul>"},{"location":"Battle%20system/Action%20commands/TappingKey/#single-input-mashing-prompt","title":"Single input mashing prompt","text":"<p>This mode features:</p> <ul> <li><code>presskey</code> starting stays at 4 + <code>data[0]</code> which is the input the prompt will be about and the only one that will be accepted to increase <code>barfill</code></li> <li>4 <code>buttons</code>, each corresponding to the Confirm, Cancel, Switch and Show HUD inputs glyphs. However, only the <code>presskey</code> one is enabled, the rest are disabled and thus, not shown. Each 3 frames, the <code>buttons</code> wll have their colors changed from gray to white and then back to gray, but this is only for visual indication purposes: it doesn't affect the logic in any way</li> </ul> <p>This is a simpler mode: only the <code>presskey</code> input is accepted, each increases <code>barfill</code>, but on every frames (even those where <code>presskey</code> isn't pressed), <code>barfill</code> gets decreased by a slower amount. The player needs to mash fast enough to fight the decrease and fill the bar.</p> <p>The only requirement for the input to be accepted is that it wasn't held meaning it is a fresh new press. It is however possible to bypass this restriction by alternating between a controller and a keyboard because their input holding are tracked separately.</p>"},{"location":"Battle%20system/Action%20commands/TappingKey/#docommand-setup-phase","title":"DoCommand Setup phase","text":"<ul> <li>The <code>Barfill</code> sound is played on <code>sounds[4]</code> at 0.7 volume on loop</li> <li><code>presskey</code> is set to <code>data[0]</code> (or to 2 if it was -1 meaning the left input is the starting one in left/right input prompt)</li> <li><code>buttons</code> is set to a new array of ButtonSrpites (length 2 if <code>data[0]</code> is -1, length 4 if it's not). Each are initialised to be a new GameObject named <code>ButtonX</code> where <code>X</code> is the index of the element. The GameObject is enabled if <code>data[0]</code> is -1 or if <code>data[0]</code> - 4 is the element's index (disabled otherwise). This means that if it's a left/right input prompt, both <code>buttons</code> are enabled, but if it's a face button input prompt, only the concerned one is left enabled with the others left disabled. Each GameObject will have a ButtonSprite attached with SetUp called with the following:<ul> <li>buttonid: if <code>data[0]</code> is -1, it's 2 + the element's index (meaning 2 or 3 which are the left/right inputs) and if it's not -1, it's 4 + the element's index (meaning from 4 to 7 which are the face buttons inputs)</li> <li>onlytype: -1</li> <li>description: empty</li> <li>position: (2.35, 1.5, 10.0)</li> <li>iconsise: (0.75, 0.75, 0.75)</li> <li>sortorder: 2</li> <li>parentobj: <code>GUICamera</code></li> </ul> </li> <li><code>commandsrpites</code> is set to a new array of 2 SpriteRenderer:<ul> <li><code>commandsprites[0]</code>: The SpriteRenderer of a new UI object named <code>barholder</code> childed to the <code>GUICamera</code> with a local position of (-7.0, 1.5, 10.0), scale of Vector3.one using the <code>guisprites[81]</code> sprite (an action command bar container) with a sortorder of 0</li> <li><code>commandsprites[1]</code>: The SpriteRenderer of a new UI object named <code>bar</code> childed to <code>commandsprites[0]</code> with a local position of Vector3.zero, scale of (0.0, 1.0, 1.0) using the <code>guisprites[82]</code> sprite (a white bar) with a sortorder of 1 and a color of pure yellow</li> </ul> </li> </ul>"},{"location":"Battle%20system/Action%20commands/TappingKey/#docommand-execution-phase","title":"DoCommand Execution phase","text":"<p>There's 3 parts: before the while loop, the while loop itself and after it.</p>"},{"location":"Battle%20system/Action%20commands/TappingKey/#pre-while-loop","title":"Pre while loop","text":"<ul> <li><code>overridechallengeblock</code> is set to true</li> <li>A local tolerance int is initialised to 1</li> <li>A local altbutton int is initialised to 3</li> </ul>"},{"location":"Battle%20system/Action%20commands/TappingKey/#while-loop","title":"While loop","text":"<p>This loop is the main execution of the command and it runs while timer is above 0.0 meaning there's still time left (or we are operating in infinite mode where this goes on until <code>barfill</code> is full).</p> <p>This is what happens inside the loop:</p> <ul> <li><code>sounds[4]</code>.pitch is set to <code>barfill</code> + 1.0 clamped from 1.0 to 2.0 (meaning the pitch / speed goes higher and faster as the bar gets filled until doubled pitch / speed)</li> <li><code>commandsprites[1]</code> x scale is set to a lerp from the existing one to <code>barfill</code> with a factor of 1/5 of the game's frametime (this visually aligns the bar to the <code>barfill</code> value smoothly)</li> <li>If the timer floored is divisible by 3 (or by 8 if <code>data[0]</code> is -1) and internaldata[0] is 0.0 or below:<ul> <li>The <code>buttons</code>'s <code>basesprite</code>.color is changed to pure white or 7F7F7F (gray) depending on conditions:<ul> <li>If <code>data[0]</code> is -1, <code>buttons[0]</code> and <code>buttons[1]</code> have each their color set to white or gray if the first one's <code>basesprite</code> isn't null. If the first one was gray, it becomes white with the other becoming gray and vice versa otherwise. Additionally, <code>buttons[1]</code> local position is set to (3.5, 1.5, 10.0)</li> <li>Otherwise, if <code>buttons[presskey - 4]</code>'s <code>basesprite</code> isn't null, its color gets set to white if it was grey or set to grey otherwise</li> </ul> </li> <li><code>internaldata[0]</code> is set to 3.0</li> </ul> </li> <li>If <code>presskey</code> is pressed without hold OR (the altbutton is while <code>data[0]</code> is -1 and tolerance is above 0):<ul> <li><code>barfill</code> is incremented by a fraction of the game's frametime. This fraction is <code>data[1]</code> / 80.0 * the framerate (or the refresh rate if MainManager.<code>vsync</code> isn't 0) / 60.0. NOTE: This vsync logic is incorrect: it essentially means the monitor's refresh rate acts as a speed multiplier where the higher it is and away from 60.0, the faster each press will fill the bar</li> <li>If <code>data[0]</code> is -1, then it depends if <code>presskey</code> was pressed or not. If it wasn't, tolerance is decremented. If it was, tolerance is set to 1 and both <code>presskey</code> and altbutton are set to flip flop between 2 or 3 (so if it was 2, it becomes 3 and vice versa)</li> </ul> </li> <li>If <code>data[0]</code> isn't -1, <code>barfill</code> is decremented by value that is a half of a fraction of the game's frametime. This fraction is <code>data[2]</code> clamped from 1.0 to <code>data[1]</code> / 2.0 and then the value is divided by 100.0</li> <li><code>barfill</code> is clamped from 0.0 to 1.0</li> <li>If <code>barfill</code> is at least 1.0 and <code>data</code> has more than 3 elements, the command succeed with the following:<ul> <li>The <code>ACReady</code> sound is played</li> <li><code>commandsuccess</code> is set to true</li> <li><code>commandsprite[1]</code>.color is set to pure green</li> <li><code>commandsprite[1]</code> scale is set to Vector3.one</li> <li>The logic exits out of the loop</li> </ul> </li> <li>internaldata[0] is decreased by the game's frametime</li> <li>timer is decreased by the game's frametime</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Action%20commands/TappingKey/#post-while-loop","title":"Post while loop","text":"<ul> <li><code>sounds[4]</code> is faded out by 1/10 of the game's frametime every frame</li> <li>All <code>buttons</code> elements are disabled</li> <li>0.35 seconds are yielded</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleData/","title":"BattleData","text":"<p>This is defined in MainManager, but it is primarily used for the battle system. It contains all the data associated with an actor, but it primarily augments an EntityControl which is stored in the battleentity field (or the entity field for the overworld version for player party members).</p> <p>Fields can be intended to be used for only player party members, only enemy party members or any actors depending on the specific field.</p>"},{"location":"Battle%20system/Actors%20states/BattleData/#player-party-members-fields","title":"Player party members fields","text":"<p>These fields only applies to player party members.</p>"},{"location":"Battle%20system/Actors%20states/BattleData/#addressing","title":"Addressing","text":"Name Type Description trueid int The animid of the player party member (learn more why this is equivalent to the <code>animid</code> in the playerdata addressing documentation)"},{"location":"Battle%20system/Actors%20states/BattleData/#stats","title":"Stats","text":"Name Type Description basehp int The max HP after applying all the <code>statbonus</code> from the initial one (this is initially 7 except for the <code>Beetle</code> animid where it's 9) hpt int The displayed HUD value of the <code>hp</code> baseatk int The attack after applying all the <code>statbonus</code> from the initial one (initially 2) basedef int The defense after applying all the <code>statbonus</code> from the initial one (initially 0)"},{"location":"Battle%20system/Actors%20states/BattleData/#abilities","title":"Abilities","text":"Name Type Description skills List The list of available skills, set to the return of RefreshSkills for this player party member lockskills bool If true, prevents skills to be used lockitems bool If true, prevents items to be used haspassed bool If true, this player party member has already relayed which prevents it to relay again lockrelayreceive bool If true, prevents to be relayed to from another player party member lockcantmove bool If true, prevents <code>cantmove</code> to be set to 0 (one action available) whenever the <code>MiracleMatter</code> medal triggers. It is set to false after the medal triggers didnothing bool Tells if the player party member already has chosen to do nothing on a previous action in the same main turn which prevents to benefits from some medals's effects"},{"location":"Battle%20system/Actors%20states/BattleData/#special-states","title":"Special states","text":"Name Type Description plating bool Tells if the <code>Plating</code> medal is equipped on this player party member and it is active eatenby EntityControl If not null, this player party member is trapped via eating by the entity corresponding to the value (this is only used when a <code>Pitcher</code> enemy eats a player party member and it not being null is treated the same as having an <code>hp</code> of 0 or below which is death)"},{"location":"Battle%20system/Actors%20states/BattleData/#enemy-party-members-fields","title":"Enemy party members fields","text":"<p>These fields only applies to enemy party members. Some of them are relayed to specific enemy features which are documented separately.</p>"},{"location":"Battle%20system/Actors%20states/BattleData/#core-state","title":"Core state","text":"Name Type Description weakness List&lt;AttackProperty&gt; The list of properties that applies on this enemy party member during the damage pipeline position BattlePosition The logical battle position frequently used to determine target availability delayedcondition List A list of conditions (only the <code>BattleCondition</code> part) added by the damage pipeline that will be inflicted later un DoAction"},{"location":"Battle%20system/Actors%20states/BattleData/#stats_1","title":"Stats","text":"Name Type Description hardatk int The attack gained when the hard dfficulty scaling applies (this is 0 if it doesn't)"},{"location":"Battle%20system/Actors%20states/BattleData/#rewards","title":"Rewards","text":"Name Type Description exp int The amount of EXP given when defeated (see the EXP documentation for details) fixedexp bool Tells if the exp field should not be scaled and is a fixed number (see the EXP documentation for details) money int The base amount of berries this enemy party member drops"},{"location":"Battle%20system/Actors%20states/BattleData/#action-features","title":"Action features","text":"Name Type Description moves int The amount of actions allowed per turn actimmobile bool When true, it allows the enemy party member to act even if they have a stopping condition. Check the feature documentation to learn more hitaction bool When set to true, the enemy party member will perform a hitation on the next controlled update flow onhitaction int If it's 1, hitaction will be set to true when hit. If it's 2, it will only if position is <code>Flying</code> and if it's 3, only if it's <code>Ground</code> chargeonotherenemy int[] The list of enemy ids that when hit, will cause this enemy to have its hitaction set to true"},{"location":"Battle%20system/Actors%20states/BattleData/#guard-feature","title":"Guard feature","text":"Name Type Description defenseonhit int The amount to increase the defense when isdefending is true isdefending bool Tells if the enemy party member is guarding which increases its effective defense by defenseonhit (It can also affect hitaction if it's -1, check the feature documentation to learn more)"},{"location":"Battle%20system/Actors%20states/BattleData/#conditional-eventdialogue","title":"Conditional EventDialogue","text":"Name Type Description eventondeath int The EventDialogue id to trigger during CheckDead when it detects that the enemy party member died. -1 means no EventDialogue will occur eventonfall int The EventDialogue to trigger when the enemy party member falls to the ground when sustaining damage (meaning Drop is called on the battleentity as a result of sustaining damage). -1 means no EventDialogue will occur"},{"location":"Battle%20system/Actors%20states/BattleData/#override-features","title":"Override features","text":"Name Type Description cantfall bool If true, the enemy party member cannot fall to the ground as a result of sustaining damage in CalculateBaseDamage lockposition bool Similar to cantfall for CalculateBaseDamage specifically, but it takes effect even if the enemy party member's position isn't <code>Flying</code> notaunt bool If true, the enemy party member cannot be inflicted by the Taunted condition from the player party (this doesn't remove the logic, see the documentation of the feature to learn more) notattle bool Tells if the enemy party member is not spy-able (this can be overriden to true, see the documentation about special fields logic for details)"},{"location":"Battle%20system/Actors%20states/BattleData/#death-behavior","title":"Death behavior","text":"Name Type Description fled bool If true, it indicates the enemy party member fled the battle which is seen the same way than if the <code>hp</code> reached 0 during CheckDead which means it's the same than dying, but with less logic involved to kill the enemy party member notired bool If true, the enemy party member will not cumulated any <code>tired</code> (meaning it can't gain exhaustion) whenever the <code>DoublePain</code> medal is not equipped. NOTE: This doesn't cover HARDEST correctly, see the EndEnemyTurn documentation to learn more deathtype int Dictates the manner in which the enemy party member dies diebyitself bool If true, it means the enemy party member will die if all of the ones left have this field set to true automatically when CheckDead detects this situation after it had killed any other enemy party members. This is done by setting the <code>hp</code> to 0 manually before running a second check on all enemy party members which will kill them alreadycounted bool Indicates to CheckDead that the enemy party member was already killed prior and therefore, shouldn't cause another increment of the bestiary entry's defeat counter the next time the enemy party member dies destroyentity bool If the enemy party member <code>fled</code> and this is true while the fleeing is found by CheckDead, the battleentity will be disabled as part of the killing process"},{"location":"Battle%20system/Actors%20states/BattleData/#size-calculation","title":"Size calculation","text":"Name Type Description size float The width used for calculating positioning in battle initialsize float The initial <code>size</code> value of the enemy party member. <code>size</code> will be set to this value when BreakIce is called on the battleentity sizeonfreeze float The size returned by GetEnemySize when the enemy party member has the Freeze condition instead of its <code>size</code>"},{"location":"Battle%20system/Actors%20states/BattleData/#visual-modifiers","title":"Visual modifiers","text":"Name Type Description hidehp bool Tells if its battleentity.<code>hpbar</code> should always be hidden even after spying weight float A visual modifier to apply when animating the enemy when it gets hurt by certain attacks"},{"location":"Battle%20system/Actors%20states/BattleData/#general-purpose","title":"General purpose","text":"Name Type Description data int[] General purpose data array for use in DoAction extrastuff Transform[] A general purspose transforms array for use in DoAction"},{"location":"Battle%20system/Actors%20states/BattleData/#visual-rendering","title":"Visual rendering","text":"Name Type Description battlepos Vector3 The resting battle position of the enemy party members used only in an EventDialogue entityname string The SetText string of its name"},{"location":"Battle%20system/Actors%20states/BattleData/#conditions-specific","title":"Conditions specific","text":"Name Type Description ate EntityControl The entity this enemy party member is trapping via eating (this is only used for the <code>Pitcher</code> enemy) frostbitep ParticleSystem An instance of <code>Prefabs/Particles/Snowflakes</code> childed to the battleentity that is initialised whenever the Freeze condition is added as a delayed condition"},{"location":"Battle%20system/Actors%20states/BattleData/#common-actor-fields","title":"Common actor fields","text":"<p>These fields applies to actors from either parties.</p>"},{"location":"Battle%20system/Actors%20states/BattleData/#entitycontrol","title":"EntityControl","text":"Name Type Description battleentity EntityControl The entity used during the battle entity EntityControl For a player party member, the overworld entity. For an enemy party member, the same than <code>battleentity</code>"},{"location":"Battle%20system/Actors%20states/BattleData/#identification","title":"Identification","text":"Name Type Description animid int For an enemy, the enemy id. For a player, the same as the <code>trueid</code> (learn more in the playerdata addressing documentation)"},{"location":"Battle%20system/Actors%20states/BattleData/#stats_2","title":"Stats","text":"Name Type Description hp int The HP, (for a player party member, this is clamped from 0 to <code>maxhp</code>) maxhp int The maximum amount of HP (for a player party member, this is <code>basehp</code> after all medal effects applied) atk int The attack (for a player party member, this is <code>baseatk</code> after all medal effects applied) def int The base defense (for a player party member, this is <code>basedef</code> after all medal effects applied)"},{"location":"Battle%20system/Actors%20states/BattleData/#actor-turn-tracking","title":"Actor turn tracking","text":"Name Type Description cantmove int The amount of actor turns that needs to pass until an action is possible. 0 Means one action is possible and anything negative further adds possible actions on the same main turn moreturnnextturn int When above 0, on the next main turn, the actor's <code>cantmove</code> will be decreased by it which gives it this amount of additional actor turns available"},{"location":"Battle%20system/Actors%20states/BattleData/#conditions-tracking","title":"Conditions tracking","text":"Name Type Description condition List The list of condition applied. Each element is an array of 2 elements, the first being the <code>BattleCondition</code> id and the second being the amount of actor turns it is in effect freezeres int The Freeze resistance poisonres int The Poison resistance numbres int The Numb resistance sleepres int The Sleep resistance isasleep bool Tells if the actor has a Sleep condition, updated at multiple places isnumb bool Tells if the actor has a Numb condition, updated at multiple places frozenlastturn bool Tells if the actor still had the Freeze condition after their last actor turn advance via AdvanceTurnEntity atkdownonloseatkup bool If true, the actor will get an AttackDown condition inflicted the next time an AttackUp condition runs out of main turns"},{"location":"Battle%20system/Actors%20states/BattleData/#damage-modifiers","title":"Damage modifiers","text":"Name Type Description tired int The amount of exhaustion cumulated which have an impact in CalculateBaseDamage charge int The amount of charges cumulated which have an impact in CalculateBaseDamage"},{"location":"Battle%20system/Actors%20states/BattleData/#item-holding","title":"Item holding","text":"Name Type Description holditem int The item id the actor is holding. Defaults to -1 which is no item held. For enemy party members, see the holditem feature documentation helditem SpriteRenderer The <code>sprite</code> of the item held by the actor whose id is <code>holditem</code> cursoroffset Vector3 The offset to apply to the cursor when selecting this actor itemoffset Vector3 The offset to render the item relative to the entity"},{"location":"Battle%20system/Actors%20states/BattleData/#alive-and-death-turn-tracking","title":"Alive and death turn tracking","text":"Name Type Description turnssincedeath int The amount of main turns since death, 0 if the actor is alive turnsalive int The amount of main turns since the battle started or their last death if any occured"},{"location":"Battle%20system/Actors%20states/BattleData/#miscellaneous","title":"Miscellaneous","text":"Name Type Description locktri bool If true, prevents relay to be used for a player party member. For an enemy party members, the meaning differs and depends on the specific enemy"},{"location":"Battle%20system/Actors%20states/BattleData/#unused-fields","title":"Unused fields","text":"<p>These fields are never referenced or never used in any meaningful ways.</p> Name Type Description tiredpart ParticleSystem UNUSED noblock bool UNUSED pointer int UNUSED, This field is maintained to be the same value as <code>partypointer</code>, but by indexing <code>playerdata</code> instead. This means that <code>playerdata[X].pointer</code> is the same than <code>partypointer[X]</code> where <code>X</code> is a valid <code>playerdata</code> index. In practice, this field is only written into making it unused turnsnodamage int UNUSED hardhp int UNUSED harddef int UNUSED lv int UNUSED id int UNUSED (only read from DoAction, but never written to so it stays at 0) noexpatstart bool UNUSED (intended for enemy party members only, only read during damage pipeline, but never written to so it always have the value false)"},{"location":"Battle%20system/Actors%20states/BattlePosition/","title":"BattlePosition","text":"<p>This is an enum that influences the ability for an enemy party member to be targetted in battle. It can be thought of as the logical position of the enemy party member.</p> <p>On BattleData, the position of the enemy party member is stored in the <code>position</code> field.</p> Value Name Description 0 Ground The enemy party member is grounded and a GetAvaliableTargets call with onlyground to true will include the target. This is also the position when the battleentity.<code>height</code> isn't above <code>minheight</code> + 0.5 1 Flying The enemy party member isn't grounded and a GetAvaliableTargets call with onlyground to true will exclude the target. This is also the position when the battleentity.<code>height</code> is above <code>minheight</code> + 0.5. Depending on many factors such as cantfall or having a topple weakness, the enemy party member may be subject to a Drop during CalculateBaseDamage 2 OutOfReach The enemy party member cannot be targeted and GetAvaliableTargets will always exclude it 3 Random A value only used during GetEnemyData where the position will get changed to <code>Ground</code> or <code>Flying</code> so this value is never used in battle, only during data loading 4 Underground The enemy party member is underground which imposes restrictions for the target to be included in GetAvaliableTargets and for using items"},{"location":"Battle%20system/Actors%20states/CenterPos/","title":"CenterPos","text":"<p>A method that returns an intuitive center position to render effects on an actor, but can also be used for logic involving the positions of actors.</p> <pre><code>private Vector3 CenterPos(MainManager.BattleData entity, bool world)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/CenterPos/#parameters","title":"Parameters","text":"<ul> <li><code>entity</code>: The actor to get the center position of</li> <li><code>world</code>: Whether or not to add <code>entity</code>.battleentity's position to the final result</li> </ul>"},{"location":"Battle%20system/Actors%20states/CenterPos/#procedure","title":"Procedure","text":"<ul> <li>If the actor's <code>position</code> is <code>Underground</code>, return Vector3.up with entity.battleentity's position added if world is true</li> <li>Otherwise, return entity.<code>cursoroffset</code> + (0.0, entity.battleentity.<code>height</code> - 1.0, 0.0) with entity.battleentity's position added if world is true</li> </ul>"},{"location":"Battle%20system/Actors%20states/CleanKill/","title":"CleanKill","text":"<p>This is a method that turns an enemy party member into a blank shell meaning they are thoroughly put out of commision, disappear and can no longer have effects on the battle, but may still remain in <code>enemydata</code> if <code>selfsacrifice</code> or <code>inevent</code> is true. It is meant to be used for enemy actions or EventDialogue.</p> <pre><code>private void CleanKill(ref MainManager.BattleData target, Vector3 startp)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/CleanKill/#parameters","title":"Parameters","text":"<ul> <li><code>target</code>: The actor to turn into a blank shell. NOTE: While it is possible to send a player party member, it is untested and doesn't seem to be useful for this</li> <li><code>startp</code>: The position to place the battleentity after killing them</li> </ul>"},{"location":"Battle%20system/Actors%20states/CleanKill/#high-level-explanation","title":"High level explanation","text":"<p>This method solves an edgecase where CheckDead's normal death routines would be undesired to kill an enemy party member during their action or during an EventDialogue. </p> <p>Normally, CheckDead looks at the enemy party member's deathtype to determine how to kill the enemy alongside the Death process at the entity level which looks at the <code>destroytype</code> (which is mapped from the <code>deathtype</code>). The problem is this enforces only one way to kill an enemy party member: it can be desired to simply have the enemy disappear instantly and to not have them be in the battle anymore.</p> <p>While it could be possible to kill them manually by calling Death on their battleentity, this gets complicated because this wouldn't actually remove the <code>enemydata</code> as this is done by a separate method: ReorganizeEnemies. CheckDead normally runs it so it could be possible to call Death on them and THEN run a CheckDead (who will skip the enemy party member because their <code>dead</code> field is now true) or a ReorganizeEnemies, but now a bigger problem emerges during DoAction: what if the enemy party member need to kill themselves in this fashion DURING their action?</p> <p>This is a very unsafe thing to do because there are several places in post action where the game assumes the enemy still exists. If a ReorganizeEnemies is ran during the action, the post action phase is now susceptible to incorrectly index <code>enemydata</code> because it would try to access an enemy party member that no longer exists! This can in the best case mess with the wrong enemy party member which can make the logic inconsistent or in the worst case, an exception being thrown leading to a stall since DoAction hasn't had the chance to set <code>action</code> to false leading the battle stuck perpetualy in an uncontrolled flow.</p> <p>This is where this method comes in: it will cleanly put an enemy party member out of commision, but allow the caller to not run a ReorganizeEnemies if they set <code>selfsacrifice</code> to true. Doing this also has an effect on the post action because it also prevents some logic to run which wouldn't make sense if the enemy decided to kill themselves. The overall effect is the <code>enemydata</code> elements is thoroughly killed, not even CheckDead will detect it because it was already killed. Crucially however, the <code>enemydata</code> element STILL EXISTS which allows the post action to not run into problems (and the logic remains consistent because it is reporting accurate information as the enemy just died very thoroughly by this method).</p> <p>However, ReorganizeEnemies still needs to eventually run because leaving the blank shell in causes a whole host of problem. Fortunately, this isn't an issue: CheckDead is guaranteed to run as one of the last step of the post action phase and it is late enough that the game can guarantee the safety since it no longer needs to access the enemy party member. CheckDead in this case will simply ignore the enemy as their <code>dead</code> field is true (so it doesn't kill them again) and it will also call ReorganizeEnemies as a normal part of its procedure which completely removes the blank shell.</p> <p>There is an exception to this: EventDialogue. ReorganizeEnemies won't run during those either due to <code>inevent</code> being true. This is acceptable because EventDialogue needs much more control over how they can kill enemy party members and they can anyway decide to call the method when needed. This is also why CheckDead also won't unconditionally call it when <code>inevent</code> is true: the EventDialogue can decide what happens to an enemy that just died as a result of their eventondeath triggering.</p> <p>NOTE: Under normal gameplay, ReorganizeEnemies is never called by this method. This is because it is always called during an EventDialogue or durin an enemy action to kill themselves after setting <code>selfsacrifice</code> to true.</p>"},{"location":"Battle%20system/Actors%20states/CleanKill/#procedure","title":"Procedure","text":"<p>The following happens on the target enemy party member:</p> <ul> <li>If <code>shadow</code> exists, it is disabled</li> <li>All <code>condition</code> are manually cleared</li> <li>ClearStatus is called on the enemy party member</li> <li>UpdateAnim is called</li> <li>DestroyConditionIcons is called on the enemy party member</li> <li>All <code>statusicons</code> are destroyed then the array is set to null</li> <li>deathtype set to 0</li> <li><code>destroytype</code> set to None</li> <li><code>sprite</code> gets disabled</li> <li><code>startscale</code> set to Vector3.zero</li> <li><code>exp</code> set to 0</li> <li><code>hp</code> set to 0</li> <li><code>money</code> set to 0</li> <li>position set to startp</li> <li><code>nocondition</code> set to true (prevents to render status icons)</li> <li>LockRigid is called to lock the <code>rigid</code> in place</li> <li><code>height</code> set to 999.0</li> <li>StartDeath called which sets <code>deathcoroutine</code> to a Death call on the enemy party member</li> </ul> <p>Finally, if <code>selfsacrifice</code> and <code>inevent</code> are both false (which effectively doesn't happen under normal gameplay), ReorganizeEnemies is called with order.</p>"},{"location":"Battle%20system/Actors%20states/Conditions/","title":"Conditions","text":"<p>A condition is a temporary effect applied for a limited amount of main turns on an actor. They are tracked in the actor's <code>condition</code> array.</p> <p>A <code>condition</code> element contains an int[] of 2 elements:</p> <ul> <li>0: The BattleCondition (in int form) representing the kind of effects this condition involves</li> <li>1: The amount of main turns left for the effects to apply. 0 and below values are technically allowed, but frequently causes the whole condition to be removed and they are not considered to be present in the actor</li> </ul> <p>It is considered invalid to have duplicate conditions in the list. An existing condition should be amended if it exist already instead of adding a new element to the list.</p> <p>Some conditions are tested for resistance before being added to <code>condition</code>. This usually involves the actor's resistance compared to a random number with immunity starting at a resistance of 100 and a certainty of infliction being 0 with everything in between being (100 - resistance) / 100 chance to inflict. The presence of this test, its methodology and its accuracy (not all have the correct odds) depends on the specific method used to add the condition.</p> <p>Conditions are used heavily throughout the battle system and even come with a set of utility methods to inflict / amend one, check the presence of one and remove one. Here are links to learn more about these methods:</p> <ul> <li>MainManager.SetCondition</li> <li>StatusEffect</li> <li>MainManager.HasCondition</li> <li>MainManager.RemoveCondition</li> <li>HealCondition</li> <li>ClearStatus</li> <li>TryConditions</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions/#battlecondition-table","title":"BattleCondition table","text":"<p>Here are the different BattleCondition that exists in the game and a summary of what they do (with links to further documentations):</p> ID Name Summary 0 Freeze A stopping condition that encases the actor in a block of ice. Most attacks will remove this condition and thaw out the ice, but with a +1 damage to the attack. It also allows the target to process a <code>FrostBite</code> medal when attacked 1 Poison A condition that either deals non lethal damage or heals the actor each main turn depending on if they have a <code>ReversePoison</code> medal or not. It also allows several poison specific medals to take effect 2 Numb A stopping condition that gives the actor a point of defense (with caveats, see CalculateBaseDamage documentation for details). It also allows the target to process a <code>ShockTrooper</code> medal which can bypass damage calculation 3 Sleep A stopping condition that will heal the attacker on each main turn and be removed on most attacks due to waking up (with caveats, see CalculateBaseDamage documentation for details). It also allows the target to process a <code>HeavySleeper</code> medal which can prevent waking up, halve the damage amount and heal for more per actor turn 4 AttackUp A condition that gives a +1 damage bonus on attacks by the actor while it is active when the AttackProperty isn't <code>NoExceptions</code> 5 DefenseUp A condition that gives a -1 damage on attacks to the actor as a point of defense recognised by TrueDef while the condition is active and property isn't <code>NoExceptions</code> NOTE: This has several caveats, check the CalculateBaseDamage documentation to learn more 6 AttackDown A condition that gives a -1 damage malus on attacks by the actor while it is active when the AttackProperty isn't <code>NoExceptions</code> 7 DefenseDown A condition that removes a point of defense recognised by TrueDef which can result in a +1 damage effects while it is active when the AttackProperty isn't <code>NoExceptions</code>. NOTE: This has several caveats, check the CalculateBaseDamage documentation to learn more 8 Topple A 1 hit defensive mechanism in the form of a condition for an enemy party member where if it has a <code>ToppleFirst</code> or <code>ToppleAirOnly</code> (if their <code>position</code> is <code>Flying</code>) weakness it won't get dropped or Flipped immediately when it was supposed to otherwise. Instead, this condition will be inflicted without the drop or flip featuring a <code>Woobly</code> animstate and it will be removed after most attacks which allows the drop or flip to occur on any subsequent hit 9 Flipped An ephemeral condition with optional stopping behaviours specific to enemy party members that is only inflicted with a <code>Flip</code> AttackProperty to an enemy party member with a <code>Flip</code> weakness. It causes all the enemy party member's <code>def</code> to be ignored during damage calculation which is recognised by TrueDef. This process can be hampered by Topple's defense mechanism if it applies. NOTE: The condition logic has caveats, check the CalculateBaseDamage documentation to learn more 10 Shield A condition that encases the actor in a shield by controlling its battleentity.<code>shieldenabled</code> which allows it to bypass damage calculation and not loose its <code>plating</code> 11 Taunted A condition that prevents a player party member from selecting the <code>Skill</code>, <code>Item</code> and <code>Relay</code> vine menu Actions and prevents other player party member from relaying to them 12 Sturdy A condition that prevents other conditions from being inflicted (even through using an item) while also getting a -3 damage effect applied in CalculateBaseDamage at the expense that the actor cannot be relayed to 13 GradualHP A condition that increases the actor's <code>hp</code> by 2 (clamped from 0 to <code>maxhp</code>) every main turn while active 14 GradualTP A condition that increases instance.<code>tp</code> by 2 (clamped from 0 to instance.<code>maxtp</code>) every main turn while active 15 Eaten A special stopping condition specific to the <code>Pitcher</code> enemy that allows through unorthodox methods to treat a player party member as if they were dead alongside having their <code>eatenby</code> not null 16 EventStop A stop condition specifically made for event 182 (trying to exit the room after approaching the tank in the last room of Upper Snakemouth) that simply disables a party member until it is manually removed (it is not meant to expire naturally) 17 Fire A condition that deals non lethal damage (more than Poison) every main turn while it is active that may be inflicted in CalculateBaseDamage if property is <code>Fire</code> (without a resistance field) featuring a <code>Prefabs/Particles/Flame</code> as a <code>firepart</code> 18 Inked A condition that prevents a player party member from using a skill that may be inflicted in CalculateBaseDamage if property is <code>Ink</code> or <code>InkOnBlock</code> (without a resistance field) featuring a <code>Prefabs/Particles/InkDrip</code> as a <code>firepart</code> 19 Sticky A condition that prevents a player party member from using an item that may be inflicted in CalculateBaseDamage if property is <code>Sticky</code> (without a resistance field) featuring a <code>Prefabs/Particles/StickyDrip</code> as a <code>firepart</code> 20 Reflection A condition that causes a player party member to sustain less damage from CalculateBaseDamage with the reduction amount being the amount of <code>Reflection</code> medal equipped. It always expire on the next main turn, but the turn counter is used to visually show the amount of the damage reduction"},{"location":"Battle%20system/Actors%20states/Delayed%20condition/","title":"Delayed condition","text":"<p>A delayed condition is a condition placed on an enemy party member that whose infliction attempt occurs during the post action phase of DoAction when the actionid isn't -555 (a dummy value to perform a blank call), it's an enemy action that didn't cause them to flee and it didn't cause them to kill themselves (<code>selfsacrifice</code> is false).</p> <p>NOTE: Only Freeze, Numb and Sleep are supported because they are the only ones that gets processed.</p> <p>The list of them is tracked in the <code>delayedcondition</code> field of the enemy party member and are ephemeral in nature: once processed, they are removed so they are only valid per action.</p>"},{"location":"Battle%20system/Actors%20states/Delayed%20condition/#adddelayedcondition","title":"AddDelayedCondition","text":"<p>Adding a delayed condition involves calling the AddDelayedCondition method.</p> <pre><code>private void AddDelayedCondition(int enid, MainManager.BattleCondition cond)\n</code></pre> <p>enid is the <code>enemydata</code> index and <code>cond</code> is the condition to add to the corresponding <code>delayedcondition</code> list. The method will ensure the list isn't null and if the condition didn't already exist (duplicates aren't allowed), it will be added.</p> <p>Specifically, if a Freeze condition is added via this method, the <code>frostbitep</code> of the enemy party member is initialised to be the ParticleSystem of a new instance of the <code>Prefabs/Particles/Snowflakes</code> prefab childed to the battleentity and with a local position of the enemy party member's non world CenterPos.</p>"},{"location":"Battle%20system/Actors%20states/Delayed%20condition/#delayed-conditionss-processing","title":"Delayed conditions's processing","text":"<p>As mentioned above, they are processed during the post action phase of DoAction for the enemy party member that was performing its action. Only Freeze, Numb and Sleep are supported.</p>"},{"location":"Battle%20system/Actors%20states/Delayed%20condition/#freeze-processing","title":"<code>Freeze</code> processing","text":"<ul> <li><code>frostbitep</code> position is set offscreen at (0.0, 999.0, 0.0)</li> <li><code>frostbitep</code> is destroyed in 3.0 seconds</li> <li>The rest depends on the <code>freezeres</code>:<ul> <li>If it's 100 or above (it's immune), the <code>IceShatter</code> particles are played at the enemy party member's world's CenterPos and the condition isn't inflicted</li> <li>Otherwise (it's not immune):<ul> <li>Freeze is called on the entity</li> <li><code>mothicenormal</code> particles are played without sound at the enemy party member's world's CenterPos with a scale of (1.5, 1.5, 1.5)</li> <li>SetCondition is called with the <code>Freeze</code> condition on the enemy party member for 3 turns</li> </ul> </li> </ul> </li> </ul>"},{"location":"Battle%20system/Actors%20states/Delayed%20condition/#numb-processing","title":"<code>Numb</code> processing","text":"<p>There's only logic if the <code>numbres</code> is below 100 (it's not immune). If it is:</p> <ul> <li>The <code>Numb</code> sound is played</li> <li>SetCondition is called with the <code>Numb</code> condition on the enemy party member for 2 turns</li> <li><code>isnumb</code> is set to true</li> </ul>"},{"location":"Battle%20system/Actors%20states/Delayed%20condition/#sleep-processing","title":"<code>Sleep</code> processing","text":"<p>There's only logic if the <code>sleepres</code> is below 100 (it's not immune). If it is:</p> <ul> <li>The <code>Sleep</code> sound is played</li> <li>DeathSmoke particles are played at the world's CenterPos of the enemy party member with a size of (2.0, 2.0, 2.0)</li> <li>SetCondition is called with the <code>Numb</code> condition on the enemy party member for 2 turns</li> <li><code>isasleep</code> is set to true</li> <li>battleentity.animstate is set to 14 (<code>Sleep</code>)</li> </ul>"},{"location":"Battle%20system/Actors%20states/Delayed%20projectile/","title":"Delayed projectile","text":"<p>A delayed projectile, also known as a delproj, is a projectile an enemy can launch, but that will only land on a player party member after a predetermined amount of main turns passed. The projecile will cause damage with an optional property attached. The visual and audio effects are all configurable.</p> <p>The delprojs currently scheduled are tracked by the <code>delprojs</code> field which is an array of <code>DelayedProjectileData</code>, a struct documented in the section below. The actual logic of the delprojs are defined in AdvanceMainTurn with their main turn advances done very early in the coroutine.</p>"},{"location":"Battle%20system/Actors%20states/Delayed%20projectile/#delayedprojectiledata","title":"DelayedProjectileData","text":"<p>This struct defines the entirety of a delproj, here are all the fields and their semantics:</p> Name Type Description turns int Amount of main turns left before the projectile lands damage int The amount of damage to deal to the target position int The player party member position to target areadamage int UNUSED framestep float The amount of frames to move the projectile before landing completely obj GameObject The projectile object deathparticle string A <code>Resources/prefabs/particles</code> name that will play when the projectile fully lands deathsound string A <code>Resources/audio/sounds</code> audio clip's name that will play when the projectile fully lands whilesound string A <code>Resources/audio/sounds</code> audio clip's name that will be play while the projectile is landing on loop. For the clip to play only once instead of looping, the name needs to be prepended by <code>@</code> args string <code>@</code> separated strings containing optional configurations, see the section below for details calledby MainManager.BattleData UNUSED property AttackProperty? The property of the damage dealt (null means no property applies)"},{"location":"Battle%20system/Actors%20states/Delayed%20projectile/#args-field","title":"<code>args</code> field","text":"<p>The <code>args</code> of the <code>DelayedProjectileData</code> are a list of commands which is <code>@</code> separated while each command is a list of string that is <code>,</code> separated.</p> <p>Each command's first element is the name of the command while every strings after are parameters. Here is a table that shows all the vailable commands, their parameters meaning if any and the overall effect of the commmand if applied:</p> Name Parameters Description partoff First 3 params are float forming a Vector3 Offsets the <code>deathparticle</code> position to play by the Vector3 in parameters relative to the <code>obj</code> position upon landing move First 3 params are float forming a Vector3 Offsets the position to land on by the Vector3 in parameters relative to the <code>partypos</code> of the delproj's <code>position</code> noshadow None Prevent a ShadowLite to be added to the delproj's <code>obj</code>"},{"location":"Battle%20system/Actors%20states/Delayed%20projectile/#delprojs-methods","title":"Delprojs methods","text":"<p>To manage delprojs, there are 2 methods that exists that allows to add or remove them:</p> <ul> <li>AddDelayedProjectile </li> <li>RemoveDelayedProjectile </li> </ul> <p>Both methods converts the array to list, performs the necessary modifications and then converts the list back to array and assigns it to <code>delprojs</code>.</p> <p>The sections below details the methods's signatures and parameters details.</p>"},{"location":"Battle%20system/Actors%20states/Delayed%20projectile/#adddelayedprojectile","title":"AddDelayedProjectile","text":"<p>Adds a delproj to <code>delprojs</code> with all the parameters needed to initialise one.</p> <pre><code>private void AddDelayedProjectile(GameObject obj, int targetpos, int damage, int turnstohit, int areadamage, AttackProperty? property, float framespeed, MainManager.BattleData summonedby, string hitsound, string hitparticle, string whilesound)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Delayed%20projectile/#parameters","title":"Parameters","text":"<p>Each parameters directly maps to a field in <code>DelayedProjectileData</code> of the delproj to add. Here is the mapping:</p> <ul> <li><code>obj</code>: <code>obj</code></li> <li><code>targetpos</code>: <code>position</code></li> <li><code>damage</code>: <code>damage</code></li> <li><code>turnstohit</code>: The value + 1 is mapped to <code>turns</code> (this is because the main turn that the projectile is fired is excluded from <code>turns</code> so the first AdvanceMainTurn will remove it after its launch and the enemy phase is done)</li> <li><code>areadamage</code>: <code>areadamage</code> (this field is UNUSED because it is never read)</li> <li><code>property</code>: <code>property</code></li> <li><code>framespeed</code>: <code>framestep</code></li> <li><code>summonedby</code>: <code>calledby</code> (this field is UNUSED because it is never read)</li> <li><code>hitsound</code>: <code>deathsound</code></li> <li><code>hitparticle</code>: <code>deathparticle</code></li> <li><code>whilesound</code>: <code>whilesound</code></li> </ul>"},{"location":"Battle%20system/Actors%20states/Delayed%20projectile/#removedelayedprojectile","title":"RemoveDelayedProjectile","text":"<p>Removes an existing delproj from <code>delprojs</code> by its array index.</p> <pre><code>private void RemoveDelayedProjectile(int arraypos)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Delayed%20projectile/#parameters_1","title":"Parameters","text":"<ul> <li><code>arraypos</code>: The <code>delprojs</code> array index to remove the delproj from the array</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/","title":"Enemy features","text":"<p>Certain enemies can opt in to some features by having some of their enemy data fields setup in a certain way or simply in their DoAction's action logic. There are enough features which are complex enough that they warrant their own explanations in a separate page. These features will be documented here.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#eventondeath","title":"<code>eventondeath</code>","text":"<p>This feature allows to trigger an EventDialogue when the enemy party member dies.</p> <p>If the value isn't -1 and the enemy party member was detected dead (without <code>flee</code>) by CheckDead while <code>inevent</code> is false (meaning an EventDialogue wasn't in progress already), an EventDialogue whose id is the <code>eventondeath</code> will be triggered.</p> <p>Note that this will intercept the normal death process that CheckDead normally does because it's possible that the EventDialogue wants to either not have the enemy party member dead or to handle the death in a custom manner.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#eventonfall","title":"<code>eventonfall</code>","text":"<p>This feature allows to trigger an EventDialogue when the enemy party member drops.</p> <p>When set to any non negative value, whenever CalculateBaseDamage detects that the enemy party memeber should be dropped, it won't do it as it would have normally. Instead, it will set <code>calleventnext</code> to <code>eventonfall</code> which has the effect that on the next CheckEvent, the EventDialogue whose id was <code>eventonfall</code> will be triggered.</p> <p>NOTE: This feature, while fully functional is UNUSED in practice. No actual enemy data entry has any non negative values.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#moves","title":"<code>moves</code>","text":"<p>The value of this field determines the base amount of actor turn an enemy is allowed to have per main turn.</p> <p>In more specific terms, it means that on the AdvanceTurnEntity of the enemy party member, unless there is a specific condition preventing this, the <code>cantmove</code> will be set to -<code>moves</code> + 1. It means having a laoded <code>moves</code> of 1 sets the <code>cantmove</code> to 0 every main turn and if the loaded <code>moves</code> is 2, it's set to -1 and so on. Intuitively, it's the always the amount of actor turns available per main turn.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#deathtype","title":"<code>deathtype</code>","text":"<p>This field tells the manner in which the enemy dies on their battleentity's Death. It maps to a DestroyType like so:</p> deathtype entity.destroytype 0 SpinSmoke (without <code>reservedata</code>) 1 SpinNoSmoke 2 KO 3 SpinSmoke (with <code>reservedata</code>) 4 KO 5 SpinKO 6 Shrink 7 ShrinkNoSmoke 8 None 9 Sink 10 ExplodeAnim 11 DropSprites 12 None (destroyed on the next main turn) <p>However, there are some special notes to add on some of them:</p> <ul> <li>2, 3, 4 and 5: These values supports the <code>reservedata</code> feature. This feature will have CheckDead kill the enemy normally, but it will also add the enemy party member to a special array called <code>reservedata</code>. This is done for 2 reasons: it prevents the enemy's object from being destroyed which allows them to still be rendered and it also allows them to be revived or accessed after their death</li> <li>2 and 4: These 2 are functionally equivalent and share the same logic</li> <li>12: This one is handled by DoDamage after sustaining lethal damage and it ends by setting the battleentity's tag to <code>DestroyTurn</code> which destroys it on the next AdvanceMainTurn. It is very specific to the following enemies:<ul> <li><code>KeyR</code></li> <li><code>KeyL</code></li> <li><code>Tablet</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#difficulty-scaling","title":"Difficulty scaling","text":"<p>This feature is documented extensively in the appropriate section of enemy data documentation because it involves a lot of loaded fields and some complex logic.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#exp","title":"EXP","text":"<p>This feature is documented extensively in the appropriate section of enemy data documentation because it involves a lot of loaded fields and some complex logic.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#holditem-and-helditem","title":"<code>holditem</code> and <code>helditem</code>","text":"<p>Enemy party members have the ability to hold an item. <code>holditem</code> holds its id and <code>helditem</code> holds its SpriteRenderer.</p> <p>This is primarily used for stealing items from the player party or for visually rendering them using an item. The item can be dropped by calling DropItem.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#hitaction","title":"<code>hitaction</code>","text":"<p>This field tells if an enemy wants to performa an action immediately on the next controlled flow update. These actions are performed out of the main turn flow because they are ran during the player phase. It's essentially a way for an enemy party member to temporarilly seize control of the turn flow to perform their action.</p> <p>During Update, all <code>enemydata</code> elements are checked if any has <code>hitaction</code> set to true. If none do, nothing happens. For each that does have it set to true, the following happens:</p> <ul> <li>If the enemy IsStopped returns true, their <code>hitaction</code> gets set to false and nothing happens as it gets skipped</li> <li>Otherwise, <code>enemy</code> is set to true and a DoAction call occur with the battleentity with actionid being the <code>enemydata</code> index. This will also end the update cycle</li> </ul> <p>Setting <code>enemy</code> to true here is temporary: it will go back to false as part of DoAction. DoAction is also responsible for setting the enemy's <code>hitaction</code> back to false. The overall effect is DoAction temporarily seize control of the battle flow, but for the game, it's as if we were in an enemy phase. The flow will go back to where it was in the player phase once it's handled. Due to <code>hitaction</code> being true, DoAction is able to handle this special case in a separate fashion.</p> <p>This cycle repeats for all applicable enemies untill all <code>hitaction</code> are set to false at which point, the main turn procedure can continue.</p> <p>There are 3 ways to automatically have <code>hitaction</code> set to true upon attack:</p> <ul> <li><code>onhitaction</code></li> <li><code>chargeonotherenemy</code></li> <li><code>isdefending</code> being -1</li> </ul> <p>Details are in the sub sections below.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#onhitaction","title":"<code>onhitaction</code>","text":"<p>There is a standard way to have <code>hitaction</code> set automatically when the enemy party member is targetted during DoDamage and it's done by the <code>onhitaction</code> field. The conditions required to set <code>hitaction</code> to true is that <code>enemy</code> is false (we are in the player phase) and something else that depends on the field's value:</p> <ul> <li>If it's 1, it's always fufilled</li> <li>If it's 2, it's only fufilled if target.position is <code>Flying</code></li> <li>If it's 3, it's only fufilled if target.position is <code>Ground</code></li> </ul> <p>This allows the <code>hitaction</code> to happen whenever the enemy party member is targetted while in any or in specific positions.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#chargeonotherenemy","title":"<code>chargeonotherenemy</code>","text":"<p>There is an alternative way to get <code>hitaction</code> set to true automatically during DoDamage, but it only applies for enemy party members other than the target. That way is the <code>chargeonotherenemy</code> array field which holds an array of Enemy ids.</p> <p>How it works is when the target sustains the damage, every other enemy party members who has the target.<code>animid</code> (their enemy id) in their <code>chargeonotherenemy</code> has their <code>hitaction</code> set to !<code>enemy</code> (false during the enemy phase, true during the player phase).</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#about-isdefending-being-1","title":"About <code>isdefending</code> being -1","text":"<p>There is a second way to automatically set <code>hitaction</code> to true when the enemy party member is targetted during DoDamage. That was is by having <code>isdefending</code> be -1 and the position of the enemy party member must not be <code>Underground</code>. If this applies, it will override <code>onhitaction</code> and take priority by always setting <code>hitaction</code> to true.</p> <p>In practice, only the <code>Underling</code> enemy does this, every other Enemy defined in the game would rather use <code>onhitaction</code> or <code>chargeonotherenemy</code>.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#defenseonhit-and-isdefending","title":"<code>defenseonhit</code> and <code>isdefending</code>","text":"<p>The value of this field has 3 modes of operations:</p> <ul> <li>-1: See the section above about <code>hitaction</code></li> <li>0: The enemy party member is opting out of the <code>hitaction</code> and the <code>isdefending</code> logic</li> <li>1 or above: No <code>hiaction</code> logic, but it will get the <code>isdefending</code> logic.</li> </ul> <p>As for the <code>isdefending</code>, it's where the enemy party member guards and it gain points of defenses during DefaultDamageCalc when piercing doesn't apply with the amount corresponding to the value and those defense points are recognised by TrueDef. They will apply when <code>isdefending</code> is true unless the enemy party member is Flipped. This also enables <code>isdefending</code>'s toggling during DoDamage (See the section below for more details). NOTE: There are several caveats with this, check the CalculateBaseDamage documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#isdefending","title":"<code>isdefending</code>","text":"<p>As for <code>isdefending</code>, it is a field that tells if the enemy party member is guarding. Its initial value is false set by StartBattle. </p> <p>Guarding is the only way to gain the <code>defenseonhit</code> points of defenses and the main way it's done is by DoDamage where the enemy party member is targeted. It's set to true if all of the following conditions are fufilled:</p> <ul> <li>property is't <code>Flip</code> (<code>Flip</code> prevents guarding)</li> <li>The final amount of damages calculated is above 0</li> <li>The enemy party member's IsStopped is false (if it's true, <code>isdefending</code> is set to false instead which breaks guard)</li> </ul> <p>It's also possible to manually guard from DoAction's action logic.</p> <p>The guarding is visually represented by having UpdateAnim set battleentity.<code>animstate</code> to 24 (<code>Block</code>) when applicable (see the method's documentation for the exact conditions required).</p> <p>However, it is possible to loose the guard in many ways which sets <code>isdefending</code> to false:</p> <ul> <li>SetCondition: When inflicting (or amending) a Freeze, Numb or Sleep condition</li> <li>CalculateBaseDamage: When hit with an attack that has a <code>Flip</code> property, guard is broken</li> <li>ClearStatus: Breaking guard is part of the procedure of this method</li> <li>DoAction: All enemy party members will break guard before their actions logic. It is of course possible to override this behavior inside the action logic itself</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#weight","title":"<code>weight</code>","text":"<p>This field is a way to modify the visual rendering of an enemy sustaining an attack. A low value will make them jump or launch more in the air while a high value will make them launch less or not at all. Its impact are purely visual.</p> <p>As a general rule, this should be between 0.0 and 100.0 where 100.0 won't launch at all and 0.0 will launch the furthest.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#sizeonfreeze","title":"<code>sizeonfreeze</code>","text":"<p>When the enemy party member has Freeze condition, GetEnemySize will return its <code>sizeonfreeze</code> instead of its <code>size</code> if the value is above 0.1. This is only used for visual effects and animations, but it allows to accounter for its battleentity.<code>icecube</code>.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#data","title":"<code>data</code>","text":"<p>This is a general purpose array mostly meant for DoAction's actions logic. Any enemy party member can use it to persist informations between their actions.</p> <p>The only place it is written to outside of DoAction is in CheckSpecialID for a <code>BeeBot</code> animid if it's a <code>battle</code> entity. In that case, it's set to a new array of 1 element whose value is either 0 or 1 determined randomly.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#extrastuff","title":"<code>extrastuff</code>","text":"<p>This is a general purpose transform array for use by enemy party members only during their DoAction's actions logic. Any enemy party member can use it to persist transforms between their actions.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#weakness","title":"<code>weakness</code>","text":"<p>The name of this field is a missnomer because it doesn't represent only weaknesses, but rather a general purpose list of AttackProperties that can change the damage pipeline, especially during CalculateBaseDamage.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#cantfall","title":"<code>cantfall</code>","text":"<p>When this field is true, it will never be dropped by CalculateBaseDamage when its position is <code>Flying</code>.</p> <p>It will also prevent having its position set to <code>Ground</code> by RefreshEnemyPos (used by GetAvailableTargets or Chompy).</p> <p><code>lockposition</code> is a field that does the same logic in CalculateBaseDamage specifically, but it doesn't require the position to be <code>Flying</code>. It doesn't include the other logic <code>cantfall</code> has.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#notaunt","title":"<code>notaunt</code>","text":"<p>When this field is true, it specifically affects the <code>BeetleTaunt</code> skill by preventing the Taunted infliction.</p> <p>NOTE: This doesn't prevent the <code>forceattack</code> being set to <code>currentturn</code> which means that the actual enemy party members taunting logic still works despite this. This is only meant to prevent the animations or SetCondition calls which is still desired for enemies who do not perform any targetting actions in their action logic so it doesn't look out of place visually or logically in the case of the <code>TauntPlus</code> medal.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#notired","title":"<code>notired</code>","text":"<p>When this is true, enemy party members will not have their <code>tired</code> (exhaustion) field incremented during EndEnemyTurn like it would normally if the <code>DoublePain</code> medal isn't equipped.</p> <p>NOTE: This applies even if flags 614 is true (HARDEST is active) because it still requires the <code>DoublePain</code> medal to be equipped for enemy exhaustion to be disabled.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#hidehp","title":"<code>hidehp</code>","text":"<p>When this is true, RefreshEnemyHP will never render the enemy party member's <code>hp</code> and <code>def</code> stats.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#fled","title":"<code>fled</code>","text":"<p>Setting this to true causes the enemy party member to effectively die, but not in an usual way. CheckDead will detect the death, but process it with a very reduced logic only consisting of moving them offscreen and disabling their battleentity if their <code>destroyentity</code> is true (only happens if their <code>deathtype</code> was 12 and their <code>hp</code> got to 0 after sustaining them in DoDamage).</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#notattle","title":"<code>notattle</code>","text":"<p>Setting this to true will prevent GetTattleable from including the enemy party member in the return which prevents Tattle to work on it.</p> <p>This is used in SetItem when handling a Battle strategy list type when option 1 (Spy) has been chosen.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#actimmobile","title":"<code>actimmobile</code>","text":"<p>When this is true, the enemy party member will almost always not have their <code>cantmove</code> set to higher than 0 as a result of a stopping condition and it will almost always have IsStopped return false. This means they can almost always still act while inflicted by a stopping condition.</p> <p>There is one notable exception to this rule: it's possible to have IsStopped not take this field into account by sending true as the skipimmobile. This is notably done during the <code>hitaction</code> processing checks (meaning this field won't have an impact on whether an enemy party member is considered stopped for the purpose of the <code>hitaction</code>).</p> <p>There are only 3 enemies in the game that have this feature enabled:</p> <ul> <li><code>VenusBoss</code></li> <li><code>WaspKing</code></li> <li><code>EverlastingKing</code></li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20features/#diebyitself","title":"<code>diebyitself</code>","text":"<p>When all the remaining enemy party members who are alive (<code>hp</code> above 0) have this field set to true, it tells CheckDead to set their <code>hp</code> to 0 and their <code>diebyitself</code> to false before redoing a second (and last) enemy death checks. The second check will inevitably lead to detect their deaths and kill them properly.</p> <p>The reason this happens is to handle the very specific case of killing an enemy party member while only stationary ones (such as <code>SandWall</code> or <code>PisciWall</code>) remains alive. When these cases happen, it's unecessary to keep them alive and they should die if they are the only ones that remains. In other words, each would die by itself, hence the name of the field.</p>"},{"location":"Battle%20system/Actors%20states/HPPercent/","title":"HPPercent","text":"<p>A method that returns an actor's <code>hp</code> / <code>maxhp</code> which is the percentage (between 0.0 and 1.0) of <code>hp</code> they have left. It is primarily used in enemy actions as a factor to enemies's logic.</p> <pre><code>private float HPPercent(MainManager.BattleData data)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/HPPercent/#parameters","title":"Parameters","text":"<ul> <li><code>data</code>: The actor to obtain their <code>hp</code> remaining percentage</li> </ul>"},{"location":"Battle%20system/Actors%20states/HPPercent/#procedure","title":"Procedure","text":"<p>Returns data's <code>hp</code> / <code>maxhp</code>. It can then be used as a percentage of <code>hp</code> left so for example, a return of 0.5 means 50% of <code>hp</code> is left, 0.0 means their <code>hp</code> is 0 and 1.0 means their <code>hp</code> is the same than their <code>maxhp</code>.</p>"},{"location":"Battle%20system/Actors%20states/Heal/","title":"Heal","text":"<p>This method increases an actor's <code>hp</code> alongside some visual effects.</p> <pre><code>private void Heal(ref MainManager.BattleData entity, int? ammount, bool nosound)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Heal/#parameters","title":"Parameters","text":"<ul> <li><code>entity</code>: The actor to heal</li> <li><code>amount</code>: The amount to heal. If null, it heals by 999</li> <li><code>nosound</code>: If true, the <code>Heal</code> sound won't be played. There is an overload without this parameter that sends false</li> </ul>"},{"location":"Battle%20system/Actors%20states/Heal/#procedure","title":"Procedure","text":"<ul> <li>MainManager.HealParticle is called on the battleentity with a size of Vector3.one and an offset of Vector3.up * the battleentity.<code>height</code></li> <li>If <code>nosound</code> is false and the <code>Heal</code> sound isn't playing or its more than halfway done player, it is played</li> <li>The actor's <code>hp</code> is increased by amount (or 999 if it's null) clamped from 0 to the actor's <code>maxhp</code></li> <li>ShowDamageCounter is called with type 1 with the damage amount as the amount healed earlier with the start being the battleentity position + (2.0, 2.0, 2.0) and the end being (5.0, 5.0, 5.0)</li> </ul>"},{"location":"Battle%20system/Actors%20states/IsStopped/","title":"IsStopped","text":"<p>This is a method that determines if an actor is unable to act.</p> <pre><code>private bool IsStopped(MainManager.BattleData entity, bool skipimmobile)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/IsStopped/#parameters","title":"Parameters","text":"<ul> <li><code>entity</code>: The actor to check</li> <li><code>skipimmobile</code>: Whether or not to exclude the actimmobile check. There is an overload without this parameter that sends false</li> </ul>"},{"location":"Battle%20system/Actors%20states/IsStopped/#procedure","title":"Procedure","text":"<p>If skipimmobile is false and the actor's actimmobile is true, the result is false.</p> <p>Otherwise, the result is only true if any of the following are true (it's false otherwise):</p> <ul> <li>The actor has a Freeze condition</li> <li>The actor has a Numb condition (or <code>isnumb</code> is true)</li> <li>The actor has a Flipped condition</li> <li>The actor has a Sleep condition (or <code>isasleep</code> is true)</li> <li>The actor has a Eaten condition</li> <li>The actor has a EventStop condition</li> <li>The actor's <code>hp</code> is 0 or below</li> </ul>"},{"location":"Battle%20system/Actors%20states/MultiSkillMove/","title":"MultiSkillMove","text":"<p>This is a method that is exclusively meant to be used in DoAction where a player action involving multiple player party members is used. It is called typically at the end of such player action's logic.</p> <p>It is meant to work alongside the normal actor turn consumption logic performed in post-action by consuming the actor turns of the all of the involved player party memebrs (except the attacker which is advanced normally by post-action) and some logic associated.</p> <p>It is hardcoded to apply to the following actions (because these actions will not have the attacker's <code>tired</code> incremented as this method will do it for all player party members involved):</p> <ul> <li>5 (<code>BeeFly</code>)</li> <li>26 (<code>IceBeemerang</code>)</li> <li>27 (<code>IceDrill</code>)</li> <li>31 (<code>IceSphere</code>)</li> </ul> <pre><code>private void MultiSkillMove(int[] ids)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/MultiSkillMove/#parameters","title":"Parameters","text":"<ul> <li><code>ids</code>: The <code>playerdata</code> indexes of all the involved player party members that participated in the player action</li> </ul>"},{"location":"Battle%20system/Actors%20states/MultiSkillMove/#procedure","title":"Procedure","text":"<p>Every player party members involved in ids will have the following happen:</p> <ul> <li><code>cantmove</code> incremented</li> <li><code>charge</code> set to 0</li> <li><code>tired</code> incremented</li> </ul> <p>Finally, the <code>currentturn</code> player party member gets <code>cantmove</code> decremented. This undoes the increment that just happened because their actor turn will get advanced normally by post-action which avoids to advance it twice.</p>"},{"location":"Battle%20system/Actors%20states/RefreshEntities/","title":"RefreshEntities","text":"<p>This method performs some reset on some entity fields. It belongs to MainManager.</p> <pre><code>public static void RefreshEntities(bool forceanim, bool refreshmap, bool onlyplayer)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/RefreshEntities/#parameters","title":"Parameters:","text":"<ul> <li><code>forceanim</code>: Tells if ForceAnim will be called on each entity which will call Play on the entity's <code>anim</code> using its the current animstate (<code>f</code> is appended if the entity's <code>height</code> is aboe 0.1 and it has the same meaning than its normal argument)</li> <li><code>refreshmap</code>: Tells if the NPCControl specific logic will apply</li> <li><code>onlyplayer</code>: Tells if only the <code>playerdata</code> entities part will have their fields reset</li> </ul> <p>There are 3 overloads: one where <code>onlyplayer</code> is ommited and false is sent, one without parameter where all the parameters will have false sent and one where the only parameter is <code>onlyplayer</code> and the other 2 will have false sent.</p>"},{"location":"Battle%20system/Actors%20states/RefreshEntities/#procedure","title":"Procedure","text":"<ul> <li>All <code>playerdata</code> entities have their <code>hitwall</code> set to false and their animid set to their corresponding BattleData.<code>animid</code>. If forceanim is true, ForceAnim is called which will call Play on the entity's <code>anim</code> using its the current animstate (<code>f</code> is appended if the entity's <code>height</code> is aboe 0.1 and it has the same meaning than its normal argument)</li> <li>We return immediately if <code>onlyplayer</code> is true</li> <li>All EntityControl have the following happen:</li> <li><code>oldid</code> is set to -1</li> <li><code>oldstate</code> is set to -1</li> <li><code>emoticoncooldown</code> is set to 0.0</li> <li><code>hitwall</code> is set to false</li> <li>If <code>height</code> is above 0.1, <code>oldfly</code> is set to <code>flyinganim</code></li> <li>If it's an item entity, UpdateItem is called</li> <li>If forceanim is true, ForceAnim is called which will call Play on the entity's <code>anim</code> using its the current animstate (<code>f</code> is appended if the entity's <code>height</code> is aboe 0.1 and it has the same meaning than its normal argument)</li> <li>If refreshmap is true and the entity has an <code>npcdata</code>, further logic are done about the corresponding NPCControl for the following:<ul> <li>Disguise and its derivatives</li> <li>Dropplet</li> <li>PushRock</li> <li>Geizer</li> </ul> </li> <li>If refreshmap is true and the map exists, all TrailRenderer has Clear called on them which clears all the wind trails currently active</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackDown/","title":"AttackDown","text":"<p>A condition that gives a -1 damage malus on attacks by the actor while it is active when the AttackProperty isn't <code>NoExceptions</code>.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackDown/#setcondition","title":"SetCondition","text":"<p>When amending the condition, the turn amount is always increased by the existing one (meaning it stacks).</p> <p>When inflicted as a new condition, nothing special happens.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackDown/#statuseffect","title":"StatusEffect","text":"<p>This condition is supported by this method and it is always inflicted to the actor when called.</p> <p>It includes optional visual effects when effect is true:</p> <ul> <li>StatEffect is called with type 2 (red down arrow)</li> <li>The <code>StatDown</code> sound is played if it wasn't already</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackDown/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>If the attacker has this condition, a -1 damage malus is applied unless property is <code>NoExceptions</code>.</p> <p>A variation of this logic is also enforced outside of the damage pipeline in GetMultiDamage. That method is used by the following skills:</p> <ul> <li><code>IceSphere</code></li> <li><code>IceDrill</code></li> <li><code>BeeFly</code></li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackDown/#dodamage","title":"DoDamage","text":"<p>After damage calculations, if the target's <code>hp</code> is still above 0 and it doesn't have the Shield condition, this condition will be inflicted via StatusEffect if property is <code>AtkDownOnBlock</code>. The amount of turn to inflict is 2 turns unless block is true where it's 1 turn instead. On top of this, it inflicts for one more turn if the target is a player party member (meaning 3 turns or 2 with block).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackDown/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When an AttackUp condition is processed (when <code>hp</code> is above 0), if the actor's <code>atkdownonloseatkup</code> is true, this condition is inflicted by doing the following:</p> <ul> <li>actor's <code>atkdownonloseatkup</code> is set to false</li> <li>SetCondition is called to inflict this condition for 2 turns on the actor</li> <li>The <code>StatDown</code> sound is played</li> <li>StatEffect is called with type 2 (red down arrow)</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackDown/#usecharm","title":"UseCharm","text":"<p>This condition prevents a charm of type <code>AttackUp</code> to take effect as its effect would become redundant. Check the method's documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackDown/#checkdead","title":"CheckDead","text":"<p>When summoning <code>extraenemies</code> at the <code>AbandonedCity</code> map while flags 400 is true, this condition is inflicted to all enemies alongside DefenseUp for 999999 turns.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackUp/","title":"AttackUp","text":"<p>A condition that gives a +1 damage bonus on attacks by the actor while it is active when the AttackProperty isn't <code>NoExceptions</code>.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackUp/#setcondition","title":"SetCondition","text":"<p>When amending the condition, the turn amount is always increased by the existing one (meaning it stacks).</p> <p>When inflicted as a new condition, nothing special happens.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackUp/#statuseffect","title":"StatusEffect","text":"<p>This condition is supported by this method and it is always inflicted to the actor when called.</p> <p>It includes optional visual effects when effect is true:</p> <ul> <li>StatEffect is called with type 0 (red up arrow)</li> <li>The <code>StatUp</code> sound is played if it wasn't already</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackUp/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>If the attacker has this condition, a +1 damage bonus is applied unless property is <code>NoExceptions</code>.</p> <p>A variation of this logic is also enforced outside of the damage pipeline in GetMultiDamage. That method is used by the following skills:</p> <ul> <li><code>IceSphere</code></li> <li><code>IceDrill</code></li> <li><code>BeeFly</code></li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackUp/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0), if the actor's <code>atkdownonloseatkup</code> is true, an AttackDown condition is inflicted by doing the following:</p> <ul> <li>actor's <code>atkdownonloseatkup</code> is set to false</li> <li>SetCondition is called to inflict the <code>AttackDown</code> condition for 2 turns on the actor</li> <li>The <code>StatDown</code> sound is played</li> <li>StatEffect is called with type 2 (red down arrow)</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackUp/#usecharm","title":"UseCharm","text":"<p>This condition prevents a charm of type <code>AttackUp</code> to take effect as its effect would become redundant. Check the method's documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/AttackUp/#checkdead","title":"CheckDead","text":"<p>When summoning <code>extraenemies</code> at the <code>AbandonedCity</code> map while flags 400 is true, this condition is inflicted to all enemies alongside DefenseUp for 999999 turns.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseDown/","title":"DefenseDown","text":"<p>A condition that removes a point of defense recognised by TrueDef which can result in a +1 damage effects while it is active when the AttackProperty isn't <code>NoExceptions</code>. NOTE: This has several caveats, check the CalculateBaseDamage documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseDown/#setcondition","title":"SetCondition","text":"<p>When amending the condition, the turn amount is always increased by the existing one (meaning it stacks).</p> <p>When inflicted as a new condition, nothing special happens.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseDown/#statuseffect","title":"StatusEffect","text":"<p>This condition is supported by this method and it is always inflicted to the actor when called.</p> <p>It includes optional visual effects when effect is true:</p> <ul> <li>StatEffect is called with type 3 (blue down arrow)</li> <li>The <code>StatDown</code> sound is played if it wasn't already</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseDown/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>If the attacker has this condition, a defense may be removed resulting in a -1 damage effect that applies unless property is <code>NoExceptions</code>. NOTE: This has several caveats, check the method's documentation to learn more. Notably, it prevents the Numb condition to add a defense.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseDown/#dodamage","title":"DoDamage","text":"<p>After damage calculations, if the target's <code>hp</code> is still above 0 and it doesn't have the Shield condition, this condition will be inflicted via StatusEffect if property is <code>DefDownOnBlock</code>. The amount of turn to inflict is 2 turns unless block is true where it's 1 turn instead. On top of this, it inflicts for one more turn if the target is a player party member (meaning 3 turns or 2 with block).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseUp/","title":"DefenseUp","text":"<p>A condition that gives a -1 damage on attacks to the actor as a point of defense recognised by TrueDef while the condition is active and property isn't <code>NoExceptions</code>. NOTE: This has several caveats, check the CalculateBaseDamage documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseUp/#setcondition","title":"SetCondition","text":"<p>When amending the condition, the turn amount is always increased by the existing one (meaning it stacks).</p> <p>When inflicted as a new condition, nothing special happens.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseUp/#statuseffect","title":"StatusEffect","text":"<p>This condition is supported by this method and it is always inflicted to the actor when called.</p> <p>It includes optional visual effects when effect is true:</p> <ul> <li>StatEffect is called with type 1 (blur up arrow)</li> <li>The <code>StatUp</code> sound is played if it wasn't already</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseUp/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>If the attacker has this condition, a -1 damage effect is applied unless property is <code>NoExceptions</code> / <code>Flip</code> or piercing applies. NOTE: This has several caveats, check the method's documentation to learn more (including incorrect logic concerning this condition and the <code>AntlionJaws</code> medal).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/DefenseUp/#checkdead","title":"CheckDead","text":"<p>When summoning <code>extraenemies</code> at the <code>AbandonedCity</code> map while flags 400 is true, this condition is inflicted to all enemies alongside AttackUp for 999999 turns.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/","title":"Eaten","text":"<p>A special stopping condition specific to the Pitcher enemy that allows through unorthodox methods to treat a player party member as if they were dead alongside having their <code>eatenby</code> not being null.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#isstopped","title":"IsStopped","text":"<p>This condition is considered a stop condition and will always make this method returns true (unless skipimmobile is false while the actor'a actimmobile is true). This include the lite version used in the enemy phase. Being stopped makes the actor unable to act regardless of their <code>cantmove</code> as well as a bunch of feature they no longer get access to.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#getfreeplayerammount","title":"GetFreePlayerAmmount","text":"<p>This condition makes a player party member not count as free. This affects many logic such as knowing if a player can act.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#relay","title":"Relay","text":"<p>This condition will not be transfered to the target of the relay if the relayer had a <code>RelayTransfer</code> medal. It should be noted that it is not possible to relay from a player party member with this condition under normal gameplay so this clause effectively does nothing.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0):</p> <ul> <li>A yield of 0.75 seconds is set to happen after the method is done</li> <li>If <code>eatenby</code> exists backed by an enemy party member, the player party member's <code>hp</code> is above 0 and there is at least one enemy party member:<ul> <li>DoDamage is called to the player party member with no attacker with a <code>NoExceptions</code> property, a <code>NoCounter</code> overrides without block. The damageammount is the player party member's <code>maxhp</code> / 10.0 + 1 ceiled and then clamped from 1 to 99</li> <li>ShowDamageCounter is called with type 0 with the damage amount as the amount with the start being the <code>eatenby</code> enemy party member's <code>cursoroffset</code> and the end being (0.0, 2.0, 0.0)</li> <li>Heal is called on the <code>eatenby</code> enemy party member for the same damage amount dealt to the player party member</li> </ul> </li> <li>If the player party member's <code>hp</code> is 0 or below while there are at least 1 player party member with an <code>hp</code> above 0 while not having an <code>eatenby</code>:<ul> <li><code>eatenkill</code> is set to true (this is used in AdvanceMainTurn to handle this specific case)</li> <li>EventDialogue 19 is started and stored in <code>checkingdead</code> (this will eventually call SpitOut, check the section below for more detail)</li> </ul> </li> </ul> <p>The turn counter of the condition is never decremented because it is expected to be removed manually.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#advancemainturn","title":"AdvanceMainTurn","text":"<p>Right after the return of AdvanceTurnEntity, this is where the <code>eatenkill</code> handling logic happen if it is true (meaning they just died as a result of the HP drain):</p> <ul> <li><code>eatenkill</code> is set to false (this is meant as a one shot flag field)</li> <li>All frames are yielded while <code>spitout</code> is in progress</li> <li><code>checkingdead</code> is set to a new CheckDead coroutine starting</li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> </ul> <p>This part is necessary because the player party member may have not died properly and in order to address this, a CheckDead is needed, but it is only safe to do so after <code>spitout</code> is done.</p> <p>After the player party had all their actor turns advanced, this condition will prevent a player party member from receiving the effects of the <code>FavoriteOne</code> medal when another party member with the medal gets attacked.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#clearstatus","title":"ClearStatus","text":"<p>This condition is excluded from removal meaning it will remain even after calling this method.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#how-eat-and-spitout-works","title":"How Eat and SpitOut works","text":"<p>This condition has very special logic associated with it because it involves very unorthodox methods to essentially \"fake\" the death of a player party member. This section will clarify these methods.</p> <p>This condition is specifically made to be inflicted via a method called Eat and removed with a coroutine called SpitOut (which also performs a lot of other visual effects with a strong assumption that the eater is a <code>Pitcher</code> enemy).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#eat","title":"Eat","text":"<p>Inflicts this condition to <code>playerdata[playerid]</code> for <code>turns</code> turns and set their <code>eatenby</code> to <code>enemydata[enemyid].battleentity</code> and the <code>ate</code> of the enemy to <code>playerdata[playerid].battleentity</code>. This is meant to be called in the enemy party member's DoAction's action logic.</p> <pre><code>private void Eat(int enemyid, int playerid, int turns)\n</code></pre> <p>NOTE: In practice, this only works if the enemy party member is a Pitcher enemy because this eating system wasn't made to handle any other enemies.</p> <p>For simplicity, <code>playerdata[playerid]</code> will be refered to as the eaten and <code>enemydata[enemyid]</code> will be refered as the eater.</p> <p>The method sets the following fields:</p> Field Value eaten's <code>eatenby</code> eater's battleentity eater's <code>ate</code> eaten's battleentity eaten's <code>moreturnnextturn</code> 0 eaten's <code>charge</code> 0 eaten's battleentity.<code>shieldenabled</code> false <p>And it also does the following:</p> <ul> <li>The eaten's battleentity.<code>sprite</code> is disabled</li> <li>The eaten's battleentity.<code>shadow</code> is disabled</li> <li>ClearStatus is called on the eaten</li> <li>The <code>Eaten</code> condition is inflicted to the eaten for <code>turns</code> amount of turns via SetCondition. It should be noted that the turn counter doesn't mean anything because it will never get decremented.</li> </ul> <p>The overall effect is that the eaten will appear to no longer be in the battle because their sprite and shadows are disabled, but they are physically still present. In fact, they are still considered an active party member and the Eaten condition alone can't change this (the furthest it goes on that front is making IsStopped return true, but this only prevents acting, it doesn't treat them as if they were dead). </p> <p>For more information on how this ends up treating the player party member as dead, see the <code>eatenby</code> section below. The <code>ate</code> field is less important and it is mainly used for the <code>Pitcher</code> enemy's own logic.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#spitout","title":"SpitOut","text":"<p>Performs the visual animations of spitting out the actor the <code>eater</code> ate (obtained through its <code>ate</code> field) and remove the eaten's Eaten condition and set their <code>eatenby</code> to null.</p> <pre><code>private IEnumerator SpitOut(EntityControl eater)\n</code></pre> <p>The details of this coroutine won't be detailed for the sake of brevety because most of it involves very verbose animations logic, but it essentially undo what Eat did and if the eater died as a result, Death is called on it.</p> <p>What is important to mention is the circumstances in which this coroutine is called because it's done at very specific points:</p> <ul> <li>EventDialogue 19: This is explained in the AdvanceTurnEntity section above, but this event dialogue is responsible for spitting out the eater in the case the eaten just died as a result of the HP drain attack</li> <li>DoAction: This is where the <code>Pitcher</code> enemy can decide to spit out the player party member on its own (under normal gameplay, it's after 3 turns, counted by the <code>Pitcher</code>'s action logic).</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#eatenby-influences","title":"<code>eatenby</code> influences","text":"<p>The real way the system treats a player party member that has the Eaten condition as if they were dead is through their <code>eatenby</code> field because while it is mainly used for AdvanceTurnEntity to perform the HP drain, it is used in many places in the battle system.</p> <p>It should always be null except when Eat is called until SpitOut is processed. When it is not null, it means the actor has been eaten and the system will explicitly treat them as if they were completely dead in some ways (it is usually treated similarly then as if their <code>hp</code> reached 0). Due to how much influence this field has, it's explicitly set to null on StartBattle to make doubly sure it's always null until Eat is called.</p> <p>This implies that if the only player party member left is one that's eaten, the system will inevitably switch to a terminal flow because it will be treated as a dead party.</p> <p>Unfortunately, this has to be done on a case by case basis: there is no universal way to treat a player party member as dead because the battle system was never designed to entirely disable (not just stop) a player party member during the battle.</p> <p>The following details the places affected by having an <code>eatenby</code> of not null.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#doitemeffect","title":"DoItemEffect","text":"<p>Being eaten prevents the <code>ReviveAll</code> and <code>CureParty</code> effects from healing or reviving the eaten member.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#getaliveplayerammount","title":"GetAlivePlayerAmmount","text":"<p>Beaing eaten counts as not being alive. This method is used all over the battle system in multiple places.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#updateconditionbubbles","title":"UpdateConditionBubbles","text":"<p>Not only will being eaten prevent the normal icons from being rendered, but it also specifically doesn't treat them as being dead for the purpose of rendering the icon involved with the <code>MiracleMatter</code> medal. This effectively prevents any icons to be rendered under any circumstances even if they would have fufilled the conditions required to render them.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#advancemainturn_1","title":"AdvanceMainTurn","text":"<p>Being eaten prevents a delproj from damaging the player party member. The delproj will still land like normal, but it will not do damages the same way a player party member with an <code>hp</code> at 0 would.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#getchoiceinput-handling-the-skills-list-type-confirmation","title":"GetChoiceInput (handling the skills list type confirmation)","text":"<p>Being eaten prevents DoAction to be called on the player party member. Instead, the <code>Cancel</code> sound is played on sourceid 10.</p> <p>Also, it will deny the confirmation of a player party member when selecting who to relay to when handling the <code>Relay</code> choice for a <code>SelectPlayer</code> action.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#checkitemuse","title":"CheckItemUse","text":"<p>Being eaten always makes this return false and prevents the UseItem call. This mainly impacts the handling of the <code>Item</code> Action by GetChoiceInput when currentchoice is <code>SelectEnemy</code> or <code>SelectPlayer</code>.</p> <p>Effectively, it's not possible to use an item from or to the eaten player party member.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#useitem","title":"UseItem","text":"<p>Being eaten prevents the following effects from processing on the actor:</p> <ul> <li><code>HPRecoverAll</code></li> <li><code>ReviveAll</code></li> <li><code>CureParty</code></li> <li><code>CurePoisonAll</code></li> <li><code>GradualHPParty</code></li> </ul> <p>It covers healing effects targetting the whole player party.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#usecharm","title":"UseCharm","text":"<p>Being eaten prevents the <code>DefenseUp</code> and <code>HealHP</code> charm types from processing on the actor. This covers the charm types that target the whole player party.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#getrandomavaliableplayer","title":"GetRandomAvaliablePlayer","text":"<p>If <code>forceattack</code> is set to a player party member that is being eaten, the <code>forceattack</code> override that normally would have happened is ignored and instead, the method will select a random target as it normally would, but the eaten member is excluded from the possible selection.</p> <p>If <code>forceattack</code> is -1, the method will select a random target as it normally would, but the eaten member is excluded from the possible selection.</p> <p>NOTE: All this logic implies that if the only player party member remaining is being eaten, this will cause a softlock, but this can't happen because this is treated as a dead party leading to a certain terminal flow.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Eaten/#doaction","title":"DoAction","text":"<p>Being eaten prevents the following skills from processing on the eaten player party member:</p> <ul> <li><code>DefenseUpPlus</code></li> <li><code>SharingStash</code></li> <li><code>BubbleShield</code> (also <code>BubbleShieldLite</code>, but it's not possible to even select the eaten player party member in the first place)</li> </ul> <p>It also prevents the <code>Abombhoney</code> items from processing on them.</p> <p>For a <code>Pitcher</code> enemy, his poison attack that targets the player party won't affect an eaten player party member.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/EventStop/","title":"EventStop","text":"<p>A stop condition specifically made for event 182 (trying to exit the room after approaching the tank in the last room of Upper Snakemouth) that simply disables a party member until it is manually removed (it is not meant to expire naturally).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/EventStop/#isstopped","title":"IsStopped","text":"<p>This condition is considered a stop condition and will always make this method returns true (unless skipimmobile is false while the actor'a actimmobile is true). This include the lite version used in the enemy phase. Being stopped makes the actor unable to act regardless of their <code>cantmove</code> as well as a bunch of feature they no longer get access to.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/EventStop/#getfreeplayerammount","title":"GetFreePlayerAmmount","text":"<p>This condition makes a player party member not count as free. This affects many logic such as knowing if a player can act.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/EventStop/#getchoiceinput-relay-selectplayer","title":"GetChoiceInput (<code>Relay</code> -&gt; <code>SelectPlayer</code>)","text":"<p>This condition will deny the confirmation of a player party member when selecting who to relay to when handling the <code>Relay</code> choice for a <code>SelectPlayer</code> action.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/EventStop/#relay","title":"Relay","text":"<p>This condition will not be transfered to the target of the relay if the relayer had a <code>RelayTransfer</code> medal. It should be noted that it is not possible to act with this condition on a player party member under normal gameplay so this clause does nothing in practice.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/EventStop/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition just expired after decrementing its turn counter:</p> <ul> <li>BreakIce is called on the actor's battleentity if its <code>icecube</code> exists</li> <li>The actor's <code>cantmove</code> is set to 1 (this will become 0 if their <code>hp</code> is above 0 since turn advancement has yet to happen)</li> </ul> <p>If the condition didn't expire after the decrement, <code>cantmove</code> is set to 1 for an enemy party member or to 0 for a player party member instead of the normal actor turn advancement.</p> <p>NOTE: This logic should normally never apply because the condition is made to not expire and be manually removed.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/EventStop/#clearstatus","title":"ClearStatus","text":"<p>This condition is excluded from removal meaning it will remain even after calling this method.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/EventStop/#updateanim","title":"UpdateAnim","text":"<p>For all alive (<code>hp</code> above 0) player party members with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate is set to 11 (<code>Hurt</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Fire/","title":"Fire","text":"<p>A condition that deals non lethal damage (more than Poison) every main turn while it is active that may be inflicted in CalculateBaseDamage if property is <code>Fire</code> (without a resistance field) featuring a <code>Prefabs/Particles/Flame</code> as a <code>firepart</code>.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Fire/#setcondition","title":"SetCondition","text":"<p>When amending the condition, the turn counter is always increased by absolute value of the sent one / 2.0 ceiled (this means it stacks, but by around half of the sent turns amount).</p> <p>When inflicted as a new condition, nothing special happens.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Fire/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition may be inflicted if the property is <code>Fire</code>. This means it's also supported by the <code>StatusMirror</code> medal. It does not use a resistance field, check the method's documentation to learn more on the conditions needed for the infliction to work.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Fire/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0 and there is at least one enemy party member):</p> <ul> <li>The <code>Flame</code> sound is played</li> <li>DoDamage is called to the actor with no attacker with a <code>NoExceptions</code> property without block. The damageammount is the player party member's <code>maxhp</code> / 7.5 ceiled - 1 and then clamped from 2 to 3. The call also has these overrides:<ul> <li><code>NoFall</code>,</li> <li><code>NoIceBreak</code>,</li> <li><code>FakeAnim</code>,</li> <li><code>DontAwake</code>,</li> <li><code>IgnoreNumb</code></li> </ul> </li> <li>If the actor's <code>hp</code> became 0, battleentity.<code>overrideanim</code> is set to false followed by an OverrideOver call being invoked on the battleentity in 1.0 seconds</li> <li>The actor's <code>hp</code> is clamped from 1 to its <code>maxhp</code></li> <li>A yield of 0.75 seconds is set to happen after the method is done</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Fire/#updateentities","title":"UpdateEntities","text":"<p>This condition will have the battleentity.<code>sprite</code>.material.color to be set to a lerp from the existing one to 0xBF5919 (bright orange) with a factor of 1/5 of the frametime. Check the documentation of the method to learn more about how the alpha channel is determined.</p> <p>This condition includes the initialisation of the actor's <code>firepart</code> as a new instance of <code>Prefabs/Particles/Flame</code> childed to the <code>sprite</code> with a <code>DelAftBtl</code> tag and a local position of Vector3.up.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Fire/#updateanim","title":"UpdateAnim","text":"<p>This condition will cause the <code>currentturn</code> player party member to have its battleentity.animstate set to 20 (<code>WeakPickAction</code>) instead of (<code>PickAction</code>) when its battleentity.<code>overrideanim</code> is false.</p> <p>This condition may cause the other player party members to have their battleentity.animstate set to 17 (<code>WeakBattleIdle</code>) instead of 13 (<code>BattleIdle</code>). Check the method's documentation to learn more on the specifics.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/","title":"Flipped","text":"<p>An ephemeral condition with optional stopping behaviours specific to enemy party members that is only inflicted with a <code>Flip</code> AttackProperty to an enemy party member with a <code>Flip</code> weakness. It causes all the enemy party member's <code>def</code> to be ignored during damage calculation which is recognised by TrueDef. This process can be hampered by Topple's defense mechanism if it applies. NOTE: The condition logic has caveats, check the CalculateBaseDamage documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#isstopped","title":"IsStopped","text":"<p>This condition is considered a stop condition and will always make this method returns true (unless skipimmobile is false while the actor'a actimmobile is true). Being stopped makes the actor unable to act regardless of their <code>cantmove</code> as well as a bunch of feature they no longer get access to.</p> <p>This however does not include the lite version used in the enemy phase meaning enemy party members are allowed to act even with this condition. However, this will only have an effect if there are more than 1 main turns left on the condition because as explained further in the DoAction logic below, if only 1 main turn is left, DoAction will remove the condition immediately and the enemy party member gets to act. DoAction is called regardless, it's just that if there were more than 1 main turns, the enemy action logic part won't happen.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#relay","title":"Relay","text":"<p>This condition will not be transfered to the target of the relay if the relayer had a <code>RelayTransfer</code> medal. It should be noted that it is not possible to inflict this condition on a player party member under normal gameplay so this clause effectively does nothing.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition will cause the battleentity.animstate to be set to 25 (<code>SleepFallen</code>) instead of 14 (<code>Sleep</code>) if a Sleep infliction occurs.</p> <p>If property is <code>Flip</code> while the target has this condition, it will change the logic to call DefaultDamageCalc instead of the standard 1 <code>def</code> ignore logic that the property normally has. In DefaultDamageCalc, this condition will actually prevent the damage to be decreased by the target's <code>def</code> which means the overall effect is this condition causes the <code>def</code> to be ignored (but not other forms of defenses). This is recognised by TrueDef, but this comes with caveats, check the method's documentation to learn more.</p> <p>If this condition wasn't present, but property is <code>Flip</code> while the target has a <code>Flip</code> weakness, a weaknesshit is recognised and the condition will be inflicted for 1 turn unless the target has the <code>ToppleFirst</code> weakness without a Topple condition (since this is where Topple is inflicted instead as a defensive mechanism). In the case where <code>ToppleFirst</code> exists AND it already has Topple, Topple is removed and <code>Flipped</code> is added in its place. For more information, check the method's documentation.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0), if there's more than 1 turn left on it, the actor turn count is decremented. Otherwise, this condition isn't processed in any way meaning it exceptionally doesn't feature a normal actor turn decrease (it is always manually removed).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#doaction","title":"DoAction","text":"<p>Before an enemy party member acts, if it has this condition or Topple for exactly 1 actor turn left, both are removed alongside the following logic:</p> <ul> <li>Jump is called on the enemy party member with a height of 10.0</li> <li>entity.<code>overrideanim</code> is set to false</li> <li>entity.<code>basestate</code> and entity.animstate is set to 0 (<code>Idle</code>)</li> <li>startstate is set to 0 (<code>Idle</code>)</li> <li>0.1 seconds are yielded</li> </ul> <p>However, if more than 1 main turns is left, the entire enemy action is skipped and the coroutine proceeds to post action.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#clearstatus","title":"ClearStatus","text":"<p>This condition is excluded from removal meaning it will remain even after calling this method.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#dodamageanim","title":"DoDamageAnim","text":"<p>This condition may cause the actor's battleentity.animstate and <code>basestate</code> to be set to 15 (<code>Fallen</code>) alongside setting <code>overrideanim</code> to false. Check the method's documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#updateanim","title":"UpdateAnim","text":"<p>For all alive (<code>hp</code> above 0) enemy party members with this condition and whose <code>droproutine</code> isn't in progress, their battleentity.animstate is set to 15 (<code>Fallen</code>) (or 25 (<code>SleepFallen</code>) if they also have the Sleep condition).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Flipped/#numb","title":"Numb","text":"<p>For every enemy party member  with this condition, every 60 frames, their animstate gets set to 16 (<code>HurtFallen</code>) instead of 11 (<code>Hurt</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/","title":"Freeze","text":"<p>A stopping condition that encases the actor in a block of ice. Most attacks will remove this condition and thaw out the ice, but with a +1 damage to the attack. It also allows the target to process a <code>FrostBite</code> medal when attacked.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#resistance","title":"Resistance","text":"<p>This condition has a dedicated resistance field for actors to use: <code>freezeres</code>. If it's 100 or above, the actor is immune to it. Inflictions that requires a resistance check will use this field.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#resistance-increases-for-player-party-members","title":"Resistance increases for player party members","text":"<p>For player party member, the resistance can only be increased by processing the <code>FreezeRes</code> BadgeEffects with the value acting as the amount to increase it by. This only matters for enemy inflicting the player party member, it does not matter for user infliction using items.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#resistance-increases-for-enemy-party-members","title":"Resistance increases for enemy party members","text":"<p>Here are the potential increases for the resistance associated (only applies to enemy party members):</p> <ul> <li>On StartBattle:<ul> <li>If the calledfrom.entity or the battleentity is <code>inice</code> while it's a <code>Krawler</code> or <code>CursedSkull</code> enemy, the enemy party member's <code>freezeres</code> is increased by 70</li> <li>If battleentity.<code>forcefire</code> or we are in the <code>GiantLair</code> area except for the <code>GiantLairFridgeInside</code> map while the enemy is a <code>Krawler</code>, <code>CursedSkull</code> or <code>Cape</code>, the enemy party member's <code>freezeres</code> is set to 110 making them immune (this override the clause above if it applied)</li> </ul> </li> <li>On CalculateBaseDamage when sucessfully inflicting this condition when property is <code>Freeze</code> (mutually exclusive, only the first that applies):<ul> <li>If the corresponding endata of the target's <code>hasiceanim</code> is true and we are either at the <code>GiantLairFridgeInside</code> map or in any maps outside of the <code>GiantLair</code> area, target.<code>freezeres</code> is increased by 70</li> <li>Otherwise, if target.<code>frozenlastturn</code> is true, target.<code>freezeres</code> is increased by 25</li> <li>Otherwise, target.<code>freezeres</code> is increased by 13. The increase is 18 instead if HardMode returns true</li> </ul> </li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#isstopped","title":"IsStopped","text":"<p>This condition is considered a stop condition and will always make this method returns true (unless skipimmobile is false while the actor'a actimmobile is true). This include the lite version used in the enemy phase. Being stopped makes the actor unable to act regardless of their <code>cantmove</code> as well as a bunch of feature they no longer get access to.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#getfreeplayerammount","title":"GetFreePlayerAmmount","text":"<p>This condition makes a player party member not count as free. This affects many logic such as knowing if a player can act.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#setcondition","title":"SetCondition","text":"<p>When amending the condition: </p> <ul> <li>If the actor is an enemy party member, isdefending is set to false and the infliction overwrites the turn counter to the new one (meaning it won't stack)</li> <li>If the actor is a player party member, the infliction overwrites the turn counter if the new one is higher (meaning it won't stack, it can just reset it to a higher amount). An exception to this is when using an item that inflicted it which makes it stack</li> </ul> <p>When inflicted as a new condition, if the actor is an enemy party member, its isdefending is set to false.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#adddelayedcondition","title":"AddDelayedCondition","text":"<p>This condition supports delayed infliction via AddDelayedCondition. Check its documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#statuseffect","title":"StatusEffect","text":"<p>This condition is supported by this method and it might be inflicted to the actor when called.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#getchoiceinput-relay-selectplayer","title":"GetChoiceInput (<code>Relay</code> -&gt; <code>SelectPlayer</code>)","text":"<p>This condition will deny the confirmation of a player party member when selecting who to relay to when handling the <code>Relay</code> choice for a <code>SelectPlayer</code> action.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#dodamage","title":"DoDamage","text":"<p>This condition overrides block to be false meaning blocking is always denied for a player party member with this condition.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition may be inflicted if the property is <code>Freeze</code>. This means it's also supported by the <code>StatusMirror</code> medal.</p> <p>This condition prevents toppling on enemy party members with a <code>ToppleFirst</code> or <code>ToppleAirOnly</code> AttackProperty in their weakness.</p> <p>This condition also implicates entire logic related to it unless the <code>NoIceBreak</code> override is present. Check the CalculateBaseDamage documentation to learn more, but in summary:</p> <ul> <li>Special calculation logic when the target has the <code>FrostBite</code> medal</li> <li>A +1 damage when <code>FrostBite</code> didn't apply followed by the removal of this condition alongside some other ice thawing logic</li> </ul> <p>There is also special logic to remove this condition to the target in enemy to player flow when there's no <code>NoIceBreak</code> override. However, this logic is incorrect for enemy party members because it sets their <code>cantmove</code> to 0. If they have a moves higher than 1, they will loose all but 1 actor turn they should have available. The correct logic is the same than what AdvanceTurnEntity does which is setting <code>cantmove</code> to -<code>moves</code> + 1.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#endplayerturn","title":"EndPlayerTurn","text":"<p>All enemy party members who still have this condition on EndPlayerTurn without actimmobile will have their <code>cantmove</code> set to 1. NOTE: It means removing the condition on the same main turn it was inflicted may leave the <code>cantmove</code> at 1 even if the enemy party member should have been able to act during their phase.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0):</p> <ul> <li>The <code>Freeze</code> sound is played on the battleentity at 1.5 pitch</li> <li>battleentity.<code>shakeice</code> is set to true</li> <li>A yield of 0.75 seconds is set to happen after the method is done</li> <li>The turn counter of the condition is decremented</li> <li>If the turn counter still hasn't reached 0:<ul> <li><code>frozenlastturn</code> is set to true which affects CalculateBaseDamage if property is <code>Freeze</code> since it will increase target.<code>freezeres</code> by 25 instead of 13 (18 when HardMode returns true). NOTE: while the <code>FrigidCoffin</code> skill inflicts this condition outside of the damage pipeline, it still explicitly follow this logic and is therefore affected the same way</li> <li>The <code>cantmove</code> of the actor is set to 1 if it's an enemy party members and to 0 if it's a player party members. NOTE: It means removing the condition for enemy party members may leave the <code>cantmove</code> at 1 even if the enemy party member should have been able to act during their phase</li> </ul> </li> <li>Otherwise (the condition just expired)<ul> <li><code>frozenlastturn</code> is set to false</li> <li>BreakIce is called on the actor's battleentity if its <code>icecube</code> exists</li> <li>The actor's <code>cantmove</code> is set to 1 (this will become 0 if their <code>hp</code> is above 0 since turn advancement has yet to happen)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#removecondition","title":"RemoveCondition","text":"<p>Removing this condition via this method will have BreakIce called on the entity if it exists (not the battleentity).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#healconditions","title":"HealConditions","text":"<p>This condition is supported by this method and it will be removed when called.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#clearstatus","title":"ClearStatus","text":"<p>When this method is called while the actor has this condition, BreakIce is called on the battleentity.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#getblock","title":"GetBlock","text":"<p>For all alive (<code>hp</code> above 0 and not <code>dead</code>) player party members with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate is set to 11 (<code>Hurt</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#updateanim","title":"UpdateAnim","text":"<p>For all alive (<code>hp</code> above 0) player party members with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate is set to 11 (<code>Hurt</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#addexperience","title":"AddExperience","text":"<p>All player party members who still had this condition when AddExperience occurs will have BreakIce called on their battleentity.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#getenemysize","title":"GetEnemySize","text":"<p>This condition causes this method to return the enemy party member's sizeonfreeze if it is above 0.1 instead of its <code>size</code>. This can affect the following skills and  player party members' attacks where the attacker will move to a slightly different position towards the target during the action:</p> <ul> <li><code>firststrike</code> action (when the animid is <code>Beetle</code>)</li> <li><code>Beetle</code>'s basic attack (when the animid is <code>Beetle</code>)</li> <li><code>HeavyStrike</code></li> <li><code>NeedlePincer</code></li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Freeze/#drop","title":"Drop","text":"<p>The entity will drop to 0.0 instead of its <code>minheight</code> when it has this condition.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/GradualHP/","title":"GradualHP","text":"<p>A condition that increases the actor's <code>hp</code> by 2 (clamped from 0 to <code>maxhp</code>) every main turn while active.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/GradualHP/#setcondition","title":"SetCondition","text":"<p>When amending the condition, the turn amount is always increased by the existing one (meaning it stacks).</p> <p>When inflicted as a new condition, nothing special happens.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/GradualHP/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0, but less than <code>maxhp</code>):</p> <ul> <li>ShowDamageCounter is called with type 1 (HP) with the amount being 2 with a start of the actor position + its <code>cursoroffset</code> and an end of Vector3.up</li> <li>The actor's <code>hp</code> is incremented by 2 clamped from 0 to the actor's <code>maxhp</code></li> <li>The <code>Heal</code> sound is played</li> <li>A yield of 0.75 seconds is set to happen after the method is done</li> <li>The turn counter of the condition is decremented</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/GradualTP/","title":"GradualTP","text":"<p>A condition that increases instance.<code>tp</code> by 2 (clamped from 0 to instance.<code>maxtp</code>) every main turn while active.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/GradualTP/#setcondition","title":"SetCondition","text":"<p>When amending the condition, the turn amount is always increased by the existing one (meaning it stacks).</p> <p>When inflicted as a new condition, nothing special happens.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/GradualTP/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when instance.<code>tp</code> is above 0, but less than instance.<code>maxtp</code>):</p> <ul> <li>The <code>Heal2</code> sound is played</li> <li>ShowDamageCounter is called with type 2 (TP) with the amount being 2 with a start of the actor position + its <code>cursoroffset</code> and an end of Vector3.up</li> <li>instance.<code>tp</code> is incremented by 2 clamped from 0 to instance.<code>maxtp</code></li> <li>A yield of 0.75 seconds is set to happen after the method is done</li> <li>The turn counter of the condition is decremented</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Inked/","title":"Inked","text":"<p>A condition that prevents a player party member from using a skill that may be inflicted in CalculateBaseDamage if property is <code>Ink</code> or <code>InkOnBlock</code> (without a resistance field) featuring a <code>Prefabs/Particles/InkDrip</code> as a <code>firepart</code>.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Inked/#getchoiceinput","title":"GetChoiceInput","text":"<p>This condition prevents the <code>Skill</code> Actions option (the buzzer is played instead).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Inked/#setmaxoptions","title":"SetMaxOptions","text":"<p>This condition causes the vine icons for the <code>Skill</code> Actions to render with the MainManager.<code>grayscale</code> material instead of MainManager.<code>spritedefaultunity</code>.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Inked/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition may be inflicted if the property is <code>Ink</code> or <code>InkOnBlock</code>. This means it's also supported by the <code>StatusMirror</code> medal. It does not use a resistance field, check the method's documentation to learn more on the conditions needed for the infliction to work.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Inked/#updateentities","title":"UpdateEntities","text":"<p>This condition will have the battleentity.<code>sprite</code>.material.color to be set to a lerp from the existing one to 0x7200D8 (bright purple) with a factor of 1/5 of the frametime. Check the documentation of the method to learn more about how the alpha channel is determined.</p> <p>This condition includes the initialisation of the actor's <code>firepart</code> as a new instance of <code>Prefabs/Particles/InkDrip</code> childed to the <code>sprite</code> with a <code>DelAftBtl</code> tag and a local position of Vector3.up.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Inked/#about-enemy-party-members","title":"About enemy party members","text":"<p>This condition effectively doesn't do anything on its own for enemy party members because the effects described above only concerns the player party.</p> <p>It is up to the individual enemy action to implement logic to this condition which may include changes to their move selection process.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/","title":"Numb","text":"<p>A stopping condition that gives the actor a point of defense (with caveats, see CalculateBaseDamage documentation for details). It also allows the target to process a <code>ShockTrooper</code> medal which can bypass damage calculation.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#about-isnumb","title":"About <code>isnumb</code>","text":"<p>This condition feature a field that tells if it's present or not called <code>isnumb</code>. However, it's redundant: a HasCondition call gives the same information. It is nonetheless used in very specific edgecases instead of calling this method. The field is frequently updated to match the presence of the condition so in practice, this field can be ignored and treated as if a HasCondition returns above 0.</p> <p>It is mentioned here because it remains important to make sure this field is updated if the condition's presence changes.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#resistance","title":"Resistance","text":"<p>This condition has a dedicated resistance field for actors to use: <code>numbres</code>. If it's 100 or above, the actor is immune to it. Inflictions that requires a resistance check will use this field.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#resistance-increases-for-player-party-members","title":"Resistance increases for player party members","text":"<p>For player party member, the resistance can only be increased by processing the <code>NumbRes</code> BadgeEffects with the value acting as the amount to increase it by. This only matters for enemy inflicting the player party member, it does not matter for user infliction using items.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#resistance-increases-for-enemy-party-members","title":"Resistance increases for enemy party members","text":"<p>For player party member target when property is <code>Numb</code> or <code>Numb1Turn</code> and when successfully inflicting this condition, CalculateBaseDamage, target.<code>numbres</code> is increased by 17. The increase is 22 instead if HardMode returns true</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#isstopped","title":"IsStopped","text":"<p>This condition is considered a stop condition and will always make this method returns true (unless skipimmobile is false while the actor'a actimmobile is true). This include the lite version used in the enemy phase. Being stopped makes the actor unable to act regardless of their <code>cantmove</code> as well as a bunch of feature they no longer get access to.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#getfreeplayerammount","title":"GetFreePlayerAmmount","text":"<p>This condition makes a player party member not count as free. This affects many logic such as knowing if a player can act.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#setcondition","title":"SetCondition","text":"<p>When amending the condition: </p> <ul> <li>If the actor is an enemy party member, isdefending is set to false and the infliction overwrites the turn counter to the new one (meaning it won't stack)</li> <li>If the actor is a player party member, the infliction overwrites the turn counter if the new one is higher (meaning it won't stack, it can just reset it to a higher amount). An exception to this is when using an item that inflicted it which makes it stack</li> </ul> <p>When inflicted as a new condition, if the actor is an enemy party member, its isdefending is set to false.</p> <p>Any method call updates <code>isnumb</code> accordingly.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#adddelayedcondition","title":"AddDelayedCondition","text":"<p>This condition supports delayed infliction via AddDelayedCondition. Check its documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#statuseffect","title":"StatusEffect","text":"<p>This condition is supported by this method and it might be inflicted to the actor when called.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#getchoiceinput-relay-selectplayer","title":"GetChoiceInput (<code>Relay</code> -&gt; <code>SelectPlayer</code>)","text":"<p>This condition will deny the confirmation of a player party member when selecting who to relay to when handling the <code>Relay</code> choice for a <code>SelectPlayer</code> action.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#dodamage","title":"DoDamage","text":"<p>This condition overrides block to be false meaning blocking is always denied for a player party member with this condition.</p> <p>This condition allows a target with a <code>ShockTrooper</code> medal to be considered Invulnerable and bypass damage calculation completely. In such case, the damage ammount is overriden to 0 unless property is <code>NoExceptions</code> where it's overriden by the original damageammount sent to the method.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition may be inflicted if the property is <code>Numb</code> or <code>Numb1Turn</code> (it's the same as <code>Numb</code>, but it always inflict for 1 turn). This means it's also supported by the <code>StatusMirror</code> medal.</p> <p>This condition prevents toppling on enemy party members with a <code>ToppleFirst</code> or <code>ToppleAirOnly</code> AttackProperty in their weakness.</p> <p>This condition gives a point of defense recognised by TrueDef and will result in a -1 damage. NOTE: this has several caveats, check CalculateBaseDamage's documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0):</p> <ul> <li>The <code>ElecFast</code> particles are played at the battleentity position + Vector3.up</li> <li>A ShakeSprite coroutine is started on the battleentity with the intensity being (0.1, 0.15, 0.0) for 40.0 frames</li> <li>The <code>Shock</code> sound is played on the battleentity at 1.25 pitch</li> <li>A yield of 0.75 seconds is set to happen after the method is done</li> <li>The turn counter of the condition is decremented</li> <li>If the condition just expired, the actor's <code>cantmove</code> is set to 1 (this will become 0 if their <code>hp</code> is above 0 since turn advancement has yet to happen)</li> <li><code>isnumb</code> is updated accordingly with the new status of the condition and if it's still true, the <code>cantmove</code> of the actor is set to 1 if it's an enemy party members and to 0 if it's a player party members. NOTE: It means removing the condition for enemy party members may leave the <code>cantmove</code> at 1 even if the enemy party member should have been able to act during their phase</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#removecondition","title":"RemoveCondition","text":"<p>Removing this condition via this method will have the actor's <code>isnumb</code> set to false.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#healconditions","title":"HealConditions","text":"<p>This condition is supported by this method and it will be removed when called on top of setting the actor's <code>isnumb</code> to false.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#getblock","title":"GetBlock","text":"<p>For all alive (<code>hp</code> above 0 and not <code>dead</code>) player party members with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate is set to 11 (<code>Hurt</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#updateanim","title":"UpdateAnim","text":"<p>For all alive (<code>hp</code> above 0) player party members with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate is set to 11 (<code>Hurt</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Numb/#entitycontrollateupdate","title":"EntityControl.LateUpdate","text":"<p>For any battle entities that isn't <code>dead</code> or <code>iskill</code> while not in a terminal flow, Numb is called if <code>isnumb</code> is true which plays the periodic numbing visual effects.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/","title":"Poison","text":"<p>A condition that either deals non lethal damage or heals the actor each main turn depending on if they have a <code>ReversePoison</code> medal or not. It also allows several poison specific medals to take effect.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#resistance","title":"Resistance","text":"<p>This condition has a dedicated resistance field for actors to use: <code>poisonres</code>. If it's 100 or above, the actor is immune to it. Inflictions that requires a resistance check will use this field.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#resistance-increases-for-player-party-members","title":"Resistance increases for player party members","text":"<p>For player party member, the resistance can only be increased by processing the <code>PoisonRes</code> BadgeEffects with the value acting as the amount to increase it by. This only matters for enemy inflicting the player party member, it does not matter for user infliction using items.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#setcondition","title":"SetCondition","text":"<p>When amending the condition: </p> <ul> <li>If the actor is a player party member with an <code>EternalPoison</code> medal, the turn amount is overriden to be 99999 and the infliction overwrites the turn counter to the new one (meaning it won't stack)</li> <li>Otherwise, the inflicting is ammended by adding the turn amount to the existing one (meaning it will stack)</li> </ul> <p>When inflicted as a new condition, the same <code>EternalPoison</code> logic occurs (the turn ammount is overriden to 99999).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#statuseffect","title":"StatusEffect","text":"<p>This condition is supported by this method and it might be inflicted to the actor when called.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition may be inflicted if the property is <code>Poison</code>. This means it's also supported by the <code>StatusMirror</code> medal.</p> <p>This condition allows the <code>PoisonAttacker</code> medal to take effect by increasing the damage amount by the amount of <code>PoisonAttacker</code> equipped for a player attacker while not in <code>demomode</code>. </p> <p>A variation of the <code>PoisonAttacker</code> logic is also enforced (except the <code>demomode</code> check) in GetMultiDamage with the only difference being that the increase is by (amount of attacker's <code>PoisonAttacker</code> - amount of attacker's <code>ReversePoison</code>). That method is used by the following skills:</p> <ul> <li>IceSphere</li> <li>IceDrill</li> <li>BeeFly</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#defaultdamagecalc","title":"DefaultDamageCalc","text":"<p>This condition allows the <code>PoisonDefender</code> and <code>ReversePoison</code> medals to take effect by decreasing the damage amount by (amount of target's <code>PoisonDefender</code> - amount of target's <code>ReversePoison</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#dodamage","title":"DoDamage","text":"<p>This condition allows the The <code>PoisonTouch</code> medal to take effect is equipped on the target if the following are all true:</p> <ul> <li>The attacker is an enemy party member</li> <li>The attacker's <code>poisonres</code> is less than 100 (it's not immune)</li> <li><code>nonphyscal</code> is false</li> </ul> <p>If all of the above are fufilled, SetCondition is called to set the Poison condition on the corresponding enemy party member of the attacker for 2 turns.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0 and there is at least one enemy party member):</p> <ul> <li>If the actor is a player party member with a <code>ReversePoison</code> medal equipped:<ul> <li>The actor's <code>hp</code> is increased by the actor's <code>maxhp</code> * 0.1 rounded to nearest clamped from 1 to 3. NOTE: the nearest rounding has a quirk where if it ends in .5, the even number will be chosen over the odd one no matter if it is actually the lower or higher bound that is correct mathematically</li> <li>If the <code>Heal</code> sound isn't playing or its more than halfway done player, it is played</li> <li>ShowDamageCounter is called with type 1 with the damage amount as the amount healed earlier with the start being the battleentity position + (0.0, 1.0, 0.0) and the end being (0.0, 2.0, 0.0)</li> </ul> </li> <li>Otherwise, DoDamage is called with target being the actor with no attacker with a <code>NoExceptions</code> property without block. The damageammount is the actor's <code>maxhp</code> / 10.0 ceiled - 1 and then clamped from 1 to 3 for a player party member and from 1 to 2 for an enemy party member. The call also has these overrides:<ul> <li><code>NoFall</code></li> <li><code>NoIceBreak</code></li> <li><code>FakeAnim</code></li> <li><code>DontAwake</code></li> <li><code>IgnoreNumb</code></li> </ul> </li> <li>If the actor's <code>hp</code> became 0, battleentity.<code>overrideanim</code> is set to false followed by an OverrideOver call being invoked on the battleentity in 1.0 seconds</li> <li>The actor's <code>hp</code> is clamped from 1 to its <code>maxhp</code> (this implies it can't be lethal)</li> <li>A yield of 0.75 seconds is set to happen after the method is done</li> </ul> <p>Exceptionally, the turn counter of the condition won't decrement if the actor has an <code>EternalPoison</code> medal.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#healconditions","title":"HealConditions","text":"<p>This condition is supported by this method and it will be removed when called.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#updateanim","title":"UpdateAnim","text":"<p>This condition will cause the <code>currentturn</code> player party member to have its battleentity.animstate set to 20 (<code>WeakPickAction</code>) instead of (<code>PickAction</code>) when its battleentity.<code>overrideanim</code> is false.</p> <p>This condition may cause the other player party members to have their battleentity.animstate set to 17 (<code>WeakBattleIdle</code>) instead of 13 (<code>BattleIdle</code>). Check the method's documentation to learn more on the specifics.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Poison/#updateentities","title":"UpdateEntities","text":"<p>This condition will have the battleentity.<code>sprite</code>.material.color to be set to a lerp from the existing one to 0xD800D8 (bright magenta) with a factor of 1/5 of the frametime. Check the documentation of the method to learn more about how the alpha channel is determined.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Reflection/","title":"Reflection","text":"<p>A condition that causes a player party member to sustain less damage from CalculateBaseDamage with the reduction amount being the amount of <code>Reflection</code> medal equipped. It always expire on the next main turn, but the turn counter is used to visually show the amount of the damage reduction.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Reflection/#relay","title":"Relay","text":"<p>This condition will not be transfered to the target of the relay if the relayer had a <code>RelayTransfer</code> medal.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Reflection/#choosing-donothing-in-the-battle-strategy-list-type","title":"Choosing DoNothing in the Battle strategy list type","text":"<p>If the <code>currentturn</code> player party member has a <code>Reflection</code> medal, this condition is inflicted via SetCondition with the turn amount being the amount of <code>Reflection</code> equipped (this isn't a true turn counter and more a visual to show the amount of damage reduction that will happen when attacked).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Reflection/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition will cause a decrease of the damage for a player party member. The reduction amount is the amount of <code>Reflection</code> medal equipped on the target.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Reflection/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0), the turn counter is always set to 0. This is because this condition is meant to expire immediately since the actual turn counter is semantically used to show the amount of damages any attacks will be reduced by.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Shield/","title":"Shield","text":"<p>A condition that encases the acotr in a shield by controlling its battleentity.<code>shieldenabled</code> which allows it to bypass damage calculation and not loose its <code>plating</code>.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Shield/#relay","title":"Relay","text":"<p>This condition will not be transfered to the target of the relay if the relayer had a <code>RelayTransfer</code> medal.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Shield/#setcondition","title":"SetCondition","text":"<p>When inflicting or amending the condition:</p> <ul> <li>battleentity.<code>shieldenabled</code> gets set to true</li> <li>If the actor is a player party member, the turn counter is overriden to 1</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Shield/#dodamage","title":"DoDamage","text":"<p>This condition allows a target to be considered Invulnerable and bypass damage calculation completely. In such case, the damage ammount is overriden to 0 unless property is <code>NoExceptions</code> where it's overriden by the original damageammount sent to the method.</p> <p>This condition will prevent target.<code>plating</code> from being set to false after damage calculation.</p> <p>This condition prevents the <code>DefDownOnBlock</code> and <code>AtkDownOnBlock</code> from taking effect after damage calculation which effectively prevents their ensuing DefenseDown and AttackDown.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Shield/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition has just expired, battleentity.<code>shieldenabled</code> gets set to false.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/","title":"Sleep","text":"<p>A stopping condition that will heal the attacker on each main turn and be removed on most attacks due to waking up (with caveats, see CalculateBaseDamage documentation for details). It also allows the target to process a <code>HeavySleeper</code> medal which can prevent waking up, halve the damage amount and heal for more per main turn.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#about-isasleep","title":"About <code>isasleep</code>","text":"<p>This condition feature a field that tells if it's present or not called <code>isasleep</code>. However, it's redundant: a HasCondition call gives the same information. It is nonetheless used in very specific edgecases instead of calling this method. The field is frequently updated to match the presence of the condition so in practice, this field can be ignored and treated as if a HasCondition returns above 0. Calling HasCondition also may set <code>isasleep</code> to true if it has the condition (only if it is the condition seeked or it occurs before the seeked one).</p> <p>It is mentioned here because it remains important to make sure this field is updated if the condition's presence changes.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#resistance","title":"Resistance","text":"<p>This condition has a dedicated resistance field for actors to use: <code>sleepres</code>. If it's 100 or above, the actor is immune to it. Inflictions that requires a resistance check will use this field.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#resistance-increases-for-player-party-members","title":"Resistance increases for player party members","text":"<p>For player party member, the resistance can only be increased by processing the <code>SleepRes</code> BadgeEffects with the value acting as the amount to increase it by. This only matters for enemy inflicting the player party member, it does not matter for user infliction using items.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#resistance-increases-for-enemy-party-members","title":"Resistance increases for enemy party members","text":"<p>For player party member target when property is <code>Sleep</code> and when successfully inflicting this condition, CalculateBaseDamage, target.<code>sleepres</code> is increased by 9. The increase is 13 instead if HardMode returns true</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#isstopped","title":"IsStopped","text":"<p>This condition is considered a stop condition and will always make this method returns true (unless skipimmobile is false while the actor'a actimmobile is true). This include the lite version used in the enemy phase. Being stopped makes the actor unable to act regardless of their <code>cantmove</code> as well as a bunch of feature they no longer get access to.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#getfreeplayerammount","title":"GetFreePlayerAmmount","text":"<p>This condition makes a player party member not count as free. This affects many logic such as knowing if a player can act.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#setcondition","title":"SetCondition","text":"<p>When amending the condition: </p> <ul> <li>If the actor is an enemy party member, isdefending is set to false and the infliction overwrites the turn counter to the new one (meaning it won't stack)</li> <li>If the actor is a player party member, the infliction overwrites the turn counter if the new one is higher (meaning it won't stack, it can just reset it to a higher amount). An exception to this is when using an item that inflicted it which makes it stack</li> </ul> <p>When inflicted as a new condition, if the actor is an enemy party member, its isdefending is set to false.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#adddelayedcondition","title":"AddDelayedCondition","text":"<p>This condition supports delayed infliction via AddDelayedCondition. Check its documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#statuseffect","title":"StatusEffect","text":"<p>This condition is supported by this method and it might be inflicted to the actor when called.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#getchoiceinput-relay-selectplayer","title":"GetChoiceInput (<code>Relay</code> -&gt; <code>SelectPlayer</code>)","text":"<p>This condition will deny the confirmation of a player party member when selecting who to relay to when handling the <code>Relay</code> choice for a <code>SelectPlayer</code> action.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#dodamage","title":"DoDamage","text":"<p>This condition overrides block to be false meaning blocking is always denied for a player party member with this condition.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition may be inflicted if the property is <code>Sleep</code>. This means it's also supported by the <code>StatusMirror</code> medal.</p> <p>This condition prevents toppling on enemy party members with a <code>ToppleFirst</code> or <code>ToppleAirOnly</code> AttackProperty in their weakness.</p> <p>In DefaultDamageCalc, this condition allows the <code>HeavySleeper</code> medal to process by dividing the damage amount by 2 floored.</p> <p>This condition my be removed during CalculateBaseDamage or after its return in DoDamage damage calculation from a target with it after when sustaining damages under certain conditions (with caveats, check the methods's documentation to learn more). Notably, it won't happen if the target has the <code>HeavySleeper</code> medal. NOTE: If DoDamage decides to wake up the target, there is a known issue when setting their <code>cantmove</code> value. Check DoDamage's documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#endplayerturn","title":"EndPlayerTurn","text":"<p>All enemy party members who still have this condition on EndPlayerTurn without actimmobile will have their <code>cantmove</code> set to 1. NOTE: It means removing the condition on the same main turn it was inflicted may leave the <code>cantmove</code> at 1 even if the enemy party member should have been able to act during their phase.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#advanceturnentity","title":"AdvanceTurnEntity","text":"<p>When the condition is processed (when <code>hp</code> is above 0, but less than <code>maxhp</code>):</p> <ul> <li>A heal amount is determined with a starting value of the actor's <code>maxhp</code> * 0.1 ceiled. If the <code>HeavySleeper</code> medal is equipped on the actor, the amount is tripled. On top of this, if it's not a player party member, the amount is clamped from 0 to 4</li> <li>ShowDamageCounter is called with type 1 (HP) with the amount determined earlier with a start of the actor position + its <code>cursoroffset</code> and an end of Vector3.up</li> <li>The actor's <code>hp</code> is incremented by the amount determined earlier clamped from 0 to the actor's <code>maxhp</code></li> <li>The <code>Heal</code> sound is played</li> <li>A yield of 0.75 seconds is set to happen after the method is done</li> <li>The turn counter of the condition is decremented</li> <li>If the condition just expired, the actor's <code>cantmove</code> is set to 1 (this will become 0 if their <code>hp</code> is above 0 since turn advancement has yet to happen)</li> <li><code>isasleep</code> is updated accordingly with the new status of the condition and if it's still true, the <code>cantmove</code> of the actor is set to 1 if it's an enemy party members and to 0 if it's a player party members. NOTE: It means removing the condition for enemy party members may leave the <code>cantmove</code> at 1 even if the enemy party member should have been able to act during their phase</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#removecondition","title":"RemoveCondition","text":"<p>Removing this condition via this method will have the actor's <code>isasleep</code> set to false.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#getblock","title":"GetBlock","text":"<p>For all alive (<code>hp</code> above 0 and not <code>dead</code>) player party members with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate is set to 14 (<code>Sleep</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#dodamageanim","title":"DoDamageAnim","text":"<p>This condition may cause the actor's battleentity.animstate to be set to 14 (<code>Sleep</code>). Check the method's documentation for more details.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sleep/#updateanim","title":"UpdateAnim","text":"<p>For all alive (<code>hp</code> above 0) player party members with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate may set to 14 (<code>Sleep</code>).</p> <p>For all alive (<code>hp</code> above 0) enemy party members with this condition alongside Flipped and whose <code>droproutine</code> isn't in progress, their battleentity.animstate is set to 25 (<code>SleepFallen</code>) instead of 15 (<code>Fallen</code>). If they don't have Flipped, it may be set to 14 (<code>Sleep</code>).</p> <p>Check the method's documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sticky/","title":"Sticky","text":"<p>A condition that prevents a player party member from using an item that may be inflicted in CalculateBaseDamage if property is <code>Sticky</code> (without a resistance field) featuring a <code>Prefabs/Particles/StickyDrip</code> as a <code>firepart</code>.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sticky/#getchoiceinput","title":"GetChoiceInput","text":"<p>This condition prevents the <code>Item</code> Actions option (the buzzer is played instead).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sticky/#setmaxoptions","title":"SetMaxOptions","text":"<p>This condition causes the vine icons for the <code>Item</code> Actions to render with the MainManager.<code>grayscale</code> material instead of MainManager.<code>spritedefaultunity</code>.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sticky/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition may be inflicted if the property is <code>Sticky</code>. This means it's also supported by the <code>StatusMirror</code> medal. It does not use a resistance field, check the method's documentation to learn more on the conditions needed for the infliction to work.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sticky/#updateentities","title":"UpdateEntities","text":"<p>This condition includes the initialisation of the actor's <code>firepart</code> as a new instance of <code>Prefabs/Particles/StickyDrip</code> childed to the <code>sprite</code> with a <code>DelAftBtl</code> tag (gets destroyed on ReturnToOverworld) and a local position of Vector3.up.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sturdy/","title":"Sturdy","text":"<p>A condition that prevents other conditions from being inflicted (even through using an item) while also getting a -3 damage effect applied in CalculateBaseDamage at the expense that the actor cannot be relayed to.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sturdy/#getchoiceinput-relay-selectplayer","title":"GetChoiceInput (<code>Relay</code> -&gt; <code>SelectPlayer</code>)","text":"<p>This condition will deny the confirmation of a player party member when selecting who to relay to when handling the <code>Relay</code> choice for a <code>SelectPlayer</code> action.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sturdy/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition prevents the infliction of any other conditions during damage calculation when the target has it except for Flipped if applicable.</p> <p>This condition also gives a -3 damage effect if the target has it.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sturdy/#doitemeffect","title":"DoItemEffect","text":"<p>This condition prevents the following effects from doing anything:</p> <ul> <li><code>AddPoison</code></li> <li><code>AddNumb</code></li> <li><code>AddFreeze</code></li> <li><code>AddSleep</code></li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Sturdy/#updateanim","title":"UpdateAnim","text":"<p>For all alive (<code>hp</code> above 0) player party members with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate may be set to 24 (<code>Block</code>). Check the method's documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Taunted/","title":"Taunted","text":"<p>A condition that prevents a player party member from selecting the <code>Skill</code>, <code>Item</code> and <code>Relay</code> vine menu Actions and prevents other player party member from relaying to them.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Taunted/#getchoiceinput","title":"GetChoiceInput","text":"<p>This condition prevents the following Actions option (the buzzer is played instead):</p> <ul> <li><code>Skill</code></li> <li><code>Item</code></li> <li><code>Relay</code> </li> </ul> <p>This condition will also deny the confirmation of another player party member's choice when selecting who to relay to when handling the <code>Relay</code> choice for a <code>SelectPlayer</code> action. Effectively, it means not only the condition prevents the player party member from relaying, it also prevents them to be relayed to.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Taunted/#setmaxoptions","title":"SetMaxOptions","text":"<p>This condition causes the vine icons for these Actions to render with the MainManager.<code>grayscale</code> material instead of MainManager.<code>spritedefaultunity</code>:</p> <ul> <li><code>Skill</code></li> <li><code>Item</code></li> <li><code>Relay</code> </li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Taunted/#clearstatus","title":"ClearStatus","text":"<p>This condition is excluded from removal meaning it will remain even after calling this method.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Taunted/#updateanim","title":"UpdateAnim","text":"<p>For all player party members  with an <code>hp</code> above 4 with this condition and whose battleentity.<code>overrideanim</code> is false, their battleentity.animstate may be set to AngryAnim which depends on the animid: 10 (<code>Flustered</code>) for <code>Bee</code>, 5 (<code>Angry</code>) for <code>Beetle</code> and 102 for <code>Moth</code>. Check the method's documentation for the exact conditions.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Taunted/#about-enemy-party-members","title":"About enemy party members","text":"<p>The <code>BeetleTaunt</code> skill allows to inflict this condition to an enemy party member, but it effectively doesn't do anything on its own for enemy party members because the effects described above only concerns the player party.</p> <p>Instead, the skill itself has logic to affect enemy party members: it sets the <code>forceattack</code> field to <code>currentturn</code> (the player party member using the <code>BeetleTaunt</code> skill). This has the only effect of changing the logic of GetRandomAvaliablePlayer to override its return to <code>forceattack</code> if <code>playerdata[forceattack].eatenby</code> is null (otherwise, it generates a random target ignoring the eaten player party member).</p> <p>The overall effect is enemy party members using this method in their action logic will be forced to target whoever used the skill. It implies the conditions doesn't make them do that, only the skill's action logic does.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Topple/","title":"Topple","text":"<p>A 1 hit defensive mechanism in the form of a condition for an enemy party member where if it has a <code>ToppleFirst</code> or <code>ToppleAirOnly</code> (if their <code>position</code> is <code>Flying</code>) weakness it won't get dropped or Flipped immediately when it was supposed to otherwise. Instead, this condition will be inflicted without the drop or flip featuring a <code>Woobly</code> animstate and it will be removed after most attacks which allows the drop or flip to occur on any subsequent hit.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Topple/#relay","title":"Relay","text":"<p>This condition will not be transfered to the target of the relay if the relayer had a <code>RelayTransfer</code> medal. It should be noted that it is not possible to inflict this condition on a player party member under normal gameplay so this clause effectively does nothing.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Topple/#doaction","title":"DoAction","text":"<p>Before an enemy party member acts, if it has this condition or Flipped for exactly 1 actor turn left, both are removed alongside the following logic:</p> <ul> <li>Jump is called on the enemy party member with a height of 10.0</li> <li>entity.<code>overrideanim</code> is set to false</li> <li>entity.<code>basestate</code> and entity.animstate is set to 0 (<code>Idle</code>)</li> <li>startstate is set to 0 (<code>Idle</code>)</li> <li>0.1 seconds are yielded</li> </ul>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Topple/#calculatebasedamage","title":"CalculateBaseDamage","text":"<p>This condition prevents toppling an enemy party members with a <code>ToppleFirst</code> or <code>ToppleAirOnly</code> AttackProperty in their weakness (because it would be redundant).</p> <p>This condition is removed if Freeze is inflicted.</p> <p>This condition is removed if the target has it, property is <code>Flip</code> while the target has a <code>Flip</code> and <code>ToppleFirst</code> weakness without the Flipped condition. It essentially acts as replacing <code>Topple</code> with <code>Flipped</code> in this case since it also inflicts Flipped. However, if the condition isn't present while the other conditions are fufilled, it is inflicted for 1 turn and on top of this, if the the target.<code>position</code> is <code>Ground</code>, battleentity.<code>basestate</code> is set to 21 (<code>Woobly</code>). </p> <p>This condition is removed if the damage calculation logic needs to drop the enemy party member. Check the method documentation to learn about the conditions for that to happen.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Topple/#drop","title":"Drop","text":"<p>For any enemy party member entity with this condition after the drop, it is removed alongside setting its <code>basestate</code> to 0 (<code>Idle</code>).</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Topple/#dodamageanim","title":"DoDamageAnim","text":"<p>This condition may cause the actor's battleentity.animstate and <code>basestate</code> to be set to 21 (<code>Woobly</code>) alongside setting <code>overrideanim</code> to false. Check the method's documentation to learn more.</p>"},{"location":"Battle%20system/Actors%20states/BattleCondition/Topple/#note-about-clearstatus","title":"Note about ClearStatus","text":"<p>This method will clear this condition, but it's not supposed to: it was mistakenly left out of the exclusion list. This means that when the condition gets cleared, the actor's animstate and <code>basestate</code> may still be left on 21 (<code>Woobly</code>) since this condition normally would cause reverting that upon removal, but this removal isn't supposed to happen.</p>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/ClearStatus/","title":"ClearStatus","text":"<p>This method will clear almost all conditions off an actor. The actor's BattleData is received as a ref to allow to reset the entire <code>condition</code> list.</p> <p>Before resetting the <code>conditions</code> list, <code>isnumb</code>, <code>isasleep</code> and isdefending are all set to false.</p> <p>The method then resets the <code>condition</code> list by removing everything except any of the following:</p> <ul> <li>EventStop</li> <li>Eaten</li> <li>Flipped</li> <li>Taunted</li> <li>Any condition whose turn count is above 99 (which only happens if the game manually placed it with the intent of being practically infinite), but this doesn't apply to Poison (meaning the condition inflicted as a result of the <code>EternalPoison</code> medal is removed despite this exception)</li> </ul> <p>After the reset:</p> <ul> <li>battleentity.<code>shieldenabled</code> is set to false</li> <li><code>charge</code> is set to 0</li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/HasCondition/","title":"HasCondition","text":"<p>This methods checks the presence of a condition and returns the amount of main turns left on it if it exist or -1 if it doesn't. It belongs to MainManager. This is the main way to check the presence of any conditions in the battle system.</p> <pre><code>public static int HasCondition(BattleCondition condition, BattleData entity)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/HasCondition/#parameters","title":"Parameters","text":"<ul> <li><code>condition</code>: The <code>BattleCondition</code> to check the presence of</li> <li><code>entity</code>: The actor to check the condition for</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/HasCondition/#procedure","title":"Procedure","text":"<p>The method goes over all <code>condition</code> elements of entity and if one is found with the condition sent, true is returned, false otherwise.</p> <p>There is a side effect to this method: if the actor has the Sleep condition, it may set its <code>isasleep</code> to true. Here is all the circumstances that will have that happen:</p> <ul> <li>Sleep was sent in as the condition</li> <li>We aren't looking for <code>Sleep</code>, but the condition we are looking for occurs after a <code>Sleep</code> one</li> <li>We are looking for a condition that doesn't exist</li> </ul> <p>This means that it is possible to have <code>isasleep</code> not be set to true if we are looking for a condition that occurs before a Sleep one. In that case, the method returns true without leaving a chance for <code>isasleep</code> to be set to true. In practice however, this doesn't cause any problems.</p>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/HealConditions/","title":"HealConditions","text":"<p>A method that receives an actor's BattleData as ref and does the following:</p> <ul> <li>Calls RemoveCondition with the Freeze condition on the actor</li> <li>Calls RemoveCondition with the Poison condition on the actor</li> <li>Calls RemoveCondition with the Numb condition on the actor</li> <li>Calls RemoveCondition with the Numb condition on the actor (it is done a second time)</li> <li>Set the actor's <code>isasleep</code> to false</li> <li>Set the actor's <code>isnumb</code> to false</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/RemoveCondition/","title":"RemoveCondition","text":"<p>This method removes a condition and also perform the associated side effects involved with removing it. It belongs to MainManager.</p> <p>NOTE: If multiple occurences of the condition exists, only the first one is removed.</p> <pre><code>public static void RemoveCondition(BattleCondition condition, BattleData entity)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/RemoveCondition/#parameters","title":"Parameters","text":"<ul> <li><code>condition</code>: The condition to remove if it exists</li> <li><code>entity</code>: The actor to remove the condition from</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/RemoveCondition/#procedure","title":"Procedure","text":"<p>The condition is searched and if it's not found, nothing happens.</p> <p>If it's found, some specific <code>BattleCondition</code> has a side effect for its removal that will be performed:</p> <ul> <li>Numb or Sleep: RefreshCondition is called on the actor's battleentity which updates the actor's <code>isasleep</code> and <code>isnumb</code> fields according to an HasCondition call for Numb and Sleep respectively.</li> <li>Freeze: The actor's entity (not its battleentity) has BreakIce called on it. NOTE: This is technically wrong because it calls the method on the overworld entity instead of the battle one, but this will effectively not do anything destructive since the <code>icecube</code> of the entity is null. It however means that the caller is instead responsible for calling the method correctly which the game does in every circumstances under normal gameplay.</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/SetCondition/","title":"SetCondition","text":"<p>This method is the prefered way to add or amend an existing condition. The vast majority of conditions are inflicted or amended using this method with some narrow exceptions. It belongs to MainManager.</p> <pre><code>public static void SetCondition(BattleCondition condition, ref BattleData entity, int turns, int fromplayer)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/SetCondition/#parameters","title":"Parameters","text":"<ul> <li><code>condition</code>: The condition to add/amend</li> <li><code>entity</code>: The actor to apply the condition</li> <li><code>turns</code>: The amount of main turns to set/amend the condition</li> <li><code>fromplayer</code>: UNUSED (there is an overload without it that sends -1)</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/SetCondition/#adding-a-condition","title":"Adding a condition","text":"<p>Adding a new condition is a simpler operation as it will be added regardless of the resistance to said condition with only some conditions having special effects. This means that for adding a condition, the caller is responsible for verifying the resistence check.</p> <p>Here are all the special effects for adding a condition (if the actor's battleentity has a <code>Player</code> tag, it is assumed to be a player party member, it is assumed to be an enemy party member otherwise):</p> Condition Additional effect Shield battleentity.<code>shieldenabled</code> is set to true. Also, If it's a player party member, the turn amount of the condition is set to 1 Poison If it's a player party member with a <code>EternalPoison</code> medal equipped, the turn amount of the condition is set to 99999 Freeze If it's not a player party member while isdefending is true, it is set to false Numb If it's not a player party member while isdefending is true, it is set to false. Also, <code>isnumb</code> is set to true Sleep If it's not a player party member while isdefending is true, it is set to false Any other conditions None <p>After the condition has been added, Abs is done on its actor turn amount forcing the amount to not be negative.</p>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/SetCondition/#amending-a-condition","title":"Amending a condition","text":"<p>Amending a condition requires the requested turns value to be above 0.</p> <p>If the turns value is negative, there's a different requirement and it is passing a ressitance test for the following conditions (it always pass for any other):</p> <ul> <li>Freeze: uses <code>freezeres</code></li> <li>Numb: uses <code>numbres</code></li> <li>Poison: uses <code>poisonres</code></li> <li>Sleep: uses <code>sleepres</code></li> </ul> <p>The test is performed by generating a number between 0.0 and 100.0 inclusive. For the test to pass, the number bust be strictly above the corresponding resistance. If the test fails, the condition won't be amended.</p>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/SetCondition/#problems-with-the-resistance-test","title":"Problems with the resistance test","text":"<p>However, this negative turns resistance test is in practice UNUSED and broken. The UNUSED part is because the only time SetCondition is called with a negative turns is when processing certain item's effects:</p> <ul> <li><code>ShavedIce</code> (its <code>AddFreeze</code>)</li> <li><code>HoneyIceCream</code> (its <code>AddFreeze</code>)</li> <li><code>IceCream</code> (its <code>AddFreeze</code>)</li> <li><code>FrozenSalad</code> (its <code>AddFreeze</code>)</li> <li><code>FrostPie</code> (its <code>AddFreeze</code>)</li> <li><code>DrowsyCake</code> (its <code>AddPoison</code>)</li> </ul> <p>But DoItemEffect won't actually allow the SetCondition call for these effects if any of the appropriate resistance medals are equipped and it turns out this is the only way in practice to increase the resistance fields of a player party member. What this means is in any cases, even if the turns count was negative, the test always passes. This only matters if a negative turns value is passed to SetCondition in other cases than DoItemEffect outside of normal gameplay.</p> <p>But if it does, there's several problems where the logic is incorrect. Most of the issues is this resistance test differs greatly from CalculateBaseDamage because ONLY the resistance check is performed while the damage pipeline performs several other checks.</p> <p>It is speculated that this feature was left unfinished as an older attempt of implementing user infliction and it can be considered broken in its current state. While the game can run into it with some specific item use, in practice, it doesn't do anything of note by coincidence. Still, in essence, negative turns amount should be considered invalid.</p>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/SetCondition/#when-turns-is-above-0-or-the-negative-turns-test-pass","title":"When turns is above 0 or the negative turns test pass","text":"<p>If the requirements are met, the condition will be amended, but how this occurs depends on the condition itself. Some may allow stacking the actor turns, some conditionally and some never. Also, some conditions implicates special side effects.</p> <p>The following table summarises the logic for all conditions (stacking means increasing the existing actor turn amount by the requested one unless otherwise specified and not stacking means to set the amount to the requested one unless otherwise specified):</p> Condition Stacked for a <code>Player</code>? Stacked for a non <code>Player</code>? Other effects AttackUp Yes Yes None DefenseUp Yes Yes None AttackDown Yes Yes None DefenseDown Yes Yes None GradualHP Yes Yes None GradualTP Yes Yes None Fire Yes (by half the requested amount of main turns ceiled) Yes (by half the requested amount of main turns ceiled) None poison Yes if it has the <code>EternalPoison</code> medal equipped which makes it set to 99999 regardless of the requested amount of main turns Yes None Freeze Only if currentchoice is <code>Item</code> (meaning the player party used an item on itself), the condition isn't amended if it already had the requested amount of main turns or more No For an enemy party member, isdefending is set to false Numb Only if currentchoice is <code>Item</code> (meaning the player party used an item on itself), the condition isn't amended if it already had the requested amount of main turns or more No For an enemy party member, isdefending is set to false. Also, <code>isnumb</code> is set to true Sleep Only if currentchoice is <code>Item</code> (meaning the player party used an item on itself), the condition isn't amended if it already had the requested amount of main turns or more No For an enemy party member, isdefending is set to false Shield No, the turn amount is always set to 1 regardless of the requested one No battleentity.<code>shieldenabled</code> is set to true Any other conditions No No None <p>After the condition has been amended, its turn amount is clamped from 0 to 999999.</p>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/StatusEffect/","title":"StatusEffect","text":"<p>This method is kind of a wrapper around SetCondition because it does end up calling it after a resistance check if applicable, but it also renders visually the conditions being applied by a colored arrow thanks to StatEffect.</p> <pre><code>private void StatusEffect(MainManager.BattleData data, MainManager.BattleCondition status, int turns, bool effect)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/StatusEffect/#parameters","title":"Parameters","text":"<ul> <li><code>data</code>: The actor to attempt to inflict the condition</li> <li><code>status</code>: The condition to attempt to inflict the actor</li> <li><code>turns</code>: The amount of main turns to inflict the condition</li> <li><code>effect</code>: Whether the infliction should include a visual render. There is an overload where this can be ommited and it will send false</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/StatusEffect/#procedure","title":"Procedure","text":"<p>If applicable, a resistence check will be performed. The test will be performed by generating a random integer in the range [0, 100[ and check if the number is strictly higher than the matching resistance. However, if the resistance is 100 or above, the test always fails.</p> <p>NOTE: this test is off by one numerically: a 50 resistance actually means a 49% change to inflict for example. This is because doing a strictly higher than comparison splits the ranges like such that the fail group is [0, resistance] and the success group is ]resistance, 100[, but they should be split to [0, resistance[ and [resistance, 100[ respectively. This means for a given resistance, the chance to inflict in percentage is 100 - resistance - 1 instead of 100 - resistance.</p> <p>Here are the statuses where the test is applicable and which resistance will be used for each:</p> <ul> <li>Freeze: <code>freezeres</code></li> <li>Numb: <code>numbres</code></li> <li>Poison: <code>poisonres</code></li> <li>Sleep: <code>sleepres</code></li> </ul> <p>If the test fails, nothing happens and a return happens immediately.</p> <p>If it succeeds, SetCondition is called with the actor, condition and amount of actor turns.</p> <p>The method is done if effect is false.</p> <p>If it's true, a StatEffect coroutine will be started if applicable with a type followed by a certain sound being played if it wasn't already depending on the condition.</p> <p>Here are the conditions and how the visual effect is done (other conditions don't have visual effects):</p> <ul> <li>AttackUp: Type 0 with the <code>StatUp</code> sound</li> <li>AttackDown: Type 2 with the <code>StatDown</code> sound</li> <li>DefenseUp: Type 1 with the <code>StatUp</code> sound</li> <li>DefenseDown: Type 3 with the <code>StatDown</code> sound</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/TryConditions/","title":"TryCondition","text":"<p>A method that is only used by NeedlerPincer to attempt to inflict conditions as part of the NeedleToss and NeedlePincer actions (with caveats and dead logic, see below to learn more).</p> <p>It functions similarily than the infliction logic of  CalculateBaseDamage, but it has several differences (even new issues) and it doesn't support all conditions that the damage pipeline supports.</p> <pre><code>private void TryCondition(ref MainManager.BattleData data, MainManager.BattleCondition condition, int turns)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/TryConditions/#supported-conditions","title":"Supported conditions","text":"<p>It only supports the following conditions (the method does nothing for any other):</p> <ul> <li>Freeze (never used under normal gameplay), requires passing a resistance check with the target's <code>freezeres</code> for infliction</li> <li>Fire (never used under normal gameplay), requires the same conditions then CalculateBaseDamage, but without the block check or Sturdy check for infliction</li> <li>Sleep, requires passing a resistance check with the target's <code>sleepres</code> for infliction</li> <li>Numb, requires passing a resistance check with the target's <code>numbres</code> for infliction</li> <li>Poison, requires passing a resistance check with the target's <code>poisonres</code> for infliction</li> </ul>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/TryConditions/#resistance-check-differences","title":"Resistance check differences","text":"<p>The resistance check does have logic to take into account player infliction including logic to reduce the corresponding resistance by 15 if the <code>StatusBoost</code> medal is equipped on the target, but this logic is never used under normal gameplay. This is because the method is only used when the player attacks an enemy and in these cases, the enemy is the target.</p>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/TryConditions/#issue-with-the-resistance-checks","title":"Issue with the resistance checks","text":"<p>NOTE: All these resistance checks are off by 1. It means that the chance of infliction is always 1% less than it should be. It implies that a 50 resistance is actually 49% chance to inflict and that a 0 resistance is a 99% chance to inflict instead of 100%</p>"},{"location":"Battle%20system/Actors%20states/Conditions%20methods/TryConditions/#infliction-logic-differences","title":"Infliction logic differences","text":"<p>The following are all differences with CalculateBaseDamage regarding infliction:</p> <ul> <li>Freeze (never used under normal gameplay):<ul> <li>If the target has the Topple condition, it is never removed</li> <li>The target will never have Drop called on it even if its position is <code>Ground</code> with a <code>height</code> above 0.05</li> <li>The infliction is done directly with SetCondition rather than AddDelayedCondition</li> <li>UpdateAnim is called at the end</li> </ul> </li> <li>Fire (never used under normal gameplay):<ul> <li>UpdateAnim is called at the end</li> </ul> </li> <li>Sleep:<ul> <li>The target's <code>sleepres</code> increase is 8 instead of 9 (10 instead of 13 on HardMode)</li> <li>The target will never have Drop called on it even if its position is <code>Ground</code> with a <code>height</code> above 0.05</li> <li>The infliction is done directly with SetCondition rather than AddDelayedCondition</li> <li>UpdateAnim is called at the end</li> </ul> </li> <li>Numb:<ul> <li>On HardMode the target's <code>numbres</code> increase is 20 instead of 22. It remains at 17 otherwise</li> <li>The target's <code>cantmove</code> is always set to 1, even if its actimmobile is true</li> <li>The target will never have Drop called on it even if its position is <code>Ground</code> with a <code>height</code> above 0.05</li> <li>The infliction is done directly with SetCondition rather than AddDelayedCondition</li> <li>UpdateAnim is called at the end</li> </ul> </li> <li>Poison: <ul> <li>There is now a <code>poisonres</code> increase by 5 (8 instead when on HardMode)</li> <li>UpdateAnim is called at the end</li> </ul> </li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/AddNewEnemy/","title":"AddNewEnemy","text":"<p>This is a method that will initialise a new enemy and add it to <code>enemydata</code>.</p> <p>There are 3 overloads available:</p> <p>(1)</p> <pre><code>private Transform AddNewEnemy(int id, Vector3 position)\n</code></pre> <p>(2)</p> <pre><code>private Transform AddNewEnemy(int id, Vector3 position, SpawnAnim animation)\n</code></pre> <p>Ends up doing (1) if animation is <code>None</code> (0)</p> <p>(3)</p> <pre><code>private Transform AddNewEnemy(int id, EntityControl entity)\n</code></pre> <p>NOTE: This overload is unused under normal gameplay. It is similar to (1), but it will not be documented due to older logic</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/AddNewEnemy/#parameters","title":"Parameters","text":"<ul> <li><code>id</code>: The enemy id to add</li> <li><code>position</code>: Where the enemy should initialy be spawned</li> <li><code>animation</code>: If it's not <code>None</code> (0), NewEnemy will be called instead followed by a frame yield (the method ends up calling (1), but it has more logic afterwards). If it's <code>None</code> (0), it ends up being the same as (1)</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/AddNewEnemy/#procedure","title":"Procedure","text":"<p>Since all overloads ends up doing (1), this is the procedure that will be documented. Null is returned immediately if <code>enemydata</code> already has 4 elements or more (it's full, this doesn't handle <code>extraenemies</code>).</p> <ul> <li>A new <code>BattleData</code> is obtained from GetEnemyData with createentity. From now own, the enemy refered to is the new one</li> <li>battleentity's position is set to the sent position</li> <li>battleentity.<code>battleid</code> is set to the length of <code>enemydata</code></li> <li>battleentity is childed to <code>battlemap</code></li> <li>battleentity.<code>hologram</code> is set to the value of flags 162 (Using the B.O.S.S system or during a Cave of Trials session)</li> <li>If the current map is <code>CaveOfTrials</code> and the matching bestiary entry has a seen counter of 0:<ul> <li>battleentity.<code>cotunknown</code> is set to true</li> <li>ForceCOT is called on the battleentity</li> <li>RefreshCOT is invoked in 0.1 seconds on the battleentity</li> </ul> </li> <li>The new enemy is added to <code>enemydata</code> at the end</li> <li>If <code>animid</code> (the enemy id) is less than the length of instance.<code>enemyencounter</code> (normally 256) and battleentity.<code>cotunknown</code> is false, the view count of the matching bestiary entry is incremented</li> <li><code>lastaddedid</code> is set to the the <code>enemydata</code> index matching the enemy that was just added</li> <li>The enemy's battleentity.transform is returned</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/DropItem/","title":"DropItem","text":"<p>This method will make an enemy party member drop its <code>helditem</code> and reset <code>holditem</code> accordingly. Check the feature documentation to learn more.</p> <pre><code>private void DropItem(ref MainManager.BattleData target, bool additem)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/DropItem/#parameters","title":"Parameters","text":"<ul> <li><code>target</code>: The enemy party member to have its <code>helditem</code> dropped. NOTE: it is invalid to send a player party member</li> <li><code>additem</code>: Whether or not the <code>holditem</code> should be added to <code>items[0]</code> (standard items inventory) before its drop</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/DropItem/#procedure","title":"Procedure","text":"<ul> <li>The <code>Fall</code> sound is played</li> <li>If additem is true, the enemy party member has a <code>holditem</code> and the amount of <code>items[0]</code> (standard items) is less than instance.<code>maxitems</code>, the <code>holditem</code> is added to <code>items[0]</code></li> <li>The enemy party member's <code>holditem</code> is set to -1</li> <li>ItemDrop is called with the enemy party member's <code>helditem</code> which does the following:<ul> <li>Root <code>helditem</code> to the scene</li> <li>Add a RigidBody to <code>helditem</code> with a velocity of RandomItemBounce(5.0, 12.5)</li> <li><code>helditem</code> gets destroyed in 1.0 second</li> </ul> </li> <li><code>helditem</code> is set to null</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/NewEnemy/","title":"NewEnemy","text":"<p>This coroutine is a wrapper around AddNewEnemy in syntax (1) that ends up doing more spawn logic after.</p> <pre><code>private IEnumerator NewEnemy(int id, Vector3 pos, SpawnAnim animation)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/NewEnemy/#parameters","title":"Parameters","text":"<ul> <li><code>id</code>: The enemy id to add</li> <li><code>position</code>: Where the enemy should initialy be spawned</li> <li><code>animation</code>: If it's not <code>None</code> (1 or 2), the spawn animation to use for the new enemy. If it's <code>None</code> (0), the coroutine only calls AddNewEnemy and set <code>checkingdead</code> to null</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/NewEnemy/#procedure","title":"Procedure","text":"<p>AddNewEnemy is called with the id and position and store the entity locally.</p> <p>If animation is <code>None</code> (0), the coroutine is done as it only sets <code>checkingdead</code> to null before ending</p> <p>Otherwise, the following occurs (the entity refered to is the new enemy just added):</p> <ul> <li>The <code>Charge</code> sound is played</li> <li>If entity.<code>cotunknown</code> is true:<ul> <li>ForceCOT is called on the entity</li> <li><code>spritebasecolor</code> is set to be pure black at 50% opacity</li> </ul> </li> <li>The entity local scale is zeroed out</li> <li><code>spin</code> is set to (0.0, 25.0, 0.0)</li> <li>During the course of 60.0 frames tracked with a local frame counter (incremented by the game's frametime):<ul> <li>entity.animstate is set to 11 (<code>Hurt</code>)</li> <li>entity's local scale is set to a lerp from Vector3.zero to a target that depends on the animation with a factor of the ratio of the amount of frames cumulated over 60.0 frames. The target is Vector3.one for an animation of <code>Seed</code> (1) and (0.75, 0.75, 0.75) for <code>SeedMini</code> (2)</li> <li>The local framecounter is advanced</li> <li>A frame is yielded</li> </ul> </li> <li><code>startscale</code> is set to Vector3.one</li> <li><code>sprite</code> local scale is set to the same target used for the lerping above</li> <li><code>spin</code> is zeroed out</li> <li>animstate is set to 0 (<code>Idle</code>)</li> <li>If animation is <code>SeedMini</code> (2), <code>hpbar</code> local scale is increased by (0.25, 0.25, 0.25)</li> <li><code>tempslot</code> is set to the last <code>enemydata</code></li> <li><code>checkingdead</code> is set to null and the coroutine ends</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/ReorganizeEnemies/","title":"ReorganizeEnemies","text":"<p>This is a method that will reorder <code>enemydata</code> to a specific list of enemy ids or remove <code>dead</code> or fled enemy party members as well as perform other sanitisation on <code>enemydata</code>.</p> <p>There are 4 overloads available:</p> <p>(1)</p> <pre><code>private void ReorganizeEnemies()\n</code></pre> <p>Ends up doing (2) with a skip of -1</p> <p>(2)</p> <pre><code>private void ReorganizeEnemies(int skip)\n</code></pre> <p>(3)</p> <pre><code>private void ReorganizeEnemies(bool order)\n</code></pre> <p>If order is false, it ends up being the same as (1)</p> <p>(4)</p> <pre><code>private void ReorganizeEnemies(int[] order)\n</code></pre> <p>This reorders <code>enemydata</code> instead of sanitizing it</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/ReorganizeEnemies/#parameters","title":"Parameters","text":"<ul> <li><code>skip</code>: The <code>enemydata</code> to skip adding no matter what, -1 to not skip any elements. NOTE: -1 is always sent under normal gameplay</li> <li><code>order</code>: This depends on the overload used:<ul> <li>For (3), if true, <code>enemydata</code> will be ordered by battleentity's x position and the only ones kept are the one where EnemyAlive returns true (the index is valid, the <code>hp</code> is above 0, battleentity isn't <code>dead</code> or <code>kill</code> and battleentity.<code>deathcoroutine</code> isn't in progress)</li> <li>For (4), the new desired ordering of the eneny ids. The array must be the same length as <code>enemydata</code> or nothing happens</li> </ul> </li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/ReorganizeEnemies/#procedure","title":"Procedure","text":"<p>(1) / (2) removes all enemy party members whose <code>hp</code> is 0 or below, their index isn't skip and they haven't fled. This is followed by calling SetBEntityIDs which updates all the <code>enemydata</code>'s battleentity.<code>battleid</code> to their new one.</p> <p>(3) does the same as (1) if order is false. If it's true, it removes all enemy party members where EnemyAlive returns false which happens if any of the following is true:</p> <ul> <li>The <code>enemydata</code> index is invalid</li> <li>The <code>hp</code> is 0 or below</li> <li>battleentity is <code>dead</code> or <code>kill</code> </li> <li>battleentity.<code>deathcoroutine</code> is in progress</li> </ul> <p>From there, <code>enemydata</code> is ordered by battleentity's x position.</p> <p>(4) doesn't sanitize <code>enemydata</code>, but rather reorders it. The order is given by order and it's done by enemy ids. If the length of order isn't the same than <code>enemydata</code>, nothing happens.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/","title":"SummonEnemy","text":"<p>This is a coroutine that allows to create an enemy and to add it to <code>enemydata</code> during the battle.</p> <p>There are 2 overloads:</p> <p>(1)</p> <pre><code>private IEnumerator SummonEnemy(SummonType type, int enemyid, Vector3 position)\n</code></pre> <p>This one ends end starting (2) with cantmove as false followed by a frame yield.</p> <p>(2)</p> <pre><code>private IEnumerator SummonEnemy(SummonType type, int enemyid, Vector3 position, bool cantmove)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#parameters","title":"Parameters","text":"<ul> <li><code>type</code>: The type of summon to use which describes the method the enemy should appear</li> <li><code>enemyid</code>: The enemy id to summon</li> <li><code>position</code>: The position the enemy should appear in battle</li> <li><code>cantmove</code>: If true, the starting <code>cantmove</code> value of the new enemy will be 1 (meaning one actor turn will need to pass for the enemy to act)</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#summontype","title":"SummonType","text":"<p>This is an enum that tells the behavior to have when summoning in this method (see the procedure for details):</p> Value Name Description 0 FromGround The screen is shook twice followed by the enemy appears from the ground with a final <code>startscale</code> of (1.15, 1.15, 1.15) 1 Offscreen The enemy appears by a movetowards call from the right offscreen 2 OffscreenNoAnim The same than <code>Offscreen</code>, but the position is lerped instead of a movetowards call 3 None No specific summoning logic occurs 4 FromGroundInstant An alias of <code>FromGround</code> 5 Raise The same than <code>OffscreenNoAnim</code>, but the enemy appears from the bottom of the screen 6 FromGroundKeepScale The same than <code>FromGround</code>, but the final <code>startscale</code> is the one from endata 7 Tablet The position to summon is overriden to (50.0, 50.0, 0.0)"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#procedure","title":"Procedure","text":"<p>There's 3 sections to this coroutine: </p> <ul> <li><code>SummonType</code> pre add logic</li> <li>Adding the enemy</li> <li><code>SummonType</code> post add logic</li> <li>Last adjustements</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#summontype-pre-logic","title":"<code>SummonType</code> pre logic","text":"<p>The logic depends on the sent type:</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#fromground-fromgroundkeepscale","title":"<code>FromGround</code> / <code>FromGroundKeepScale</code>","text":"<ul> <li>ShakeScreen is called for 0.5 seconds</li> <li>0.5 seconds are yielded</li> <li>ShakeScreen is called again with an ammount of (0.2, 0.2, 0.2) for 0.1 seconds</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#offscreen-offscreennoanim","title":"<code>Offscreen</code> / <code>OffscreenNoAnim</code>","text":"<ul> <li>The x/y position is overriden to 20.0 and 0.0 respectively</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#raise","title":"<code>Raise</code>","text":"<ul> <li>The y position is overriden to position.y - 20.0</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#tablet","title":"<code>Tablet</code>","text":"<ul> <li>The position is overriden to (50.0, 50.0, 0.0)</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#adding-the-enemy","title":"Adding the enemy","text":"<p>AddNewEnemy is called with the enemyid and the position (or the overriden one if applicable). The EntityControl of the new enemy is tracked locally.</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#summontype-post-add-logic","title":"<code>SummonType</code> post add logic","text":"<p>The logic depends on the sent type (all position refers to the original sent value, not the overriden one unless stated otherwise. Additionally, the entity reffered to is the new enemy entity stored locally):</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#tablet_1","title":"<code>Tablet</code>","text":"<ul> <li><code>TabletSpawn</code> particles are played at the position + (0.0, entity.<code>height</code>, 0.0) for 0.5 seconds</li> <li>0.5 seconds are yielded</li> <li>The <code>Woosh6</code> sound is played</li> <li>DeathSmoke particles are played at the position + (0.0, entity.<code>height</code>, 0.0)</li> <li>ShakeScreen is called with an ammount of 0.1 for 0.5 seconds with dontreset</li> <li>The position is set to the sent position</li> <li>SlowSpinStop is called on the entity with a spinammount of (0.0, 30.0, 0.0) for 60.0 frames</li> <li>A second is yielded</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#fromground-fromgroundinstant","title":"<code>FromGround</code> / <code>FromGroundInstant</code>","text":"<ul> <li>DeathSmoke paricles are played at the entity position</li> <li>entity.<code>startscale</code> is zeroed out</li> <li>entity.<code>sprite</code> local scale is set to entity.<code>startscale</code></li> <li>A frame is yielded</li> <li>If the entity has a model, entity.<code>model</code> local scale is set to entity.<code>modelscale</code></li> <li>If enemyid isn't a <code>PitcherFlytrap</code> enemy, entity.animstate is set to 101</li> <li>entity.<code>spin</code> is set to (0.0, 20.0, 0.0)</li> <li>During the course of 30.0 frames tracked with a local frame counter (incremented by the game's frametime):<ul> <li>entity.<code>startscale</code> is set to a lerp from Vector3.zero to (1.15, 1.15, 1.15) with a factor of the ratio of the amount of frames cumulated over 30.0 frames</li> <li>entity.<code>sprite</code> local scale is set to entity.<code>localscale</code></li> <li>The local framecounter is advanced</li> <li>A frame is yielded</li> </ul> </li> <li>entity.<code>startscale</code> is set to (1.15, 1.15, 1.15)</li> <li>entity.<code>spin</code> is zeroed out</li> <li>0.5 seconds are yielded</li> <li>entity.animstate is set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#fromgroundkeepscale","title":"<code>FromGroundKeepScale</code>","text":"<p>The same than <code>FromGround</code> / <code>FromGroundInstant</code>, but instead of having a final scale of (1.15, 1.15, 1.15) grown smoothly, the target scale is the <code>startscale</code> from endata</p>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#offscreen","title":"<code>Offscreen</code>","text":"<ul> <li>A frame is yielded</li> <li>entity.<code>rigid</code> has its gravity disabled</li> <li>MoveTowards is called on the entity to the sent position with a 2.0 multiplier</li> <li>All frames are yielded while the entity is in a <code>forcemove</code></li> <li>entity.<code>rigid</code> has its gravity enabled</li> <li>entity position is set to the sent position</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#offscreennoanim-raise","title":"<code>OffscreenNoAnim</code> / <code>Raise</code>","text":"<ul> <li>A frame is yielded</li> <li>entity.<code>rigid</code> has its gravity disabled</li> <li>During the course of 101.0 frames tracked with a local frame counter (incremented by the game's frametime):<ul> <li>entity's position is set to a lerp from the position (or the overriden one if applicable) to the sent position (not the overriden one) with a factor of the ratio of the amount of frames cumulated over 101.0 frames</li> <li>The local framecounter is advanced</li> <li>A frame is yielded</li> </ul> </li> <li>entity.<code>rigid</code> has its gravity enabled</li> <li>entity's position is set to the sent position</li> </ul>"},{"location":"Battle%20system/Actors%20states/Enemy%20party%20members/SummonEnemy/#last-adjustements","title":"Last adjustements","text":"<ul> <li>If the sent cantmove is true, <code>enemydata[lastaddedid].cantmove</code> is set to 1 (one actor turn will need to pass for the enemy party member to act)</li> <li>If <code>summonnewenemy</code> is false, <code>checkingdead</code> is set to null</li> <li><code>summonnewenemy</code> is set to false</li> </ul>"},{"location":"Battle%20system/Actors%20states/Player%20party%20members/GetFreePlayerAmmount/","title":"GetFreePlayerAmmount","text":"<p>This method returns the amount of <code>playerdata</code> that are considered free. It belongs to MainManager.</p> <p>This amount includes all player party members have the following criteria:</p> <ul> <li><code>cantmove</code> is 0 or below (at least one action is available)</li> <li><code>hp</code> is above 0 (the player isn't dead)</li> <li>It does not have any of the following conditions:<ul> <li>Sleep</li> <li>Numb</li> <li>Freeze</li> <li>EventStop</li> <li>Eaten</li> </ul> </li> </ul>"},{"location":"Battle%20system/Actors%20states/Player%20party%20members/RevivePlayer/","title":"RevivePlayer","text":"<p>This method properly revive a player party member.</p> <pre><code>private void RevivePlayer(int id, int hp, bool showcounter)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Player%20party%20members/RevivePlayer/#parameters","title":"Parameters","text":"<ul> <li><code>id</code>: The <code>playerdata</code> index to revive</li> <li><code>hp</code>: The <code>hp</code> to set the player party member. If it's negative, the <code>hp</code> will not be changed. NOTE: this should only be done when something else is guaranteed to heal the player party member as failure to do so will lead the <code>hp</code> left dangling at 0 while the actor isn't fully dead</li> <li><code>showcounter</code>: Whether to call Heal or not as part of the <code>hp</code> increase</li> </ul>"},{"location":"Battle%20system/Actors%20states/Player%20party%20members/RevivePlayer/#procedure","title":"Procedure","text":"<ul> <li>battleentity.<code>dead</code> is set to false</li> <li>battleentity.<code>iskill</code> is set to false</li> <li>battleentity has LockRigid(false) called on it which unlocks its <code>rigid</code></li> <li>battleentity.<code>shadow</code> is enabled</li> <li>battleentity.<code>nocondition</code> is set to false</li> <li>The <code>playerdata</code>'s <code>turnssincedeath</code> is set to 0</li> <li>If the player party member is included in <code>deadmembers</code>:<ul> <li>The <code>playerdata</code>'s <code>cantmove</code> is set to 0 (one action available) unless <code>enemy</code> is true (we are in the enemy phase or later) where it's set to 1 instead (one actor turn is needed for an action to be available)</li> <li>ClearStatus is called on the player party member</li> <li>The <code>playerdata</code>'s <code>moreturnnextturn</code> is set to 0</li> <li>The <code>playerdata</code>'s <code>tired</code> is set to 0</li> <li>battleentity.animstate is set to 13 (<code>BattleIdle</code>)</li> </ul> </li> <li>If the sent hp isn't negative:<ul> <li>If showcounter is false, the player party member's <code>hp</code> is increased by the sent hp clamped from 0 to its <code>maxhp</code></li> <li>Otherwise, Heal is called on the player party member with the sent hp amount to heal</li> </ul> </li> <li>If battleentity.<code>deathcoroutine</code> is in progress, it is stopped</li> <li>battleentity.<code>deathcoroutine</code> is set to null</li> <li>A ReviveFix coroutine is started with the id sent which will do the following:<ul> <li>0.5 seconds are yielded</li> <li>If battleentity.<code>deathcoroutine</code> is in progress, it is stopped</li> <li>battleentity.<code>deathcoroutine</code> is set to null</li> <li>battleentity.<code>dead</code> is set to false</li> <li>battleentity.<code>iskill</code> is set to false</li> <li>battleentity has LockRigid(false) called on it which unlocks its <code>rigid</code></li> <li>battleentity.<code>shadow</code> is enabled</li> </ul> </li> <li>UpdateAnim is called</li> </ul>"},{"location":"Battle%20system/Actors%20states/Targetting/GetAvaliableTargets/","title":"GetAvaliableTargets","text":"<p>This method updates <code>avaliabletargets</code> and refreshes the enemy positions when applicable</p> <pre><code>private void GetAvaliableTargets(bool onlyground, bool onlyfront, int attackid, bool excludeunderground)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Targetting/GetAvaliableTargets/#parameters","title":"Parameters","text":"<ul> <li><code>onlyground</code>: Only include enemy party members with a position of <code>Ground</code> (or <code>Underground</code> if excludeunderground is false)</li> <li><code>onlyfront</code>: Only the first eligible enemy party member will be included</li> <li><code>attackid</code>: The skill id or a negative number denoting a player party member's basic attack (-1 is <code>Bee</code>'s, -2 is <code>Beetle</code>'s and -3 is <code>Moth</code>'s)</li> <li><code>excludeunderground</code>: Excludes all enemies with a position of <code>Underground</code> when <code>onlyground</code> is true. There is an overload without this parameter that sends false</li> </ul>"},{"location":"Battle%20system/Actors%20states/Targetting/GetAvaliableTargets/#procedure","title":"Procedure","text":"<p>There is a simpler case that is checked first.</p> <p>If currentaction is <code>SkillList</code> and the AttackArea of the skill from skilldata is <code>AllParty</code> or <code>SingleAlly</code>, <code>availabletargets</code> is set to <code>playerdata</code> which ends the method.</p> <p>Otherwise:</p> <ul> <li>RefreshEnemyPos is called which checks all enemy party members whose <code>hp</code> is above 0, whose cantfall is false and whose position is <code>Ground</code> or <code>Flying</code>. If the enemy battleentity.<code>height</code> is above battleentity.<code>minheight</code> + 0.5, the position is set to <code>Flying</code>, <code>Ground</code> otherwise</li> <li>Each enemy party members is checked if it should be included in <code>avaliabletargets</code>. In order for the enemy to be included, all of the following must be true (on top of this, if onlyfront is true, only the first one found is included and the rest skipped):<ul> <li>Its position isn't <code>OutOfReach</code></li> <li>UndergroundCheck returns true for the attackid and the enemy position which only happens if the <code>position</code> isn't <code>Underground</code> or the attackid is among the following: -3 (<code>Moth</code>'s basic attack), 21 (<code>FrigidCoffin</code>), 6 (<code>BeetleDig</code>), 27 (<code>IceDrill</code>), 18 (<code>HurricaneBeemerang</code>)</li> <li>The parameters clauses are fufillfed which is checked using the following rules in order:<ul> <li>If onlyground is false, it is included</li> <li>Otherwise, if the position is <code>Ground</code>, it is included</li> <li>Otherwise, excludeunderground must be false while position is <code>Underground</code></li> </ul> </li> </ul> </li> <li><code>avaliabletargets</code> is initialised to all the enemy party members included earlier</li> </ul>"},{"location":"Battle%20system/Actors%20states/Targetting/GetRandomAvaliablePlayer/","title":"GetRandomAvaliablePlayer","text":"<p>This method obtains a suitable player party member index using the regular targetting rules.</p> <pre><code>private int GetRandomAvaliablePlayer(bool nullable)\n</code></pre>"},{"location":"Battle%20system/Actors%20states/Targetting/GetRandomAvaliablePlayer/#parameters","title":"Parameters","text":"<ul> <li><code>nullable</code>: If true, this will use an alternative targetting scheme that may return -1 meaning to not target anyone. There is an overload without this that behaves the same as if false was sent. NOTE: The true version has broken logic, see the section below for details.</li> </ul>"},{"location":"Battle%20system/Actors%20states/Targetting/GetRandomAvaliablePlayer/#procedure","title":"Procedure","text":"<p>The logic depends on nullable's value</p>"},{"location":"Battle%20system/Actors%20states/Targetting/GetRandomAvaliablePlayer/#nullable-is-true","title":"nullable is true","text":"<p>If <code>forceattack</code> isn't -1, it is returned.</p> <p>Otherwise, there will be attempts to find a random player party member to target. Each attempt involves generating a random one using uniformly random probabilities between each of them. For the target to be accepted, its <code>hp</code> must be above 0. The amount of times this is attempted is the amount of player party members. If a target is accepted it is returned, otherwise, -1 is returned and the caller has to handle this logic since no one will be targetted.</p>"},{"location":"Battle%20system/Actors%20states/Targetting/GetRandomAvaliablePlayer/#problems-with-nullable-true-logic","title":"Problems with nullable true logic","text":"<p>There are some issues with this logic compared to the nullable false version which are bad enough to be considered broken:</p> <ul> <li>This scheme fails to account for the front player party member meaning it does not matter who is in the front</li> <li>This scheme fails to account for the <code>LeafCloak</code> medal even when it is equipped meaning it does not matter if it is equipped on someone or not</li> <li>This scheme may not return a valid target which may force the caller to abort the attack or to try again, but there is never a guarantee that an accepted target is returned</li> <li>This scheme fails to account for the eatenby (Only would have mattered for a <code>Pitcher</code> enemy, but they do not use this targetting scheme under normal gameplay)</li> </ul> <p>However, some enemies intentionally uses it in their action codes. The following enemies involves it at least once as part of their DoAction logic:</p> <ul> <li><code>WildChomper</code> (via SpitSeed)</li> <li><code>ChomperBrute</code> (via SpitSeed)</li> <li><code>VenusBoss</code> (called directly and via ShakeSeed)</li> <li><code>TANGYBUG</code> (via ShakeSeed)</li> <li><code>SeedlingKing</code> (via ShakeSeed)</li> <li><code>BeeTurret</code></li> <li><code>BeeBoss</code></li> <li><code>FalseMonarch</code></li> <li><code>MidgeBroodmother</code></li> <li><code>UltimaxTank</code></li> <li><code>MotherChomper</code></li> </ul> <p>Despite the game using it under normal gameplay, it is highly recommended to never pass true to the nullable parameter. It fails to account for too much and it can lead to undesired logic where the caller might not be able to find a suitable target.</p>"},{"location":"Battle%20system/Actors%20states/Targetting/GetRandomAvaliablePlayer/#nullable-is-false","title":"nullable is false","text":"<p>If <code>forceattack</code> isn't -1 and the player party member coresponding to it doens't have an <code>eatenby</code>, it is returned.</p> <p>Otherwise, there is an infinite loop that starts:</p> <ul> <li>A random <code>partypointer</code> element (a <code>playerdata</code> index) is generated by generating a number from -2 (inclusive) to the amount of player party members (exclusive) clamped from 0 to the amount of player party members (this essentially biases to target the first party member more)</li> <li>If the player party member's <code>hp</code> is 0 or its <code>eatenby</code> exists, the target is rejected and the loop restarts</li> <li>Otherwise, if the player party member has the <code>LeafCloak</code> medal equipped, the target is rejected, but this can only happen once: if another target passes the <code>hp</code> and <code>eatenby</code> checks, it is automatically accepted and returned</li> <li>Otherwise, the target is accepted and returned</li> </ul> <p>The overall targetting odds are as follows:</p> Amount of player party members Who has <code>LeafCloak</code>? Odds front Odds second Odds third 2 No one 3/4 1/4 N/A 2 Front 9/16 7/16 N/A 2 Second 15/16 1/16 N/A 3 No one 3/5 1/5 1/5 3 Front 9/25 8/25 8/25 3 Second 18/25 1/25 6/25 3 Third 18/25 6/25 1/25"},{"location":"Battle%20system/Actors%20states/Targetting/GetRandomAvaliablePlayer/#getsingletarget","title":"GetSingleTarget","text":"<p>There is a parameterless method that ends up calling GetRandomAvailablePlayer with nullable to false. That method is called GetSingleTarget.</p> <p>The only thing it does is take the return of GetRandomAvailablePlayer and set it to <code>playertargetID</code> which is better for use in DoAction for an enemy party member because it allows to easily set who the enemy will be targetting.</p> <p>It also sets <code>playertargetentitty</code> to the corresponding battleentity of the <code>playertargetID</code>, but only if it's not negative (which can't happen normally).</p>"},{"location":"Battle%20system/Actors%20states/Targetting/SetTargets/","title":"SetTargets","text":"<p>This method updates <code>availabletargets</code> and <code>helpboxid</code> according to the <code>playerdata[currentturn].battleentity</code>.animid`.</p> <ul> <li>If <code>currentturn</code> is negative (no player is currently selected), <code>helpboxid</code> is set to -1</li> <li>Otherwise, <code>helpboxid</code> is set to <code>playerdata[currentturn].battleentity.animid</code> and GetAvaliableTargets is called according to that animid:<ul> <li>0 (<code>Bee</code>): without onlyground and onlyfront with attackid of -1</li> <li>1 (<code>Beetle</code>): with onlyground and onlyfront with attackid of -2</li> <li>2 (<code>Moth</code>): with onlyground and without onlyfront with attackid of -3</li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/","title":"AdvanceTurnEntity","text":"<p>This is a method only called by AdvanceMainTurn that takes in an actor whose turn will be advanced and a ref to a bool value that will be set to true if there should be a delay after the turn advancement.</p> <pre><code>private void AdvanceTurnEntity(ref MainManager.BattleData t, ref bool delay)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#parameters","title":"Parameters","text":"<ul> <li><code>t</code>: The actor to advance the turn</li> <li><code>delay</code>: a dummy ref bool value. It should always have a false value before calling this method as the method only sets it to true in some cases, but never to false</li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#procedure","title":"Procedure","text":"<p>There are 2 parts to this: Conditions advances and state advance.</p>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#conditions-advances","title":"Conditions advances","text":"<p>This part goes through each <code>condition</code> and acts on them. This part refers to what happens to each individual condition unless stated otherwise.</p> <p>There's 2 sections to this: alive advance and last advance.</p>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#alive-advance","title":"Alive advance","text":"<p>This section occur if the actor is alive and it depends on the <code>BattleCondtion</code>.</p>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#reflection","title":"Reflection","text":"<p>The turn count of the condition is set to 0.</p>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#poison","title":"Poison","text":"<p>If there is at least one enemy party member:</p> <ul> <li>If the actor is a player party member with a <code>ReversePoison</code> medal equipped:<ul> <li>The actor's <code>hp</code> is increased by the actor's <code>maxhp</code> * 0.1 rounded to nearest clamped from 1 to 3. NOTE: the nearest rounding has a quirk where if it ends in .5, the even number will be chosen over the odd one no matter if it is actually the lower or higher bound that is correct mathematically</li> <li>If the <code>Heal</code> sound isn't playing or its more than halfway done player, it is played</li> <li>ShowDamageCounter is called with type 1 with the damage amount as the amount healed earlier with the start being the battleentity position + (0.0, 1.0, 0.0) and the end being (0.0, 2.0, 0.0)</li> </ul> </li> <li>Otherwise, DoDamage is called to the actor with no attacker with a <code>NoExceptions</code> property without block. The damageammount is the actor's <code>maxhp</code> / 10.0 ceiled - 1 and then clamped from 1 to 3 for a player party member and from 1 to 2 for an enemy party member. The call also has these overrides:<ul> <li><code>NoFall</code></li> <li><code>NoIceBreak</code></li> <li><code>FakeAnim</code></li> <li><code>DontAwake</code></li> <li><code>IgnoreNumb</code></li> </ul> </li> <li>If the actor's <code>hp</code> became 0, battleentity.<code>overrideanim</code> is set to false followed by an OverrideOver call being invoked on the battleentity in 1.0 seconds</li> <li>The actor's <code>hp</code> is clamped from 1 to its <code>maxhp</code></li> <li>delay is set to true</li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#fire","title":"Fire","text":"<p>If there is at least one enemy party member:</p> <ul> <li>The <code>Flame</code> sound is played</li> <li>DoDamage is called to the actor with no attacker with a <code>NoExceptions</code> property without block. The damageammount is the player party member's <code>maxhp</code> / 7.5 ceiled - 1 and then clamped from 2 to 3. The call also has these overrides:<ul> <li><code>NoFall</code></li> <li><code>NoIceBreak</code></li> <li><code>FakeAnim</code></li> <li><code>DontAwake</code></li> <li><code>IgnoreNumb</code></li> </ul> </li> <li>If the actor's <code>hp</code> became 0, battleentity.<code>overrideanim</code> is set to false followed by an OverrideOver call being invoked on the battleentity in 1.0 seconds</li> <li>The actor's <code>hp</code> is clamped from 1 to its <code>maxhp</code></li> <li>delay is set to true</li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#eaten","title":"Eaten","text":"<p>It is assumed the actor is a player party member here: </p> <ul> <li>delay is set to true</li> <li>If <code>eatenby</code> exists backed by an enemy party member, the player party member's <code>hp</code> is above 0 and there is at least one enemy party member:<ul> <li>DoDamage is called to the player party member with no attacker with a <code>NoExceptions</code> property, a <code>NoCounter</code> overrides without block. The damageammount is the player party member's <code>maxhp</code> / 10.0 + 1 ceiled and then clamped from 1 to 99</li> <li>ShowDamageCounter is called with type 0 (damage) with the damage amount as the amount with the start being the <code>eatenby</code> enemy party member's <code>cursoroffset</code> and the end being (0.0, 2.0, 0.0)</li> <li>Heal is called on the <code>eatenby</code> enemy party member for the same damage amount dealt to the player party member</li> </ul> </li> <li>If the player party member's <code>hp</code> is 0 or below while there are at least 1 player party member with an <code>hp</code> above 0 while not having an <code>eatenby</code>:<ul> <li><code>eatenkill</code> is set to true (used for AdvanceMainTurn to handle this later)</li> <li>EventDialogue 19 is started and stored in <code>checkingdead</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#freeze","title":"Freeze","text":"<ul> <li>The <code>Freeze</code> sound is played on the battleentity at 1.5 pitch</li> <li>battleentity.<code>shakeice</code> is set to true</li> <li>delay is set to true</li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#numb","title":"Numb","text":"<ul> <li>delay is set to true</li> <li>The <code>ElecFast</code> particles are played at the battleentity position + Vector3.up</li> <li>A ShakeSprite coroutine is started on the battleentity with the intensity being (0.1, 0.15, 0.0) for 40.0 frames</li> <li>The <code>Shock</code> sound is played on the battleentity at 1.25 pitch</li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#sleep","title":"Sleep","text":"<p>Nothing happens if the actor's <code>hp</code> is at least its <code>maxhp</code>, but if it doesn't:</p> <ul> <li>A heal amount is determined with a starting value of the actor's <code>maxhp</code> * 0.1 ceiled. If the <code>HeavySleeper</code> medal is equipped on the actor (no checks if it's necesarily a player party member), the amount is tripled. On top of this, if it's not a player party member (checked by the battleentity tag not being <code>Player</code>), the amount is clamped from 0 to 4</li> <li>ShowDamageCounter is called with type 1 (HP) with the amount determined earlier with a start of the actor position + its <code>cursoroffset</code> and an end of Vector3.up</li> <li>The actor's <code>hp</code> is incremented by the amount determined earlier clamped from 0 to the actor's <code>maxhp</code></li> <li>The <code>Heal</code> sound is played</li> <li>delay is set to true</li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#gradualhp","title":"GradualHP","text":"<p>The same than <code>Sleep</code>, but the amount to heal and show is always 2.</p>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#gradualtp","title":"GradualTP","text":"<p>If instance.<code>tp</code> is less than instance.<code>maxtp</code>:</p> <ul> <li>The <code>Heal2</code> sound is played</li> <li>ShowDamageCounter is called with type 2 (TP) for 2 as the ammount with a start of battleentity position + the actor's <code>cursoroffset</code> and an end of Vector3.up</li> <li>instance.<code>tp</code> is increased by 2 clamped from 0 to instance.<code>maxtp</code></li> <li>delay is set to true</li> </ul> <p>From there, the condition turn counter is decremented with some exceptional cases when this doesn't happen:</p> <ul> <li>The condition is Eaten</li> <li>The condition is Poison while the <code>EternalPoison</code> medal is equipped</li> <li>The condition is Flipped while the turn count on the first <code>Flipped</code> condition (this is assumed to be the same one) is 1 or lower</li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#last-advance","title":"Last advance","text":"<p>The first thing that happens is <code>frozenlastturn</code> is set to whether or not the actor still has the Freeze condition even after the alive update above.</p> <p>This section only does something if the condition's turn counter just reached 0 and what happens depends on the condition:</p> <ul> <li>Numb: <code>isnumb</code> is set to false followed by <code>cantmove</code> is set to 1 (resets to one actor turn before an action is available, but it will be exhausted later on this actor turn advance)</li> <li>Sleep: <code>isasleep</code> is set to false followed by <code>cantmove</code> is set to 1 (resets to one actor turn before an action is available, but it will be exhausted later on this actor turn advance)</li> <li>Freeze / EventStop: If the battleentity.<code>icecube</code> exists, BreakIce is called on the battleentity. Also, <code>cantmove</code> is set to 1 (resets to one actor turn before an action is available, but it will be exhausted later on this actor turn advance)</li> <li>Shield: battleentity.<code>shieldenabled</code> is set to false</li> <li>AttackUp: If the actor's <code>atkdownloseatkup</code> is true, an AttackDown condition is slated to be added later followed by <code>atkdownonloseatkup</code> being set to false</li> </ul>"},{"location":"Battle%20system/Battle%20flow/AdvanceTurnEntity/#state-advance","title":"State advance","text":"<ul> <li>All the conditions whose turn count reached 0 are removed</li> <li>If an AttackUp condition's turn count reached 0 while <code>atkdownonloseatkup</code> was true earlier:<ul> <li>SetCondition is called with AttackDown for 2 actor turns on the actor</li> <li>The <code>StatDown</code> sound is played</li> <li>StatEffect is called on the battleentity with type 2 (red arrow down)</li> </ul> </li> <li>The actor's <code>isasleep</code> is set to whether or not the actor has the Sleep condition</li> <li>The actor's <code>isnumb</code> is set to whether or not the actor has the Numb condition</li> <li>If firststrike is false (the enemy party isn't performing a first strike), the actor's <code>turnsalive</code> or <code>turnssincedeath</code> is incremented (the one chosen depends on the <code>hp</code> being above 0)</li> <li>If the actor has the Freeze or EventStop condition or their <code>isnumb</code> or <code>isasleep</code> is true, their <code>cantmove</code> is set to 0 (one action available) if they are a player party member (checked by having the <code>Player</code> tag), 1 (one turn before an action is available) if it's an enemy party member</li> <li>Otherwise, if the actor's <code>hp</code> is above 0 and it's not a firststrike:<ul> <li><code>cantmove</code> is decremented which passes a turn in the counter</li> <li>If <code>moreturnnextturn</code> is above 0, <code>cantmove</code> is decreased by it followed by <code>moreturnnextturn</code> being set to 0</li> </ul> </li> <li>Otherwise, if the actor's <code>hp</code> is 0, <code>cantmove</code> is set to 0</li> <li>The actor's <code>tired</code> is set to 0</li> <li>The actor's <code>didnothing</code> is set to false</li> <li>The actor's <code>haspassed</code> is set to false</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/","title":"Combat tutorials EventDialogues","text":"<p>There are 2 combat tutorials in the game that involves many parts of the battle system.</p> <p>The first one concerns basic combat, turn flow and skills. The second one is specifically for Turn Relay.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#basic-combat-tutorial","title":"Basic combat tutorial","text":"<p>The basic combat tutorial is a very complex process that involves the following:</p> <ul> <li>flags 15: Tells the game if the combat tutorial has already been given. It needs to be false for this combat tutorial process to do anything</li> <li>flagvar 11: When <code>flags</code> 15 is false, it tells the state of the combat tutorial:<ul> <li>0: The initial state, no tutorials has been given yet</li> <li>1: The basic attack tutorial was given, but the turn flow / blocking tutorial and the skills tutorial wasn't given yet</li> <li>2: Both the basic attack tutorial and the turn flow / blocking tutorial were given, but the skills tutorial wasn't given yet</li> <li>3: All tutorials were given, nothing special happens from now on</li> </ul> </li> </ul> <p>The way this works is EventDialogue 0 to 2 and CheckEvent works together with a special enemy: MakiTutorial. This enemy is special because its action logic is configured specifically to give tutorials, but act as a normal enemy party member otherwise. It is assumed that <code>MakiTutorial</code> is fought when <code>flags</code> 15 is false. The presence of this enemy is required to give the combat tutorial. It is also assumed that the player party is in its default order and composed only of <code>Bee</code> and <code>Beetle</code>.</p> <p><code>flagvar</code> 11 should always start with a value of 0 and it is how the game tracks the flow of the tutorial process which consists of many phases. Ultimately, it will leads to the battle premptively ending via ReturnToOverworld.</p> <p>The following is how a complete combat tutorial process goes separated by phases.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#start","title":"Start","text":"<p>On the first controlled flow update, CheckEvent will run. It will detect that <code>flags</code> 15 is false so it will execute the tutorial flow logic on every controlled flow update from now on. The value of this flag is only set after the battle is over meaning it always will execute the logic from now on.</p> <p>CheckEvent sees that <code>flagvar</code> 11 is 0 meaning we just started the tutorial. This causes EventDialogue 0 to happen. It is assumed that the player party is composed of <code>Bee</code> and <code>Beetle</code> in that order.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#eventdialogue-0","title":"EventDialogue 0","text":"<p>The following is the logic of EventDialogue 0 which gives the basic attack tutorial:</p> <ul> <li><code>playerdata[0]</code> FaceTowards <code>playerdata[1]</code> (should always be <code>Bee</code> facing <code>Beetle</code>)</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[12]</code> which is some dialogue followed by a prompt giving the choice to skip the dialogue. If the player chooses to skip, a <code>|</code>setvar<code>,11,1|</code> gets processed which sets <code>flagvar</code> 11 to 1</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[1]</code> (should always be <code>Beetle</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>All <code>playerdata</code> has their <code>flip</code> set to true</li> <li>Yield for a frame</li> <li>If <code>flagvar</code> 11 is still 0 (meaning the player didn't choose to skip the tutorial) some scripted player actions happens (the game controls everything here, no actual regular battle flow happens here):<ul> <li><code>demomode</code> is set to true</li> <li><code>target</code> is set to 0</li> <li><code>availabletargets</code> is set to <code>enemydata</code></li> <li><code>currentturn</code> is set to 1 (should always be <code>Beetle</code>)</li> <li>DoAction is manually called with the entity being <code>playerdata[1]</code> (should always be <code>Beetle</code>) and actionid of -1 (Beetle's basic attack). The overall effect here is <code>Beetle</code> will use its basic attack on the first enemy which should always be <code>MakiTutorial</code></li> <li>Yield all frames until <code>action</code> is false (meaning DoAction is done)</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[19]</code> which is some dialogue about <code>Bee</code> being about to attack</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[0]</code> (should always be <code>Bee</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li><code>currentturn</code> is set to 0 (should always be <code>Bee</code>)</li> <li>DoAction is manually called with the entity being <code>playerdata[0]</code> (should always be <code>Bee</code>) and actionid of -1 (Bee's basic attack). The overall effect here is <code>Bee</code> will use its basic attack on the first enemy which should always be <code>MakiTutorial</code></li> <li>Yield all frames until <code>action</code> is false (meaning DoAction is done)</li> <li>All <code>playerdata</code> have their <code>cantmove</code> set to 1, <code>lockskills</code> set to false and <code>lockitems</code> set to false. This simulates that they took an actor turn and the game will treat it the same way than if they actually attacked normally</li> </ul> </li> <li><code>demomode</code> is set to false</li> <li><code>flagvar</code> 11 is set to 1 which advances to the next phase</li> </ul> <p>Since <code>flagvar</code> is no longer 0, CheckEvent will no longer trigger EventDialogue 0 and the tutorial proceeds to the next phase.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#turn-flow-tutorial","title":"Turn flow tutorial","text":"<p>By this point, regardless if the player skipped the tutorial or not, <code>flagvar</code> should be 1 and the player phase should be over because all <code>playerdata</code> should have their <code>cantmove</code> set to 1.</p> <p>This means that DoAction will be called on MakiTutorial and their first actor turn has special logic if <code>flagvar</code> 11 is 1 which starts by starting EventDialogue 1 and yielding all frames until it is over (<code>inevent</code> goes to false).</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#eventdialogue-1","title":"EventDialogue 1","text":"<p>The following is the logic of EventDialogue 1 which gives the turn flow tutorial:</p> <ul> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[15]</code> which is some dialogue about turn flow</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[0]</code> (should always be <code>Bee</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#block-tutorial","title":"Block tutorial","text":"<p>We are back to <code>MakiTutorial</code>'s action. Right after the <code>inevent</code> yield, <code>playertargetID</code> is set to 0 (should always be <code>Bee</code>). Normally, the target is determined via GetSingleTarget, but the enemy will specifically target <code>Bee</code> here because it is about to proceed with the blocking tutorial.</p> <p>From there, the action logic continue as normal, except that after their animstate was set to 101 and after the 0.25 seconds yield, the following happens (normally, only a 0.2 seconds yield happen):</p> <ul> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[16]</code> which is some dialogue about turn flow appended with <code>|</code>noskip<code>|</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[0]</code> (should always be <code>Bee</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li><code>commandsuccess</code> is set to true</li> </ul> <p>From there, the DoDamage proceeds as normal, but because <code>commandsuccess</code> was overriden to true, a regular block is guaranteed.</p> <p>However, whether or not it is a regular or super block isn't guaranteed. The timing gets weirder than usual because of the SetText call done right before which skews the timing since GetBlock doesn't run while the message lock is grabbed. Effectively, the timing to super block becomes the following:</p> <ul> <li>The last ~3 frames before the SetText call happened (most likely, they will be in the 0.25 seconds done right before)</li> <li>The frame corresponding to the exact moment the message lock is released (GetBlock runs before DoAction resumes so it will see the lock being released before DoAction gets to continue)</li> </ul> <p>Finally, at the very end of <code>MakiTutorial</code>'s action, since <code>flagvar</code> 11 is less than 3 (meaning the complete tutorial hasn't been given yet), it is set to 2 which advances to the next phase of the combat tutorial. Since <code>flagvar</code> 11 should be 3 by the next time <code>MakiTutorial</code> acts, this tutorial logic won't happen again.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#after-block-tutorial","title":"After block tutorial","text":"<p>We are now on the second main turn of the battle and CheckEvent runs. Since it sees that <code>flagvar</code> 11 is 2, EventDialogue 2 is called.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#eventdialogue-2","title":"EventDialogue 2","text":"<p>The following is the logic of EventDialogue 1 which gives the skills tutorial:</p> <ul> <li>If <code>flagvar</code> 11 is 2 (which should always be the case):<ul> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[17]</code> which is some explanation about skills prepanded with <code>|</code>boxstyle<code>,4|</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: null</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> </ul> </li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[18]</code> which is some more dialogues about skills</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[0]</code> (should always be <code>Bee</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li><code>enemydata[0]</code> (should be the <code>MakiTutorial</code>) has its animstate set to 13 (<code>BattleIdle</code>)</li> <li>All <code>playerdata</code> has their <code>lockskills</code> and <code>lockitems</code> are set to false</li> <li><code>flagvar</code> 11 is set to 3</li> </ul> <p><code>flagvar</code> 11 being 3 advances to the last phase of the combat tutorial.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#combat-tutorial-ending","title":"Combat tutorial ending","text":"<p>From there, the battle is kind of in a stand still. <code>MakiTutorial</code> no longer has special logic and will attack as normal with the regualr block timing being in effect. Essentially, the battle is back to flow as normal.</p> <p>This goes on until a special condition happens in CheckEvent which is that <code>turns</code> is 3. This means that 3 main turns total have passed. When this happens on the first controlled flow update, ExitBattle is called which start a ReturnToOverworld without flee, set <code>cancelupdate</code> and <code>action</code> to true and <code>enemy</code> to false which also changes the flow to a terminal one.</p> <p>This completely ends the tutorial process. It is expected that <code>flags</code> 15 gets set to true by the caller of this battle which prevents the tutorial to be given again.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#turn-relay-tutorial","title":"Turn Relay tutorial","text":"<p>The Turn Relay tutorial is isolated from the bigger combat one and it is relatively isolated overall. While the game heavily scripts the fight that this tutorial is given, the only requirements for this tutorial to work is to have a player party of <code>Bee</code>, <code>Beetle</code> and <code>Moth</code> in default party order.</p> <p>The tutorial logic is checked by CheckEvent and its logic runs only when flag 16 is true (Leif can fight in battle) and flag 24 is false (haven't received the Relay tutorial yet). This will run if applicable on the first controlled flow update. </p> <p>When these conditions are met, EventDialogue 3 starts.</p>"},{"location":"Battle%20system/Battle%20flow/Combat%20tutorials/#eventdialogue-3","title":"EventDialogue 3","text":"<p>The following is the logic of EventDialogue 3 which gives the Turn Relay tutorial:</p> <ul> <li>Both <code>playerdata[0]</code> (should always be <code>Bee</code>) and <code>playerdata[1]</code> (should always be <code>Beetle</code>) FaceTowards <code>playerdata[2]</code> (should always be <code>Moth</code>)</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[20]</code> which is some dialogues about Turn Relay</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[2]</code> (should always be <code>Moth</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>Both <code>playerdata[0]</code> (should always be <code>Bee</code>) and <code>playerdata[1]</code> (should always be <code>Beetle</code>) have their <code>flip</code> set to true</li> <li><code>flags</code> 24 is set to true</li> <li>Yield for 0.5 seconds</li> <li>SetMaxOptions is called</li> </ul> <p>Since <code>flags</code> 24 is true, the Turn Relay tutorial won't happen again.</p>"},{"location":"Battle%20system/Battle%20flow/EndEnemyTurn/","title":"EndEnemyTurn","text":"<p>This method is only called by DoAction during the post action phase if the actionid isn't -555 (it's not blank dummy call) and it's an enemy party member's action. It will end an enemy party member's actor turn, just like EndPlayerTurn, but for enemy party members instead of player party members.</p> <pre><code>private void EndEnemyTurn(int id)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/EndEnemyTurn/#parameters","title":"Parameters","text":"<ul> <li><code>id</code>: The <code>enemydata</code> index whose actor turn should be ending</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EndEnemyTurn/#procedure","title":"Procedure","text":"<ul> <li>If we were not in the enemy party member's hitaction, the <code>DoublePain</code> medal isn't equipped and the enemy party member's <code>notired</code> is false, its <code>tired</code> field is incremented (this adds an exhaustion). NOTE: This neglects HARDEST and B.O.S.S's EX mode making this check incorrect as it leaves exhaustion enabled on HARDEST without <code>DoublePain</code>, same for EX mode</li> <li>If we were not in the enemy party member's hitaction, the enemy party member's <code>cantmove</code> is incremented (this consumes the actor turn)</li> <li>The enemy party member's hitaction is reset to false</li> <li>Unless <code>dontusecharge</code> is true, the enemy party member's <code>charge</code> is reset to 0</li> <li>RefreshAllData is called which sets <code>alldata</code> to a new list which consists of all the <code>playerdata</code> followed by all the <code>enemydata</code> appended together</li> <li>Unless we were <code>inevent</code>, ReorganizeEnemies(true) is called which removes all dead enemies and orders all <code>enemydata</code> by their battleentity's x position</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EndPlayerTurn/","title":"EndPlayerTurn","text":"<p>This methods tells the <code>currentturn</code> player party member that its action is over and its turn must be consumed.</p> <ul> <li><code>playerdata[currentturn].cantmove</code> is incremented which consumes one of its available action</li> <li><code>currentturn</code> is set to -1 which deselects the player party member and lets Update decide what to do next as part of the Main turn life cycle.</li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on the battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>currentaction is set to <code>BaseAction</code> (the main vine action menu)</li> <li>RefreshAllData is called which sets <code>alldata</code> to a new list which consists of all the <code>playerdata</code> followed by all the <code>enemydata</code> appended together</li> <li>Each <code>enemydata</code> that has a Freeze condition or <code>isasleep</code> while actimmobile is false has their <code>cantmove</code> set to 1</li> <li>SetLastTurns is called which resets <code>lastturns</code> to a new aray with the length being the amount of free players - 1 and all elements being -1 (this resets the player selection cycle)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogue/","title":"EventDialogue","text":"<p>This is a coroutine that will process what is known as an EventDialogue. An EventDialogue is a specialised version of an event, but specifically made for being handled during a battle. </p> <p>Starting this coroutine is all that's needed to have any event start and they may be started in a variety of ways mainly through eventondeath, eventonfall (which is practically UNUSED) and CheckEvent. The game can know if an EventDialogue is in progress by checking the <code>inevent</code> field.</p> <pre><code>private IEnumerator EventDialogue(int id)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/EventDialogue/#parameters","title":"Parameters","text":"<ul> <li><code>id</code>: The id of the EventDialogue to start</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogue/#procedure","title":"Procedure","text":"<ul> <li><code>inevent</code> is set to true</li> <li><code>caninputcooldown</code> and <code>blockcooldown</code> are reset to 0.0 which resets the GetBlock state</li> <li><code>choicevine</code>'s position is set to offscreen (999.0 in y) if it exists</li> <li>UpdateAnim is called</li> <li>UpdateText is called</li> <li>RefreshEnemyHP is called</li> <li>The EventDialogue whose id is the sent id value has its logic happen (see the section below for more information on them)</li> <li>ReorganizeEnemies is called with order</li> <li><code>inevent</code> is set to false</li> <li>UpdateConditionIcons is called which, if we aren't in the enemy, calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>UpdateText</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogue/#eventdialogue-tables","title":"EventDialogue tables","text":"<p>Here are all the EventDialogues defined along with links to their detail:</p> ID Description 0 Basic combat and action commands tutorial 1 Part of the combat tutorial about turn flow 2 Skills tutorial 3 Turn Relay tutorial 4 <code>Spuder</code> first encounter event 5 <code>Spuder</code> second encounter event 6 <code>MothWeb</code> death event 7 <code>Spuder</code> third encounter event when they are past an <code>hp</code> treshold 8 <code>Spuder</code> third encounter event when starting the battle with their <code>moves</code> set to 2 9 <code>Acolyte</code> and <code>AcolyteVine</code> death event 10 <code>VenusBos</code> death event 11 <code>Scarlet</code> death event 12 <code>Kali</code> death event 13 <code>SandWyrmTail1</code> death event 14 <code>SandWyrm</code> death event 15 <code>Cenn</code> and <code>Pisci</code> first encounter fleeing event (also happens on their death) 16 <code>UltimaxTank</code> death event 17 <code>WaspKing</code> death event 18 <code>EverlastingKing</code> death event 19 <code>Pitcher</code> event where either their death or early spit out are processed"},{"location":"Battle%20system/Battle%20flow/GetBlock/","title":"GetBlock","text":"<p>This is a parameterless void returning method that is called from Update when in an uncontrolled flow.</p> <p>This logic is exclusive to an uncontrolled flow, but it only happens when <code>enemy</code> is true (we are in the player phase / a delproj is landing / an enemy party member is performing a hitaction), <code>inevent</code> is false (no EventDialogue is in progress), <code>doingaction</code> is false (we aren't in a DoCommand) and the message lock is released (covers cases like Tattle).</p> <p>GetBlock mainly does 2 things: process the blocking storing the result in <code>blockcooldown</code> and <code>commandsuccess</code> and update the player party members's animstate to different stages of the blocking.</p>"},{"location":"Battle%20system/Battle%20flow/GetBlock/#how-blocking-works","title":"How blocking works","text":"<p>A block can be attempted by pressing any of the following inputs (this is the -3 input which aggregates any of this list):</p> <ul> <li>4 (Confirm)</li> <li>5 (Cancel)</li> <li>6 (Switch party)</li> <li>7 (Toggle HUD)</li> </ul> <p>However, the block will only be accepted if both <code>caninputcooldown</code> and <code>blockcooldown</code> expires. If this happens:</p> <ul> <li><code>blockcooldown</code> is set to 20.0 frames (effectively starts at ~19.0 because GetBlock decreases it later by MainManager.<code>framestep</code>). This is the amount of frames left to have a block count by the damage pipeline should a DoDamage call occurs. If it still has 16 or more frames left by the time DoDamage occurs, it counts as a super block for the next 3.0 frames (tracked by <code>superblockedthisframe</code>, set during the damage pipeline when processing the super block in CalculateBaseDamage and decreased by LateUpdate).</li> <li><code>caninputcooldown</code> is set to 37.0 frames. (effectively starts at ~36.0 because GetBlock decreases it later by MainManager.<code>framestep</code>) This is the amount of frames that must pass in order for a block to be allowed. The purpose of this is to prevent the player from spamming blocks because it effectively leaves ~17.0 frames of vulnerability after <code>blockcooldown</code> expires where the player will not be allowed to block, but if DoDamage gets called during those frames, the block check will fail.</li> </ul> <p>Another important field is updated no matter if a block is processed or not: <code>commandsuccess</code>. This field in a blocking context tells if <code>blockcooldown</code> is above 0.0 meaning it hasn't expired so it's a quick bool value that tells if the player is currently blocking. The purpose of this is to pass this value to DoDamage as the block parameter so the damage pipeline can act accordingly of whether or not a block was successful. The damage pipeline needs to check <code>blockcooldown</code> to know if it was a super block or a regular one.</p> <p>On each GetBlock (which is normally called on each Update during an enemy action), <code>caninputcooldown</code> and <code>blockcooldown</code> are decreased by MainManager.<code>framestep</code>. This has the side effect that the cooldown starting values are decreased by ~1.0 from the ones actually written to initially. It's not exactly 1.0 because it depends on the last MainManager.<code>framestep</code>. For example, if the last frame took longer than the target framerate, it will be decreased by slightly more than 1.0.</p>"},{"location":"Battle%20system/Battle%20flow/GetBlock/#a-summarised-explanation-of-blocking","title":"A summarised explanation of blocking","text":"<p>All of the above can be summarised by the following:</p> <ul> <li>A block of any kind can be performed by pressing 4 (Confirm), 5 (Cancel), 6 (Switch party) or 7 (Toggle HUD) if it's been less than ~36.0 frames since the last time these inputs were pressed (tracked by <code>caninputcooldown</code>, decreased each GetBlock which is called on each Update)</li> <li>An accepted block only counts for up to ~19.0 frames leading the DoDamage call (tracked by <code>blockcooldown</code>, decreased each GetBlock which is called on each Update). DoDamage receives a block parameter where it is intended that <code>commandsuccess</code> is passed to it which tells if <code>blockcooldown</code> is still active or not</li> <li>If <code>blockcooldown</code> reaches 0.0, no blocking can be performed for the next ~17.0 frames due to <code>caninputcooldown</code>. Blocking never influences the damage pipeline if it's performed after the DoDamage call</li> <li>If an accepted block reaches a DoDamage while there's still 16.0 or more frames left on <code>blockcooldown</code>, the block counts as a super block. This effectively leaves only the first ~4.0 frames window of the block to count it as a super block</li> <li>If a super block occurs and is verified by the damage pipeline, it is valid for up to 3.0 frames after the damage pipeline completes where any further DoDamage calls will count a super block no matter what <code>blockcooldown</code> and <code>commandsuccess</code> reports. This is done to allow quick damages in succession to still count the super blocks as it wouldn't be possible for the player to block due to the block spam prevention. This is tracked by <code>superblockedthisframe</code> which decreases on every LateUpdate by MainManager.<code>framestep</code></li> </ul>"},{"location":"Battle%20system/Battle%20flow/GetBlock/#details-on-why-this-blocking-system-works","title":"Details on why this blocking system works","text":"<p>It's important to understand why this system works because it involves the asynchronous nature of the battle system.</p> <p>Let's take a typical attack action as an example. DoAction is an action coroutine. It means that it runs concurently to the main Update loop. Since GetBlock runs on Update and enemy actions must go through DoAction to call DoDamage as part of their action, it means GetBlock and DoAction runs concurently from each other.</p> <p>This allows GetBlock to not touch any of the damage pipeline, but still report and track whether the player is blocking and for how long they been blocking. Meanwhile, DoAction runs indepedently from this which allows very tight control on the animations and the moment to call DoDamage which can have an intuitive visual and auditive timing to assist the player in performing the block. It is free to use the results GetBlock gathered at any time because it is guaranteed to be correct since Update always run before DoAction gets any attention if it was set to resume on that frame.</p> <p>This results in the blocking timing to work no matter how the enemy action is performed. There is no need to define any timing anywhere because it's implicitly handled by the asynchronous nature of the system. The one downside however is the entire timing window leads up to the actual damage frame meaning that intuitively, the player could be a frame after and still miss the block while they were within 4 frames of the damage. There is no coyote frames to account for this (adding any would introduce visual delays to present the damage counter and other effects).</p>"},{"location":"Battle%20system/Battle%20flow/GetBlock/#known-issues-with-docommand","title":"Known issues with DoCommand","text":"<p>This system behaves unexpectedly when interacting with DoCommand. Check its documentation to learn more as it can end up splitting the block timing into 2 distrinct moments.</p>"},{"location":"Battle%20system/Battle%20flow/GetBlock/#known-issue-with-frameone-flags-615","title":"Known issue with FRAMEONE (flags 615)","text":"<p>The way FRAMEONE is handled makes the value of <code>commandsuccess</code> missleading when used in enemy actions. This is because GetBlock can report true making it seem like the player blocked, but it could have just been a regular block on FRAMEONE which aren't supposed to be allowed (DoDamage will override it).</p> <p>It means that if an enemy action reads <code>commandsuccess</code>, it wouldn't be sufficient to determine if the blocking should count. If FRAMEONE is active, it will cause the enemy to change behavior even if a regular block was done which shouldn't count.</p>"},{"location":"Battle%20system/Battle%20flow/GetBlock/#animation-updates","title":"Animation updates","text":"<p>Other than managing blocking, it also manages animations of the player party members. The following happens happens for every player party members whose battleentity.<code>overrideanim</code> is false:</p> <ul> <li>If the <code>hp</code> is 0 while their battleentity isn't <code>dead</code> yet, battleentity.animstate is set to 11 (<code>Hurt</code>)</li> <li>Otherwise, if IsStopped returns false on the player party member:<ul> <li>battleentity.animstate is set to 24 (<code>Block</code>) if all of the following are true:<ul> <li><code>hp</code> is above 0</li> <li><code>playertargetID</code> is the player party member or -1 (the whole player party)</li> <li>battleentity.animstate isn't 11 (<code>Hurt</code>)</li> <li><code>blockcooldown</code> is above 0.0, </li> </ul> </li> <li>Otherwise, UpdateAnim is called with onlyplayer to true</li> </ul> </li> <li>Otherwise, if the player party member <code>isasleep</code>, battleentity.animstate is set to 14 (<code>Sleep</code>)</li> <li>Otherwise, if the player party member <code>isnumb</code> or it has the Freeze condition, battleentity.animstate is set to 11 (<code>Hurt</code>)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/LevelUpMessage/","title":"LevelUpMessage","text":"<p>This is a static coroutine that is part of AddExperience when a rank up occurs. Some ranks also have special level up bonuses that are signaled via this method which may end up calling SetText in dialogue mode</p> <p>NOTE: This coroutine expects flagvar 0 to be set to 0 so the caller can yield on it. It will be set to 1 at the very end to inform the caller of its completion.</p>"},{"location":"Battle%20system/Battle%20flow/LevelUpMessage/#message-setup","title":"Message setup","text":"<p>The rank data matching the new instance.<code>partylevel</code> is found. If no one exists, this section is skipped and it only applies the last steps.</p> <p>When one is found, 0.5 seconds are yielded.</p> <p>The logic that happens here depends on the rank up bonus type:</p>"},{"location":"Battle%20system/Battle%20flow/LevelUpMessage/#0-skill-grant","title":"0 (Skill grant)","text":"<p>There will be a message only if there is a player party member that exist with the animid of whom should receive the skill. </p> <p>To setup the message:</p> <ul> <li>flagstring 0 is set to <code>menutext[46 + X]</code> where <code>X</code> is the animid (this is the name of the player party member)</li> <li>flagstring 1 is set to the skill's name from skills data</li> </ul>"},{"location":"Battle%20system/Battle%20flow/LevelUpMessage/#1-stat-bonus-grant-to-a-player-party-member","title":"1 (Stat bonus grant to a player party member)","text":"<p>There will be a message only if there is a player party member that exist with the animid of whom should receive the stat bonus. This only supports <code>Attack</code>, <code>Defense</code> and <code>HP</code> bonuses.</p> <p>Regardless if a message is sent:</p> <ul> <li>The corresponding stat bonus is applied to the player party member via AddStatBonus</li> <li>flagstring 0 is set to <code>menutext[46 + X]</code> where <code>X</code> is the animid (this is the name of the player party member)</li> <li>flagstring 1 is set to the amount of the bonus increase followed by <code></code> followed by a <code>menutext</code> that depends on the bonus type which is its name (16 for <code>Attack</code>, 17 for <code>Defense</code> and 14 for <code>HP</code>)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/LevelUpMessage/#2-stat-bonus-grant-to-the-whole-player-party","title":"2 (Stat bonus grant to the whole player party)","text":"<p>There will always be a message. This only supports <code>TP</code> and <code>MP</code> bonuses.</p> <p>If this is a <code>TP</code> bonus:</p> <ul> <li>flagstring 0 is set to the amount of the bonus increase followed by <code></code> followed by <code>menutext[15]</code> (TP)</li> <li>instance.<code>tp</code> is increased by the amount of the bonus</li> <li>instance.<code>maxtp</code> is increased by the amount of the bonus</li> <li>AddStatBonus is called to apply the <code>TP</code> bonus to the party, but it will either be called once if the amount is 3 for a single 3 <code>TP</code> bonus to the party, or it will be called multiple times if it's not 3 where each calls is a 1 <code>TP</code> bonus to the party adding up to the same amount</li> </ul> <p>If this is an <code>MP</code> bonus:</p> <ul> <li>flagstring 0 is set to the amount of the bonus increase followed by <code></code> followed by <code>menutext[19]</code> (MP)</li> <li>instance.<code>bp</code> is increased by the amount of the bonus</li> <li>instance.<code>maxbp</code> is increased by the amount of the bonus</li> <li>AddStatBonus is called to apply the <code>MP</code> bonus to the party with the amount of the bonus in a single call</li> </ul>"},{"location":"Battle%20system/Battle%20flow/LevelUpMessage/#3-standard-items-capacity-upgrade","title":"3 (standard items capacity upgrade)","text":"<p>There will always be a message.</p> <ul> <li>flagstring 0 is set to the amount of the inventory upgrade</li> <li>instance.<code>maxitems</code> is increased by the amount of the inventory upgrade</li> <li>flagstring 0 is set to the new instance.<code>maxitems</code></li> </ul>"},{"location":"Battle%20system/Battle%20flow/LevelUpMessage/#message-display","title":"Message display","text":"<p>This part only happens if we decided to show a message.</p> <p>SetText is called in dialogue mode with the text being <code>|</code>boxstyle<code>,4||</code>spd<code>,0||</code>halfline<code>||</code>center<code>|</code> followed by <code>menutext[141 + X]</code> where <code>X</code> is the type of the rank up bonus. The call has the following properties:</p> <ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>linebreak of instance.<code>messagebreak</code></li> <li>No tridimensional</li> <li>position of Vector3.zero</li> <li>No cameraoffset</li> <li>size of Vector3.one</li> <li>No parent</li> <li>No caller</li> </ul> <p>From there, all frames are yielded while the message lock is grabbed.</p> <p>After, an additional frame is yielded</p>"},{"location":"Battle%20system/Battle%20flow/LevelUpMessage/#last-steps","title":"Last steps","text":"<p>This section applies regardless if a rank data was found:</p> <ul> <li>ApplyStatBonus is called</li> <li>A frame is yielded</li> <li>flagvar 0 is set to 1 which informs the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Main%20turn%20life%20cycle/","title":"Main turn life cycle","text":"<p>This page describes the life cycle of a main turn which is processed as the last step of a controlled update flow. It means the steps presented in this page are parts of Update.</p> <p>It is composed of 3 phases, starting from the first and each subsequent one needing the previous to finish:</p> <ol> <li>Player phase (<code>enemy</code> is false or became false from the last main turn's end of turn phase)</li> <li>Enemy phase (<code>enemy</code> became true after the end of the player phase)</li> <li>End of turn phase (<code>enemy</code> is still true while no free enemy party members are left)</li> </ol> <p>This cycle repeats continuously until the flow changes to a Terminal flow.</p>"},{"location":"Battle%20system/Battle%20flow/Main%20turn%20life%20cycle/#player-phase","title":"Player phase","text":"<p>This is where the player party portion of the turn is handled. It is denoted by <code>enemy</code> being false and once the player phase is over, <code>enemy</code> is set to true which moves the battle into enemies phase.</p> <p>The following always happen first:</p> <ul> <li>UpdateAnim is called</li> <li><code>blockcooldown</code> is set to 0.0</li> </ul> <p>The phase only proceeds if no <code>enemydata</code> battleentity is in a forcemove (returned by EnemiesAreNotMoving).</p> <p>From there, what happens in the phase depends on <code>currentturn</code> and <code>avaliableplayers</code>. The former manages the current player party member selected for the current action while the latter tells if player party members are still free.</p> <p><code>currentturn</code> being positive, but below the length of <code>playerdata</code> means that we already are selecting a player party member for the turn. In that case some logic happens:</p> <ul> <li>If instance.<code>hud</code> exists while not being empty, GUIMovement is called. This method will visually render the <code>fronticon</code> on the applicable <code>playerdata</code> element (<code>partypointer[0]</code>) on its lower right corner and also move the currently selected player's HUD element by setting its y local position to 0.0 - the abosolute value of Sin(Time.time / 2.0) / 7.0 (the other HUD elements have it reset to 0.0) This makes the HUD element move up and down.</li> <li>PlayerTurn is called</li> </ul> <p>If <code>currentturn</code> is -1 however, it means no one is selected yet which indicates the phase needs to proceed to either select one or perform a post player action step. This starts by updating <code>availableplayers</code> to GetFreePlayerAmmount.</p> <p>From there, the next appropriate part of the player phase is performed which is the first of the next 4 parts. They can be thought of a sequence where the first applicable part occurs. A part may be skipped entirely, but eventually, the last one will occur which will end the player phase.</p> <p>Here are the player phase parts and their conditions:</p> <ol> <li>Player party member selection (<code>availableplayers</code> is above 0 meaning at least one player party member is free)</li> <li><code>chompy</code> action (no player party members are free, <code>chompy</code> exists, can act and haven't acted in this main turn)</li> <li><code>aiparty</code> action (no player party members are free, <code>aiparty</code> exists and haven't acted yet in this main turn)</li> <li>End of the player phase (none of the above applied meaning the player phase is done)</li> </ol>"},{"location":"Battle%20system/Battle%20flow/Main%20turn%20life%20cycle/#player-party-member-selection","title":"Player party member selection","text":"<p>This part only happens if <code>availableplayers</code> is above 0.</p> <p>This is where the player party member selection happens:</p> <ul> <li>The player party member index selected for <code>currentturn</code> value is found by searching in <code>partypointer</code> order and finding the first that isn't IsStopped, its <code>cantmove</code> is 0 or below (it has at least one action available) and it is cleared by CheckFreePlayers which means it isn't in <code>lastturns</code> when more than 1 player is free (it means it's the next player in the select cycle or it's the last free player)</li> <li>UpdateText is called</li> <li>If <code>playerdata</code> length is more than 1, AddLastTurn is called on the player index (by <code>partypointer</code>) which adds the player index to the next free slot or pushes it to the last one if all slots are taken, removing the oldest one (it just advances the select cycle)</li> <li>PlayerTurn is called</li> </ul> <p>This cycle then ends. From now on, all cycles will see the <code>currentturn</code> being already set to a player and just process it</p>"},{"location":"Battle%20system/Battle%20flow/Main%20turn%20life%20cycle/#chompy-action","title":"<code>chompy</code> action","text":"<p>This part happens if all of the following are fufilled:</p> <ul> <li><code>chompy</code> exists</li> <li><code>chompyattacked</code> is false (this part hasn't happened yet)</li> <li><code>chompylock</code> is false</li> <li><code>enemydata</code> is not empty</li> </ul> <p>This is what happens when the above are fufilled (otherwise, this part is skipped):</p> <ul> <li>If spitout is in progress, <code>chompyattacked</code> is set to true which skips the chompy action</li> <li>Otherwise, if <code>chompyattack</code> isn't in progress, it is set to a new Chompy action coroutine starting</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Main%20turn%20life%20cycle/#aiparty-action","title":"<code>aiparty</code> action","text":"<p>This part happens if all of the following are fufilled:</p> <ul> <li><code>aiparty</code> exists</li> <li><code>aiattacked</code> is false (this part hasn't happened yet)</li> <li><code>enemydata</code> is not empty</li> </ul> <p>The only thing that happens here is an AIAttack action coroutine is started.</p>"},{"location":"Battle%20system/Battle%20flow/Main%20turn%20life%20cycle/#end-of-the-player-phase","title":"End of the player phase","text":"<p>If none of the possible parts applied above (or all of the applicable ones are done), the following happens which ultimately ends the player phase:</p> <ul> <li><code>enemy</code> is set to true</li> <li>All of the instance.<code>hud</code>'s first child has their local position reset to Vector3.zero</li> <li><code>currentturn</code> is set to the length of <code>playerdata</code></li> </ul>"},{"location":"Battle%20system/Battle%20flow/Main%20turn%20life%20cycle/#enemy-phase","title":"Enemy phase","text":"<p>This is where the enemies party portion of the turn is handled. It is denoted by <code>enemy</code> being true while there are at least 1 free enemy obtained via GetFreeEnemies. </p> <p>A free enemy is one whose <code>cantmove</code> is 0 or below (it has at least one action available) and whose <code>hp</code> is above 0 (not dead yet). If there are no free enemies, this phase is skipped and we move on to the turn end phase.</p> <p>If we somehow got here while GetAlivePlayerAmmount returns 0 (all <code>playerdata</code>'s <code>hp</code> is 0 or below or their <code>eatenby</code> isn't null which means they got eaten), this phase will end abruptly by doing the following:</p> <ul> <li><code>mainturn</code> is set to an AdvanceMainTurn call if it wasn't in progress already</li> <li><code>cancelupdate</code> is set to true which changes the flow to a terminal flow</li> </ul> <p>If at least one player is alive, then the first enemy with a <code>cantmove</code> of 0 or below is found. In order for the enemy to get their action, they need to not be considered IsStoppedLite which uses the same standard than IsStopped with actimmobile check, but with one difference: if the enemy has the <code>Flipped</code> condition, it isn't considered stopped.</p> <p>If the game finds it's stopped, their <code>cantmove</code> is set to 1 and the next enemy is checked instead. Effectively, this simply readjusts their actor turn counter because it isn't exhausted like it normally would have been in EndEnemyTurn.</p> <p>If the enemy isn't stopped, DoAction is called on the battleentity with actionid of the <code>enemydata</code> index. This changes to an uncontrolled flow. At most, this can happen only once and the next enemy in line will need to wait the current one's action is done.</p> <p>This process is repeated for each enemy party member until all of them have a <code>cantmove</code> above 0 meaning no actions are available on any enemy party members and the game is ready to proceed to the turn end phase.</p>"},{"location":"Battle%20system/Battle%20flow/Main%20turn%20life%20cycle/#turn-end-phase","title":"Turn end phase","text":"<p>After both parties performed their phases, an AdvanceMainTurn action coroutine is started and set to <code>mainturn</code> if it wasn't in progress already. This immediately move the flow back to uncontrolled flow while the coroutine handles the turn advancement.</p>"},{"location":"Battle%20system/Battle%20flow/PlayerTurn/","title":"PlayerTurn","text":"<p>This method processes any controlled flow during the player phase when applicable to the currently selected player.</p> <ul> <li><code>actedthisturn</code> is set to true</li> <li>If currentaction is <code>BaseAction</code> (the main vine action menu):<ul> <li>SetMaxOptions is called</li> <li>ItemList's <code>inlist</code> is set to false</li> <li>For each <code>playerdata</code>:<ul> <li>If the actor isn't IsStopped, its battleentity.<code>overrideanim</code> is set to false</li> <li>If battleentity.animstate is 24 (<code>Block</code>), UpdateAnim is called and the <code>playerdata</code> loop exited. NOTE: it means not all player party member might have their <code>overrideanim</code> set to false when not stopped, but in practice, this doesn't impact anything negatively under normal gameplay</li> </ul> </li> </ul> </li> <li>If <code>choicevine</code> doesn't exist, it is created via CreateVine:<ul> <li><code>choicevine</code> is created as a new GameObject named <code>Vine</code></li> <li><code>vineicons</code> is created as new array of length <code>maxoptions</code></li> <li><code>vinebase</code> is created as a new GameObject named <code>Base</code> childed to <code>choicevine</code></li> <li>Each <code>vineicons</code> elements is initialised as the SpriteRenderer of a new instance of <code>Prefabs/Objects/Vine</code> childed to the <code>vinebase</code> (each element causes the <code>choicevine</code> angles to be decreased by (0.0, 360 / <code>maxoptions</code> floored, 0.0)):<ul> <li>position of <code>choicevine</code> position + (0.0, 0.0, -1.6)</li> <li>angles of (-180, 275.0, 0.0)</li> <li>scale of (2.5, 2.5, 2.5)</li> <li>sprite of <code>guisprites[35 + i]</code> where i is the option index</li> <li>with flipX</li> </ul> </li> <li>The <code>choicevine</code> gets childed to the <code>battlemap</code></li> </ul> </li> <li>The <code>choicevine</code> position is set to <code>playerdata[currentturn].battleentity</code> position + (0.0, 10.0, 0.0)</li> <li>If <code>turncooldown</code> expired, GetChoiceInput is called which handles the player UI</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Retry/","title":"Retry","text":"<p>This method serves as a transition from a GameOver to a complete retry of the battle using StartBattle.</p> <pre><code>private void Retry(bool skipdata)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/Retry/#parameters","title":"Parameters","text":"<ul> <li><code>skipdata</code>: If true, ReloadInitialData won't be called. This is done if the caller already called it which is needed to adjust the starting stats to what they were on the first StartBattle recorded from <code>sdata</code></li> </ul>"},{"location":"Battle%20system/Battle%20flow/Retry/#prcedure","title":"Prcedure","text":"<ul> <li>All delprojs's <code>obj</code> are destroyed followed by the <code>delprojs</code> array set to null</li> <li>The <code>battlemap</code> is destroyed</li> <li>SetDefaultCamera with reset is called</li> <li><code>chompyattacked</code> is set to false</li> <li><code>aiattcked</code> is set to false</li> <li><code>tskybox</code> is set to RenderSettings.skybox</li> <li>RenderSettings.skybox is set to null</li> <li>instance.<code>enemyencounter</code> is set to <code>sdata.encounter</code></li> <li>If skipdata is false, ReloadInitialData is called which does the following (mostly loads from the StartUpData):<ul> <li>ApplyBadges is called</li> <li>ApplyStatBonus is called</li> <li>instance.<code>maxtp</code> is set to <code>sdata.maxtp</code></li> <li>instance.<code>tp</code> is set to <code>sdata.tp</code> clamped from 0 to instance.<code>maxtp</code></li> <li>For each player party member:<ul> <li><code>atk</code> is set to the matching <code>sdata.atk</code></li> <li><code>def</code> is set to the matching <code>sdata.def</code></li> <li><code>hp</code> is set to the matching <code>sdata.hp</code> clamped from 0 to the player party member's <code>maxhp</code></li> <li><code>lockitems</code> is set to the matching <code>sdata.partyitemuse</code></li> </ul> </li> <li>instance.<code>items[0]</code> (standard items) is set to <code>sdata.items</code></li> <li>instance.<code>items[1]</code> (key items) is set to <code>sdata.keyitem</code></li> </ul> </li> <li>A StartBattle call starts with the following:<ul> <li>enemyids: <code>sdata.enemies</code></li> <li>stageid: <code>sdata.stage</code></li> <li>adv: <code>sdata.adv</code></li> <li>music: <code>sdata.music</code></li> <li>calledfrom: <code>sdata.called</code></li> <li>canescape: <code>canflee</code> (from this BattleControl)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Update/","title":"Update","text":"<p>This Unity event is the main dispatcher of the battle flow. It only handles the synchronous high level flow that runs as long as control wasn't delegated to an action coroutine.</p> <p>There are 3 possible flows to a BattleControl update: terminal, uncontrolled and controlled. The flows are documented in their own page.</p> <p>The first flow whose conditions are fufilled will apply from the following table:</p> Flow Conditions Description Terminal <code>cancelupdate</code> is true or instance.<code>pausemenu</code> exists A flow where Update relegates almost complete control to a terminal coroutine which will end or retry this battle Uncontrolled <code>action</code> or <code>inevent</code> is true A flow where Update delegates most (but not all) control to an action coroutine which performs a specific battle action Controlled The battle isn't in a terminal or uncontrolled flow A flow where Update has complete control of the battle and will act as a dispatcher according to the main turn procedure"},{"location":"Battle%20system/Battle%20flow/UseCharm/","title":"UseCharm","text":"<p>This is a coroutine that is invoked at specific moments of DoAction and AddExperience. It will, when applicable, process a charm if the player had some left with the amount remaining being tracked by flagvar 22. </p> <p>The coroutine is expected to be stored in <code>checkingdead</code> as it will be set to null at the very end so the caller can yield on it. As for who gets targetted by the charm, it's either the party or the <code>currentturn</code> player party member depending on the <code>Charm</code>, an enum that identifies a charm type.</p> <pre><code>private IEnumerator UseCharm(Charm type)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#parameters","title":"Parameters","text":"<ul> <li><code>type</code>: The type of the charm to attempt to apply</li> </ul>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#procedure","title":"Procedure","text":"<p>In order for this coroutine to process the charm, all of the following must true when it is invoked (otherwise, nothing happens except <code>checkingdead</code> being set to null):</p> <ul> <li>flagvar 22 is above 0 (the player has at least 1 charm left)</li> <li><code>charmcooldown</code> is 0</li> <li>A 6% random test must pass (generate a random integer number between 0 and 100 exclusive, that number converted to float must be \\&lt;= 5.5 which is a pass from 0 to 5 inclusive which makes it 6%)</li> <li>At least 1 player party member's <code>hp</code> is above 0 and isn't <code>eatenby</code></li> <li>EnemyActingOutOfOrder returns false meaning no enemy party member's hitaction is true</li> <li>Either the type is <code>ExpUp</code> (meaning it was invoked from AddExperience) or it's any other type while <code>cancelupdate</code> is false (we aren't in a terminal flow)</li> <li>If the type is <code>AttackUp</code>, <code>playerdata[currentturn]</code> must not have the AttackUp condition already</li> </ul> <p>The following sections describes what happens when the charm is cleared to be processed.</p>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#charm-animation","title":"Charm animation","text":"<p>This section will be paraphrased as it contains verbose animation logic:</p> <ul> <li>The <code>Magic</code> sound is played</li> <li>A new nameless GameObject is created (locally refered to as dancer) that will have a SpriteRenderer initially using the <code>charmdance[0]</code> sprite (which is sprite 98 of <code>Sprites/Entities/moth0</code>) on layer 15 (<code>3DUI</code>) fully opaque with a SpinAround and a position of (0.0, 0.0, -0.5)</li> <li>All the intensity of Light GameObjects are saved locally</li> <li>Over the course of 40.0 frames (tracked with a local frame counter):<ul> <li>The dancer's alpha will be lerped from 0.0 to 0.6 with the factor being the time progression over the 40.0 frames</li> <li>The SpinAround on the dancer has its <code>itself</code>'s Y component set to a lerp from 0.0 to 15.0 with a factor of the time progression over the 40.0 frames (the X and Z components are always set to 0.0)</li> <li>All Light GameObject's intensity will be lerped from their initial value saved locally to half of it with a factor of the time progression over the 40.0 frames</li> </ul> </li> <li>0.5 seconds are yielded</li> <li>The dancer's sprite is set to <code>charmdance[1]</code> (which is sprite 99 of <code>Sprites/Entities/moth0</code>)</li> <li>The SpinAround of the dancer is destroyed</li> <li>The angles of the dancer are set to (0.0, 180.0, 0.0)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#charm-process","title":"Charm process","text":"<p>The logic here depends on the type:</p>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#attackup","title":"<code>AttackUp</code>","text":"<ul> <li>StatEffect is called on <code>playerdata[currentturn]</code> with type 0 (red up arrow)</li> <li>SetCondition is called on <code>playerdata[currentturn]</code> giving the AttackUp condition for 1 main turn</li> <li>The <code>StatUp</code> sound is played</li> </ul>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#defenseup","title":"<code>DefenseUp</code>","text":"<ul> <li>All player party members whose <code>hp</code> is above 0 and aren't <code>eatenby</code> have the following happen to them:<ul> <li>StatEffect is called on the player party member with type 1 (blue up arrow)</li> <li>SetCondition is called on the player party member giving the DefenseUp condition for 1 main turn</li> </ul> </li> <li>The <code>StatUp</code> sound is played</li> </ul>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#expup","title":"<code>ExpUp</code>","text":"<ul> <li><code>expreward</code> is multiplied by 1.15 floored then clamped from 0 to instance.<code>neededexp</code></li> <li>RefreshEXP is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#healhp","title":"<code>HealHP</code>","text":"<ul> <li>All player party members whose <code>hp</code> is above 0 and aren't <code>eatenby</code> have the following happen to them:<ul> <li>The amount of HP to heal is determined which is the player party member's <code>maxhp</code> * 0.2 floored clamped from 1 to the <code>maxhp</code></li> <li>The player party member's <code>hp</code> is increased by the amount to heal then clamped from 0 to its <code>maxhp</code></li> <li>ShowDamageCounter is called with type 1 with the amount of HP healed as the ammount starting at the player party member's battleentity position + Vector3.up to (2.0, 2.0, 2.0)</li> </ul> </li> <li>The <code>StatUp</code> sound is played</li> </ul>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#healtp","title":"<code>HealTP</code>","text":"<p>This type expects flagvar 1 to be set to the amount of TP to heal. This is the responsibility of the caller.</p> <ul> <li>ShowDamageCounter is called with type 2 with flagvar 1 as the ammount starting at the player party member's battleentity position + Vector3.up to (2.0, 2.0, 2.0)</li> <li>instance.<code>tp</code> is increaded by flagvar 1 then clamped from 0 to instance.<code>maxtp</code></li> <li>The <code>Heal2</code> sound is played</li> </ul>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#end-animation","title":"End animation","text":"<p>The following is paraphrased as it contains verbose animation logic:</p> <ul> <li>Over the course of 40.0 frames (tracked with a local frame counter):<ul> <li>The dancer's alpha will be lerped from 0.6 to 0.0 with the factor being the time progression over the 40.0 frames</li> <li>All Light GameObject's intensity will be lerped from half of their their initial value saved locally to their original value before this UseCharm call with a factor of the time progression over the 40.0 frames</li> </ul> </li> <li>All Light GameObject's intensity are restored to their original value before this UseCharm call</li> <li>The dancer is destroyed</li> </ul>"},{"location":"Battle%20system/Battle%20flow/UseCharm/#last-steps","title":"Last steps","text":"<ul> <li>flagvar 22 is decremented (this consumes the charm)</li> <li><code>charmcooldown</code> is set to a random number from 3 to 7 inclusive (this means a minimum amount of main turn needs to advance before the next charm is able to be processed even if it can be and the amount is between 3 and 7)</li> <li>If flagvar 22 reached 0 (meaning the last charm was just consumed):<ul> <li>A SetText call occurs in dialogue move using the text <code>|</code>boxstyle<code>,4||</code>center<code>||</code>halfline<code>||</code>spd<code>,0|</code> followed by <code>menutext[184]</code> (a message informing the player they no longer have any charms). The call also has these properties:</li> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>linebreak of <code>messagebreak</code></li> <li>No tridimensional</li> <li>position of Vector3.zero</li> <li>No cameraoffset</li> <li>size of Vector3.one</li> <li>No parent</li> <li>No caller</li> <li>All frames are yielded while the message lock is grabbed</li> </ul> </li> <li><code>checkingdead</code> is set to null which informs the caller the coroutine is complete</li> </ul>"},{"location":"Battle%20system/Battle%20flow/firststrike%20system/","title":"<code>firststrike</code> system","text":"<p>There is an exceptional case to the regular battle flow where half a main turn can be processed completely while StartBattle is ongoing. This is the case where <code>adv</code> had a value of 3 which allows the enemy party to perform what is called a <code>firststrike</code>.</p> <p>A <code>firststrike</code> is a main turn that occurs before the first one recognised by the battle system. It's a special main turn because the player phase is completely skipped. Only the Enemy phase and the end of turn phase occurs on that main turn.</p> <p>The way it works is when StartBattle receives an adv of 3, it setups the battle like the following:</p> <ul> <li><code>enemy</code> is set to true</li> <li><code>action</code> is set to true</li> <li><code>firststrike</code> is set to true</li> <li>DoAction is called with <code>enemydata[0]</code></li> <li>Yield until <code>action</code> goes to false</li> </ul> <p>The overall effect is it changes the battle flow to an uncontrolled flow as if the battle was in the enemy phase with the first enemy party member taking their actor turn.</p> <p>However, there is one key difference with this actor turn: <code>firststrike</code> is set to true. This has some implications:</p> <ul> <li>The enemy action can behave differently depending on if they are in a <code>firststrike</code> or not</li> <li>DoAction will not call a CheckDead in post action when no enemy fled </li> <li>DoAction won't froce drops the enemy party members in post action</li> </ul> <p>In a normal situation, DoAction gets done, <code>action</code> gets set to false and the battle switches to a controlled flow. However, keep in mind that StartBattle is yielding until <code>action</code> goes to false so at this point, StartBattle is ready to take over from now.</p> <p>Except that's not going to happen immediately due to coroutine's lower priority.</p>"},{"location":"Battle%20system/Battle%20flow/firststrike%20system/#what-happens-after-the-first-enemy-action","title":"What happens after the first enemy action?","text":"<p>StartBattle is a corotuine. It means that no matter what happens, Update gets processed BEFORE it resumes. It means that Update does get a chance to run before StartBattle realises that the battle already set <code>action</code> to false and can continue.</p> <p>Update however won't let StartBattle resume right away. Since StartBattle setup the battle system in such a way that the system already started and setup, it will act like normal. On that next Update, it will find that <code>enemydata[0]</code> spent an actor turn, but it will also process the next enemy actor turn available. Effectively, the battle proceeds like it would normally in the enemy phase despite the fact StartBattle isn't done and is actually still waiting!</p> <p><code>firststike</code> is still set to true when the enemy phase goes on like this. This gives an additional difference to a regular main turn: DoAction will NOT let other enemy party members act other than the first one if the <code>DoublePainReal</code> medal isn't equipped and flags 614 is false (HARDEST is inactive). This is a difficulty scaling feature: on hard mode or HARDEST, the entire enemy party member can act during a <code>firststrike</code>, but without either applying, only the first can act during a <code>firststrike</code>. If the action is skipped, DoAction will process as if the enemy did nothing in their action, but still consume their actor turn like normal.</p> <p>This keeps going until all enemy actor turns were consumed. All enemy actor turns will be consumed before StartBattle resumes because it only takes a single Update cycle to process the next enemy action. Effectively, the battle system switches back and forth between controlled flow and uncontrolled flow.</p>"},{"location":"Battle%20system/Battle%20flow/firststrike%20system/#a-special-main-turn-advance","title":"A special main turn advance","text":"<p>Since all enemy actor turns gets processed, it eventually leads the main turn to be in the turn end phase. This will call AdvanceMainTurn preventing once again StartBattle to resumes since this also changes to an uncontrolled flow.</p> <p>The main turn doesn't get advanced like normal however. For the most part, most of the procedure is the usual, but with some key differences due to <code>firststrike</code> being true still:</p> <ul> <li>AdvanceTurnEntity won't increment <code>turnssincealive</code> and <code>turnssincedeath</code></li> <li>AdvanceTurnEntity won't advance the <code>cantmove</code> or <code>moreturnnextturn</code> if the entity's <code>hp</code> is above 0. Effectively, their actor turn availability is frozen</li> <li>AdvanceMainTurn won't process the <code>MiracleMatter</code> medal effects</li> </ul> <p>The main turn however still gets advanced normally other than that. It means things like conditions, delproj process as normal, but the turn counters don't advance like normal.</p> <p>From there, AdvanceMainTurn eventually switches back to a controlled flow, but that Update won't lead to <code>action</code> being set to true this time. This finally gives a chance for StartBattle to resume as it's still been waiting.</p>"},{"location":"Battle%20system/Battle%20flow/firststrike%20system/#cleaning-up","title":"Cleaning up","text":"<p>From there, a main turn was advanced, but StartBattle would like to proceed as if it didn't happen. This leads to the following final steps to cleanup:</p> <ul> <li>A CheckDead happens just in case</li> <li>All enemy party members gets their <code>cantmove</code> and <code>tired</code> reset to 0 which resets their exhaustion and gives them 1 actor turn on this main turn. NOTE: This is incorrect and it should been set to -moves + 1. The overall effect of this error is enemies with a <code>moves</code> of 2 or above looses all, but one actor turn on the battle's first main turn</li> <li><code>currentturn</code> is reset to -1 (the previous Update potentially set the value, but it's undesired here as StartBattle isn't done yet)</li> <li><code>action</code> is set to false (it already was false so this makes doubly sure the battle is in a controlled flow)</li> <li><code>enemy</code> is set to false (same reason)</li> <li><code>firststrike</code> is set to false (ends the <code>firststrike</code>)</li> <li>SetLastTurns is called which resets <code>lastturns</code> to a new aray with the length being the amount of free players - 1 and all elements being -1 (this resets the player selection cycle)</li> </ul> <p>On top of this, later on, StartBattle ends by setting <code>turns</code> to 0. It effectively means that the main turn that was just advanced doesn't count towards the global main turn counter. It can be seen as if it was \"main turn number -1\".</p> <p>From there, the battle continues as normal.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/","title":"AIAttack","text":"<p>This action coroutine involves the <code>aiparty</code> doing its attack which is hardcoded according to its animid. </p> <p>When the coroutine starts, all frames will be yielded as long as any enemy party member is in a forcemove. Once they are all done, the actual logic starts.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/#preparation","title":"Preparation","text":"<ul> <li><code>action</code> is set to true switching to an uncontrolled flow</li> <li><code>combo</code> is set to 1</li> <li>ReorganizeEnemies(true) is called which sets <code>enemydata</code> to be all the alive enemies ordered by their x position</li> <li>The position of the <code>aiparty</code> is saved locally as the starting position</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/#attack","title":"Attack","text":"<p>This section depends on the animid of <code>aiparty</code>.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/#kungfumantis","title":"<code>KungFuMantis</code>","text":"<ul> <li>The first enemy party member whose position is <code>Ground</code> will be set as the target (<code>enemydata[0]</code> is set as falback if no grounded enemies exists)</li> <li>aiparty.<code>overrideflip</code> is set to true</li> <li>CameraFocus is called on the targetted enemy's battleentity's position which changes instance.<code>camoffset</code> to (0.0, 2.6, -6.0), instance.<code>camtarget</code> to null and instance.<code>camtargetpos</code> to the position of the targetted enemy</li> <li>MoveTowards is called on the aiparty to the targetted enemy's battleentity's position + (-1.25 * the targetted enemy's <code>size</code>, 0.0, -0.1) with a multiplier of 2.0 using animstate 1 (<code>Walk</code>) and stopping at animstate 100</li> <li>All frames are yielded while aiparty is in a <code>forcemove</code></li> <li>0.25 seconds are yielded</li> <li>Damages is only dealt if the targetted enemy's position was indeed <code>Ground</code> via a DoDamage call without attacker to the targetted enemy for 1 damage without properties and block. No damage is dealt if the enemy wasn't grounded (meaning none existed in the first place)</li> <li>SetDefaultCamera is called</li> <li>MoveTowards is called on the aiparty to the starting position saved earlier with a multiplier of 2.0 using animstate 1 (<code>Walk</code>) and stopping at animstate 5 (<code>Angry</code>)</li> <li>All frames are yielded while aiparty is in a <code>forcemove</code></li> <li>aiparty's position is set to the starting position saved earlier</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/#antcapitain","title":"<code>AntCapitain</code>","text":"<ul> <li>The first enemy party member whose position is <code>Ground</code> or <code>Flying</code> will be set as the target (<code>enemydata[0]</code> is set as falback if no enemies exists in either <code>position</code>)</li> <li>aiparty.<code>overrideflip</code> is set to true</li> <li>aiparty.<code>overridejump</code> is set to true</li> <li>MainManager.SetCamera is called with no target, the targetted enemy's battleentity's position as the targetpos, 0.03 as the speed and (0.0, 2.85, -7.5) as the offset</li> <li>MoveTowards is called on the aiparty to the targetted enemy's battleentity's position + (-2.5, 0.0, -0.15) with a multiplier of 2.5</li> <li>All frames are yielded while aiparty is in a <code>forcemove</code></li> <li>aiparty.<code>overrideanim</code> is set to true</li> <li>aiparty.animstate is set to 100</li> <li>LockRigid(false) is called to unlock the <code>rigid</code></li> <li>0.33 seconds are yielded</li> <li>If the targetted enemy's position was <code>Flying</code>, Jump is called on the aiparty with aiparty.<code>jumpheight</code> * 1.2 as the height followed by the <code>Jump</code> sound being played</li> <li>0.33 seconds are yielded</li> <li>The <code>Woosh3</code> sound is played</li> <li>DoDamage is called without attacker to the targgeted enemy for 3 damage without properties and block</li> <li>0.5 seconds are yielded</li> <li>aiparty.<code>overrideanim</code> is set to false</li> <li>MoveTowards is called on the aiparty to the starting position saved earlier with a multiplier of 2.0 using animstate 1 (<code>Walk</code>) and stopping at animstate 13 (<code>BattleIdle</code>)</li> <li>All frames are yielded while aiparty is in a <code>forcemove</code></li> <li>aiparty's position is set to the starting position saved earlier</li> <li>A frame is yielded</li> <li>aiparty.<code>flip</code> is set to true</li> <li>aiparty.<code>overrideflip</code> is set to false</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/#madeleine","title":"<code>Madeleine</code>","text":"<ul> <li>aiparty.<code>overrideflip</code> is set to true</li> <li>The first enemy party member whose position is <code>Ground</code> will be set as the target (<code>enemydata[0]</code> is set as falback if no grounded enemies exists)</li> <li>If the targetted enemy's position isn't <code>Ground</code> (meaning none was found), the attack won't do any damage and its logic will end after doing the following:<ul> <li>aiparty.<code>overrideanim</code> is set to false</li> <li>aiparty.animstate is set to 8 (<code>Happy</code>)</li> <li>0.5 seconds are yielded</li> <li>aiparty.animstate is set to 0 (<code>Idle</code>)</li> </ul> </li> <li>The logic proceed, starting by calling MainManager.SetCamera is called with no target, the targetted enemy's battleentity's position as the targetpos, 0.03 as the speed and (0.0, 2.85, -7.5) as the offset</li> <li>MoveTowards is called on the aiparty to the targetted enemy's battleentity's position + (-1.5, 0.0, -0.15) with a multiplier of 2.5</li> <li>All frames are yielded while aiparty is in a <code>forcemove</code></li> <li>aiparty.<code>overrideanim</code> is set to true</li> <li>aiparty.animstate is set to 100</li> <li>The <code>Woosh3</code> sound is played at 0.9 pitch</li> <li>0.5 seconds are yielded</li> <li>The <code>Woosh4</code> sound is played</li> <li>The following happens twice in sucession (the <code>Woosh4</code> sound is played at 1.1 pitch between the 2 iterations):<ul> <li>DoDamage is called without attacker to the targgeted enemy for 2 damage with a <code>NoExceptions</code> property without block</li> <li>If the targetted enemy's <code>weight</code> is less than 100, Jump is called on its battleentity</li> <li>The targetted enemy's battleentity.<code>spin</code> is set to (0.0, 15.0, 0.0)</li> <li>0.5 seconds are yielded</li> </ul> </li> <li>All frames are yielded while the targetted enemy's battleentity's y position is above 0.15</li> <li>The targetted enemy's battleentity.<code>spin</code> is zeroed out</li> <li>SetDefaultCamera is called</li> <li>aiparty.<code>overrideanim</code> is set to false</li> <li>MoveTowards is called on the aiparty to the starting position saved earlier with a multiplier of 2.0 using animstate 1 (<code>Walk</code>) and stopping at animstate 0 (<code>Idle</code>)</li> <li>All frames are yielded while aiparty is in a <code>forcemove</code></li> <li>aiparty's position is set to the starting position saved earlier</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/#maki","title":"<code>Maki</code>","text":"<ul> <li>aiparty.<code>overrideflip</code> is set to true</li> <li>aiparty.<code>overridejump</code> is set to true</li> <li>The first enemy party member whose position is <code>Ground</code> or <code>Flying</code> will be set as the target (<code>enemydata[0]</code> is set as falback if no enemies exists in either <code>position</code>)</li> <li>MainManager.SetCamera is called with no target, the targetted enemy's battleentity's position as the targetpos, 0.03 as the speed and (0.0, 2.85, -7.5) as the offset</li> <li>MoveTowards is called on the aiparty to the targetted enemy's battleentity's position + (-2.5, 0.0, -0.1) with a multiplier of 2.5</li> <li>All frames are yielded while aiparty is in a <code>forcemove</code></li> <li>aiparty.<code>overrideanim</code> is set to true</li> <li>LockRigid(true) is called to lock the <code>rigid</code></li> <li>The <code>MakiJump1</code> sound is played</li> <li>aiparty.animstate is set to 114</li> <li>0.45 seconds are yielded</li> <li>aiparty.animstate is set to 112</li> <li>The <code>MakiJump2</code> sound is played</li> <li>instance.<code>campspedd</code> is set to 0.1</li> <li>instance.<code>camoffset</code> is incremented by (0.0, 1.25, -1.25)</li> <li>Over the course of 11 frames (tracked by the game's frametime with a local counter), aiparty's position is lerped from the one it had before the first iteration to the same position incremented by (1.0, 4.0, 0.0) with the factor being the progression of those 11 frames. This essentially makes maki move upward and slightly to the right</li> <li>aiparty.animstate is set to 106</li> <li>The <code>MakiJump3</code> sound is played</li> <li>Over the course of 11 frames (tracked by the game's frametime with a local counter), aiparty's position is lerped from the one it had before the first iteration to the same position incremented by (0.0, -4.0, 0.0) with the factor being the progression of those 11 frames. This essentially makes maki move down to the position he had before the previous 11 frames lerp</li> <li>DeathSmoke is called with the targgeted enemy's battleentity's position with a size of (2.0, 2.0, 2.0)</li> <li>ShakeScreen is called with an amount of 0.2 for 0.5 frames</li> <li>If the targetted enemy's position isn't <code>Underground</code> (which can only happen if no <code>Ground</code> or <code>Flying</code> enemy party member existed and the first one happened to be <code>Underground</code>), DoDamage is called without attacked to the targgeted enemy for 6 damages with a <code>NoException</code> property and no block</li> <li>aiparty.animstate is set to 107</li> <li>0.65 seconds are yielded</li> <li>aiparty.<code>overrideanim</code> is reset to false</li> <li>LockRigid(false) is called to unlock the <code>rigid</code></li> <li>SetDefaultCamera is called</li> <li>MoveTowards is called on the aiparty to the starting position saved at the start of the coroutine with a multiplier of 2.0 using animstate 1 (<code>Walk</code>) and stopping at animstate 13 (<code>BattleIdle</code>)</li> <li>All frames are yielded while aiparty is in a <code>forcemove</code></li> <li>aiparty's position is set to the starting position saved at the start of the coroutine</li> <li>A frame is yielded</li> <li>aiparty.<code>flip</code> is set to true</li> <li>aiparty.<code>overrideflip</code> is set to false</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/#enemy-drop","title":"Enemy drop","text":"<p>This section only occurs if a non zero amount of damages was dealt to an enemy party member whose position was <code>Flying</code> while its cantfall is false:</p> <ul> <li><code>startdrop</code> is set to true</li> <li>If the targetted enemy party member doesn't have the <code>ToppleAirOnly</code> in its weakness or it does, but with a Topple condition, the following happens on the enemy:<ul> <li>StopAllCoroutines is called on the battleentity</li> <li>battleentity.<code>droproutine</code> is set to a new Drop coroutine starting on the battleentity</li> <li>All frames are yielded while battleentity.<code>droproutine</code> is in progress</li> <li>The enemy party member's position is set to <code>Ground</code></li> </ul> </li> <li><code>startdrop</code> is set to false</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AIAttack/#ending","title":"Ending","text":"<p><code>aiattacked</code> is set to true followed by a CheckDead starting.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AdvanceMainTurn/","title":"AdvanceMainTurn","text":"<p>This is an action coroutine that runs at the very end of every main turn when both parties no longer can act for this turn.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AdvanceMainTurn/#procedure","title":"Procedure","text":"<ul> <li><code>commandsuccess</code> is reset to false</li> <li><code>blockcooldown</code> is reset to 0.0</li> <li><code>action</code> is set to true which changes to an uncontrolled flow</li> <li>If the following conditions are met, delprojs are processed (see the section below for details):<ul> <li><code>delprojs</code> isn't empty</li> <li>There are at least one player party member who has their <code>hp</code> above 0 while not <code>eatenby</code></li> <li>There are at least one enemy party member who has their <code>hp</code> above 0</li> <li><code>gameover</code> isn't in progress</li> </ul> </li> <li><code>nonphyscal</code> is set to false</li> <li>Each player party member gets their actor turn advanced (see the section below for details)</li> <li>A frame is yielded</li> <li><code>availableplayers</code> is set to the amount of player party members whose <code>hp</code> is above 0</li> <li>If <code>availableplayers</code> is 0, DeadParty is started followed by an abrupt yield break. This will change to a terminal flow as it is a terminal coroutine.</li> <li>If there is at least one enemy party member, the enemy party section of the turn advancement is performed alongside some end of main turn process (see the section below for details)</li> <li>Otheriwse if <code>gameover</code> was already in progress, a yield break is issued because it means we already changed to a terminal flow and nothing is left to do</li> <li>Otherwise: <ul> <li><code>cancelupdate</code> is set to true changing to a terminal flow</li> <li>A second is yielded</li> <li>If <code>inevent</code> is false (we weren't in an EventDialogue), AddExperience is started changing to a terminal flow. NOTE: the coroutine still continues, but in practice, it can't race against AddExperience</li> </ul> </li> <li>If <code>actedthisturn</code> is false, <code>noaction</code> is incremented</li> <li>If <code>gameover</code> isn't in progress while <code>noaction</code> is 5 (meaning 5 main turns passed without the ability for the player party to act), the inaction failsafe is done (see the section below for more details)</li> <li><code>actedthisturn</code> is set to false</li> <li><code>forceattack</code> is set to -1</li> <li><code>playertargetID</code> is set to -1</li> <li>If <code>damagethisturn</code> is higher than flagvar 41 (highest damage in one turn), the flagvar value is set to <code>damagethisturn</code></li> <li><code>damagethisturn</code> is set to 0</li> <li>RefreshAllData is called which sets <code>alldata</code> to a new list which consists of all the <code>playerdata</code> followed by all the <code>enemydata</code> appended together</li> <li>UpdateEntities is called</li> <li>UpdateAnim is called</li> <li><code>option</code> is set to <code>lastaction</code></li> <li>If there is at least one enemy party member, UpdateAnim is invoked again in 0.75 seconds</li> <li>If <code>charmcooldown</code> is above 0, it is decremented</li> <li><code>chompyattacked</code> is set to false</li> <li><code>hideenemyhp</code> is set to false</li> <li><code>mainturn</code> is set to null (which signals the coroutine is no longer in progress as no yield will be done from now on)</li> <li>All GameObjects with tag <code>DestroyTurn</code> have their tag set to <code>Untagged</code> followed by their destruction in 5.0 seconds</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AdvanceMainTurn/#delprojs-advance","title":"<code>delprojs</code> advance","text":"<p><code>delprojs</code> (or delayed projectiles) are projectiles that an enemy can launch and the projectile will only hit the targetted player party member after a certain amount of main turns passed. This section processes them.</p> <p>The first thing that happens is <code>nonphyscal</code> is set to true (it will be set to false after this section).</p> <p>From there, for each <code>delprojs</code> (going from last to start), the delproj's <code>turns</code> gets decremented and if it reached 0, it will land by doing the following:</p> <ul> <li>instance.<code>camtarget</code> is set to null</li> <li>instance.<code>camtargetpos</code> is set to (-4.25, 0.0, 0.0)</li> <li>instance.<code>camoffset</code> is set to (0.0, 4.0, -8.5)</li> <li><code>enemy</code> is set to true</li> <li><code>blockcooldown</code> is set to 0.0</li> <li><code>commandsuccess</code> is set to false</li> <li>If the delproj has a <code>whilesound</code> set, it is played on loop unless the first character is <code>@</code> in which case, it will play the sound only once where name is the one without the <code>@</code></li> <li>The <code>args</code> of the delproj are parsed as explained in the delayed projectile documentation</li> <li>Unless a <code>noshadow</code> command was parsed, a ShadowLite is added to the delproj's <code>obj</code></li> <li>For delproj's <code>framestep</code> amount of frames, the projectile is moved (kept track with a local frame counter starting at 0.0 and getting incremented by MainManager.<code>framestep</code> each iteraction):<ul> <li>The delproj's <code>obj</code> psotion is set to a lerp from the initial one to the <code>partypos</code> of the delproj's <code>position</code> + the <code>move</code> command offset if it was parsed with a factor of the ratio between the amount of frames spent so far on this loop vs delproj's <code>framestep</code></li> <li>A frame is yielded</li> </ul> </li> <li>If the delproj had a <code>whilesound</code>, it is stopped. NOTE: if this wasn't a looped sound, the call won't work, but the sound will stop on its own</li> <li>If the delproj has a <code>deathsound</code>, it is played</li> <li>If the delproj has <code>deathparticle</code>, they are played at the <code>obj</code> position + the <code>partoff</code> command offset if it was parsed</li> <li>The delproj's <code>obj</code> is destroyed</li> <li>If the player party member whose index is the <code>partypointer</code> corresponding to the delproj's <code>position</code> has an <code>hp</code> above 0 and doesn't have an <code>eatenby</code>, some logic is performed on this player party member:<ul> <li>DoDamage is called targetting the player party memmber without an attacker for delproj's <code>damage</code> damageammount with delproj's <code>property</code> as the property and <code>commandsuccess</code> as the block</li> <li>If the <code>hp</code> of the player party member reached 0 or below, their <code>turnssincedeath</code> is set to -1</li> </ul> </li> <li>RemoveDelayedProjectile is called on the delproj which removes it from <code>delprojs</code></li> <li><code>enemy</code> is set to false</li> <li>0.6 seconds are yielded</li> </ul> <p>If any <code>delprojs</code> landed:</p> <ul> <li>SetDefaultCamera is called</li> <li><code>checkingdead</code> is set to a CheckDead action coroutine starting</li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> <li><code>action</code> is set again to true</li> <li>A frame is yielded</li> <li>All actors from both parties with a <code>cantmove</code> below 1 (at least one action available) gets their <code>cantmove</code> clamped from 1 to 99 (forcing at least one turn needed before an action is available). This in practice doesn't do anything destructive because <code>moreturnnextturn</code> is granted later correctly and it's not possible to have a meaningul <code>cantmove</code> above 0 by this point (if it happened, it likely means the player party member IsStopped which imply that when the stopping condition gets removed, the <code>cantmove</code> will reset anyway).</li> <li><code>currentturn</code> is set to 1 (deselects any previously selected player party member)</li> <li>0.5 seconds are yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AdvanceMainTurn/#player-party-advance","title":"Player party advance","text":"<p>This section happens for each player party member.</p> <ul> <li>The corresponding <code>receivedrelay</code> of the player party member index is set to false</li> <li>AdvanceTurnEntity is called on the player party member with hasdelay starting at false</li> <li>If the turn advancement resulted in hasdelay becoming true, 0.75 seconds are yielded</li> <li>If <code>eatenkill</code> is true (meaning a player party member died as a result of an eating attack) the game needs to properly kill the player party member that died by doing the following:<ul> <li><code>eatenkill</code> is set to false</li> <li>All frames are yielded while spitout is in progress</li> <li><code>checkingdead</code> is set to a new CheckDead coroutine starting</li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> </ul> </li> <li>battleentity.<code>shakeice</code> is set to false</li> </ul> <p>Finally, if the <code>MiracleMatter</code> medal is equipped on the player party member, a revival process will occur, but it can only happen if on top of the medal being equipped, all the following are true:</p> <ul> <li>This isn't a firststrike from the enemy party</li> <li>At least one player party member has its <code>hp</code> above 0 without being <code>eatenby</code></li> <li><code>lockmmater</code> is false</li> <li>The player party member has its <code>turnssincedeath</code> be at least (2 - amount of <code>MiracleMatter</code> equipped - 1) after clamping from 1 to 3 (essentially, at least 2 if only one is equipped, at least 1 if 2, at least 0 if more is equipped, but this case isn't possible under normal gameplay)</li> </ul> <p>If all the conditions are met, the revive occurs as follows:</p> <ul> <li><code>turnssincedeath</code> is set to 0</li> <li>RevivePlayer is called on the player party member index with 2 hp and with showcounter</li> <li>0.5 seconds are yielded</li> <li>If the player party member's <code>lockcantmove</code> is false, their <code>cantmove</code> is set to 0 (this gives them one action available)</li> <li>The player party member's <code>lockcantmove</code> is set to false</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AdvanceMainTurn/#enemy-party-advance-and-end-of-main-turn-process","title":"Enemy party advance and end of main turn process","text":"<p>This section not only manages enemy turn advance, but it also does some end of main turn process because being in this section means the battle is not going to end.</p> <p>The first thing that happens is relating to the <code>FavoriteOne</code> medal which is tracked by <code>attackedally</code>. If it's not negative, it means the player party member with the matching <code>trueid</code> was attacked and the other members should receive the medal's benefits. This is only done if there is more than 1 player party member's <code>hp</code> above 0 while not being <code>eatenby</code>.</p> <p>NOTE: This imply that if the <code>attackedally</code> player party member got hit as well as another player party member on the same main turn, the logic won't happen because the game requires more than 1 player party members alive. This isn't correct: it should require at least 1 player party member alive instead of 2 or more.</p> <p>The process to apply the medal is as follows:</p> <ul> <li>For each player party member whose <code>trueid</code> isn't <code>attackedally</code> with an <code>hp</code> above 0 and without the Eaten condition:<ul> <li>battleentity.<code>emoticoncooldown</code> is set to 40.0</li> <li><code>didnothing</code> is set to false</li> <li>battleentity.<code>emoticonid</code> is set to 2 (red ! mark)</li> </ul> </li> <li>If at least one player party member had an emote set, the <code>Wam</code> sound is played</li> <li>All frames are yielded while the last player party member's battleentity.<code>emoticoncooldown</code> is above 0.0</li> <li>For each player party member whose <code>trueid</code> isn't <code>attackedally</code> with an <code>hp</code> above 0 with a <code>charge</code> less than 3 and without the Eaten condition:<ul> <li>A StatEffect of type 4 (green up arrow) coroutine is started on the player party member</li> <li><code>charge</code> is incremented</li> </ul> </li> <li>If at least one player party member gained a <code>charge</code>, the <code>StatUp</code> sound is played at 1.25 pitch</li> <li>0.5 seconds are yielded</li> <li><code>attackedally</code> is reset to -1</li> </ul> <p>From there, each enemy party members gets their turn advanced by having the following logic apply to each of them:</p> <ul> <li>AdvanceTurnEntity is called on the eneny party member with hasdelay starting at false which advances their actor turn</li> <li>If hasdelay got a value of true after the turn advancement, 0.75 seconds are yielded</li> <li>battleentity.<code>shakeice</code> is set to false</li> <li>If <code>cantmove</code> is 0 (they would have only 1 action available after the actor turn), <code>cantmove</code> is set to -<code>moves</code> + 1 (this resets the available actions counter to the base one set from the normal amount being moves)</li> <li>battleentity.<code>spin</code> is zeroed out</li> <li><code>turnsnodamage</code> is incremented (this value is only written to, but never read so it's UNUSED)</li> </ul> <p>Finally, some end of main turn process logic occurs:</p> <ul> <li>SetLastTurns is called which resets <code>lastturns</code> elements to be all -1 which resets the player party member selection cycle</li> <li>A frame is yielded</li> <li><code>turns</code> is incremented</li> <li><code>checkingdead</code> is set to a EndOfTurnMedals coroutine starting followed by all frames being yielded while the coroutine is in progress. This is what the coroutine does:<ul> <li>Every 2 <code>turns</code>, for each player party member with the <code>HappyHeart</code> medal equipped and whose <code>hp</code> is above 0:<ul> <li>Heal is called on the player party member with the amount being 2 * the amount of <code>HappyHeart</code> medals equipped</li> <li>0.5 seconds are yielded</li> </ul> </li> <li>Every 2 <code>turns</code> (same cycle as the one above), if the <code>HappyTP</code> medal is equipped:<ul> <li>HealTP is called which plays a <code>Heal2</code> sound followed by a heal of instance.<code>tp</code> by 2 * the amount of <code>HappyTP</code> medals equipped clamped from 0 to instance.<code>maxtp</code> followed by a ShowDamageCounter with type 2 (TP), the amount being the amount of tp healed, the start position being <code>playerdata[</code>GetRandomAvaliablePlayer()<code>].battleentity</code> position + (2.0, 2.0, 2.0) and the end position being (5.0, 5.0, 5.0)</li> <li>0.5 seconds are yielded</li> </ul> </li> <li><code>checkingdead</code> is set to null which informs the caller the coroutine has ended so it can stop yielding</li> </ul> </li> <li><code>option</code> is set to 0</li> <li><code>currentturn</code> is set to -1 (this unselects any players party members previously selected)</li> <li><code>enemy</code> is set to false (this resets the controlled flow to be in the player phase)</li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li><code>action</code> is set to false changing to a controlled flow</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/AdvanceMainTurn/#inaction-failsafe","title":"Inaction failsafe","text":"<p>There is a failsafe in the game where if after 5 main turns, PlayerTurn was never called meaning the player party could in no way perform any actions, the game will forcefully allow the player party to act again. This is tracked by <code>actedthisturn</code> being false reporting no action could be taken and the total amount of main turn is tracked by <code>noaction</code>. This failsafe exists presumably to mitigate a situation where the player party is stopped for too long notably through the results of stopping conditions.</p> <p>The failsafe is applied by doing the following:</p> <ul> <li><code>noaction</code> is reset to 0</li> <li>For each player party member that IsStopped without skipimmobile while their <code>hp</code> is above 0:<ul> <li><code>MagicUp</code> particles are played at the battleentity position</li> <li>ClearStatus is called on the player party member</li> <li>Their <code>cantmove</code> is set to 0 making them able to act again</li> </ul> </li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>UpdateAnim is called</li> <li>If at least one player party member had ClearStatus called on them earlier, the <code>Heal3</code> sound is played followed by a 0.5 seconds yield</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/CheckDead/","title":"CheckDead","text":"<p>This is an action coroutine that runs at specific points during the battle to check the health of every actors and if any are found dead when they weren't before, the coroutine performs the process to kill them properly mainly by calling Death on their battleentity. The coroutine is usually stored on the <code>checkingdead</code> field which tracks whether or not a CheckDead is in progress, but other coroutines may use this field.</p> <p>NOTE: This field is shared by other coroutines, but as long as care is taken such that no collisions happens, this is fine. Under normal gameplay, this is normally safe.</p> <p>The coroutine does nothing if <code>gameover</code> is in progress. In that case, <code>checkingdead</code> is set to null followed by a yield break.</p> <p>Here's the CheckDead procedure:</p> <ul> <li><code>deadenemypos</code> is reset to a new list</li> <li><code>action</code> is set to true which changes to an uncontrolled flow</li> <li>For player party member whose <code>hp</code> is 0 or below while their battleentity.<code>death</code> is false (meaning this member should be dead, but isn't currently), the player death process occurs (see the section below for more details)</li> <li>From there, if there are no longer any player party members with an <code>hp</code> above 0 while not <code>eatenby</code>, a DeadParty terminal coroutine is started changing to a terminal flow followed by a yield break which abruptly ends this CheckDead</li> <li>If any player party member were killed, SetLastTurns is called which resets <code>lastturns</code> to a new aray with the length being the amount of free players - 1 and all elements being -1 (this resets the player selection cycle)</li> <li>The enemy death checks occurs (see the section below for details)</li> <li>If <code>deadenemypos</code> isn't empty (meaning at least one enemy party member died or fled during this CheckDead), <code>extraenemies</code> isn't empty and there are still player party members with an <code>hp</code> above 0 while not being <code>eatenby</code>, the <code>extraenemies</code> summons procedure is performed (check the section below for details)    </li> <li>If there are no longer any enemy party members left while <code>mainturn</code> isn't in progress, <code>mainturn</code> is set to a new AdvanceMainTurn call which will take care of detecting the terminal case of winning the battle and act accordingly</li> <li>Otherwise:<ul> <li>A frame is yielded</li> <li>If EnemyDropping reports that all enemy party members's battleentity.<code>droproutine</code> isn't in progress while <code>mainturn</code> isn't in progress, <code>action</code> is set to false which will change to a controlled flow once CheckDead completes</li> </ul> </li> <li>If we aren't <code>inevent</code>, ReorganizeEnemies is called with order</li> <li><code>checkingdead</code> is set to null which reports to the rest of BattleControl that CheckDead is no longer in progress</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/CheckDead/#player-party-member-death-process","title":"Player party member death process","text":"<ul> <li><code>tired</code> is set to 0 (removes all exhaustions)</li> <li><code>charge</code> is set to 0</li> <li>StartDeath is called on the battleentity which starts a Death process on it</li> <li>If <code>enemy</code> is true (the player party member died during the enemy phase, a hitaction or a delproj advance), <code>turnssinedeath</code> is set to -1 (this is so it gets incremented to 0 on their AdvanceTurnEntity later).</li> <li>ClearStatus is called on the player party member</li> <li>battleentity.<code>dead</code> is set to true (the Death process already does that)</li> <li>If the battleentity.animid matches the battle's <code>forceattack</code>, it is reset to -1 (since the target is no longer valid)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/CheckDead/#enemy-party-death-checks","title":"Enemy party death checks","text":"<p>The following is enclosed in an infinite while loop, but in practice, it will only be iterated a maximum of 2 times.</p> <p>An enemy party member is considered dead if they have fled or their <code>hp</code> isn't above 0 while their battleentity isn't <code>dead</code> yet. For each that are found:</p> <ul> <li>The battleentity position is added to <code>deadenemypos</code></li> <li>DestroyConditionIcons is called on the battleentity</li> </ul> <p>From there, the dying process depends if the enemy party member <code>fled</code> or not.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/CheckDead/#die-by-fleeing","title":"Die by fleeing","text":"<p>The following happened if CheckDead found the enemy party member fled:</p> <ul> <li>battleentity's position is set to offscreen at (0.0, -1000.0, 0.0)</li> <li>If <code>destroyentity</code> is true, the battle entity gets disabled</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/CheckDead/#die-by-hp-not-being-above-0","title":"Die by <code>hp</code> not being above 0","text":"<p>The following happens if CheckDead found the enemy hasn't fled meaning they were found dead because their <code>hp</code> wasn't above 0:</p> <ul> <li><code>charge</code> is set to 0</li> <li>condition is reset to a new list</li> <li>LockRigid(false) is called on the battleentity to unlock its <code>rigid</code></li> <li>If holditem wasn't -1, DropItem is called on the enemy party member with additem true</li> <li>If <code>animid</code> (the enemy id) is less than the amount of instance.<code>enemyencounter</code> (normally 256), <code>alreadycounted</code> is false and battleentity.<code>cotunknown</code> is false (this isn't a Cave Of Trials's shadow), the corresponding bestiary entry's defeated counter is incremented followed by setting <code>alreadycounted</code> to true</li> <li>The EXP amount is obtained by performing a BattleControl.GetEXP call on the <code>exp</code>, <code>fixedexp</code> and the <code>animid</code> (the enemy id) clamped from 0 to instance.<code>neededexp</code> unless battleentity is a <code>hologram</code> in which case, it's clamped from 0 to 5 instead. This method can change the rewarded exp with a given scaled enemy's <code>exp</code> field, check the documentation to learn more</li> <li><code>expreward</code> is increased by the amount determined above and then clamped from 0 to instance.<code>neededexp</code></li> <li><code>moneyreward</code> is increased by the return of GetMoney using <code>money</code> which is a uniform random number between 0 and <code>money</code> inclusive</li> <li><code>exp</code> is set to 0</li> <li>If eventondeath is -1:<ul> <li>Death is called on the battleentity</li> <li>entity.<code>spitexp</code> is set to the amount of EXP determined earlier</li> <li><code>money</code> is set to 0</li> </ul> </li> <li>Otherwise if <code>inevent</code> is false, <code>inevent</code> is set to true followed by an EventDialogue starting with eventondeath as the id</li> <li>If the current enemy party member index is still valid (protects against an edgecase that can involve EventDialogue 9 which involves the <code>Acolyte</code> enemy):<ul> <li>If deathtype is 2, 3, 4 or 5, the enemy party member is added to <code>reservedata</code></li> <li>The <code>animid</code> (the enemy id) is added to instance.<code>lastdefeated</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/CheckDead/#cleanup-and-diebyitself-rechecks","title":"Cleanup and diebyitself rechecks","text":"<p>The following happens after all checks are done:</p> <ul> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on the battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>If any enemy was found to be <code>dead</code> or fled earlier, ReorganizeEnemies is called without skip</li> </ul> <p>Finally, this is where all of this section's logic can be reiterated. It happens if all of the reamining enemy party members have their <code>diebyitself</code> set to true. This means that they should die automatically and in order to do so, their <code>hp</code> are set to 0 and their <code>diebyitself</code> set to false to avoid reentering this case.</p> <p>By reiterating all the enemies check like this, CheckDead will be forced to detect the death of all remaining enemy party members because their <code>hp</code> were just set to 0. This recheck can only happen once making the loop iterating a maximum of 2 times.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/CheckDead/#extraenemies-summons","title":"<code>extraenemies</code> summons","text":"<p>This section will move the appropriate amount of <code>extraenemies</code> to the main <code>enemydata</code> array so the ones that died can be replaced when applicable. Here's the process:</p> <ul> <li>All the enemy party members that died or fled during this CheckDead has their <code>droproutine</code> stopped then set to null if it was in progress</li> <li>For each <code>deadenemypos</code> (but not more than the amount in <code>extraenemies</code>):<ul> <li><code>summonnewenemy</code> is set to true</li> <li>SummonEnemy is called with type <code>Offscreen</code>, the enemy id being the <code>extraenemies</code> at the same index than the <code>deadenemypos</code> and the position being the <code>deadenemypos</code></li> <li>0.5 seconds are yielded</li> </ul> </li> <li>All frames are yielded as long as <code>summonnewenemy</code> is true and EnemiesAreNotMoving reports false (meaning at least one enemy party member has their battleentity is in a forcemove)</li> <li>If instance.<code>map</code> is the <code>AbandonedCity</code> map and flags 400 (temporary slot) is true, all enemy party members have 2 SetCondition calls on them: one with AttackUp for 999999 actor turns and one with DefenseUp for 999999 actor turns</li> <li>All the corresponding <code>extraenemies</code> that were just summoned are removed from <code>extraenemies</code></li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/","title":"Chompy","text":"<p>This action coroutine involves <code>chompy</code>'s special attack phase when she is present. It it is called during the player phase after all player party members's actor turns are done. Whether or not this coroutine has ran is tracked by <code>chompyattacked</code> and whether or not it's in progress is tracked by the <code>chompyattack</code> coroutine (<code>chompyaction</code> also tells if the setup is complete). </p> <p>The actual flow is only switched once the setup is complete meaning this coroutine may stay in a controlled flow for a little while before switching to an uncontrolled flow</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/#setup","title":"Setup","text":"<p>This section runs first and performs any waits or setup needed before switching to an uncontrolled flow.</p> <ul> <li>A frame is yielded if there's at least one <code>extraenemies</code></li> <li>All frames are yielded while <code>checkingdead</code> is in progress, <code>summonnewenemy</code> is true or while any enemy party member's battleentity is in a <code>forcemove</code></li> <li>ReorganizeEnemies(true) is called which removes all dead enemy party members and orders them by battleentity.position.x</li> <li>RefreshEnemyPos is called which checks all <code>enemydata</code> whose <code>hp</code> is above 0, whose cantfall is false and whose position is <code>Ground</code> or <code>Flying</code>. If the enemy battleentity.<code>height</code> is above battleentity.<code>minheight</code> + 0.5, the <code>position</code> is set to <code>Flying</code>, <code>Ground</code> otherwise</li> <li><code>combo</code> is set to 1</li> <li><code>chompyaction</code> is set to true informing that the setup is complete</li> <li><code>action</code> is set to true switching to a uncontrolled flow</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/#vine-menu-setup","title":"Vine menu setup","text":"<p>This section builds the vine menu.</p> <ul> <li>A new GameObject named <code>ChompyVine</code> is created and childed to <code>battlemap</code> with a position of <code>chompy</code>'s position + (0.0, 10.0, 0.0)</li> <li>A new GameObject named <code>Base</code> is created and childed to <code>ChompyVine</code> with a scale of to (1.0, 0.75, 1.0) and angles of (0.0, -40.0, 0.0)</li> <li><code>coptions</code> is set to a new list with 2 elements being 0 and 1 (these are the attack and do nothing options)</li> <li>The list of the ribbons's item ids in <code>items[1]</code> (key items) is obtained locally via EventControl.ChompyRibbons. Only the <code>ChomperRibbon</code>, <code>PoisonRibbon</code>, <code>NumbRibbon</code>, <code>SleepRibbon</code> and <code>RedRibbon</code> items counts</li> <li>If the lost of ribbons isn't empty, 3 is added to <code>coptions</code> (this adds the switch ribbons option)</li> <li>If flags 404 is true (chompy has a ribbon on her) and flagvar 56 (the item id of the ribbon chompy has on her) isn't <code>ChomperRibbon</code> <code>RedRibbon</code> or 0 (which means unequipped here), 2 is added to <code>coptions</code> (this adds the the ribbon specific attack option)</li> <li><code>maxoptions</code> is set to the final amount of <code>coptions</code></li> <li><code>option</code> is set to <code>chompyoption</code>. This means the default option will be the last one selected during the battle, but if that option index is no longer available by checking if it's equal or higher than <code>maxoption</code>, <code>option</code> is set to 0 instead (attack)</li> <li>For each option indexes available from 0 to <code>maxoptions</code> exclusive:<ul> <li>A <code>Prefabs/Objects/Vine</code> is instantiated to a new GameObject childed to the <code>Base</code> with a position of <code>ChompyVine</code>'s position + (0.0, 0.0, -1.0), a scale of (2.5, 2.5, 2.5) and a SpriteRenderer component</li> <li><code>ChompyVine</code>'s angles are decremented by (0.0, 360 / <code>maxoptions</code> converted to float, 0.0)</li> <li>The sprite of the SpriteRenderer of the vine GameObject is set depending on the corrsponding <code>coption</code> matching the option index:<ul> <li>0 (Attack): <code>guisprites[147]</code></li> <li>1 (Do Nothing): <code>guisprites[148]</code></li> <li>2 (Ribbon specific action): Depends on the flagvar 56 (the item id of the ribbon chompy has on her). This also initialises the attack property of the bite specific attack (check the selected option handling for details). The sprite is <code>guisprites[158]</code> for the <code>PoisonRibbon</code>, <code>guisprites[159]</code> for the <code>NumbRibbon</code> and <code>guisprites[160]</code> for the <code>SleepRibbon</code>. Additionally, if instance.<code>tp</code> is less than 2, the material of the sprite is set to MainManager.<code>grayscale</code></li> <li>3: (Switch Ribbon) <code>guisprites[217]</code></li> </ul> </li> <li>The sprite of the vine GameObject's flipX is set to true</li> </ul> </li> <li>currentaction is set to <code>Chompy</code></li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/#vine-menu-selection-loop","title":"Vine menu selection loop","text":"<p>This is an infinite loop that runs until an option has been confirmed in the vine menu. Everything in this section runs perpetually until explicitly said otherwise.</p> <ul> <li>RefreshEnemyHP is called</li> <li>As long as input 4 (confirm) isn't pressed, the following runs in an inner infinite loop:<ul> <li>If input 3 (left) or input 2 (right) is pressed, the <code>Scroll</code> sound is played followed by the <code>option</code> being decremented or incremented accordingly with wrap around to <code>maxoptions</code> - 1 followed by UpdateText being called</li> <li><code>Base</code> y angle is lerped from the existing one to -<code>option</code> * (360.0 / <code>maxoptions</code>) - 40.0 with a factor of 1/10 of the game's frametime</li> <li><code>Base</code>'s y scale is lerped from the existing one to 1.0 with a factor of 1/10 of the game's frametime (the x and z scale are set to 1.0)</li> <li>A frame is yielded</li> </ul> </li> <li>Getting here means a main vine menu option was chosen. If it's 2 (ribbon specific action) while instance.<code>tp</code> is less than 2, the buzzer sound is played followed by a frame yield followed by perfoming another iteration of the selection loop</li> <li>If the confimed option isn't 3 (switch ribbons), the slection loop ends (switch ribbon is the only option that needs further handling once chosen)</li> <li>The <code>Confirm</code> sound is played if it wasn't already</li> <li>currentaction is set to <code>BaseAction</code></li> <li>UpdateTect is called</li> <li>instance.<code>multilist</code> is set to the ribbons list obtained earlier except the one held in flagvar 56 (the one chompy has on her)</li> <li>SetText is called in dialogue mode using the text <code>|</code>hide<code>||</code>pickitem<code>,35,-11,-11|</code> (which pops an ItemList with the chompy ribbons list type). The call has these properties:<ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>linebreak of <code>messagebreak</code></li> <li>No tridimensional</li> <li>position of Vector3.zero</li> <li>No cameraoffset</li> <li>size of Vector3.one</li> <li>No parent</li> <li>No caller</li> </ul> </li> <li>RefreshEnemyHP is called</li> <li>As long as the message lock is active:<ul> <li><code>Base</code>'s y angle is set to a lerp from the existing one to -<code>option</code> * (360.0 / <code>maxoptions</code>) - 40.0 with a fractor of <code>framestep</code> * 0.1</li> <li><code>Base</code>'s y scale is lerped from the existing one to 1.0 with a factor of <code>framestep</code> * 0.1 (the x and z scale are set to 1.0)</li> <li>A frame is yielded</li> </ul> </li> <li>Getting here means the ItemList handling and the dialogue has completed. If MainManager.<code>listcancelled</code> is true, it means the selection loop isn't done yet and the following is performed:<ul> <li><code>option</code> is set to the value it had before the SetText call (this is because the ItemList system uses it so it restores the value to continue being used for the vine menu)</li> <li><code>maxoptions</code> is set to the amount of <code>coptions</code> (this is also because it was used as part of ItemList)</li> <li>currentaction is set back to <code>Chompy</code></li> <li>UpdateText is called</li> <li>Another iteration of the vine menu selection loop is performed</li> </ul> </li> <li>The value of flagvar 0 is saved locally (this corresponds to the item id of the selected ribbon)</li> <li>The vine menu selection loop ends here as the switch ribbon option was just confirmed</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/#selected-option-handling","title":"Selected option handling","text":"<p>Getting here means that an option has been confirmed in the vine menu selection loop and the coroutine is ready to handle it.</p> <ul> <li><code>chompyoption</code> is set to the selected <code>option</code></li> <li>currentaction is reset to <code>BaseAction</code></li> <li>UpdateText is called</li> <li>The <code>Confirm</code> sound is played</li> <li>The <code>ChompyVine</code> object is destroyed</li> <li><code>hideenemyhp</code> is set to true</li> </ul> <p>What follows depends on the <code>coption[option]</code> selected.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/#0-attack-or-2-ribbon-specific-action","title":"0 (Attack) or 2 (Ribbon specific action)","text":"<ul> <li>If the <code>coption</code> is 2 (ribbon specific action), instance.<code>tp</code> is decreased by 2</li> <li>All player party members has DestroyConditionIcons called on their entity (not battleentity)</li> <li>All enemy party members has DestroyConditionIcons called on their entity if it exists (this is normally the same than battleentity)</li> <li>The enemy party member to target is obtained by getting the first one whose position is <code>Ground</code> or <code>enemydata[0]</code> if none are found</li> <li>MainManager.SetCamera is called with no target, the targetted enemy's battleentity's position as the targetpos, 0.03 as the speed and (0.0, 2.85, -7.5) as the offset</li> <li>The x/z position of <code>chompy</code> are saved locally (the y component is saved to 0.0)</li> <li><code>chompy</code>'s <code>overrideflip</code> is set to true</li> <li>MoveTowards is called on <code>chompy</code> to move towards the targetted enemy's battleentity's position + (0.0 - the <code>size</code> of the targetted enemy, 0.0, -0.1) with a multiplier of 3.0</li> <li>All frames are yielded while <code>chompy</code> is in a <code>forcemove</code></li> <li><code>chompy</code>'s animstate is set to 100</li> <li>The <code>Chew</code> sound is played with a pitch of 1.5</li> <li>If the targetted enemy's position is indeed <code>Ground</code> (always happen unless no grounded enemies existed earlier):<ul> <li>DoCommand is called with a timer of 60.0, a commandtype of <code>PressKeyTimer</code> and a data being a one element array containing a random integer between 4 and 6 converted to float</li> <li>A frame is yielded</li> <li>All frames are yielded while <code>doingaction</code> is true</li> </ul> </li> <li>If the targetted enemy's position is indeed <code>Ground</code> (always happen unless no grounded enemies existed earlier) and <code>commandsuccess</code> is true:<ul> <li><code>chompy</code>'s animstate is set to 102</li> <li>The <code>Bite</code> sound is played with a pitch of 1.25</li> <li>DoDamage is called without attacker to the targetted enemy for a damage of 2 (or 3 if flags 404 is true and flagvar 56 is <code>ChomperRibbon</code> meaning that ribbon is currently on Chompy) without block. The property depends on the ribbon:<ul> <li><code>PoisonRibbon</code>: <code>Poison</code></li> <li><code>NumbRibbon</code>: <code>Numb</code></li> <li><code>SleepRibbon</code>: <code>Sleep</code></li> <li>Anything else: No properties</li> </ul> </li> <li>if flagvar 56 (the item id of the ribbon chompy has on her) is <code>RedRibbon</code> and <code>lastdamage</code> is above 0:<ul> <li>instance.<code>tp</code> is incremented then clamped from 0 to instance.<code>maxtp</code></li> <li>The <code>Heal2</code> sound is played</li> <li>ShowDamageCounter is called with type 2 (TP) with an ammount of 1 starting from <code>chompy</code>'s position + (-1.0, 1.0, 0.0) and ending at Vector3.up</li> </ul> </li> </ul> </li> <li>Otherwise (meaning no grounded enemies existed or the action command was failed):<ul> <li>0.1 seconds are yielded</li> <li>The <code>AtkFail</code> sound is played</li> <li><code>chompy</code>'s animstate is set to 103</li> </ul> </li> <li>0.4 seconds are yielded</li> <li>SetDefaultCamera is called</li> <li><code>chompy</code>'s <code>rigid</code> constraints are set to freeze everything except x/z position</li> <li>MoveTowards is called on <code>chompy</code> to move her to the position saved earlier with a multiplier of 2.0</li> <li>All frames are yielded while <code>chompy</code> is in a <code>forcemove</code></li> <li>StopForceMove is called on <code>chompy</code></li> <li><code>chompy</code>'s <code>rigid</code> gravity is enabled</li> <li><code>chompy</code>'s position is set to the one saved earlier</li> <li>A frame is yielded</li> <li><code>chompy</code>'s <code>flip</code> is set to true</li> <li><code>chompy</code>'s <code>overrideflip</code> is reset to false</li> <li><code>startdrop</code> is set to true (this allows enemies that requires dropping to finish their drops)</li> <li>A frame is yielded (this lets the drops finish)</li> <li><code>startdrop</code> is set back to false (since it's no longer needed)</li> <li><code>checkingdead</code> is set to a new CheckDead coroutine</li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> <li>If there's still any enemy party member with an <code>hp</code> above 0, <code>action</code> is set to false switching to a controlled flow (this means the flow isn't changed if all enemies are dead)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/#1-do-nothing","title":"1 (Do Nothing)","text":"<p>The only thing that happens is <code>action</code> is set to false switching to a controlled flow</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/#3-switch-ribbon","title":"3 (Switch ribbon)","text":"<ul> <li>The <code>Switch</code> sound is played</li> <li><code>chompy</code>'s <code>spin</code> is set to (0.0, -20.0, 0.0)</li> <li>0.33 seconds are yielded</li> <li>The selected ribbon's item id is removed from <code>items[1]</code> (key items)</li> <li>If flags 404 is false (Chompy doesn't have a ribbon on her), flags 404 is set to true. Otherwise, flagvar 56 (the item id of the ribbon chompy has on her) is added to <code>items[1]</code> (key items) if it didn't existed in the list already</li> <li>flagvar 56 (the item id of the ribbon chompy has on her) is set to the selected ribbon item id</li> <li>ChompyRibbon is called on <code>chompy</code> which changes its color depending on flagvar 56 (the item id of the ribbon chompy has on her):<ul> <li><code>PoisonRibbon</code>: Lerp between pure red and pure blue with a factor of 0.65 (this means purple with a bit more blue)</li> <li><code>NumbRibbon</code>: Lerp between pure yellow and pure black with a factor of 0.2 (mostly yellow) </li> <li><code>SleepRibbon</code>: Lerp between pure green and pure black with a factor of 0.3 (mostly green)</li> <li><code>RedRibbon</code>: Lerp between pure white and pure bluw with a factor of 0.5 (light blue)</li> <li>Any other item id: Lerp between pure red and pure white with a factor of 0.5 (light red)</li> </ul> </li> <li>0.1 seconds are yielded</li> <li><code>chompy</code>'s <code>spin</code> is zeroed out</li> <li><code>action</code> is set to false switching to a controlled flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Chompy/#end","title":"End","text":"<p>This section contains all the cleanup steps needed to end the action coroutine.</p> <ul> <li>A frame is yielded if there's at least one <code>extraenemies</code></li> <li>All frames are yielded while <code>checkingdead</code> is in progress, <code>summonnewenemy</code> is true or while any enemy party member's battleentity is in a <code>forcemove</code></li> <li>RefreshEnemyHP is called</li> <li><code>chompyaction</code> is reset to false</li> <li><code>chompyattacked</code> is set to true</li> <li><code>chompyattack</code> is set to null indicating the coroutine is done</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/","title":"DoAction","text":"<p>This action coroutine allows an actor to perform an action which is an hardcoded procedure in battle such as an attack, skill or special item usage. This coroutine contains the logic of all player and enemy actions making it the largest method in the game by far in terms of code volume. This has performance implications (see the section below for details).</p> <p>The vast majority of the logic of this coroutine are contained in the individual actions, but this page will focus on documenting the surrounding code as the actions will be documented somewhere else.</p> <pre><code>private IEnumerator DoAction(EntityControl entity, int actionid)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#parameters","title":"Parameters","text":"<ul> <li><code>entity</code>: The actor that will be performing the action</li> <li><code>actionid</code>: The meaning changes depending on the entity:<ul> <li>If it's a player party member, this is a number that tells what action entity will be performing (-2 is a <code>LonglegSummoner</code> item -1 is a basic attack, anything of 0 or above is a Skill id or item use)</li> <li>If it's an enemy party member, this is its <code>enemydata</code> index. Sending an invalid index is considered invalid and will result in an exception being thrown in the vast majority of cases</li> <li>If the value is -555, this is reserved to perform a blank dummy call, see the section below about performance for more details</li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#performance-implications","title":"Performance implications","text":"<p>This coroutine is extremely large in IL code size. This creates a problem because when calling it for the first time, it requires the JIT's full attention to compile it which can stutter the game. This performance penalty goes away once it has been called at least once throughout the entire game's session, but it is still very noticeable (it can be as long as a second or two).</p> <p>One mitigation the game does is to precipitate the stutter during the battle out loading transition of StartBattle. It does this by checking a boolean that belongs to MainManager and is only set to true when this happened for the first time since the last save load. To prevent any destructive logic to happen, StartBattle will send -555 as the actionid which can be seen as a blank dummy call: it will not perform any meaningful logic, but it will still be enough to force the JIT to compile the coroutine as it was explicitly called.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#procedure","title":"Procedure","text":"<p>Considering how large this method is, its lifecycle will be divided into different phases.</p> <p>NOTE: If this is a player action, the coroutine expects <code>availabletargets</code>, <code>target</code>, currentaction, itemarea and <code>currentturn</code> to be correctly set because they are needed to tell the coroutine the details of the action (notably, <code>currentturn</code> tells the <code>playerdata</code> index of the player party member performing the action). For a Skill, its cost is expected to be in flagvar 0 (TP if it's 0 or above, HP if it's negative using the absolute value).</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#setup","title":"Setup","text":"<p>This is the first phase of the coroutine. It ensures the coroutine can proceed and does some preparations logic.</p> <ul> <li><code>deadmembers</code> is set to the return of GetDeadParty which are all the player party members indexes whose <code>hp</code> is 0 or below</li> <li>If <code>cancelupdate</code> is true (which means we had entered into a terminal flow), a frame is yielded followed by the coroutine abruptly ending with a yield break. This can be considered a safeguard in case terminal flow was entered before a DoAction call occured</li> <li><code>overridechallengeblock</code> is set to false</li> <li>Any string invocation of UpdateAnim is cancelled. This can happen if AdvanceMainTurn invoked it, but a DoAction call processed before the incation occurs which can interfere because DoAction needs tighther control over calling UpdateAnim (and it calls it later as part of the setup anyway). Cancelling the invocation prevents this from happening</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li><code>action</code> is set to true switching to an uncontrolled flow</li> </ul> <p>What follows is a bunch of field value resets:</p> Field Value <code>infinitecommand</code> false <code>hasblocked</code> false <code>dontusecharge</code> false <code>nolifesteal</code> false <code>caninputcooldown</code> 0.0 <code>blockcooldown</code> 0.0 <code>combo</code> 1 <code>barfill</code> 0.0 <code>weakenemyfound</code> false <code>killinput</code> false <code>nonphyscal</code> false <code>commandsuccess</code> false <p>From there, a couple of local variables are initialised that may be used in the actions logic:</p> <ul> <li>flip: The <code>flip</code> value of the entity, used for restoring later in normal post action</li> <li>randomposafter: A boolean starting at false that when true by the normal post action, the <code>position</code> of the enemy party member will be determined randomly. This only applies to enemy party members and is only used by <code>Mushroom</code> and <code>BeeBot</code> under normal gameplay. NOTE: it is invalid to set this to true during a player action and if done, it will lead to illogical behaviors</li> <li>fled: A boolean starting at false that when true by the normal post action, it will change the majority of the normal post action logic to be very reduced. This is supposed to signal that the action lead to the enemy party member fleeing the battle. This only applies to enemy party members and is only used by <code>Burglar</code> and <code>GoldenSeedling</code> under normal gameplay. NOTE: it is invalid to set this to true during a player action and if done, it will lead to illogical behaviors</li> <li>nocharm: A boolean starting at false that when true by the normal post action, it will prevent any UseCharm calls to occur. This means no <code>HealTP</code> for the player party if it spent any to perform a skill and no <code>HealHP</code> after an enemy action. This is only used by <code>WaspHealer</code>, <code>LeafbugNinja</code> and <code>LeafbugArcher</code> under normal gameplay</li> <li>startp: The x/y starting position of the entity (the y component is left at 0.0). This can be overriden to another value in action logic and it is only used to move the actor back to it in normal post action</li> <li>startstate: The starting animstate of the entity. This can be overriden in action logic and is only used as the stopping state when moving the actor back to startp in normal post action</li> <li>usedtp: An integer starting at -1 that reports the cost of the skill used by the player party member if applicable. This is only used in normal post action to determine if a UseCharm call should occur with <code>HealTP</code> corresponding to half of the skill's cost. This has no effect on enemy party members</li> </ul> <p>After, the following is done:</p> <ul> <li>UpdateText is called</li> <li>UpdateAnim is called</li> <li>LockRigid(false) is called on the entity to unlock its <code>rigid</code></li> </ul> <p>From there, the next phase depends on the entity itself. It can either be a player action or an enemy action:</p> <ul> <li>If the entity has a <code>Player</code> tag, it's a player action</li> <li>Otherwise, this is an enemy action, but there is a special case in which it will not be performed and the coroutine will skip to the post action phase if all of the following are true:<ul> <li>firststrike is true</li> <li>The <code>DoublePain</code> medal is not equipped</li> <li>flags 614 is false (HARDEST is inactive)</li> <li><code>actionid</code> is not 0 (this isn't the first enemy party member)</li> </ul> </li> </ul> <p>Effectively, it always allow the first <code>enemydata</code> to take their action during a <code>firststrike</code>, but other enemy party members requires to be on hardmode or HARDEST to act in a <code>firststrike</code>. Check the firststrike documentation to learn more.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#player-action","title":"Player action","text":"<p>This phase applies only if the entity has a <code>Player</code> tag.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#player-action-setup","title":"Player action setup","text":"<p>The setup first begins by initialising a local variable called targetentity which is the actor data of the action's target (if it exists). This is primarily used for an itemarea of <code>SingleAlly</code> or <code>SingleEnemy</code> targetting action, but it is technically initialised for multi targetting, just not very useful. Only some action uses this variable and it may not get a valid actor if it is not needed, but it must be set correctly if it is. Here's the logic for determining the value:</p> <ul> <li>If actionid is -555 (blank dummy call), the value is left at the BattleData's default</li> <li>Otherwise, if currentaction is <code>ItemList</code> (this is an item use action), then it depends on itemarea (if none match, the variable is left at the BattleData's default):<ul> <li><code>SingleAlly</code>: The <code>target</code> player party member</li> <li><code>SingleEnemy</code>: GetAvaliableTargets is called without onlyground and onlyfront with excludeunderground using actionid as the attack id followed by setting the variable to <code>avaliabletargets[target]</code>. NOTE: In practice, the GetAvaliableTargets shouldn't change anything under normal gameplay because it was called with similar parameters (attackid was -1, but it doesn't change anything) during SetItem</li> </ul> </li> <li>Otherwise, if <code>target</code> is less than the length of <code>avaliabletargets</code> (it's a valid target), the variable is set to <code>avaliabletargets[target]</code></li> <li>Otherwise, it's left at BattleData's default</li> </ul> <p>After, if actionid isn't negative (meaning this isn't a basic attack action or player first strike) and currentaction isn't <code>ItemList</code> (meaning this must be a skill), the cost of the skill is paid by doing the following:</p> <ul> <li>If the <code>HPFunnel</code> medal is equipped or flagvar 0 is negative (meaning it's an HP cost), the <code>hp</code> of the <code>currentturn</code> player party member is decreased by the absolute value of flagvar 0</li> <li>Otherwise, instance.<code>tp</code> is decreased by flagvar 0 (TP cost)</li> </ul> <p>If a cost was paid, usedtp is set to the value of flagvar 0 (the TP or HP cost).</p> <p>After, if actionid isn't -555 (not blank dummy call) and currentaction isn't <code>ItemList</code> (meaning it's not an item use so it's a basic attack or skill action), <code>checkingdead</code> is set to a new UseCharm call with the type being <code>AttackUp</code>.</p> <p>After, <code>targettedenemy</code> is set to the <code>enemydata</code> index of the targetted enemy using the following logic:</p> <ul> <li>If actionid is -555 (blank dummy call), it's 0</li> <li>Otherwise, if <code>target</code> is at least <code>avaliabletargets</code>'s length - 1 (this is wrong, but safe, see the note below) or currentaction is <code>ItemList</code> (this is an item use action), it's <code>target</code></li> <li>Otherwise, it's the battleentity.<code>battleid</code> of the return of GetEnemyFromAvaliable using <code>avaliabletargets[target]</code>. Basically, it means if <code>avaliabletargets[target]</code>'s battleentity still exists in <code>enemydata</code>, it will be its <code>battleid</code> (which is the same than the <code>enemydata</code> index) and if it doesn't, it will be 0</li> </ul> <p>NOTE: This logic is very broken, but in practice, it's only ever used in 2 actions: the <code>HeavyStrike</code> skill or <code>Beetle</code>'s basic attack. For those actions specifically, this logic happens to always be correct whether it is on accident or not. <code>targetedenemy</code> will be correct in these cases, but it should not be relied upon because its value isn't reliable and can easilly point to the wrong enemy party member.</p> <p>Finally, all frames are yielded while <code>checkingdead</code> is in progress (which would be the UseCharm call made earlier if it was).</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#player-action-procedure","title":"Player action procedure","text":"<p>The actionid directly tells what action will be performed by a switch on it. Unlike enemy actions, there is no loop so the action is performed once and then completes.</p> <p>For more information on the player actions logic, consult the main player actions documentation page.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#enemy-action","title":"Enemy action","text":"<p>This phase applies if the entity doesn't have a <code>Player</code> tag unless the enemy party member was denied their action during a firststrike.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#enemy-action-setup","title":"Enemy action setup","text":"<p>This part of the enemy action phase occurs before any action is performed:</p> <ul> <li><code>checkingdead</code> is set to a new UseCharm call with the type being <code>DefenseUp</code></li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> </ul> <p>The action can only occur if the enemy party member doesn't have a Flipped condition for 2 turns or more (the action is allowed if there's 1 turn left on it or the condition isn't present). If it doesn't occur, the coroutine skips to the post action phase.</p> <p>If the enemy party member has either the Flipped or Topple conditions for exactly 1 turn left, the following occurs:</p> <ul> <li>Both the Flipped and Topple conditions are removed via RemoveCondition on the enemy party member</li> <li>Jump is called on the enemy party member with a height of 10.0</li> <li>entity.<code>overrideanim</code> is set to false</li> <li>entity.<code>basestate</code> and entity.animstate is set to 0 (<code>Idle</code>)</li> <li>startstate is set to 0 (<code>Idle</code>)</li> <li>0.1 seconds are yielded</li> </ul> <p>After, a couple of local variables are initialised which are enemy actions specific:</p> <ul> <li>chance: A random integer between 0 and 100 exclusive (100 possible outcome)</li> <li>chances: A float array starting at null</li> <li>hardmode: A boolean that is true if any of the following is true (false if none are):<ul> <li>The <code>DoublePain</code> medal is equipped</li> <li>flags 614 is true (HARDEST is active)</li> <li>flags 166 is true (EX mode active on the B.O.S.S system)</li> </ul> </li> <li>pos: A vector starting at Vector3.zero</li> </ul> <p>After, if the enemy party member isdefending:</p> <ul> <li>The enemy party member's <code>isdefending</code> is set to false</li> <li>startstate is set to entity.<code>basestate</code></li> <li>entity.animstate is set to its <code>basestate</code></li> </ul> <p>Finally, all frames are yielded while entity is not <code>onground</code>.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#enemy-action-loop","title":"Enemy action loop","text":"<p>Enemy actions works differently than player action in the sense they are all executed inside an infinite loop. This gives the ability for an action to perform many iterations before completing.</p> <p>The action logic is determined by a giant switch on the enemy party member's <code>animid</code> which is its enemy id.</p> <p>For more information on the enemy actions implementation, consult the enemy actions page.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#post-action","title":"Post action","text":"<p>This phase occurs after any actions. It starts with logic that allways occur no matter the action:</p> <ul> <li>If <code>demomode</code> is true, the <code>helpbox</code> is destroyed if it existed</li> <li>If entity has the <code>Enemy</code> tag, actionid is overriden to its corresponding enemy party member index</li> <li>SetDefaultCamera is called</li> <li>UpdateAnim is called</li> </ul> <p>From there, what follows depends on if the actionid is -555 or not (whether this is a blank dummy call or not).</p> <p>If it is, the only logic that happens is <code>action</code> is set to false switching to a controlled flow followed by skipping to the cleanup phase.</p> <p>If it's not, the full post action logic occurs with 2 distinct branche:</p> <ul> <li>fled is false meaning the action didn't signaled that the enemy party member fled the battle</li> <li>fled is true meaning the action signaled that the enemy party member fled the battle</li> </ul> <p>In either cases, they both end by setting all enemy party members's <code>lockposition</code> to false once they are done.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#no-fled-enemy-post-action","title":"No fled enemy post action","text":"<ul> <li>entity.<code>overrideanimspeed</code> is set to false</li> <li>entity.<code>spin</code> is zeroed out</li> <li><code>playertargetID</code> is reset to -1</li> <li><code>killinput</code> is set to true</li> <li>FlipAngle is called on the entity</li> <li>entity.<code>overrideanim</code> is reset to false</li> <li>entity.<code>overrideflip</code> is set to true</li> <li>entity.<code>rigid</code> gravity is enabled</li> <li>0.15 seconds are yielded</li> <li>If the distance with the entity's position and startp is greater than 0.35, PlayMoveSound is called with the entity which plays its corresponding move sound if one exists for its animid using the audio source 9</li> <li>MoveTowards is called on the entity to move towards startp with a multiplier of 2.0 using its <code>walkstate</code> as the state and startstate as the stopstate</li> <li>All frames are yielded while the entity is in a <code>forcemove</code></li> <li>The audio source 9 has its sound stopped if applicable (this is the move sound played earlier if one existed)</li> <li>A frame is yielded</li> <li>entity's position is set to startp</li> <li>entity.<code>flip</code> is reset to flip</li> <li>entity.<code>overrideflip</code> is reset to false</li> <li>0.15 seconds are yielded</li> <li>If randomposafter is true, an attempt with be made to change the enemy party member's position by generating a 50/50 random position between <code>Ground</code> and <code>Flying</code>. If the position changed from its previous one, the following is performed (in either cases, entity.<code>oldid</code> is reset to -1 after):<ul> <li>If the new enemy party member's position is <code>Ground</code>:<ul> <li>As long as entity.<code>height</code> is higher than entity.<code>minheight</code>, the <code>Fall</code> AnimationClip is played on entity.<code>anim</code> followed by entity.<code>height</code> being decreased by 0.075 of the game's frametime followed by a frame yield</li> <li>entity.<code>onground</code> is set to true</li> <li>entity.<code>height</code> is set to entity.<code>minheight</code></li> <li>entity.animstate is set to its <code>basestate</code></li> <li>A frame is yielded</li> <li>If the entity.<code>originalid</code> isn't the <code>BeeBot</code> animids, entity.<code>basestate</code> in enum string format is played on entity.<code>anim</code> (this implies entity.<code>basestate</code> must be a predefind animation)</li> </ul> </li> <li>Otherwise (the new position is <code>Flying</code>):<ul> <li><code>Idlef</code> is played on entity.<code>anim</code></li> <li>All frames are yielded while entity.<code>height</code> is less than 1.9 (entity.<code>height</code> is increased by 0.075 of the game's frametime each time before the frame yield)</li> <li>entity.<code>bobrange</code> is reset to entity.<code>startbf</code></li> <li>entity.<code>bobspeed</code> is reset to entity.<code>startbs</code></li> <li>entity.<code>height</code> is set to 2.0</li> </ul> </li> <li>UpdateAnimSpecific is called on the entity</li> </ul> </li> <li>If the entity has the <code>Player</code> tag (this is a player party member):<ul> <li>If usedtp is above 0, nocharm is false and currentaction isn't <code>ItemList</code> (meaning a skill was used that had a paid cost to it while healing charms aren't disallowed):<ul> <li>flagvar 1 is set to usedtp / 2 clamped from 1 to usedtp (the integer division floors implicitly)</li> <li><code>checkingdead</code> is set to a new UseCharm call with the type being <code>HealTP</code> which heals for the amoutn set to flagvar 1 just before</li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> </ul> </li> <li><code>playerdata[currentturn]</code>'s <code>tired</code> is incremented if currentaction isn't <code>ItemList</code> and actionid is not among the following (these are all the team moves, the reason they are exempted from exhaustion is because their individual action logic already took care of incremented the proper <code>tired</code> fields so this would have been a second, unwanted increment):<ul> <li>5 (<code>BeeFly</code>)</li> <li>26 (<code>IceBeemerang</code>)</li> <li>27 (<code>IceDrill</code>)</li> <li>31 (<code>IceSphere</code>)</li> </ul> </li> <li><code>playerdata[currentturn]</code>'s <code>tired</code> is incremented again if <code>turns</code> is 0 (meaning this is the first turn of the battle) while the <code>StrongStart</code> medal is equipped</li> <li>Unless <code>dontusecharge</code> is true, <code>playerdata[currentturn]</code>'s <code>charge</code> is reset to 0</li> <li>EndPlayerTurn is called</li> <li>currentaction is set to <code>BaseAction</code></li> <li><code>option</code> is set to <code>lastoption</code> (this restores the main vine menu's selection to whichever was the last one selected)</li> <li>If GetFreePlayerAmmount returns at least 1, UpdateText is called</li> </ul> </li> <li>Otherwise, if <code>selfsacrifice</code> is false (the enemy party member didn't killed themselves during their action):<ul> <li>If the enemy party member had any <code>delayedcondition</code>:<ul> <li>All <code>delayedcondition</code> are processed. See the delayed condition documentation to learn more</li> <li>If any <code>delayedcondition</code>'s processing caused a condition to be inflicted, the enemy party member's <code>cantmove</code> is set to 0 (EndEnemyTurn will later advance it making it 1 which means one actor turn needs to pass before an action is available)</li> <li>If the enemy party member's position is <code>Flying</code> while its cantfall is false, entity.<code>droproutine</code> is set to a new Drop coroutine on the entity</li> <li>0.5 seconds are yielded</li> <li>The enemy party member's <code>delayedcondition</code> is set to null</li> </ul> </li> <li>If nocharm is false (healing charms weren't disallowed):<ul> <li><code>checkingdead</code> is set to a new UseCharm call with the type being <code>HealHP</code></li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> </ul> </li> <li>If the enemy party member was performaning a hitaction, <code>enemy</code> is set to false, giving control back to the player party</li> <li>EndEnemyTurn is called with the actionid</li> </ul> </li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>If this isn't a firststrike:<ul> <li>A CheckDead is done without storing the coroutine</li> </ul> </li> <li>Otherwise, <code>action</code> is set to false switching to a controlled flow</li> <li>If this isn't a firststrike and any enemy party member has their battleentity.<code>droproutine</code> in progress:<ul> <li><code>action</code> is set to true switching to an uncontrolled flow</li> <li><code>startdrop</code> is set to true which allows any existing enemy party members to fall during their <code>droproutine</code></li> <li>All frames are yielded while an enemy party member still has its battleentity.<code>droproutine</code> in progress (it also constantly set <code>startdrop</code> to true to make sure they can drop)</li> <li><code>startdrop</code> is reset to false</li> <li><code>action</code> is reset to false switching back to a controlled flow</li> </ul> </li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#fled-enemy-post-action","title":"Fled enemy post action","text":"<ul> <li>EndEnemyTurn is called witht the actionid</li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>A CheckDead is performed, but the coroutine isn't stored anywhere.</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/DoAction/#cleanup","title":"Cleanup","text":"<p>This is the last phase of the coroutine:</p> <ul> <li><code>selfsacrifice</code> is reset to false</li> <li>A frame is yielded</li> <li><code>lastkill</code> is reset to -1</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Relay/","title":"Relay","text":"<p>This is an action coroutine that invokes the relay mechanic which allows a player party member to donate their actor turn to another. It also handles the animations and the <code>RelayTransfer</code> medal effects when applicable.</p> <p>The coroutine excepts to have the player party member whose index is <code>currentturn</code> to relay to the one whose index is <code>option</code>.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Relay/#setup","title":"Setup","text":"<ul> <li><code>action</code> is set to true changing to an uncontrolled flow</li> <li>UpdateText</li> <li>A frame is yielded</li> <li>The <code>Relay</code> sound is played</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Relay/#relay-animation","title":"Relay animation","text":"<ul> <li>Both the <code>currentturn</code> and <code>option</code>'s matching player party member's battleentity.animstate are set to 4 (<code>ItemGet</code>) and their battleentity.<code>spin</code> to (0.0, -20.0, 0.0)</li> <li>0.3 seconds are yielded</li> <li>During the course of 10.0 frames (tracked by a local counter advancing by 1/10 of the game's frametime starting at 0.0 reaching 1.0), both the <code>currentturn</code> and <code>option</code>'s matching player party member's battleentity.<code>spin</code> are lerped from (0.0, -20.0, 0.0) to Vector3.zero linearly over the course of those 10.0 frames</li> <li>Both the <code>currentturn</code> and <code>option</code>'s matching player party member's battleentity.animstate are set to 0 (<code>Idle</code>) and their battleentity.<code>spin</code> are zeroed out</li> <li><code>receivedrelay[option]</code> is set to true (this allows the <code>tiredpart</code> to be rendered on the player party member whenever their <code>tired</code> goes above 0 during UpdateAnim)</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Relay/#the-actual-relay","title":"The actual relay","text":"<ul> <li>The <code>currentturn</code>'s player party member's <code>haspassed</code> is set to true (indicating it already relayed disallowing to relay again)</li> <li>The <code>option</code>'s player party member's <code>cantmove</code> is decremented (this adds advances the actor turn, but it needs to be at 0 or above for an action to be possible still)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Relay/#relaytransfer-medal-effects","title":"<code>RelayTransfer</code> medal effects","text":"<p>If that medal is equipped on the <code>currentturn</code>'s player party member's <code>trueid</code>, the effects will be performed (this section is skipped if it's not equipped):</p> <p>Essentially, how it works is the <code>currentturn</code>'s player party member's condition are checked and all of the ones that aren't in the following list will be removed (by reseting the <code>condition</code> field to a new array without the ones to remove):</p> <ul> <li>Topple</li> <li>Flipped</li> <li>Shield</li> <li>Eaten</li> <li>EventStop</li> <li>Reflection</li> </ul> <p>The conditions removed will be added to the <code>option</code>'s player party member via SetCondition using the same <code>BattleCondition</code> and actor turn counter. This does imply they can amend existing conditions.</p> <p>If at least one condition is transfered, the <code>Charge10</code> sound will play when the first condition is transfered so it plays only once.</p> <p>It also transferts <code>charge</code>: the <code>currentturn</code>'s player party member's <code>charge</code> is set to the existing one + the <code>option</code>'s clamped from 0 to 3 while the <code>option</code>'s player party member's <code>charge</code> gets set to 0.</p> <p>The logic ends by calling UpdateAnim followed by UpdateConditionIcons being called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true).</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Relay/#finalising-the-relay","title":"Finalising the relay","text":"<ul> <li>EndPlayerTurn is called which advances the actor turn</li> <li>CancelList is called</li> <li>A frame is yielded</li> <li><code>action</code> is set to false changing to a controlled flow</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/SwitchParty/","title":"SwitchParty","text":"<p>This action coroutine alloews to rotate the party once. It is possible to do it without a fancy visual animation.</p> <pre><code>private IEnumerator SwitchParty(bool fast)\n</code></pre> <p>NOTE: The process of switching is complex and involves battle <code>playerdata</code> addressing documentation. It is recommended to check this documentation to fully understand how a party rotation works.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/SwitchParty/#parameters","title":"Parameters","text":"<ul> <li><code>fast</code>: Whether to include vidual animations and waiting.</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/SwitchParty/#procedure","title":"Procedure","text":"<ul> <li><code>action</code> is set to true changing to an uncontrolled flow</li> <li><code>currentturn</code> is set to -1 which unselects the current player party member</li> <li>SetLastTurns is called which resets <code>lastturns</code> to a new aray with the length being the amount of free players - 1 and all elements being -1 (this resets the player selection cycle)</li> <li>If fast is false<ul> <li>All player party members has their battleentity.<code>spin</code> set to (0.0, -20.0, 0.0)</li> <li>0.33 seconds are yielded</li> </ul> </li> <li>MainManager.SwitchParty is called with the battle version which rotates the <code>partypointer</code> elements</li> <li>0.1 seconds are yielded</li> <li>For each player party members, the second part of the rotation is performed:<ul> <li>battleentity.<code>overridejump</code> is set to true</li> <li>battleentity.<code>spin</code> is zeroed out</li> <li><code>pointer</code> is set to the matching <code>partypointer</code>. This gives a way to do the same function than <code>partypointer</code>, but using <code>playerdata</code> indexes. In practice, this feature is UNUSED because the field is only written to</li> <li><code>playerdata[partypointer[j]]</code>.battleentity position is set to the matching <code>partypos</code>. This can be thought as the player party member who had this formation position in the player party is moved to be physically at the matching position of that formation position</li> <li>If battleentity.<code>deathcoroutine</code> is in progress, it is stopped and set to null followed by battleentity.animstate being set to 18 (<code>KO</code>)</li> </ul> </li> <li>0.7 seconds are yielded if fast is false</li> <li>CancelList is called</li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>A frame is yielded</li> <li><code>action</code> is set to false changing to a controlled flow</li> <li>A frame is yielded (this frame will process in a controlled flow, but the rest is just visual updates so it's safe)</li> <li>UpdateAnim is called</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/SwitchPos/","title":"SwitchPos","text":"<p>This action coroutine alloews to swap 2 player party member's position with each other.</p> <pre><code>private IEnumerator SwitchPos(int called, int targeted)\n</code></pre> <p>NOTE: The process of switching is complex and involves battle <code>playerdata</code> addressing documentation. It is recommended to check this documentation to fully understand how a party swap works.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/SwitchPos/#parameters","title":"Parameters","text":"<ul> <li><code>called</code>: The <code>playerdats</code> index that is requesting the swap</li> <li><code>targeted</code>: The <code>playerdata</code> index that was targetted for swapping by the <code>called</code>'s player party member's action</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/SwitchPos/#procedure","title":"Procedure","text":"<ul> <li>The <code>Switch</code> sound is played</li> <li><code>action</code> is set to true changing to an uncontrolled flow</li> <li><code>currentturn</code> is set to -1 which unselects the current player party member</li> <li>SetLastTurns is called which resets <code>lastturns</code> to a new aray with the length being the amount of free players - 1 and all elements being -1 (this resets the player selection cycle)</li> <li>The called and targeted player party members has their battleentity.<code>spin</code> set to (0.0, -20.0, 0.0)</li> <li>0.33 seconds are yielded</li> <li>The <code>partypointer</code> indexes that maps to the called and targeted <code>playerdata</code> indexes are found and their value are set to called and targeted respectively (essentially, this converts called and targeted from <code>playerdata</code> indexes to <code>partypointer</code> indexes)</li> <li>Both <code>partypointer</code> elements whose indexes matches the ones found are swapped. This essentially completes the first party of the swap</li> <li>0.1 seconds are yielded</li> <li>For each player party members, the second part of the swap is performed:<ul> <li>battleentity.<code>overridejump</code> is set to true</li> <li>battleentity.<code>spin</code> is zeroed out</li> <li><code>pointer</code> is set to the matching <code>partypointer</code>. This gives a way to do the same function than <code>partypointer</code>, but using <code>playerdata</code> indexes. In practice, this feature is UNUSED because the field is only written to</li> <li><code>playerdata[partypointer[j]]</code>.battleentity position is set to the matching <code>partypos</code>. This can be thought as the player party member who had this formation position in the player party is moved to be physically at the matching position of that formation position</li> <li>If battleentity.<code>deathcoroutine</code> is in progress, it is stopped and set to null followed by battleentity.animstate being set to 18 (<code>KO</code>)</li> </ul> </li> <li>CancelList is called</li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>A frame is yielded</li> <li><code>action</code> is set to false changing to a controlled flow</li> <li>A frame is yielded (this frame will process in a controlled flow, but the rest is just visual updates so it's safe)</li> <li>UpdateAnim is called</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Tattle/","title":"Tattle","text":"<p>This action coroutine allows a player party member to spy an enemy party member if they pass an action command. The spy will only proceeed if <code>disablespy</code> is false, otherwise, the logic is limited to play the buzzer sound and calling UpdateAnim.</p> <p>The coroutine expects <code>playerdata[currentturn]</code> to be the player party member that attemps the spying and for <code>avaliabletargets[option]</code> to be the enemy party member being spied.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Tattle/#action-command-setup","title":"Action command setup","text":"<ul> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li><code>action</code> is set to true changing to an uncontrolled flow</li> <li><code>caninputcooldown</code> is set to 0.0</li> <li><code>blockcooldown</code> is set to 0.0</li> <li><code>combo</code> is set to 0</li> <li><code>killinput</code> is set to false</li> <li><code>nonphyscal</code> is set to false</li> <li><code>commandsuccess</code> is set to false</li> <li>UpdateText is called</li> </ul> <p>From there, if the <code>HPScope</code> medal is equipped, this will bypass the action command portion and the logic will be limited to playing the <code>AtkSuccess</code> sound and everything will continue as if <code>commandsuccess</code> was true.</p> <p>Otherwise, the action command is done by calling DoCommand with the timer being 60.0, the type being <code>Crosshais</code> and the data being {3.0, the battleentity.<code>battleid</code> of the target enemy party member converted to float, 3.25, 10.0}. From there, all frames are yielded while <code>doingaction</code> is true.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Tattle/#spying-process","title":"Spying process","text":"<p>This section only happens if the <code>HPScope</code> medal was equipped or <code>commandsuccess</code> is true meaning the player passed the action command. If these conditions are fufilled, the logic of this section is limited to setting the player party member's battleentity.animstate to 11 (<code>Hurt</code>).</p> <ul> <li>The <code>currentturn</code> player party member's battleentity.<code>spin</code> is set to (0.0, 20.0, 0.0)</li> <li>The <code>currentturn</code> player party member's battleentity.<code>animstate</code> is set to 4 (<code>ItemGet</code>)</li> <li>0.65 seconds are yielded</li> <li>The <code>currentturn</code> player party member's battleentity.<code>animstate</code> is set to 13 (<code>BattleIdle</code>)</li> <li>The <code>currentturn</code> player party member's battleentity.<code>spin</code> is zeroed out</li> <li>The SetText text advance's <code>skiptext</code> is set to false</li> <li>waitinput is set to false</li> <li>instance.<code>inputcooldown</code> is set to 15.0</li> <li>A frame is yielded</li> <li>SetText is called in dialogue mode with the text being <code>|</code>fwait<code>,0.075||</code>spd,<code>-1||</code>stopskip<code>|</code> followed by the correspondong tattle line from the <code>currenturn</code> player party member's <code>trueid</code> from enemytattle data using the enemy party member's <code>animid</code> as the enemy id. The call also has these properties:<ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>linebreak of <code>messagebreak</code></li> <li>No tridimensional</li> <li>position of Vector3.zero</li> <li>No cameraoffset</li> <li>size of Vector3.one</li> <li>parent being <code>currentturn</code>'s player party member's battleentity</li> <li>No caller</li> </ul> </li> <li>A frame is yielded</li> <li>A nameless pure white 9Box is created with position (20.0, 0.0, 10.0), size of (10.75, 5.0) type 4 (torn piece of paper), sortorder of -20 without grow and a DialogueAnim attached with a targetpos of (3.5, -1.75, 10.0) and a speed of (0.1) (this DialogueAnim makes the 9Box appear from offsreen to the right slightly down)</li> <li>A new UI object named <code>enemyimage</code> is created childed to the 9Box with local position (-2.85, 0.0, 0.0), size of (3.0, 3.0, 3.0) and a sortOrder of 0 using the sprite defined as the portrait from enemydata using the enemy party member's <code>animid</code> as the enemy id</li> <li>A string of text is prepared which are all the following appended together:<ul> <li><code>|</code>single<code>|</code></li> <li>If the languageid is <code>Japanese</code> and the enemy party member's <code>entityname</code> is 6 or more letters long, <code>|</code>size<code>,X,1|</code> is appended where <code>X</code> is 1.0 - 0.075 * (the enemy party member's <code>entityname</code>'s length - 5) all clamped from 0.5 to 0.65 (notthing is appended otherwise)</li> <li><code>|</code>line<code>||</code>halfline<code>||</code>size<code>,1,1,lock|</code></li> <li><code>menutext[14]</code> (HP)</li> <li><code>:</code></li> <li>The enemy party member's <code>maxhp</code>. If the <code>DoublePain</code> medal is equipped or flag 614 is true (HARDEST is active), it's the <code>maxhp</code> + <code>hardhp</code> instead</li> <li><code>|</code>line<code>|</code></li> <li><code>menutext[17]</code> (Defense)</li> <li><code>:</code></li> <li>The enemy party member's <code>def</code>. If the <code>DoublePain</code> medal is equipped or flag 614 is true (HARDEST is active), it's the <code>def</code> + <code>harddef</code> instead. There is an exception however: if that number is negative, <code>???</code> is appended instead of the number</li> <li><code>|</code>line<code>|</code></li> <li>If the languageid is <code>Japanese</code>, <code>|</code>size<code>,0.8,1,force|</code> is appended (nothing otherwise)</li> <li><code>menutext[137]</code> (Seen)</li> <li><code>:</code></li> <li>The seen counter of the matching bestiary entry of the enemy party member</li> <li><code>|</code>line<code>|</code></li> <li><code>menutext[138]</code> (Defeated)</li> <li><code>:</code></li> <li>The defeated counter of the matching bestiary entry of the enemy party member</li> </ul> </li> <li>SetText is called in non dialogue mode using the string assembled with the following properties:<ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>No linebreak</li> <li>No tridimensional</li> <li>position of (-0.65, 1.3. 0.0)</li> <li>No cameraoffset</li> <li>size of Vector3.one</li> <li>parent being the 9Box</li> <li>No caller</li> </ul> </li> <li>All frames are yielded while the message lock is grabbed</li> <li>The bestiary entry of the enemy is updated via UpdateJounal to unlock it in <code>librarystuff</code></li> <li>The 9Box's DialogueAnim's <code>targetpos</code> is set to (20.0, 0.0, 10.0) (this sets it to move offscreen to the right)</li> <li>The 9Box is destroyed in 1.0 second</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/Tattle/#cleanup","title":"Cleanup","text":"<ul> <li>0.5 seconds are yielded</li> <li>Unless the <code>HPScope</code> medal was equipped, EndPlayerTurn is called which advances the player party member's actor turn</li> <li>CancelList is called</li> <li>A frame is yielded</li> <li><code>action</code> is set to false changing to a controlled flow</li> <li>UpdateText is called</li> <li>UpdateAnim is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/TryFlee/","title":"TryFlee","text":"<p>This action coroutine allows the player to attempt to flee from the battle if an action command is passed. This allows to go directly to the ReturnToOverworld in a terminal flow if the action command is passed. If the action command is failed, all player party members gets all their action turns exhausted which leads to EndPlayerTurn earlier than usual.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/TryFlee/#command-preparation","title":"Command preparation","text":"<ul> <li><code>action</code> is set to true changing to a controlled flow</li> <li><code>commandsuccess</code> is reset to false</li> <li>instance.<code>showmoney</code> is set to 100000000.0 which effectively makes the berry count HUD element shown permanently for now</li> <li>The instance.<code>camtargetpos</code> is set to (-4.5, 0.0, 2.5) with an instance.<code>camspeed</code> of 0.075</li> <li>10 RigidBodies are initialised to hold lost berries (they each get a SpriteRenderer using the <code>MoneySmall</code>'s <code>itemsprites</code>) childed to the <code>battlemap</code> in kinematic mode, but initially placed offscreen at (0.0, 999.0, 0.0)</li> <li>The <code>FlipNoise</code> sound is played</li> <li>For each player party member that isn't IsStopped, the following adjustements happens on their battleentity (this setups their walk in place animations):<ul> <li><code>anim</code>.speed is set to 2.0</li> <li><code>overridejump</code> is set to true</li> <li>Jump is called</li> <li><code>flip</code> is set to false</li> <li><code>overrideanim</code> is set to true</li> <li>animstate is set to 1 (<code>Walk</code>)</li> </ul> </li> <li>0.4 seconds are yielded</li> <li>A DoCommand coroutine is started with a commandtype of <code>SequentialKeys</code> using 250.0 as the timer and the data being one element whose value is 6 unless the <code>SpeedUp</code> medal is equipped which makes the value 3 instead</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/TryFlee/#performing-the-action-command","title":"Performing the action command","text":"<p>This section is in effect as long as <code>doingaction</code> is true. It's where the berry loss happens periodically when applicable. A frame is yielded at the end of every cycle when this section is in effect.</p> <p>In order for a berry to be lost, the following must be true:</p> <ul> <li>instance.<code>money</code> must be above 0</li> <li>The <code>SecurePouch</code> medal is unequipped</li> <li>flags 162 is false (We aren't in a B.O.S.S or Cave of Trials session)</li> <li>A certain amount of frames has passed (tracked by a local framecounter using instance.<code>framestep</code> as the increment)</li> </ul> <p>The amount of frames that needs to pass to loose a berry depends on <code>estimatedexp</code>. It is calculated by taking (30 - <code>estimatedexp</code>) / 2, clamping it from 5 to instance.<code>neededexp</code> / 2 and finally, multiply the result by 2.0 which also casts it to a float for the counter comparison. What this intuitively mean is that the amount of frames before a berry is lost is always between 5 and 15, but the base amount decreases the more EXP has been accumulated so far. As for the upper clamping bound, it doesn't do anything because the minimum value of instance.<code>neededexp</code> is normally 100 making its half 50 which is higher than 15, the upper bound of the base value if <code>estimatedexp</code> is 0.</p> <p>All in all, this can be reduced to just (30 - <code>estimatedexp</code>) / 2 clamped from 5 making the overall result from 5 to 15 frames between loosing a berry.</p> <p>If no berry losses occurs, the local counter is incremented by instance.<code>framestep</code>.</p> <p>If a berry loss occurs, the following is done on one of the 10 RigidBodies initialised earlier (the index starts at 0 and increments each berry loss, resetting to 0 when reaching 10):</p> <ul> <li>position is set to a randomly selected player party member's battleentity's position</li> <li>kinematic mode is turned off</li> <li>velocity is set to RandomItemBounce(4.0, 15.0)</li> </ul> <p>The berry loss ends by decrementing instance.<code>money</code> and resetting the local frame counter to 0.0.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/TryFlee/#handling-the-action-command-result","title":"Handling the action command result","text":"<p>The rest of the coroutine depends on <code>commandsuccess</code> being true or not indicating the command was succeeded or failed. In either outcome, all RigidBodies initialised earlier are destroyed at the very end.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/TryFlee/#success","title":"Success","text":"<p>This section is applicable if <code>commandsuccess</code> is true:</p> <ul> <li>MainManager.<code>battleresult</code> is set to false</li> <li>For each player party member that isn't IsStopped, Jump is called on their battleentity</li> <li>0.45 seconds are yielded</li> <li>The <code>Flee</code> sound is played</li> <li>For each player party member that isn't IsStopped, the following happens on their battleentitty:<ul> <li>The y position is set to 0.0</li> <li>The <code>rigid</code>'s gravity is disabled</li> <li>MoveTowards is called to move to (-20.0, 0.0, 0.0) with a multiplier of 5.0</li> </ul> </li> <li>All frames are yielded until the <code>forcemove</code> of the battleentity of the last player party member that isn't IsStopped goes to false (meaning the last player party member that was moved is done with its <code>forcemove</code>)</li> <li>flagvar 42 (number of fleed battles) is incremented</li> <li>ReturnToOverworld is called with flee</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/TryFlee/#fail","title":"Fail","text":"<p>This section is applicable if <code>commandsuccess</code> is false:</p> <ul> <li>The <code>Fail</code> sound is played</li> <li>For each player party member that isn't IsStopped, the following happens on their battleentitty (this undo what was done on the command preparations with some more animations):<ul> <li><code>anim</code>.speed is reset to 1.0</li> <li><code>overrideanimspeed</code> is set to false</li> <li>Jump is called</li> <li>animstate is set to 11 (<code>Hurt</code>)</li> </ul> </li> <li>0.1 seconds are yielded</li> <li>For each player party member that isn't IsStopped, the following happens on their battleentitty:<ul> <li>DeathSmoke is called with the battleentity</li> <li>animstate is set to 18 (<code>KO</code>)</li> <li>The <code>Drop</code> sound is played on the entity (not the battleentity)</li> </ul> </li> <li>If flags 162 is false (we aren't in a B.O.S.S or Cave of Trials session), all of the 10 RigidBodies will count as a berry loss meaning up to 10 berries are lost (or instance.<code>money</code> berries is lost if less than 10 remained). The following happens for each loss on the concerned RigidBody:<ul> <li>position is set to a randomly selected player party member's battleentity's position</li> <li>kinematic mode is turned off</li> <li>velocity is set to RandomItemBounce(4.0, 15.0)</li> <li>instance.<code>money</code> is decremented</li> <li>A frame is yielded</li> </ul> </li> <li>0.85 seconds are yielded</li> <li>SetDefaultCamera is called</li> <li>For each player party member that isn't IsStopped, the following happens on their battleentitty:<ul> <li><code>overridejump</code> is set to false</li> <li><code>overrideanim</code> is set to false</li> <li><code>flip</code> is set to true</li> <li>The player party member's <code>cantmove</code> is set to 1 except for the <code>currentturn</code> one where it's set to 0 (this is because its turn will be exhausted soon so all member's <code>cantmove</code> will end up at 1)</li> </ul> </li> <li>A frame is yielded</li> <li>UpdateAnim is called</li> <li>instance.<code>showmoney</code> is set to -1 which hides the berry count HUD</li> <li>EndPlayerTurn is called (which will increment the <code>currentturn</code> player party member so all members's <code>cantmove</code> ends up at 1)</li> <li><code>action</code> is set to false switching back to a controlled flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/","title":"UseItem","text":"<p>This action coroutine allows the player party member to use an item. It receives its id in a parameter which should corresponds to the one that was selected during GetChoiceInput after passing the CheckItemUse check.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#setup","title":"Setup","text":"<ul> <li><code>action</code> is set to true switching to an uncontrolled flow</li> <li>UpdateText is called</li> <li>The <code>ItemHold</code> sounds is played</li> <li><code>lastitemuser</code> is set to the <code>trueid</code> of the <code>currentturn</code> player party member</li> <li>A new temporary item object is created with a SpriteRenderer using the corresponding item's sprite from items data using the standard spritemat with a renderQueue of 50000 on layer 14 (<code>Sprite</code>). The object is positioned at the <code>currentturn</code> player party member's battleentity's position + its <code>cursoroffset</code> - (0.0, 0.0, 0.1)</li> <li>The <code>currentturn</code> player party member's battleentity.animstate is set to 4 (<code>ItemGet</code>)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#banditleader-specific-logic","title":"<code>BanditLeader</code> specific logic","text":"<p>This coroutine has special logic if a <code>BanditLeader</code> enemy is present in the enemy party. When that happens, this coroutine will not apply any item effects and it will instead end abruptly with a yield break after some animations and cleanup logic. This logic is what this section is about. It doesn't apply if no <code>BanditLeader</code> is present.</p> <p>If it does apply, the enemy party member index of the first <code>BanditLeader</code> is saved locally and used for this section.</p> <ul> <li>0.25 seconds are yielded</li> <li>The <code>BanditLeader</code>'s battleentity.animstate is saved locally for restore later</li> <li>HealConditions is called on the <code>BanditLeader</code></li> <li>UpdateAnim is called</li> <li>The <code>BanditLeader</code>'s battleentity.animstate is set to 103</li> <li>The <code>Slash2</code> sound is played</li> <li>0.5 seconds are yielded</li> <li>Gleam is called on the <code>BanditLeader</code>'s battleentity using the offset (-0.4, 2.35, -0.1) which plays the <code>Gleam</code> particles and sound</li> <li>0.5 seconds are yielded</li> <li>The <code>Slash</code> sound is played</li> <li>The <code>BanditLeader</code>'s battleentity.animstate is set to 107</li> <li>MainManager.FadeIn is called with a speed of 1.0 (which makes the screen go to black instantly)</li> <li>0.25 seconds are yielded</li> <li>ItemDrop is called on the temporary item object which will do the following:<ul> <li>The object gets rooted to the scene</li> <li>A RigidBody component is added with a velocity of RandomItemBounce(5.0, 12.5)</li> <li>The object is destroyed in 1.0 second</li> </ul> </li> <li>The <code>currentturn</code>'s battleentity.animstate is set to 11 (<code>Hurt</code>)</li> <li>MainManager.FadeOut is called with a speed of 1.0 (which makes the screen go back to what it was before the fade in instantly)</li> <li>The <code>ItemStolen</code> sound is played</li> <li>0.65 seconds are yielded</li> <li>The <code>BanditLeader</code>'s battleentity.animstate is restrored to the saved value</li> <li>The first occurence of the item corresponding to the sent id is removed from instance.<code>items[0]</code> (standard items)</li> <li>CancelList is called</li> <li>UpdateAnim is called</li> <li>UpdateText is called</li> <li>EndPlayerTurn is called</li> <li><code>action</code> is set to false switching to a controlled flow</li> <li>Yield break which ends this coroutine</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#pre-item-effects","title":"Pre item effects","text":"<p>This section happens if the <code>BanditLeader</code> specific logic didn't apply.</p> <ul> <li>1.3 seconds are yielded</li> <li>The temporary item object is destroyed</li> <li><code>deadmembers</code> is set to GetDeadParty which is all player party member indexes whose <code>hp</code> is 0 or below in ascending order</li> <li>The <code>currentturn</code> player party member's battleentity.animstate is set to 13 (<code>BattleIdle</code>)</li> <li>UpdateAnim is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#item-effects","title":"Item effects","text":"<p>This section depends on the itemarea.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#singleally-or-allparty","title":"<code>SingleAlly</code> or <code>AllParty</code>","text":"<p>This first starts by having all frames yielded while PartyIsDying which means that at least one player party member's <code>hp</code> is 0 or below while its battleentity.<code>deathroutine</code> is still in progress.</p> <p>From there, the ItemUse elements of the item are processed by first calling DoItemEffect with the element's information and <code>option</code> as the characterid.</p> <p>After, there's additional logic depending on the ItemUsage.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#hprecover-or-hprecoverfull","title":"<code>HPRecover</code> or <code>HPRecoverFull</code>","text":"<ul> <li>HealParticle is called on the <code>option</code> player party member with a size of Vector3.one and an offset of Vector3.up</li> <li>ShowDamageCounter is called with type 1 (HP) with the ammount being the return of DoItemEffect starting at the <code>playerdata[option].battleentity</code>'s position + <code>playerdata[option].cursoroffset</code> and ending at Vector3.up</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#revive","title":"<code>Revive</code>","text":"<p>The same than <code>HPRecover</code> or <code>HPRecoverFull</code>, but if the <code>option</code> player party member's battleentity is <code>dead</code>, RevivePlayer is called with its id for -1 hp and showcounter as false.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#tprecover-or-tprecoverfull","title":"<code>TPRecover</code> or <code>TPRecoverFull</code>","text":"<ul> <li>ShowDamageCounter is called with type 2 (TP) with the ammount being the return of DoItemEffect starting at the <code>playerdata[option].battleentity</code>'s position + <code>playerdata[option].cursoroffset</code> and ending at Vector3.up</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#hprecoverall","title":"<code>HPRecoverAll</code>","text":"<p>This effect applies to each player party member that isn't <code>eatenby</code> and has an <code>hp</code> above 0:</p> <ul> <li>HealParticle is called on the player party member with a size of Vector3.one and an offset of Vector3.up</li> <li>ShowDamageCounter is called with type 1 (HP) with the ammount being the return of DoItemEffect starting at the <code>playerdata[option].battleentity</code>'s position + <code>playerdata[option].cursoroffset</code> and ending at Vector3.up</li> </ul> <p>If at least one player party member was affected and there's more than 1 effect, 0.5 seconds are yielded before processing more.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#reviveall","title":"<code>ReviveAll</code>","text":"<p>The same than <code>HPRecoverAll</code>, but it also affects player party members with an <code>hp</code> of 0 or below and if its battleentity is <code>dead</code>, RevivePlayer is called with its id for -1 hp and showcounter as false.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#hpordamage","title":"<code>HPorDamage</code>","text":"<ul> <li>An RNG check is performed with 2 possible outcomes at 66% and 34% respectively:<ul> <li>66%: Heal is called on the <code>option</code> player party member with the ammount being the returned value of DoItemEffect</li> <li>34%: DoDamage is called without an attacker to the <code>option</code> player party member with the damageammount being the returned value of DoItemEffect with a <code>NoExceptions</code> property and without block</li> </ul> </li> <li>The <code>hp</code> of the <code>option</code> player party member is clamped from 1 to its <code>maxhp</code></li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#battle","title":"<code>Battle</code>","text":"<p>An action may be set to trigger in the post item effect section depending on the item id:</p> <ul> <li><code>VitalitySeed</code>: 14</li> <li><code>GenerousSeed</code>: 15</li> <li><code>ShellOil</code>: 33</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#addpoison","title":"<code>AddPoison</code>","text":"<p>The <code>PoisonEffect</code> particle are played without sound at the <code>option</code> player party member's battleentity's position.</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#addnumb","title":"<code>AddNumb</code>","text":"<p>The <code>ElecFast</code> particle are played without sound at the <code>option</code> player party member's battleentity's position + Vector3.up all scaled by (1.5, 1.5, 1.5).</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#addfreeze","title":"<code>AddFreeze</code>","text":"<ul> <li>The <code>mothicenormal</code> particle are played without sound at the <code>option</code> player party member's battleentity's position + Vector3.up all scaled by (1.5, 1.5, 1.5)</li> <li>If the <code>option</code> player party member has a Freeze ondition and its battleentity.<code>icecube</code> is null or inactive, Freeze is called on the battleentity</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#addsleep","title":"<code>AddSleep</code>","text":"<p>DeathSmoke particles are played at the <code>option</code> player party member's battleentity's position</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#turnnextturn","title":"<code>TurnNextTurn</code>","text":"<ul> <li>StatEffect is called with the <code>option</code> player party member's battleentity with type 5 (orange up arrow)</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#curenumb","title":"<code>CureNumb</code>","text":"<ul> <li>The <code>option</code> player party member's <code>isnumb</code> is set to false</li> <li>The <code>CurePoison</code> effects applies</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#curefreeze","title":"<code>CureFreeze</code>","text":"<ul> <li>BreakIce is called on the <code>option</code> player party member's battleentity</li> <li>The <code>CurePoison</code> effects applies</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#curesleep","title":"<code>CureSleep</code>","text":"<ul> <li>The <code>option</code> player party member's <code>isasleep</code> is set to false</li> <li>The <code>CurePoison</code> effects applies</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#cureparty","title":"<code>CureParty</code>","text":"<ul> <li>For each player party members that isn't <code>eatenby</code> and has an <code>hp</code> above 0:<ul> <li><code>isnumb</code> is set to false</li> <li>BreakIce is called on the battleentity</li> <li><code>isasleep</code> is set to false</li> </ul> </li> <li>The <code>CurePoisonAll</code> effects applies</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#curepoison-gradualhp-gradualtp-curefire-or-cureall","title":"<code>CurePoison</code>, <code>GradualHP</code>, <code>GradualTP</code>, <code>CureFire</code> or <code>CureAll</code>","text":"<ul> <li>The <code>MagicUp</code> particle are played without sound at the <code>option</code> player party member's battleentity's position</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#curepoisonall","title":"<code>CurePoisonAll</code>","text":"<ul> <li>The <code>MagicUp</code> particle are played without sound at each of the player party members's battleentity's position who isn't <code>eatenby</code> and whose <code>hp</code> is above 0</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#chargeup","title":"<code>ChargeUp</code>","text":"<ul> <li>The <code>StatUp</code> sound is played</li> <li>StatEffect is called with the <code>option</code> player party member's battleentity with type 4 (green up arrow)</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#gradualhpparty","title":"<code>GradualHPParty</code>","text":"<p>The <code>MagicUp</code> particle are played without sound at each of the player party members's battleentity's position who isn't <code>eatenby</code> and whose <code>hp</code> is above 0</p>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#hpto1","title":"<code>HPto1</code>","text":"<ul> <li>ShowDamageCounter is called with type 0 (Damage) with the ammount being the <code>option</code> player party member's <code>maxhp</code> - 1 starting at its battleentity's position and ending at (-1, 2.0, 0.0)</li> <li>DoDamageAnim is called with the <code>option</code> player party member with a damage of its <code>maxhp</code> - 1 without block</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#atkupstat","title":"<code>AtkUpStat</code>","text":"<ul> <li>StatusEffect is called with the <code>option</code> player party member using the AttackUp condition with the amount of turns being the returned value from DoItemEffect with effect being true</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#defupstat","title":"<code>DefUpStat</code>","text":"<ul> <li>StatusEffect is called with the <code>option</code> player party member using the DefenseUp condition with the amount of turns being the returned value from DoItemEffect with effect being true</li> <li>If there's more than 1 effect, 0.5 seconds are yielded before processing more</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#sturdy","title":"<code>Sturdy</code>","text":"<ul> <li>flagvar 0 is set to the returned value from DoItemEffect</li> <li>The action id 33 is set to trigger in the post item effects section</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#singleenemy-allenemies-or-all","title":"<code>SingleEnemy</code>, <code>AllEnemies</code> or <code>All</code>","text":"<p>An action will may be set to trigger in the post item effects section depending on the item id:</p> <ul> <li><code>LonglegSummoner</code>: The -2 action id will be set to trigger</li> <li>If the item id is in the following list, the 9 action id will be set to trigger:<ul> <li><code>HardSeed</code></li> <li><code>SpicyBomb</code></li> <li><code>PoisonBomb</code></li> <li><code>ClearBomb</code></li> <li><code>NumbDart</code></li> <li><code>Ice</code></li> <li><code>FrostBomb</code></li> <li><code>NumbBomb</code></li> <li><code>SleepBomb</code></li> <li><code>Abombhoney</code></li> <li><code>PoisonDart</code></li> <li><code>CherryBomb</code></li> <li><code>BurlyBomb</code></li> <li><code>FlameRock</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Action%20coroutines/UseItem/#post-item-effects","title":"Post item effects","text":"<ul> <li>The first occurence of the item corresponding to the sent id is removed from instance.<code>items[0]</code> (standard items)</li> <li>CancelList is called</li> <li>UpdateAnim is called</li> <li>UpdateText is called</li> <li>If an action was set to trigger after the item use:<ul> <li>currentaction is set to <code>ItemList</code></li> <li>DoAction is called with the <code>currentturn</code> party member using the action id set to trigger earlier</li> </ul> </li> <li>Otherwise:<ul> <li>0.5 seconds are yielded</li> <li>EndPlayerTurn is called</li> <li><code>action</code> is set to false switching to a controlled flow</li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Acolyte/","title":"Acolyte and <code>AcolyteVine</code> EventDialogue","text":"<p>These 2 enemies have a special interactions where it is possible for an <code>Acolyte</code> to spawn an <code>AcolyteVine</code> and get on top of it which changes their position to <code>Flying</code>. Dropping down to <code>Ground</code> from there can only happen in 2 ways:</p> <ul> <li><code>Acolyte</code> gets an actor turn where they attack and then drop to <code>Ground</code> also killing their <code>AcolyteVine</code></li> <li><code>Acolyte</code> or <code>AcolyteVine</code> dies</li> </ul> <p><code>Acolyte</code> is assumed to have cantfall set to true meaning it's not possible for the player to make them drop down without them doing their aerial strike unless <code>Acolyte</code> or <code>AcolyteVine</code> dies. The problem is this isn't something that the damage pipeline can accomdate and there's also the issue that if either dies, <code>Acolyte</code> needs to drop down first and <code>AcolyteVine</code> needs to die before <code>Acolyte</code> gets killed if they were defeated.</p> <p>This is why an EventDialogue for either enemies exists on their eventondeath: it allows the game to ensure that this drop down logic occurs as well as making sure that <code>AcolyteVine</code> dies no matter if they died or <code>Acolyte</code> did. It also handles other custom logic as part of the drop down that the damage pipeline cannot handle.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Acolyte/#about-status-resistance","title":"About status resistance","text":"<p>If <code>Acolyte</code>'s <code>hp</code> is above 0 when this EventDialogue triggers, the dropdown logic will undo any resitance increases of Poison, Freeze, Numb and Sleep conditions.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Acolyte/#logic-sequence","title":"Logic sequence","text":"<p>If there's more than 1 enemy party members:</p> <ul> <li><code>Acolyte</code> and <code>AcolyteVine</code>'s <code>enemydata</code> indexes are obtained if they exists</li> <li>If <code>AcolyteVine</code> is present:<ul> <li><code>AcolyteVine</code> animstate set to 18 (<code>KO</code>)</li> <li><code>AcolyteVine</code>'s y <code>spin</code> set to 20.0</li> <li><code>AcolyteVine</code>'s <code>rotater</code> gets a DialogueAnim added that will cause them to shrink to Vector3.zero</li> <li><code>Vine2</code> sound plays</li> <li>If <code>Acolyte</code>'s <code>hp</code> is above 0, their animstate is set to 11 (<code>Hurt</code>)</li> <li>ShakeScreen called with an ammount of (0.05, 0.05, 0.05) and 0.5 time</li> <li>Yield for 0.6 seconds</li> <li>If <code>Acolyte</code>'s <code>hp</code> is above 0, <code>Fall</code> sound plays</li> <li><code>ChargeDown</code> sound plays</li> <li>Over the course of 20.0 frames:<ul> <li>If <code>Acolyte</code>'s <code>hp</code> is above 0, <code>Acolyte</code>'s <code>height</code> lerped from 3.4 to 0.2. Otherwise, <code>ItemBounce0</code> plays on the first frame only</li> <li><code>AcolyteVine</code>'s <code>startscale</code> changes towards Vector3.zero</li> <li><code>AcolyteVine</code>'s position increases by framestep * -0.2 each frame</li> </ul> </li> <li><code>AcolyteVine</code> moved offscreen at 9999.0 in y</li> <li>If <code>Acolyte</code>'s <code>hp</code> is above 0:<ul> <li>Jump called on <code>Acolyte</code></li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until <code>Acolyte</code> is <code>onground</code></li> <li>Yield for 0.2 seconds</li> <li><code>Acolyte</code>'s position changed to <code>Ground</code></li> <li><code>AcolyteVine</code> is destroyed</li> <li><code>Acolyte</code>'s <code>height</code> set to 0.0</li> <li><code>Acolyte</code>'s <code>sprite</code> local position reset to Vector3.zero</li> <li><code>Acolyte</code>'s <code>basestate</code> set to 13 (<code>BattleIdle</code>)</li> <li><code>Acolyte</code>'s <code>cursoroffset</code>, <code>poisonres</code>, <code>freezeres</code>, <code>numbres</code> and <code>sleepres</code> are reset to their default value from GetEnemyData without createentity</li> </ul> </li> </ul> </li> <li>If <code>Acolyte</code> is still present, but their <code>hp</code> is 0:<ul> <li><code>Acolyte</code>'s <code>eventondeath</code> set to -1 (so this EventDialogue isn't recursively called)</li> <li>A CheckDead is done which will cleanly kill <code>Acolyte</code></li> </ul> </li> </ul> <p>Otherwise (if the enemy killed just now is the only one left which is normally <code>Acolyte</code>):</p> <ul> <li>The enemy's <code>eventondeath</code> set to -1 (so this EventDialogue isn't recursively called)</li> <li>A CheckDead is done which will cleanly kill the enemy</li> </ul> <p>In either case, ReorganizeEnemies is called</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Cenn%20and%20Pisci/","title":"Cenn and Pisci EventDialogue","text":"<p>This event dialogue occurs either by Cenn or Pisci's action pre move logic when flags 497 is false (the player haven't beaten them for the first time) or by either of them dying due to their eventondeath which is assumed to be configured to this EventDialogue. Their <code>eventondeath</code> gets disabled in StartBattle if <code>flags</code> 497 is true meaning this EventDialogue only manages the ending of the first fight.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Cenn%20and%20Pisci/#eventdialogue-15","title":"EventDialogue 15","text":"<p>This EventDialogue will make sure to thoroughly kill both <code>Cenn</code> and <code>Pisci</code> through a mini cutscene and call ExitBattle to switch the battle to a terminal flow:</p> <ul> <li>The <code>enemydata</code> id of both <code>Cenn</code> and <code>Pisci</code> are obtained</li> <li><code>Cenn</code> and <code>Pisci</code> each gets BreakIce called on them</li> <li>Yield for 0.5 seconds</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[163]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>Cenn</code></li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[164]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>Pisci</code></li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li><code>Flee</code> sound plays</li> <li><code>Cenn</code> and <code>Pisci</code>'s <code>flip</code> gets set to true</li> <li><code>Cenn</code> and <code>Pisci</code> moves through a ForceMove to (15.0, 0.0, 0.0) with 50.0 frametime with changeanim</li> <li>Both <code>Cenn</code> and <code>Pisci</code> has their defeated counter in their bestiary entry set to 0 (this cancels what CheckDead would have done in case the EventDialogue was triggered through eventondeath)</li> <li>Yield all frames until <code>Cenn</code>'s <code>forcemoving</code> is done (in theory, <code>Pisci</code>'s would be done before)</li> <li>CleanKill called on both <code>Cenn</code> and <code>Pisci</code> leaving them at (15.0, 0.0, 0.0) as a blank enemy shell</li> <li>Yield for a frame</li> <li>ExitBattle called changing the battle to a terminal flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/EverlastingKing/","title":"EverlastingKing EventDialogue","text":"<p><code>EverlastingKing</code> has an EventDialogue that is meant to trigger as their eventondeath. This is mostly a mini cutscene supplementing their death.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/EverlastingKing/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of <code>EverlastingKing</code> is obtained</li> <li><code>EverlastingKing</code>'s eventondeath is set to -1 to disable it and prevent CheckDead from triggering it again</li> <li>If <code>EverlastingKing</code>'s <code>droproutine</code> is in progress and <code>height</code> is above 0.15, <code>droproutine</code> is set to a new Drop call on them</li> <li><code>startdrop</code> is set to true which forces the Drop call from proceeding with the enemy drop immediately</li> <li>Yield all frames until <code>EverlastingKing</code>'s <code>droproutine</code> is done</li> <li><code>EverlastingKing</code> animstate set to 18 (<code>KO</code>)</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li><code>EverlastingKing</code> animstate set to 110</li> <li>Yield for a frame</li> <li>If <code>hologram</code> is false:<ul> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[177]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>EverlastingKing</code></li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> </ul> </li> <li>EndBattleWon called with addexp and without skipids which will end the battle and switch to a terminal flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Kali/","title":"Kali EventDialogue","text":"<p><code>Kali</code> has an EventDialogue that is meant to trigger as their eventondeath. This is mostly a mini cutscene supplementing their death, but also to ensure that Beetle also dies with them.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Kali/#logic-sequence","title":"Logic sequence","text":"<ul> <li>BreakIce called on <code>Kali</code></li> <li><code>Kali</code>'s <code>isnumb</code> and <code>isasleep</code> are set to false</li> <li><code>Kali</code> animstate set to 18 (<code>KO</code>)</li> <li><code>Kali</code>'s <code>notalk</code> set to true</li> <li>Yield for a second</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[160]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>Kali</code></li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>Yield for 0.5 seconds</li> <li>If <code>Beetle</code> is still present (they could have already died):<ul> <li>Their <code>exp</code> is set to 0</li> <li>Their animstate is set to 11 (<code>Hurt</code>)</li> <li>Their <code>hp</code> is set to 0</li> </ul> </li> <li>EndBattleWon is called with addexp and no skipids which will end the battle and switch to a terminal flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Pitcher/","title":"Pitcher EventDialogue","text":"<p><code>Pitcher</code> has an EventDialogue that is meant to trigger as their eventondeath or when the Eaten condition turn advance found that the player party member just died after sustaining damages.</p> <p>If it is triggered as a result of the death, it ensures that all <code>enemydata</code> dies such as the PitcherFlytrap and if it is triggered as a result of the <code>Eaten</code> condition, it spits out the player party member.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Pitcher/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of <code>Pitcher</code> is obtained</li> <li>If <code>Pitcher</code>'s <code>hp</code> is 0 or below:<ul> <li>Their <code>eventondeath</code> is set to -1 which disables this EventDialogue and prevents CheckDead from triggering it again</li> </ul> </li> <li>If <code>Pitcher</code>'s <code>ate</code> isn't null (they are currently eating a player party member):<ul> <li><code>spitout</code> is set to a new SpitOut call with <code>Pitcher</code> as the eater</li> <li>Yield for 0.5 seconds</li> <li><code>gottaspit</code> set to false</li> <li>Yield all frames until <code>spitout</code> is null (the coroutine completed)</li> <li>If <code>Pitcher</code>'s <code>hp</code> is above 0, their <code>ate</code> is set to null (so they aren't eating anyone)</li> </ul> </li> </ul> <p>From there, the logic only continues if <code>Pitcher</code>'s <code>hp</code> is 0 or below where all <code>enemydata</code> will be killed and the battle ended:</p> <ul> <li>All <code>enemydata</code> other than <code>Pitcher</code> whose <code>deathcoroutine</code> is null has their <code>deathcoroutine</code> set to a new Death call with activatekill followed by their <code>hp</code> set to 0</li> <li>If <code>alreadyending</code> is false (AddExperience wasn't called before), EndBattleWon is called with addexp and no skipids which switches the battle to a terminal flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/SandWyrm%20and%20SandWyrmTail/","title":"SandWyrm and SandWyrmTail EventDialogues","text":"<p>This event dialogue occurs either by <code>SandWyrm</code> or <code>SandWyrmTail</code>'s eventondeath which is assumed to be configured to this EventDialogue. Each have their own EventDialogue, but they are documented in the same page as they are closely related.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/SandWyrm%20and%20SandWyrmTail/#eventdialogue-13","title":"EventDialogue 13","text":"<p>This EventDialogue is meant to trigger as the eventondeath of <code>SandWyrmTail</code>. </p> <p>Due to special logic that happened in EnemyCheck, it is guaranteed that a <code>SandWyrm</code> and a <code>SandWyrmTail</code> are part of the enemy party (the <code>SandWyrm</code> couldn't have died because if they did, the <code>SandWyrmTail</code> would have been killed too, check the EventDialogue 14 details below for why).</p> <p>This EventDialogue allows to stop <code>SandWyrm</code> temporarilly when <code>SandWyrmTail</code> dies.</p> <ul> <li>ClearStatus called on the <code>SandWyrm</code></li> <li><code>SandWyrmTail</code> has its <code>deathroutine</code> set to a new Death call on it with activatekill</li> <li><code>SandWyrm</code> animstate set to 105</li> <li><code>TidalDeath</code> sound plays with 1.125 pitch</li> <li>Yield for a second</li> <li>Yield for 0.1 second</li> <li>DeathSmoke particles plays at the <code>SandWyrm</code> position + (-1.5, 0.0, -0.1)</li> <li>ShakeScreen called with an ammount of 0.05 and 0.25 time</li> <li><code>Death3</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li>SetCondition called to inflict the Flipped condition on <code>SandWyrm</code> for 2 main turns</li> <li><code>SandWyrm</code>'s <code>size</code> set to 2.75</li> <li><code>SandWyrm</code>'s <code>cursoroffset</code> set to (-2.5, 1.5, 0.0)</li> <li>Yield all frames until <code>SandWyrmTail</code>'s <code>deathcoroutine</code> completed</li> <li><code>SandWyrm</code>'s VenusBattle is SetUp with itself as the target, but null as the parent</li> <li><code>SandWyrm</code>'s <code>size</code> set to 2.75</li> <li><code>SandWyrm</code>'s <code>basestate</code> set to 15 (<code>Fallen</code>)</li> <li>ReorganizeEnemies called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/SandWyrm%20and%20SandWyrmTail/#eventdialogue-14","title":"EventDialogue 14","text":"<p>This EventDialogue is meant to trigger as the eventondeath of <code>SandWyrm</code>. It thoroughly kills <code>SandWyrmTail</code> and themselves:</p> <ul> <li>The enemy party member of the SandWyrmTail is obtained (it's possible it doesn't exist if the <code>SandWyrm</code> was called when still Flipped)</li> <li>ShakeScreen called with an ammount of 0.05 and 0.85 time</li> <li><code>TidalDeath</code> sound plays</li> <li><code>SandWyrm</code> animstate set to 18 (<code>KO</code>)</li> <li><code>SandWyrm</code>'s eventondeath set to -1 (needed for this EventDialogue to not trigger again when the <code>SandWyrm</code> dies)</li> <li>If the <code>SandWyrmTail</code> exists in <code>enemydata</code>:<ul> <li>Their <code>hp</code> is set to 0</li> <li>Their eventondeath is set to -1 (so their EventDialogue don't trigger)</li> </ul> </li> <li>Yield for a second</li> <li>Yield for 1.5 seconds</li> <li>If the <code>SandWyrmTail</code> exists in <code>enemydata</code>:<ul> <li>Death is called on them with activatekill</li> </ul> </li> <li><code>SandWyrm</code> has its <code>deathroutine</code> set to a new Death call on it with activatekill</li> <li>Yield all frames until <code>deathroutine</code> is null (the <code>SandWyrm</code> death finished)</li> <li><code>checkingdead</code> is set to a new CheckDead call which will kill both <code>SandWyrm</code> and <code>SandWyrmTail</code></li> <li>Yield all frames until <code>checkingdead</code> is null (the CheckDead completed)</li> <li>If there was no enemy party member alive with an <code>hp</code> above 0 at the start of this action and <code>cancelupdate</code> is false (haven't yet switched to a terminal flow), EndBattleWon is called with addexp and no skipids to end the battle</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Scarlet/","title":"Scarlet","text":"<p><code>Scarlet</code> has an EventDialogue that is meant to trigger as their eventondeath. This is mostly a mini cutscene supplementing their death.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Scarlet/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Scarlet</code>'s <code>isnumb</code> and <code>isasleep</code> set to false</li> <li>BreakIce called on <code>Scarlet</code></li> <li><code>Scarlet</code>'s <code>jumpheight</code> set to 0.0</li> <li>If <code>Scarlet</code> has the Freeze condition, BreakIce is called on <code>Scarlet</code> again</li> <li><code>Scarlet</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>Umbrella</code> sound plays</li> <li>ShakeSrprite called with intensity (0.1, 0.0, 0.0) and 20.0 frametimer</li> <li>Yield for 0.25 seconds</li> <li><code>Scarlet</code> animstate set to 18 (<code>KO</code>)</li> <li>Yield for 0.25 seconds</li> <li>A new sprite object is created rooted at this enemy position + (0.0, 2.0, -0.1) using the <code>Sprites/Entities/scarlet[18]</code> sprite (the umbrella)</li> <li>Over the course of 60.0 frames:<ul> <li>The umbrella moves to (12.0, 1.0, 0.0) via a BeizierCurve3 with a ymax of 4.0</li> <li><code>Scarlet</code> moves +0.5 in x via a BeizierCurve3 with a ymax of 0.25 with a factor of the current frame / 180.0 clamped from 0.0 to 1.0</li> <li>Before each frame yield, the umbrella rotate by 20.0x the game's frametime in z</li> </ul> </li> <li>The umbrella gets destroyed</li> <li>Yield for 0.75 seconds</li> <li>EndBattleWon called with addexp without any skipids</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/","title":"Spuder EventDialogues","text":"<p><code>Spuder</code> has very complex action logic involving EventDialgoue because there are 3 different encounters behavior for them that greatly changes their action logic:</p> <ol> <li>The first encounter happens when flags 27 is false (not yet met with <code>Moth</code>) and flagvar 11 is 0</li> <li>The second encounter happens when flags 27 is false (not yet met with <code>Moth</code>) and flagvar 11 is 2</li> <li>The third encounter happens when flags 27 is true (met with <code>Moth</code>)</li> </ol> <p>These encounters involve different EventDialogue and flows. The first 2 encounters logic differences will be documented here as they are more scripted alongside. For the third encounter, most of the logic is documented in the Spuder action page, but it involves 2 EventDialogues that will be documented here since they still affect the logic greatly.</p> <p>These EventDialogue frequently makes use of CheckEvent to guide the flow. They also makes use of <code>flagvar</code> 11 to track the state of the encounters accross them.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#first-encounter","title":"First encounter","text":"<p>This is the first encounter that requires flags 27 to be false (not yet met with <code>Moth</code>) and flagvar 11 to be 0. It's assumed here that the player party is only composed of <code>Beetle</code>.</p> <p>CheckEvent will detect these conditions when the first <code>enemydata</code> is <code>Spuder</code> and make it effectively unbeatable by setting its <code>hp</code> to 999 and its <code>def</code> to 99 as well as add an <code>AntiPierce</code> weakness if it wasn't present which cancels out any <code>Pierce</code> attacks. Even if the player can defeat them, the event will proceed as normal.</p> <p>From there, the battle goes on as normal, but the <code>Spuder</code> action receives some heavy restrictions due to the same conditions above:</p> <ul> <li><code>Spuder</code> will always decide to use his bite attack move if their position is <code>Ground</code></li> <li>Due to the above, <code>Spuder</code> will never attempt to rise in the air to <code>Flying</code>, but an exception to this occurs where it will always do it if <code>demomode</code> is true or <code>tempdata</code> is 1 (the latter is assumed to never be the case for this encounter)</li> <li><code>Spuder</code> will never drop down to <code>Ground</code> if it has risen in the air to <code>Flying</code> even for more than 2 main turns</li> </ul> <p>Effectively, until <code>demomode</code> is set to true, <code>Spuder</code> is stuck using his biting attack move.</p> <p>This continues until <code>turns</code> is 2 meaning after 2 main turns, CheckEvent detects this and starts EventDialogue 4.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#eventdialogue-4","title":"EventDialogue 4","text":"<p>This EventDialogue represents the dialogue and scripted action of <code>Spuder</code> rising in the air:</p> <ul> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[27]</code> which is some dialogue about the fight</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[0]</code></li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>instance.<code>camtargetpos</code> is set to <code>enemydata[0]</code>'s position (should always be <code>Spuder</code>) with an instance.<code>camspeed</code> set to 0.03</li> <li>Yield for 0.5 seconds</li> <li><code>demomode</code> is set to true</li> <li>DoAction is called with <code>enemydata[0]</code> as the entity and 0 as the actionid. Effectively, it forces <code>Spuder</code> to do an actor turn, but because <code>demomode</code> is true, he always will rise in the air to <code>Flying</code> in his action</li> <li>Yield all frames until <code>action</code> goes to false (until DoAction is done)</li> <li><code>demomode</code> is set back to false</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[28]</code> which is some dialogue about the action <code>Spuder</code> did</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[0]</code> (should be <code>Beetle</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li><code>enemydata[0]</code> (should always be <code>Spuder</code>) has its <code>cantmove</code> set to 0 which allows them to act for this main turn since it technically hasn't occured yet (the game forced them to act so this is needed to resync the <code>cantmove</code> counter to where it would be)</li> <li><code>flagvar</code> 11 is set to 1 which advances to the next phase of the encounter</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#encounter-end","title":"Encounter end","text":"<p>Since <code>flagvar</code> is 11, this now means that CheckEvent will call ExitBattle once <code>turns</code> is 3 meaning a full main turn passed since EventDialogue 4. This ends the first encounter.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#second-encounter","title":"Second encounter","text":"<p>The second encounter is similar to the first, but with some key differences with the most notable one being it is assumed a <code>MothWeb</code> is present alongside <code>Spuder</code> as <code>enemydata[1]</code>. <code>MothWeb</code> is a special enemy because it has no action logic, but it is assumed to have an eventondeath set to EventDialogue 6. Triggering this EventDialogue will ultimately end the battle and it is the overall goal of the second encounter. It is also assumed that the player party is composed of <code>Bee</code> and <code>Beetle</code> in default party order.</p> <p><code>flagvar</code> 11 must be 2 and <code>tempdata</code> must be 1. This is normally set by the event that started the battle. CheckEvent detects this which causes to trigger EventDialogue 5 when <code>turns</code> is 2 meaning 2 main turns passed. This EventDialogue is a reminder to defeat <code>MothWeb</code> via some dialogues.</p> <p>This goes on infinetely because <code>Spuder</code>'s <code>hp</code> starts at 999 and <code>def</code> starts at 99. He is effectively not beatable (even if defeated, the event will proceed as normal). One thing does changes with its action logic compared to their first encounter: <code>tempdata</code> should be 1 at this point as it was set by the event that started this encounter.</p> <p>This means that he will always rise in the air to <code>Flying</code> on their first main turn. He still will not drop down to <code>Ground</code> on his own even after 2 main turns, but if they fall as a result of a DoDamage, their move selection changes to be a 50/50 between their bite attack and rising in the air. This is because at the end of the air rising move, <code>tempdata</code> is set to 0 if it was 1 so it won't get overriden again.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#eventdialogue-5","title":"EventDialogue 5","text":"<p>This EventDialogue is some dialogues that reminds the player to defeat <code>MothWeb</code> after 2 main turns have passed:</p> <ul> <li>If <code>playerdata[1]</code> (should always be <code>Beetle</code>)'s <code>hp</code> is above 0:<ul> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[29]</code> which is some dialogue to remind to defeat <code>MothWeb</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[1]</code> (should always be <code>Beetle</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released </li> </ul> </li> <li><code>flagvar</code> 11 is set to 3 which prevents this EventDialogue from triggering again</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#eventdialogue-6","title":"EventDialogue 6","text":"<p>This EventDialogue is assumed to be the eventondeath of <code>MothWeb</code> and marks the end of the second encounter as it ultimately leads to the end of the battle. It is assumed that <code>enemydata[1]</code> is <code>MothWeb</code>:</p> <ul> <li><code>MothWeb</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>MothWeb</code>'s model has all ParticlesSystem starting playing</li> <li>All <code>playerdata</code> has their animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>Spin2</code> sound played on loop using <code>sounds[9]</code> with pitch 0.7 and volume 0.9</li> <li>Yield for 1 second</li> <li><code>sounds[9]</code> stopped</li> <li><code>Spin4</code> sound plays with 1.1 volume</li> <li>A new entity is created via CreateNewEntity named <code>tmoth</code> with animid of 2 (<code>Moth</code>) at <code>playerdata[1]</code> position + (0.0, 3.5, 0.0) childed to the <code>battlemap</code></li> <li><code>tmoth</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>tmoth</code> y spin set to -20.0</li> <li><code>tomoth</code>'s <code>onground</code> set to false</li> <li>CreateFeet called on <code>tmoth</code></li> <li><code>enemydata[1]</code> (should always be <code>MothWeb</code>)'s position is set offscreen at (0.0, -1000.0, 0.0)</li> <li>Yield for a frame</li> <li><code>tmoth</code>'s <code>overridejump</code> set to true</li> <li><code>tmoth</code> animstate set to 11 (<code>Hurt</code>)</li> <li>Yield all frames until <code>tmoth</code>'s <code>onground</code> gets to true. Before each yield, their <code>overridejump</code> is set to true and their animstate is set to 11 (<code>Hurt</code>)</li> <li><code>tmoth</code>'s <code>spin</code> is zeroed out</li> <li><code>tmoth</code> animstate set to 18 (<code>KO</code>)</li> <li>Yield for 0.5 seconds</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[30]</code> which is some dialogue after defeating <code>MothWeb</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[0]</code> (should always be <code>Bee</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>Yield for 0.25 seconds</li> <li>ExitBattle is called which ends the battle and the second encounter</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#third-encounter","title":"Third encounter","text":"<p>This is essentially the typical encounter of <code>Spuder</code>. This encounter is in effect when flags 27 is true (met <code>Moth</code>), but it is assumed that <code>flagvar</code> 11 has a value below 150 for the EventDialogues to work correctly. It is also assumed that <code>flags</code> 37 is false as if it is true, the EventDialogues won't occur. It is assumed <code>Spuder</code> is the only enemy party member of the battle.</p> <p>CheckEvent will detect the third encounter when <code>turns</code> is 0 meaning the first main turn and <code>flagvar</code> 11 being lower than 150. When that happens, EventDialogue 8 starts followed by <code>flagvar</code> 11 being set to 150 so it only triggers once at the start of the battle.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#eventdialogue-8","title":"EventDialogue 8","text":"<p>This EventDialogue is a mini cutscene where <code>Spuder</code> gains 2 <code>moves</code>:</p> <ul> <li><code>Roar</code> sound plays</li> <li><code>enemydata[0]</code> (should always be <code>Spuder</code>) animstate set to 100</li> <li>All player party member whose <code>hp</code> is above 0 has their animstate set to 11 (<code>Hurt</code>)</li> <li>Yield for a second</li> <li>StatEffect called on <code>enemydata[0]</code> (should always be <code>Spuder</code>) with type 5 (up yellow arrow)</li> <li><code>enemydata[0]</code> (should always be <code>Spuder</code>) animstate set to 102</li> <li><code>enemydata[0]</code> (should always be <code>Spuder</code>)'s <code>moves</code> set to 2 giving them 2 actor turns per main turns</li> <li>UpdateAnim called</li> <li>Yield for 0.75 seconds</li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#first-encounter-phase","title":"First encounter phase","text":"<p>After, the encounter proceeds as normal. Most of the logic is described in the Spuder action page, but it's mostly an unrestricted version of their first 2 encounters.</p> <p>This occurs until their <code>hp</code> becomes lower than their <code>maxhp</code> / 2 floored. When this happens, CheckEvent detects this which causes EventDialogue 7 to start followed by <code>flagvar</code> 11 being set to 200 so it only triggers once for the rest of the battle. This EventDialogue transitions to the second phase of the encounter.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/Spuder/#eventdialogue-7","title":"EventDialogue 7","text":"<p>This EventDialogue transitions the third <code>Spuder</code> encounter to its second phase:</p> <ul> <li>HealConditions called on <code>enemydata[0]</code> (should always be <code>Spuder</code>)</li> <li><code>Roar</code> sound plays</li> <li><code>enemydata[0]</code> (should always be <code>Spuder</code>) animstate set to 100</li> <li>All player party member whose <code>hp</code> is above 0 has their animstate set to 11 (<code>Hurt</code>)</li> <li>Yield for a second</li> <li>AddNewEnemy called with id 8 (<code>ArmoredPoly</code>) and position (20.0, 0.0, 0.0)</li> <li>AddNewEnemy called with id 1 (<code>Mushroom</code>) and position (20.0, 0.0, 0.0)</li> <li>Yield for a frame</li> <li><code>enemydata[1]</code>'s <code>battlepos</code> set to (0.85, 0.0, 0.0)</li> <li><code>enemydata[2]</code>'s <code>battlepos</code> set to (7.2, 0.0, 0.0)</li> <li>Both <code>enemydata[1]</code> and <code>enemydata[2]</code> has their <code>cantmove</code> set to 1 meaning they will need to wait a main turn before being able to act</li> <li>Over the course of 1 / 0.015 frames (~66.6666667), every enemy party members has their position lerped from (20.0, 0.0, 0.0) to their <code>battlepos</code>. Before the position change on each frame, their <code>rigid</code> gravity gets disabled and <code>overrideanim</code> set to true (the <code>Mushroom</code> also gets their animstate set to 23 (<code>Chase</code>))</li> <li>All enemy party members has their <code>rigid</code> gravity enabled, animstate set to 0 (<code>Idle</code>) and <code>overrideanim</code> set to false</li> <li>UpdateAnim called</li> <li><code>enemydata[0]</code> (should be <code>Spuder</code>) animstate set to 102</li> <li>ReorganizeEnemies called wit order {1, 0, 2}</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/UltimaxTank/","title":"UltimaxTank EventDialogue","text":"<p><code>UltimaxTank</code> has an EventDialogue that is meant to trigger as their eventondeath. This is used a transition to a different <code>enemydata</code> set containing only a WaspGeneral.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/UltimaxTank/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of <code>UltimaxTank</code> is obtained</li> <li><code>UltimaxTank</code>'s <code>eventondeath</code> is set to -1 which disables this EventDialogue so CheckDead won't run it again</li> <li>AddNewEnemy called to add a WaspGeneral enemy at (<code>UltimaxTank</code>'s x position, 20.0, 0.0)</li> <li>Yield for a frame</li> <li>All enemy party members has their animstate set to 11 (<code>Hurt</code>)</li> <li><code>UltimaxTankShakingDeathLoop</code> sound plays on loop using <code>sounds[9]</code> with 0.75 volume</li> <li>ShakeScreen called with an ammounnt of 0.1 and -1.0 time (infinite)</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[171]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>UltimaxTank</code></li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released. On the first frame every 30.0 frames, DeathSmoke particles plays at <code>UltimaxTank</code> position + (A random number between -1.0 and 3.0, 2.0, -2.0)</li> <li>ShakeScreen called with 0.2 ammount and 3.0 time</li> <li>Yield for a second</li> <li><code>UltimaxTankShakingDeathLoop</code> sound stopped</li> <li><code>UltimaxTankDeathExplosion</code> sound plays</li> <li><code>sounds[9]</code> stopped</li> <li><code>explosion</code> particles plays at <code>UltimaxTank</code> position with a scale of 5.0x</li> <li>Every enemy party member other than <code>UltimaxTank</code> and <code>WaspGeneral</code> has MainManager.ArcMovement called on them to move them to a random vector between (-10.0, 3.0, -2.0) and (10.0, 3.0, 2.0) with 10.0 height and 29.0 frametime (each are done in paralel)</li> <li>Yield for 0.25 seconds</li> <li><code>UltimaxTank</code> moved offscreen at -999.0 in y</li> <li>Yield for a frame</li> <li>Yield for 0.25 seconds</li> <li>Every enemy party members except <code>WaspGeneral</code> has CleanKill called on them to turn them into empty <code>enemydata</code> shells with a startp of Vector3.zero</li> <li>ReorganizeEnemies called (this will remove <code>UltimaxTank</code> and the enemies they summoned if any from the enemy party completely as they just died)</li> <li>Yield for a second</li> <li>Yield for a second</li> <li><code>WaspGeneral</code> animstate set to 11 (<code>Hurt</code>)</li> <li>y <code>spin</code> set to 20.0</li> <li><code>WaspGeneral</code> ForceMove to 0.0 in y and z with 30.0 frametime without changeanim</li> <li><code>Fall</code> sound plays with 0.8 pitch</li> <li>Yield for a frame</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li><code>Death3</code> sound plays</li> <li>ShakeScreen called with an ammount of 0.1 with 0.5 time</li> <li><code>WaspGeneral</code> animstate set to 102</li> <li><code>WaspGeneral</code>'s <code>spin</code> zeroed out</li> <li>DeathSmoke particles plays at <code>WaspGeneral</code> position</li> <li>Yield for 0.5 seconds</li> <li>ShakeSprite called on <code>WaspGeneral</code> with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li><code>Jump</code> sound plays</li> <li>Jump called on <code>WaspGeneral</code></li> <li><code>WaspGeneral</code>'s animstate and <code>basestate</code> set to 13 (<code>BattleIdle</code>)</li> <li>Yield for a second</li> <li><code>sounds[9]</code> stopped</li> <li>MainManager.<code>screenshake</code> zeroed out</li> <li><code>checkingdead</code> set to a new CheckDead call (this won't do anything because only <code>WaspGeneral</code> exists and they are alive)</li> <li>Yield all frames until <code>checkingdead</code> is null (the CheckDead completed)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/VenusBoss/","title":"VenusBoss EventDialogue","text":"<p><code>VenusBoss</code> has an EventDialogue that is meant to trigger as their eventondeath. This is mostly a mini cutscene supplementing their death.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/VenusBoss/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 11 (<code>Hurt</code>)</li> <li><code>VenusBoss</code> has their <code>basestate</code> set to 11 (<code>Hurt</code>)</li> <li>BreakIce called on <code>VenusBoss</code></li> <li>If <code>VenusBoss</code>'s position is <code>Flying</code>:<ul> <li>Their <code>droproutine</code> is set to a new Drop call</li> <li>Yield all frames until <code>droproutine</code> is null (when it completes)</li> </ul> </li> <li>Camera moves to look near (1.25, 1.5, 2.0)</li> <li>Yield for 0.75 seconds</li> <li><code>cancelupdate</code> set to true switching to a terminal flow (this is too early to do this, but it is safe because the battle will end here)</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>|</code>boxstyle<code>,1||</code>center<code>||</code>shaky<code>||</code>halfline<code>||</code>size<code>,1.75|</code> followed by <code>commondialogue[92]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>extraentities[0]</code> (<code>Venus</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 17 (<code>WeakBattleIdle</code>)</li> <li>All <code>enemydata</code> has their <code>hp</code> set to 0 and their <code>eventondeath</code> to -1. This will force the death of everyone to happen normally without triggering this EventDialogue again</li> <li>SetDefaultCamera called with reset</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to a new CheckDead call which will properly kill every <code>enemydata</code></li> <li>Yield until <code>checkingdead</code> is null (the CheckDead completed)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/WaspKing/","title":"WaspKing EventDialogue","text":"<p><code>WaspKing</code> has an EventDialogue that is meant to trigger as their eventondeath. This is mostly a mini cutscene supplementing their death, but it also dictates how the battle will end depending on the situation so it ends up switching to a terminal flow.</p>"},{"location":"Battle%20system/Battle%20flow/EventDialogues/WaspKing/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of <code>WaspKing</code> is obtained</li> <li><code>WaspKing</code> animstate set to 116</li> <li>If <code>WaspKing</code>'s <code>hologram</code> is false, FadeMusic is called with 0.03 fadespeed</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li><code>WaspKing</code>'s eventondeath set to -1</li> <li>If <code>WaspKing</code>'s <code>hologram</code> is false:<ul> <li>ExitBattle is called</li> </ul> </li> <li>Otherwise:<ul> <li>EndBattleWon is called with addexp without skipids</li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/","title":"AddExperience","text":"<p>AddExperience is a terminal coroutine that is invoked whenever most battles are won with EXP gain. This coroutine will be the step between the battle finishing and ExitBattle which is a wrapper around ReturnToOverworld.</p> <p>The coroutine yield breaks immediately if <code>alreadyending</code> is true (meaning AddExperience or GameOver was already invoked) or <code>gameover</code> is in progress.</p> <p>NOTE: The vast majority of the logic in this coroutine concerns very verbose animations and UI rendering. For the sake of brevity, they will be paraphrased and details will be kept at a high level. All other logic will still be mentioned in granular details.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#setup","title":"Setup","text":"<ul> <li><code>alreadyending</code> is set to true which prevents double invocations</li> <li><code>action</code> and <code>cancelupdate</code> are set to true changing to a terminal flow</li> <li><code>enemy</code> is set to false, but this doesn't do anything because we just changed to a terminal flow</li> <li>If the <code>HealingBuzz</code> medal is equipped:<ul> <li>All player party members with an <code>hp</code> above 0 has Heal called on them for an ammount of 2 with nosound</li> <li>The <code>Heal</code> sound is played (the reason the Heal calls didn't had sound is to avoid playing healing sounds multiple times)</li> </ul> </li> <li>0.5 seconds are yielded if any player party members were healed as a result of the <code>HealingBuzz</code> logic above</li> <li>If the <code>VictoryBuzz</code> medal is equipped:<ul> <li>HealTP is called which plays a <code>Heal2</code> sound followed by a heal of instance.<code>tp</code> by 4 followed by a ShowDamageCounter with type 2, the amount being 4, the start position being <code>playerdata[</code>GetRandomAvaliablePlayer()<code>].battleentity</code> position + (2.0, 2.0, 2.0) and the end position being (5.0, 5.0, 5.0)</li> <li>0.5 seconds are yielded</li> </ul> </li> <li>If <code>expreward</code> is above 5:<ul> <li><code>checkingdead</code> is set to a new UseCharm coroutine starting with <code>ExpUp</code> as the type</li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> </ul> </li> <li>The <code>switchicon</code> and <code>fronticon</code> are destroyed</li> <li>If flags 613 is true (RUIGEE is active), <code>expreward</code> is set to 0</li> <li>Otherwise, if <code>expreward</code> was already 0 while <code>enemyfled</code> is false and instance.<code>partylevel</code> is less than 27 (the normal max rank), <code>expreward</code> is set to 1</li> <li>RefreshEXP is called</li> <li>AddExperience determines if a <code>BattleWon</code> sound should be played. it will be if <code>musicvolume</code> is above 0.0 and <code>music[0]</code>.name is <code>Battle0</code> or <code>Battle6</code> (meaning that the music we were just playing was one of the 2 regular battle themes). If that is the case:<ul> <li>FadeMusic is called with a fadespeed of 0.05</li> <li>The <code>BattleWon</code> sound is played and the AudioSource is kept track locally</li> <li>If the <code>BattleWon</code> AudioSource indeed exists, its volume is set to <code>musicvolume</code> (this is needed because it's a sound so it wouldn't get the music volume by default)</li> </ul> </li> <li>flagvar 0 is set to <code>expreward</code> (this will be used for rendering later)</li> <li>instance.<code>hudcooldown</code> is set to -1.0</li> <li>All frames are yielded while there are still any enemy party members</li> <li>0.45 seconds are yielded</li> <li>All player party members has their matching instance.<code>hud</code>'s child has its local position set to Vector3.zero</li> <li>For every player party members whose <code>hp</code> is above 0:<ul> <li>If they have the Freeze condition, BreakIce is called on their battleentity</li> <li>battleentity.<code>spin</code> is set to (0.0, -17.0, 0.0)</li> <li>battleentity.animstate is set to 4 (<code>ItemGet</code>)</li> </ul> </li> <li>instance.<code>camtargetpos</code> is set to (-4.5, 0.0, 2.5)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#exp-gain-visuals-setup","title":"EXP gain visuals setup","text":"<p>The process to render the expereince gain screen is very verbose and complex so the procedure is paraphrased a lot here:</p> <ul> <li>A <code>textholder</code> GameObject gets created with a <code>DelAftBtl</code> tag (destroyed on ReturnToOverworld) childed to the GUICamera with a z local position of 5.0</li> <li>SetText is called in non dialogue mode using the following string: <code>|</code>sort<code>,10000||</code>color<code>,4||</code>center<code>||</code>dropshadow<code>,0.05,-0.05||</code>backbox<code>,6|</code> followed by <code>menutext[117]</code> (a message informing the player they gained EXP where the number is <code>|</code>var<code>,0|</code>). The call has the following properties:<ul> <li>fonttype of 2 (UNUSED, but gets overriden to <code>D3Streetism</code>)</li> <li>No linebreak</li> <li>No tridimensional</li> <li>position of (0.0, 3.0, 5.0)</li> <li>No cameraoffset</li> <li>size of Vector3.one</li> <li>parent being the <code>textholder</code></li> <li>No caller</li> </ul> </li> <li>A new UI object called <code>ExpBar</code> with a <code>DelAftBtl</code> tag (destroyed on ReturnToOverworld), a DialogueAnim and a pure yellow color using <code>guisprites[4]</code> (the HUD background sprite) is created as the background of the EXP text</li> <li><code>lvicon</code> is set to a new UI object named <code>Icon</code> using <code>guisprites[27]</code> (the EXP icon sprite) childed to the <code>ExpBar</code></li> <li>A DynamicFont is setup childed to the <code>ExpBar</code> with a layer of 5 (<code>UI</code>) with a pure white color with the starting text being the following appended together:<ul> <li>instance.<code>partyexp</code> padded to the left with 3 <code>0</code></li> <li><code>/</code></li> <li>instance.<code>neededexp</code></li> </ul> </li> <li>All player party members with an <code>hp</code> above 0 has their battleentity.<code>spin</code> zeroed out</li> <li><code>leveled</code> is set to false</li> <li>0.15 seconds are yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#exp-orbs-counting-and-wait","title":"EXP orbs counting and wait","text":"<p>This sub section concerns the counting of the EXP gained and the management of its fast version if requested by the player.</p> <ul> <li>instance.skiptext is set to false (this isn't used for its SetText use since it will be managed manually)</li> <li>A new GetSkip coroutine is started and stored localled which will yield all frames until input 4 (Confirm) is pressed which wil cause instance.<code>skiptext</code> to be set to true</li> <li>The EXP orbs are counted starting with <code>bigexporbs</code> then moving to <code>smallexporbs</code> that exists (there is a frame yield between the 2 types's counting). A big one will have 1 EXP counted 10 times while a small one will only have it counted once. This is how the counting happens each time:<ul> <li>The orb gets destroyed</li> <li>AddExp(1) is called which does the following:<ul> <li>Incrementes instance.<code>partyexp</code> by 1</li> <li>An <code>Exp2</code> sound is played on <code>sounds[4]</code>, <code>sounds[5]</code>,<code>sounds[6]</code> or <code>sounds[7]</code> (the first one that isn't playing with <code>sounds[7]</code> being the falback) with a pitch being 1.5 + a random number between -0.1 and 0.1 inclusive</li> <li>If instance.<code>partyexp</code> reached instance.<code>neededexp</code> (meaning this is a rank up), instance.<code>partyexp</code> is decreased by <code>neededexp</code> and the rank up is signaled by returning true</li> <li>Otherwise, no rank up occured so false is returned</li> </ul> </li> <li>If the AddExp call resulted in a rank up, Leveled is called which sets <code>leveled</code> to true, but if it wasn't true before, a SpinAround component added to <code>lvicon</code> with its <code>itself</code> set to (0.0, 20.0, 0.0) followed by a <code>Lazer</code> sound being played at 1.2 pitch</li> <li>The DynamicFont of the EXP's text is refreshed using the new instance.<code>partyexp</code></li> <li>If instance.<code>skiptext</code> is still false, a yield is done. The time of the yield is 0.075 seconds unless <code>expreward</code> was at least 10 where it will be 0.045 seconds instead</li> </ul> </li> <li>At this point, the GetSkip coroutine call earlier is stopped since it no longer has any use</li> <li>If instance.<code>skiptext</code> was set to true by the end of the counting, the DynamicFont of the EXP's text is refreshed using the new instance.<code>partyexp</code> followed by 0.2 seconds being yielded</li> <li>A frame is yielded</li> <li>instance.<code>skiptext</code> is set back to false</li> <li>For a maximum of 50.0 frames (tracked with a local counter starting at 0.0 and incremented by 1/50 of the game's frametime until it reaches 1.0), all frames are yielded until any input is pressed which interupts this wait early</li> <li>If the <code>BattleWon</code> sound was played earlier, all frames are yielded while it's still playing and hasn't reached 2.35 seconds</li> <li>A second is yielded if no <code>BattleWon</code> sound was played</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#text-ui-teardown","title":"Text UI teardown","text":"<ul> <li>A DialogueAnim is added on the <code>ExpBar</code> object to move it to the left offscreen</li> <li>0.5 seconds are yielded</li> <li>The <code>textholder</code> object is destroyed</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#rank-up-logic","title":"Rank up logic","text":"<p>This logic only happens if <code>leveled</code> is true and instance.<code>partylevel</code> is less than 27 (the normal max rank).</p> <p>The logic in here is very complex and mostly contains verbose animations so it will be paraphrased a lot.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#setup_1","title":"Setup","text":"<ul> <li>instance.<code>partylevel</code> is incremented</li> <li>0.25 seconds are yielded</li> <li>instance.<code>neededexp</code> is increased to a certain amount to indicate the new amount required to rank up. The first increase that applies in the following ones is the one that will occur (they are mutually exclusive):<ul> <li>+5 If flags 656 is true (MOREFARM is active)</li> <li>+3 if instance.<code>partylevel</code> is at least 24</li> <li>+2 if instance.<code>partylevel</code> is at least 15</li> <li>+1 if none of the above applied</li> </ul> </li> <li>ChangeMusic is called with the <code>LevelUp</code> music</li> <li><code>Prefabs/Particles/Floweretti</code> particles are instantiated childed to the <code>battlemap</code> and played</li> <li>All <code>Sprites/GUI/BattleMessage/rankX</code> are loaded where <code>X</code> is the languageid (it falls back to English if no Sprites exists for it)</li> <li>All objects with tag <code>Enemy</code> are destroyed</li> <li>SetDefaultCamera is called</li> <li>MainManager.Heal is called</li> <li>instance.<code>hudcooldown</code> is set to -1</li> <li>instance.<code>option</code> is set to 0 and instance.<code>maxoptions</code> to 3</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#rank-up-animation","title":"Rank up animation","text":"<ul> <li>All player party members has their battleentity.<code>animstate</code> set to 4 (<code>ItemGet</code>) and their <code>spin</code> to (0.0, 20.0, 0.0)</li> <li>All player party members are move to be centered on the screen using MiddlePos via lerping their battleentity.position for a maximum of 34 frames (tracked via a local framecounter advancing by 0.03 of the game's frametime from 0.0 to 1.0)</li> <li>All player party members gets their battleentity.<code>spin</code> zeroed out and their battleentity has a SpecialAnimation started with the <code>levelup</code> animation</li> <li>The letters of the Rank up messages appears in the following fashion:<ul> <li>A <code>LetterHolder</code> object is created and childed to GUICamera</li> <li>New UI objects called <code>letterX</code> where X is the index of the letter sprite loaded earlier are created all childed to the <code>LetterHolder</code> with a FontEffects using just the rainbow effect</li> <li>The letters appear from offscreen at 99.0 in Y and 5.0 in Z using a lerp off their local position. This is done over a maximum of 200.0 frames and it is porportional to the amount of letters to show</li> <li>0.65 seconds are yielded</li> <li>All letters have their local scale lerped from Vector3.one to (0.0, 1.25, 1.0) and their angle increased by Vector3.up * 5x the game's frametime continuoudly over the course of maximum 34 frames (tracked via a local framecounter advancing by 0.03 of the game's frametime from 0.0 to 1.0)</li> <li>The <code>LetterHolder</code> is destroyed</li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#rank-up-bonus-ui-setup","title":"Rank up bonus UI setup","text":"<ul> <li>3 <code>Prefabs/Objects/Vine</code> are created using layer 15 (<code>3DUI</code>) childed to the <code>battlemap</code> with each their own UI icon. The vines are positioned centered to the screen using MiddlePos and they have a DialogueAnim with a tsize being Vector3.one * 2.0. Each has a <code>guisprites[42]</code> (a hexagon) on the background of a new <code>Overicon</code> object with a SpriteRenderer childed to their vine. The sprites used for the icons are:<ul> <li>0: HP icon</li> <li>1: TP icon</li> <li>2: MP icon</li> </ul> </li> <li>An MP count HUD element is created:<ul> <li>New UI object called <code>medalhud</code> childed to the <code>textholder</code> with a pure yellow color using the HUD background sprite</li> <li>New UI object called <code>medalicon</code> chiled to the <code>medalhud</code> using the MP icon sprite</li> <li>A DynamicFont is setup on the <code>medalhud</code> as parent with <code>dropshadow</code> and with the text being the following appended together:<ul> <li>instance.<code>bp</code> padded to the left by 2 <code>0</code></li> <li><code>/</code></li> <li>instance.<code>maxbp</code> padded to the left by 2 <code>0</code></li> </ul> </li> <li>A DialogueAnim is added on the <code>medalhud</code> so it appears from the top of the screen</li> </ul> </li> <li>0.8 seconds are yielded</li> <li>A 9Box is created with a DialogueAnim to make it grow</li> <li>A SetText call happens in non dialogue mode with the text being <code>|</code>single<code>|</code> followed by <code>menutext[122]</code> (a prompt message to pick a stat boost) and the following properties:<ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>No linebreak</li> <li>No tridimensional</li> <li>position of (-7.5, 0.15, 0.0)</li> <li>No cameraoffset</li> <li>size of Vector3.one</li> <li>parent being the 9Box</li> <li>No caller</li> </ul> </li> <li>A new UI object is created named <code>t</code> childed to the GUICamera using the <code>cursorsprite[0]</code> with a SpriteBounce</li> <li>5 frames are yielded (counted by MainManager.<code>framestep</code>)</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#rank-up-bonus-ui-naviguation-and-confirmation","title":"Rank up bonus UI naviguation and confirmation","text":"<ul> <li>All frames are yielded while Input 4 (Confirm) isn't pressed</li> <li>A <code>Confirm</code> sound is played</li> <li>A frame is yielded</li> <li>The cursor gets childed to the <code>battlemap</code> then moved offscreen and DestroyText is called with it</li> <li>instance.<code>hudcooldown</code> is set to -1</li> <li>A SetText call happens in non dialogue mode with the text being <code>|</code>single<code>|</code> followed by <code>menutext[119]</code> (the HP rank up bonus description) and the following properties:<ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>No linebreak</li> <li>No tridimensional</li> <li>position of (-7.5, 0.15, 0.0)</li> <li>No cameraoffset</li> <li>size of Vector3.one</li> <li>parent being the 9Box</li> <li>No caller</li> </ul> </li> <li>5 frames are yielded (counted by MainManager.<code>framestep</code>)</li> <li>From here, an infinite loop is entered with a frame yield each iteration that won't exit until one of the 3 rank up bonuses have been chosen. Each iterations features the selected instance.<code>option</code>'s vine's sprites being rotated and scaled via a lerp continuously propotional to the games frametime. It also feature another SetText call just like the above when instance.<code>option</code> changes, but the text is <code>menutext[119 + X]</code> where <code>X</code> is instance.<code>option</code>:<ul> <li>If <code>caninputcooldown</code> isn't expired, it is decreased by the MainManager.<code>framestep</code> and no input can be taken until it expires</li> <li>Otherwise, the logic depends on the input:<ul> <li>2 / 3 (Left / Right): changes instance.<code>option</code> accordingly with wrap around to 2 followed by a scroll sound followed by <code>caninputcooldown</code> being set to 3.0</li> <li>4 (confirm): The UI loop is exited (the option chosen is indicated by instance.<code>option</code>)</li> </ul> </li> </ul> </li> <li>The <code>LevelUp</code> sound is played</li> <li>For a maximum of 40 frames (tracked with a local counter starting at 0.0 and incremented by 1/40 of the game's frametime until it reaches 1.0):<ul> <li>All other vines than the instance.<code>option</code> one have their local Y position lerped to 20.0 and their Z to 0.0 which moves them offscreen</li> <li>The instance.<code>option</code> vine gets their angles reset</li> </ul> </li> <li>The <code>CrowdClap</code> sound is played on <code>sounds[9]</code> with 0.5 volume</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#rank-up-bonus-application","title":"Rank Up bonus application","text":"<p>The logic to apply the bonus depends on instance.<code>option</code>:</p> <ul> <li>0 (HP): All player party members gets their <code>basehp</code> and <code>maxhp</code> gets incremented and a 1 <code>HP</code> bonus to the party is added to instance.<code>statbonus</code> via AddStatBonus</li> <li>1 (TP): A 1 <code>TP</code> bonus to the party is added to instance.<code>statbonus</code> via AddStatBonus</li> <li>2 (MP): instance.<code>maxbp</code> and instance.<code>bp</code> gets increased by 3 and a 3 <code>MP</code> bonus to the party is added to instance.<code>statbonus</code> via AddStatBonus. It also causes the <code>medalhud</code>'s DynamicFont text to be refreshed with the new instance.<code>bp</code> and instance.<code>maxbp</code></li> </ul> <p>After, the following happens:</p> <ul> <li>ApplyStatBonus is called</li> <li>Each player party member has a unique animation played there that sets their battleentity.animstate to a value that depends on the <code>trueid</code>:<ul> <li><code>Bee</code>: 111, also comes with a SlowSpinStop of (0.0, -20.0, 0.0) for 30.0 frametime on the battleentity</li> <li><code>Beetle</code>: 114, also comes with a battleentity.<code>flip</code> toggle</li> <li><code>Moth</code>: 115</li> </ul> </li> <li>A frame is yielded</li> <li>ApplyBadges is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#levelupmessage-and-teardown","title":"LevelUpMessage and teardown","text":"<ul> <li>instance.<code>hudcooldown</code> is set to -1</li> <li><code>medalhud</code>'s DialogueAnim's <code>targetpos</code> is set to (3.7, 10.0, 5.0) which moves it along with the rest of the HUD</li> <li><code>medalhud</code> is destroyed in 0.5 seconds</li> <li>0.5 seconds is yielded</li> <li>The 9Box is destroyed</li> <li>flagvar 0 is set to 0 (this will be used to track whenever a coroutine gets done)</li> <li>A LevelUpMessage coroutine is started (this will set flagvar 0 to 1 when it's complete)</li> <li>All frames are yielded while flagvar 0 is 0 (meaning the LevelUpMessage isn't done yet)</li> <li>ApplyBadges is called</li> <li>A frame is yielded</li> <li>MainManager.Heal is called with noparticle and with nosound</li> <li>instance.<code>hudcooldown</code> is set to -1</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#special-heal","title":"Special heal","text":"<p>If the rank up logic didn't happen, but instance.<code>partylevel</code> is at least 99 (which normally can never happen), Heal is called.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/AddExperience/#last-steps","title":"Last steps","text":"<ul> <li>A frame is yielded</li> <li><code>sounds[9]</code> is stopped with a 0.002 delay</li> <li>ExitBattle is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/DeadParty/","title":"DeadParty","text":"<p>This is a wrapper terminal coroutine that will call GameOver or ReturnToOverworld depending on MainManager.<code>battlelossevent</code>. It is called when the game finds out the party is fully dead.</p> <ul> <li><code>cancelupdate</code> is set to true changing to a terminal flow</li> <li><code>currentturn</code> is set to <code>partypointer[0]</code> (the front member)</li> <li>A second is yielded</li> <li>If MainManager.<code>battlelossevent</code> is false, <code>gameover</code> is set to a new GameOver call without skipsetup if it wasn't running already</li> <li>Otherwise, this means the game requested the battle to not game over if lost:<ul> <li>MainManager.<code>battleresult</code> is set to false (the battle was still lost)</li> <li>A ReturnToOverworld coroutine starts</li> </ul> </li> <li><code>forceattack</code> is reset to -1 (there are no valid player party members target anyway)</li> <li><code>mainturn</code> is set to null</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/","title":"GameOver","text":"<p>This is a terminal coroutine that will present the player with the game over screen and a prompt to reload, return to main menu or if allowed, retry or retry with the ability to manipulate the standard items and medals using a mini PauseMenu.</p> <pre><code>private IEnumerator GameOver(bool skipsetup)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#parameters","title":"Parameters","text":"<ul> <li><code>skipsetup</code>: If true, it will skip some setup logic at the start and only show the prompt immediately. This is meant only to be used recursively in an edge case where reloading the save file failed which lets the player remedy the problem before letting GameOver try again, but with less setups. This should NEVER be called with the value true for the first time because it will prevent to change to a terminal flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#procedure","title":"Procedure","text":"<ul> <li><code>alreadyending</code> is set to true. This prevents AddExperience or EventDialogue 19 (The <code>Pitcher</code> enemy spit out event) from switching to a terminal flow</li> <li>ItemList's <code>listredirect</code> is set to -1 (this workarounds a potential inlist issue that can happen as a result of the SetText call later)</li> <li>The SetText string is prepared and it starts with <code>|</code>boxstyle<code>,-1|</code> which renders without a dialogue box. This string will get appended when needed later</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#setup","title":"Setup","text":"<p>This entire section is skipped if skipsetup is true.</p> <ul> <li>All <code>smallexporbs</code> and <code>bigexporbs</code> are destroyed</li> <li><code>action</code> and <code>cancelupdate</code> are set to true changing to a terminal flow</li> <li>RefreshEnemyHP is called</li> <li>SetFlags is called which sets all flags and flagvar to the ones from the StartupData of the <code>sdata</code></li> <li>instance.<code>hudcooldown</code> is set to -1 which hides the HP HUD elements</li> <li>FadeMusic is called with a speed of 0.035</li> <li>A RoundTransition is played via PlayTransition to pure black with a speed of 0.05 and a data of -10 (which is the sortingOrder)</li> <li>A frame is yielded</li> <li>instance.<code>transitionobj[0]</code> z local position is set to 15.0 and its SpriteRenderer's sortingOrder is set to -100</li> <li>2.0 seconds are yielded</li> <li>The <code>cursor</code> is destroyed if it existed</li> <li>If the <code>GameOver</code> sound isn't playing, it is played (as <code>Gameover</code>, but it works still) and the audiosource's volume is set to MainManager.<code>musicvolume</code> which is needed because it is considered a sound instead of a music</li> <li>The SetText string gets the following ammended to it: <code>|</code>boxstyle<code>,-1||</code>center<code>||</code>line<code>||</code>line<code>||</code>line<code>||</code>line<code>||</code>line<code>||</code>halfline<code>||</code>spd<code>,0||</code>color<code>,4||</code>sort<code>,10||</code>fadeletter<code>|</code> followed by <code>menutext[146]</code> (the game over text shown at the top) followed by <code>|</code>fwait<code>,4.5|</code>. This is basically the game over text positioned a bit down using empty lines and fading in for 4.5 seconds</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#settext-call","title":"SetText call","text":"<p>The following and any further section happens regardless of skipsetup.</p> <ul> <li><code>actiontext</code> and <code>hexpcounter</code> are destroyed if they exist</li> <li>The SetText string gets its final append and it depends on the value of <code>canflee</code> (meaning the battle was escapable). To note, <code>menutext[78]</code> only contains <code>|</code>end<code>|</code> because these prompt options are blanks: they don't cause SetText to continue since they will be handled after the call:<ul> <li>If it's true, <code>|</code>prompt<code>,menu,3,2,78,78,135,36,none|</code> is appended</li> <li>If it's false, <code>|</code>prompt<code>,menu,4.5,4,78,78,78,78,134,136,135,36,none|</code> is appended</li> </ul> </li> <li>The SetText call happens in dialogue mode using the final string generated and the following properties:<ul> <li>fonttype of <code>BubblegumSans</code></li> <li>linebreak of <code>messagebreak</code></li> <li>No tidimensional</li> <li>position of MainManager.<code>bubblepos</code> (normally (0.0, 4.15.0, 10.0))</li> <li>No cameraoffset</li> <li>size of Vector2.one</li> <li>No parent</li> <li>No caller</li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#broken-failsafe-logic","title":"Broken failsafe logic","text":"<p>This is where a very broken failsafe logic occurs. See the note block below for details on why this logic should never happen.</p> <p>From there, GameOver will yield all frames for a maximum of 330.0 frames until instance.<code>promptbox</code> exists which is when the prompt appears. This is tracked with a local frame countdown decremented by MainManager.<code>framestep</code> followed by a frame yield on each iteration. If the countdown reaches 0.0 before <code>promptbox</code> exists:</p> <ul> <li><code>gameover</code> is set to a new GameOver call with skipsetup</li> <li>A yield break happens which abruply stops this coroutine</li> </ul> <p>NOTE: This failsafe was supposed to be a workaround to a previous inlist issue, but this did not worked because crucically, it breaks the dialogue mode rule since the message lock will still be grabbed if this failsafe triggers. This means the second GameOver call will allow SetText to process a dialogue mode call WHILE ONE IS ONGOING! This is extremely dangerous because it will lead to 2 SetText calls fighting for each other or even allow player control during a dialogue mode call because one of the prompt option reloads a save. This logic should NEVER trigger under any circumstances otherwise, it will break SetText and general game flow! The original inlist issue has been sucessfully workarounded by setting MainManager.<code>listredirect</code> to -1 earlier so it provides no benefit.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#proper-message-lock-wait","title":"Proper message lock wait","text":"<p>After avoiding the broken failsafe (which happens due to instance.<code>promptbox</code> existing after 4.5 seconds instead of 5.5 seconds) instance.<code>promptbox</code> local z position is set to 10.0.</p> <p>This is followed by all frames being yielded until the message lock gets released. This is a proper and safe wait for the dialogue mode call to finish unlike the broken failsafe above.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#prompt-option-handling","title":"Prompt option handling","text":"<p>The <code>GameOver</code> (as <code>Gameover</code> but it works anyway) sound is stopped with a speed of 0.002.</p> <p>From there, the specific prompt options are handled by checking <code>canflee</code> and instance.<code>option</code>. </p> <p>If you can flee, there's 2 prompt options:</p> <ul> <li>0: Reload save</li> <li>1: Return to main menu (this will reset the whole game and go back to the main menu)</li> </ul> <p>If you can't flee, there's 4 prompt options (2 are common with the can flee case):</p> <ul> <li>0: Retry</li> <li>1: Change loadout and retry (opens a pause menu allowing to manipulate standard items and medals before retrying)</li> <li>2: Reload save</li> <li>3: Return to main menu (this will reset the whole game and go back to the main menu)</li> </ul> <p>The following details what each option's handling does. No matter which one is handled, a frame is yielded at the very end after the option handler is done.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#retry","title":"Retry","text":"<p>This only calls Retry without skipdata.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#change-loadout-and-retry","title":"Change loadout and retry","text":"<ul> <li>ReloadInitialData is called which does the following (mostly loads from the StartUpData):<ul> <li>ApplyBadges is called</li> <li>ApplyStatBonus is called</li> <li>instance.<code>maxtp</code> is set to <code>sdata.maxtp</code></li> <li>instance.<code>tp</code> is set to <code>sdata.tp</code> clamped from 0 to instance.<code>maxtp</code></li> <li>For each player party member:<ul> <li><code>atk</code> is set to the matching <code>sdata.atk</code></li> <li><code>def</code> is set to the matching <code>sdata.def</code></li> <li><code>hp</code> is set to the matching <code>sdata.hp</code> clamped from 0 to the player party member's <code>maxhp</code></li> <li><code>lockitems</code> is set to the matching <code>sdata.partyitemuse</code></li> </ul> </li> <li>instance.<code>items[0]</code> (standard items) is set to <code>sdata.items</code></li> <li>instance.<code>items[1]</code> (key items) is set to <code>sdata.keyitem</code></li> </ul> </li> <li>instance.<code>inbattle</code> is set to false (this is only temporary, but needed to have the correct UI naviguation logic to use the PauseMenu)</li> <li>MainManager.<code>pausemenu</code> is set to a new GameObject named <code>PauseMenu</code> with a PauseMenu component added to it</li> <li>A frame is yielded</li> <li>ApplyBadges is called</li> <li>All frames are yielded while <code>pausemenu</code> exists</li> <li>Retry with skipdata is called</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#reload-save","title":"Reload save","text":"<p>There is a special failsafe that occurs if the existing save file no longer exists for some reasons. Here is what happens in that case:</p> <ul> <li>A frame is yielded</li> <li>A new SetText call happens in dialogue mode with the text being <code>|</code>boxstyle<code>,4||</code>center<code>||</code>halfline<code>||</code>spd<code>,0|</code> followed by <code>menutext[145]</code> which is an error message informing the player of the problem. The call also has these properties:<ul> <li>fonttype of <code>BubblegumSans</code></li> <li>linebreak of <code>messagebreak</code></li> <li>No tidimensional</li> <li>position of Vector3.zero</li> <li>No cameraoffset</li> <li>size of Vector2.one</li> <li>No parent</li> <li>No caller</li> </ul> </li> <li>All frames are yielded while the message lock is grabbed. This allows the player to possibly remedy the problem by moving the save file at the correct location or to load the backup one. Since no end commands was processed here, there will be a <code>waitinput</code> at the end allowing this failsafe to be remediable</li> <li><code>gameover</code> is set to a new GameOver call with skipsetup. This is safe unlike the failsafe because in this case, there are no SetText call running anymore so this will simply present the same prompt and the player is able to try the reload option again. Since this GameOver call finishes shortly after, it essentially transferts complete control to the new one and it allows this cycle to repeat over and over</li> </ul> <p>If the save does exist, the following is done instead:</p> <ul> <li>0.5 seconds are yielded</li> <li>MainManager.ReloadSave is called which does the following:<ul> <li>The <code>CrowdChatter</code> sound is stopped</li> <li>FadeMusic is called with a speed of 0.1</li> <li>All coroutines belonging to MainManager.<code>battle</code> are stopped and <code>battlemap</code> is destroyed</li> <li>All coroutines belonging to MainManager.<code>events</code> (the EventControl) are stopped</li> <li>All player party member's <code>entity</code> are destroyed</li> <li>RenderSettings.skybox is set to null</li> <li>MainManager.<code>map</code> is destroyed</li> <li>Event 22 is started via <code>events</code> without a caller (this is the save loading event)</li> </ul> </li> <li>instance.<code>inbattle</code> is set to false</li> <li>We enter a <code>minipause</code></li> <li><code>pause</code> is set to false</li> <li>This BattleControl is destroyed</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/GameOver/#return-to-main-menu","title":"Return to main menu","text":"<ul> <li>The <code>CrowdChatter</code> sound is stopped</li> <li>0.5 seconds are yielded</li> <li>SceneManager.LoadScene(0) is called which resets the entire game</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/","title":"ReturnToOverworld","text":"<p>This terminal coroutine is the last one invoked to transition out of battle. It is always invoked in a finished battle except for a save reload serving as the last step before the battle is completely ended.</p> <pre><code>public IEnumerator ReturnToOverworld(bool flee)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#parameters","title":"Parameters","text":"<ul> <li><code>flee</code>: Whether or not the battle ended as a result of fleeing</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#procedure","title":"Procedure","text":"<p>The following sections are performed in order.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#fade-out","title":"Fade out","text":"<ul> <li>We enter a <code>minipause</code></li> <li>MainManager.<code>battlenoexp</code> is set to whether or not <code>expreward</code> is exactly 0</li> <li>The <code>switchicon</code>, <code>cancelb</code> and <code>hexpcounter</code> are destroyed</li> <li>A fade out to pure black is done via PlayTransition with a speed of 0.075</li> <li>A frame is yielded</li> <li>All frames are yielded while <code>transitionobj[0]</code>'s SpriteRenderer's alpha hasn't reached 95% opacity or MainManager.<code>musiccoroutine</code> is still in progress</li> <li>0.25 seconds are yielded</li> <li><code>transitionobj[0]</code>'s SpriteRenderer's alpha is set to fully opaque</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#battle-teardown","title":"Battle teardown","text":"<ul> <li>The <code>battlemap</code> is destroyed</li> <li>instance.<code>globalcooldown</code> is set to 30.0 frames</li> <li>A frame is yielded</li> <li>MainManager.<code>map</code> is enabled</li> <li>A frame is yielded</li> <li>For each player party members:<ul> <li>If the player isn't a <code>submarine</code>, their <code>entity</code> is enabled</li> <li>All matching <code>hud</code> elements have their first child local position set to Vector3.zero</li> </ul> </li> <li>If the player is a <code>submarine</code>, the player is enabled</li> <li>If we weren't in a instance.<code>inevent</code>:<ul> <li>MainManager.ResetCamera is called with instant</li> <li>instance.<code>camoffset</code> and instance.<code>camangleoffset</code> are reset to their previous counterpart being <code>oldcamoffset</code> and <code>oldcamrotation</code> respectively</li> </ul> </li> <li>RestoreLimit is called on the <code>map</code> with restoretemp</li> <li>A frame is yielded</li> <li>The <code>fronticon</code> and <code>expholder</code> are destroyed</li> <li>0.1 seconds are yielded</li> <li>instance.<code>camspeed</code> is reset to its previous counterpart being <code>oldcamspeed</code></li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#overworld-setup","title":"Overworld setup","text":"<ul> <li>MainManager.<code>battlefled</code> is set to the sent flee value</li> <li>MainManager.player.entity.<code>onground</code> is set to false</li> </ul> <p>The rest has multiple possibilities on how to setup the overworld, but they are mutually exclusive, only the first one mentioned applies. It is possible none applies.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#flee-is-true","title":"Flee is true","text":"<p>This means the battle ended due to the player fleeing:</p> <ul> <li>MainManager.player.entity.<code>icooldown</code> is set to 120.0 frames of invicibility</li> <li>If the <code>caller</code> exists, some adjustements needs to happen on it (it implies the <code>caller</code> is an Enemy NPCControl):<ul> <li>STOP is called on the <code>caller</code> which does the following if the <code>caller.entity</code> isn't <code>dead</code>:<ul> <li>Stop <code>behaviorroutine</code> if it was in progress and set it to null</li> <li>Set <code>forcebehavior</code> to null and call StopForceBehavior</li> <li>Call StopForceMove on the entity</li> <li>Set the entity.<code>overrideflip</code> and entity.<code>overrideonlyflip</code> to false</li> <li>Set <code>attacking</code> to false</li> </ul> </li> <li><code>caller.entity.overrideanim</code> is set to false</li> <li><code>caller.entity.overrideflip</code> is set to false</li> <li><code>caller.entity.onground</code> is set to false</li> <li>If the <code>caller</code>'s regionalflag isn't negative, the slot value is set to false</li> <li>If the <code>caller</code>'s activationflag isn't negative, the slot value is set to false</li> <li>All collisions between the <code>caller.entity.ccol</code> and the player.entity.<code>ccol</code> are ignored    </li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#flee-is-false-and-the-caller-exists","title":"Flee is false and the <code>caller</code> exists","text":"<p>This means the battle ended without fleeing and it was caused by an Enemy NPCControl encounter:</p> <ul> <li>MainManager.player.entity.<code>icooldown</code> is set to 120.0 frames of invicibility</li> <li><code>caller.entity.onground</code> is set to false</li> <li><code>callet.entity.rigid</code> velocity is zeroed out</li> <li>The <code>caller</code> transform position is set to its <code>lastpos</code> (this was set by NPCControl.StartBattle so the positions is restored to the one before the battle started)</li> <li><code>caller.attacking</code> is set to false</li> <li>If <code>expreward</code> is 0, <code>enemyfled</code> is true and instance.<code>lastdefeated</code> doesn't contain a <code>GoldenSeedling</code> enemy:<ul> <li>MainManager.<code>battleenemyfled</code> is set to true</li> <li><code>caller</code> is disabled</li> </ul> </li> <li>Otherwise, if the <code>caller.entity.deathcoroutine</code> isn't in progress:<ul> <li><code>caller.entity.deathcoroutine</code> is set to a new Death call with activatekill on the <code>caller</code>.entity</li> <li>If the <code>Death0</code> wasn't playing or it was past the halfway point, it is played at 0.6 volume</li> <li><code>caller.entity.spitmoney</code> is set to <code>moneyreward</code>, but it can get multipliers depending on some conditions (these multipliers aren't mutually exclusive, they can stack):<ul> <li><code>DoublePainReal</code> medal is equipped: 2x</li> <li>flags 613 is true (RUIGEE is active): 2x</li> <li><code>BerryFinder</code> medal is equipped: 1.25x</li> <li><code>EXPBoost</code> medal is equipped while flags 613 is true (RUIGEE is active): 1.25x</li> </ul> </li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#flee-is-false-enemyfled-is-true-and-expreward-is-0","title":"Flee is false, <code>enemyfled</code> is true and <code>expreward</code> is 0","text":"<p>The only thing that happens here is MainManager.<code>battleenemyfled</code> is set to true</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#other-teardown","title":"Other teardown","text":"<ul> <li>A frame is yielded</li> <li>instance.<code>inbattle</code> is set to false</li> <li>ItemList's <code>listredirect</code> is set to -1 (this workarounds potential inlist issues)</li> <li>player.entity.<code>hitwall</code> is set to false</li> <li>CancelAction is called on the player</li> <li>RefreshEntities is called with forceanim and refreshmap</li> <li>instance.<code>showmoney</code> and instance.<code>hudcooldown</code> are set to 0.0 (this hides all HUD elements)</li> <li>All GameObjects with tag <code>DelAftBtl</code> or <code>Projectile</code> are destroyed</li> <li>The <code>dimmer</code> is destroyed</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#fade-in","title":"Fade in","text":"<p>The logic here depends on instance.<code>inevent</code>.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#we-werent-in-an-event","title":"We weren't in an event","text":"<ul> <li>If <code>music[0]</code> exists:<ul> <li>If <code>overworldmusic</code> exists and its name isn't the <code>music[0]</code>'s name, <code>music[0]</code>.volume is set to 0.0</li> <li>If <code>music[0]</code>.name is <code>LevelUp</code> and <code>map.nobattlemusic</code> is true, ChangeMusic is called which will change the music to either silence or to <code>map.music[map.musicid]</code> if it exists</li> </ul> </li> <li>A frame is yielded</li> <li>If MainManager.<code>keepmusicafterbattle</code> is true, MainManager.<code>musicresume</code> is set to <code>overmusic</code></li> <li>ChangeMusic is called with the <code>overworldmusic</code>. NOTE: It can mean ChangeMusic is called twice, but the second one will stop the first via a StopCoroutine</li> <li>MainCamera's parent angles are set to instance.<code>camangleoffset</code></li> <li>A frame is yielded</li> <li>A fade in from pure black is performed via PlayTransition with a speed of 0.05 which undoes the fade earlier</li> <li>We exit the <code>minipause</code></li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#we-were-in-an-event","title":"We were in an event","text":"<ul> <li>If <code>keepmusic</code> is false, ChangeMusic is called to silence with a fadespeed of 0.075</li> <li>ResetEntitySpeed is called which sets all <code>map.entitities</code> and all player party members's entity <code>anim</code>.speed to 1.0</li> </ul> <p>This implies that events are responsible for doing the fade in themselves as well as the other logic mentioned above in the non event case.</p>"},{"location":"Battle%20system/Battle%20flow/Terminal%20coroutines/ReturnToOverworld/#final-cleanup","title":"Final cleanup","text":"<ul> <li><code>actiontext</code> is destroyed</li> <li>ForceHitWall is invoked on the player.entity in 0.2 seconds which will set its <code>hitwall</code> to false</li> <li>Every player party members with an <code>hp</code> of 0 has their <code>hp</code> set to 1</li> <li>CheckAchievement is invoked on the instance in 0.5 seconds</li> <li>This BattleControl is destroyed, the battle is now completely over and it cease to exist</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20wrappers/EndBattleWon/","title":"EndBattleWon","text":"<p>This method is a wrapper around AddExperience that is mainly used for EventDialogues to end the battle in a win.</p> <pre><code>private void EndBattleWon(bool addexp, int[] skipids)\n</code></pre>"},{"location":"Battle%20system/Battle%20flow/Terminal%20wrappers/EndBattleWon/#parameters","title":"Parameters","text":"<ul> <li><code>addexp</code>: Whether the <code>exp</code> of every remanining enemy party members should be added to <code>expreward</code></li> <li><code>skipids</code>: If <code>addexp</code> is true, the list of enemy party members index to not have their <code>exp</code> added to <code>expreward</code>. This is ignored if <code>addexp</code> is false</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20wrappers/EndBattleWon/#procedure","title":"Procedure","text":"<ul> <li>If addexp is true, all enemy party members's <code>exp</code> except the ones whose index is in <code>skipids</code> are added to <code>expreward</code> followed by a RefreshEXP call</li> <li><code>enemydata</code> is reset to a new empty array</li> <li><code>cancelupdate</code> is set to true changing to a terminal flow (but it will already be changed to it anyway right after)</li> <li>An AddExperience call starts which also makes sure to be in a terminal flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Terminal%20wrappers/ExitBattle/","title":"ExitBattle","text":"<p>This method is a wrapper around the ReturnToOverWorld terminal coroutine. It is primarily used as part of EventDialogues and is also the last step of AddExperience.</p> <ul> <li>ReturnToOverWorld is called</li> <li><code>cancelupdate</code> is set to true changing to a Terminal flow</li> <li><code>enemy</code> is set to false which normally makes the flow go to the player phase, but we just changed to a terminal flow so nothing will happen</li> <li><code>action</code> is set to true, but not only ReturnToOverworld already did that, this doesn't do anything because we are in a terminal flow</li> </ul>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/","title":"Controlled flow","text":"<p>This is one of the flow of Update which is the default flow that hapens when the other aren't happening where Update has complete control over the battle and acts as a dispatcher.</p> <p>It features complete control of the system by the Update event and features the full logic of the battle system. Eventually, this flow will delegate control to an action coroutine which will change to an uncontrolled flow while the coroutine handles whatever needs to be done.</p> <p>As part of this flow, everything from the uncontrolled flow except GetBlock is included with more logic.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#pre-turn-update","title":"Pre turn update","text":"<p>The following sections covers everything that happens before an actual main turn is processed. This means everything here gets processed regardless of where in the turn we are in.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#refreshexp","title":"RefreshEXP","text":"<p>If the <code>oldexp</code> value doesn't match the current <code>expreward</code>, RefreshEXP is called. This method manages the visual rendering of the currently cumulated EXP and the different orbs that composes it. <code>expreward</code> is the actual EXP cumulated so far while <code>oldexp</code> is the last value observed since the last RefreshEXP. It will also create <code>expholder</code> if it wasn't created already.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#hp-ui-refresh","title":"HP UI refresh","text":"<p>RefreshEnemyHP is called every 3 frames.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#updateswitchicon","title":"UpdateSwitchIcon","text":"<p>UpdateSwitchIcon is called. It only applies if the <code>switchicon</code> exists.</p> <p>The <code>switchicon</code> is enabled when all of the following conditions are true (on top of being in this battle flow, it is disabled otherwise):</p> <ul> <li>There are more than 1 <code>availableplayers</code></li> <li><code>enemy</code> is false (we are during the player phase of the turn)</li> <li><code>inevent</code> is false (we aren't in an EventDialogue)</li> <li>The message lock is released (covers cases like tattling)</li> <li><code>currentaction</code> is <code>BaseAction</code> (the main vine action menu)</li> </ul> <p>If it gets disabled, it is placed offscreen by setting the local position to (0.0, 99.0, 0.0).</p> <p>If it gets enabled instead, the local y and z position are set to 4.25 and 5.0 respectively, For the x, it's -7.0 + 3.625 * the length of <code>playerdata</code>, but if <code>longcancel</code> is true, 0.3 is added to this.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#checkevent","title":"CheckEvent","text":"<p>This method will check for any special conditions happening and if one occurs, it will result in some logic, frequently involving an EventDialogue starting.</p> <p>Nothing happens here if <code>enemydata</code> is empty.</p> <p>Here is a list of the conditions and what happens with them (only the first one takes effect):</p> <ul> <li><code>calleventnext</code> is not negative: EventDialogue is called with the value of <code>calleventnext</code> followed by the value being set to -1. This is only used for the eventonfall feature of enemies</li> <li>flags 15 is false (combat tutorial hasn't been given yet): multiplie events can occur with an additional condition:<ul> <li>flagvar 11 is 0: EventDialogue 0 is started</li> <li>flagvar 11 is 2: EventDialogue 2 is started</li> <li>flagvar 11 is 3 and <code>turns</code> is 3: ExitBattle is called which start a ReturnToOverworld without flee, set <code>cancelupdate</code> and <code>action</code> to true and <code>enemy</code> to false which also changes the flow to a terminal one</li> </ul> </li> <li>The first <code>enemydata</code> has an <code>animid</code> (an enemy id) of <code>Spuder</code> and flag 27 is false (haven't gotten past the cutscene of meeting Leif yet), some logic occurs:<ul> <li>The <code>Spuder</code> enemy gets their <code>hp</code> set to 999 and <code>def</code> to 99</li> <li>If the <code>Spuder</code> enemy didn't had a weakness of <code>AntiPierce</code>, it is added to weakness</li> <li>If <code>turns</code> is 2 and flagvar 11 is 0, EventDialogue 4 is started</li> <li>Otherwise, if <code>turns</code> is 3 and flagvar 11 is 1, ExitBattle is called which will change to a terminal flow</li> <li>Otherwise, if <code>turns</code> % 2 is 0 while being above 0 and flagvar 11 is 2, EventDialogue 5 is started</li> </ul> </li> <li>flag 16 is true (Leif can fight in battle) and flag 24 is false (haven't received the Relay tutorial yet), EventDialogue 3 is started</li> <li>EventDialogue 7 is started followed by flagvar 11 being set to 200 when all of the following are true:<ul> <li>flag 37 is false (using the B.O.S.S system in EX mode)</li> <li>flagvar 11 is below 200, flag 27 is true (got past the cutscene of meeting Leif for the first time)</li> <li>The first <code>enemydata</code> has an <code>animid</code> (an enemy id) of <code>Spuder</code> with an <code>hp</code> below half of its <code>maxhp</code> floored, but above 0</li> <li>GetFreePlayerAmmount returns 0</li> </ul> </li> <li>EventDialogue 8 is started followed by flagvar 11 being set to 150 when all of the following are true:<ul> <li>flag 37 is false (using the B.O.S.S system in EX mode)</li> <li>flagvar 11 is below 150, flag 27 is true (got past the cutscene of meeting Leif for the first time)</li> <li>The first <code>enemydata</code> has an <code>animid</code> (an enemy id) of <code>Spuder</code></li> <li><code>turns</code> is 0</li> </ul> </li> </ul>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#exp-counter-updates","title":"EXP counter updates","text":"<p>The first time this section run, <code>hexpcounter</code> wouldn't exist yet so it will get created by doing the following:</p> <ul> <li><code>hexpcounter</code> is set to a new UI object named <code>expcounter</code> with tag <code>DelAftBtl</code> (destroyed on ReturnToOverworld) childed to the <code>GUICamera</code> with position (7.4, -6.5, 10.0) with size (0.5, 0.6, 1.0) using <code>guisprites[4]</code> (a HUD backgrond strip) and sortingOrder of 10</li> <li>The color of the SpriteRenderer of <code>hexpcounter</code> is set to instance.<code>charcolor[0]</code> (hardcoded to be pure yellow)</li> <li>A new UI object is created called <code>icon</code> childed to <code>hexpcounter</code> with position (-2.5, 0.0, 0.0) with size (1.25, 1.0, 1.0) using <code>guisprites[27]</code> (the EXP icon) and sortingOrder being 1 over the <code>hexpcounter</code>'s (11)</li> <li>SetText is called in non dialogue mode:<ul> <li>text: <code>|</code>font<code>,2||</code>sort<code>,20||</code>color<code>,4|</code> + instance.<code>partyexp</code> padded with 2 <code>0</code> + <code>/|</code>size<code>,0.8|</code> + instance.<code>neededexp</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>No linebreak</li> <li>No tridimensional</li> <li>position: (-1.2, -0.3, 0.0)</li> <li>No cameraoffset</li> <li>size: Vector3.one</li> <li>parent: <code>hexpcounter</code></li> <li>no caller</li> </ul> </li> <li>The second child of <code>hexpcounter</code> (the SetText holder object from the call above) scale is set to (1.75, 1.75, 1.0)</li> </ul> <p>From there, this section is done, but the logic will change on further updates since <code>hexpcounter</code> now exists.</p> <p>Basically, the game will manage the <code>idletimer</code> field which will control the positioning of the <code>hexpcounter</code> and the <code>expholder</code>. The <code>idletimer</code> is reset to 0 constantly until the currentaction becomes <code>BaseAction</code> (the main vine menu). When that happens, it will get incremented once on this cycle until it reaches 250.</p> <p>What will happen from there is the <code>hexpcounter</code> local posiiton will be set to a lerp from the existing one to (7.4, -6.5, 10.0) if the <code>idletimer</code> hasn't reached 200 or to (7.4, -4.4, 10.0) if it reached it. All with a factor of a 1/10 of the game's frametime in either case. This essentially will hide the counter offscreen at the bottom until at least 200 frames passed when the player was naviguating the main vine action menu where it will smoothly reveal itself.</p> <p>If the <code>expholder</code> still exists, its x local position gets set to 0.0 if <code>idletimer</code> hasn't reached 200 yet or to -3.25 if it did. This moves the orbs to the left when the <code>hexpcounter</code> is shown so they don't overlap.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#enemies-hitaction","title":"Enemies hitaction","text":"<p><code>hitaction</code> is a field on BattleData that tells if an enemy wants to perform an action immediately on the next controlled update. These actions are performed out of the main turn flow because they are ran during the player phase. It's essentially a way for an enemy to temporarilly seize control of the turn flow to perform their action. This section handles these.</p> <p>All <code>enemydata</code> elements are checked if any has <code>hitaction</code> set to true. If none do, nothing happens. For each that does have it set to true, the following happens:</p> <ul> <li>If the enemy IsStopped returns true (without actimmobile check), their <code>hitaction</code> gets set to false and nothing happens as it gets skipped</li> <li>Otherwise, <code>enemy</code> is set to true and a DoAction call occur with the battleentity with actionid being the <code>enemydata</code> index. This will also end the update cycle</li> </ul> <p>For more information on how this works, check the hitaction documentation.</p> <p>This cycle repeats for all applicable enemies untill all <code>hitaction</code> are set to false at which point, the main turn procedure can continue.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#gui-cooldown","title":"GUI cooldown","text":"<p>This only decreases <code>guicooldown</code> by the game's frametime if it hasn't expired yet. However, this cooldown isn't actually used anywhere making this dead logic.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Controlled%20flow/#main-turn-procedure","title":"Main turn procedure","text":"<p>This is where the main turn logic happens.</p> <p>This procedure is documented in the main turn life cyle document.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Terminal%20flow/","title":"Terminal flow","text":"<p>This is one of the flow of Update which only happens if the battle is about to end or retried.</p> <p>This flow happens if <code>cancelupdate</code> is true or instance.<code>pausemenu</code> exists.</p> <p>The former is only set to true when some kind of terminal coroutine occurs (such as a game over) where we know the battle will end in some ways (but it may be retried). The latter only happens after selecting the change loadout and retry option after a game over which brings up a cut down pause menu.</p> <p>In this flow, absolutely no update logic occurs. The flow is completely controlled by whichever coroutine set <code>cancelupdate</code> or the PauseMenu. This flow is only entered in terminal cases where we know for sure the battle will end or retried.</p> <p>It is also possible to enter this flow by setting instance.<code>inbattle</code> to false which happens when we know the battle will end without retry, but this alone won't technically be the same without setting <code>cancelupdate</code> to true. Doing this will still allow RefreshEXP calls that normally happens in the other 2 flows only. However, because they only happen if <code>oldexp</code> doesn't match <code>expreward</code>, it ends up not mattering because no EXP can be gained in any terminal cases (since the battle is already scheduled to end in some ways). It should be noted that the only terminal case where this happens while <code>cancelupdate</code> remains false is a sucessfull flee attempt.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Uncontrolled%20flow/","title":"Uncontrolled flow","text":"<p>This is one of the flow of Update which happens when Update delegates most controls to an action coroutine.</p> <p>This flow happens if <code>action</code> or <code>inevent</code> is true which means that an action coroutine or an EventDialogue took control of the battle flow. This means that Update relegated its control and it features a very reduced logic compared to a controlled flow. It is meant to be entered temporarily where control will eventually be given back to a controlled flow with the exception of terminal cases which ends or retries the battle.</p> <p>The main feature of this flow is less UI being shown as they are mostly disabled.</p> <p>Here are all the logic included in this flow.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Uncontrolled%20flow/#refreshexp","title":"RefreshEXP","text":"<p>If the <code>oldexp</code> value doesn't match the current <code>expreward</code>, RefreshEXP is called. This method manages the visual rendering of the currently cumulated EXP and the different orbs that composes it. <code>expreward</code> is the actual EXP cumulated so far while <code>oldexp</code> is the last value observed since the last RefreshEXP. It will also create <code>expholder</code> if it wasn't created already.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Uncontrolled%20flow/#hp-ui-refresh","title":"HP UI refresh","text":"<p>RefreshEnemyHP is called every 3 frames. It should be noted that in this flow, this will always results in the <code>hpbar</code> of the enemies to be disabled. This means this refresh is less useful here, but it's more useful in a controlled flow.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Uncontrolled%20flow/#updateswitchicon","title":"UpdateSwitchIcon","text":"<p>UpdateSwitchIcon is called. It should be noted that in this flow, this will always results in the <code>switchicon</code> to be disabled. This means this refresh is less useful here, but it's more useful in a controlled flow.</p>"},{"location":"Battle%20system/Battle%20flow/Update%20flows/Uncontrolled%20flow/#blocking-updates","title":"Blocking updates","text":"<p>This section happens only when all the following are fufilled:</p> <ul> <li><code>enemy</code> is true (we are in the player phase)</li> <li><code>inevent</code> is false (no EventDialogue is in progress)</li> <li>The message lock is released (covers cases like Tattle)</li> </ul> <p>GetBlock is called here which updates <code>blockcooldown</code> and <code>commandsuccess</code> according to the current blocking state. Consult the GetBlock documentation to learn more about how the blocking system works.</p> <p>This is the only logic that is exclusive to an uncontrolled flow.</p>"},{"location":"Battle%20system/Damage%20pipeline/AttackProperty/","title":"AttackProperty","text":"<p>An AttackProperty is a parameter of DoDamage and they are also the elements allowed in the weakness field of BattleData (meant for enemy party members only). They influence the damage pipeline in various ways either at the specific call level when passed as a parameter to DoDamage or at the target level for an enemy party member's <code>weakness</code>. They mainly influence CalculateBaseDamage's logic.</p> <p>They are not to be confused with DamageOverride which can only be sent to DoDamage as an array of them and have very different logic changes.</p> <p>Here are the different AttackProperty, how they are meant to be passed to the damage pipeline and a summary of their effects.</p> Value Name DoDamage parameter? <code>weakness</code>? Description 0 Pierce Yes No Ignores all calculations related to defense in CalculateBaseDamage. Only valid for enemy party member targets that do not have <code>AntiPierce</code> in their <code>weakness</code> 1 Flip Yes Yes When used as a DoDamage parameter, 1 point of defense in CalculateBaseDamage will be ignored when the target doesn't have the Flipped condition (this is done incorrectly, see the CalculateBaseDamage documentation to learn more). It will also attempt to inflict the <code>Flipped</code> condition if the target has this property in its <code>weakness</code> and some other conditions are fufilled. It will also bypass defenseonhit and prevent <code>isdefending</code> from being set to true (it can even break the guard) 2 Freeze Yes No Attempts to inflict the Freeze condition during CalculateBaseDamage 3 Poison Yes No Attempts to inflict the Poison condition during CalculateBaseDamage 4 Numb Yes No Attempts to inflict the Numb condition during CalculateBaseDamage 5 Sleep Yes No Attempts to inflict the Sleep condition during CalculateBaseDamage 6 AntiPierce No Yes Prevents the <code>Pierce</code> property to have any effect during CalculateBaseDamage (only the <code>Spuder</code> enemy can get it via CheckEvent when applicable) 7 ToppleFirst No Yes The enemy party member will receive the Topple condition when it is damaged first before falling or getting the Flipped condition during CalculateBaseDamage. It acts as defensive mechanism to enemy party members where they would have fell or flipped immediately if they didn't feature this <code>weakness</code> 8 Magic Yes Yes When used an enemy party member's <code>weakness</code>, it will allow a magic weakness to be processed in CalculateBaseDamage when property is also <code>Magic</code> or when the attacker is a player party member while <code>lastskill</code> is <code>Icefall</code>, <code>FrigidCoffin</code> or <code>IceRain</code> skill alongside some other conditions 9 ToppleAirOnly No Yes The same as <code>ToppleFirst</code>, but only applicable when the enemy party member's position is <code>Flying</code> 10 Atleast1 Yes No Clamps the damage amount from 1 towards the end of CalculateBaseDamage unless the target has <code>LimitX10</code> in its <code>weakness</code> where 10 is subtracted from the amount instead 11 Atleast1pierce Yes No Combines the effects of <code>Pierce</code> and <code>Atleast1</code> 12 LimitX10 No Yes Gives ? defense logic to the enemy party member which CalculateBaseDamage processes towards the end where the amount is first subtracted by 10 if property is <code>Atleast1</code> or <code>Atleast1pierce</code> and then set to 0 if it was &lt;= 1 or divided by 10 ceiled if it was above 1 13 NoExceptions Yes No Ignores many, but not all logic in CalculateBaseDamage. If the target is invulnerable according to DoDamage, the damage dealt will be the ammount sent 14 None Yes No No property applies, the same as sending null. DoDamage will override this to null when passing it to CalculateBaseDamage 15 HornExtraDamage No Yes Process a +1 damage bonus when dealing damages to the enemy party member if property is <code>Flip</code> with weaknesshit 16 MinusMagic No No UNUSED 17 DieInOneHit No Yes The enemy party member's <code>hp</code> is set to 0 on DoDamage, killing him in one hit 18 SurviveWith10 No Yes The final target's <code>hp</code> is clamped from 10 except if <code>lastskill</code> is 9 (<code>PeebleToss</code>) skill 19 FlyOnFlip No Yes The enemy party member's position is changed to <code>Flying</code> if the property of the attack is <code>Flip</code> and the enemy party member's <code>position</code> was <code>Ground</code> 20 Fire Yes No Attempts to inflict the Fire condition during CalculateBaseDamage 21 MultiHitDefense No No UNUSED 22 DefDownOnBlock Yes No Inflicts the DefenseDown condition on the target when they are still alive and don't have the Shield condition 23 DefDownOnFlyHard No Yes Grant a +1 damage bonus if the target's position is <code>Flying</code> and HardMode returns true (This is specific to a <code>VenusBoss</code> enemy) 24 Ink Yes No Attempts to inflict the Inked condition during CalculateBaseDamage 25 AtkDownOnBlock Yes No Inflicts the AttackDown condition on the target when they are still alive and don't have the Shield condition 26 Sticky Yes No Attempts to inflict the Sticky condition during CalculateBaseDamage 27 InkOnBlock Yes No The same then <code>Ink</code>, but the infliction can still occur even if the player sucessfully blocked 28 AlwaysSurvive No Yes The final target's <code>hp</code> is clamped from 1 29 Numb1Turn Yes No The same as <code>Numb</code>, but the infliction is always for 1 turn regardless if it's a <code>chompyaction</code> or not"},{"location":"Battle%20system/Damage%20pipeline/BasicAttack/","title":"BasicAttack","text":"<p>A coroutine made for enemy actions that ends up calling DoDamage from an enemy attacker to a single player party member, but with the ability to configure a simple attack animation logic. The animation involved them moving towards the player party member and then attacking with some animstate changes. This is meant to be used for enemy actions with simple attack animations.</p> <p>It is meant to set <code>checkingdead</code> to the coroutine which will becomes null upon completion of the coroutine allowing the caller on yield on it.</p> <pre><code>private IEnumerator BasicAttack(int enemyid, int walkstate, int attackstate, int attackstate2, int damage, Vector3 offset, AttackProperty? property, float shake, float delay, string sounds, bool dontgettarget)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/BasicAttack/#parameters","title":"Parameters","text":"<ul> <li><code>enemyid</code>: The <code>enemydata</code> index of the enemy party member who is going to be the attacker in the DoDamage call. It is not possible to specify a null attacker</li> <li><code>walkstate</code>: The walkstate of the MoveTowards before the DoDamage call</li> <li><code>attackstate</code>: The stopstate of the MoveTowards before the DoDamage call</li> <li><code>attackstate2</code>: The animstate to set the enemy party member right before the DoDamage call happens</li> <li><code>damage</code>: The damageammount to send to the DoDamage call</li> <li><code>offset</code>: The offset to apply to the <code>playertargetentity</code> position as the destination of the MoveTowards call</li> <li><code>property</code>: The property to send to the DoDamage call</li> <li><code>shake</code>: If it is above 0.0, the intensity of a ShakeSprite call to do on the enemy party member after they moved. If it's 0.0 or lower, the call doesn't happen</li> <li><code>delay</code>: The time in seconds to yield for right before the DoDamage call, but after the movement. It also specify 1/60th of the frametimer of the ShakeSprite call if <code>shake</code> is above 0.0</li> <li><code>sounds</code>: Specify the sounds to play before the yield and after the yield. 4 formats of this value are possible:<ul> <li>null or empty string: no sounds are played before and after the yield</li> <li>A non empty string without any <code>,</code> or a string that ends with <code>,</code>: The string without any <code>,</code> represents the name of the AudioClip under <code>Audio/Sounds/</code> from the ressources tree to play before the yield, but no sound will be played after the yield</li> <li>A non empty string beginning with <code>,</code>: The string without any <code>,</code> represents the name of the AudioClip under <code>Audio/Sounds/</code> from the ressources tree to play after the yield, but no sound will be played before the yield</li> <li>A non empty string with a <code>,</code> in the middle: The portion of the string before the <code>,</code> represents the name of the AudioClip under <code>Audio/Sounds/</code> from the ressources tree to play before the yield and the portion after the <code>,</code> represents the same, but played after the yield </li> </ul> </li> <li><code>dontgettarget</code>: If true, GetSingleTarget won't be called. This is meant to only be used if it was called already by the caller as this coroutine will call it if the value is false</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/BasicAttack/#procedure","title":"Procedure","text":"<ul> <li>If dontgettarget is false, GetSingleTarget is called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>enemydata[enemyid]</code> MoveTowards <code>playertargetentity</code> position + offset with a 2.0 multiplier, a walkstate of the sent value and a stopstate of attackstate</li> <li>Yield all frames until the <code>forcemove</code> of the enemy party member is done</li> <li>If shake is above 0.0, ShakeSprite is called on <code>enemydata[enemyid]</code> with an intensity of shake and a frametimer of delay * 60.0</li> <li>If sounds has a before yield sound in its value, it is played</li> <li>Yield for delay seconds</li> <li>If sounds has an after yield sound in its value, it is played</li> <li>The enemy party member animstate is set to attackstate2</li> <li>DoDamage is called with the attacker, target, damage and property leaving block as <code>commandsuccess</code> and overrides as null</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to null which informs the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/","title":"CalculateBaseDamage","text":"<p>This is a method that contains all the damage calculation logic and returns the final amount calculated from the base one given the battle's state. Every damages that goes through the damage pipeline ends up calling this to get the final amount of damage to deal with the exception of the target being invulnerable which are any of the following conditions on the target:</p> <ul> <li>Its <code>plating</code> is true</li> <li>It has the Shield condition</li> <li>It is a player party member with the Numb condition and the <code>ShockTrooper</code> medal equipped</li> </ul> <p>There is no other damage calculation logic in the pipeline with the only exception being the clamping done on DoDamage after getting the final number. Every other logic involves other matters after the damage has been calculated by this method. Alternatively, actions's logic can perform anything outside of this pipeline.</p> <pre><code>private int CalculateBaseDamage(MainManager.BattleData? attacker, ref MainManager.BattleData target, int basevalue, bool block, AttackProperty? property, ref bool weaknesshit, ref bool superguarded, DamageOverride[] overrides)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#parameters","title":"Parameters","text":"<p>All parameters comes directly from DoDamage (the damageammount becomes the basevalue) with some exceptions:</p> <ul> <li><code>block</code>: This may be overriden to false by DoDamage If any of the following are true:<ul> <li>The target has the Freeze condition</li> <li>The target has the Sleep condition</li> <li>The target has the Numb condition</li> <li>The target is a player party member with the <code>Berserker</code> medal equipped</li> <li>This is a non super block while flags 15 and 615 are true (chapter 1 started after the combat tutorial while FRAMEONE is active) and <code>overridechallengeblock</code> is false</li> </ul> </li> <li>ref <code>weaknesshit</code>: This is meant to initially contain false, the method will set this to true if a <code>Magic</code> or <code>Flip</code> weakness was processed</li> <li>ref <code>superguarded</code>: This is meant to initially contain false, the method will set this to true if the player sucessfully super blocked</li> <li><code>property</code>: The property of the attack sent by DoDamage (overriden to null is if it was <code>None</code> by DoDamage). If this is <code>Pierce</code> or <code>Flip</code> while the <code>target</code> is a player party member, it is overriden to null at the start of this method which invalidates it</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#damage-flow","title":"Damage flow","text":"<p>While the attacker is optional (null means no attacker), the target is mandatory. Additionally, the target cannot be part of the same party as the attacker. This means an enemy party member cannot attack another enemy party member and a player party member cannot attack another player party member. This results in the following damage flows available:</p> <ul> <li>No attacker to player party member</li> <li>No attacker to enemy party member</li> <li>Player party member to enemy party member</li> <li>Enemy party member to player party member</li> </ul> <p>Each have different implications on the calculations. It is assumed that the target is a player party member if it has the <code>Player</code> tag. Otherwise, it is assumed to be an enemy party member. If the attacker exists, it is assumed to be the opposite party of the target.</p> <p>basevalue is the damage amount that will ultimately be returned. This method may modify it for various reasons until it reaches the end where it becomes final.</p>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#piercing","title":"Piercing","text":"<p>There is a concept of piercing which ignores all effects related to enemy party members's defense. Despite the concept of defense having multiple calculation errors, piercing correctly and exhaustively ignores all components of defense.</p> <p>In order for piercing to apply, the following must all be true:</p> <ul> <li>The target is an enemy party member (this is specifically disabled for player party members)</li> <li>The target doesn't have <code>AntiPierce</code> in its weakness (only the <code>Spuder</code> enemy can get it via CheckEvent when applicable)</li> <li>property is <code>Atleast1pierce</code> or <code>Pierce</code> (the former is the same as the latter, but the final clamp will be from 1 instead of 0 for any cases not counting a <code>FrostBite</code> medal counter)</li> </ul> <p>If the above isn't fufilled, piercing doesn't apply.</p>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#calculation-pipeline-table","title":"Calculation pipeline table","text":"<p>The calculation pipeline is very complex and most of it will be illustrated by a table.</p> <p>Each rows of the table contains an effect to basevalue or other additional effects when applicable. Each row contains 3 columns:</p> <ul> <li>Attack direction: The damage flow denoted in party to party notation. Here's the party defintions:<ul> <li>Any: For the attacker, it may or may not exist from either party. For the target, it can belong to either party</li> <li>Attacker: The attacker must exist, but can be in either party</li> <li>Player: The attacker or target must be a player party member</li> <li>Enemy: The attacker or target must be an enemy player member</li> </ul> </li> <li>Condition: The conditions required for this effect to process. If a list is presented, all conditions must be true unless stated otherwise</li> <li>Damage effect: The effects on basevalue if Condition is true. This may contain other effects than changing basevalue. Anything underlined means it's an effect other than increasing or decreasing meaning it's more significant and its position in the calculation is important</li> </ul> <p>These effects are shown in the exact order they appear.</p> Attack direction Condition Damage effect Enemy to player Attacker is a <code>TANGYBUG</code> enemy + 2 Attacker to Any Always processed - attacker.<code>tired</code> Player to enemy <ul><li>Not in <code>demomode</code></li><li>attacker is <code>partypointer[0]</code> (at the front of formation)</li></ul> + 1 Player to enemy <ul><li>Not in <code>demomode</code></li><li>attacker has the Poison condition</li></ul> + amount of attacker's <code>PoisonAttacker</code> medals Player to enemy <ul><li>Not in <code>demomode</code></li><li>attacker.<code>hp</code> &lt;= 4</li></ul> + amount of attacker's <code>AttackUp</code> medals Enemy to player <ul><li>Not in <code>demomode</code></li><li>flags 614 and 88 are true (HARDEST is active after chapter 2 ended)</li></ul> + 1 Enemy to player Not in <code>demomode</code> + attacker.<code>hardatk</code> (the scaled attack from GetEnemyData) Enemy to player <ul><li>Not in <code>demomode</code></li><li><code>DoublePainReal</code> medal is equipped</li></ul> Clamped from 2 to 99 Attacker to any Always processed + attacker.<code>charge</code> Any to player block is true OR <code>superblockedthisframe</code> hasn't expired yet Decreased by:<ul><li>1 if it's a non super block</li><li>2 + amount of attacker's <code>SuperBlock</code> medals if it's a super block<sup>1</sup></li></ul> Enemy to player <ul><li>Target has Freeze condition</li><li>No <code>NoIceBreak</code> override AND (first that applies of the 3 below)</li></ul> Ice thaw<sup>2</sup> (after the sub effect is processed, doesn't change basevalue) - <ul><li>target has a <code>FrostBite</code> medal</li><li><code>nonphyscal</code> is false</li><li>attacker.position isn't <code>Underground</code></li></ul> A Freeze condition is added as a delayed condition to the attacker AND a counter of the full damage to the attacker is scheduled (see the final results explanation below for details) - <ul><li>target has a <code>FrostBite</code> medal</li><li>The counter effect above didn't apply</li></ul> Divided by 2 floored - target has no <code>FrostBite</code> medal + 1 Any to Any <ul><li>target has the Numb condition</li><li>target doesn't have the the DefenseDown condition. NOTE: this is incorrect<sup>5</sup></li><li>property isn't <code>Flip</code>. NOTE: This is incorrect<sup>7</sup></li><li>there is no <code>IgnoreNumb</code> in the overrides</li><li>piercing doesn't apply</li></ul> - 1 Any to enemy <ul><li>target.<code>noexpatstat</code> is true (cannot happen because this field is UNUSED)</li><li>flags 162 is false (we aren't using the B.O.S.S system and we aren't in a Cave Of Trials session)</li></ul> - 1 (this effect never happens under normal gameplay) Any to Any property is one of the following:<ul><li><code>Poison</code></li><li><code>Numb</code></li><li><code>Numb1Turn</code></li><li><code>Sleep</code></li><li><code>Freeze</code></li><li><code>Fire</code></li><li><code>InkOnBlock</code></li><li><code>Ink</code></li><li><code>Sticky</code></li></ul> Status infliction logic occurs (see the section below for details), no changes to basevalue Any to Any property is <code>Flip</code> Flip handling logic (see the section below for details), basevalue may change in various ways Any to Any property is anything except:<ul><li><code>NoExceptions</code> OR</li><li><code>Flip</code> while target doesn't have the Flipped condition. NOTE: If the enemy has defenseonhit above 0, this is incorrect<sup>7</sup></li></ul> DefaultDamageCalc (see the section below for details) is called with the corresponding values for the parameters where pierce is true if piercing applies (false otherwise or if property is null), with def being target.<code>def</code>. basevalue may decrease due to various defense modifiers Any to Any <ul><li>target has <code>Magic</code> in its weakness AND</li><li>property is <code>Magic</code> OR</li> <ul><li>attacker is a player party member while <code>lastskill</code> is <code>Icefall</code>, <code>FrigidCoffin</code> or <code>IceRain</code> skill AND</li><li>property is one of the following:</li><ul><li><code>Poison</code></li><li><code>Numb</code></li><li><code>Numb1Turn</code></li><li><code>Sleep</code></li><li><code>Freeze</code></li><li><code>Fire</code></li><li><code>InkOnBlock</code></li><li><code>Ink</code></li><li><code>Sticky</code></li><li><code>Flip</code> while target has the Flipped condition</li><li><code>NoExceptions</code></li></ul></ul></ul> + 1 and If <code>commandsuccess</code> is true (the player suceeded the action command), weaknesshit is set to true Any to enemy <ul><li>target.battleentity.<code>height</code> is above 0.0</li><li>target.cantfall is false</li><li>target.position is <code>Flying</code></li><li>target.<code>lockposition</code> is false</li><li>There are no <code>NoFall</code> overrides</li></ul> AND (first of the 2 applies) - <ul><li>target doesn't already have have the Topple conditions</li><li>target doesn't have the Sleep, Freeze or Numb conditions</li><li>target has <code>ToppleFirst</code> or <code>ToppleAirOnly</code> in its weakness </li></ul> The Topple condition is added directly to target.<code>condition</code> array for 1 turn followed by target.battleentity.<code>basestate</code> set to 21 (<code>Woobly</code>) - The above didn't apply The enemy falls<sup>3</sup> (no basevalue changes) Any to Any <ul><li>target has the DefenseUp condition</li><li>Either property:<ul><li>is null OR</li><li>is not <code>Flip</code> (NOTE: this is incorrect<sup>7</sup>) or <code>NoExceptions</code> while piercing doesn't apply</li></ul></li></ul> - 1 Any to Any <ul><li>target has the DefenseDown condition</li><li>piercing doesn't apply</li><li>property isn't <code>NoExceptions</code>.</li><li>At least one of the following is true:<ul><li>target.<code>def</code> is above 0. NOTE: If the property is <code>Flip</code>, this is incorrect if target.<code>def</code> is exactly 1<sup>8</sup></li><li>The DefenseUp effect above was just processed. NOTE: This is incorrect<sup>5</sup></li><li>The target is a player party member while HardMode returns true. NOTE: This is inconsistent or incorrect<sup>6</sup></li></ul></li></ul> + 1 Attacker to any <ul><li>Attacker has the AttackUp condition</li><li>property isn't <code>NoExceptions</code></li></ul> + 1 Attacker to any <ul><li>Attacker has the AttackDown condition</li><li>property isn't <code>NoExceptions</code></li></ul> - 1 Enemy to player The <code>DoublePainReal</code> medal is equipped Multiplied by 1.25 floored, then increased by 1 Player to enemy <ul><li>Attacker has an <code>AntlionJaws</code> medal</li><li><code>actionid</code> is 0 or below (this field is UNUSED so it's always 0)</li><li>currentchoice is <code>Attack</code></li><li>Either the target has the DefenseUp condition OR its target.<code>def</code> is above 0</li><li>Piercing doesn't apply</li></ul> Increased by the lowest between the amount of the attacker's <code>AntlionJaws</code> medals and the target's defense which is:<ul><li>target.<code>def</code> if it's above 0</li><li>1 if target.<code>def</code> is 0 AND it has the DefenseUp condition</li><li>0 otherwise</li></ul>NOTE: This logic is incorrect<sup>4</sup> Any to enemy <ul><li>The target has <code>DefDownOnFlyHard</code> in its weakness (This is specific to a <code>VenusBoss</code> enemy)</li><li>target.position is <code>Flying</code></li><li>HardMode returns true</li></ul> + 1 Any to Any target has the Sturdy condition - 3 Any to player target has a Reflection condition - amount of target's <code>Reflection</code> medals Any to Any <ul><li>target doesn't have <code>LimitX10</code> in its weakness</li><li>property is <code>Atleast1</code> or <code>Atleast1pierce</code></li></ul> Clamped from 1 to 99 Any to Enemy <ul><li>target has <code>LimitX10</code> in its weakness</li><li>property is <code>Atleast1</code> or <code>Atleast1pierce</code></li></ul> - 10 Any to Enemy target has <code>LimitX10</code> in its weakness <ul><li>If basevalue is &lt;= 1, basevalue is set to 0</li><li>Otheriwise, basevalue is divided by 10 ceiled</li></ul> <p>1: This always counts as a super block if <code>superblockedthisframe</code> hasn't expired yet. A super block also causes the following to happen:</p> <ul> <li><code>superblockedthisframe</code> is reset to 3.0 frames</li> <li>superguarded is set to true</li> <li>block is overriden to true</li> </ul> <p>For more information on how super blocks are determined, check GetBlock.</p> <p>2: This is how ice thawing is done (this is done after the sub effect processed):</p> <ul> <li>RemoveCondition is called with the target to remove the Freeze condition</li> <li>BreakIce is called on the target.battleentity</li> <li>target.<code>cantmove</code> is set to 0 if the target is an enemy party member or to 1 if it's a player party member. This allows for the actor to immediately be able to act no matter its party (the enemy party doesn't get their actor turns advanced until the next main turn while the player party have theirs advanced right after enemies). NOTE: This logic is incorrect for enemy party members because if they have a moves higher than 1, they will loose all but 1 actor turn they should have available. The correct logic is the same than what AdvanceTurnEntity does which is setting <code>cantmove</code> to -<code>moves</code> + 1.</li> </ul> <p>3: This means the attack happened to a toppled flying enemy or the enemy wasn't topplable and was hit while flying meaning it should be dropped to the ground. This is how this happens:</p> <ul> <li>RemoveCondition is called with the target to remove its Topple condition</li> <li>target.battleentity.<code>bobrange</code> and <code>bobspeed</code> are set to 0.0</li> <li>If target.<code>animid</code> (the enemy id) isn't 208, target.battleentity.<code>basestate</code> is set to 0 (<code>Idle</code>). NOTE: This enemy id doesn't exist, the logic was supposed to check for target.battleentity.animid for not being 207 (<code>CursedSkull</code>) which would have allowed it to to remain in its charge animation even when it falls</li> <li>If target.eventonfall is above -1 (it's defined):<ul> <li><code>calleventnext</code> is set to target.<code>eventonfall</code></li> <li>target.battleentity.<code>basestate</code> is set to 11 (<code>Hurt</code>)</li> </ul> </li> <li>Otherwise (target.eventonfall isn't defined):<ul> <li>target.battleentity.<code>droproutine</code> is set to a new Drop call on target.battleentity</li> </ul> </li> </ul> <p>4: The <code>AntlionJaws</code> medal was supposed to ignore a defense for each instance equipped. However, there are 5 cases in which this doesn't work correctly:</p> <ul> <li>The DefenseDown condition is ignored</li> <li>The defense gained as a result of the Numb condition is ignored</li> <li>defenseonhit is ignored on enemies who supports it</li> <li>The DefenseUp condition is ignored UNLESS target.<code>def</code> is 0 where it works correctly. Specifically, this means that if the target's target.<code>def</code> is 1 while having the DefenseUp condition, at most 1 <code>AntLionJaws</code> will count still (even if 2 are equipped)</li> <li>The property is <code>Flip</code>. This will cause both the medal and the 1 defense ignore to apply independently for the same reasons, effectively ignoring the defense that was already ignored befrehand</li> </ul> <p>5: This is incorrect to do because the DefenseDown effect later can still apply which can make it override the numb defense giving +1 erroneous increase to basevalue. For this issue to reproduce, the <code>DefenseDown</code> conditions needs to be fufilled while the numb defense conditions also applies which will effectively count 1 less defense than it should. The defense in the HUD reports the correct number, but the calculations are wrong.</p> <p>Additionally, if the target has all the DefenseUp, DefenseDown and Numb conditions, now numb defense won't apply when the other 2 cancel each other resulting in numb defense not being applied when it should have been. This results in the same error.</p> <p>6: There are 2 ways to look at this because the intent here is unclear:</p> <ul> <li>Negative defense on the player is allowed due to making it possible via medals and DefenseDown always apply</li> <li>Negative defense shouldn't be allowed in general and medals causes a design issue</li> </ul> <p>The second case is a design bug. The first case isn't consistent because the medals exists no matter if HardMode applies or not, but the DefenseDown effect may or may not apply.</p> <p>Additionally, this doesn't take into consideration the numb defense even if its logic was correct (that it would apply regardless of DefenseDown's presence or not). It now means that the numb defense may or may not be cancelled correctly depending on the difficulty which is a bug.</p> <p>7: <code>Flip</code> always ignore at most 1 of target.<code>def</code>, but it also ignores unconditionally other types of defenses on top of this incorrectly:</p> <ul> <li>Numb defense</li> <li>DefenseUp condition</li> <li>defenseonhit on supported enemies when they are <code>isdefending</code></li> </ul> <p>They are also cumulative: if all 3 are combined, they all get ignored on top of the 1 defense ignored from target.<code>def</code> while only at most 1 was supposed to be ignored across all defenses.</p> <p>8: This is the infamous issue known as the \"def bug\". If target.<code>def</code> is EXACTLY 1 (0 or 2+ are accidentally correct) while it has a DefenseDown condition, the only defense left will be ignored, but DefenseDown will still apply. Only one of the two should apply because there's only 1 defense available to ignore. DefenseDown only requires that target.<code>def</code> is above 0.</p>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#status-infliction","title":"Status infliction","text":"<p>What happens here depends on the property. These typically attempts to inflict a condition on the target when applicable and most of them implies a resistance check.</p> <p>Here's an explanation of the columns:</p> <ul> <li>property: The property value the row applies to</li> <li>conditions inflicted: The condition to inflict if all the requirements are fufilled</li> <li>Requirements: The requirements that must be fufilled for the condition to be inflicted. All statuses requires block to be false and the target to not have the Sturdy condition. Those checks are implied in this column and won't be mentioned. There is 1 requirement specifically that recurs a lot and will be called with a simplified name:<ul> <li>Resistance check: A resistance check must pass for the condition to be inflicted. A resistance is an integer field on the target that can be at most 99 for the condition to possibly inflict. If it's 100 or above, the target is immune and the infliction won't occur. This immunity condition also affects if the <code>StatusMirror</code> medal works. This is how the test occurs:<ul> <li>If this is a <code>chompyaction</code> or the attacker is a player party member with a <code>StatusBoost</code> medal, the resistance used for the test is decreased by 15 (guaranteed to inflict if this subtraction makes the resistance land at 0 or below)</li> <li>A random number between 0 and 99 is generated and it must be higher or equal than the target's resistance for the test to pass. Intuitively, if the target isn't immune, it means the percentage to inflict is 100 - resistance with <code>StatusBoost</code> or a <code>chompyaction</code> giving 15% more chances (or a guarantee if the percent number is above 100)</li> </ul> </li> </ul> </li> <li>Resistance increase: After infliction, it's possible the resistance used with the resistance check gets increased. This column indicates if it will happen, under what conditions it will happen and for how much</li> <li><code>StatusMirror</code> Infliction scheme: The <code>StatusMirror</code> medal scheme of infliction. This medal only works in an enemy to player attack direction and it requires the resistance used for the resistance check to be below 100 (not being immune). If these conditions are met upon inflictions, the attacker gets inflicted with the same condition. The scheme of the infliction may vary and this column tells how it's inflicted</li> <li>Other effects: Anything the infliction does other than inflicting the condition or giving it to the attacker due to <code>StatusMirror</code>. Please note that with the exception of the <code>Sleep</code> property, RemoveCondition is called with the target to remove its Sleep condition if one of the following is true:<ul> <li>The target is an enemy party member. NOTE: This contradicts the requirements for DoDamage to do the same because it does not feature a clause for dealing damages above 0. This means that a an attack that does no damage, but still inflicts can remove Sleep without changing the <code>cantmove</code> which is different than if DoDamage removed it.</li> <li>The target is a player party member and it doesn't have a <code>HeavySleeper</code> medal</li> </ul> </li> </ul> property conditions inflicted Requirements Resistance increase <code>StatusMirror</code> Infliction scheme Other effects <code>Poison</code> Poison for 2 turns Pass a resistance check with target.<code>poisonres</code> None SetCondition is called with the attacker to set the Poison condition for 2 turns The <code>Poison</code> sound is played if it wasn't playing already <code>Numb</code> or <code>Numb1Turn</code> Numb for 2 turns (1 turn instead if it's a <code>chompyaction</code> or property is <code>Numb1Turn</code>) Pass a resistance check with target.<code>numbres</code> If target is an enemy party member, it is increased by 17. The increase is 22 instead if HardMode returns true AddDelayedCondition is called with the attacker to add the Numb as a delayed condition to it <ul><li>The <code>Numb</code> sound is played if it wasn't playing already</li><li>target.<code>isnumb</code> is set to true</li><li>If the target is an enemy party member and its <code>actimmobile</code> is false, target.<code>cantmove</code> is set to 1 (meaning 1 actor turn needs to pass before the target can act again). NOTE: This means a status cleansing action on an enemy party member will still have them loose their actor turn</li><li>If target.position is <code>Ground</code> and its battleentity.<code>height</code> is above 0.05, target.battleentity.<code>droproutine</code> is set to a new Drop call on target.battleentity</li></ul> <code>Sleep</code> Sleep for 2 turns (3 turns instead if the target is a player party member while it already had a Sleep condition<sup>2</sup>) Pass a resistance check with target.<code>sleepres</code> If the target is an enemy party member, target.<code>numbres</code> is increased by 9. The increase is 13 instead if HardMode returns true AddDelayedCondition is called with the attacker to add the Sleep as a delayed condition to it <ul><li>The <code>Sleep</code> sound is played if it wasn't playing already</li><li>target.<code>isasleep</code> is set to true</li><li>If the target has the Flipped condition, target.battleentity.animstate is set to 25 (<code>SleepFallen</code>) and if it doesn't have it, it's set to 14 (<code>Sleep</code>)</li><li>If target.position is <code>Ground</code> and its battleentity.<code>height</code> is above 0.05, target.battleentity.<code>droproutine</code> is set to a new Drop call on target.battleentity</li></ul> <code>Freeze</code> Freeze for 1 turn if the target is an enemy party member or 2 turns if it's a player party member Pass a resistance check with target.<code>freezeres</code> If the target is an enemy party member:<ul><li>If the corresponding endata of the target's <code>hasiceanim</code> is true and we are either at the <code>GiantLairFridgeInside</code> map or in any maps outside of the <code>GiantLair</code> area, target.<code>freezeres</code> is increased by 70</li><li>Otherwise, if target.<code>frozenlastturn</code> is true, target.<code>freezeres</code> is increased by 25</li><li>Otherwise, target.<code>freezeres</code> is increased by 13. The increase is 18 instead if HardMode returns true</li></ul> AddDelayedCondition is called with the attacker to add the Freeze as a delayed condition to it <ul><li>RemoveCondition is called with the target to remove the Topple condition</li><li>If the corresponding endata of the target's <code>hasiceanim</code> is true and we are either at the <code>GiantLairFridgeInside</code> map or in any maps outside of the <code>GiantLair</code> area:<ul><li>target.battleentity.<code>inice</code> is set to true</li><li>target.weakness is set to a new list with one element being <code>HornExtraDamage</code></li></ul></li><li>Freeze is called on target.battleentity</li><li>If target.position is <code>Ground</code> and its battleentity.<code>height</code> is above 0.05, target.battleentity.<code>droproutine</code> is set to a new Drop call on target.battleentity</li></ul> <code>Fire</code> Fire for 2 turns CanBeOnFire must returns true<sup>1</sup> None SetCondition is called with the attacker to set the Fire condition for 2 turns The <code>Flame</code> sound is played if it wasn't playing already <code>Ink</code> or <code>InkOnBlock</code> (<code>InkOnBlock</code> doesn't have the block requirement) Inked for 3 turns when block is false (2 when block is true) If the target has the <code>ResistAll</code> medal equipped, a 50% RNG test is performed and it must pass (not applicable if the target doesn't have it equipped) None SetCondition is called with the attacker to set the Inked condition for 2 turns <ul><li>The <code>WaterSplash2</code> sound is played at 0.7 pitch if it wasn't playing already or it was while its time is higher than 0.25 seconds</li><li>The <code>InkGet</code> particles plays at the target.battleentity's position + Vector3.up</li></ul> <code>Sticky</code> Sticky for 3 turns when block is false (2 when block is true) If the target has the <code>ResistAll</code> medal equipped, a 50% RNG test is performed and it must pass (not applicable if the target doesn't have it equipped) None SetCondition is called with the attacker to set the Sticky condition for 2 turns <ul><li>The <code>WaterSplash2</code> sound is played at 0.7 pitch if it wasn't playing already or it was while its time is higher than 0.25 seconds</li><li>The <code>StickyGet</code> particles plays at the target.battleentity's position + Vector3.up</li></ul> <p>1: The method does the following to determine if the target can be on fire:</p> <ul> <li>If the target is a player party member, true is returned unless it has the <code>ResistAll</code> medal equipped and a 50% RNG test is failed where false is returned instead</li> <li>If it's a <code>WaspKing</code> or <code>EverlastingKing</code> enemy, true is returned if a 30% RNG test succeed, false otherwise</li> <li>If it's a <code>Krawler</code>, <code>Cape</code> or <code>CursedSkull</code> enemy then it's false if the current map is any in the <code>GiantLair</code> area other than <code>GiantLairFridgeInside</code>. Otherwise, the return is decided with a 50% RNG test</li> <li>If it's a <code>KeyR</code>, <code>KeyL</code> or <code>Tablet</code> enemy, false is returned</li> <li>If none of the cases applies, true is returned</li> </ul> <p>2: This is due to the first of those 3 turns ending immediately making it really + 2 turns in practice which matches all other cases where it's always + 2 turns.</p>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#flip-handing","title":"<code>Flip</code> handing","text":"<p>Each rows of the table contains an effect to basevalue or other additional effects when applicable. Each row contains 3 columns:</p> <ul> <li>target's party: The party of the target (any for either)</li> <li>Condition: The conditions required for this effect to process. If a list is presented, all conditions must be true unless stated otherwise</li> <li>Effects: The effects on basevalue if Condition is true. This may contain other effects than changing basevalue. Anything underlined means it's an effect other than increasing or decreasing meaning it's more significant and its position in the calculation is important</li> </ul> <p>These effects are shown in the exact order they appear.</p> target's party Condition Effects Any target doesn't have the Flipped condition basevalue is decreased by the clamp of target.<code>def</code> - 1 from 0 to 99 Any <ul><li>target doesn't have the Flipped condition</li><li>target has <code>Flip</code> in its weakness</li></ul> wealnesshit is set to true + the first of 3 applicable effects below (mutually exclusive) - target doesn't have <code>ToppleFirst</code> in its weakness <ul><li>A Flipped condition for 1 turn is added directly to target.<code>condition</code></li><li>basevalue is clamped from 1 to 99</li></ul> - target has the Topple condition <ul><li>A Flipped condition for 1 turn is added directly to target.<code>condition</code></li><li>basevalue is clamped from 1 to 99</li><li>RemoveCondition is called with the target to remove its Topple condition</li></ul> - Neither of the above applied <ul><li>If target.position is <code>Ground</code>, target.battleentity.animstate is set to 21 (<code>Woobly</code>)</li><li>A Topple condition for 1 turn is added directly to target.<code>condition</code></li></ul> Any target has <code>HornExtraDamage</code> in its weakness <ul><li>basevalue is incremented</li><li>weaknesshit is set to true</li></ul> Enemy Always occur <ul><li>If target.holditem isn't -1 (it was holding an item), DropItem is called with the target and with additem</li><li>If target.isdefending is true, it is set to false</li></ul>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#defaultdamagecalc","title":"DefaultDamageCalc","text":"<p>This is a sub method to CalculateBaseDamage which only gets called for most property values (the exceptions being <code>NoExceptions</code> where it's never called and <code>Flip</code> where it may or may not be called).</p> <p>It takes the basevalue as ref and despite its name, it only processes optional decreases of the basevalue due to defensive effects.</p> <pre><code>private void DefaultDamageCalc(MainManager.BattleData target, ref int basevalue, bool pierce, bool blocked, int def)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#parameters_1","title":"Parameters:","text":"<ul> <li><code>target</code>: The target from CalculateBaseDamage</li> <li>ref <code>basevalue</code>: The basevalue from CalculateBaseDamage</li> <li>pierce: Whether defense pierce applies. This value is computed from CalculateBaseDamage, but overriden to false if <code>target</code> is a player party member</li> <li><code>blocked</code>: UNUSED (this is block from CalculateBaseDamage, but it is never read in the method)</li> <li><code>def</code>: target.<code>def</code> from CalculateBaseDamage. (NOTE: this is the base value, not the effective one). Overriden to 0 if <code>pierce</code> is true while <code>target</code> is an enemy party member</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#effects","title":"Effects","text":"<p>Each rows of the table contains an effect to basevalue or other additional effects when applicable. Each row contains 3 columns:</p> <ul> <li>target's party: The party of the target (any for either)</li> <li>Condition: The conditions required for this effect to process. If a list is presented, all conditions must be true unless stated otherwise</li> <li>Damage effect: The effects on basevalue if Condition is true. This may contain other effects than changing basevalue. Anything underlined means it's an effect other than increasing or decreasing meaning it's more significant and its position in the calculation is important</li> </ul> <p>These effects are shown in the exact order they appear.</p> target's party Condition Damage effect Any target doesn't have the Flipped condition - def Player target has the Poison condition - (amount of target's <code>PoisonDefender</code> medals - amount of target's <code>ReversePoison</code> medals) Player target is <code>playerdata[battle.partypointer[playerdata.lenght - 1]]</code> (the furthest back in the player party formation) - amount of target's <code>BackSupport</code> medals Player target is <code>playerdata[battle.partypointer[0]]</code> (the front in the player party formation) - amount of target's <code>FrontSupport</code> medals Player target.<code>hp</code> is &lt;= 4 - 2 * amount of target's <code>DefenseUp</code> medals Player <ul><li>target has the Sleep condition</li><li>target has a <code>HeavySleeper</code> medal</li></ul> Divided by 2 floored Any <ul><li>target.isdefending is true</li><li>pierce is false</li></ul> - target.defenseonhit"},{"location":"Battle%20system/Damage%20pipeline/CalculateBaseDamage/#final-steps-and-results","title":"Final steps and results","text":"<p>Before the method ends:</p> <ul> <li><code>caninputcooldown</code> is set to 0.0</li> <li><code>blockcooldown</code> is set to 0.0</li> </ul> <p>The final result is determined by the following:</p> <ul> <li>If a <code>FrostBite</code> medal counter conditions were fufilled:<ul> <li>ShowDamageCounter is called with type 0 (damage) with the basevalue (which is now the final amount) as the ammount starting from the world CenterPos of attacker and ending at Vector3.Up. NOTE: this basevalue may be unclamped here which allows to show a negative number</li> <li>The attacker's <code>hp</code> is decreased by basevalue clamped from 1 to its <code>maxhp</code> (meaning this can't be lethal). NOTE: basevalue may be unclamped here which allows it to be negative and heal the attacker instead of dealing damage to it (the outer clamp is only clamping the final hp, NOT the number by which it is decreased)</li> <li>0 is returned as the final damage value (this is because the calculations are overriden to deal no damages to the target, but they were dealt manually just now to the attacker)</li> </ul> </li> <li>Otheriwse, if the attack direction is attacker to player while block is false, basevalue is clamped from 1 to 99</li> <li>Otherwise, basevalue is clamped from 0 to 99</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DamageOverride/","title":"DamageOverride","text":"<p>A DamageOverride is a way to modify some logic in the damage pipeline. Unlike AttackProperty, they can only be sent to DoDamage in a parameter, but that parameter takes an array meaning it is possible to send multiple DamageOverrides at once (some however are mutually exclusive against each other).</p> <p>The order in which they are specified in the parameter matters as they are processed sequentially.</p> <p>The vast majority are processed in DoDamage, but some are in CalculateBaseDamage and they can influence the logic there.</p> Value Name Description 0 LeftMovement UNUSED 1 RightMovement UNUSED 2 UpMovement UNUSED 3 NoMovement UNUSED 4 HurtStyle UNUSED 5 HealStyle UNUSED 6 TPStyle UNUSED 7 MAXStyle UNUSED 8 ShakeLonger UNUSED 9 NoShake UNUSED 10 ShowCombo Calls ShowComboMessage right after the damage amount has been calculated in DoDamage 11 NoSound The DoDamageAnim call towards the end of DoDamage will have nosound set to true. NOTE: this is ignored if <code>NoDamageAnim</code> or <code>BlockSoundOnly</code> is processed after 12 FailSound The DoDamageAnim call towards the end of DoDamage will have fail set to true. NOTE: this is ignored if <code>NoDamageAnim</code> is processed after 13 NoDamageAnim There will not be a DoDamageAnim call towards the end of DoDamage. NOTE: processing this overrides any <code>NoSound</code>, <code>BlockSoundOnly</code>, <code>FailSound</code> and <code>FakeAnim</code> because the call won't happen 14 BlockSoundOnly The DoDamageAnim call towards the end of DoDamage will have nosound set to true if block is false. NOTE: this is ignored if <code>NoDamageAnim</code> or <code>NoSound</code> is processed after 15 NoCounter There will not be a ShowDamageCounter call in DoDamage (this does not cover a <code>Frostbite</code> medal counter which is done in CalculateBaseDamage) 16 NoFall Prevents an enemy party member from falling under any circumstances in CalculateBaseDamage if one is the target 17 NoIceBreak Prevents an enemy party member from thawing out when they have the Freeze condition under any circumstances in CalculateBaseDamage if one is the target 18 FakeAnim The DoDamageAnim call towards the end of DoDamage will have fakeanim set to true. NOTE: this is ignored if <code>NoDamageAnim</code> is processed after 19 DontAwake Prevents the attack from removing the Sleep condition on the target during the course of DoDamage. NOTE: CalculateBaseDamage can still remove it when inflicting a different status, check its documentation to learn more 20 IgnoreNumb Prevents the Numb condition to have its defense apply during CalculateBaseDamage under any circumstances"},{"location":"Battle%20system/Damage%20pipeline/DamageWithinPos/","title":"DamageWithinPos","text":"<p>This method is a wrapper around DoDamage in a player to enemy flow that allows to issue damages to each enemies that matches a filter which includes having their physical (or world CenterPos) be within a certain radius of a point.</p> <p>The distance check is done with another standalone method called IsInRadius.</p> <pre><code>private void DamageWithinPos(int playerid, int damage, AttackProperty? property, float radius, bool xonly, Vector3 pos)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/DamageWithinPos/#parameters","title":"Parameters","text":"<ul> <li><code>playerid</code>: The <code>playerdata</code> index that will be used as the attacker to DoDamage. This must not be negative or an exception will be thrown</li> <li><code>damage</code>: The meaning depends on the value and it controls the damageammount and overrides parameters to send to DoDamage:<ul> <li>0: DoDamage will be called with a damageammount of the attacker's <code>atk</code> and an overrides of {<code>NoCounter</code>, <code>NoDamageAnim</code>, <code>NoSound</code>}</li> <li>1 or higher: DoDamage will be called with the value as the damageammount with overrides as null</li> <li>-1 or below: DoDamage will be called with a damageammount of the attacker's <code>atk</code> + the value with overrides as null</li> </ul> </li> <li><code>property</code>: The DamageProperty to send to DoDamage</li> <li><code>radius</code>: The radius to send to IsInRadius</li> <li><code>xonly</code>: The xonly to send to IsInRadius</li> <li><code>pos</code>: The pos to send to IsInRadius. There is an overload of the method available where this isn't sent and it defaults to the player party member's physical position</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DamageWithinPos/#procedures","title":"Procedures","text":"<p>Most of the logic on how the DoDamage call is prepared is explained in the parameters section so the only logic remaining is what determines for each enemy party member if DoDamage will be called on it.</p> <p>Each enemy party member will be checked. In order for DoDamage to be called on them as the target:</p> <ul> <li>Their position must not be <code>OutOfReach</code></li> <li>Their <code>hp</code> must be above 0</li> <li>IsInRadius returns true with the following parameters:<ul> <li>pos: pos</li> <li>entity: The enemy party member</li> <li>radius: radius</li> <li>getair: true</li> <li>xonly: xonly</li> </ul> </li> </ul> <p>Any enemy party members that do not fufill those conditions won't have damage dealt to them.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/","title":"DoDamage","text":"<p>DoDamage is the entrypoint of the damage pipeline. Any damage must go through it in order to be properly calculated and processed with visual effects and counters.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#entry-point","title":"Entry point","text":"<p>There are 10 overloads, but all of them ends up at a particular one which is the following (it will be refered to as the final overload):</p> <pre><code>private int DoDamage(MainManager.BattleData? attacker, ref MainManager.BattleData target, int damageammount, AttackProperty? property, DamageOverride[] overrides, bool block)\n</code></pre> <p>It returns the amount of damage actually dealt.</p> <p>Here are the parameters:</p> <ul> <li><code>attacker</code>: The actor dealing the damage. If null, the damage didn't come from an attacker. If it exists, it must belong to the opposite party of the <code>target</code></li> <li>ref <code>target</code>: The actor receiving the damage. Passed as ref to allow modifying the actor's data. If the <code>attacker</code> exists, it must belong to its opposite party</li> <li><code>damageammount</code>: The base amount of damage to deal. This number can be heavilly changed by the damage pipeline, it is only the base one to deal</li> <li><code>property</code>: The property of the attack</li> <li><code>overrides</code>: The overrides to apply to the damage pipeline. May be null or an empty array to have no overrides</li> <li><code>block</code>: For an enemy attack, whether or not the player sucessfully blocked it (this is intended to receive <code>commandsuccess</code> as it was determined by GetBlock). It doesn't matter if it's a regular block or a super block, this parameter is to signal a block of any kind as the damage pipeline will process what to do with it</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#general-purpose-overloads","title":"General purpose overloads","text":"<p>The following are general purpose overloads which just ends up calling the final one leaving some parameters to default.</p> <p>(1) Calls the final overload with null/false as the other parameters (no attacker, no property, no overrides and no block)</p> <pre><code>private int DoDamage(ref MainManager.BattleData target, int ammount)\n</code></pre> <p>(2) Calls the final overload with the other parameters being null (No attacker, no property and no overrides)</p> <pre><code>private int DoDamage(ref MainManager.BattleData target, int ammount, bool block)\n</code></pre> <p>(3) Calls the final overload with the parameters sent leaving overrides to an empty array and block to false</p> <pre><code>private int DoDamage(MainManager.BattleData? attacker, ref MainManager.BattleData target, int damageammount, AttackProperty? property)\n</code></pre> <p>(4) Calls (5) with the parameters sent leaving attacker to null (meaning no attacker and no overrides)</p> <pre><code>private int DoDamage(ref MainManager.BattleData target, int damage, AttackProperty? property)\n</code></pre> <p>(5) Calls the final overload with the parameters sent leaving overrides to an empty array</p> <pre><code>private int DoDamage(MainManager.BattleData? attacker, ref MainManager.BattleData target, int damageammount, AttackProperty? property, bool block)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#enemy-attack-overloads","title":"Enemy attack overloads","text":"<p>The following overloads are specifically made for an enemy party member attacking a player party member.</p> <p>(6) Calls the final overload with the attacker being <code>enemydata[enemyid]</code>, the target being <code>playerdata[playertarget]</code>, overrides being null and the rest being the same as the parameters sent</p> <pre><code>private int DoDamage(int enemyid, int playertarget, int damage, AttackProperty? property, bool block)\n</code></pre> <p>(7) Calls the final overload with the attacker being <code>enemydata[enemyid]</code>, the target being <code>playerdata[playertarget]</code> and the rest being the same as the parameters sent</p> <pre><code>private int DoDamage(int enemyid, int playertarget, int damage, AttackProperty? property, DamageOverride[] overrides, bool block)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#player-attack-overloads","title":"Player attack overloads","text":"<p>The following overloads are specifically made for a player party member attacking an enemy party member.</p> <p>(8) Calls (9) with the parameter sent and enemytarget being the BattleControl's <code>target</code></p> <pre><code>private int DoDamage(int playerid, AttackProperty? property)\n</code></pre> <p>(9) Calls the final overload with the following:</p> <ul> <li><code>attacker</code>: The player party member whose <code>trueid</code> is <code>playerid</code> (it will falback to the first player party member if none exists)</li> <li><code>target</code>: The enemy party member in <code>availabletargets</code> whose index is <code>enemytarget</code>. An exception is thrown if no enemy party member exists at that index</li> <li><code>damageammount</code>: The return of GetPlayerAttack for the <code>playerid</code> and <code>commandsuccess</code> which is the <code>atk</code> of the corresponding player party member if <code>commandsuccess</code> is true and if it's false, it's its <code>atk</code> clamped from -99 to 1</li> <li><code>property</code>: The same as the parameter sent</li> <li><code>overrides</code>: If <code>commandsuccess</code> is true, this is null and if it's false, it's an array with one element being <code>FailSound</code></li> <li><code>block</code>: false</li> </ul> <pre><code>private int DoDamage(int playerid, int enemytarget, AttackProperty? property)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#procedure","title":"Procedure","text":"<p>The following is a high level overview of the damage pipeline divided by sections for each groups of effects that happens.</p> <p>An actor is considered to be a player party member if its battleentity has the <code>Player</code> tag. It's assumed to be an enemy party member if it doesn't. If the attacker exists, its party is assumed to be the opposte of the target's.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#block-override","title":"block override","text":"<p>There are ways that block can be overriden to false. Here are all of them (they aren't mutually exclusive, if any is true, block becomes false):</p> <ul> <li>The target has the Freeze condition</li> <li>The target has the Sleep condition</li> <li>The target has the Numb condition</li> <li>The target is a player party member with the <code>Berserker</code> medal equipped</li> <li>This is a non super block while flags 15 and 615 are true (chapter 1 started after the combat tutorial while FRAMEONE is active) and <code>overridechallengeblock</code> is false</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#damage-calculation","title":"Damage calculation","text":"<p>This is where the final damage amount is determined.</p> <p>If the target isn't Invulnerable, the final damage amount is set to the return of CalculateBaseDamage with all the parameters sent (with the overriden block if applicable and property to null if it was <code>None</code>). The weaknesshit and superguarded ref parameters are passed via locals initially set to false. </p> <p>Otherwise (the target is invulnerable), it depends if the property is <code>NoException</code>:</p> <ul> <li>If it isn't, the amount is 0</li> <li>If it is, it's the original damageammount</li> </ul> <p>The target is invulnerable if any of the following is true:</p> <ul> <li>Its <code>plating</code> is true</li> <li>It has the Shield condition</li> <li>It is a player party member with the Numb condition and the <code>ShockTrooper</code> medal equipped</li> </ul> <p>NOTE: If the target is invulnerable, it will cause the weaknesshit and superguarded locals to remain with values of false. This can lead to missleading ShowSuccessWord later (see the block processing and player action commands sections below for details).</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#plating-expiration","title":"<code>plating</code> expiration","text":"<p>If the target doesn't have the Shield condition, its <code>plating</code> is set to false. This allows the <code>plating</code> to not expire when hit while shielded.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#damageoverride-application","title":"DamageOverride application","text":"<p>8 of the 11 available <code>DamageOverride</code> are processed here if they are present in overrides. Each are processed in order they appear in the array. The other 3 were processed by CalculateBaseDamage if it was called earlier:</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#showcombo","title":"<code>ShowCombo</code>","text":"<p>ShowComboMessage is called with target.battleentity and block as block.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#nosound","title":"<code>NoSound</code>","text":"<p>The DoDamageAnim call towards the end will have nosound set to true. NOTE: this is ignored if <code>NoDamageAnim</code> or <code>BlockSoundOnly</code> is processed after</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#blocksoundonly","title":"<code>BlockSoundOnly</code>","text":"<p>The DoDamageAnim call towards the end will have nosound set to true if block is false. NOTE: this is ignored if <code>NoDamageAnim</code> or <code>NoSound</code> is processed after</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#failsound","title":"<code>FailSound</code>","text":"<p>The DoDamageAnim call towards the end will have fail set to true. NOTE: this is ignored if <code>NoDamageAnim</code> is processed after</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#nodamageanim","title":"<code>NoDamageAnim</code>","text":"<p>There will not be a DoDamageAnim call towards the end of the method. NOTE: processing this overrides any <code>NoSound</code>, <code>BlockSoundOnly</code>, <code>FailSound</code> and <code>FakeAnim</code> because the call won't happen</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#nocounter","title":"<code>NoCounter</code>","text":"<p>There will not be a ShowDamageCounter call later</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#fakeanim","title":"<code>FakeAnim</code>","text":"<p>The DoDamageAnim call towards the end will have fakeanim set to true. NOTE: this is ignored if <code>NoDamageAnim</code> is processed after</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#dontawake","title":"<code>DontAwake</code>","text":"<p>Prevents the attack from removing the <code>Sleep</code> condition on the target later even if all conditions to do so are fufilled. This is only used as part of poison and fire damages from AdvanceTurnEntity.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#player-damage-processing","title":"Player damage processing","text":"<p>This section only happens if the target is a player party member.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#block-processing","title":"Block processing","text":"<p>This part is applicable in 2 cases:</p> <ul> <li>block is true (this is the standard reason to process the block)</li> <li>block was overriden to false due to flags 615 being true (FRAMEONE is active) while <code>commandsuccess</code> was true (meaning a non super block happened, but it didn't count due to FRAMEONE).</li> </ul> <p>The second case is an edge case where the only thing that happens is <code>hasblocked</code> is set to true which is only used in HardSeedVenus meaning exceptionally, a <code>HardSeed</code> can be given with that attack with a non super block even if FRAMEONE is active.</p> <p>The first case is the standard one:</p> <ul> <li><code>hasblocked</code> is set to true (allows HardSeedVenus to give a <code>HardSeed</code> to the player if it gets called later as part of the enemy action)</li> <li>If this is a non super block (or the target was invulnerable earlier), ShowComboMessage is called with target.battleentity as the entity and true as the block. NOTE: If the target was invulnerable earlier, this will always count as a regular block because superguarded's value wasn't gathered from CalculateBaseDamage. The ShowComboMessage call can be missleading in such case because it can override the presentation of a previous <code>wordroutine</code> from a previous DoDamage call since the previous one gets destroyed. This can happen in cases like PartyDamage or in any situations where multiple DoDamage calls happens close to each other. Essentially, it means that a super block when the target is invulnerable will be presented as if it was a regular block.</li> <li>Otherwise (meaning this was a super block AND the target wasn't invulnerable earlier):<ul> <li><code>combo</code> is set to 2</li> <li>The <code>AtkSuccess</code> sound is played at 1.1 pitch and 0.6 volume if it wasn't playing already (or it was, but its time was past 0.1 seconds)</li> <li>ShowComboMessage is called with target.battleentity as the entity and false as the block</li> <li>If the <code>NeedlePincer</code> medal is equipped on the target and the target's battleentity still exists in <code>playerdata</code>, the target will get healed later due to the medal</li> </ul> </li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#spikebod-medal-processing","title":"<code>SpikeBod</code> medal processing","text":"<p>This part only happens if all of the following are true:</p> <ul> <li>The <code>SpikeBod</code> medal is equipped</li> <li>target.<code>trueid</code> is 1 (The target's animid is <code>Beetle</code>)</li> <li>block is true</li> <li><code>nonphyscal</code> is false</li> <li>There is an attacker (assumed to be an enemy party member)</li> </ul> <p>In that case, the attacker will get damaged which goes like the following:</p> <ul> <li>The <code>Damage0</code> sound is played with 0.8 pitch and 0.5 volume</li> <li>The <code>hp</code> of the enemy party member corresponding to the attacker is decreased by 1 + the amount of <code>SpikeBod</code> medals equipped on <code>Beetle</code> then clamped from 1 to its <code>maxhp</code> (this implies that this damage cannot be lethal)</li> <li>ShowDamageCounter is called with type 0 (damage) with the amount of damage dealt just now starting from the attacker.battleentity's position + attacker.<code>cursoroffset</code> and ending to (0.0, 1.0, 1.0)</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#poisontouch-medal-processing","title":"<code>PoisonTouch</code> medal processing","text":"<p>This part only happens if all of the following are true:</p> <ul> <li>The <code>PoisonTouch</code> medal is equipped on the target</li> <li>The target has the Poison condition</li> <li>There is an attacker (assumed to be an enemy party member) and its <code>poisonres</code> is less than 100 (it's not immune to poison inflictions)</li> <li><code>nonphyscal</code> is false</li> </ul> <p>If all of the above are fufilled, SetCondition is called to set the Poison condition on the corresponding enemy party member of the attacker for 2 turns</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#favoriteone-medal-processing","title":"<code>FavoriteOne</code> medal processing","text":"<p>This part only happens if the <code>FavoriteOne</code> medal is equipped on the target.</p> <p>The only thing that happens is <code>attackedally</code> is set to target.<code>trueid</code>. This will only take into effect later during AdvanceMainTurn.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#shakegui-call","title":"ShakeGUI call","text":"<p>This part always happen as part of the player damage processing.</p> <p>The only thing that happens here is a ShakeGUI coroutine is started to shake the corresponding <code>hud</code> element of the target.battleentity.animid with a range of (0.1, 0.1, 0.0) for 15.0 frames. This coroutine will change the local position of the <code>hud</code>'s first chiled to be random between (0.0 - shake.x, 0.0 - shake.y) and (shake.x, shake.y) for the next 15.0 frames before being reset to Vector3.zero.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#enemy-damage-processing","title":"Enemy damage processing","text":"<p>This section happens if the player damage processing didn't meaning the target is an enemy party member</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#isdefending-update","title":"isdefending update","text":"<p>This part only happens if all of the following are true:</p> <ul> <li>target.defenseonhit is above 0</li> <li>The final amount of damage calculated is above 0</li> <li>property isn't <code>Flip</code>. NOTE: CalculateBaseDamage can change <code>isdefending</code> when property is <code>Flip</code> so this is why it can't change here (damage calculation needs to ne able to override this logic hence why this check is done)</li> </ul> <p>If all the above are fufilled, it means the enemy supports defending itself and it sustained damage which causes updates to its guarding state. When that happens, <code>isdefending</code> is set to false if the target IsStopped or to true if it's not.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#hitaction-update","title":"hitaction update","text":"<p>target.<code>hitaction</code> can change under 2 conditions (these aren't mutually exclusive, they are applied in order, but <code>hitaction</code> may not be set if neither apply):</p> <ul> <li>It's set to true if target.defenseonhit is -1 and its position isn't <code>Underground</code>. This is only the case for an <code>Underling</code> enemy under normal gameplay</li> <li>It's set to !<code>enemy</code> (false on the enemy phase / delproj / enemy <code>firststrike</code> / enemy <code>hitaction</code>, true otherwise) if the target.onhitaction condition is fufilled which is:<ul> <li>If it's 1, it's always fufilled</li> <li>If it's 2, it's only fufilled if target.<code>position</code> is <code>Flying</code></li> <li>If it's 3, it's only fufilled if target.<code>position</code> is <code>Ground</code></li> </ul> </li> </ul> <p>After, every other enemy party members other than the target who has the target.<code>animid</code> (its enemy id) in their chargeonotherenemy has their <code>hitaction</code> set to !<code>enemy</code> (false on the enemy phase / delproj / enemy <code>firststrike</code> / enemy <code>hitaction</code>, true otherwise).</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#undigging","title":"Undigging","text":"<p>This part only happens if all of the following are true:</p> <ul> <li>The final amount of damages calculated earlier is higher than 0</li> <li>target.position is <code>Underground</code> </li> <li><code>mainturn</code> (AdvanceMainTurn) isn't in progress</li> </ul> <p>If the above conditions are fufilled, then UnDig is called with the target as ref which does the following on it:</p> <ul> <li>battleentity.<code>digging</code> is set to false</li> <li>battleentity.<code>overridejump</code> is set to true</li> <li>Jump is called on the battleentity with a height of 15.0</li> <li>position is set to <code>Ground</code></li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#turnsnodamage-reset","title":"<code>turnsnodamage</code> reset","text":"<p>If the final amount of damages calculated earlier is higher than 0, target.<code>turnsnodamage</code> is set to -1.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#player-action-command-success","title":"Player action command success","text":"<p>If <code>commandsuccess</code> is true and the attacker is a player party member:</p> <ul> <li><code>wordroutine</code> is stopped if it was in progress (followed by the destruction of <code>commandword</code> if it was)</li> <li><code>wordroutine</code> is set to a new ShowSuccessWord call with target.battleenetity as the t, without block and the super being the ref weaknessonhit value obtained from CalculateBaseDamage done earlier (false if it wasn't called). NOTE: If the target was invulnerable earlier, weaknessonhit will always be false since this information wasn't gathered by CalculateBaseDamage</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#targethp-decrease-and-clamping","title":"target.<code>hp</code> decrease and clamping","text":"<p>target.<code>hp</code> gets decreased by the final amount of damage calculated earlier, but it also gets clamped after. The higher bound of the clamp is always target.<code>maxhp</code>, but the lower bound depends on some conditions.</p> <p>Here they are in order (they are mutually exclusive, the first one applies):</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#clamp-from-10","title":"Clamp from 10","text":"<p>This happens if all the following are true:</p> <ul> <li>The target is an enemy party member</li> <li>The target has a <code>SurviveWith10</code> weakness</li> <li>currentaction is <code>ItemList</code> (meaning this was an item use) or <code>lastskill</code> is not 9 (this attack came from any player skills other than <code>PeebleToss</code>)</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#clamp-from-1","title":"Clamp from 1","text":"<p>This happens if the target is an enemy party member with an <code>AlwaysSurvive</code> weakness.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#clamp-from-0","title":"Clamp from 0","text":"<p>This is the default clamp that happens if the other 2 didn't.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#player-selection-cycle-reset","title":"Player selection cycle reset","text":"<p>If the target is a player party member with an <code>hp</code> of 0 (meaning it just died as a result of the attack), SetLastTurns is called which resets <code>lastturns</code> to a new aray with the length being the amount of free players - 1 and all elements being -1 (this resets the player selection cycle).</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#target-waking-up","title":"Target waking up","text":"<p>This section only applies if all of the following is true:</p> <ul> <li>The target had the Sleep condition at the start of the method</li> <li>The property isn't <code>Sleep</code></li> <li>target.<code>hp</code> is above 0</li> <li>The final damage amount calculated earlier is above 0. NOTE: CalculateBaseDamage may override this if the property is one of the status infliction one (except <code>Flip</code>) and the infliction occured because this clause isn't part of the damage calculation. This means that if the amount is 0, but an infliction removing <code>Sleep</code> occured, the <code>cantmove</code> won't change which is a different logic than this method enforces</li> <li>There was no DamageOverride of <code>DontAwake</code> processed earlier</li> <li>If the target is an player party member, the <code>HeavySleeper</code> medal must not be equipped</li> </ul> <p>If all of the above are fufilled, the following happens:</p> <ul> <li>RemoveCondition is called to remove the Sleep condition on the target</li> <li>target.<code>isasleep</code> is set to false</li> <li>target.<code>cantmove</code> is set to 1. NOTE: This is incorrect because it means for a player party member, that remaining actor turn will advance immeidately after the enemy phase so they get to act, but for an enemy party member, they loose their entire main turn because the actor turn won't advance after the player phase</li> <li>UpdateAnim is called with true as the onlyplayer</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#lifesteal-processing","title":"<code>LifeSteal</code> processing","text":"<p>This section only happens if the attacker is a player party member with the <code>LifeSteal</code> medal equipped while <code>nolifesteal</code> is false.</p> <p>If the above is fufilled, the following happens:</p> <ul> <li>The <code>Heal</code> sound is played</li> <li>The amount to heal is set to the final damage amount calculated earlier / 2.0 (or 4.0 if the <code>HPFunnel</code> medal is equipped on the attacker) then clamped from 1.0 to 99.0 then floored</li> <li>The attacker's <code>hp</code> is increased by the amount just calculated clamped from 0 to the attacker's <code>maxhp</code></li> <li>ShowDamageCounter is called with type 1 (HP) for the amount to heal calculated earlier (without <code>maxhp</code> clamp) starting from the attacker's battleentity's position + (0.0, 1.75, 0.0) and ending at (0.0, 3.0, 0.0)</li> <li><code>nolifesteal</code> is set to true which prevents the medal from processing until the next DoAction call</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#stat-down-on-block-properties-processing","title":"Stat down on block properties processing","text":"<p>This section applies if the target.<code>hp</code> is above 0, the target doesn't have the <code>Shield</code> condition and the property is <code>DefDownOnBlock</code> or <code>AtkDownOnBlock</code>.</p> <p>This will call StatusEffect to give the target a condition with visual effect. The amount of turn to inflict is 2 turns unless block is true where it's 1 turn instead. On top of this, it inflicts for one more turn if the target is a player party member (meaning 3 turns or 2 with block).</p> <p>As for the actual condition, it's <code>DefenseDown</code> if the property is <code>DefDownOnBlock</code> and it's <code>AttackDown</code> if the property is <code>AtkDownOnBlock</code>.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#needlepincer-medal-processing","title":"<code>NeedlePincer</code> medal processing","text":"<p>If a heal was requested earlier as a result of blocking as a player party member with a <code>NeedlePincer</code> medal, this is where the Heal call happens with the target as the entity and the ammount being the amount of <code>NeedlePincer</code> equipped on the target.</p>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#dodamageanim-call","title":"DoDamageAnim call","text":"<p>Unless there was a <code>NoDamageAnim</code> damage override processed earlier, DoDamageAnim is called with these parameters:</p> <ul> <li>entity: target</li> <li>damage: The final amount of damage calculated</li> <li>block: block</li> <li>noanim: true</li> <li>nosound, fail and fakeanim, they are false unless a damage override processed earlier decided otherwise</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/DoDamage/#final-processing","title":"Final processing","text":"<p>This section always happen at the end of the method:</p> <ul> <li><code>combo</code> is incremented</li> <li>RefreshMusic is called which is an empty method</li> <li><code>lastdamage</code> is set to the final amount of damage calculated earlier</li> <li>If the target is an enemy party member, <code>damagethisturn</code> is increased by the final amount of damage calculated earlier</li> <li>The final amount of damage calculated earlier is returned, ending the method</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/GetMultiDamage/","title":"GetMultiDamage","text":"<p>A method that allows to precalculate the sum of all damages that could happen from CalculateBaseDamage had multiple player party members combined their attacks and damage influence. The method simulates damage effects as if it was done with a player attacker for each player party members involved and adds them together before returning the result. </p> <p>The intent with this method is to use the precalculated number in DoDamage as the damageammount, but without an attacker. This allows to have every effects from the target's side apply, but to not reapply the effects the attacker side would have because DoDamage no longer has an attacker. It acts as a stopgap to have multiple player party members be the \"attackers\" which isn't possible with DoDamage alone. This method has some caveats, see the details below.</p> <pre><code>private int GetMultiDamage(int[] ids)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/GetMultiDamage/#parameters","title":"Parameters","text":"<ul> <li><code>ids</code>: The trueid arrays of the player party members that will be involved in the multi damage simulation. Due to this only working for the player party, only 0, 1 or 2 are valid elements (<code>Bee</code>, <code>Beetle</code> and <code>Moth</code> respectively)</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/GetMultiDamage/#procedure","title":"Procedure","text":"<p>The following is a table of all the effects applied to the result in order for each player party members whose <code>trueid</code> is in ids and the conditions for the effect to apply. The result is a local value starting at 0 and the effect column describes what happens relative to the player party member involved in the calculation. The sum of this table for all involved player party members is what will be returned as the result clamped from 1 to 99. </p> <p>NOTE: This clamp at the end can skew the results because it negates the influence of having all involved player party members with 0 or negative <code>atk</code> value with no bonuses. However, it should be noted that unlike most player actions, this precalculates the EFFECTIVE damage instead of the base one that is typically sent to DoDamage in a player to enemy flow. Due to this, the bad influence of this clamp is close enough to what would have happened if DoDamage was called with <code>AtLeast1</code> or <code>AtLeast1Pierce</code> as the property which is well defined.</p> Conditions Result effect None + <code>atk</code> None + <code>charge</code> The player party member has the AttackUp condition + 1 The player party member has the AttackDown condition - 1 The player party member has the Poison condition + (amount of <code>PoisonAttacker</code> medals equipped - amount of <code>ReversePoison</code> medals equipped) NOTE: The <code>ReversePoison</code> influence here is incorrect, see the caveats section below for details The player party member's <code>hp</code> is 4 or less + amount of <code>AttackUp</code> medals equipped None - <code>tired</code>"},{"location":"Battle%20system/Damage%20pipeline/GetMultiDamage/#known-caveats","title":"Known caveats","text":"<p>There are a few known problems with this precalculation scheme when calling DoDamage without an attacker where the logic differs than the regular damage pipeline:</p> <ul> <li>The <code>ReversePoison</code> medals should normally have removed 1 defense, but here, it penalises the raw damages done from the player party side which is the same then removing 1 attack which isn't what the medal was supposed to do</li> <li>This method doesn't account for the front bonus CalculateBaseDamage normally accounts for and it cannot be accounted for because DoDamage has to be called without an attacker while a player attacker is required to process the front bonus</li> <li>This method doesn't manage the logic related to the <code>LifeSteal</code> medal and it cannot be accounted for because DoDamage has to be called without an attacker while a player attacker is required to process the effects of this medal</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/HardMode/","title":"HardMode","text":"<p>This is a helper method that returns a boolean telling whether or not hard difficulty scaling should apply.</p> <p>It's used primarily in the damage pipeline and in the actions logic to determine the scaling to use.</p> <p>It only returns true if one of the following is true (false is returned otherwise):</p> <ul> <li>The <code>DoublePain</code> medal is equipped</li> <li>flags 614 is true (HARDEST is enabled)</li> <li>flags 166 is true (EX Mode is active when using the B.O.S.S system)</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/IsInRadius/","title":"IsInRadius","text":"<p>This is a method that is primarily used in DamageWithinPos, but also in some player actions to check if an enemy party member's physical position (or world CenterPos) falls within a radius of a point.</p> <pre><code>private bool IsInRadius(Vector3 pos, MainManager.BattleData entity, float radius, bool getair, bool xonly)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/IsInRadius/#parameters","title":"Parameters","text":"<ul> <li><code>pos</code>: The point to check if the enemy party member is within a radius of</li> <li><code>entity</code>: The enemy party member that must will be checked to be within a radius of pos</li> <li><code>radius</code>: The distance to check if the enemy party member falls within pos</li> <li><code>getair</code>: If true, it forces to check only for the distance between pos and the world CenterPos of the enemy party member if its position is <code>Flying</code>. If it's false, it will check both the world CenterPos and physical position. NOTE: The game never calls the method where this value is false under normal gameplay</li> <li><code>xonly</code>: Only check for the x distance by zeroing out the y and z components of both points before comparising their distance</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/IsInRadius/#procedure","title":"Procedure","text":"<ul> <li>Both the physical position and the world CenterPos of the enemy party member are gathered in 2 local Vector3</li> <li>If <code>xonly</code> is true, both local Vector3 and pos have their y and z components zeroed out</li> <li>If getair is true and entity's position is <code>Flying</code>, the result returned will be whether or not the distance between pos (or its x component) and the physical position of the enemy party member (or its x component) is lower than radius</li> <li>Otherwise, the result is whether or not either the world CenterPos or physical position of the enemy party member has a distance from pos less than radius (again, if <code>xonly</code> is true, only the x components are compared).</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/Known%20design%20issues/","title":"Known issues of the damage pipeline","text":"<p>The damage pipeline of the game while known to have multiple logic and calculation errors on top of the many errors that exists within the action logic themselves (all are documented and mentioned when relevant), there are also some design issues. These issues aren't necessarilly caused by a programming mistake and more that the pipeline in general wasn't designed with what the game needed to perform its logic. These are more engineering problems that either prevents features to work well or requires imperfect workarounds. They are important enough to have affected a lot of the design decisions and are complex enough that it's worth to document them here in a separate page.</p>"},{"location":"Battle%20system/Damage%20pipeline/Known%20design%20issues/#it-is-impossible-to-call-dodamage-using-multiple-attackproperty","title":"It is impossible to call DoDamage using multiple AttackProperty","text":"<p>The parameter to DoDamage takes an <code>AttackProperty?</code> meaning either there is a property or no property denoted by the value <code>null</code>.</p> <p>This is very problematic because it comes up a lot during skills based player actions that the game wants to send multiple properties. For example: ideally, BeetleDig should have <code>Flip</code> and <code>Pierce</code> because it is an attack that ignores defense, but also can inflict Flipped to relevant enemy party members. Since it's not possible to send multiple properties, the action ends up sending <code>Pierce</code>, but compensate by doing what the <code>Flip</code> property logic would have done inside the action logic. Essentially, this ends up almost duplicating code: the logic that should have been reused from DoDamage is now duplicated inside the <code>BeetleDig</code> action logic.</p> <p>This can lead to strange inconsistencies because the logic wasn't duplicated correctly or the original changed, but not the copy. As an example, <code>BeetleDig</code> doesn't cause a stolen item to be dropped, but Beetle's basic attack will. This is because the basic attack has an actual <code>Flip</code> property which is the correctly logic, but <code>BeetleDig</code> has an incorrect duplicate of it. This is something that recurs a lot with many actions affected.</p>"},{"location":"Battle%20system/Damage%20pipeline/Known%20design%20issues/#it-is-impossible-to-tune-what-happens-to-the-total-damage-once-dodamage-is-called","title":"It is impossible to tune what happens to the total damage once DoDamage is called","text":"<p>This one more relates to a heavy restriction related to game balancing.</p> <p>The damageammount parameter is the only value that is tunable from the caller of the damage pipeline which usually is an action logic. This only partially covers the effects that a player can control which can often lead to damage amounts that add up very quickly, particularily with actions that contain multiple DoDamage calls.</p> <p>There is an intuitive distinction between what the parameter covers and what it doesn't. Anything that influences the <code>atk</code> value of the attacker is controllable, but anything that doesn't isn't. For a player party member, the <code>atk</code> value can be consulted easily in the pause menu inside the \"Medals &amp; Skills\" window.</p> <p>This creates heavy balancing restrictions because it now means that depending on the source of a damage bonus, it might be tunable by the game or be left completely unrestricted. A prime example of this is HardCharge: it offers 3 <code>charges</code> which increases the final damage output by 3, but the actions logic cannot tune this. It almost ALWAYS increases the result by 3, even if an action has 4 DoDamage calls, each will still have their results increased by 3 which leads to a grand total of 12 more damages that happened solely because of having 3 <code>charges</code>. This specific case happens to occur in the case of BeeRangMultiHit, HurricaneBeemerang and IceRain.</p> <p>The overall effect of this issue is that it is impossible to effectively control what happens with any multi hits skills. Their output is only partially controlled by the game and the part that it can't control is something the player can. This disproportionally benefits players who uses a heavy amount of damage bonuses that do not affect their <code>atk</code>, but rather are applied during the damage pipeline. Since the game already offers many sources of these, it can easily get out of hand. Since it is how the damage pipeline works by design, this can't be addressed without a complete refactor.</p> <p>There are however known mitigations that the game tried to do, but aren't perfect. One example would be heavily dampening the amount to send to DoDamage on each hits of IceBeemerang. This however has the very strange outcome that even if the player has a higher <code>atk</code> value, their damage will get clamped down to 0 relatively fast, but if they have a lot of bonuses outside of their <code>atk</code>, they stack up REALLY fast to the point of defeating most enemies after the action. In other words: it's either low damage or high damage and there's not much in between.</p>"},{"location":"Battle%20system/Damage%20pipeline/Known%20design%20issues/#it-is-impossible-to-have-more-than-one-attacker","title":"It is impossible to have more than one attacker","text":"<p>This only affects MultiSkillsMove except for IceBeemerang which means any action where multiple player party members combine their <code>atk</code> to deal damage.</p> <p>DoDamage only support a limited about of attack flow:</p> <ul> <li>No attacker to player party member</li> <li>No attacker to enemy party member</li> <li>Player party member to enemy party member</li> <li>Enemy party member to player party member</li> </ul> <p>However, it doesn't support having multiple attackers. This means that player actions where multiple player party members are involved can't really work as is with the current damage pipeline. It's possible to do what IceBeemerang did and have each player party members attack individually, but it's often not desired. What would be ideal is a way to have members combine their <code>atk</code> and benefits together to compute the final amount of damage to deal.</p> <p>Since this isn't possible, there is a workaround available called GetMultiDamage which allows to send the trueid of the player party members involved and it will precalcucale most attack benefits on top of their <code>atk</code>. From there, this resulting amount is sent to DoDamage, but without an attacker. This essentially \"forces\" the damage amount to not be affected by the <code>atk</code> or their attack benefits.</p> <p>This workaround however comes with a lot of caveats which are outlined in the documentation page about the method. It also has a strange interaction with the balancing restrictions mentioned above: since it is the only way the game can sort of dampen the total damage dealt, it makes these move deal a lot less damages than other multi hits coming from a single player party member. This has the side effect to decentivise their usage against the multi hits one which the player can exploit the balancing restrictions.</p>"},{"location":"Battle%20system/Damage%20pipeline/PartyDamage/","title":"PartyDamage","text":"<p>A method specifically for enemy actions that calls DoDamage for each player party member whose <code>hp</code> is above 0. The method also supports adding some visual effects such as jumping or spinning.</p> <pre><code>private void PartyDamage(int caller, int damage, AttackProperty? property, bool block, float jumpheight, Vector3 spinammount, bool jumpevenonblock, DamageOverride[] overrides)\n</code></pre> <p>There is also an overload that relays to the method except for the following parameters which are ommited:</p> <ul> <li><code>jumpheight</code>: 0.0</li> <li><code>spinammount</code>: Vector3.zero</li> <li><code>jumpevenonblock</code>: false</li> <li><code>overrides</code>: null</li> </ul> <pre><code>private void PartyDamage(int caller, int damage, AttackProperty? property, bool block)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/PartyDamage/#parameters","title":"Parameters","text":"<ul> <li><code>caller</code>: The <code>enemydata</code> index that will be used as the attacker of the DoDamage calls</li> <li><code>damage</code>: The damageammount that will be passed to the DoDamage calls</li> <li><code>property</code>: The property that will be passed to the DoDamage calls</li> <li><code>block</code>: The block that will be passed to the DoDamage calls</li> <li><code>jumpheight</code>: If this is higher than 0.1 and either <code>block</code> is false or <code>jumpevenonblock</code>, all the affected player party members will jump once DoDamage is called on them</li> <li><code>spinammount</code>: If this is higher than 0.1, a SlowSpinStop will happen on all of the affected player party members after DoDamage is called on them with this value as the spnammount and 60.0 frametime</li> <li><code>jumpevenonblock</code>: If <code>jumpheight</code> is higher than 0.1, the jumping animation will always happen even if <code>block</code> is true. This parameter does nothing if <code>jumpheight</code> is 0.1 or lower</li> <li><code>overrides</code>: The overrides that will be passed to the DoDamage calls</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/PartyDamage/#procedure","title":"Procedure","text":"<p>The following happens for each player party member whose <code>hp</code> is above 0:</p> <ul> <li>DoDamage is called using the parameters mentioned above and the player party member as the target</li> <li>If jumpheight is higher than 0.1 and either block is false or jumpevenonblock is true:<ul> <li>The player party member's <code>overridejump</code> is set to true</li> <li>Jump called on the player party member with an h of jumpheight</li> <li>ResetOverrides invoked on the player party member in 1.25 seconds</li> </ul> </li> <li>If spinammount is higher than 0.1, SlowSpinStop is called on the player party member with the spinammount and a frametime of 60.0</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/Projectile/","title":"Projectile","text":"<p>This is a coroutine that is specifically made to be implemented as part of an enemy action involving a DoDamage call through the use of a projectile attacks towards a player party member if their <code>hp</code> is above 0.</p> <p>To check that the coroutine is done, <code>obj</code> needs to be checked to be null as it will be destroyed at the very end which will eventually change its value to null.</p> <pre><code>private IEnumerator Projectile(int damage, AttackProperty? property, MainManager.BattleData attacker, int playertarget, Transform obj, float speed, float height, string extraargs, string destroyparticle, string audioonhit, string audiomoving, Vector3 spin, bool nosound)\n</code></pre> <p>There is also an overload available that calls the one above with the same parameters except <code>height</code> which will have a value of 0.0 followed by a yield break:</p> <pre><code>private IEnumerator Projectile(int damage, AttackProperty? property, MainManager.BattleData attacker, int playertarget, Transform obj, float speed, string extraargs, string destroyparticle, string audioonhit, string audiomoving, Vector3 spin, bool nosound)\n</code></pre>"},{"location":"Battle%20system/Damage%20pipeline/Projectile/#parameters","title":"Parameters","text":"<ul> <li><code>damage</code>: The damageammount value to send to DoDamage</li> <li><code>property</code>: The property value to send to DoDamage</li> <li><code>attacker</code>: The attacker value to send to DoDamage</li> <li><code>playertarget</code>: The index of the <code>playerdata</code> that will be used as the target actor to send to DoDamage. If this is negative or at least the length of <code>playerdata</code> or the battleentity of the <code>playerdata</code> is null, the coroutine will end early by destroying <code>obj</code> followed by a yield break</li> <li><code>obj</code>: The projectile object's transform that will be moved during the attack. If it has a <code>NoMapColor</code> tag, it will avoid to change all materials of all SpriteRenderers under <code>obj</code> to <code>spritemat</code> (it's possible to do the same without the tag using the <code>keepcolor</code> command, see the section below for details)</li> <li><code>speed</code>: The meaning depends on if it's less than 1.0 or not:<ul> <li>If it's less than 1.0, this represents a game's frametime fraction that will be added to the <code>obj</code>'s movement curve progression factor each frame. Effectively, it means that <code>obj</code> will move towards the target over the course of (1 / this value) amount of frames so a value of 0.02 means <code>obj</code> will be moved over the course of 50.0 frames</li> <li>If it's at least 1.0, this represent the amount of frames that <code>obj</code> will take in its movement curve before reaching the target</li> </ul> </li> <li><code>height</code>: If it's 0.0, <code>obj</code> will be moved using a lerp. If it's not, it will be moved using a BeizierCurve3 with this value being the ymax of the curve</li> <li><code>extraargs</code>: An optional list of extra commands that can take effect before or after the DoDamage call. See the section below for more details on the commands and the format. This is optional, a value of null means no commands will take effect</li> <li><code>destroyparticle</code>: The name of the particles under the <code>Prefabs/Particles/</code> path of the rssources tree to play after the DoDamage call before the projectile gets destroyed. This is optional, a value of null won't play any particles</li> <li><code>audioonhit</code>: The name of the AudioClip under the <code>Audio/Sounds/</code> path of the resources tree to play after the DoDamage call before the projectile gets destroyed. This is optional, a value of null won't play any AudioClip</li> <li><code>audiomoving</code>: The name of the AudioClip under the <code>Audio/Sounds/</code> path of the resources tree to play before <code>obj</code> starts to move on loop until the projectile gets destroyed. If the name is prepanded with a <code>@</code>, it will not play the AudioClip on loop. The name is resolved after removing all <code>@</code> in the value to allow this feature to function. This is optional: a value of null or empty string won't play a clip</li> <li><code>spin</code>: A multiplier to the game's frametime that controls the angles of <code>obj</code> after each frame of movement. The angles gets incremented by the game's frametime * this value each frame. A value of Vector3.zero will cause no angle changes</li> <li><code>nosound</code>: If this is true, the DoDamage call will have an overrides value of {NoSound}. If this is false, the DoDamage call will have an overrides value of null</li> </ul>"},{"location":"Battle%20system/Damage%20pipeline/Projectile/#extraargs-format","title":"extraargs format","text":"<p>This parameter is a <code>,</code> separated list of strings each representing a command. Each command is a <code>@</code> separated list of strings where the first element is the name of the command and the rest are its parameters if any are supplied.</p> <p>A command can take effect before <code>obj</code> is moved or after the DoDamage call. Each command gets executed in the order than they appear when the moment of effect is reached.</p> <p>Here are the different commands available and their parameters</p> Name Moment of effect Parameters Effect wait Before <code>obj</code> is moved <ol><li>float: The amount of secconds to wait</li></ol> Yield for a certain amount of seconds anim Before <code>obj</code> is moved <ol><li>string: The animation clip's name to play</li></ol> Plays an animation clip on the Animator component of <code>obj</code> keepcolor Before <code>obj</code> is moved None This command will make it so that the material of all SpriteRenderers under <code>obj</code> won't be set to <code>spritemat</code>. NOTE: If <code>obj</code> has a <code>NoMapColor</code> tag, the same effect will occur without the need of this command SepPart After DoDamage call <ol><li>int: The child index of <code>obj</code> to destroy</li><li>float: The amount of time in seconds before the destruction of the child</li></ol> Destroys a child of <code>obj</code> after a certain amount of seconds ellapsed. Right before the destruction, the transform gets rooted and placed offscreen at 999.0 in y resetcam After DoDamage call None Calls SetDefaultCamera animhit After DoDamage call <ol><li>string: The animation clip's name to play</li></ol> Plays an animation clip on the Animator component of <code>obj</code> destoffscr After DoDamage call <ol><li>float: The ymax of the BeizierCurve3 used to move <code>obj</code> offscreen past the player party</li><li>float: The amount of frames - 1.0 to move <code>obj</code> offscreen past the player party</li></ol> Causes the audioonhit and destroyparticle effects to take place earlier before setting their value to null so they don't take effect later. After, <code>obj</code> gets moved offscreen past the player party at (-15.0, 0.0, 0.0) using a BeizierCurve3 atkdown After DoDamage call <ol><li>int: The default amount of turns to inflict AttackDown</li><li>string: If it's <code>2</code>, the amount of turns to inflict AttackDown is param 3 when <code>commandsuccess</code> is true (blocked) or param 1 if it's false (not blocked). If it's <code>1</code>, the condition is not inflicted if <code>commansuccess</code> is true (blocked)</li><li>int: The amount of turns to inflict AttackDown if param 2 is <code>2</code> and <code>commandsuccess</code> is true (this does nothing if param 2 isn't <code>2</code>)</li></ol> Calls StatusEffect to inflict AttackDown with visual effect on the target for a certain amount of turns. This command supports not inflicting if the player blocked<sup>1</sup> sucessfully or to inflict using a different amount of turns if the player blocked<sup>1</sup> <p>1: This logic disregard the FRAMEONE modifier which is flags 615 because even regular blocks will count here.</p>"},{"location":"Battle%20system/Damage%20pipeline/Projectile/#procedure","title":"Procedure","text":"<ul> <li>playertarget is checked and if it's not in bounds of <code>playerdata</code> or if it is, but the battleentity is null, obj is destroyed followed by an early yield break.</li> <li>The extraargs commands that are set to take effect before obj movement are executed. See the section above for details</li> <li>The target position of obj is set to the <code>playerdata[playertarget]</code>'s position + (0.0, 1.0, -0.2)</li> <li>Unless a <code>keepcolor</code> command was processed or that obj has a tag of <code>NoMapColor</code>, all materials of all SpriteRenderers under obj are set to <code>spritemat</code></li> <li>If audiomoving isn't null or empty, an AudioSource is added to obj with the clip set to the resource at <code>Audio/Sounds/</code> + audiomoving (after removing all <code>@</code>), the volume set to MainManager.<code>soundvolume</code> and the loop to be true unless audiomoving started with <code>@</code> where it's false. The clip is then played immediately</li> <li>obj is moved as described by the parameters section above using the speed, spin and height values</li> <li>If <code>playerdata[playertarget]</code>'s <code>hp</code> is above 0, the DoDamage call happens with:<ul> <li>attacker: The sent attacker value</li> <li>target: <code>playerdata[playertarget]</code></li> <li>damageammount: The sent damage value</li> <li>property: The sent property value</li> <li>overrides: null if nosound is false, {NoSound} if it's true</li> <li>block: <code>commandsuccess</code></li> </ul> </li> <li>The extraargs commands that are set to take effect after the DoDamage call are executed. See the section above for details</li> <li>If destroyparticle isn't null and no <code>destoffscr</code> commands were processed, PlayParticle is called to play the destroyparticle particles at the obj's position</li> <li>If audioonhit isn't null and no <code>destoffscr</code> commands were processed, PlaySound is called to play the audioonhit sound</li> <li>obj is destroyed</li> <li>Yield for a frame</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/ChangePosition/","title":"ChangePosition","text":"<p>A coroutine specifically made to be used inside an enemy action which allows to smoothly change the position of the enemy party member. When the coroutine completes, <code>checkingdead</code> is set to null to inform the caller so it can yield on it.</p> <p>Changing to <code>Flying</code> or <code>Ground</code> is supported as well as changing from <code>Underground</code> to <code>Ground</code> (but not <code>Flying</code>). Changing to <code>Underground</code> isn't supported (use Dig for that instead).</p> <pre><code>private IEnumerator ChangePosition(int entityid, BattlePosition position)\n</code></pre>"},{"location":"Battle%20system/Enemy%20actions/ChangePosition/#parameters","title":"Parameters","text":"<ul> <li><code>entityid</code>: The <code>enemydata</code> index that will change its <code>position</code></li> <li><code>position</code>: The new BattlePosition to set. While any values will end up being set, not all of them will act smoothly, see the section above for details. If this new position is the same than the current one, this coroutine does nothing except setting <code>checkingdead</code> to null</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/ChangePosition/#procedure","title":"Procedure","text":"<p>If the new position is the same than the enemy party memebr's <code>position</code>, the coroutine does nothing except setting <code>checkingdead</code> to null to inform the caller that it is completed.</p> <p>Otherwise:</p> <ul> <li>Over the course of 20.0 frames, the enemy party member's <code>height</code> changes from <code>initialheight</code> to <code>minheight</code> (from <code>minheight</code> to <code>initialheight</code> instead if the new position is <code>Flying</code>) via a lerp</li> <li>If the new position is <code>Flying</code>:<ul> <li>The enemy party member's <code>bobrange</code> and <code>bobspeed</code> are set to their <code>startbf</code> and <code>startbs</code> respectively</li> <li>The enemy party member's <code>height</code> is set to their <code>initialheight</code></li> </ul> </li> <li>Otherwise:<ul> <li>If the current position is <code>Underground</code>:<ul> <li>The enemy party member's <code>digging</code> is set to false</li> <li>Yield all frames until the enemy party member's <code>digtime</code> reached 0.0 or below</li> <li>Yield for 0.25 seconds</li> </ul> </li> <li>The enemy party member's <code>bobrange</code> and <code>bobspeed</code> are set to 0.0</li> <li>The enemy party member's <code>height</code> is set to their <code>minheight</code></li> </ul> </li> <li>The enemy party member's <code>position</code> is set to the new position</li> <li><code>checkingdead</code> is set to null informing the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Dig/","title":"Dig","text":"<p>A coroutine made for enemy actions to have the enemy dig and change its position to <code>Underground</code>.</p> <p>The coroutine should be stored in <code>checkingdead</code> as it will be set to null when completed so the caller can yield on it.</p> <pre><code>private IEnumerator Dig(int enemyid, int jump)\n</code></pre> <p>There is an overload available that sends 1 as the jump and relays the enemyid where it sets <code>checkingdead</code> to a new coroutine being the one above followed by a frame yield:</p> <pre><code>private IEnumerator Dig(int enemyid)\n</code></pre>"},{"location":"Battle%20system/Enemy%20actions/Dig/#parameters","title":"Parameters","text":"<ul> <li><code>enemyid</code>: The <code>enemydata</code> index of the enemy party member that will be digging</li> <li><code>jump</code>: The amount of jump the enemy party member will do before digging</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Dig/#procedure","title":"Procedure","text":"<ul> <li>Done jump amount of times:<ul> <li>Jump called on the enemy party member</li> <li><code>Jump</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until the enemy party member's <code>onground</code> is true</li> </ul> </li> <li><code>Dig</code> sound plays</li> <li>The enemy party member's <code>digging</code> is set to true</li> <li>Yield all frames until the enemy party member's <code>digtime</code> becomes 29.0 or above</li> <li>Yield for 0.25 seconds</li> <li>The enemy party member's position is set to <code>Underground</code></li> <li><code>checkingdead</code> is set null indicating the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/","title":"Enemy actions","text":"<p>This directory contains all the enemy actions logic contained in DoAction. They are important and complex enough to warrant its own directory in the BattleControl documentation.</p> <p>An enemy action is any piece of logic that is specific to the case where the actor sent to DoAction is an enemy party member. In that case, the actionid is interpreted as the <code>enemydata</code> index and the enemy party member's enemy id determines the action logic that will be processed.</p> <p>Anything else is detailed in the DoAction documentation. For the player actions, check the player actions documentation.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#how-enemy-actions-work-and-how-to-read-their-documentation","title":"How enemy actions work and how to read their documentation","text":"<p>This section can be served as a guide to the enemy action documentations linked below as it explains how an action is typically organised and how the documentation reflects that.</p> <p>Each enemy entry has one action, but its complexity allows them to perform many different tasks within that same action. While each actions is free to do anything, they tend to follow a loosely defined structure that flows in this order:</p> <ul> <li>Pre move logic (optional)</li> <li>Move selection (mandatory)</li> <li>Move logic slated for usage (mandatory)</li> <li>Post move logic (optional)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#the-move-concept","title":"The move concept","text":"<p>A \"move\" in an enemy action page is loosely defined as a specific code path within the enemy action where they perform specific tasks at the expense of others. There isn't any concrete concept of a \"move\", but it exists loosely throughout the various enemy actions implementations. In fact, they don't have any names so each enemy documentations will indentify them by a number and a description that mostly reflects what the move does.</p> <p>Each moves contains all the damage pipeline and their high level logic. The logic doesn't contain everything, but it contains enough to identify the animations, audio and most importantly, the block timings from the player side. Each moves also contains notices about modifiers applied such as <code>nonphysical</code> and <code>dontusecharge</code>, see the DoAction documentation to learn more about them.</p> <p>The decision of which move to use is often complex and it involves another key concept of enemy actions: the move selection process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#the-move-selection-process","title":"The move selection process","text":"<p>An enemy action typically (there's some exceptions) don't operate deterministically with each other. They have a decision making process that frequently involves RNG or other more deterministic conditions. This process exists in various forms, but a very common one is generating a number using weighted RNG odds and use that number as a switch statement whose arms leads to the different moves's logic. This isn't always the case and the action might employ a mix of methods to make this decision, but the end goal is the same: there's always a decision process in which a move gets selected in the end. </p> <p>This process is what is reffered to as the \"move selection\" process. Every actions is assumed to have one in the documentation pages as the vast majority does have a process to determine this. It helps to reason that this concept exists even though there is nothing preventing an action from doing anything outside of this and there's no concept that defines this formally. The move selection also might not always have the same odds: enemies can decide to change the weights of them under certain conditions. In all cases, the documentation will always have a move selection section that documents this process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#about-rerolls-and-redirection","title":"About rerolls and redirection","text":"<p>This selection process however isn't always simple as selecting a move and using it right away. Several enemies might not want to use certain moves under certain conditions. Due to the way the enemy actions are commonly done, the prefered method to implement this is rejection sampling: let the move selection process select a move, but falback if it's found that the move shouldn't be used.</p> <p>This creates a distinction between when a move is SELECTED and when it is USED. The former might not always implies the latter as it's possible the falback is to use another move instead or to leverage the enemy action loop by issuing a continue directive to the enemy action loop.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#enemy-action-loop","title":"Enemy action loop","text":"<p>The enemy action loop is a special loop that encloses every enemy actions logic in a \"while(true)\" block. This isn't infinite since the loop always breaks out once the action is done, but it allows actions to issue a \"continue\" directive on it.</p> <p>What this will do is restart the action logic without actually ending the action. It's essentially used as a more complex \"goto\" statement, but specific to enemy actions logic. The main usage of this feature is when a move is selected, but its usage was deemed to not fufill their requirements. Since enemy actions would rather prefer to use refjection sampling, issuing a continue directive allows to reroll the move selection process because it's something that's typically done very early in the action logic.</p> <p>Not all actions employ this method (it might not always be feasible), but a lot do which is enough to mention it specifically as the enemy action loop.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#data-slots","title":"<code>data</code> slots","text":"<p>Every actor has a <code>data</code> field which is an int array, but it's exclusively reserved for enemy actions. It's a general purpose integer array to keep track of various information that the enemy needs to preserve accross multiple actor turns (as each actor turn is a separate DoAction call). It's an optional features: enemies don't have to use it, but it's there if they need it.</p> <p>The enemy action is what decides the amount of slots to use if any and their entire semantics or valid values. Due to this, each documentation has a section about their usage if they are used. Typically, the initialisation of the field is done if it's not null as the starting value on the enemy's first actor turn is null.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#about-hardmode-changes","title":"About HardMode changes","text":"<p>While HardMode already affects the enemydata loading process to scale some stats with the difficulty, this isn't the only way enemies changes with it. Each action very frequently introduces a tailored set of changes if HardMode returns true. It's used so much that DoAction has a local declared called \"hardmode\" which is set to the return of HardMode which enemy actions logic can consult easily.</p> <p>Due to how important these logic changes are in enemy actions with difficulty scaling, each enemies actions will have a dedicated section covering all the changes if HardMode returns true or any other relevant difficulty scaling information.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#about-assumptions","title":"About assumptions","text":"<p>Not all enemies are expected to function in all situations. There are enemies which are expected to operate in certain conditions, but there's nothing in the action logic that would enforce those condtions. In other words, they are assumed.</p> <p>Enemy actions documentation will contain a section that details what is assumed and why the enemy wouldn't work properly if those assumptions aren't respected.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#about-out-of-actions-logic","title":"About out of actions logic","text":"<p>Enemies might have specific logic done outside of DoAction. If that's the case, the enemy actions pages will contain sections to indicate them.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemy%20actions/#enemy-actions-table","title":"Enemy actions table","text":"<p>Since the vast majority of the enemies in the game have their own action logic, their links will be listed per enemy id in the following table:</p> ID Name English Name Notes 0 CordycepsAnt Zombiant 1 Mushroom Jellyshroom 2 Spuder Spider 3 Zasp Zasp 4 Cactus Cactiling 5 Pseudoscorpion Psicorp 6 Thief Thief 7 Bandit Bandit 8 ArmoredPoly Inichas 9 Seedling Seedling 10 FlyingSeedling Flying Seedling This enemy has no action logic 11 MakiTutorial Maki 12 MothWeb Web This enemy has no action logic 13 SpuderReal Spider This enemy has no action logic 14 Sneil Numbnail 15 Mothiva1 Mothiva 16 Acornling Acornling 17 Weevil Weevil 18 MrTester Mr. Tester 19 AngryPlant Venus' Bud 20 FlyTrap Chomper 21 Acolyte Acolyte Aria 22 AcolyteVine Vine This enemy has no action logic 23 Beetle Kabbu 24 VenusBoss Venus' Guardian 25 WaspTrooper Wasp Trooper 26 WaspBomber Wasp Bomber 27 WaspDriller Wasp Driller 28 WaspHealer Wasp Scout 29 Midge Midge 30 Underling Underling 31 Scarlet Monsieur Scarlet 32 GoldenSeedling Golden Seedling 33 Sandworm Arrow Worm 34 Carmina Carmina 35 SeedlingKing Seedling King 36 MidgeBroodmother Broodmother 37 Plumpling Plumpling 38 Flowering Flowerling 39 Burglar Burglar 40 BanditLeader Astotheles 41 MotherChomper Mother Chomper 42 Ahoneynation Ahoneynation 43 BeeBot Bee-Boop 44 BeeTurret Security Turret 45 ShockWorm Denmuki 46 BeeBoss Heavy Drone B-33 47 MenderBot Mender 48 Abomihoney Abomihoney 49 Scorpion Dune Scorpion 50 SandWyrm Tidal Wyrm 51 Kali Kali 52 Zombee Zombee 53 Zombeetle Zombeetle 54 ZombieRoach The Watcher 55 PeacockSpider Peacock Spider 56 Bloatshroom Bloatshroom 57 Krawler Krawler 58 Cape Haunted Cloth 59 SandWall Sand Wall 60 IceWall Ice Wall 61 CursedSkull Warden 62 WaspKingIntermission Wasp King 63 JumpingSpider Jumping Spider 64 MimicSpider Mimic Spider 65 LeafbugNinja Leafbug Ninja 66 LeafbugArcher Leafbug Archer 67 LeafbugClubber Leafbug Clubber 68 SkullCaterpillar Madesphy 69 Centipede The Beast 70 ChomperBrute Chomper Brute 71 Mantidfly Mantidfly 72 WaspGeneral General Ultimax 73 WildChomper Wild Chomper 74 TermiteSoldier Cross 75 TermiteNasute Poi 76 PrimalWeevil Primal Weevil 77 FalseMonarch False Monarch 78 Mothfly Mothfly 79 MothflyCluster Mothfly Cluster 80 Ironclad Ironnail 81 ToeBiter Belostoss 82 Ruffian Ruffian 83 Strider Water Strider 84 DivingSpider Diving Spider 85 Cenn Cenn 86 Pisci Pisci 87 DeadLanderA Dead Lander \u03b1 88 DeadLanderB Dead Lander \u03b2 89 DeadLanderG Dead Lander \u03b3 90 WaspKing Wasp King 91 EverlastingKing The Everlasting King 92 Maki Maki 93 Kina Kina 94 Yin Yin 95 UltimaxTank ULTIMAX Tank 96 Zommoth Zommoth 97 Fisherman Riz 98 Pitcher Devourer 99 SandWyrmTail Tail 100 PisciWall Rock Wall This enemy has no action logic 101 KeyR Ancient Key 102 KeyL Ancient Key 103 Tablet Ancient Tablet 104 PitcherFlytrap Flytrap 105 FireKrawler FireKrawler This enemy has no action logic 106 FireWarden FireWarden This enemy has no action logic 107 FireCape FireCape This enemy has no action logic 108 IceKrawler IceKrawler This enemy has no action logic 109 IceWarden IceWarden This enemy has no action logic 110 TANGYBUG |glitchy,1|TANGYBUG|glitchy| 111 Stratos Stratos 112 Delilah Delilah"},{"location":"Battle%20system/Enemy%20actions/EnemyFlee/","title":"EnemyFlee","text":"<p>A coroutine mode for enemy actions to have an enemy party member flee the battle. This will set their <code>fled</code> to true and <code>enemyfled</code> to true alongside an animation to move them offscreen.</p> <p>The coroutine should be stored in <code>tryenemyheal</code> as it will be set to null when completed so the caller can yield on it.</p> <pre><code>private IEnumerator EnemyFlee(int walkstate, bool afterimage, int enemyid)\n</code></pre>"},{"location":"Battle%20system/Enemy%20actions/EnemyFlee/#parameters","title":"Parameters","text":"<ul> <li><code>walkstate</code>: The animstate to use when the enemy party member</li> <li><code>afterimage</code>: Whether or not to enable the enemy party member's <code>trail</code> during the move</li> <li><code>enemyid</code>: The <code>enemydata</code> index of the enemy party member that will flee</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/EnemyFlee/#procedure","title":"Procedure","text":"<ul> <li><code>Scuttle2</code> sound plays on loop using <code>sounds[9]</code></li> <li>animstate set to the sent walkstate</li> <li><code>flip</code> set to true</li> <li>Jump called</li> <li>Yield for 0.4 seconds</li> <li><code>sounds[9]</code> pitch set to 1.25</li> <li>Yield all frames until the enemy party member's <code>onground</code> is true</li> <li>The enemy party member's <code>trail</code> set to afterimage</li> <li><code>Flee</code> sound plays</li> <li><code>sounds[9]</code> stop with 0.001 delay</li> <li>Over the course of 50.0 frames, the enemy party member's position changes to offscreen at (15.0, 0.0, 0.0) via a lerp. Before each frame yield, the animstate is set to the sent walkstate</li> <li>The enemy party member's <code>fled</code> set to true</li> <li><code>tryenemyheal</code> set to null informing the caller that the coroutine completed</li> <li><code>enemyfled</code> set to true</li> <li><code>sounds[9]</code> stop with 1.0 delay</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/ReviveEnemy/","title":"ReviveEnemy","text":"<p>A method specifically made for enemy actions that allows to bring back an enemy party member that was in <code>reservedata</code> back to <code>enemydata</code> with a certain percentage of <code>hp</code> left and the optional ability to be able to act immediately after the revive.</p> <pre><code>private void ReviveEnemy(int reserveid, float hppercent, bool canmove)\n</code></pre>"},{"location":"Battle%20system/Enemy%20actions/ReviveEnemy/#parameters","title":"Parameters","text":"<ul> <li><code>reserveid</code>: The <code>reservedata</code> index of the enemy party member to revive</li> <li><code>hppercent</code>: The fraction of <code>hp</code> to leave the enemy party member with over its <code>maxhp</code> ceiled. This is meant to be higher than 0.0, but at most 1.0</li> <li><code>canmove</code>: If true, the <code>cantmove</code> of the enemy party member after the revive will be set to 0 (one actor turn available). If it's false, it will be set to 1 (no actur turns available until the next main turn)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/ReviveEnemy/#procedure","title":"Procedure","text":"<ul> <li>The enemy party member in <code>reservedata</code> with index reserveid is removed, but added to the end of of <code>enemydata</code></li> <li>The now revived enemy party member has these fields set on them:<ul> <li><code>hp</code>: <code>maxhp</code> * hppercent ceiled</li> <li><code>exp</code>: 0</li> <li><code>money</code>: 0</li> <li><code>cantmove</code>: 1 (0 instead if canmove is true)</li> <li><code>turnssincedeath</code>: 0</li> <li><code>turnsalive</code>: 0</li> <li><code>hitaction</code>: false</li> </ul> </li> <li>ClearStatus called on the now revived enemy party member</li> <li>Revive called on the <code>battleentitiy</code> of the now revived enemy party member</li> <li>The now revived enemy party member's <code>alreadycounted</code> is set to true (so the amount defeated doesn't go up again in the bestiary if they die again)</li> <li>ReorganizeEnemies called with order</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/StealItem/","title":"StealItem","text":"<p>A method that has an enemy party member attempt to steal an item from the player's standard items inventory and returns a bool indicating if an item was actually stolen or not.</p> <pre><code>private bool StealItem(int enemyid, bool always, bool noanim)\n</code></pre> <p>There are 2 overloads that ends up calling the one above. The following one sends false as <code>noanim</code>:</p> <pre><code>private bool StealItem(int enemyid, bool always)\n</code></pre> <p>And this one one send false as <code>always</code> and false as <code>noanim</code>:</p> <pre><code>private bool StealItem(int enemyid)\n</code></pre>"},{"location":"Battle%20system/Enemy%20actions/StealItem/#parameters","title":"Parameters","text":"<ul> <li><code>enemyid</code>: The <code>enemydata</code> of the enemy party member that will attempt the stealing</li> <li><code>always</code>: If true, the enemy party member will always attempt to steal if it can. If false, it will only do it if <code>commandsuccess</code> is false (meaning the last block or action command was failed)</li> <li><code>noanim</code>: If true, the enemy party member won't have their animstate changed to 27 (<code>ItemWalk</code>) during the stealing if it happens</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/StealItem/#steal-conditions","title":"Steal conditions","text":"<p>Here are all the conditions needed for the enemy party member to actually steal:</p> <ul> <li>Either always is true or <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE)</li> <li><code>items[0]</code> contains at least one standard item</li> <li>The enemy party member doesn't already have a <code>holditem</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/StealItem/#procedure","title":"Procedure","text":"<ul> <li>If the <code>SecurePouch</code> medal is equipped, false is returned early and no stealing happens</li> <li>If the conditions needed to steal mentioned above aren't fufilled, false is returned. Otherwise:<ul> <li>If noanim is false, the enemy party member animstate is set to 27 (<code>ItemWalk</code>)</li> <li>A random valid item id among <code>items[0]</code> is generated which will be the item that will be stolen</li> <li>CreateHeldItem is called with the item id which initialises the enemy party member's <code>helditem</code> to be a new SpriteRenderer corresponding to the <code>itemsprites</code> from the id generated childed to the enemy party member's <code>sprite</code> using the <code>spritemar</code> material on layer 14 (<code>Sprite</code>) with a FaceCamera component. It also sets the <code>holditem</code> of the enemy party member to the item id generated</li> <li>The item element is removed from <code>items[0]</code></li> <li><code>ItemStolen</code> sound plays</li> <li>true is returned</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/","title":"<code>Abomihoney</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy gets loaded with an onhitaction of 3 so this enemy's <code>hitaction</code> logic works.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#data-usage","title":"<code>data</code> usage","text":"<p>During the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0. An unitialised value is possible, but it will be treated the same was as if it was 0.</p> <ul> <li><code>data[0]</code>: This remains at 0 until the bomb transformation move is used where it's set to 1. The value being 1 means the bomb explosion move will be used on the next actor turn</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The RNG check required to use the Ahoneynation healing move when all other conditions are fufilled has its odds changed to 51% from 41%</li> <li>The HPPercent threshold required to use the bomb transform move when all other conditions are fufilled changes to being below 0.75 from 0.5</li> <li>The RNG check required to use the bomb transform move when all other conditions are fufilled has its odds changed to 41% from 31%</li> <li>In the bomb transformation move, this enemy gets a DefenseUp condition for 99999 main turns (effectively infinite)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If position is <code>Ground</code> and either <code>data[0]</code> is 0 or wasn't initialised yet (meaning the bomb explosion move isn't slated to be used on the next actor turn):<ul> <li>animstate set to 104</li> <li><code>Puddle</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>digging</code> set to true</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>position set to <code>Underground</code></li> <li>The local startstate is set to 31 (<code>Dig</code>)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A single target grounded bite attack</li> <li>A single target underground bite attack</li> <li>Sacrifice themselves to heal all their remaining <code>hp</code> to a Ahoneynation</li> <li>Turns into a bomb that will explode on their next actor turn</li> <li>Explode as a bomb which kills themselve, but  dealing damages to everyone except other other <code>Abomihoney</code> and Ahoneynation which gets healed</li> </ol> <p>Every moves requires specific conditions to be used and some of them requires an RNG check. Here is the decision process done in order:</p> <ul> <li>If position is <code>Underground</code>, move 2 is used</li> <li>Otherwise, if all of the following conditions are fufilled, move 3 is used:<ul> <li>A Ahoneynation is present</li> <li>The first Ahoneynation in <code>enemydata</code> has an HPPercent below 0.6</li> <li><code>locktri</code> is true (this can only happen under normal gameplay if this enemy was summoned by Ahoneynation)</li> <li>A 41% RNG check passes (51% instead if hardmode is true)</li> </ul> </li> <li>Otherwise, if <code>data[0]</code> is 1 (meaning move 4 was used on their last actor turn), move 5 is used</li> <li>Otherwise, move 4 is used if all of the following conditions are fufilled:<ul> <li><code>locktri</code> is false (meaning this isn't an enemy summoned by Ahoneynation)</li> <li>HPPercent is less than 0.5 (0.75 instead if hardmode is true)</li> <li>A 31% RNG check passes (41% instead if hardmode is true)</li> </ul> </li> <li>Otherwise (no other moves was slated for usage), move 1 is used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#move-1-grounded-bite","title":"Move 1 - Grounded bite","text":"<p>A single target grounded bite attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> + (1.5, 0.0, -0.1) with 1.0 multiplier (2.0 instead if this enemy x position is higher than 3.0)</li> <li><code>PuddleMove</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code> with 1.15 pitch</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sound</code> is set to stop looping and stopped</li> <li>Yield for a frame</li> <li>animstate set to 100</li> <li><code>Bite3</code> sound plays</li> <li>Yield for 0.65 seconds</li> <li>animstate set to 102</li> <li><code>Bite2</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.7 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#move-2-underground-bite","title":"Move 2 - Underground bite","text":"<p>A single target underground bite attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>PuddleMove</code> sound plays on this enemy</li> <li><code>sound</code> is set to loop</li> <li>MoveTowards <code>playertargetentity</code> + (0.0, 0.0, -0.1) with 1.6 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sound</code> is set to stop looping and stopped</li> <li>animstate set to 106</li> <li><code>Bite4</code> sound plays</li> <li>Yield for 0.1 seconds</li> <li>Jump called with an h of 15.0</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.75 seconds</li> <li>MoveTowards + 2.75 in x with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 105</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>position set to <code>Ground</code></li> <li>The local startstate is set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#move-3-sacrifice-and-heals-a-ahoneynation","title":"Move 3 - Sacrifice and heals a Ahoneynation","text":"<p>Sacrifice themselves to heal all their remaining <code>hp</code> to a Ahoneynation. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of the first Ahoneynation is obtained</li> <li>Jump called on this enemy</li> <li><code>Jump</code> sound plays</li> <li>y <code>spin</code> set to 10.0</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 108</li> <li><code>Puddle</code> sound plays</li> <li>Yield all frames until this enemy is <code>onground</code></li> <li>Over the course of 31.0 frames, this enemy moves to the <code>Ahoneynation</code> position + 0.1 in z via a BeizierCurve3 with a ymax of 3.0</li> <li>Heal called to heal the <code>Ahoneynation</code>'s <code>hp</code> by this enemy's <code>hp</code></li> <li><code>selfsacrifice</code> set to true which prevents some logic to happen in post action since this enemy is set to die soon</li> <li>CleanKill called on this enemy which turns this enemy into a blank actor shell placing their battleentity at startp</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#move-4-bomb-transformation","title":"Move 4 - Bomb transformation","text":"<p>Turns into a bomb that will explode on their next actor turn. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>Jump called with an h of 15.0</li> <li><code>Jump</code> sound plays</li> <li>y <code>spin</code> set to 15.0</li> <li>Yield for 0.3 seconds</li> <li><code>poisonres</code>, <code>numbres</code>, <code>sleepres</code> and <code>freezeres</code> are all set to 110 (all immune)</li> <li><code>Fuse</code> sound plays with 1.1 pitch</li> <li>If hardmode is true, StatusEffect is called on this enemy to inflict the DefenseUp condition for 99999 main turns with effect</li> <li><code>originalid</code> and <code>animid</code> of this enemy's entity set to 217 (<code>Abomihoney</code>). This shouldn't change anything under normal gameplay</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>data</code> is initialised to be one element with a value of 1 which means the bomb explosion move will be used on the next actor turn</li> <li>A SpriteBounce is added to <code>rotater</code> with a MessageBounce with a 1.5 multiplier and a <code>basescale</code> of 1.25x</li> <li>Yield all frames until this enemy is <code>onground</code>. Before each frame yield, the <code>basescale</code> of the SpriteBounce is set to 1.25x</li> <li><code>destroytype</code> set to ExplodeAnim</li> <li><code>onhitaction</code> set to -1 which should prevent this enemy from performing their <code>hitaction</code> logic</li> <li><code>spin</code> zeroed out</li> <li>angles zeroed out</li> <li>Yield for 0.5 seconds</li> <li>The <code>basescale</code> of the SpriteBounce is set to 1.25x</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#move-5-bomb-explosion","title":"Move 5 - Bomb explosion","text":"<p>Explode as a bomb which kills themselve, but deals damages to everyone except other other <code>Abomihoney</code> and Ahoneynation which gets healed.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen to each player party members whose <code>hp</code> is above 0 null The player party member 10 (5 instead if the player party member has the Shield which also will make the attack non lethal after this call) null null false 2 Always happen to every enemy party members except this enemy, other <code>Abomihoney</code> and other Ahoneynation null The enemy party member 10 null null false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Abomihoney/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li>The <code>Hold</code> animation clip is played on <code>anim</code></li> <li><code>Fuse</code> sound plays</li> <li>Over the course of 61.0 frames, the <code>basescale</code> of the <code>rotater</code>'s SpriteBounce changes to 2x via a lerp</li> <li>ShakeSprite called with an intensity of (0.1, 0.0, 0.0) and 40.0 frametimer</li> <li>Yield for 0.66 seconds</li> <li><code>explosion</code> particles plays at this enemy position</li> <li><code>Explosion3</code> sound plays</li> <li><code>Splat2</code> sound plays</li> <li><code>sprite</code> gets disabled</li> <li><code>shadow</code> gets disabled</li> <li>ShakeScreen called with an ammount of 0.25 and time of 0.75</li> <li>For each player party members:<ul> <li>If their <code>hp</code> is above 0, DoDamage 1 call happens</li> <li>If they had the Shield condition before the DoDamage 1 call, their <code>hp</code> gets clamped from 1 to their <code>maxhp</code> which makes the DoDamage 1 call non lethal</li> </ul> </li> <li>For each enemy party member other than this enemy:<ul> <li>If it's an Ahoneynation or another <code>Abomihoney</code>, Heal is called on them to heal 10 of their <code>hp</code></li> <li>Otherwise, DoDamage 2 call happens on them</li> </ul> </li> <li>3 new sprite objects are created and appears with the following properties:<ul> <li>Named <code>splatX</code> where <code>X</code> is a number from 0 to 2</li> <li>Childed to the <code>GUICamera</code></li> <li>sprite of <code>Sprites/Objects/splatter</code></li> <li>Positioned in one of 3 hardcoded Vector3</li> <li>Scale of Vector3.zero</li> <li>size of one of 3 hardcoded Vector3</li> <li>color of FFFFBF (mostly orange)</li> <li>sortorder of -5 - X where X is a number from 0 to 2</li> <li>flipX of false except for the second sprite where it's true</li> <li>A DialogueAnim is added with a <code>targetscale</code> of Vector3.one and a <code>shrinkspeed</code> of 0.15</li> <li>Yield for 0.025 seconds after each creation</li> </ul> </li> <li>Over the course of 100.0 frames, each <code>Sprites/Objects/splatter</code> color's alpha changes to 0.0 via a lerp, but only over on the last 50.0 frames of the full yields (the first 50.0 are just frame yields)</li> <li><code>sprite</code> gets disabled</li> <li>All <code>Sprites/Objects/splatter</code> gets destroyed</li> <li>Yield for 0.5 seconds</li> <li><code>selfsacrifice</code> set to true which prevents some logic to happen in post action since this enemy is set to die soon</li> <li>CleanKill called on this enemy which turns this enemy into a blank actor shell placing their battleentity at startp</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/","title":"<code>Acolyte</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#asumptions","title":"Asumptions","text":"<p>It is assumed that this enemy has its cantfall set to true because it should only change its position through specific ways:</p> <ul> <li>Using the vine spawn move</li> <li>Using the aerial strike move</li> <li>Have the <code>AcolyteVine</code> enemy that they spawn die</li> </ul> <p>That last one leads to another assumption: <code>AcolyteVine</code> and this enemy must have an <code>eventondeath</code> set to the proper EventDialogue because this EventDialogue will allow the <code>AcolyteVine</code> to die first and to drop this enemy's position to <code>Ground</code>. This is necessary because there's custom logic that needs to happen which goes beyond the regular fall logic of the damage pipeline.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 2 elements with a starting value of 0.</p> <ul> <li><code>data[0]</code>: The amount of times the vine spawn move needs to be redirected to a vine attack move before being able to spawn an <code>AcolyteVine</code> again. When the vine spawn move is used for the first time, this value is set to 2. From there, everytime the vine spawn move is used, if this value is still higher than 0, it is decremented and the vine attack move is used instead. When it reaches 0, the vine spawn move can be used again if selected. There is an exception to this: once <code>data[1]</code> gets set to 1 (when the phase transition will occur), this value will be set to 0 on the same actor turn and the vine spawn move will be used. Essentially, once <code>data[1]</code> gets set to 1, this enemy will ignore the existing value and proceed with using the vine spawn move anyway</li> <li><code>data[1]</code>: A phase transition tracker with three possible states depending on the value:<ul> <li>0: The initial state before HPPercent becomes 0.4 or lower. From this state, the value is only set to 1 when HPPercent reaches 0.4 or lower</li> <li>1: HPPercent reached 0.4 or lower, but the phase transition hasn't fully occured yet. It occurs on the same actor turn and when it occurs, the value is set to 2 as well as <code>data[0]</code> set to 0 on top of using the vine spawn move</li> <li>2: The phase transition happened and from this point, this value can no longer influence the action logic</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The prayer move, vine spawn move and vine attack moves have their base odds changed</li> <li>The vine attack move may hit twice instead of only once, but for 2 base damage on the first hit instead of 3 (the second hit does 2 base damage if it happens)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A prayer that inflicts DefenseUp to themselves</li> <li>Spawns a new <code>AcolyteVine</code> enemy and gets on top of it which changes their position to <code>Flying</code></li> <li>A single target vine attack that may hit multiple times</li> <li>A single target aerial strike that also changes the position to <code>Ground</code></li> <li>Transition to the second phase which spawns a new AngryPlant enemy then performs move 2</li> </ol> <p>Move 4 can only be used and will always be used if position is <code>Flying</code>.</p> <p>For move 5, it can only be used once in the entire battle and it will always be used if all of the following conditions are fufilled:</p> <ul> <li>position is <code>Ground</code> (move 2 wasn't used)</li> <li>HPPercent is 0.4 or lower</li> <li><code>data[1]</code> is 0 at the start of the actor turn (meaning move 5 was never used before)</li> </ul> <p>Move 5 marks a phase transition whose state is tracked by <code>data[1]</code>. It becomes 1 once all of the above is detected and on the same actor turn, it becomes 2 once the transition is completed which prevents to use the move again.</p> <p>All the other 3 moves have base odds which are shown in the following table and they differ depending if hardmode is true or not. However, the decision of the move to use may not be the final one. It is possible the move's logic decides to perform a different move instead which is reffered to as a redirection. They typically happen when proceeding with the move is illogical or undesired.</p> <p>Here are all the move's base odds and their possible redirections:</p> Move Base odds (hardmode is false) Base odds (hardmode is true) Possible redirections 1 2/7 1/3 Move 3 if this enemy already has the DefenseUp condition 2 2/7 1/3 Move 3 if <code>data[0]</code> is above 0 (set to 2 as part of using this move otherwise). An exception to this is when move 5 (phase transition) is used since the usage of move 5 sets <code>data[0]</code> to 0 and then uses move 2. <code>data[0]</code> decrements when this redirection occurs 3 3/7 1/3 None, the move is always used once selected"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always performed at the start of the action logic:</p> <ul> <li><code>sprite</code> local position is reset to Vector3.zero</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#post-move-logic","title":"Post move logic","text":"<p>The following logic is always performed at the end of the action logic:</p> <ul> <li><code>sprite</code> local position is reset to Vector3.zero</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#move-1-prayer","title":"Move 1 - Prayer","text":"<p>A prayer that inflicts DefenseUp to themselves. No damages are dealt</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true, but it doesn't affect anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves to look near this enemy</li> <li>animstate set to 103</li> <li>Yield for 0.6 seconds</li> <li>animstate set to 105</li> <li>Yield for 0.35 seconds</li> <li>SetCondition called to inflict DefenseUp on this enemy for 3 main turns (effectively 2 since the main turn advances soon after)</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 1 (blue up arrow)</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#move-2-acolytevine-spawn","title":"Move 2 - <code>AcolyteVine</code> spawn","text":"<p>Spawns a new <code>AcolyteVine</code> enemy and gets on top of it which changes the position to <code>Flying</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#about-status-resistance","title":"About status resistance","text":"<p>This move will make this enemy immune to Poison, Freeze, Numb and Sleep conditions</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true, but it doesn't affect anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>If <code>data[0]</code> is above 0:<ul> <li><code>data[0]</code> is decremented</li> <li>Move 3 (vine attack) is performed instead</li> </ul> </li> <li>Camera moves to look near this enemy</li> <li><code>data[0]</code> set to 2</li> <li>animstate set to 103</li> <li>Yield for 0.6 seconds</li> <li>animstate set to 101</li> <li>Yield for 0.3 seconds</li> <li><code>Charge9</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0) for 0.5 time</li> <li>AddNewEnemy called to add a new <code>AcolyteVine</code> enemy at this enemy position + (1.1, 45.0, 0.1)</li> <li>Yield a frame</li> <li><code>DirtExplode</code> particles played at the <code>AcolyteVine</code> enemy</li> <li>Over the course of 30.0 frames, <code>AcolyteVine</code> moves to + 5.0 in y with their scale changed to their <code>startscale</code> from endata via a lerp and their y angle changes from 720.0 to 0.0 via a lerp</li> <li>Yield for 0.1 seconds</li> <li>animstate set to 100</li> <li>Yield for 0.8 seconds</li> <li><code>Jump</code> sound plays</li> <li>animstate set to 2 (<code>Jump</code>)</li> <li>y <code>spin</code> set to 15.0</li> <li>Over the course of 40.0 frames, <code>height</code> is changed via a lerp to the y output of a BeizierCurve3 (that goes for the first 36.0 frames) from startp to startp + 0.34 in y with a ymax of 8.0</li> <li><code>AcolyteVine</code>'s <code>basestate</code> and animstate set to 101</li> <li><code>height</code> set to 3.4</li> <li>ShakeSprite called with intensity (0.1, 0.1, 0.0) with 0.2 frametimer</li> <li><code>AcolyteVine</code>'s spin` zeroed out</li> <li><code>AcolyteVine</code>'s <code>sprite</code> angles set to FlipAngle</li> <li>position changed to <code>Flying</code></li> <li><code>AcolyteVine</code> animstate set to its <code>basestate</code></li> <li><code>AcolyteVine</code> has the <code>BattleIdlef</code> animationClip played</li> <li>y <code>cursoroffset</code> decreased by 1.0</li> <li><code>poisonres</code>, <code>freezeres</code>, <code>numbres</code> and <code>sleepres</code> set to 110 which makes this enemy immune to Poison, Freeze, Numb and Sleep</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#move-3-vine-attack","title":"Move 3 - Vine attack","text":"<p>A single target vine attack that may hit multiple times.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 1 time (from 1 to 2 times instead if hardmode us true, but the second hit requires the targer's <code>hp</code> to still be above 0) This enemy <code>playertargetID</code> after GetSingleTarget (same target for each calls) <ul><li>If harmode is false, 3</li><li>If hardmode is true, 2 on the first hit, 1 on the second hit</li></ul> Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint of this enemy and <code>playertargetentity</code></li> <li>animstate set to 103</li> <li>Yield for 0.6 seconds</li> <li>animstate set to 101</li> <li>Yield for 0.3 seconds</li> <li><code>checkingdead</code> is set to a new VineAttack coroutine with 3 damageamt (2 instead if hardmode is true), actionid as the callerid without gettarget. The coroutine will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> goes to null</li> </ul> <p>This is what the coroutine effectively ends up doing:</p> <ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>The amount of hits is determined. It is 1 if hardmode is false and if it's true, it's random between 1 and 2</li> <li>An array of <code>Prefabs/Objects/VenusRoot</code> are instantiated with the amount being the amount of hits to do at (<code>playertargetentity</code> x position + a random number between -2.0 and 2.0, -5.0, <code>playertargetentity</code> z position). Each instance is set to LookAt the <code>playertargetentity</code> and has its initial position incremented by (random between -1.0 and 1.0, 0.0, -0.15)</li> <li>An array of Vector3 are instantiated with the amount being the amount of hits to do with each being the normalised direction vector from <code>playertargetentity</code> to the matching <code>Prefabs/Objects/VenusRoot</code> element</li> <li>Yield for 0.75 seconds</li> <li>For each hit:<ul> <li><code>Charge8</code> sound plays</li> <li>Over the course of 10.0 frames, the <code>Prefabs/Objects/VenusRoot</code> position changes to its position + the matching heading direction vector * 5.0. The first time reaching the 5th frame or later when <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0, DoDamage 1 call happens before the frame yield</li> <li>Yield for 0.5 seconds</li> <li>If this is the last hit:<ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>The amount of damage to deal on the next hit becomes half of this one's damage floored then clamped from 1 to 99</li> </ul> </li> <li>Over the course of 60.0 frames, all <code>Prefabs/Objects/VenusRoot</code> instances has ther scale lerped to Vector3.zero</li> <li>Yield a frame</li> <li>All <code>Prefabs/Objects/VenusRoot</code> instances gets destroyed</li> <li><code>checkingdead</code> set to null which informs the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#move-4-aerial-strike","title":"Move 4 - Aerial strike","text":"<p>A single target aerial strike that also changes the position to <code>Ground</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#about-status-resistance_1","title":"About status resistance","text":"<p>This move will undo any resitance increases of Poison, Freeze, Numb and Sleep conditions</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>y position increased by <code>height</code></li> <li><code>height</code> set to 0.0</li> <li><code>sprite</code> local position set to Vector3.zero</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Jump called</li> <li>Yield for 0.3 seconds</li> <li>animstate set to 108</li> <li>Yield for 0.2 seconds</li> <li>animstate set to 2 (<code>Jump</code>)</li> <li><code>spin</code> set to (0.0, 15.0, -0.1)</li> <li>The <code>enemydata</code> index of the <code>AcolyteVine</code> is obtained (it should always be present from here)</li> <li><code>AcolyteVine</code> animstate set to 18 (<code>KO</code>)</li> <li><code>AcolyteVine</code>'s <code>hp</code> set to 0</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li><code>ChargeDown4</code> sound plays</li> <li><code>Spin2</code> sound plays on loop with 1.1 pitch and 0.6 volume</li> <li><code>AcolyteVine</code> MainManager.MoveTowards down by 5.0 in y with 50.0 multiplier with smooth and without local</li> <li>Over the course of 40.0 frames, position is lerped to the midpoint between startp and <code>playertargetentity</code> + (0.75, 5.5, 0.0)</li> <li>Yield for 0.2 seconds</li> <li><code>Spin2</code> sound stopped</li> <li><code>Toss4</code> sound plays</li> <li><code>spin</code> zeroed out</li> <li><code>flip</code> set to false</li> <li><code>sprite</code> local position set to Vector3.zero</li> <li>animstate set to 107</li> <li><code>trail</code> set to true</li> <li>Over the course of 20.0 frames, position is lerped to <code>playertargetentity</code> + 1.0 in y</li> <li><code>trail</code> set to false</li> <li>DoDamage 1 call happens</li> <li>ShakeScreen called with an ammount of (0.1, 0.1, 0.1) and 0.1 time</li> <li><code>HugeHit</code> sound plays</li> <li>Yield for 0.05 seconds</li> <li>SetDefaultCamera called</li> <li>animstate set to 110</li> <li>z <code>spin</code> set to -20.0</li> <li>Over the course of 40.0 frames, this enemy moves to startp + Vector3.up via a BeizierCurve3 with a ymax of 7.0 and <code>AcolyteVine</code> has its <code>startscale</code> and its <code>rotater</code> angles lerped to Vector3.zero</li> <li>position set to startp</li> <li>animstate set to 108</li> <li><code>spin</code> zeroed out</li> <li>Yield a frame</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>position set to <code>Ground</code></li> <li>Yield for 0.5 seconds</li> <li><code>cursoroffset</code>, <code>poisonres</code>, <code>freezeres</code>, <code>numbres</code> and <code>sleepres</code> are reset to their default value from GetEnemyData without createentity</li> <li><code>AcolyteVine</code> is destroyed</li> <li>ReorganizeEnemies called</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#move-5-phase-transition","title":"Move 5 - Phase transition","text":"<p>Transition to the second phase which spawns a new AngryPlant enemy and performs move 2 (vine spawn).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#nonphyscal-set-to-true_3","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true, but it doesn't affect anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acolyte/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li><code>data[1]</code> set to 1</li> <li><code>cantmove</code> decremented. This gives another actor turn to this enemy which will be move 4 (aerial strike) because position will always end up being <code>Flying</code> at the end of this actor turn</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 103</li> <li>Yield for 0.6 seconds</li> <li>animstate set to 105</li> <li>Yield for 0.35 seconds</li> <li>Camera moves to the left by 3.0</li> <li>ShakeScreen called for 0.5 time</li> <li>Yield for 0.5 seconds</li> <li><code>VenusBudAppear</code> sound plays</li> <li>AddNewEnemy called to add a new AngryPlant enemy at this enemy position + (-3.0, 0.0, -0.1)</li> <li>DeathSmoke particles plays at the <code>AngryPlant</code></li> <li><code>AngryPlant</code>'s <code>startscale</code> set to Vector3.zero</li> <li>Yield a frame</li> <li><code>AngryPlant</code> animstate set to 101</li> <li><code>AngryPlant</code>'s y <code>spin</code> set to 20.0</li> <li>Over the course of 30.0 frames, <code>AngryPlant</code>'s <code>startscale</code> is lerped to (1.15, 1.15, 1.15)</li> <li><code>AngryPlant</code>'s <code>startscale</code> set  to (1.15, 1.15, 1.15)</li> <li><code>AngryPlant</code>'s <code>spin</code> zeroed out</li> <li>Yield for 0.5 seconds</li> <li><code>AngryPlant</code>'s animstate set to 0 (<code>Idle</code>)</li> <li><code>data[1]</code> set to 2 (completed the phase transition)</li> <li><code>data[0]</code> set to 0 (forces the vine spawn move to be available for usage)</li> <li>Move 2 (vine spawn) is used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/","title":"<code>Acornling</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#enemycheck-special-logic","title":"EnemyCheck special logic","text":"<p>Before this enemy is loaded, it's possible that StartBattle overrides it to a <code>GoldenSeedling</code>. See the documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the rolling attack move, there is now a 50% chance to end up being a disguised headbonk attack move which can misslead the block timing. This is signaled with a slight animation changes compared to the regular rolling attack</li> <li>In the rolling attack move, the multiplier of the MoveTowards call changes to 2.5 multiplier from 2.25 which makes this enemy moves ~11.111111% faster. This also applies to the headbonk attack move that is disguised as a rolling one</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target rolling attack</li> <li>A single target headbonk attack</li> <li>A single target headbonk attack disguised as a rolling attack</li> </ol> <p>Move 1 and 2 have's decision on which move to use is based on the following odds:</p> Move Odds 1 50% 2 50% <p>As for move 3, it can only be used when move 2 is used and hardmode is true. When these conditions are met, move 3 is done if a 50% RNG check passes.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#move-1-rolling-attack","title":"Move 1 - Rolling attack","text":"<p>A single target rolling attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 100</li> <li>Yield for 0.3 seconds</li> <li><code>Jump</code> sound plays</li> <li>Jump called</li> <li>animstate set to 101</li> <li>Yield for 0.3 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> <li>Camera moves to look near <code>playertargetID</code></li> <li>Yield a frame</li> <li><code>spin9</code> sounds plays on loop using <code>sounds[9]</code> with a pitch of 1.1</li> <li>MoveTowards <code>playertargetentity</code> position + (0.25, 0.0, -0.1) with a multiplier of 2.25 (2.5 instead if hardmode is true) with 101 as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li>DoDamage 1 call happens</li> <li>Over the course of 40.0 frames, this enemy moves to + 2.5 in x via a BeizierCurve3 with a ymax of 4.0</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#move-2-headbonk-attack","title":"Move 2 - Headbonk attack","text":"<p>A single target headbonk attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Yield a frame</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.2) with a multiplier of 2.0</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>checkingdead</code> set to a new SeedlingHeadbonk coroutine with 2 damage, actionid as the attacker id, no property and with skipwalk. This coroutine sets <code>checkingdead</code> to null when completed</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>Here is what SeedlingHeadbonk effectively does with those parameters:</p> <ul> <li><code>Jump</code> sound plays</li> <li>Jump called</li> <li>Yield for 0.3 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> <li>Camera moves to look near <code>playertargetID</code></li> <li>Yield a frame</li> <li>animstate set to 102</li> <li><code>Turn</code> sound plays</li> <li>Over the course of 35.0 frames (but visually occurs as if it was 32.0 frames with the last 3 being padding), this enemy moves to <code>playertargetentity</code> position + (0.25, 2.8, -0.1) via a BeizierCurve3 with a ymax of 5.5 while the z angle gets a LerpAngle done to 180.0</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.1 seconds</li> <li><code>sprite</code> angles zeroed out</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li><code>Turn2</code> sound plays</li> <li>Over the course of 25.0 frames, this enemy moves to its current position + 2.0 in x with the y being 0.0 via a BeizierCurve3 with a ymax of 3.0</li> <li><code>checkingdead</code> is set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#move-3-headbonk-attack-disguised-as-rolling-attack","title":"Move 3 - Headbonk attack disguised as rolling attack","text":"<p>A single target headbonk attack disguised as a rolling attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Acornling/#logic-sequence_2","title":"Logic sequence","text":"<p>The logic starts the same way than move 1, but these following directives occurs twice in a row instead of only occuring once (this gives a cue to the player about the fake rolling attack):</p> <ul> <li><code>Jump</code> sound plays</li> <li>Jump called</li> <li>animstate set to 101</li> <li>Yield for 0.3 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> </ul> <p>The MoveTowards call also changes to have the target being a lerp between <code>playertargetentity</code> and this enemy with a factor of 0.3 (meaning 70% of the way to the target).</p> <p>The rest of the logic of move 1 doesn't happen (including the DoDamage call). What happens instead is the end of what move 2 does:</p> <ul> <li><code>checkingdead</code> set to a new SeedlingHeadbonk coroutine with 2 damage, actionid as the attacker id, no property and with skipwalk. This coroutine sets <code>checkingdead</code> to null when completed</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>As for the SeedlingHeadbonk coroutine, it does the exact same logic including the DoDamage call.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/","title":"<code>Ahoneynation</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: UNUSED</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the honey throw move, the amount of frames each projectile takes to reach its target changes to 21.0 frames from 23.5 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#move-selection","title":"Move selection","text":"<p>4 moves are possible:</p> <ol> <li>A single target punch attack</li> <li>A single target honey throw that may hit multiple times and summon new Abomihoney enemies</li> <li>Prepares themselves for a big attack by setting <code>charge</code> to 2</li> <li>A party wide jump attack</li> </ol> <p>Move 4 is always used (and only used) if <code>basestate</code> isn't 0 (<code>Idle</code>) meaning move 3 was performed last actor turn.</p> <p>As for other moves, the decision of which moves to use is based on odds, but the odds changes when HPPercent is 0.6 or less. Move 2 and 3 have additional requirements that if failed when selecting the move, move 1 will be performed instead. Here are the odds and requirements:</p> Move Odds when HPPercent floored &gt; 0.6 Odds when HPPercent &lt;= 0.6 Additional requirments 1 1/4 1/6 None, the move is always used when selected 2 2/4 2/6 The enemy party must have less than 3 enemy party members 3 1/4 3/6 HPPercent must be between 0.15 exclusive and 0.65 exclusive (between 15% exclusive and 65% exclusive <code>hp</code> remaining)"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#move-1-punch-attack","title":"Move 1 - Punch attack","text":"<p>A single target punch attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 5 null {NoSound} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>MoveTowards <code>playertargetentity</code> + (4.85, 0.0, -0.1) with a 0.7 multiplier</li> <li>Yield until <code>forcemove</code> is done and this enemy is <code>onground</code></li> <li>animstate set to 100</li> <li><code>Charge18</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 102</li> <li>Yield for 0.06 seconds</li> <li>ShakeScreen called with 0.3 ammount and 0.5 time</li> <li>DoDamage 1 call happens</li> <li><code>BigHit</code> sound plays</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#move-2-honey-throw","title":"Move 2 - Honey throw","text":"<p>A single target honey throw that may hit multiple times and summon new Abomihoney enemies.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen from 1 to 2 times (always 1 time if there's already 2 or more enemy party members). Each call requires that at least one player party member is alive (<code>hp</code> above 0 and not EatenBy) This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) 3 Numb null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>Camera moves a bit forward</li> <li><code>AhoneynationSpitCharge</code> sound plays</li> <li>animstate set to 104</li> <li>Yield for 0.65 seconds</li> <li>The amount of hits is determined. It's random between 1 and 2 inclusive (always 1 instead if there's already 2 or more enemy party members)</li> <li>For each hit:<ul> <li>If no player party members are alive (<code>hp</code> above 0 and not EatenBy), this hit and all further ones are skipped</li> <li>GetSingleTarget called</li> <li>animstate set to 106</li> <li><code>AhoneynationSpit</code> sound plays</li> <li>CreateNewEntity called with name <code>enemy</code>, animid of 177 (<code>Abomihoney</code>) positioned offscreen at (0.0, 999.0, 0.0)</li> <li><code>enemy</code>'s <code>hologram</code> gets set to this enemy's value</li> <li><code>enemy</code>'s <code>battle</code> gets set to true (this is needed because if they are summoned, the search for the free spot filters based on this)</li> <li>Yield a frame</li> <li><code>enemy</code>'s <code>startscale</code> set to 0.75x</li> <li><code>enemy</code>'s <code>shadowsize</code> set to 1.1</li> <li><code>enemy</code>'s animstate set to 108</li> <li>Yield for 0.1 seconds</li> <li>animstate set to 107</li> <li>Over the course of 23.5 frames (21.0 frames instead if hardmode is true), <code>enemy</code> moves to <code>playertargetentity</code> position + (0.0, 1.0, -0.1) via a lerp</li> <li>DoDamage 1 call happens</li> <li><code>ElecFast</code> particles plays at <code>playertargetentity</code> position + (0.0, 1.0, -0.1)</li> <li>If <code>commandsuccess</code> is true (blocked, ignores FRAMEONE), the enemy will be slated for summoning by doing the following:<ul> <li>The location of the enemy is determined. The locations considered in order are (0.5, 0.0, 0.85) and (6.55, 0.0, -0.5). The first free one (no enemy party members within a 1.0 radius) will be selected, but it defaults to (-15.0, 5.0, 0.0) if neither are free the enemy won't be summoned (shouldn't happen under normal gameplay)</li> <li><code>enemy</code> moves to the location - 0.2 in z via ArcMovement without spin and with a height of the distance of <code>enemy</code> to the location clamped from 2.0 to 4.5 for 35.0 frametime without destroyonend</li> </ul> </li> </ul> </li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.75 seconds if any enemy are slated for summoning through a projectile entity. For each enemy to summon:<ul> <li>animstate set to 107</li> <li>Yield for 0.4 seconds</li> <li><code>Puddle</code> sound plays</li> <li>AddNewEnemy called to add an Abomihoney offscreen at (0.0, 999.0, 0.0)</li> <li>Yield for a frame</li> <li><code>enemydata[lastaddedid]</code> is positioned at the matching projectile entity position</li> <li>The projectile entity gets destroyed</li> <li>The new enemy gets some fields changed:<ul> <li>animstate and <code>basestate</code>: 0 (<code>Idle</code>)</li> <li><code>startscale</code>: 0.75x</li> <li><code>hp</code> and <code>maxhp</code>: divided by 3 floored</li> <li><code>def</code>: decremented. NOTE: This can incorrectly result in a value of -1 which can impact the damage pipeline in unexpected ways (such as increasing the result by 1) and to cause TrueDef to incorrectly report a <code>?</code> defense value when this enemy won't have a <code>LimitX10</code> weakness</li> <li><code>exp</code>: 1 (0 instead if the <code>Ahoneynation</code>'s <code>hologram</code> is true)</li> <li><code>locktri</code>: true</li> <li><code>cantmove</code>: 1 (meaning this enemy cannot act on this main turn and needs to wait the current main turn advances)</li> </ul> </li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#move-3-charging","title":"Move 3 - Charging","text":"<p>Braces themselves to set <code>charge</code> to 2. No damages are dealt. The <code>basestate</code> changes allowing move 4 (party wide jump attack) to be used on the next actor turn.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 109</li> <li><code>Charge18</code> sound plays with 0.9 pitch</li> <li>animstate set to 109</li> <li>Over the course of 61.0 frames, y <code>spin</code> goes to 15.0 via a lerp</li> <li>Yield for 0.3 seconds</li> <li>animstate, <code>basestate</code> and the local startstate set to 108</li> <li><code>spin</code> zeroed out</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li><code>charge</code> set to 2</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#move-4-party-wide-jump-attack","title":"Move 4 - Party wide jump attack","text":"<p>A party wide jump attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ahoneynation/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>AhoneynationBodySlamCharge</code> sound plays</li> <li>Camera moved to look near (-4.0, 1.0, 0.0)</li> <li>Over the course of 51.0 frames, the <code>rotater</code>'s SpriteBounce (this is setup by CheckSpecialID) has their <code>basescale</code> changed to (1.2, 0.5, 1.0) via a lerp and their <code>basespeed</code> changed to be multiplied by 1.5 via a lerp</li> <li>Yield for 0.1 seconds</li> <li>y <code>spin</code> set to 20.0</li> <li>animstate set to 109</li> <li><code>rotater</code>'s SpriteBounce's <code>basescale</code> reset to its value before this action</li> <li><code>AhoneynationBodySlamJump</code> sound plays</li> <li>Over the course of 61.0 frames, this enemy moves to <code>partymiddle</code> via a BeizierCurve3 with a ymax of 15.0</li> <li>position set to <code>partymiddle</code></li> <li><code>spin</code> zeroed out</li> <li>animstate set to 108</li> <li><code>impactsmoke</code> particles played at this enemy position</li> <li>ShakeScreen called with 0.3 ammount and 0.5 time</li> <li>PartyDamage 1 call happens</li> <li><code>Thud3</code> sound plays</li> <li>Over the course of 61.0 frames, <code>rotater</code>'s SpriteBounce's <code>frequency</code> goes from 1.0 to 0.0 via a lerp</li> <li><code>rotater</code>'s SpriteBounce's <code>basescale</code> reset to its value before this action</li> <li><code>rotater</code>'s SpriteBounce is SetUp with the frequency and speed it had before this action</li> <li>animstate, <code>basestate</code> and the local startstate set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/","title":"<code>AngryPlant</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy gets loaded with an onhitaction of 3 so this enemy's <code>hitaction</code> logic works.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: The amount of actor turns left <code>Flying</code> before dropping to <code>Ground</code>. This is set to 3 during the <code>hitaction</code> logic and decremented every actor turns's action. When it reaches 0 (or 1 if this enemy is the only remaining enemy party member), this enemy will drop down to <code>Ground</code> which will cause the value to be set to -1.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The healing move on another party member has an RNG check of 71% instead of 51% if all the other conditions applies</li> <li>The vine attack, wavy projectile and delayed projectile moves have different odds distribution</li> <li>The vine attack move may hit twice instead of only once</li> <li>In the wavy projectile move, the projectile takes 50.0 frames to reach its target instead of 65.0 frames</li> <li>In the multiple projectiles throw move, the projectile takes 1 / 0.03 frames (~33.333334 frames) for the projectile to move to its target instead of 1 / 0.025 frames (40 frames). </li> <li>In the multiple projectiles throw move, the yield time between projectiles changes to 0.225 seconds instead of 0.3 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true. Since no damages are dealt in the <code>hitaction</code> logic, this doesn't do anything.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#logic-sequence","title":"Logic sequence","text":"<p>The overall logic causes a position set to <code>Flying</code> with <code>data[0]</code> set to 3.</p> <ul> <li><code>data[0]</code> set to 3</li> <li>animstate set to 101</li> <li><code>emoticonid</code> set to 2 (<code>Exclamation</code>) with an <code>emoticoncooldown</code> set to 30.0</li> <li><code>Wam</code> sound plays</li> <li>Yield all frames until <code>emoticocooldown</code> expires</li> <li>y <code>spin</code> set to -20.0</li> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called for 0.7 time</li> <li><code>DirtExplode</code> particles plays at this enemy position</li> <li>y <code>spin</code> set to -30.0</li> <li><code>spinextra[0]</code> set to (0.0, -20.0, 0.0)</li> <li><code>Charge6</code> sound plays</li> <li>Over the course of 40.0 frames, <code>height</code> changes to the y component of a BeizierCurve from the current postion to the same + 3.0 in y with a ymax of 5.0. Before each frame yield, <code>oldstate</code> is set to -1</li> <li><code>bobrange</code> and <code>bobspeed</code> set to <code>startbf</code> and <code>startbs</code> respectively</li> <li><code>spin</code> zeroed out</li> <li>Yield for 0.5 seconds</li> <li>position set to <code>Flying</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A single target vine attack that may hit multiple times</li> <li>A single target wavy projectile throw</li> <li>Adds a DelayedProjectile</li> <li>A heal breath that heals the <code>hp</code> of another enemy party member</li> <li>A single target multiple projectiles throw</li> </ol> <p>Move 5 can only be used when position is <code>Flying</code> and it is always used when this happens.</p> <p>Move 4 will only be used under the following conditions:</p> <ul> <li>position is <code>Ground</code></li> <li>A 51% RNG check passes (71% instead if hardmode is true)</li> <li>An enemy party member exists other than this enemy whose <code>hp</code> / their <code>maxhp</code> is less than 0.6 (less than 60% <code>hp</code> remaining) and has a position of <code>Ground</code></li> </ul> <p>If the above are fufilled, the first enemy party member found will be targetted by the move and move 4 will always be used under these conditions.</p> <p>If move 4 or 5 aren't used, the decision of which move to use depends on odds but the odds changes if hardmode is true. Here are the odds in either situations:</p> Move Odds when hardmode is false Odds when hardmode is true 1 3/6 2/7 2 2/6 3/7 3 1/6 2/7"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic happens before any move is used:</p> <ul> <li>If <code>data[0]</code> is above 0, it is decremented</li> <li>If <code>data[0]</code> is now 0 (or 1 if it's the only enemy party member left) while position is <code>Flying</code>, it drops to <code>Ground</code> with the following logic:<ul> <li><code>data[0]</code> set to -1</li> <li><code>ChargeDown</code> sound plays</li> <li>animstate set to 101</li> <li>y <code>spin</code> set to -20.0</li> <li>Over the course of 30.0 frames, <code>height</code> is lerped to 0.0</li> <li><code>height</code> set to 0.0</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>oldfly</code> toggled</li> <li><code>spin</code> zeroed out</li> <li>FlipAngle called with setangle</li> <li>position set to <code>Ground</code></li> <li>Yield for 0.25 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#post-move-logic","title":"Post move logic","text":"<p>If any move except move 5 were used (basically, anything that requires a position of <code>Ground</code>), the following logic happens after the move:</p> <ul> <li>SetDefaultCamera called</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.5 seconds</li> <li>Heal this enemy for 1 <code>hp</code></li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#move-1-vine-attack","title":"Move 1 - Vine attack","text":"<p>A single target vine attack that may hit multiple times</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 1 time (from 1 to 2 times instead if hardmode us true, but the second hit requires the targer's <code>hp</code> to still be above 0) This enemy <code>playertargetID</code> after GetSingleTarget (same target for each calls) 2 on the first hit, 1 on the second hit Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to a new VineAttack coroutine with 2 damageamt, actionid as the callerid without gettarget. The coroutine will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> goes to null</li> </ul> <p>This is what the coroutine effectively ends up doing:</p> <ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>The amount of hits is determined. It is 1 if hardmode is false and if it's true, it's random between 1 and 2 inclusive</li> <li>An array of <code>Prefabs/Objects/VenusRoot</code> are instantiated with the amount being the amount of hits to do at (<code>playertargetentity</code> x position + a random number between -2.0 and 2.0, -5.0, <code>playertargetentity</code> z position). Each instance is set to LookAt the <code>playertargetentity</code> and has its initial position incremented by (random between -1.0 and 1.0, 0.0, -0.15)</li> <li>An array of Vector3 are instantiated with the amount being the amount of hits to do with each being the normalised direction vector from <code>playertargetentity</code> to the matching <code>Prefabs/Objects/VenusRoot</code> element</li> <li>Yield for 0.75 seconds</li> <li>For each hit:<ul> <li><code>Charge8</code> sound plays</li> <li>Over the course of 10.0 frames, the matching <code>Prefabs/Objects/VenusRoot</code> moves to its position + the matching heading direction vector * 5.0 via a lerp. The first time reaching the 5th frame or later when <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0, DoDamage 1 call happens before the frame yield</li> <li>Yield for 0.5 seconds</li> <li>If this is the last hit:<ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>The amount of damage to deal on the next hit becomes half of this one's damage floored then clamped from 1 to 99</li> </ul> </li> <li>Over the course of 60.0 frames, all <code>Prefabs/Objects/VenusRoot</code> instances has their scale changed to 0.0x via a lerp</li> <li>Yield a frame</li> <li>All <code>Prefabs/Objects/VenusRoot</code> instances gets destroyed</li> <li><code>checkingdead</code> set to null which informs the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#move-2-wavy-projectile","title":"Move 2 - Wavy projectile","text":"<p>A single target wavy projectile throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Sleep null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 103</li> <li>Yield for 0.1 seconds</li> <li>A new GameObject is created rooted with a SpriteRenderer using the <code>projectilepsrites[5]</code> sprite (gray spiky projectile) positioned at this enemy + (-0.9, 1.0, -0.1) with a ShadowLite that is SetUp with 0.4 opacity and 0.5 size</li> <li>Yield a frame</li> <li><code>Spit</code> sound plays</li> <li><code>WavyLoop</code> sound plays on loop with 0.75 volume</li> <li>Over the course of 65.0 frames (50.0 frames instead if hardmode is true), the projectile object is lerped to <code>playertargetentity</code> position + (0.0, 1.0, 0.0) which is then added to (0.0, Sin(Time.time * 15.0) * 0.3, 0.0) which gives a vertical oscillation travel. Before each frame yield, the z angle increases by 10x the game's frametime</li> <li><code>WavyLoop</code> sound stopped</li> <li>DoDamage 1 call happens</li> <li>Yield a frame</li> <li>The projectile object is destroyed</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#move-3-delayed-projectile","title":"Move 3 - Delayed projectile","text":"<p>Adds a DelayedProjectile. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#nonphyscal-set-to-true_3","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true, but it doesn't affect anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1 Always happen A new sprite object using the <code>projectilepsrites[5]</code> sprite (gray spiky projectile) positioned at (0.0, 10.0, 0.0) childed to the <code>battlemap</code> with a SpinAround that has an <code>itself</code> of -10.0 in z A random <code>plauyerdata</code> index 2 2 -1 Sleep 60.0 This enemy null null <code>@ChargeDown3</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>Camera moves to look near this enemy</li> <li>animstate set to 100</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 105</li> <li>Yield for 0.15 seconds</li> <li>animstate set to 106</li> <li>Yield for 0.15 seconds</li> <li><code>Spit</code> sound plays</li> <li><code>Charge5</code> sound plays</li> <li>A new sprite object is created using the <code>projectilepsrites[5]</code> sprite (gray spiky projectile) positioned at (0.0, 10.0, 0.0) childed to the <code>battlemap</code> with a SpinAround that has an <code>itself</code> of -10.0 in z|</li> <li>Over the course of 50.0 frames, the projectile object moves to (this enemy - 1.0, 10.0, 0.0) with a lerp and scales up to 1.5x with a lerp, but that only grows over the course of the first 30.0 frames</li> <li>Yield a frame</li> <li>The projectile object position is set to (0.0, 10.0, 0.0)</li> <li>AddDelayedProjectile 1 call happens</li> <li>Yield for 0.3 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#move-4-heal-breath","title":"Move 4 - Heal breath","text":"<p>A heal breath that heals the <code>hp</code> of another enemy party member. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#nonphyscal-set-to-true_4","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true, but it doesn't affect anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>Camera moves to look near the midpoint between this enemy and the target enemy party member</li> <li>FaceTowards the target enemy party member</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 103</li> <li>Yield for 0.1 seconds</li> <li><code>HealBreath</code> sound plays</li> <li><code>HealSmoke</code> particles played near this enemy with an alivetime of 5.0</li> <li>Yield for a second</li> <li>Heal called on the target enemy party member to heal an amount of <code>hp</code> equal to its <code>maxhp</code> * 0.1 clamped from 3 to 99</li> <li>Yield for 1.15 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#move-5-multiple-projectiles","title":"Move 5 - Multiple projectiles","text":"<p>A single target multiple projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#nonphyscal-set-to-true_5","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 to 3 times 1 Sleep This enemy <code>playertargetID</code> after GetSingleTarget (same target for each calls) A new GameObject rooted with a SpriteRenderer using the <code>projectilepsrites[5]</code> sprite (gray spiky projectile) positioned at this enemy + (0.9, 1.0 + <code>height</code>, -0.1) with a ShadowLite that is SetUp with 0.4 opacity and 0.5 size 0.025 (40.0 frames of movement) if hardmode is false, 0.03 if it's true (~33.333334 frames of movement) 0.0 null null null null (0.0, 0.0, 20.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/AngryPlant/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 103</li> <li>Yield for 0.1 seconds</li> <li>The amount of hits is determined to be random between 2 and 3 and it is used to initialise the array of projectiles objects</li> <li>Done for each hit:<ul> <li><code>Spit</code> sound plays</li> <li>A new GameObject is created rooted with a SpriteRenderer using the <code>projectilepsrites[5]</code> sprite (gray spiky projectile) positioned at this enemy + (0.9, 1.0 + <code>height</code>, -0.1) with a ShadowLite that is SetUp with 0.4 opacity and 0.5 size. The projectile is assigned to the corresponding element of the projectiles array</li> <li>Yield for a frame</li> <li>Projectile 1 call happens using the GameObject mentioned above</li> <li>Yield for 0.3 seconds (0.225 seconds instead if hardmode is true)</li> </ul> </li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until all elements of the projectiles array are null (meaning they were all destroyed so all Projectile calls completed)</li> <li>Yield for 0.2 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ArmoredPoly/","title":"<code>ArmoredPoly</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/ArmoredPoly/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the rolling attack move, the multiplier of the MoveTowards call changes to 3.65 from of 3.0. This makes the enemy moves ~21.6666667% faster</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ArmoredPoly/#move-selection","title":"Move selection","text":"<p>1 move is possible:</p> <ol> <li>A single target rolling attack</li> </ol> <p>Move 1 is always done.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ArmoredPoly/#move-1-rolling-attack","title":"Move 1 - Rolling attack","text":"<p>A single target rolling attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ArmoredPoly/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ArmoredPoly/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy position and <code>playerdata[playertargetID]</code></li> <li>animstate set to 23 (<code>Chase</code>)</li> <li><code>Curl</code> sound plays</li> <li>Jump called</li> <li>Yield for 0.1 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> <li>Yield for 0.3 seconds</li> <li>Camera moved to look near <code>playerdata[playertargetID]</code></li> <li><code>Spin2</code> sound plays on loop using <code>sounds[9]</code></li> <li>MoveTowards <code>playerdata[playertargetID]</code> + 0.5 in x - <code>globalcamdir</code>'s forward * 0.2 with a multiplier of 3.0 (3.65 if hardmode is true) and both the current animstate as the walkstate and stopstate</li> <li>Yield a frame</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>DoDamage 1 call happens</li> <li>SetDefaultCamera called</li> <li>If <code>commandsuccess</code> is false (failed to block, ignores FRAMEONE):<ul> <li>MoveTowards (-20.0, 0.0, this enemy's z position) using the same multiplier as the call before and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done. Before each frame yield, <code>playerdata[playertargetID]</code> has their animstate set to 11 (<code>Hurt</code>) and y <code>spin</code> to (0.0, 30.0, 0.0) * the distance between this enemy position and its <code>forcetarget</code> clamped from 0.0 to 1.0</li> <li><code>playerdata[playertargetID]</code> animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>playerdata[playertargetID]</code>'s <code>spin</code> zeroed out</li> <li>position set to (10.0, 0.0, startp.z)</li> <li>MoveTowards startp with 2.0 as multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul> </li> <li>Otherwise:<ul> <li>MoveTowards current position + 1.5 in x with 1.5 as multiplier and both the current animstate as the walkstate and stopstate</li> </ul> </li> <li><code>sounds[9]</code> stopped</li> <li>Jump called</li> <li>Yield for 0.1 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> <li>If <code>commandsuccess</code> is true (blocked, ignores FRAMEONE), <code>flip</code> is toggled</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Jump called</li> <li>Yield for 0.4 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/","title":"<code>Bandit</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the projectile throw, the projectile takes 1 / 0.045 frames (~22.22222223 frames) for the projectile to move to its target instead of 1 / 0.025 frames (40.0 frames)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target tackle attack that may steal an item</li> <li>A single target projectile throw</li> <li>Flees the battle</li> </ol> <p>Move 3 is only used if this enemy has an <code>holditem</code> and it is the only one that will be used under this condition.</p> <p>As for the other moves, the decision of which moves to use is based on the following odds:</p> Move Odds 1 4/10 2 6/10"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#move-1-tackle-attack-with-potential-item-steal","title":"Move 1 - Tackle attack with potential item steal","text":"<p>A single target tackle attack that may steal an item.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 101</li> <li>Yield for 0.1 seconds</li> <li><code>Gleam</code> particles played with <code>Gleam</code> sound at this enemy position + (0.25, 2.0, -0.1) with an alivetime of 0.5</li> <li>Yield for 0.5 seconds</li> <li><code>trail</code> set to true</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li><code>Scuttle</code> sound plays on loop using <code>sounds[9]</code></li> <li>Over the course of 25.0 frames this enemy moves to <code>playertargetentity</code> position via a BeizierCurve3 with a ymax of the midpoint between startp and <code>playertargetentity</code> + -3.0 in z</li> <li>Once the 25.0 frames are done:<ul> <li><code>flip</code> set to true</li> <li>DoDamage 1 call happens</li> <li>If <code>playerdata[playertargetID]</code> doesn't have the Shield condition, StealItem is called</li> <li>If an item was stolen from the call above, the local startstate is set to 4 (<code>ItemGet</code>)</li> </ul> </li> <li>Over the course of 25.0 frames this enemy moves to startp via a BeizierCurve3 with a ymax of the midpoint between startp and <code>playertargetentity</code> + 3.0 in z</li> <li><code>sounds[9]</code> is stopped</li> <li>position set to startp</li> <li><code>flip</code> set to false</li> <li><code>trail</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#move-2-projectile-throw","title":"Move 2 - Projectile throw","text":"<p>A single target projectile throw</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 null This enemy <code>playertargetID</code> after GetSingleTarget A new GameObject named <code>proj</code> rooted with a SpriteRenderer using the <code>projectilepsrites[3]</code> sprite (a triwing projectile) 0.025 (40.0 frames of movement) if hardmode is false, 0.045 if it's true (~22.222223 frames of movement) 0.0 null null null null (0.0, 0.0, 20.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>A new GameObject named <code>proj</code> is created rooted with a SpriteRenderer</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li><code>proj</code> position set to this enemy + (0.75, 2.0, -0.1)</li> <li><code>proj</code> sprite set to <code>projectilepsrites[3]</code> sprite (a triwing projectile)</li> <li><code>spin3</code> sound plays on loop using <code>sounds[9]</code></li> <li><code>Toss</code> sound plays</li> <li>Projectile 1 call happens</li> <li>Yield all frames until <code>proj</code> is null (it was destroyed meaning Projectile is done)</li> <li><code>sounds[9]</code> stopped</li> <li>Yield for 0.6 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#move-3-flee","title":"Move 3 - Flee","text":"<p>Flees the battle, no damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bandit/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>tryenemyheal</code> set to a new EnemyFlee coroutine with walkstate 27 (<code>ItemWalk</code>) with afterimage on this enemy</li> <li>Yield all frames until <code>tryenemyheal</code> goes to null (the coroutine completed)</li> <li>The local fled is set to true indicating a different post action will be done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/","title":"<code>BanditLeader</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#special-useitem-logic","title":"Special UseItem logic","text":"<p>This enemy has very special handling whenever the UseItem action coroutine is invoked where they will interupt the item usage (even going through stopping conditions if they have any).</p> <p>To learn more, check the <code>BanditLeader</code> special UseItem logic for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the sword slash move, the odds to use the sword thrust move immediately after on the same actor turn changes to 7/10 from 5/10 when HPPercent is less than 0.5</li> <li>In the sword thrust move, the base damage amount is 1 instead of 2 per hit</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target sword thrust that hits multiple times</li> <li>A single target sword slash</li> </ol> <p>The usage of the moves is determined by these odds:</p> Move Odds 1 4/7 2 3/7 <p>However, it is possible if move 2 is used that move 1 is used right after in the same actor turn. This happens if all the following conditions are fufilled at the end of move 2:</p> <ul> <li>HPPercent is less than 0.5</li> <li>A 5/10 RNG check passes (7/10 instead if hardmode is true)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen at the start of the actor turn if HPPercent is 0.65 or less. Notably, <code>moves</code> is set to 2 and <code>cantmove</code> decremented which gives 2 actor turns per main turn on this enemy including the current one:</p> <ul> <li>animstate set to 103</li> <li><code>moves</code> set to 2</li> <li><code>cantmove</code> decremented</li> <li>Yield for 0.35 seconds</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called with type 5 (yellow up arrow)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen at the end of the action:</p> <ul> <li>If <code>cantmove</code> is higher than -1 (meaning this is the last actor turn they can do) and a 50% RNG check passes:<ul> <li>isdefending set to true (activate their guard)</li> <li>defenseonhit set to 2</li> <li>The local startstate is set to 24 (<code>Block</code>)</li> </ul> </li> <li>Otherwise:<ul> <li>isdefending set to false (gets out of their guard)</li> <li>defenseonhit set to 0</li> <li>The local startstate is set to 0 (<code>Idle</code>)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#move-1-sword-thrust","title":"Move 1 - Sword thrust","text":"<p>A single target sword thrust that hits multiple times</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 2 times (random between 2 and 3 times instead if HPPercent is less than 0.65) This enemy <code>playertargetID</code> after GetSingleTarget (targer is the same for each calls) 2 (1 instead if hardmode is true) Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Gleam</code> particles plays with <code>Gleam</code> sound at this enemy + (0.1, 2.75, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playertargetentity</code> position + (2.5, 0.0, -0.1)</li> <li>MoveTowards <code>playertargetentity</code> position + (2.5, 0.0, -0.1) with 2.0 muiltiplier using 1 (<code>Walk</code>) as walkstate and 0 (<code>Idle</code>) as stopstate</li> <li>Yield until <code>forcemove</code> is done</li> <li>The amount of hits is determined. It's always 2 unless HPPercent is less than 0.65 where it's random between 2 and 3 times</li> <li>For each hit:<ul> <li><code>Woosh</code> sound plays with a pitch of 1.0 on the first and third hit or 1.1 on the second hit</li> <li>animstate set to 105 on the first and third hit or 106 on the second hit</li> <li>Yield for 0.15 seconds</li> <li>DoDamage 1 call happens</li> <li><code>Slash2</code> sound happens</li> <li>yield for 0.45 seconds</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#move-2-sword-slash","title":"Move 2 - Sword slash","text":"<p>A single target sword slash.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BanditLeader/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playertargetentity</code> position + (2.5, 0.0, -0.1)</li> <li>MoveTowards <code>playertargetentity</code> position + (2.5, 0.0, -0.1) with 2.0 muiltiplier using 1 (<code>Walk</code>) as walkstate and 0 (<code>Idle</code>) as stopstate</li> <li>Yield until <code>forcemove</code> is done</li> <li>animstate set to 103</li> <li><code>Slash2</code> sound plays</li> <li>Yield for 0.85 seconds</li> <li>animstate set to 107</li> <li><code>Slash</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.65 seconds</li> <li>If HPPercent is less than 0.5 and a 5/10 RNG test passes (7/10 instead if hardmode is true):<ul> <li><code>Gleam</code> particles plays with <code>Gleam</code> sound at this enemy + (-0.2, 2.75, -0.1) with 0.5 alivetime</li> <li>Move 1 (sword thrust) is used immeditaly on the same actor turn, but without the logic of everything until the <code>forcemove</code> yields as the enemy is already positioned with the right target selected</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/","title":"<code>BeeBoss</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 4 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: The amount of actor turns left before being able to use the summon move again after it was just used. When the move is used, the value is set to 3 meaning this enemy cannot use the summon move for the next 3 actor turns (the missiles throw move will be used instead if selected). The value is decremented in the pre move logic</li> <li><code>data[1]</code>: The amount of actor turns left before being able to launch a delayed projectile in the post move logic again after one was just launched. When a delayed projectile is launched, the value is set to 4 meaning this enemy cannot launch another delayed projectile for the next 4 actor turns. The value is decremented in the pre move logic</li> <li><code>data[2]</code>: This is set to 1 when the phase transition occurs in the pre move logiic when HPPercent reaches lower than 0.6 so it prevents the transition to happen again</li> <li><code>data[3]</code>: A counter that is set to 3 when the charge move is used and gets decremented if it was above 0 in the post move logic on every actor turns except when the charged dash attack move is used. The charge move requires this value to be at 0 to be used again which effectively means that when the charge move is used, it will not be used for the next 3 actor turns (the next one isn't counted and the next 2 won't have a charge usage because this value will be above 0). If the charge move is selected and this value is above 0, the missiles throw move will be used instead</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>This enemy has some special logic that happens on StartBattle after they are loaded:</p> <ul> <li><code>battlepos</code> set to (4.5, 0.0, 0.0)</li> <li>position set to their <code>battlepos</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the missiles throw move, the amount of missiles thrown changes to 3 from 2</li> <li>In the missiles throw move, the speed of each projectile changes to 40.0 from 50.0</li> <li>In the missiles throw move, the yield time between each throw changes to 0.65 seconds from 0.85 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A party wide laser attack</li> <li>A multiple targets missiles throw</li> <li>Summon a new BeeBot enemy</li> <li>Prepares an attack next turn which increments <code>charge</code></li> <li>A party wide charged dash attack</li> </ol> <p>Move 5 will always be used (and can only be used) when <code>basestate</code> isn't 0 (<code>Idle</code>) or <code>charge</code> is above 0 (meaning move 4 was used last actor turn).</p> <p>As for other moves, the decision of which move to use is based on odds, but the odds changes depending if HPPercent is less than 0.5 or not. Additionally, some moves have additional requirements that needs to be fufilled upon selecting the move. If those requirements aren't fufilled when the move is selected, another move will be used instead.</p> Move Odds when HPPercent &gt;= 0.5 Odds when HPPercent &lt; 0.5 Requirements Move used when requirements failed 1 1/4 1/6 None N/A 2 1/4 2/6 None N/A 3 1/4 1/6 <ul><li>This is the last enemy party member left</li><li><code>data[0]</code> is 0 (the actor turn cooldown on this move exhausted)</li><li>HPPercent is above 0.2</li></ul> Move 2 4 1/4 2/6 <ul><li><code>data[3]</code> is 0 (the actor turn cooldown on this move exhausted)</li><li>HPPercent is between 0.15 exclusive and 0.65 exclusive</li></ul> Move 2"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#pre-move-logic","title":"Pre move logic","text":"<p>There is logic that always happen at the start of the action. It's split in 3 parts that happens in the order mentioned.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#change-of-position-to-flying","title":"Change of position to <code>Flying</code>","text":"<p>The following logic always happen if position is <code>Ground</code>:</p> <ul> <li>ShakeSprite called with intensity (0.15, 0.0, 0.0) and 50.0 frametimer</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>b33Shake</code> sound plays</li> <li>Yield for 0.8 seconds</li> <li><code>b33BotRisingFromGround</code> sound plays</li> <li>Over the course of 51.0 frames, <code>height</code> changes to the y component of a BeizierCurve3 from Vector3.zero to (0.0, <code>initialheight</code>, 0.0) with a ymax of <code>initialheight</code> * 2</li> <li><code>height</code> set to <code>initialheight</code></li> <li><code>bobrange</code> and <code>bobspeed</code> set to <code>startbf</code> and <code>startbs</code> respectively</li> <li>position set to <code>Flying</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#data-cooldowns-decrement","title":"<code>data</code> cooldowns decrement","text":"<p>The following logic always happen:</p> <ul> <li>If <code>data[0]</code> is higher than 0, it is decremented (this is the summon move cooldown)</li> <li>If <code>data[1]</code> is higher than 0, it is decremented (this is the delayed projectile cooldown)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#phase-transition","title":"Phase transition","text":"<p>The following logic always happen if <code>data[2]</code> is 0 (this phase transition hasn't happened yet) and HPPercent is less than 0.65:</p> <ul> <li>animstate set to 108</li> <li><code>B33BotMalfunction</code> sound plays</li> <li>Done 3 times:<ul> <li>ShakeSprite called with intensity (0.2, 0.2, 0.2) and 30.0 frametimer</li> <li>DeathSmoke particles plays at this enemy position + (0.0, <code>height</code> + 1.5, -0.25) + a random vector between (-2.5, -0.75, 0.0) and (2.5, 0.75, 0.0)</li> <li><code>b33BotCracking</code> sound plays</li> <li>Yield for 0.8 seconds if this isn't the last iteration</li> </ul> </li> <li>SetCondition called to inflict the AttackUp condition on this enemy for 9999999 main turns (infinite)</li> <li>SetCondition called to inflict the DefenseDown condition on this enemy for 9999999 main turns (infinite)</li> <li>The sprite of the <code>model</code>'s first child (their main body part) is set to <code>Sprites/Entities/beeboss</code> index 12 (a cracked body party)</li> <li>The <code>model</code>'s 6th child (weak smoke particles) has its ParticleSystem played</li> <li><code>data[2]</code> set to 1 (so this phase transition doesn't happen again)</li> <li>Yield for 0.85 seconds</li> <li>animstate set to <code>basestate</code></li> <li>Yield for 0.3 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#post-move-logic","title":"Post move logic","text":"<p>There is logic that always happen after a move is used with the exception of move 5 being used (the charged dash attack) where none of the logic happens. It notably features a DelayedProjectile being launched.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1 <ul><li>GetRandomAvaliablePlayer with nullable didn't return -1</li><li><code>data[1]</code> is 0 (the cooldown on this delayed projectile exhausted)</li><li><code>basestate</code> is 0 (<code>Idle</code>) meaning the charged dash attack move wasn't used on this enemy's last actor turn</li></ul> A new <code>Prefabs/Objects/BeeRocket</code> GameObject rooted positioned at (0.0, 20.0, 0.0) with a z angle of 75.0 GetRandomAvaliablePlayer with nullable<sup>1</sup> 4 3 0 null 60.0 This enemy <code>Explosion3</code> <code>explosion</code> <code>MisseleFall</code> <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If <code>data[3]</code> is above 0, it is decremented (this is the cooldown for the charging move)</li> <li>GetRandomAvaliablePlayer with nullable is called. If it returns -1, the action ends early</li> <li>Camera moves to look near this enemy, but a bit up</li> <li>animstate set to 105</li> <li><code>B33BotHatchOpen</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 106</li> <li>A new <code>Prefabs/Objects/BeeRocket</code> GameObject rooted positioned at <code>model</code>'s third child position (their front canon) + (-0.2, 0.8, -0.2) with a z angle of -85.0</li> <li>HitPart particles plays at the <code>Prefabs/Objects/BeeRocket</code> position</li> <li><code>b33BotRocketLaunchInAir</code> sound plays</li> <li>Over the course of 41.0 frames, the <code>Prefabs/Objects/BeeRocket</code> moves to (this enemy x position - 1.0, 10.0, 0.0) via a SmoothLerp. After the  first frame yield past 20.0 frames animstate set to 104</li> <li><code>Prefabs/Objects/BeeRocket</code> position set to (0.0, 20.0, 0.0)</li> <li><code>Prefabs/Objects/BeeRocket</code> z angle set to 75.0</li> <li>AddDelayedProjectile 1 call happens</li> <li><code>data[1]</code> set to 4 (this is the cooldown for launching another delayed projectile)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#move-1-laser-attack","title":"Move 1 - Laser attack","text":"<p>A party wide laser attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 3 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>Camera moves to look near the midpoint between this enemey and <code>partymiddle</code></li> <li>animstate set to 102</li> <li><code>B33BotHatchOpen</code> sound plays</li> <li>Yield for 0.65 seconds</li> <li>animstate set to 103</li> <li>Yield for a frame</li> <li><code>anim</code> gets disabled</li> <li><code>b33BotLaser</code> sound plays</li> <li>Done 2 times:<ul> <li><code>model</code>'s second or third child (their front or back canon)'s z angle set to 75.0. The front canon is changed on the first iteration and the back one is changed on the second</li> <li>A new <code>Prefabs/Particles/Lazer</code> GameObject is instantiated childed to the matching canon with a local postion of (-1.0, 0.0, 0.0), a y angle of -95.0 and their ParticleSystem's main module's startLifetime set to a 15.0 constant curve</li> <li>The <code>Prefabs/Particles/Lazer</code>'s ParticleSystem's MainModule is fast forwarded via Simulate for 20.0 seconds</li> </ul> </li> <li>Yield for 0.2 seconds</li> <li>Over the course of 26.0 frames, both canon's z angle changes from 75.0 to 10.0 via LerpAngle</li> <li>Both <code>Prefabs/Particles/Lazer</code> gets destroyed in 0.15 seconds</li> <li>Done 4 times:<ul> <li><code>b33BotLaserExplosions</code> sound plays with a pitch of 1.0 + 0.1 * the index of this iteration starting at 0</li> <li><code>ExplosionPillar</code> particles played at a specific lerp between this enemy -1.0 in x and <code>partymiddle</code> where the factor is the (this iteration index starting at 1) / 4 (each gets closer to <code>partymiddle</code> with equidistance between the lerp factors)</li> <li>ShakeScreen called with ammount of 0.05 * this iteration index starting at 1 and 0.2 time</li> <li>Yield for 0.2 seconds if this isn't the last iteration</li> <li><code>anim</code> is enabled</li> <li>animstate set to 104</li> </ul> </li> <li>PartyDamage 1 called</li> <li>Yield for 0.5 seconds</li> <li><code>Click2</code> sound plays</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#move-2-missiles-throw","title":"Move 2 - Missiles throw","text":"<p>A multiple targets missiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 times (3 times instead if hardmode is true), but the call and each subsequent ones won't happen if GetRandomAvaliablePlayer with nullable returns -1 2 null This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) A new <code>Prefabs/Objects/BeeRocket</code> GameObject rooted positioned at this enemy's front canon position (back canon instead if it's the second call) + (-1.0, 0.5, -0.2) with scale (0.5, 0.75, 1.0) 50.0 (40.0 instead if hardmode is true) 4.0 null <code>deathsmoke</code> <code>Explosion</code> null Vector3.zero false <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>Camera moves to look near the midpoint between this enemey and <code>partymiddle</code></li> <li>animstate set to 100</li> <li><code>B33BotHatchOpen</code> sound plays</li> <li>Yield for 0.65 seconds</li> <li>The amount of hits is determined which is always 2 (3 instead if hardmode is true)</li> <li>animstate set to 101</li> <li>Yield for a frame</li> <li><code>anim</code> gets disabled</li> <li>A new array of GameObject is created with the length being the amount of hits to do to hold the projectiles</li> <li>A new sprite object is created rooted using the <code>guisprites[93]</code> sprite (a crosshair) positioned offscreen at 99.0 in y with a pure green color on layer 15 (<code>3DUI</code>)</li> <li>For each hits to do:<ul> <li>GetRandomAvaliablePlayer with nullable is called</li> <li>If it didn't returned -1 (a valid target was found):<ul> <li>The crosshair scale is set to 3x</li> <li>GradualScale happens on the crosshair towards 1x with 15.0 frametime without destroy</li> <li><code>b33BotSummonNoise</code> sound plays using <code>sounds[5]</code> with 1.3 pitch</li> <li>The crosshair position is set to the target player party member's position + (0.0, 1.5, 0.1)</li> <li>Yield for 0.1 seconds</li> <li><code>sounds[5]</code> stopped</li> <li><code>b33BotInstantMissle</code> sound plays</li> <li>The projectile element is set to a new <code>Prefabs/Objects/BeeRocket</code> GameObject rooted positioned at this enemy's front canon position (back canon instead if it's the second call) + (-1.0, 0.5, -0.2) with scale (0.5, 0.75, 1.0)</li> <li>HitPart particles plays at the projectile position</li> <li>Projectile 1 call happens</li> <li>Yield for 0.85 seconds (0.65 seconds instead if hardmode is true)</li> </ul> </li> <li>Otherwise (no target was found), for each player party members whose <code>hp</code> is 0:<ul> <li>The crosshair position is set to the player party member's position + (0.0, 1.0, 0.1)</li> <li>The crosshair scale is set to 3x</li> <li>GradualScale happens on the crosshair towards 1x with 15.0 frametime without destroy</li> <li><code>b33BotSummonNoise</code> sound plays using <code>sounds[5]</code> with 1.3 pitch</li> <li>Yield for 0.5 seconds</li> <li><code>sounds[5]</code> stopped</li> </ul> </li> </ul> </li> <li><code>anim</code> enabled</li> <li>animstate set to 104</li> <li>Yield all frames until all projectiles elements are null (all Projectile calls completed)</li> <li>Yield for 0.5 seconds</li> <li><code>Click2</code> sound plays</li> <li>The crosshair is destroyed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#move-3-beebot-summon","title":"Move 3 - BeeBot summon","text":"<p>Summon a new BeeBot enemy. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which doesn't affect anything for this action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>animstate set to 107</li> <li><code>b33BotSummonNoise</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a BeeBot enemy with type <code>OffscreenNoAnim</code> at (0.6, 0.0, -0.75)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>data[0]</code> set to 3 (this is the cooldown to use this move again)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#move-4-prepares-a-big-attack-with-1-charge","title":"Move 4 - Prepares a big attack with 1 <code>charge</code>","text":"<p>Prepares an attack next turn which increments <code>charge</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#nonphyscal-set-to-true_3","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which doesn't affect anything for this action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>animstate set to 107</li> <li><code>b33BotChargept1</code> sound plays</li> <li>ShakeSprite called with intensity (0.1, 0.0, 0.0) and 40.0 frametimer</li> <li>Yield for 0.75 seconds</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li><code>charge</code> incremented</li> <li><code>basestate</code> and the local startstate set to 107 (this is what will allow to use move 5 on the next actor turn which is the charged dash attack)</li> <li><code>data[3]</code> set to 3 (this is the cooldown to use this move again)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#move-5-dash-attack","title":"Move 5 - Dash attack","text":"<p>A party wide charged dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#partydamage_1","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 null <code>commandsuccess</code> 20.0 (0.0, 30.0, 0.0) false {NoDamageAnim}"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBoss/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li><code>height</code> set to 0</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>y position increased by <code>height</code> value before this action</li> <li><code>b33BotChargept1</code> sound plays</li> <li>Over the course of 61.0 frames, this enemy moves to its current position + (1.0, -0.5, 0.0) via a BeizierCurve3 with a ymax of -1.5</li> <li><code>b33BotChargept2</code> sound plays</li> <li>ShakeSprite called with intensity (0.15, 0.0, 0.0) and 60.0 frametimer</li> <li>Yield for a second</li> <li><code>model</code>'s 6th children's ParticleSystem (a thrust below on the right of their main body part) is played</li> <li><code>model</code>'s 5th children's ParticleSystem (a thrust below their main body part) is stopped</li> <li>The first <code>shadow</code>'s ParticleSystem is stopped</li> <li><code>b33BotChargept3</code> sound plays</li> <li>Over the course of 61.0 frames, this enemy moves to (-30.0, 0.0, 0.0) via a SmoothLerp. On the first frame that this enemy x position becomes less than -4.5:<ul> <li><code>BigHit</code> sound plays</li> <li>PartyDamage 1 call happens</li> <li>ShakeScreen called with 0.5 ammount and 0.35 time</li> </ul> </li> <li>position set to (30.0, 0.0, 0.0)</li> <li><code>height</code> set to the value before this action</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Over the course of 61.0 frames, this enemy moves to startp via a SmoothLerp</li> <li><code>model</code>'s 6th children's ParticleSystem (a thrust below on the right of their main body part) is stopped</li> <li><code>model</code>'s 5th children's ParticleSystem (a thrust below their main body part) is played</li> <li>The first <code>shadow</code>'s ParticleSystem is played</li> <li><code>basestate</code>, animstate and the local startstate set to 0 (<code>Idle</code>) which will prevent this move to be used again until move 4 is used (charge and prepare)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/","title":"<code>BeeBot</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy gets loaded with the <code>BeeBot</code> animid which is needed for the CheckSpecialID to work as it is needed for correct move selection logic.</p> <p>It is also that this enemy gets laoded with a onhitaction of 1 so their <code>hitaction</code> logic works.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#randomposafter-set-to-true","title":"randomposafter set to true","text":"<p>This enemy action always sets the randomposafter local to true except in a <code>hitaction</code> logic. This means that in post-action when no enemy fled, this enemy's position will be randomly determined between <code>Ground</code> and <code>Flying</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#data-usage","title":"<code>data</code> usage","text":"<p>On CheckSpecialID for this enemy, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value being 0 or 1 determined randomly with uniform probabilities on top of calling UpdateAnimSpecific.</p> <ul> <li><code>data[0]</code>: This value determines the move that will be used. A value of 0 means the dash attack move will be used and a value of 1 means the honey throw move will be used. It is meant to be toggled between 0 and 1 during the <code>hitaction</code> logic. Since the starting value is random between 0 and 1 inclusive, it means the starting move slated for selection is random</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the honey throw move, 2 projectiles will be thrown instead of 3</li> <li>In the honey throw move, the speed of each projectile changes to 0.03 (~33.333333334 frames of movement) from 0.025 (40.0 frames of movement)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves (but the post move logic will still occur)</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Jump</code> sound plays with 1.1 volume</li> <li>Jump called</li> <li>Yield for 0.5 seconds</li> <li><code>BeeBotModeSwitch</code> sound plays</li> <li>animstate set to 100 + <code>data[0]</code> (normally, 100 or 101)</li> <li>Yield for a frame</li> <li><code>data[0]</code> toggles: if it was 0, it's set to 1 and if it was 1, it's set to 0</li> <li>Yield for 0.6 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>UpdateAnimSpecific called</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target dash attack</li> <li>A single target multiple honey projectiles throw</li> </ol> <p>The decision of which moves to use entirely depends on the value of <code>data[0]</code>: Move 1 is used if it's 0 and move 2 is used if it's 1. The starting value is random between 0 and 1, but it toggles between the 2 during the <code>hitaction</code> logic.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before a move (this excludes <code>hitaction</code> where this logic won't happen):</p> <ul> <li>If position is <code>Ground</code>, it is set to flying with the following logic:<ul> <li>Over the course of 21.0 frames, <code>height</code> changes from <code>minheight</code> to 2.0 via a lerp</li> <li>position is set to <code>Flying</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen at the end of the action (even if a <code>hitaction</code> was done):</p> <ul> <li>SetDefaultCamera called</li> <li>MoveTowards startp with 2.0 multiplier using 0 (<code>Idle</code>) as both walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#move-1-dash-attack","title":"Move 1 - Dash attack","text":"<p>A single target dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moved to look near the midpoint between <code>playertargetentity</code> and this enemy</li> <li><code>height</code> set to 0.0</li> <li>This enemy moves 2.0 in y</li> <li><code>sprite</code> z angle set to 20.0</li> <li><code>Spin7</code> sound plays</li> <li>Over the course of 31.0 frames, this enemy moves to its postion + (1.5, 3.0, -0.25) via a BeizierCurve3 with a ymax of -0.75</li> <li><code>Charge10</code> sound plays</li> <li>ShakeSprite called with intensity (0.2, 0.0, 0.0) with 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li><code>Prefabs/Particles/WalkDust</code> instantiated childed to the <code>sprite</code> with a local position of Vector3.zero and the following adjustements:<ul> <li>main.startLifetime: 1.5 constant curve</li> <li>main.startSize: 1.2</li> <li>emission.rateOverTime: 15.0 constant curve</li> </ul> </li> <li>Camera moves to look near <code>playertargetentity</code></li> <li><code>Shot2</code> sound plays</li> <li>Over the course of 31.0 frames, this enemy moves to <code>playertargetentity</code> position + (-2.5, 2.0, -0.1) via a BeizierCurve3 with a ymax of -1.0. After the first frame that this enemy x position becomes equal or lower than the <code>playertargetentity</code> x position, DoDamage 1 call happens</li> <li><code>Prefabs/Particles/WalkDust</code> moved offscreen to 9999.0 in y then destroyed in 3.0 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>sprite</code> angles reset to the value before this action</li> <li><code>height</code> reset to the value before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#move-2-honey-projectiles-throw","title":"Move 2 - Honey projectiles throw","text":"<p>A single target multiple honey projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 3 times (2 times instead if hardmode is true) 1 Numb This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) A new sprite object rooted using the <code>projectilepsrites[10]</code> sprite (honey projectile) positioned at this enemy's <code>model</code>'s first child's third child (its minigun) + (-0.6, -0.25, -0.1) with a scale of 0.3x, a ShadowLite that is SetUp with 0.4 opacity and 0.5 size and a DialogueAnim with <code>targetscale</code> of 0.75x and a 0.1 <code>shinkspeed</code> 0.025 (40.0 frames of movement) if hardmode is false, 0.03 if it's true (~33.333334 frames of movement) 0.0 null <code>ElecFast</code> null null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeBot/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near (-2.0, 0.0, 0.0)</li> <li>MoveTowards (1.0, 0.0, -0.5) with 2.0 multiplier using 0 (<code>Idle</code>) as both walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>The minigun's SpriteRenderer is obtained which is its <code>model</code>'s first child's third child</li> <li>The minigun is enabled</li> <li>Over the course of 16.0 frames, the y local position of the minigun changes to -0.5 (the x is always set to 0.0 and the z to 0.05)</li> <li>Yield for 0.25 seconds</li> <li>The SpriteBounce of the minigun is enabled</li> <li>The amount of projectiles to throw is determined. It is always 3 (2 instead if hardmode is true) and a new SpriteRenderer array is initialised to hold each projectile</li> <li>For each projectile to throw:<ul> <li><code>Spit</code> sound plays</li> <li>A new sprite object is created rooted using the <code>projectilepsrites[10]</code> sprite (honey projectile) positioned at this enemy's <code>model</code>'s first child's third child (its minigun) + (-0.6, -0.25, -0.1) with a scale of 0.3x, a ShadowLite that is SetUp with 0.4 opacity and 0.5 size and a DialogueAnim with <code>targetscale</code> of 0.75x and a 0.1 <code>shinkspeed</code></li> <li>Yield for a frame</li> <li>HitPart partiles plays at the projectile position</li> <li><code>Shot</code> sound plays</li> <li>Projectile 1 call happens</li> <li>Over the course of 11.0 frames, this enemy moves + 0.5 in x via a BeizierCurve3 with a ymax of -0.25</li> <li>Yield for 0.1 seconds</li> <li>Over the course of 11.0 frames, this enemy moves - 0.5 in x via a BeizierCurve3 with a ymax of -0.1</li> <li>position set to the one it had before throwing this projectile The minigun's SpriteBounce is disabled</li> </ul> </li> <li>Yield all frames until all projectiles array elements are null (meaning all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> <li>Over the course of 16.0 frames, the y local position of the minigun changes to 0.0 (the x is always set to 0.0 and the z to 0.05)</li> <li>The minigun is disabled</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/","title":"<code>BeeTurret</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: The amount of actor turns left before being about to use the delayed projectile move again after it was used. This value is set to 4 when the delayed projectile move is used and in the pre move logic, it is decremented if it is higher than 0. This means normally, 4 actor turns needs to pass between each delayed projectiles usage.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the delayed projectile move, the amount of main turns needed for the projectile to land changes to 1 from 2</li> <li>In the honey projectiles move, the speed of each projectiles changes to 40.0 from 45.0</li> <li>In the rocket projectiles move, the speed of each projectiles changes to 30.0 from 35.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A Multiple targets honey projectiles throw that hits twice</li> <li>A multiple targets rocket projectiles throw that hits twice</li> <li>Adds a single target Delayed projectile</li> </ol> <p>The decision of which moves to use is based on the following odds:</p> Move Odds 1 2/5 2 2/5 3 1/5 <p>However, move 3 has the additional requirement that <code>data[0]</code> has to be 0 after the pre move logic for the move to be used. If it's selected, but this requirement isn't fufilled, Move 1 will be used instead, but with one change: the <code>Blosh</code> sound will be played instead of <code>Clomp</code> like it normally would.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen at the start of the actor turn:</p> <ul> <li>If <code>data[0]</code> is higher than 0, it is decremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#move-1-honey-projectiles-throw","title":"Move 1 - Honey projectiles throw","text":"<p>A multiple target honey projectiles throw that hits twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times, but each call can only happen if at least 1 player party member is alive (<code>hp</code> more than 0 and not eatenby) 2 Numb This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new GameObject childed to <code>battlemap</code> with a SpriteRenderer using the <code>projectilepsrites[10]</code> sprite (a honey projectile) with the <code>spritemat</code> material positioned at this enemy position + (-1.0, -1.0, 0.1) on layer 14 (<code>Sprite</code>) with a SpriteBounce that has MessageBounce called on it with 3.0 multiplier 35.0 (30.0 instead if hardmode is true) 0.0 null <code>ElecFast</code> null null (0.0, 0.0, 20.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Clomp</code> sound plays. NOTE: If this moved is used as a result from selecting move 2 when <code>data[0]</code> wasn't 0, <code>Blosh</code> sound plays instead</li> <li>animstate set to 100</li> <li>Yield for 0.95 seconds</li> <li>A new array of 2 Transform is created to hold the projectiles</li> <li>For each projectiles to throw:<ul> <li>If there is at least one alive player party member (<code>hp</code> above 0 and not EatenBy):<ul> <li>GetSingleTarget called</li> <li>animstate set to 102</li> <li><code>Shot</code> sound plays</li> <li>Projectile element initialized to a new GameObject childed to <code>battlemap</code> with a SpriteRenderer using the <code>projectilepsrites[10]</code> sprite (a honey projectile) with the <code>spritemat</code> material positioned at this enemy position + (-1.0, -1.0, 0.1) on layer 14 (<code>Sprite</code>) with a SpriteBounce that has MessageBounce called on it with 3.0 multiplier</li> <li>Projectile 1 call happens</li> </ul> </li> <li>Yield for 0.15 seconds</li> <li>If this isn't the last projectile:<ul> <li>animstate set to 100</li> <li>Yield for 0.85 seconds</li> </ul> </li> </ul> </li> <li>Yield all frames until both projectiles are null (meaning all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#move-2-rocket-projectiles-throw","title":"Move 2 - Rocket projectiles throw","text":"<p>A multiple targets rocket projectiles throw that hits twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#projectile-calls_1","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times, but each call can only happen if at least 1 player party member is alive (<code>hp</code> more than 0 and not eatenby) and that GetRandomAvaliablePlayer with nullable doesn't return -1 (if the first call returns -1, the second one won't happen) 3 null This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) A new <code>Prefabs/Objects/BeeRocket</code> GameObject childed to <code>battlemap</code> positioned at this enemy position + (-1.25, 1.7, 0.1) with scale (0.5, 0.75, 1.0) on layer 14 (<code>Sprite</code>) 45.0 (40.0 instead if hardmode is true) 4.0 null <code>explosionsmall</code> <code>Explosion</code> null Vector3.zero false <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>Blosh</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.95 seconds</li> <li>A new array of 2 Transform is created to hold the projectiles</li> <li>For each projectiles to throw:<ul> <li>If there is at least one alive player party member (<code>hp</code> above 0 and not EatenBy):<ul> <li>GetRandomAvailablePlayer called. If it returns -1, this will be seen as the last projectile and this one will not be thrown (skips to the next Yield)</li> <li>animstate set to 103</li> <li><code>b33BotInstantMissle</code> sound plays</li> <li>Projectile element initialized to a new <code>Prefabs/Objects/BeeRocket</code> GameObject childed to <code>battlemap</code> positioned at this enemy position + (-1.25, 1.7, 0.1) with scale (0.5, 0.75, 1.0) on layer 14 (<code>Sprite</code>)</li> <li>Projectile 1 call happens</li> </ul> </li> <li>Yield for 0.15 seconds</li> <li>If this isn't the last projectile:<ul> <li>animstate set to 100</li> <li>Yield for 0.85 seconds</li> </ul> </li> </ul> </li> <li>Yield all frames until both projectiles are null (meaning all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#move-3-delayed-projectile","title":"Move 3 - Delayed projectile","text":"<p>Adds a single target Delayed projectile. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which doesn't affect aything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1 Always happen A new <code>Prefabs/Objects/BeeRocket</code> GameObject rooted positioned at (0.0, 20.0, 0.0), a scale of (0.75, 1.0, 1.0) and a z angle of -75.0 <code>playertargetID</code> after GetSingleTarget 3 2 (1 instead if hardmode is true) 0 null 70.0 This enemy null <code>explosion</code> <code>@MisseleFall</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/BeeTurret/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near this enemy, but a bit up</li> <li>animstate set to 100</li> <li>Yield for a second</li> <li>animstate set to 104</li> <li><code>b33BotRocketLaunchInAir</code> sound plays</li> <li>A new <code>Prefabs/Objects/BeeRocket</code> GameObject rooted positioned at this enemy position + (0.0, 2.0, 0.2), a scale of (0.75, 1.0, 1.0) and a z angle of -85.0</li> <li>HitPart particles plays at the <code>Prefabs/Objects/BeeRocket</code> position</li> <li>Over the course of 41.0 frames, the <code>Prefabs/Objects/BeeRocket</code> moves to (this enemy x position -1.0, 10.0, 0.0) via a SmoothLerp. After the first frame past 20.0 frames, animstate is set to 104</li> <li>The <code>Prefabs/Objects/BeeRocket</code> position is set to (0.0, 20.0, 0.0)</li> <li>The <code>Prefabs/Objects/BeeRocket</code> z angle is set to 75.0</li> <li>AddDelayedProjectile call happens</li> <li><code>data[0]</code> set to 4 meaning this move won't be usable until 4 more actor turns passes on this enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/","title":"<code>Beetle</code>","text":"<p>NOTE: This page is about the enemy action, NOT the player party member.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to taunt before using a move changes to 30% from 20%</li> <li>In the rock throw move, the amount of frames the rock takes to move to the target is 41 frames instead of 48 frames</li> <li>In the dash move, the amount of frames the entire dash takes is 25 instead of 33</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#move-selection","title":"Move selection","text":"<p>4 moves are possible:</p> <ol> <li>A single target horn slash</li> <li>A single target underground strike</li> <li>A single target rock throw</li> <li>A party wide dash attack</li> </ol> <p>Here are the odds of using each move:</p> Move Odds 1 2/7 2 2/7 3 2/7 4 1/7"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#pre-move-logic","title":"Pre move logic","text":"<p>Before using any moves, if a 20% RNG check passes (30% instead if hardmode is true), this enemy will perform a move that inflicts the Taunted condition on a target. This isn't a dedicated move because if it is performed, the move selection still proceeds on the same actor turn after that so it's a still a pre move logic</p> <p>Here is the taunt move logic performed if the RNG check passes:</p> <ul> <li>GetSingleTarget called</li> <li>animstate set to 109</li> <li>Camera moves to look near this enemy</li> <li><code>Taunt2</code> sound plays on loop using <code>sounds[9]</code></li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>SetDefaultCamera called</li> <li>SetCondition called to inflict the Taunted condition on <code>playerdata[playertargetID]</code> for 2 main turns (effectively 1 since the main turn advances soon after)</li> <li><code>Taunt</code> sound plays</li> <li>animstate of <code>playertargetentity</code> set depending on <code>playertargetID</code> (their <code>trueid</code>)<ul> <li>0 (<code>Bee</code>): 10 (<code>Flustered</code>)</li> <li>1 (<code>Beetle</code>): 5 (<code>Angry</code>)</li> <li>2 (<code>Moth</code>): 102</li> </ul> </li> <li><code>Prefabs/Particles/AngryParticle</code> instantiated childed to <code>playertargetentity</code> with local position being Vector3.up</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>sounds[9]</code> stopped</li> <li><code>Prefabs/Particles/AngryParticle</code> destroyed</li> <li><code>playertargetentity</code> animstate restored to its value before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#move-1-horn-slash","title":"Move 1 - Horn slash","text":"<p>A single target horn slash</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.5, 0.0, -0.1) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 103</li> <li><code>Charge3</code> sound plays using <code>sounds[9]</code> with 1.2 pitch</li> <li>ShakeSprite called with intensity (0.25, 0.0, 0.0) and 45.0 frametimer</li> <li>Yield for 0.75 seconds</li> <li><code>sounds[9]</code> stopped</li> <li>animstate set to 104</li> <li><code>HugeHit</code> sound plays</li> <li>ShakeScreen called with 0.2 ammount for 0.75 time with dontreset</li> <li>DoDamage 1 call happens</li> <li><code>playertargetentity</code>'s y <code>spin</code> set to 35.0</li> <li><code>playertargetentity</code> has Jump called on them with an h of 15.0</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until <code>playertargetentity</code> is <code>onground</code></li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#move-2-underground-strike","title":"Move 2 - Underground strike","text":"<p>A single target underground strike</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Dig</code> sound plays</li> <li>animstate set to 101</li> <li><code>digging</code> set to true</li> <li>Yield for 0.65 seconds</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position with 2.0 multiplier</li> <li><code>Digging</code> sound plays on loop using <code>sounds[9]</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Yield for 0.25 seconds</li> <li>ShakeScreen called with 0.1 ammount for 0.75 time with dontreset</li> <li><code>sounds[9]</code> stopped</li> <li>DoDamage 1 call happens</li> <li>SetDefaultCamera called</li> <li><code>digging</code> set to false</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>y <code>spin</code> set to 20.0</li> <li>animstate set to 119</li> <li><code>sprite</code> scale set to <code>startscale</code></li> <li><code>DigPop</code> sound plays</li> <li><code>DirtExplode</code> particles plays at <code>playertargetentity</code> position</li> <li>Over the course of 46.0 frames, this enemy moves to startp + Vector3.up via a BeizierCurve3 with a ymax of 0.0</li> <li>position set to startp</li> <li>animstate set to 13 (<code>BattleIdle</code>)</li> <li>SetAnimForce called</li> <li><code>spin</code> zeroed out</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#move-3-rock-throw","title":"Move 3 - Rock throw","text":"<p>A single target rock throw</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen null <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 28 (<code>TossItem</code>)</li> <li><code>Toss</code> sound plays</li> <li>A new sprite object is created rooted at this enemy postion + (0.5, 2.0, -0.1) using the <code>MightyPeeble</code> medal sprite</li> <li>Over the course of 48.0 frames (41.0 instead if hardmode is true), the <code>MightyPeeble</code> sprite moves to <code>playertargetentity</code> position + (0.0, 2.0, -0.1) via a BeizierCurve3 with a ymax of 3.5. Before each frame yield, <code>MightyPeeble</code>'s z angle increses by 15.0 * framestep</li> <li>DoDamage 1 call happens</li> <li><code>MightyPeeble</code> object is destroyed</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#move-4-dash-attack","title":"Move 4 - Dash attack","text":"<p>A party wide dash attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 3 Flip<sup>1</sup> <code>commandsuccess</code> 0.0 Vector3.zero false null <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Beetle/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> is set to a new BeetleDash coroutine with the following parameters (<code>checkingdead</code> is set to null when completed):<ul> <li>enemyid: This enemy</li> <li>damage: 3</li> <li>animprepare: 116</li> <li>animdash: 117</li> <li>startp: startp</li> <li>speed: 33 (25 instead if hardmode is true)</li> </ul> </li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the coroutine effectively ends up doing:</p> <ul> <li><code>playertargetID</code> set to -1</li> <li>Camera moves slightly to the left</li> <li>MoveTowards (-0.5, 0.0, 0.0) at 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Charge3</code> sound plays using <code>sounds[9]</code> with 1.2 pitch</li> <li>animstate set to 116</li> <li>ShakeSprite called with (0.25, 0.0, 0.0) intensity and 60.0 frametimer</li> <li>Over the course of 41.0 frames, this enemy moves 2.0 to the left via a lerp</li> <li>ShakeSprite called with 0.1 intensity and 40.0 frametimer</li> <li>Yield for 41.0 frames counted by framestep</li> <li><code>sounds[9]</code> stopped</li> <li>animstate set to 117</li> <li><code>trail</code> set to true</li> <li><code>FastWoosh</code> sound plays</li> <li>Over the course of 34 frames (26 frames instead if hardmode is true), this enemy moves to (-15.0, 0.0, 0.0) via a lerp. On the first frame that the x position is less than -4.5, the following happens only once:<ul> <li>ShakeScreen called with an ammount of (0.25, 0.0, 0.0) for 0.65 time with dontreset</li> <li><code>HugeHit</code> sound plays</li> <li>PartyDamage 1 call happens</li> </ul> </li> <li>position set to (15.0, 0.0, 0.0)</li> <li><code>trail</code> set to false</li> <li>SetDefaultCamera called</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 61.0 frames, this enemy moves to startp via a lerp while having its animstate set to 1 (<code>Walk</code>)</li> <li><code>checkingdead</code> set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/","title":"<code>Bloatshroom</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the numbing mist move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the numbing mist move when summoning a Mushroom, the summoned enemy will be able to act on the current main turn right after this enemy actor turn is over</li> <li>The move selection odds changes to slightly favor the numbing mist move</li> <li>In the jump attack move, the amount of frames this enemy takes to reach its target changes to 38.25 frames from 51.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A party wide numbing mist that may either summon a Mushroom or targets other enemy party members except ones from the fungi family who are healed instead </li> <li>A single target jump attack</li> </ol> <p>The decision of which move to use is based on odds, but the odds changes based on hardmode being true or not. The following table shows the odds in either situations:</p> Move Odds when hardmode is false Odds when hardmode is true 1 30% 40% 2 70% 60%"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#move-1-numbing-mist","title":"Move 1 - Numbing mist","text":"<p>A party wide numbing mist that may either summon a Mushroom or targets other enemy party members except ones from the fungi family who are healed instead.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#partydamage-calls","title":"PartyDamage calls","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 1 Numb true only if <code>barfill</code> is at least 90.0 after DoCommand 1 (meaning the bar was filled at least 90% of the way), false otherwise 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Only happens if this enemy isn't the only <code>enemydata</code> left at the start of the action and it happens for each enemy party member other than this enemy whose kind isn't from the following list:<ul><li>CordycepsAnt</li><li>Mushroom</li><li>Zombee</li><li>Zombeetle</li><li>Bloatshroom</li><li>Zommoth</li></ul> null The enemy party member 1 (this cannot be lethal to the target as enforced after the call) Numb null false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If this enemy is the last <code>enemydata</code> left:<ul> <li>MoveTowards (3.5, 0.0, 0.0) with a multiplier of 2.0</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>startp is set to this enemy position with the y component at 0.0</li> </ul> </li> <li><code>Jump</code> sound plays with 0.8 pitch</li> <li>Jump called on this enemy with an h of <code>jumpheight</code> * 1.25</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until this enemy is <code>onground</code></li> <li>animstate set to 5 (<code>Angry</code>)</li> <li><code>rotater</code> gets a SpriteBounce added with a <code>startscale</code> of true and a MessageBounce with a 2.0 multiplier</li> <li><code>Mist</code> sound plays</li> <li><code>Spores</code> particles plays at this enemy position + 1.0 in y with -1.0 time (infinite)</li> <li>CreateHelpBox called with 4 (the TappingKey command's help)</li> <li>DoCommand 1 call happens</li> <li>All player party member who isn't stopped has their y <code>spin</code> set to 15.0 and their animstate to 11 (<code>Hurt</code>)</li> <li>Yield all frames until <code>doingaction</code> is false (DoCommand 1 is done), Before each frame yield, <code>flip</code> is set to false</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>The <code>Spores</code> particles is moved offscreen at -9999.0 in y then destroyed in 10.0 seconds</li> <li>All player party members has their <code>spin</code> zeroed out</li> <li>PartyDamage 1 call happens</li> <li>The SpriteBounce of the <code>rotater</code> gets destroyed</li> <li><code>rotater</code>'s scale gets set to the value it had before this action</li> <li>If this enemy is the last <code>enemydata</code>:<ul> <li><code>checkingdead</code> is set to a new SummonEnemy call to summon a Mushroom with type <code>FromGroundKeepScale</code> at (3.5, either 3.0 or -3.0 determined with uniform RNG, 0.0) and with cantmove (without cantmove instead if hardmode is true meaning the enemy will only be able to act on the current main turn if hardmode is true)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> </li> <li>Otherwise (there were already other enemy party members than this enemy), <ul> <li>For each enemy party members other than this enemy:<ul> <li>If they are a CordycepsAnt, Mushroom, Zombee, Zombeetle, Bloatshroom or Zommoth, Heal is called on them to heal an <code>hp</code> amount of their <code>maxhp</code> * 0.2 ceiled then clamped from 0 to 5</li> <li>Otherwise (the enemy party member isn't a fungi), DoDamage 1 call happens on them</li> <li>If the enemy party member's <code>hp</code> is 1 or below, it is set to 1 (this prevents DoDamage 1 from being lethal to them)</li> </ul> </li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#move-2-jump-attack","title":"Move 2 - Jump attack","text":"<p>A single target jump attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Flip<sup>1</sup> {BlockSoundOnly} <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Bloatshroom/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> is set to a new HeavyJump coroutine for this enemy with 3 damage and 60.0 speed (45.0 if hardmode is true)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> <p>Here is what the coroutine effectively ends up doing:</p> <ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (3.0, 0.0, -0.1)</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped (this won't do anything since no sounds should be playing there)</li> <li>Yield for 0.3 seconds</li> <li><code>Jump</code> sound plays with 0.8 pitch</li> <li><code>Turn</code> sound plays with 0.7 pitch</li> <li>Over the course of 51.0 frames (38.25 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position -0.1 in z via a BeizierCurve3 with a ymax of 5.5 scaled over the course of 60.0 frames (45.0 frames instead if hardmode is true). Before each frame yield, animstate is set to 2 (<code>Jump</code>) until halfway 30.0 frames passed (27.5 frames instead if harmode is true) where it's set to 3 (<code>Fall</code>) instead</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE), ShakeScreen is called with ammount (0.075, 0.3, 0.0) and 0.75 time with dontreset</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE):<ul> <li>Over the course of 9.0 frames (16.75 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position -0.1 in z via a BeizierCurve3 with a ymax of 5.5. Before each frame yield, animstate is set to 3 (<code>Fall</code>)</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li><code>Thud4</code> sound plays</li> <li><code>HugeHit3</code> soud plays</li> </ul> </li> <li>Otherwise (blocked, ignores FRAMEONE):<ul> <li>Over the course of 41.0 frames, this enemy moves to <code>playertargetentity</code> position + (2.0, 0.0, -0.1) via a BeizierCurve3 with a ymax of 3.0. Before each frame yield, animstate is set to 3 (<code>Fall</code>)</li> <li><code>Thud4</code> sound plays</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li>ShakeScreen is called with ammount (0.05, 0.2, 0.0) and 0.5 time with dontreset</li> <li>animstate set to 0 (<code>Idle</code>)</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to null informing the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/","title":"<code>Burglar</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true has the following changes:</p> <ul> <li>The enemy summoning moves that doesn't change the <code>hp</code> and <code>exp</code> has the usage odds changed when usable to 60% from 40%</li> <li>The enemy summoning moves that halves the <code>hp</code> and <code>exp</code> has the usage odds changed when usable to 45% from 35%</li> <li>In the rock throw move, the amount of frames the rock takes to reach its target changes to 35.0 from 50.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A party wide dash attack that may steal an item</li> <li>A single target rock throw</li> <li>Summons a Bandit or Thief enemy without changes to their <code>hp</code>, <code>maxhp</code> and <code>exp</code></li> <li>Summons a Bandit or Thief enemy with half <code>hp</code>, <code>maxhp</code> and <code>exp</code> floored</li> <li>Flees the battle</li> </ol> <p>Move 5 is always used is <code>holditem</code> is above -1 meaning this enemy is holding a stolen item. It is the only way to have move 5 used.</p> <p>Move 1, through 4 have a complex decision process that goes like this:</p> <ul> <li>If a 4/10 RNG check passes:<ul> <li>If this is the last enemy party member left and a 35% RNG check passes (45% instead if hardmode is true)<ul> <li>Move 4 is used</li> </ul> </li> <li>Otherwise:<ul> <li>Move 1 is used</li> </ul> </li> </ul> </li> <li>Otherwise (6/10 odds to fail the RNG check):<ul> <li>If this is the last enemy party member left and a 40% RNG check passes (60% instead if hardmode is true)<ul> <li>Move 3 is used</li> </ul> </li> <li>Otherwise:<ul> <li>Move 2 is used</li> </ul> </li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#move-1-dash-attack","title":"Move 1 - Dash attack","text":"<p>A party wide dash attack that may steal an item.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen for each player party member whose <code>hp</code> is above 0 This enemy The player party member 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#logic-sequence","title":"Logic sequence","text":"<ul> <li>MoveTowards (0.0, 0.0, 0.0) with 2.0 multiplier</li> <li>Camera moves to look near (-2.25, 0.0, 0.0)</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Charge10</code> sound plays</li> <li><code>Scuttle2</code> sound plays on loop with 1.05 pitch</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Yield for 0.25 seconds</li> <li><code>Gleam</code> particles plays with <code>Gleam</code> sound at this enemy + (0.0, 1.75 + <code>height</code>, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li><code>Scuttle2</code> sound stops playing</li> <li><code>trail</code> set to true</li> <li><code>FastWoosh</code> sound plays with 1.1 pitch</li> <li>Over the course of 20.0 frames, this enemy moves to (-15.0, 0.0, 0.0) via a lerp. On the first frame that their x position gets lower than -4.0:<ul> <li>For each player party members whose <code>hp</code> is above 0:<ul> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE), the player party member has SlowSpinStop with 30.0 in y as spinammount for 60.0 framtime called followed by Jump called on them</li> </ul> </li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE) and none of the affected player party members had the Shield condition, StealItem is called for this enemy without always</li> <li>If an item was stolen just now, the local startstate is set to 4 (<code>ItemGet</code>)</li> </ul> </li> <li>SetDefaultCamera called</li> <li><code>trail</code> set to false</li> <li>position set to (15.0, 0.0, 0.0)</li> <li>MoveTowards startp with 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 0 (<code>Idle</code>) as stopstate (however, if an item was stolen just now, 27 (<code>ItemWalk</code>) is used as the walkstate and 4 (<code>ItemGet</code>) as the stopstate instead)</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#move-2-rock-throw","title":"Move 2 - Rock throw","text":"<p>A single target rock throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Jump called on this enemy</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>A new sprite object is created childed to this enemy using the <code>MightyPeeble</code> medal sprite positioned at this enemy's <code>itemoffset</code></li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until this enemy is <code>onground</code></li> <li>animstate set to 28 (<code>TossItem</code>)</li> <li>Yield for 0.5 seconds</li> <li><code>Toss</code> sound plays</li> <li><code>Fall</code> sound plays</li> <li>The <code>MightyPeeble</code> sprite gets rooted</li> <li>Over the course of 50.0 frames (35.0 frames instead if hardmode is true), the <code>MightyPeeble</code> sprite moves to <code>playertargetentity</code> position + (0.0, 1.5, -0.2) via a BeizierCurve with a ymax of 6.0. Before each yield, the sprite Rotate in z by -20.0x the game's frametime</li> <li>The <code>MightyPeeble</code> sprite gets destroyed</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#move-3-enemy-summon-no-changes-to-hp-maxhp-and-exp","title":"Move 3 - Enemy summon (no changes to <code>hp</code>, <code>maxhp</code> and <code>exp</code>)","text":"<p>Summons a Bandit or Thief enemy party member without changes to the <code>hp</code>, <code>maxhp</code> and <code>exp</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>Camera moves to look near this enemy</li> <li>animstate set to 150</li> <li>Yield for 0.25 seconds</li> <li><code>Whistle</code> sound plays</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a Bandit or Thief (determined randomly with uniform probabilities) with type <code>Offscreen</code> at this enemy + (-2.5, 0.0, -0.2) without cantmove (meaning the enemy will be able to act immediately in the current main turn)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#move-4-enemy-summon-half-hp-maxhp-and-exp-floored","title":"Move 4 - Enemy summon (half <code>hp</code>, <code>maxhp</code> and <code>exp</code> floored)","text":"<p>Summons a Bandit or Thief enemy party member with half <code>hp</code>, <code>maxhp</code> and <code>exp</code> floored. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>Camera moves to look near this enemy</li> <li>animstate set to 150</li> <li>Yield for 0.25 seconds</li> <li><code>Whistle</code> sound plays</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a Bandit or Thief (determined randomly with uniform probabilities) with type <code>Offscreen</code> at this enemy + (-2.5, 0.0, -0.2) without cantmove (meaning the enemy will be able to act immediately in the current main turn)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>The new enemy has their <code>hp</code>, <code>maxhp</code> and <code>exp</code> divided by 2 floored</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#move-5-flee","title":"Move 5 - Flee","text":"<p>Flees the battle, no damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Burglar/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li><code>tryenemyheal</code> set to a new EnemyFlee coroutine with walkstate 27 (<code>ItemWalk</code>) with afterimage on this enemy</li> <li>Yield all frames until <code>tryenemyheal</code> goes to null (the coroutine completed)</li> <li>The local fled is set to true indicating a different post action will be done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/","title":"<code>Cactus</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the spike throw move, the amount of frames the spike takes to reach its target changes to 25.0 frames from 30.0 frames</li> <li>In the spin attack move, the amount of frames this enemy moves to reach its target on the first hit changes to 30.0 frames from 50.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target spike throw</li> <li>A single target spin attack that hits twice</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 50% 2 50%"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#move-1-spike-throw","title":"Move 1 - Spike throw","text":"<p>A single target spike throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near this enemy, but zoomed in</li> <li><code>Charge7</code> sound plays</li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li>ShakeSprite called for (0.1, 0.1, 0.1) intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 104</li> <li>TempSpin called for (0.0, 20.0, 0.0) for 0.5 time</li> <li>Jump called on this enemy</li> <li>4 SpriteRenderers are created to be new sprite object using the instance.<code>projectilepsrites[8]</code> sprite (a small spike) near the startp with z angles being 0.0, -45.0, -45.0 and -90.0 (meaning only 3 are visible, but one is vertically aligned with the player party) Each have their normalized left vector stored in a local array which represents their heading direction (which is in a straight line away from the enemy)</li> <li>Camera moves to look near the <code>playertargetentity</code></li> <li><code>PingShot</code> sound plays</li> <li>Over the course of 30.0 frames (25.0 if hardmode is true), all 4 spike projectiles moves away from the enemy in their heading direction towards the distance between startp and <code>playertargetentity</code>. The first one however specifically goes towards the <code>playertargetentity</code> position + 1.0 in y. Before each frame yield, the z angle of the projectly increased by 5 * the game's frametime</li> <li>DoDamage 1 call happens</li> <li>All spike objects are destroyed</li> <li>Yield all frames until <code>onground</code> goes to true</li> <li>animstate set to 105</li> <li>Yield for 0.8 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#move-2-spin-attack","title":"Move 2 - Spin attack","text":"<p>A single target spin attack that hits twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 2 times This enemy <code>playertargetID</code> after GetSingleTarget (same target for each calls) 1 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cactus/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code>, but zoomed in</li> <li>MoveTowards <code>playerdata[playertargetID]</code> + 3.5 in x with 2.0 multiplier using the current animstate for start and stop</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Charge7</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li><code>Woosh5</code> sound plays on loop with pitch 1.05</li> <li>animstate set to 103</li> <li>y <code>spin</code> set to 30.0</li> <li>Yield for 0.5 seconds</li> <li>Over the course of 50.0 frames (30.0 if hardmode is true), position changes to <code>playertargetentity</code> position + (1.0, 0.0, -0.2) via a lerp</li> <li>Done 3 times:<ul> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>Over the course of 30.0 frames, position changes to <code>playertargetentity</code> position + 3.0 in x via a lerp</li> <li><code>Woosh5</code> sound stopped</li> <li><code>spin</code> zeroed out</li> <li>Jump called on this enemy</li> <li>animstate set to 105</li> <li>Yield for 0.8 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/","title":"<code>Cape</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#startbattle-special-logic-involing-exp","title":"StartBattle special logic involing <code>exp</code>","text":"<p>After this enemy is loaded in StartBattle, if all of the following is true, the <code>exp</code> is incremented by the floored result of a lerp from 10.0 to 3.0 with a factor of instance.<code>partylevel</code> / 27.0:</p> <ul> <li>battleentity.<code>forcefire</code> is true or we are in the <code>GiantLair</code> area except for the <code>GiantLairFridgeInside</code> map</li> <li>instance.<code>partylevel</code> is less than 27 (meaning it's not maxed)</li> <li>flags 613 is false (RUIGEE is inactive)</li> </ul> <p>For more information, consult the exp logic documentation.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#fire-damage-infliction-logic-in-calculatebasedamage","title":"Fire damage infliction logic in CalculateBaseDamage","text":"<p>This enemy has a 50% chance to be on fire on a <code>Fire</code> property attack if the current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code>. It cannot be on fire otherwise.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#getenemyportrait-logic","title":"GetEnemyPortrait logic","text":"<p>If flag 664 is true (approached the oven during Chapter 7), the portrait sprite index field of this enemy is ignored and 225 is returned instead which includes the fire variant of this enemy in the portrait.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the cloth wrap move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the cloth wrap move, the damageammount of each DoDamage calls is decreased by 1</li> <li>In the freezing wind move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A party wide aerial strike</li> <li>A single target cloth wrap that continuously drains <code>hp</code></li> <li>A party wide freezing wind attack</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 2/5 2 2/5 3 1/5 <p>However, if move 3 is selected and either of the following is true, a continue directive is issued to the action loop which effectively rerolls the move selection:</p> <ul> <li><code>forcefire</code> is true</li> <li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#move-1-aerial-strike","title":"Move 1 - Aerial strike","text":"<p>A party wide aerial strike.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Happens if at least one of the following is true:<ul><li><code>forcefire</code> is true</li><li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li></ul> This enemy 3 Fire <code>commandsuccess</code> 0.0 Vector3.zero false null 2 Happens if DoDamage 1 didn't This enemy 2 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#logic-sequence","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li><code>Toss7</code> sound plays</li> <li>Over the course of 61.0 frames, this enemy moves to its position + (2.0, 1.5, -0.1) via a SmoothLerp</li> <li><code>Spin3</code> sound plays on loop</li> <li>animstate set to 104</li> <li>y <code>spin</code> set to 20.0</li> <li>Over the course of 41.0 frames this enemy moves to (-8.0, 1.0, 0.0) via a BeizierCurve3 with a ymax of -1.0. On the first frame that this enemy x position becomes lower than -4.5, PartyDamage 1 or 2 happens depending on which one has its conditions fufilled</li> <li>Yield for 0.5 seconds</li> <li><code>Spin3</code> sound stopped</li> <li><code>spin</code> zeroed out</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Over the course of 41.0 frames, this enemy moves to startp via a SmoothLerp</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#move-2-cloth-wrap","title":"Move 2 - Cloth wrap","text":"<p>A single target cloth wrap that continuously drains <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None -1.0 (infinite) TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Called once if <code>barfill</code> is less than 1.0 (not full) during DoCommand 1 once 0.5 seconds passed and then continously called again every 1.25 seconds until either <code>barfill</code> reaches 1.0 (checked 0.75 seconds after each call) or that <code>playerdata[playertargetID]</code>'s <code>hp</code> becomes 0 This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) 1 (0 instead if hardmode is true<sup>1</sup>). 1 is added to this if at least one of the following is true:<ul><li><code>forcefire</code> is true</li><li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li></ul> Atleast1pierce<sup>2</sup> null false <p>1: This doesn't mean the call won't deal any damage because not only <code>Atleast1pierce</code> guarantees 1 damage is dealt, but also because it is meant to function with <code>hardatk</code> in mind which takes effect when hardmode is true 2: Enemy piercing damages are disabled, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>bobrange</code> and <code>bobspeed</code> set to 0.0</li> <li>Camera moves to look neat <code>playertargetentity</code></li> <li>animstate set to 1 (<code>Walk</code>)</li> <li><code>ClothAttack</code> sound plays</li> <li>Over the course of 61.0 frames, this enemy moves to <code>playertargetentity</code> position + (2.0, 1.5, -0.1) via a SmoothLerp</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li>animstate set to 105</li> <li><code>Woosh3</code> sound plays</li> <li>Over the course of 11.0 frames, this enemy moves to <code>playertargetentity</code> position - 0.1 in z via a lerp</li> <li>animstate set to 103</li> <li>DoCommand 1 call happens</li> <li><code>infinitecommande</code> set to true which will prevent DoCommand 1 to end when MainManager.<code>mashcommandalt</code> is true until the action command is succeeded (it doesn't matter that this is set after the call because it will yield a frame in this case before reading the value)</li> <li>CreateHelpBox called with 4 (the TappingKey command's help)</li> <li>This enemy positon is set to <code>playertargetentity</code> + (0.0, 0.0 - <code>height</code>, -0.1)</li> <li>As long as <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0 and <code>actionroutine</code> isn't null (meaning DoCommand 1 hasn't ended yet):<ul> <li>Yield for 0.5 seconds</li> <li>If <code>barfill</code> is less than 1.0 (it isn't full yet):<ul> <li>DoDamage 1 call happens</li> <li>If <code>lastdamage</code> is above 0, Heal is called to heal this enemy by <code>lastdamage</code> amount of <code>hp</code></li> </ul> </li> <li>Yield for 0.75 seconds</li> </ul> </li> <li><code>Barfill</code> sound stops</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>If <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0, their animstate is set to the value they had before this action</li> <li>FinishAction is called manually to end DoCommand 1 if it wasn't already (but it should be by then)</li> <li><code>bobrange</code> and <code>bobspeed</code> restored to their value before this action</li> <li>animstate set to 102</li> <li>Over the course of 61.0 frames, this enemy moves to <code>playertargetentity</code> position + (2.0, 1.5, -0.1) via a SmoothLerp</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.25 seconds</li> <li>SetDefaultCamera called</li> <li>Over the course of 61.0 frames, this enemy moves to startp via a SmoothLerp</li> <li>UpdateAnim called</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#move-3-freezing-wind","title":"Move 3 - Freezing wind","text":"<p>A party wide freezing wind attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#docommand-calls_1","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#partydamage_1","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 2 Freeze true if <code>barfill</code> is 1.0 or above after DoCommand 1 (meaning the bar got filled)<sup>1</sup>, false otherwise 0.0 Vector3.zero false null <p>1: Not only the super block timing is affected by the block timing issue, <code>blockcooldown</code> is set to 0.0 before DoCommand 1 which removes all super block frames leading to the DoCommand 1 call. This only leaves the frame of the PartyDamage 1 call meaning in order to super block this, the player must press on the exact frame the PartyDamage call happens. It is a frame perfect window.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cape/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 61.0 frames, this enemy moves to (1.0, 0.5, 0.0) via a SmoothLerp</li> <li><code>checkingdead</code> set to a new WingAttack coroutine</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>SetDefaultCamera called</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Over the course of 61.0 frames, this enemy moves to startp via a SmoothLerp</li> </ul> <p>Here is what the WingAttack coroutine effectively ends up doing:</p> <ul> <li><code>blockcooldown</code> is set to 0.0 (it effectively cancels any blocking leading to DoCommand 1 which leaves only the 1 frame that PartyDamage 1 is called as the super block timing)</li> <li>Camera moves to look near <code>partypos[0]</code> (the player party member in front)</li> <li>animstate set to 102</li> <li><code>Woosh</code> sound plays on loop using <code>sounds[8]</code> with 0.5 pitch and 0.7 volume</li> <li><code>Prefabs/Particles/CapeSmoke</code> GameObject instantiated rooted at (-4.0, 0.0, 0.0)</li> <li>DoCommand 1 call happens</li> <li>As long as DoCommand 1 is still ongoing and that it's been at least 80.0 frames, this is what happens on each frame:<ul> <li>For each player party members with an <code>hp</code> above 0, their y <code>spin</code> is set to (the frame index starting at 0.0 / 40.0 clamped from 0.0 to 1.0) * 20.0</li> <li><code>sounds[8]</code>'s pitch is set to the frame index starting at 0.0 / 80.0 clamped from 0.4 to 1.0</li> </ul> </li> <li><code>Prefabs/Particles/CapeSmoke</code> is moved offscreen at -9999.0 in y then destroyed in 1.0 seconds</li> <li>All player party members has their <code>spin</code> zeroed out</li> <li>PartyDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to null which informs the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/","title":"<code>Carmina</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#extrastuff-usage","title":"<code>extrastuff</code> usage","text":"<ul> <li><code>extrastuff[0]</code>: The <code>Wheel</code> transform used in the pre move logic which is the return of Create6Wheel</li> <li><code>extrastuff[1]</code>: The first child of <code>extrastuff[0]</code> which is an arrow that points to an element on the wheel used in the pre logic</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the pre move logic on effect number 2 (AttackUp infliction on this enemy), the amount of main turns to inflict the condition is 3 instead of 2</li> <li>In the pre move logic on effect number 3 (DefenseUp infliction on this enemy), the amount of main turns to inflict the condition is 3 instead of 2</li> <li>In the pre move logic on effect number 7 (Poison infliction on the player party), the amount of main turns to inflict the condition is 3 instead of 2 for each player party members (assuming they do not have the <code>EternalPoison</code> medal equipped where the main turn count is always 99999 which is infinite)</li> <li>In the pre move logic on effect number 10 (DefenseDown infliction on the player party), the amount of main turns to inflict the condition is 3 instead of 2 for each player party members</li> <li>In the pre move logic on effect number 11 (AttackDown infliction on the player party), the amount of main turns to inflict the condition is 3 instead of 2 for each player party members</li> <li>In the cards throw move, the amount of cards to throw is random between 2 to 3 inclusive rather than always being 2.</li> <li>In the cards throw move, the speed of each Projectile calls changes to 22.0 from 29.0</li> <li>In the heart projectile throw move, the heart takes 60.0 frames to reach its target instead of 80.0 frames</li> <li>In the dice block hit move, the dice takes 11.0 frames to reach its target instead of 16.0 frames. NOTE: This effectively doesn't do anything in regards to blocking because the DoDamage call receives false as the block parameter meaning the move is unblockable</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target multiple cards throw</li> <li>A single target heart projectile throw that also inflict DefenseDown</li> <li>A single target dice block hit</li> </ol> <p>The move usage is decided by the following odds:</p> Move Odds 1 3/7 2 2/7 3 2/7"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#pre-move-logic","title":"Pre move logic","text":"<p>There's a bunch of logic related to a random effect selection that appears on a wheel which always occur at the start of the actor turn. It's in 3 parts done in order: the wheel effect generation and setup, the application of the effect and the dimissal of the wheel.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#wheel-effect-generation-and-setup","title":"Wheel effect generation and setup","text":"<ul> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>An array containing the numbers from 0 to 14 is created and then shuffled. The first 6 elements after the shuffle will appear on the wheel and thus are considered to be selected among the effects</li> <li>If <code>extrastuff</code> isn't null, <code>extrastuff[0]</code> (the wheel) is destroyed (this includes <code>extrastuff[1]</code> since it's childed to it)</li> <li><code>extrastuff</code> is initialised to be 2 new Transform</li> <li><code>extrastuff[0]</code> is initialised to the return of Create6Wheel which is a GameObject named <code>Wheel</code> representing the wheel with all elements background colors to be pure yellow with a scale of 0.35x. As for the sprites used, it depends on the first 6 elements of the shuffled effects array where it's its matching <code>guisprites</code> index that shows what the effect will do. The whole Transform is then childed to <code>battlemap</code>, scaled to 2.5x and local position set to (0.0, 25.0, 3.0)</li> <li><code>extrastuff[1]</code> is set to the first child of <code>extrastuff[0]</code> which is the wheel's arrow pointer</li> <li>The effect to use among the 6 is generated via RNG between 0 and 5 inclusive and the corresponding element at that index will be the effect number. This means the effect is predetermined before the wheel is shown</li> <li><code>extrastuff[0]</code> moves to (0.0, 4.0, 3.0) via MainManager.MoveTowards with 30.0 frametime with smooth and without local</li> <li><code>CarminaWheel1</code> sound plays</li> <li>Over the course of 151.0 frames, <code>extrastuff[1]</code> z angle changes from (the effect index * 60.0 + 1500.0) to the effect index * 60.0 via a SmoothStep. Effectively, the pointer of the wheel will seemingly spin randomly, but the destination angle is already predetermined from the effect so the pointer moves according to its predetermined target element on the wheel</li> <li><code>CarminaWheel2</code> sound plays</li> <li>Done 8 times:<ul> <li>The enablement of the sprite of the selected effect element on the wheel is toggled</li> <li>Yield for 0.1 seconds</li> </ul> </li> <li>The sprite of the selected effect element on the wheel is enabled</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#wheel-effect-application","title":"Wheel effect application","text":"<p>Depending on the effect number generated, the corresponding effect is applied among 15 possibilities:</p> <ul> <li>0: Heal is called on each player party members whose <code>hp</code> is above 0 has to heal 3 of their <code>hp</code></li> <li>1: Heal is called on this enemy to heal 5 of their <code>hp</code></li> <li>2: StatusEffect called to inflict the AttackUp condition on this enemy with effect for 2 main turns including the current one (3 main turns instead if hardmode is true)</li> <li>3: StatusEffect called to inflict the DefenseUp condition on this enemy with effect for 2 main turns (3 main turns instead if hardmode is true). The main turn count is effectively 1 (2 instead if hardmode is true) because the current main turn advances soon after this action</li> <li>4: If <code>playerdata[partypointer[0]]</code> (the player party member in front)'s <code>hp</code> is 1 or below, <code>AtkFail</code> sound plays, otherwise:<ul> <li>DoDamage called to inflict an unblockable 5 damage to <code>playerdata[partypointer[0]]</code> without an attacker, property or any overrides</li> <li>If their <code>hp</code> became 0 or lower, it is set to 1 meaning this DoDamage call can't be lethal to them</li> </ul> </li> <li>5:<ul> <li>DoDamage called to inflict an unblockable 3 damage to this enemy without an attacker, property or any overrides</li> <li>If their <code>hp</code> became 0 or lower, it is set to 1 meaning this DoDamage call can't be lethal to them</li> </ul> </li> <li>6:<ul> <li>This enemy animstate is set to 11 (<code>Hurt</code>)</li> <li><code>poisoneffect</code> particles plays at this enemy position</li> <li><code>Poison</code> sound plays</li> <li>SetCondition called to inflict the Poison condition to this enemy for 3 main turns including the current one</li> </ul> </li> <li>7: <ul> <li>All player party members whose <code>hp</code> is above 0 and do not have the Sturdy condition has the folllowing happen on them:<ul> <li>animstate set to 11 (<code>Hurt</code>)</li> <li>StatusEffect called to inflict the Poison condition on the player party member with effect for 2 main turns including the current one (3 main turns instead if hardmode is true) or 99999 turns if they have the <code>EternalPoison</code> medal equipped. NOTE: This means that the <code>poisonres</code> check is off by one, check the method's documentation for details</li> <li><code>poisoneffect</code> particles plays at the player party member position</li> </ul> </li> <li><code>Poison</code> sound plays</li> </ul> </li> <li>8:<ul> <li>MainManager.events.MothivaSmoke particles created at this enemy position with half scale</li> <li><code>Sleep</code> sound plays</li> <li>The local startstate and this enemy animstate set to 14 (<code>Sleep</code>)</li> <li>SetCondition called to inflict the Sleep condition to this enemy for 3 main turns (The current one is normally excluded, but this effect effectively includes it by opting out of performing a move)</li> <li>The wheel is dismissed early as outlined in the section below, but no moves will be performed on this actor turn and this action is immeditately over which simulates the stopping effect of <code>Sleep</code></li> </ul> </li> <li>9: <ul> <li>All player party members whose <code>hp</code> is above 0 and do not have the Sturdy condition has the folllowing happen on them:<ul> <li>animstate set to 14 (<code>Sleep</code>)</li> <li>StatusEffect called to inflict the Sleep condition on the player party member with effect for 2 main turns (effectively 1 main turn since the current main turns ends soon after). NOTE: This means that the <code>sleepres</code> check is off by one, check the method's documentation for details</li> </ul> </li> <li><code>Ping</code> sound plays</li> <li><code>Sleep</code> sound plays</li> <li><code>impactsmoke</code> particles plays at <code>partymiddle</code></li> </ul> </li> <li>10: StatusEffect is called for each player party member whose <code>hp</code> is above 0 to inflict the DefenseDown condition on them with effect for 2 main turns including the current one (3 main turns instead if hardmode is true)</li> <li>11: StatusEffect is called for each player party member whose <code>hp</code> is above 0 to inflict the AttackDown condition on them with effect for 2 main turns including the current one (3 main turns instead if hardmode is true). The main turn count is effectively 1 (2 instead if hardmode is true) because the current main turn ends soon after this action</li> <li>12 and 13: For each player party members:<ul> <li>If the player party member <code>hp</code> is above 0 and they do not have the Sturdy condition:<ul> <li>StatusEffect called to inflict the Inked condition on the player party member with effect for 2 main turns (effectively 1 main turn since the current main turns ends soon after)</li> <li><code>InkGet</code> particles plays at the player party member position + 1.0 in y</li> </ul> </li> <li><code>WaterSplash2</code> sound plays with 0.7 pitch if it wasn't playing already</li> </ul> </li> <li>14:<ul> <li>This enemy's <code>cantmove</code> decrements which gives them another actor turn on this main turn (this includes this wheel logic since it's a completely new actor turn)</li> <li>StatEffect called on this enemy with type 5 (yellow up arrow)</li> <li><code>StatUp</code> sound plays</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#wheel-dismisal","title":"Wheel dismisal","text":"<ul> <li>Yield for 0.5 seconds</li> <li><code>extrastuff[0]</code> (the wheel) moves to (0.0, 25.0, 3.0) via MainManager.MoveTowards with smooth and without local</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#move-1-cards-throw","title":"Move 1 - Cards throw","text":"<p>A single target multiple cards throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times (random between 2 to 3 times instead if hardmode is true) 3 Random among the following:<ul><li>null</li><li>Sleep</li><li>Poison</li></ul> This enemy <code>playertargetID</code> after GetSingleTarger (target is the same for all calls) A new sprite object rooted with a SpriteRenderer using a <code>guisprite</code> sprite whose index depends on the property sent (90 for null which is a regular spy card, 116 for <code>Sleep</code> which is a mini boss spy card and 117 for <code>Poison</code> which is a boss spy card) positioned at this enemy + (-1.0, 1.5, -0.1) with a ShadowLite that is SetUp with 0.3 opacity and 0.5 size scaled at 0.2x and 90.0 z angle 29 (22 instead if hardmode is true) 0.0 null null null null (0.0, 0.0, -30.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look at the midpoint between this enemy and <code>playertargetentity</code></li> <li>A new SpriteRenderer is created to hold the cards projectile with the amount to throw which is 2 (random between 2 and 3 instead if hardmode is true)</li> <li>For each card to throw:<ul> <li>animstate set to 102</li> <li>Yield for 0.25 seconds</li> <li>Yield for 0.1 seconds</li> <li>The property of the attack is determined and it's random among null, <code>Sleep</code> and <code>Poison</code></li> <li><code>Toss</code> sound plays</li> <li>The card element is set to a new sprite object rooted with a SpriteRenderer using a <code>guisprite</code> sprite whose index depends on the property sent (90 for null which is a regular spy card, 116 for <code>Sleep</code> which is a mini boss spy card and 117 for <code>Poison</code> which is a boss spy card) positioned at this enemy + (-1.0, 1.5, -0.1) with a ShadowLite that is SetUp with 0.3 opacity and 0.5 size scaled at 0.2x and 90.0 z angle</li> <li>Projectile 1 call happens</li> <li>animstate set to 103</li> <li>Yield for 0.33 seconds</li> </ul> </li> <li>Yield all frames until all the card elements in the array are null (meaning all Projectile calls completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#move-2-heart-projectile-throw","title":"Move 2 - Heart projectile throw","text":"<p>A single target heart projectile throw that also inflict DefenseDown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Numb null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 104</li> <li>Yield for 0.25 seconds</li> <li>Yield for 0.1 seconds</li> <li><code>Kiss</code> sound plays</li> <li><code>Lazer3</code> sound plays</li> <li>A new sprite object is created rooted using the <code>Sprites/Particles/plainheart</code> sprite positioned offscreen at 999.0 in y with a color of E57F8C (light red) with a scale of 0.65x and a ShadowLite SetUp with 0.3 opacity and 0.6 size</li> <li>Yield for 0.3 seconds</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>Over the course of 80.0 frames (60.0 frames instead if hardmode is true), the <code>Sprites/Particles/plainheart</code> moves from this enemy position + (-1.0, 1.85, -0.1) to <code>playertargetentity</code> position + (0.0, 1.0, -0.1) via a lerp. Before each frame yield, the z angle is set to Sin(Time.time * 3.0) * 10.0</li> <li>Camera moves to look near the rooted MainCam object</li> <li><code>Sprites/Particles/plainheart</code> gets destroyed</li> <li>DoDamage 1 call happens</li> <li><code>StatDown</code> sound plays</li> <li>StatEffect called on <code>playertargetentity</code> with type 3 (blue down arrow)</li> <li>SetCondition called on <code>playertargetentity</code> to inflict DefenseDown for 3 main turns (2 main turns instead if <code>commandsuccess</code> is true which means the player blocked ignoring FRAMEONE). Effectively, it's 2 or 1 main turns since the current main turns ends soon after</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#move-3-dice-block-hit","title":"Move 3 - Dice block hit","text":"<p>A single target dice block hit.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen null <code>playerdata[playertargetID]</code> after GetSingleTarger Random between 1 and 6 inclusive NoExceptions null false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Carmina/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 105</li> <li>A random number is generated between 0 and 5 inclusive which will be the number shown of the dice block and the damageammount is obtained by adding 1 to this number</li> <li>A <code>Prefabs/Objects/carminadice</code> is created rooted positioned at <code>playertargetentity</code> position + (0.0, 3.5, 0.0) with random angles between (-360.0, -360.0, -360.0) and (360.0, 360.0, 360.0)</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>DeathSmoke particles plats at the <code>Prefabs/Objects/carminadice</code> position</li> <li><code>CarminaDice1</code> sound plays</li> <li>Over the course of 101.0 frames, the angles of <code>Prefabs/Objects/carminadice</code> changes from its current angles * 5.0 to one of 6 randomly chosen hardcoded values such that the number shown to the camera matches the number generated earlier + 1 via a SmoothLerp. The scale also changes from 0.25x to 0.75x via a lerp</li> <li><code>Prefabs/Objects/carminadice</code> moves +1.0 in y via a MainManager.MoveTowards with a frametime of 15.0 with smooth and without local</li> <li>Yield for 0.25 seconds</li> <li>The MainManager.MoveTowards call is stopped</li> <li>animstate set to 106</li> <li><code>CarminaDice2</code> sound plays</li> <li>Over the course of 16.0 frames (11.0 instead if hardmode is true), <code>Prefabs/Objects/carminadice</code> moves to <code>playertargetentity</code> position + 0.65 in y via a lerp</li> <li><code>explosionsmall</code> particles plays at the <code>Prefabs/Objects/carminadice</code> position</li> <li><code>Prefabs/Objects/carminadice</code> gets destroyed</li> <li>ShakeScreen called with 0.1 ammount, 0.65 time with dontreset</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/","title":"<code>Cenn</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy is fought alongside Pisci as they have several interactions together that would work unexpectedly if a fight is started without the presence of both enemy party members at once.</p> <p>It is also assumed that this enemy is loaded with their eventondeath set to the proper EventDialogue because it allows the first fight to end early in case this enemy dies before their HPPercent becomes lower than 0.5. On the second fight, the StartBattle logic will disable it.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>This enemy has special logic after being loaded in StartBattle:</p> <ul> <li>If flags 497 is true (after beating <code>Cenn</code> and Pisci the first time):<ul> <li><code>eventondeath</code> is set to -1 which disables their EventDialogue</li> </ul> </li> <li>Otherwise (the player is fighting them for the first time):<ul> <li>AlwaysSurvive is added to this enemy's weakness</li> </ul> </li> <li><code>battlepos</code> is increased by 1.0 in x</li> <li>position is set to the new <code>battlepos</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to heal Pisci by 4 <code>hp</code> when their HPPercen is lower than 0.75 in the pre move logic changes to 41% from 31%</li> <li>In the stick boomerang throw move, the amount of frames the stick takes to reach its target changes to 36.0 on the first movement and 46.0 frames on the second movement instead of being 44.0 frames on the first movement and 54.0 frames on the second movement</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target double hitting stick boomerang throw</li> <li>A single target stick slash attack</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 1/2 2 1/2"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before using a move. It's in 3 parts done in order: the first fight event logic, the infinite AttackUp condition logic and the healing Pisci logic.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#first-fight-event-logic","title":"First fight event logic","text":"<p>This part only happens if flags 497 is false meaning this is the first time to player fights <code>Cenn</code> and Pisci:</p> <ul> <li>If HPPercent of this enemy or Pisci is lower than 0.5 (if they are present):<ul> <li>EventDialogue 15 is triggered</li> </ul> </li> <li>Yield all frames until <code>inevent</code> is false (if the EventDialogue above was triggered, it effectively stalls DoAction entirely until the battle almost ends)</li> </ul> <p>NOTE: If the EventDialogue is triggered here, it won't prevent DoAction from running while ReturnToOverworld without flee is ongoing. This creates a problem because the EventDialogue runs a ReorganizeEnemies which clears <code>enemeydata</code> due to killing <code>Cenn</code> and Pisci and all this happens BEFORE DoAction gets to resume. Since DoAction can't operate on an empty <code>enemydata</code>, it will immediately throw an IndexOutOfRange excpetion. Fortunately, this throw is inconsequential because ReturnToOverworld is still ongoing and the battle would already be in a terminal flow by this point. Effectively, the battle will still end without consequences because DoAction can't race against this process anyway before it throws and gets destroyed due to the battle teardown process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#infinite-attackup-condition-logic","title":"Infinite AttackUp condition logic","text":"<p>This part only happens if Pisci is not present in the enemy party and that this enemy doesn't already have the AttackUp condition:</p> <ul> <li><code>Wam</code> sound plays</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote for 30 time</li> <li>Yield for 0.5 seconds</li> <li>StatusEffect called to inflict the AttackUp condition on this enemy for 999 main turns (effectively infinite) with effect</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#healing-pisci-logic","title":"Healing Pisci logic","text":"<p>This part happens if all of the following conditions are fufilled:</p> <ul> <li><code>Pisci</code> is present</li> <li><code>Pisci</code>'s HPPercent is less than 0.75</li> <li>A 31% RNG check passes (41% instead if hardmode is true)</li> </ul> <p>If all of the above are fufilled:</p> <ul> <li><code>Ping2</code> sound plays</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote for 30 time</li> <li>Yield for 0.5 seconds</li> <li>A new sprite object is created childed to the <code>battlemap</code> using the <code>CrunchyLeaf</code> item sprite positioned at this enemy position + its <code>cursoroffset</code> + (-0.4, -0.1, -0.1)</li> <li>animstate set to 4 (<code>Angry</code>)</li> <li><code>ItemHold</code> sound plays</li> <li>Yield for a second</li> <li>The item sprite gets destroyed</li> <li>animstate set to the local startstate</li> <li>Heal called to heal <code>Pisci</code> by 4 <code>hp</code></li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#move-1-stick-boomerang-throw","title":"Move 1 - Stick boomerang throw","text":"<p>A single target double hitting stick boomerang throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code> 2 Always happen This enemy Same target as DoDamage 1 1 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playerdata[playertargetID]</code></li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li><code>Woosh4</code> sound plays</li> <li>animstate set to 103</li> <li><code>Woosh</code> sound plays on loop using <code>sounds[9]</code> with 1.2 pitch</li> <li>A new sprite object is created childed to the <code>battlemap</code> using the <code>projectilepsrites[16]</code> sprite (a branch stick) positioned at this enemy position + (-0.35, 1.25, -0.1)</li> <li>Over the course of 44.0 frames (36.0 frames instead if hardmode is true), the stick moves to a SmoothLerp result via a lerp to its position where it changes to <code>playertargetentity</code> position + (-7.5, 1.25, -0.1) where the first half is a lerp and the second half is a SmoothStep of each of the vector's components. Before each frame yield, the stick's z angle is increased by 25.0x the game's frametime. On th first frame that the stick x position becomes lower than <code>playertargetentity</code> x position, DoDamage 1 call happens</li> <li>Over the course of 54.0 frames (46.0 frames instead if hardmode is true), the stick moves to a SmoothLerp result via a lerp to its position where it changes to this enemy position + (0.9, 1.25, -0.1) where the first half is a lerp and the second half is a SmoothStep of each of the vector's components. Before each frame yield, the stick's z angle is increased by 25.0x the game's frametime. On th first frame that the stick x position becomes higher than <code>playertargetentity</code> x position, DoDamage 2 call happens</li> <li><code>sounds[9]</code> is stopped</li> <li>The stick object is destroyed</li> <li>animstate set to 104</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#move-2-stick-slash-attack","title":"Move 2 - Stick slash attack","text":"<p>A single target stick slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Cenn/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Slash2</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 101</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/","title":"<code>Centipede</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy gets loaded with SurviveWith10 in their weakness as it is necessary for the low <code>hp</code> phase transition move to work.</p> <p>It is also assumed for the same reason that <code>Beetle</code> is present in the player party at <code>playerdata[1]</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 3 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: UNUSED</li> <li><code>data[1]</code>: A value set to 1 when gaining an AttackUp boost in the pre move logic and decremented (effectively set to 0) after using certain moves. This restricts the usage of the charging move where the move will not be used if this value is 1 and a reroll will occur instead. It prevents the charging move to be used on the same actor turn than gaining the <code>AttackUp</code> condition. However, it doesn't prevent the <code>charge</code> and <code>AttackUp</code> condition from stacking at the same time: when using another move than charge (which is guaranteed to happen), the value is set to 0 which makes the charging move usable on the next actor turn while the <code>AttackUp</code> condition hasn't expirred yet. Here are the moves where this value is set to 0 after their usage:<ul> <li>Draining bite attack</li> <li>Bite attack with Flip</li> <li>Poison breath attack</li> <li>Digging underground</li> </ul> </li> <li><code>data[2]</code>: A cooldown for having their position remain at <code>Underground</code>. When using the digging move, this is set to 3 and it gets decremented everytime the underground attack move is used. After this decrement, if the value reaches 0, this enemy will undig themselves setting their <code>position</code> to <code>Ground</code>. Effectively, it means this enemy can remain <code>Underground</code> for up to 3 actor turns in a row.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to gain an AttackUp condition in the pre move logic when this enemy didn't already have the condition and their HPPercent is 0.65 or lower changes to 6/10 from 5/10</li> <li>In the poison breath move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the digging underground move, <code>cantmove</code> now gets decremented at the end of the move usage which grants a free actor turn to this enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-selection","title":"Move selection","text":"<p>8 moves are possible:</p> <ol> <li>A single target bite attack that can drain <code>hp</code></li> <li>A single target bite attack with Flip</li> <li>A party wide poison breath attack</li> <li>Digs which sets their position to <code>Underground</code></li> <li>Prepares themselves to deliver a big attack by setting their <code>charge</code> to 3</li> <li>A party wide dash attack</li> <li>A single target underground attack that can drain <code>hp</code></li> <li>Initiate a low hp phase transition where the player party is killed except <code>Beetle</code></li> </ol> <p>Move 8 is always (and only) used when the following conditions are all fufilled:</p> <ul> <li><code>hp</code> is 10 or lower</li> <li>This enemy still has SurviveWith10 in their weakness (meaning this move wasn't used yet as it gets removed during the move's usage)</li> </ul> <p>Move 7 is always (and only) used if move 8 wasn't and position is <code>Underground</code>.</p> <p>Move 6 is always (and only) used when move 7 and 8 wasn't and <code>basestate</code> isn't 0 (<code>Idle</code>) which means move 5 wasn't used on the previous actor turn.</p> <p>Move 1 through 5 can only be used when move 6 through 8 wasn't. When this is the case, the decision of which move to use among them is based on odds, but they change if <code>locktri</code> is true which means move 8 was used previously. Here are the move usage odds in either situation:</p> Move Odds when <code>locktri</code> is false Odds when <code>locktri</code> is true 1 2/13 1/2 2 3/13 1/2 3 2/13 Never used 4 2/13 Never used 5 4/13 Never Used <p>However, move 5 has these additional requirements that must be fufilled for the move to be used after it is selected:</p> <ul> <li>HPPercent must be 0.6 or lower</li> <li><code>data[1]</code> must be 0 (meaning this enemy didn't get the AttackUp condition on the same actor turn in the pre move logic)</li> <li><code>cantmove</code> is 0 (meaning this enemy is doing the last actor turn they have available on this main turn)</li> </ul> <p>If these requirements aren't fufilled and the move is selected, a continue directive is issued on the enemy action loop which restarts the entire action and rerolls the move selection process until another move is selected without ending the actor turn.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic happens before the usage of every move except the following ones:</p> <ul> <li>Low <code>hp</code> phase transition</li> <li>Underground attack</li> <li>Party wide dash</li> </ul> <p>It is composed of 3 parts that happens in order.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#attackup-condition","title":"AttackUp condition","text":"<p>This part of the pre move only happens if all of the following are fufilled:</p> <ul> <li>HPPercent is 0.65 or lower</li> <li>This enemy doesn't already have the <code>AttackUp</code> condition</li> <li>A 5/10 RNG check passes (6/10 instead if hardmode is true)</li> </ul> <p>When the above are fufilled, this is what the logic does:</p> <ul> <li>animstate set to 105</li> <li><code>Roar2</code> sound plays</li> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li>Yield for 0.75 seconds</li> <li>SetCondition called to inflict the AttackUp condition on this enemy for 3 main turns</li> <li>StatEffect called on this enemy with type 0 (red up arrow)</li> <li><code>StatUp</code> sound plays</li> <li><code>basestate</code> set to 100</li> <li>Yield for 0.5 seconds</li> <li><code>data[1]</code> is set to 1 (will prevent the charging move to be used on this actor turn)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#moves-set-to-2-excluding-the-current-main-turn","title":"<code>moves</code> set to 2 excluding the current main turn","text":"<p>This part of the pre move only happens if all of the following are fufilled:</p> <ul> <li>HPPercent is 0.35 or lower</li> <li><code>moves</code> is 1 (meaning this logic hasn't happened yet)</li> </ul> <p>When the above are fufilled, this is what the logic does:</p> <ul> <li>If the AttackUp part of the pre move didn't happen:<ul> <li>animstate set to 105</li> <li><code>Roar2</code> sound plays</li> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li>Yield for 0.75 seconds</li> </ul> </li> <li><code>moves</code> is set to 2 which grants 2 actor turn per main turns (excluding the current main turn)</li> <li>StatEffect called on this enemy with type 5 (yellow up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#basestate-logic","title":"<code>basestate</code> logic","text":"<p>This part of the pre move always happen:</p> <ul> <li><code>basestate</code> set to 0 (<code>Idle</code>)</li> <li>The local startstate is set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-1-draining-bite-attack","title":"Move 1 - Draining bite attack","text":"<p>A single target bite attack that can drain <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Step</code> sound plays on loop using <code>sounds[9]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (3.5, 0.0, -0.15) with a 2.0 multiplier</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li><code>Bite3</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.6 seconds</li> <li>animstate set to 101</li> <li><code>Bite4</code> sound plays</li> <li>Yield for 0.05 seconds</li> <li>DoDamage 1 call happens</li> <li>If <code>lastdamage</code> is higher than 0, Heal called on this enemy to heal their <code>hp</code> by <code>lastdamage</code> / 2 floored clamped from 1 to <code>lastdamage</code></li> <li>Yield for 0.65 seconds</li> <li>If <code>data[1]</code> is higher than 0 (meaning the AttackUp condition was inflicted in the pre move logic), it is decremented (effectively set to 0)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-2-bite-attack-with-flip","title":"Move 2 - Bite attack with Flip","text":"<p>A single target bite attack with Flip.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Step</code> sound plays on loop using <code>sounds[9]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (4.5, 0.0, -0.15) with a 2.0 multiplier</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li><code>Bite3</code> sound plays</li> <li>animstate set to 102</li> <li>Yield for 0.6 seconds</li> <li>animstate set to 103</li> <li><code>Woosh6</code> sound plays</li> <li>Yield for 0.05 seconds</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.65 seconds</li> <li>If <code>data[1]</code> is higher than 0 (meaning the AttackUp condition was inflicted in the pre move logic), it is decremented (effectively set to 0)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-3-poison-breath","title":"Move 3 - Poison breath","text":"<p>A party wide poison breath attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen for each player party member whose <code>hp</code> is above 0 This enemy The player party member 2 Poison null true if <code>barfill</code> is 1.0 or above after DoCommand 1 (meaning the bar got filled), false otherwise"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>Clomp</code> sound plays with 0.7 pitch</li> <li>animstate set to 107</li> <li>Camera moves to look at this enemy, but zoomed in</li> <li>Yield for 0.85 seconds</li> <li>SetDefaultCamera called</li> <li>Camera moves to look near (-1.0, -0.5, 1.0)</li> <li>animstate set to 109</li> <li><code>Mist</code> sound plays</li> <li><code>poisonsmoke</code> particles plays near this enemy</li> <li>CreateHelpBox called with 4 (the <code>TappingKey</code> command's help)</li> <li>DoCommand 1 call happens</li> <li>All player party member whose <code>hp</code> is above 0 has their y <code>spin</code> set to 15.0</li> <li>Yield all frames until <code>doingaction</code> goes to false. Before each frame yield, all player party member whose <code>hp</code> is above 0 has their animstate set to 11 (<code>Hurt</code>) (but if <code>blockcooldown</code> is above 0 meaning a block was done, it's set to 24 (<code>Block</code>) instead)</li> <li>All player party member whose <code>hp</code> is above 0 has DoDamage 1 call happen on them followed by their <code>spin</code> getting zeroed out</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>Yield for 0.5 seconds</li> <li>If <code>data[1]</code> is higher than 0 (meaning the AttackUp condition was inflicted in the pre move logic), it is decremented (effectively set to 0)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-4-digs-underground","title":"Move 4 - Digs underground","text":"<p>Digs which sets their position to <code>Underground</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>animstate set to 110</li> <li>Yield for 0.5 seconds</li> <li><code>Dig2</code> sound plays with 0.75 pitch</li> <li><code>DirtFlying</code> particles plays at this enemy postion - 0.1 in x with a time of -1.0</li> <li>Yield for 0.35 seconds</li> <li>animstate set to 112</li> <li>A new sprite object is created rooted using the <code>Sprites/Entities/centipede</code> sprite at index 9 (a patch of dirt) positioned at this enemy + (-0.5, 0.0, -0.2) with a scale of (3.0, 2.0, 1.0)</li> <li>Over the course of 51.0 frames, this enemy moves from startp - 1.0 in x to starp + (-1.0, -6.0, 0.0) via a lerp</li> <li><code>DirtFlying</code> particles moved offscreen at 999.0 in y then destroyed in 2.0 seconds</li> <li><code>digging</code> set to true</li> <li><code>digscale</code> set to (3.0, 1.0, 1.0)</li> <li>Yield for 0.5 seconds</li> <li>The patch of dirt is set to MainManager.Shrink over the course of 31.0 frames followed by their destruction (this is done in paralell)</li> <li>Yield for 0.5 seconds</li> <li>Yield for a frame</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>position set to startp</li> <li><code>data[2]</code> set to 3 (this is the cooldown to remain <code>Underground</code>)</li> <li>position set to <code>Underground</code></li> <li>If hardmode is true, <code>cantmove</code> is decremented which gives another free actor turn to this enemy</li> <li>If <code>data[1]</code> is higher than 0 (meaning the AttackUp condition was inflicted in the pre move logic), it is decremented (effectively set to 0)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-5-charging","title":"Move 5 - Charging","text":"<p>Prepares themselves to deliver a big attack by setting their <code>charge</code> to 3. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>animstate set to 105</li> <li><code>Roar2</code> sound plays with 0.8 pitch</li> <li>ShakeScreen called with an ammount of 0.1 and time of 0.75</li> <li>Yield for 0.75 seconds</li> <li><code>charge</code> is set to 3</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>The local startstate and <code>basestate</code> set to 108 (this will allow the party wide dash attack move to be used on the next actor turn)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-6-party-wide-dash","title":"Move 6 - Party wide dash","text":"<p>A party wide dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 2 Flip<sup>1</sup> <code>commandsuccess</code> 20.0 (0.0, 30.0, 0.0) true null <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li>animstate set to 105</li> <li><code>Roar2</code> sound plays</li> <li>ShakeScreen called with 0.1 ammount and 0.75 time</li> <li>Yield for 0.8 seconds</li> <li>ShakeScreen called with 0.025 ammount and -1.0 time</li> <li><code>CentipedeCharge</code> sound plays</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Over the course of 61.0 frames, this enemy moves to + 2.0 in x via a lerp</li> <li>ShakeSprite called with intensity of (0.1, 0.0, 0.0) and 60.0 frametimer</li> <li>Yield for 0.75 seconds</li> <li><code>CentipedeCharge2</code> sound plays</li> <li>Over the course of 61.0 frames, this enemy moves to (-25.0, 0.0, 0.0) via a lerp. On the first frame their x position becomes lower than -4.5:<ul> <li>DoDamage 1 call happens</li> <li>ShakeScreen called with 0.3 ammount and 0.75 time</li> </ul> </li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 61.0 frames, this enemy moves from (17.0, 0.0, 0.0) to startp via a lerp. Before each frame yield, their animstate is set to 1 (<code>Walk</code>)</li> <li><code>basestate</code> and the local startstate set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-7-underground-attack","title":"Move 7 - Underground attack","text":"<p>A single target underground attack that can drain <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#dodamage-calls_3","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#logic-sequence_6","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>Digging</code> sound plays on loop using <code>sounds[9]</code> with 0.75 pitch</li> <li>MoveTowards <code>playertargetentity</code> position + (3.0, 0.0. -0.25) using 113 both as walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li>animstate set to 113</li> <li>position decreased by 2.0 in y</li> <li><code>digging</code> set to false</li> <li><code>DigPop</code> sound plays with 0.75 pitch</li> <li><code>DirtExplode</code> particles plays at this enemy with a y component to 0.0</li> <li>A new sprite object is created rooted using the <code>Sprites/Entities/centipede</code> sprite at index 9 (a patch of dirt) positioned at this enemy with a y component of 0.0 and -0.2 in z with a scale of (3.0, 2.0, 1.0)</li> <li>Yield for a random interval between 0.75 and 0.87 seconds</li> <li>animstate set to 114</li> <li><code>Bite</code> sound plays</li> <li>Yield for 0.075 seconds</li> <li>DoDamage 1 call happens</li> <li>Heal called to heal this enemy by <code>lastdamage</code> / 2 floored amount of <code>hp</code></li> <li>Yield for 0.65 seconds</li> <li><code>digging</code> set to true</li> <li><code>Dig</code> sound plays</li> <li>The patch of dirt is set to MainManager.Shrink over the course of 26.0 frames followed by their destruction (this is done in paralell)</li> <li>Yield all frames until <code>digtime</code> reaches 29.0</li> <li>y position set to 0.0</li> <li>Yield for a frame</li> <li>Yield for a frame</li> <li><code>data[2]</code> is decremented (the cooldown to have their position stay <code>Underground</code>)</li> <li>If <code>data[2]</code> just reached 0 (the cooldown expired):<ul> <li>SetDefaultCamera called</li> <li><code>Digging</code> sound plays oin loop using <code>sounds[9]</code> with 0.75 pitch</li> <li>MoveTowards startp</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li><code>digging</code> set to false</li> <li>position set to <code>Ground</code></li> <li><code>DigPop</code> sound plays with 0.75 pitch</li> <li><code>DirtExplode</code> particle plays at this enemy position</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#move-8-low-hp-phase-transition","title":"Move 8 - Low <code>hp</code> phase transition","text":"<p>Initiate a low <code>hp</code> phase transition where the player party is killed except <code>Beetle</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#dodamage-calls_4","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen to every player party members whose <code>hp</code> is above 0 This enemy The player party member 99<sup>1</sup> NoExceptions null false <p>1: For <code>Beetle</code> specifically, this cannot be lethal as enforced after this call</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Centipede/#logic-sequence_7","title":"Logic sequence","text":"<ul> <li>ClearStatus called</li> <li>Each player party member gets their Shield condition removed and their <code>shieldenabled</code> set to false</li> <li>animstate set to 105</li> <li><code>Roar2</code> sound plays</li> <li>ShakeScreen called with 0.1 ammount and 0.75 time</li> <li>Yield for 0.75 seconds</li> <li>RevivePlayer called to revive <code>playerdata[1]</code> (should always be <code>Beetle</code>) leaving them at 5 <code>hp</code> without showcounter</li> <li>UpdateAnim called</li> </ul> <p>Then, the followuing is done for each player party member in the order <code>Bee</code>, <code>Moth</code> and <code>Beetle</code>:</p> <ul> <li>If it's <code>Beetle</code>:<ul> <li>Both <code>Bee</code> and <code>Moth</code> have their <code>deathroutine</code> set to a new Death call with activatekill</li> <li>Camera moves to look near (-2.1, 0.0, 2.5)</li> <li>MoveTowards Vector3.zero with 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 105 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>If <code>chompy</code> exists:<ul> <li>Their <code>flip</code> is set to false</li> <li>They ForceMove to (-25.0, 0.0, 0.0) with 30.0 multiplier using 1 (<code>Walk</code>) both as walkstate and stopstate</li> </ul> </li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>|</code>size<code>,1.5||</code>halfline<code>||</code>boxstyle<code>,1||</code>shaky<code>|</code> followed by <code>commondialogue[166]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[1]</code> (<code>Beetle</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> </ul> </li> <li>GetSingleTarget called with the player party member so it sets <code>playertargetID</code> and <code>playertargetentity</code> to their player party member information</li> <li>If the player party member's <code>hp</code> is above 0:<ul> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>This enemy MoveTowards <code>playertargetentity</code> position + (3.5, 0.0, -0.1) with a 4.0 multiplier using 1 (<code>Walk</code>) as walkstate and 100 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>ShakeSprite called with intensity 0.1 and 0.5 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 101</li> <li>Yield for 0.05 seconds</li> <li>ShakeScreen called with 0.15 ammount and 0.5 time</li> <li>RemoveCondition called to remove the Shield condition from the player party member and their <code>shieldenabled</code> is set to false</li> <li>DoDamage 1 call happens</li> <li>If it's <code>Beetle</code>, their <code>hp</code> is set to 1 which makes the damage non lethal</li> <li>Otherwise:<ul> <li>ClearStatus called on the player party member</li> <li>animstate of <code>playerdata[1]</code> (<code>Beetle</code>) set to 9 (<code>Surprised</code>)</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul> </li> </ul> <p>After, the logic continues after the hits were done on the player party members:</p> <ul> <li>SetDefaultCamera called</li> <li>MoveTowards startp</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> set to false</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>|</code>shaky<code>|</code> followed by <code>commondialogue[167]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[1]</code> (<code>Beetle</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>This enemy animstate set to 105</li> <li><code>Roar2</code> sound plays</li> <li>ShakeScreen called with ammount of 0.1 and 0.75 time</li> <li>Yield for 0.75 seconds</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>|</code>anim<code>,this,Angry|</code> followed by <code>commondialogue[168]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>playerdata[1]</code> (<code>Beetle</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li><code>Beetle</code> has ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>StatusEffect called on <code>Beetle</code> to inflict them them AttackUp condition for 9999999 main turns (effectively infinite) with effect</li> <li>Yield for 0.5 seconds</li> <li>flags 98 set to false (this disables PepTalk)</li> <li><code>chompylock</code> set to true (this prevents Chompy to be called if they are present)</li> <li><code>lockmmater</code> is set to true (this prevents the <code>MiracleMatter</code> medal from taking effect)</li> <li><code>Beetle</code> has its <code>lockitems</code> set to true which prevents them to use any items</li> <li><code>Beetle</code> has its <code>basestate</code> set to 5 (<code>Angry</code>)</li> <li>Heal called on <code>Beetle</code> to heal them to 999 <code>hp</code></li> <li>This enemy's <code>charge</code> set to 0</li> <li>This enemy's <code>basestate</code> set to 0 (<code>Idle</code>)</li> <li>This enemy's <code>locktri</code> set to true (this is how the game tracks that this phase transition happened)</li> <li>This enemy's <code>moves</code> set to 1 (reverts them to have only 1 actor turn per main turn)</li> <li>The SurviveWith10 is removed from this enemy's weakness</li> <li>SetCondition called to inflict the AttackDown condition on this enemy for 9999999 main turns (effectively infinite)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/","title":"<code>ChomperBrute</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#battlecontrolgetexp-special-logic","title":"BattleControl.GetEXP special logic","text":"<p>This enemy is part of the set of the enemies that yields a different clamping on the rewarded amount of exp given their scaled <code>exp</code> field when they die (processed by CheckDead).</p> <p>If all of these conditions are fufilled, the rewarded amount of exp is clamped to 20 instead of 15 like most other enemies:</p> <ul> <li>flags 613 is false (RUIGEE is inactive)</li> <li><code>partylevel</code> is less than 27 (not yet at max rank)</li> <li>Flags 166 is false (not during an EX mode B.O.S.S session)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to summon a new FlyTrap enemy in the pre move logic when this enemy is the last <code>enemydata</code> remaining changes to 41% from 31%</li> <li>In the seeds throw move, the amount of seeds to throw changes to be random between 2 and 3 inclusive instead of being random between 1 and 3 inclusive</li> <li>In the seeds throw move, the amount of frames each seed takes to reach its target changes to 35.0 frames from 41.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A multiple target seeds throw</li> <li>A single target head bash</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 4/7 2 3/7"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before any move is used if this enemy is the last <code>enemydata</code> remaining and a 31% RNG check passes (41% instead if hardmode is true):</p> <ul> <li>A Vector3 is attempted to be generated that will corresponds to the position to spawn the new enemy. Each attempt may fail, but up to 20 attempts will be done and the first one that fufills some conditions will be used. Each attempts generates a vector where the x component is between 0.25 and 7.0, the y component is 0.0 and the z component is between -0.75 and 0.75. For the location to be accepted, any enemy part member needs to be located at a distance less than its <code>size</code> * 1.75. If no suitable locations is found after 20 attempts, the logic will not proceed and move selection is done immeditately</li> <li>If a suitable location is found:<ul> <li>Camera moves to look near the location</li> <li>This enemy FaceTowards the location</li> <li>animstate set to 100</li> <li><code>Clomp</code> sound plays</li> <li>Yield for a second</li> <li><code>Charge5</code> sound plays</li> <li>animstate set to 104</li> <li>Yield for 0.2 seconds</li> <li>A new sprite object is created rooted at this enemy position + (1.7 if <code>flip</code> is true, -1.7 otherwise, 4.6, 0.1) using the <code>ChomperSeed</code> item sprite with a SpinAround that has an <code>itself</code> of 20.0 in z</li> <li>Over the course of 70.0 frames, the <code>ChomperSeed</code> moves to the location via a BeizierCurve3 with a ymax of 6.0. On the second half of the movement, this enemy animstate is set to 0 (<code>Idle</code>) before each frame yield</li> <li>DeathSmoke particles plays at the <code>ChomperSeed</code> position</li> <li><code>Charge</code> sound plays</li> <li><code>checkingdead</code> is set to a new SummonEnemy call to a summon a FlyTrap with type <code>FromGroundKeepScale</code> at the <code>ChomperSeed</code> position with cantmove (meaning the summoned enemy can't act on the current main turn and needs to wait on the next one)</li> <li><code>ChomperSeed</code> gets destroyed</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>SetDefaultCamera called</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#move-1-seeds-throw","title":"Move 1 - Seeds throw","text":"<p>A multiple target seeds throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 1 to 3 times inclusive determined randomly (2 to 3 times inclusive instead if hardmode is true), but the call and no further calls happen if GetRandomAvaliablePlayer with nullable returns -1 This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) 2 null null <code>commandsuccess</code> <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>flip</code> set to false</li> <li><code>checkingdead</code> is set to a new SpiSeed coroutine call which will set <code>checkingdead</code> to null when done</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>Here is what the coroutine ends up doing:</p> <ul> <li>animstate set to 100</li> <li>Camera moves to look near <code>partymiddle</code></li> <li><code>Clomp</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li>A new sprite object is created rooted offscreen at 999.0 in y using the <code>HardSeed</code> item sprite with a SpinAround that has an <code>itself</code> of 20.0 in z</li> <li>The amount of hits is determined. It's random between 1 and 3 inclusive (between 2 and 3 instead if hardmode is true)</li> <li>For each hit to do as long as GetRandomAvaliablePlayer with nullable doesn't return -1 (result stored in <code>playertargetID</code>):<ul> <li><code>playertargetentity</code> is manually set to <code>playerdata[playertargetID]</code>'s battleentity</li> <li>animstate set to 100</li> <li>Yield for 0.35 seconds</li> <li>animstate set to 102</li> <li>Yield for 0.2 seconds</li> <li>The <code>HardSeed</code> position set to this enemy + (-2.0, 2.25, -0.1)</li> <li>Over the course of 41.0 frames (35.0 frames instead if hardmode is true), <code>HardSeed</code> moves to <code>playertargetentity</code> position + (0.0, 1.0, -0.1) via a lerp. During the second half of the movement, if this isn't the last hit, animstate is set to 101</li> <li><code>HardSeed</code> moves offscreen at 999.0</li> <li>DoDamage 1 call happens</li> </ul> </li> <li><code>HardSeed</code> gets destroyed</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to null which signals the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#move-2-head-bash","title":"Move 2 - Head bash","text":"<p>A single target head bash.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ChomperBrute/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>flip</code> set to false</li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.65, 0.0. -0.1) with a 1.6 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Grow2</code> sound plays with 0.8 pitch</li> <li>animstate set to 100</li> <li>Yield for a random interval between 0.55 and 0.75 seconds</li> <li>animstate set to 105</li> <li><code>Thump5</code> sound plays</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li>ShakeScreen with 0.2 ammount and 1.0 time</li> <li>DoDamage 1 call happens</li> <li>Yield for 1.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CordycepsAnt/","title":"<code>CordycepsAnt</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/CordycepsAnt/#move-selection","title":"Move selection","text":"<p>1 move is possible:</p> <ol> <li>A single target slashing attack</li> </ol> <p>Move 1 is always done.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CordycepsAnt/#move-1-slash-attack","title":"Move 1 - Slash attack","text":"<p>A single target slashing attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CordycepsAnt/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CordycepsAnt/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Scuttle</code> sound plays on loop using <code>sounds[9]</code> at 0.8 pitch and 0.7 volume on loop</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetID</code> position + (1.3, 0.0, -0.15) with 1.3333334 multiplier using 23 (<code>Chase</code>) as walkstate and 0 (<code>Idle</code>) as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li>Yield for 0.1 seconds</li> <li><code>Blosh</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.35 seconds</li> <li>animstate set to 101</li> <li><code>Chew</code> sound plays</li> <li>Yield for 0.1 seconds</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/","title":"<code>CursedSkull</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>This enemy has special logic that happens on StartBattle after it is loaded:</p> <ul> <li>If calledfrom exists and its entity is <code>inice</code> or the battleentity is:<ul> <li><code>freezeres</code> increased by 70</li> <li><code>inice</code> set to true</li> <li>weakness set to a new list with one element being HornExtraDamage</li> </ul> </li> </ul> <p>Additionally, if all of the following is true, the <code>exp</code> is incremented by the floored result of a lerp from 10.0 to 3.0 with a factor of instance.<code>partylevel</code> / 27.0:</p> <ul> <li>battleentity.<code>forcefire</code> is true or we are in the <code>GiantLair</code> area except for the <code>GiantLairFridgeInside</code> map</li> <li>instance.<code>partylevel</code> is less than 27 (meaning it's not maxed)</li> <li>flags 613 is false (RUIGEE is inactive)</li> </ul> <p>For more information, consult the exp logic documentation.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#fire-damage-infliction-logic-in-calculatebasedamage","title":"Fire damage infliction logic in CalculateBaseDamage","text":"<p>This enemy has a 50% chance to be on fire on a <code>Fire</code> property attack if the current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code>. It cannot be on fire otherwise.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#getenemyportrait-logic","title":"GetEnemyPortrait logic","text":"<p>If flag 664 is true (approached the oven during Chapter 7), the portrait sprite index field of this enemy is ignored and 227 is returned instead which includes the fire variant of this enemy in the portrait.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the aerial strike move, the amount of frames this enemy takes to reach the target is always 21.0 frames instead of being 31.0 frames if neither of the following were true (it would still be 21.0 if either were true even if hardmode is false):<ul> <li><code>forcefire</code> is true</li> <li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li> </ul> </li> <li>In the laser attack move, the yield time while charging the laser changes to 0.75 seconds from 0.85 seconds</li> <li>In the charging move, this enemy gets a DefenseUp condition for 2 main turns (effectively 1 main turn as the current main turn advances soon)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#move-selection","title":"Move selection","text":"<p>4 moves are possible:</p> <ol> <li>A single target aerial strike</li> <li>A single target laser attack</li> <li>Prepares themselves to explode on the next actor turn by setting their <code>charge</code> to 2</li> <li>A party wide explosition attack that self sacrifice</li> </ol> <p>The decision of which moves to use is based on odds and they change depending on if HPPercent is at least 0.9 or not. Here are the odds (move 3 and 4 are treated the same in this selection process):</p> Move Odds when HPPercent &gt;= 0.9 Odds when HPPercent &lt; 0.9 1 3/8 3/10 2 3/8 3/10 3-4 2/8 4/10 <p>There are however 2 special cases:</p> <ul> <li>If at least one of the following is true, move 3-4 is always used:<ul> <li><code>basestate</code> isn't 0 (<code>Idle</code>)</li> <li><code>charge</code> is higher than 0</li> <li>The current map is the <code>TestRoom</code></li> </ul> </li> <li>If move 3-4 is selected, but HPPercent is higher than 0.8, move 1 will be used instead</li> </ul> <p>As for move 3-4, if it is selected and HPPercent is 0.8 or lower the decision on which move to use between the 2 depends on <code>locktri</code>:</p> <ul> <li>If it is false, move 3 is used </li> <li>If it is true, move 4 is used</li> </ul> <p>NOTE: Since it is possible to clear both the <code>charge</code> of this enemy as well as having its <code>basestate</code> set away from its charge one due to incorrect CalculateBaseDamage's falling logic, it is possible to have the move selection manipulated in such a way that move 4 won't be used on the next actor turn after move 3. In such case, they can still explode, but it has to happen through the move selection process as if they were charging.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen at the start of the action:</p> <ul> <li>If position is <code>Ground</code>, it is changed to <code>Flying</code> with the following:<ul> <li><code>checkingdead</code> set to a new ChangePosition call to change this enemy position to <code>Flying</code></li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#move-1-aerial-strike","title":"Move 1 - Aerial strike","text":"<p>A single target aerial strike.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Happens if at least one of the following is true:<ul><li><code>forcefire</code> is true</li><li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li></ul> This enemy <code>playertargetID</code> after GetSingleTarget 3 Fire null <code>commandsuccess</code> 2 Happens if DoDamage 1 didn't This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> + (3.0, 0.0, -0.1) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li><code>Charge10</code> sound plays</li> <li>ShakeSprite called with intensity of (0.1, 0.0, 0.0) and frametimer of 40.0</li> <li>Yield for 0.66 seconds</li> <li>The amount of frames for the dash is determined. It's 31.0 frames unless any of the following is true where it's 21.0 frames:<ul> <li>hardmode is true</li> <li><code>forcefire</code> is true</li> <li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li> </ul> </li> <li>Over the course of the amount of frames determined, this enemy moves to <code>playertargetentity</code> position + (-3.0, 0.0, -0.1) via a BeizierCurve3 with a ymax of 0.0 - <code>height</code>. On the first frame this enemy x position becomes lower than <code>playertargetentity</code> x position, DoDamage 1 or 2 call happens depending on the one whose conditions are met</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#move-2-laser-attack","title":"Move 2 - Laser attack","text":"<p>A single target laser attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Happens if at least one of the following is true:<ul><li><code>forcefire</code> is true</li><li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li></ul> This enemy <code>playertargetID</code> after GetSingleTarget 3 Fire null <code>commandsuccess</code> 2 Happens if DoDamage 1 didn't and <code>inice</code> is true This enemy <code>playertargetID</code> after GetSingleTarget 2 Freeze null <code>commandsuccess</code> 3 Happens if DoDamage 1 and 2 didn't This enemy <code>playertargetID</code> after GetSingleTarget 2 Numb null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>If this enemy x position is less than 2.0:<ul> <li>MoveTowards (2.5, 0.0, -0.5) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul> </li> <li>GetSingleTarget called</li> <li>animstate set to 100</li> <li><code>Charge11</code> sound plays with 1.1 pitch</li> <li>A new <code>Prefabs/Particles/Charging</code> GameObject is created rooted positioned at <code>sprite</code> position + (0.0, 1.0, -0.1)</li> <li>Yield for 0.85 seconds (0.75 seconds instead if hardmode is true)</li> <li><code>Shot</code> sound plays</li> <li><code>Prefabs/Particles/Charging</code> moved offscreen at 999.0 in y</li> <li><code>Prefabs/Particles/Charging</code> gets destroyed in 5.0 seconds</li> <li>The color of the laser is determined:<ul> <li>It's pure red if all at least one of the following is true:<ul> <li><code>forcefire</code> is true</li> <li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li> </ul> </li> <li>Otherwise, it's pure cyan if <code>inice</code> is true</li> <li>Otherwise, it's pure yellow</li> </ul> </li> <li>A new LightingBolt coroutine starts which will use a <code>Prefabs/Particles/LightingBolt</code> to animate a lighting using its TrailRenderer. The coroutine only contains visual logic that doesn't affect the timing of the block so its logic will be omitted</li> <li>Yield for 0.1 seconds</li> <li>DoDamage 1, 2 or 3 happens depending on which one fits its condition requirements</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#move-3-prepare-for-explosion-with-2-charge","title":"Move 3 - Prepare for explosion with 2 <code>charge</code>","text":"<p>Prepares themselves to explode on the next actor turn by setting their <code>charge</code> to 2. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>y <code>spin</code> set to 20.0</li> <li><code>Charge13</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 101</li> <li><code>spin</code> zeroed out</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li>If hardmode is true, StatusEffect is called to inflict the DefenseUp condition on this enemy for 2 main turns without effect</li> <li><code>StatUp</code> sound plays</li> <li><code>charge</code> set to 2</li> <li>The local startstate and <code>basestate</code> set to 101</li> <li><code>locktri</code> is set to true so the explosion move can be used on the next actor turn</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#move-4-explosion","title":"Move 4 - Explosion","text":"<p>A party wide explosition attack that self sacrifice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Happens if at least one of the following is true:<ul><li><code>forcefire</code> is true</li><li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li></ul> This enemy 2 Fire <code>commandsuccess</code> 0.0 Vector3.zero false null 2 Happens if DoDamage 1 didn't and <code>inice</code> is true This enemy 1 Freeze <code>commandsuccess</code> 0.0 Vector3.zero false null 3 Happens if DoDamage 1 and 2 didn't This enemy 1 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/CursedSkull/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>Camera moves to look near (-4.0, 1.0, 0.0)</li> <li><code>bobspeed</code> and <code>bobrange</code> set to 0.0</li> <li><code>Charge16</code> sound plays</li> <li>Over the course of 151.0 frames, this enemy moves to <code>partymiddle</code> via a SmoothLerp</li> <li><code>Explosion5</code> sound plays</li> <li>ShakeScreen called with 0.3 ammount and 0.75 time</li> <li>DoDamage 1, 2 or 3 call happens depending on which one has their conditions met, but depending on which one happens, particles plays at <code>partymiddle</code> with a scale of 2.0x:<ul> <li>1: <code>Fire</code></li> <li>2: <code>mothicenormal</code></li> <li>3: <code>explosionsmall</code></li> </ul> </li> <li><code>selfsacrifice</code> set to true which prevents some logic to happen in post action since this enemy is set to die soon</li> <li>CleanKill called on this enemy which turns this enemy into a blank actor shell placing their battleentity at startp</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/","title":"<code>DeadLanderA</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#battlecontrolgetexp-special-logic","title":"BattleControl.GetEXP special logic","text":"<p>This enemy is part of the set of the enemies that yields a different clamping on the rewarded amount of exp given their scaled <code>exp</code> field when they die (processed by CheckDead).</p> <p>If all of these conditions are fufilled, the rewarded amount of exp is clamped to 20 instead of 15 like most other enemies:</p> <ul> <li>flags 613 is false (RUIGEE is inactive)</li> <li><code>partylevel</code> is less than 27 (not yet at max rank)</li> <li>Flags 166 is false (not during an EX mode B.O.S.S session)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to dig and set position to <code>Underground</code> in the post move logic changes to 40% from 30%</li> <li>In the goo projectiled throw move, the speed changes to be random between 20 and 25 inclusive cast to float instead of being random between 20 and 31 inclusive cast to float</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A multiple targets goo projectiles throw</li> <li>A single target bite attack</li> </ol> <p>Move 2 is always used if all of the following conditions are fufilled:</p> <ul> <li>firststrike is false (the enemy party isn't performing their first main turn advantage)</li> <li>This enemy position wasn't <code>Underground</code> at the start of the action (before the pre move logic)</li> <li>A 50% RNG check passes</li> </ul> <p>If the above aren't fufilled, move 1 is always used instead.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen if position is <code>Underground</code> to change it to <code>Ground</code>:</p> <ul> <li><code>DigPop3</code> sound plays</li> <li><code>checkingdead</code> is set to a new ChangePosition call to change the position of this enemy to <code>Ground</code></li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen after using a move if a 30% RNG check passes (40% instead if hardmode is true):</p> <ul> <li>animstate set to 100</li> <li><code>Dig3</code> sound plays</li> <li><code>checkingdead</code> set to a new Dig call with 0 jump to set this enemy's position to <code>Underground</code></li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#move-1-goo-projectiles-throw","title":"Move 1 - Goo projectiles throw","text":"<p>A multiple targets goo projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 3 times, but each calls requires that at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby) 3 Poison or Numb determined randomly with uniform odds This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new sprite object rooted using the <code>projectilepsrites[15]</code> sprite (an inverted honey projectile) positioned at this enemy + (-1.6, 1.0, -0.1) with a and material color of pure yellow with a ShadowLite SetUp with 0.3 opacity and 0.5 size Random between 20 and 31 inclusive then cast to float (between 20 and 25 inclusive then cast to float instead if harmode is true) 0.0 <code>keepcolor</code> <code>ElecFast</code> <code>BubbleBurst</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves to look near the midpoint between this enemy and <code>partymiddle</code></li> <li>A new SpriteRenderer array is created with 3 as the length to hold each projectile object</li> <li>Done 3 times:</li> <li>If at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li><code>DLAlphaGoo1</code> sound plays</li> <li>animstate set to 103</li> <li>Yield for a second</li> <li>The projectile element is set to a new sprite object rooted using the <code>projectilepsrites[15]</code> sprite (an inverted honey projectile) positioned at this enemy + (-1.6, 1.0, -0.1) with a and material color of pure yellow with a ShadowLite SetUp with 0.3 opacity and 0.5 size</li> <li><code>DLAlphaGoo2</code> sound plays</li> <li>Projectile 1 call happens</li> <li>animstate set to 104</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>Yield all frames until all projectiles objects are null (all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#move-2-bite-attack","title":"Move 2 - Bite attack","text":"<p>A single target bite attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderA/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li>Yield for 0.25 seconds</li> <li>y <code>spin</code> set to 30.0</li> <li><code>Dig3</code> sound plays</li> <li>ChangeScale called to change the scale to 0.0x with 30.0 framtime with force</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>position set to <code>playertargetentity</code> position + (2.0, 0.0, -0.1)</li> <li>ChangeScale called to change the scale to the <code>startscale</code> value before this action with 30.0 framtime with force</li> <li><code>DigPop</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>FliAngle called with setangle</li> <li><code>spin</code> zeroed out</li> <li>animstate set to 101</li> <li><code>DLAlphaChomp</code> sound plays</li> <li>Yield for a random interval between 0.6 and 0.8 seconds</li> <li>animstate set to 102</li> <li><code>Bite</code> sound plays with 1.2 pitch</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 100</li> <li><code>DLAlphaWoosh</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li>y <code>spin</code> set to 30.0</li> <li><code>Dig3</code> sound plays</li> <li>ChangeScale called to change the scale to 0.0x with 30.0 framtime with force</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>Yield for a frame</li> <li>position changed to startp</li> <li>SetDefaultCamera called</li> <li><code>DigPop3</code> sound plays</li> <li>ChangeScale called to change the scale to the <code>startscale</code> value before this action with 30.0 framtime with force</li> <li>Yield for 0.5 seconds</li> <li>FliAngle called with setangle</li> <li><code>spin</code> zeroed out</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/","title":"<code>DeadLanderB</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#battlecontrolgetexp-special-logic","title":"BattleControl.GetEXP special logic","text":"<p>This enemy is part of the set of the enemies that yields a different clamping on the rewarded amount of exp given their scaled <code>exp</code> field when they die (processed by CheckDead).</p> <p>If all of these conditions are fufilled, the rewarded amount of exp is clamped to 20 instead of 15 like most other enemies:</p> <ul> <li>flags 613 is false (RUIGEE is inactive)</li> <li><code>partylevel</code> is less than 27 (not yet at max rank)</li> <li>Flags 166 is false (not during an EX mode B.O.S.S session)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the aerial slam attack, the frametime of the ForceMove call before the DoDamage call changes to 25.0 fram 32.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target vomit attack that hits twice</li> <li>A party wide aerial slam attack</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 50% 2 50%"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#move-1-vomit-attack","title":"Move 1 - Vomit attack","text":"<p>A single target vomit attack that hits twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 2 times This enemy <code>playertargetID</code> after GetSingleTarget 3 Poison null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 100</li> <li><code>bobspeed</code> set to 0.0</li> <li>ShakeSprite called with 0.1 intensity and 90.0 frametimer</li> <li><code>DLBetaCharge</code> sound plays</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li><code>DLBetaDing</code> sound plays</li> <li>animstate set to 101</li> <li><code>DLBetaVomit</code> sound plays</li> <li>A new sprite object is created childed to <code>sprite</code> using the <code>Sprites/Entities/deadlandera</code> index 57 sprite (vomit) positioned at (-0.8, 0.5, -0.1) with a scale of (0.015 * the distance between this enemy and <code>playertargetentity</code>, 0.0, 1.0)</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>sprite</code> gets an AimConstraint added with an aimVector of (0.0, 1.0, 1.0), a constraintActive of true, a rotationOffset of (0.0, 87.0, -50.0) and a source constraint added with 1.0 weight and <code>playertargetentity</code> sourceTransform</li> <li>FlipSpriteBool called on the vomit sprite without x, with y every 3.0 frames during -1.0 frames (infinite)</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>The vomit sprite has GradualScale called to change the scale to (0.015 * the distance between this enemy and <code>playertargetentity</code>, 1.0, 1.0) with 5.0 frametime without destroy</li> <li>Yield for 0.1 seconds</li> <li>Yield for 0.1 seconds</li> <li>Done 2 times:<ul> <li>If <code>commandsuccess</code> is true (blocking), <code>playertargetentity</code> animstate is set to 24 (<code>Block</code>)</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li>Yield for 0.25 seconds</li> </ul> </li> <li>The vomit sprite has GradualScale called to change the scale to (0.015 * the distance between this enemy and <code>playertargetentity</code>, 0.0, 1.0) with 30.0 frametime without destroy</li> <li>Yield for 0.5 seconds</li> <li>The FlipSpriteBool coroutine is stopped</li> <li>Yield a frame</li> <li>The vomit sprite gets destroyed</li> <li>The AimConstraint on <code>sprite</code> gets destroyed</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li><code>bobspeed</code> set to <code>startbs</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#move-2-slam-attack","title":"Move 2 - Slam attack","text":"<p>A party wide aerial slam attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 5 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderB/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>DLFlyOver</code> sound plays</li> <li><code>bobspeed</code> set to 0.0</li> <li>Camera moves to look near (-4.5, 1.5, 1.25)</li> <li>ForceMove to <code>partymiddle</code> + 5.0 in y with 70.0 frametime using 100 as movestate and 103 as stopstate</li> <li><code>DLBetaSpike</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>height</code> increased by 0.5</li> <li>animstate set to 103</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li>ShakeSprite called with 0.1 intensity and 90.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li><code>Fall2</code> sound plays</li> <li><code>startscale</code> set to 1.25x</li> <li>Yield for a frame</li> <li>z <code>spin</code> set to 15.0</li> <li>ForceMove to <code>partymiddle</code> + (0.0, 0.0 - <code>sprite</code> local y position + 0.75, -0.2) with 32.0 frametime (25.0 instead if hardmode is true) using 103 as movestate and 103 as stopstate</li> <li>animstate set to 103</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li><code>Thud3</code> sound plays</li> <li><code>spin</code> zeroed out</li> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li><code>impactsmoke</code> particles plays at <code>partymiddle</code></li> <li>PartyDamage 1 plays</li> <li><code>startscale</code> set to (1.25, 0.75, 1.0)</li> <li><code>sprite</code> local scale set to <code>startscale</code></li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li><code>sprite</code> gets a SpriteBounce added SetUp with a freq of 0.75 and spd of 0.5</li> <li>A Gradual call starts on the SpriteBounce with a freq of 0.0, 0.0 spd and 45.0 frametime</li> <li>Yield for 1 second</li> <li>The SpriteBounce is destroyed</li> <li>position set to <code>partymiddle</code></li> <li><code>startscale</code> reset to 1.0x</li> <li><code>sprite</code> scale reset to 1.0x</li> <li><code>height</code> set to its value before this action</li> <li><code>bobspeed</code> set to <code>startbs</code></li> <li><code>DLBetaFlyBack</code> sound plays</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/","title":"<code>DeadLanderG</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#battlecontrolgetexp-special-logic","title":"BattleControl.GetEXP special logic","text":"<p>This enemy is part of the set of the enemies that yields a different clamping on the rewarded amount of exp given their scaled <code>exp</code> field when they die (processed by CheckDead).</p> <p>If all of these conditions are fufilled, the rewarded amount of exp is clamped to 20 instead of 15 like most other enemies:</p> <ul> <li>flags 613 is false (RUIGEE is inactive)</li> <li><code>partylevel</code> is less than 27 (not yet at max rank)</li> <li>Flags 166 is false (not during an EX mode B.O.S.S session)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the projectiles throw move, the amount of hits changes to 4 from 3</li> <li>In the projectiles throw move, the speed of each Projectile calls changes to be random between 29.0 and 37.0 instead of being random between 34.0 and 42.0</li> <li>In the laser attack move, the second to last yield time before the DoDamage call changes to 0.75 seconds from 0.85 seconds (also changes the frametimer of the ShakeSprite call at the start of the move to be 45.0 instead of 51.0). Note that there is still a 0.1 seconds yield after that is right before the DoDamage call</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target claw slash attack</li> <li>A multiple targets projectiles throw that may inflict Sleep</li> <li>A single target laser attack that may inflict Sleep</li> </ol> <p>The decision of which moves to use is based on the following odds:</p> Move Odds 1 3/7 2 2/7 3 2/7"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#move-1-claw-slash-attack","title":"Move 1 - Claw slash attack","text":"<p>A single target claw slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>DLGammaStep</code> sound plays on loop using <code>sounds[9]</code></li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (3.75, 0.0, -0.15) with a 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 100 as stopstate</li> <li>Yield until <code>forcemove</code> is done</li> <li><code>flip</code> set to false</li> <li><code>sounds[9]</code> stopped</li> <li><code>DLGammaClaw1</code> sound plays</li> <li>Yield for a random interval between 0.65 and 0.85 seconds</li> <li>x position decreased by -0.25</li> <li><code>DLGammaClaw2</code> sound plays</li> <li>animstate set to 101</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#move-2-projectiles-throw","title":"Move 2 - Projectiles throw","text":"<p>A multiple targets projectiles throw that may inflict Sleep.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 3 times (4 instead if hardmode is true), but each call requires that at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 2 Sleep This enemy <code>playertargetID</code> A new sprite object rooted using the <code>projectilepsrites[5]</code> sprite (gray spiky projectile) positioned at this enemy + (0.25, 1.25, -0.1) + a random vector from (-2.0, -0.5, 0.0) to (2.0, 0.5, 0.0) with a color of FFF8A7 (light yellow) Random between 34.0 and 42.0 (between 29.0 and 37.0 instead if hardmode is true) Random between 4.0 and 6.0 <code>keepcolor</code> null null null (0.0, 0.0, 15.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>DLGammaCharge</code> sound plays</li> <li>animstate set to 104</li> <li>The amount of hits is determined. It's 3 (4 instead if hardmode is true). A new SpriteRenderer array is created with this amount as the length to hold the projectiles objects</li> <li>Camera moved to look near the midpoint between this enemy and <code>partymiddle</code></li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>For each hit to do:<ul> <li>If there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li><code>DLGammaSpore</code> sound plays</li> <li>A random number between 0.45 and 0.75 is generated</li> <li>GetSingleTarget called</li> <li>The projectile element is set to a new sprite object rooted using the <code>projectilepsrites[5]</code> sprite (gray spiky projectile) positioned at this enemy + (0.25, 1.25, -0.1) + a random vector from (-2.0, -0.5, 0.0) to (2.0, 0.5, 0.0)</li> <li>DeathSmoke particles plays at the projectile element with 0.5x size</li> <li>The projectile element's color is set to FFF8A7 (light yellow)</li> <li>Projectile 1 call happens</li> <li><code>rotater</code> scale set to (1.2, 0.8, 1.0)</li> <li>GradualScale called on <code>rotater</code> to change the scale to the value it had before this action with a frametime of 45.0 * the random number generated earlier without destroy</li> <li>Yield for ammount of seconds equal to the random number generated earlier</li> </ul> </li> </ul> </li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until all projectiles object are null (all Projectile 1 calls completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#move-3-laser-attack","title":"Move 3 - Laser attack","text":"<p>A single target laser attack that may inflict Sleep.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Sleep null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DeadLanderG/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>DLGammaCharge2</code> sound plays</li> <li>ShakeSprite called with 0.1 intensity and 51.0 frametimer (45.0 instead if hardmode is true)</li> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 102</li> <li>A new <code>Prefabs/Particles/Charging</code> GameObject is instantiated rooted at <code>sprite</code> position + (-0.8, 1.45, -0.1)</li> <li>Yield for 0.85 seconds (0.75 seconds instead if hardmode is true)</li> <li><code>DLGammaLaser</code> sound plays</li> <li>The <code>Prefabs/Particles/Charging</code> moves offscreen at 999.0 in y then destroyed in 5.0 seconds</li> <li>animstate set to 103</li> <li>A new LightingBolt coroutine starts which will use a <code>Prefabs/Particles/LightingBolt</code> to animate a lighting using its TrailRenderer. The coroutine only contains visual logic that doesn't affect the timing of the block so its logic will be omitted</li> <li>Yield for 0.1 seconds</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/","title":"<code>Delilah</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy is fought with them and Stratos only in the enemy party as they strongly interact together. If this assumption isn't respected, exceptions may be thrown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 4 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: The amount of times the LongLegSummoner equivalent action move and any moves among the support items set were used (see the move selection section below for details). The value is incremented each time any of these moves are used and once it reaches 10, the usage of these moves are no longer allowed. Essentially, it's a hard limit to this enemy where they cannot use any of these moves more than 10 times combined in the entire battle</li> <li><code>data[1]</code>: A lock on the usage of any moves from the support items move selection set (see the move selection section below for details). When the value is 1, it prevents these move to be used. The value is always reset to 0 in the post move logic. The lock is never activated by this enemy, but rather by Statos which sets it to 1 when they use their enemy party healing move</li> <li><code>data[2]</code>: This value does nothing. It was intended to act similarly to Stratos's <code>data[1]</code> which is a revive move usage deterant, but the value is never incremented even when delilah uses their equivalent move. It means this deterant never activates and they always have a 70% chance to use the move if all other conditions are satisfied instead of lowering the chances to 30% after 3 usage of the move</li> <li><code>data[3]</code>: A cooldown on the usage of any moves among the support items set (see the move selection section below for details). When any of these move is used (except for the ClearBomb equivalent action move), the value is set above 0. On every actor turns that these moves aren't used (except for the ClearBomb equivalent action move where this applies), the value is decremented in the post move logic. For any of these moves to become usable again, the value must be 0 or below. Essentially, it's an actor turn antispam where the moves among the support items set can't be used again until x amount of actor turns passes where x is this value. As for the exact value set by each of these moves, it depends on the move itself:<ul> <li>The Stratos healing move with GradualHP sets it to 2</li> <li>The AttackUp and DefenseUp conditions infliction move on Stratos sets it to 1</li> <li>The ClearStatus move on Stratos sets it to 1</li> <li>The <code>moreturnnextturn</code> increment move on Stratos sets it to 1</li> <li>The ClearBomb equivalent action move doesn't set the value to anything, but it will still cause a decrement on it in the post move logic and the move is still among the ones that this value restricts the usage of</li> <li>The enemy party healing move sets it to 2</li> <li>The Stratos reviving move sets it to 2</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-selection","title":"Move selection","text":"<p>11 moves are possible:</p> <ol> <li>A multiple targets bazooka projectiles throws in multiple sets that have varying effects</li> <li>A single target multiple hits dart throws that may inflict Poison or Sleep</li> <li>A single target dash attack followed by an <code>hp</code> draining attack</li> <li>A single target attack involving the same effects as the LongLegSummoner action where the target is a player party member</li> <li>Heals Stratos by 6 <code>hp</code> and gives them the GradualHP condition for 3 main turns</li> <li>Gives Stratos the AttackUp and DefenseUp conditions for 3 main turns (effectively 2 since the current main turn gets advanced soon)</li> <li>Cures Stratos's negative conditions with ClearStatus</li> <li>Increments Stratos's <code>moreturnnextturn</code> giving them an additional actor turn on the next main turn</li> <li>Does the equivalent of the ClearBomb action which clears every actor's conditions via ClearStatus</li> <li>Heals 15 <code>hp</code> and calls ClearStatus on themselves and Stratos</li> <li>Revives Stratos leaving them at 7 <code>hp</code></li> </ol> <p>Moves 5 through 11 belongs in a special sets of move that have their own move selection process. Since all of them involves simulating the usage of an items without doing damages, the move selection for them will be refered to as the support items move selection while the other moves will be refered to as the standard move selection.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#support-items-move-selection","title":"Support items move selection","text":"<p>To have a chance to use move 5 through 11, all of the following conditions must be fufilled:</p> <ul> <li><code>data[1]</code> is 0 (Stratos didn't set a lock on this enemy using these moves which happens when they used their enemy party healing move)</li> <li>This enemy doesn't have the Sticky condition</li> <li><code>data[0]</code> is less than 10 (this enemy hasn't reached its limit of using these moves and move 4)</li> <li><code>turns</code> is above 0 (at least 1 main turns passed since the start of the battle)</li> <li><code>data[3]</code> is 0 or below (the cooldown for being able to use these moves expired)</li> </ul> <p>If all of the above are fufilled, it is now possible that move 5 through 11 is used. However, each must go through a complex selection process to see if a move will be used among them. It is still possible that none of these moves are used. If this happens, this enemy will falback to the standard move selection process.</p> <p>Move 11 is checked first and it will be used if all of the following conditions are fufilled:</p> <ul> <li>Stratos isn't present in <code>enemydata</code> (they died)</li> <li>A 70% RNG check passes. NOTE: there is dead logic where the odds could have changed to 30% instead if <code>data[2]</code> is at least 3, but <code>data[2]</code> is always 0 meaning the odds always are 70% (see the <code>data</code> section as to what <code>data[2]</code> was supposed to do)</li> </ul> <p>If move 11 was decided to not be used, move 5 through 10 can only be used if Stratos is still present in <code>enemydata</code>. If that's the case, this move selection process continues, but if it's not, this enemy falbacks to the standard move selection process.</p> <p>If we continue, move 10 is checked next. It's only used if all of the following conditions are fufilled:</p> <ul> <li>Both this enemy and Delilah have an HPPercent lower than 0.3</li> <li>A 35% RNG check passes</li> </ul> <p>If neither move 10 or 11 are used, move 5 through 9 are considered next, but only if a 37.5% RNG check passes. If it fails, this enemy falbacks to the standard move selection process.</p> <p>If it passes, the decision of which moves to use among 5 through 9 is based on odds, but each have additional requirements that must be fufilled once the move is selected for the move to be actually used. If the move is selected, but the requirements aren't fufilled, this enemy falbacks to the standard move selection process. Here is a table with all these informations for each of these moves:</p> Move Odds Requirements 5 4/18 Stratos's HPPercent is below 0.75 6 3/18 Both of the following has to be true:<ul><li>Stratos doesn't already have the AttackUp condition</li><li>Stratos doesn't already have the DefenseUp condition</li></ul> 7 5/18 At least 1 of the following has to be true:<ul><li>Stratos is stopped</li><li>Stratos has the Poison condition</li><li>Stratos has the Fire condition</li></ul> 8 3/18 Stratos's <code>moves</code> is 1 (meaning they haven't yet gone through their phase transition) 9 3/18 PartyIsBuffed with a cutoff of 3 returns true (see the section below for details, this is logically broken and has several caveats) <p>Move 9's requirements is special since it involves a method specifically for this move, but the method is logically broken.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#about-move-9-and-partyisbuffed","title":"About move 9 and PartyIsBuffed","text":"<p>Move 9 affects every actors in the battle by removing a lot of conditions and effects that are either positive or negative to them. It means that this enemy shouldn't want to use this move if it would negatively impact the enemy party more than benefit from it.</p> <p>The method PartyIsBuffed was supposed to the determine if this is the case. It attempts to use multiple heuritstics to see if the player party has more positive effects (such as conditions or <code>charge</code>) than the enemy party.</p> <pre><code>private bool PartyIsBuffed(int cutoff)\n</code></pre> <p>Its intent was that it would use a number starting at 0 and perform the following on it for each positive or negative effects applied on each actor:</p> <ol> <li>Increase the number for each positive effect applied on each player party member</li> <li>Decrease the number for each negative effect applied on each player party member</li> <li>Increase the number for each negative effect applies on each enemy party member</li> <li>Decrease the number for each positive effect applies on each enemy party member</li> </ol> <p>Once all this is done, the method would have returned true if the final number is higher than the cutoff parameter (here, it's always 3) and it would have returned false otherwise. This was the likely intended logic: it would tell if there's slighly more positive effects from performing move 9 or if there isn't enough reasons to use it.</p> <p>However, step 3 and 4 aren't done correctly due to a programming error. Instead of counting each effect on enemy party members, it counts the effects applied on the <code>playerdata</code> who shares an <code>enemydata</code> index. Effectively, it means that:</p> <ul> <li><code>playerdata[0]</code> (should be <code>Bee</code>)'s effects will be counted instead of <code>enemydata[0]</code> (should be Stratos)</li> <li><code>playerdata[1]</code> (should be <code>Beetle</code>)'s effects will be counted instead of <code>enemydata[1]</code> (should be this enemy)</li> </ul> <p>The only exception to this are the enemy party member's <code>charge</code> where these are counted correctly.</p> <p>This drastically complexify what this method ACTUALLY does, but the end result is still the same: the final number is compared to the cutoff and the return is true if it's higher or false if it's not. It means however that the vast majority of the enemy party's effects aren't counted correctly which affects the logic. For the most part, it means that for a typical party under normal gameplay (<code>Bee</code>, <code>Beetle</code> and <code>Moth</code> in that order), <code>Moth</code>'s effects are the only ones that gets counted on the player party side since <code>Bee</code> and <code>Beetle</code> gets counted twice, but with the opposite effects so they get cancelled. It also means that except for <code>charge</code>, no effects is actually counted for the enemy party members.</p> <p>The following table can be used to determine the final result considering all of this broken logic. A note about conditions check however: since when this method is invoked, the current main turn ends very soon, these checks involves the main turn counter on the condition being higher than 1. This is because if it was 1, it would expire very soon which means the condition isn't very useful to consider here.</p> <p>As a reminder, the initial value of the result is 0 and the cutoff passed is 3 under normal gameplay:</p> Condition Effect on result <code>playerdata[2]</code> (should be <code>Moth</code>) has the AttackUp condition with more than 1 main turn left on it (<code>Bee</code> and <code>Beetle</code> having it doesn't count) + 1 <code>playerdata[2]</code> (should be <code>Moth</code>) has the DefenseUp condition with more than 1 main turn left on it (<code>Bee</code> and <code>Beetle</code> having it doesn't count) + 1 A player party member has a <code>charge</code> above 0 + (<code>charge</code> + 1) applied for each applicable player party members An enemy party member has a <code>charge</code> above 0 - (<code>charge</code> + 1) applied for each applicable enemy party members A player party member has the Inked condition with more than 1 main turn left on it -2 applied for each applicable player party member <code>playerdata[2]</code> (should be <code>Moth</code>) has the Numb condition with more than 1 main turn left on it (<code>Bee</code> and <code>Beetle</code> having it doesn't count) - 1 <code>playerdata[2]</code> (should be <code>Moth</code>) has the Freeze condition with more than 1 main turn left on it (<code>Bee</code> and <code>Beetle</code> having it doesn't count) - 1 <code>playerdata[2]</code> (should be <code>Moth</code>) has the Fire condition with more than 1 main turn left on it (<code>Bee</code> and <code>Beetle</code> having it doesn't count) - 2 <code>playerdata[2]</code> (should be <code>Moth</code>) has the Poison condition with more than 1 main turn left on it (<code>Bee</code> and <code>Beetle</code> having it doesn't count) - 1 A player party member has the Sticky condition with more than 1 main turn left on it -2 applied for each applicable player party member <code>playerdata[2]</code> (should be <code>Moth</code>) has the GradualHP condition with more than 1 main turn left on it (<code>Bee</code> and <code>Beetle</code> having it doesn't count) + 1 <code>playerdata[2]</code> (should be <code>Moth</code>) has the GradualTP condition with more than 1 main turn left on it (<code>Bee</code> and <code>Beetle</code> having it doesn't count) + 1"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#standard-move-selection","title":"Standard move selection","text":"<p>This move selection applies to move 1 through 4 and it happens if it was determined that the support items move selection won't apply for any reasons.</p> <p>The decision of which moves to use is based on odds, but those odds changes depending on if this enemy has the Inked condition or not. Here are the odds in either situations:</p> Move Odds when not Inked Odds when Inked 1 4/13 Never used 2 3/13 Never used 3 5/13 1/2 4 1/13 1/2 <p>However, move 4 has additional requirements that must all be fufilled for the move to actually be used once selected:</p> <ul> <li>This enemy doesn't have the Sticky condition</li> <li><code>turns</code> is above 0 (at least 1 main turn passed since the start of the battle)</li> <li><code>data[0]</code> is below 10 (this enemy hasn't yet reached its limit on the usage of this move and any amoing the support items moves)</li> </ul> <p>If the move is selected, but the requirements above aren't fufilled, another move is used instead depending on if this enemy has the Inked condition:</p> <ul> <li>If it has it, move 3 is used</li> <li>If if doesn't have it, move 1 is used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done before the usage of a move if HPPercent is less than 0.5 and <code>moves</code> is 1 (meaning this phase transition hasn't happened yet).</p> <p>When the above is fufilled, this enemy goes into a phase transition where they get 2 actor turns per main turn including the current one:</p> <ul> <li><code>Charge18</code> sound plays with 1.1 pitch</li> <li>y <code>spin</code> set to 10.0</li> <li>animstate set to 4 <code>ItemGet</code></li> <li>Yield for 0.5 seconds</li> <li><code>spin</code> zeroed out</li> <li>StatEffect called with type 5 (yellow up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>moves</code> set to 2 and <code>cantmove</code> is decremented which gives 2 actor turn per main turn to this enemy including the current one</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#post-move-logic","title":"Post move logic","text":"<p>The following logic is always done after the usage of a move:</p> <ul> <li>If the move that was used belongs in a certain set, <code>data[3]</code> is decremented (the cooldown for the usage of the moves used in the support items move selection). The set of moves this applies are the following:<ul> <li>Bazooka projectiles move</li> <li>Darts throws move</li> <li>Dash attack and <code>hp</code> drain move</li> <li>LongLegSummoner equivalent action move</li> <li>ClearBomb equivalent action move (this move belongs in the support items move selection, but it will still cause the decrement to happen instead of setting the value above 0 like other moves from the support items move selection)</li> </ul> </li> <li><code>data[1]</code> is set to 0 (clears the lock set by Stratos on moves used in the support items move selection)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-1-bazooka-projectiles-throws","title":"Move 1 - Bazooka projectiles throws","text":"<p>A multiple targets bazooka projectiles throws in multiple sets that have varying effects.</p> <p>This move throws projectils in 3 or 4 sets. Each set has 1 or 3 hits depending on the set itself. Each set has a unique property and amount of hits to do with other additional changes such as the base damage amount and other visual changes. See the information on the Projectile 1 call below to learn their selection odds and their specific effects.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 1 or 3 times per set depending on the set selected (it's 1 time except if the set has the <code>Ink</code> or <code>Sticky</code> property where it's 3 times) The amount of sets is random between 3 and 4 inclusive. Each sets requires that at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby). If the entire player party becomes dead during the set, the calls still happens, but the target doesn't change between calls until the end of the set where no more calls will happen Depends on the property of the set:<ul><li>null: 5</li><li><code>Ink</code>: 3</li><li><code>Sticky</code>: 3</li><li><code>Freeze</code>: 4</li><li><code>Poison</code>: 4</li><li><code>Fire</code>: 5</li></ul> The set determines the value which is determined randomly among the following weighthed odds:<ul><li>null: 2/15</li><li><code>Ink</code>: 4/15</li><li><code>Sticky</code>: 3/15</li><li><code>Freeze</code>: 2/15</li><li><code>Poison</code>: 2/15</li><li><code>Fire</code>: 2/15</li></ul> This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls except when the player party died during the set) A new sprite object rooted positioned at startp + (-1.0, 2.2, -0.1). The sprite, its scale and color depends on the property of the set:<ul><li>null: <code>HardSeed</code> item sprite with pure white color and 1.0x scale</li><li><code>Ink</code>: <code>Sprites/Particles/bigbubble</code> sprite with 000033 color (dark blue) and 0.4x scale</li><li><code>Sticky</code>: <code>Sprites/Particles/bigbubble</code> sprite with pure white color and 0.4x scale</li><li><code>Freeze</code>: <code>Ice</code> item sprite with pure white color and 1.0x scale</li><li><code>Poison</code>: <code>PoisonSpud</code> item sprite with pure white color and 1.0x scale</li><li><code>Fire</code>: <code>FlameRock</code> item sprite with pure white color and 1.0x scale</li></ul> Random between 35 and 44 inclusive unless property is <code>Ink</code> or <code>Sticky</code> where it's random between 25 and 34 inclusive instead 5.0 unless property is <code>Ink</code> or <code>Sticky</code> where it's random between 6.0 and 8.0 instead <code>keepcolor</code> Depends on the property of the set:<ul><li>null: null</li><li><code>Ink</code>: <code>InkGet</code></li><li><code>Sticky</code>: <code>StickyGet</code></li><li><code>Freeze</code>: <code>mothicenormal</code></li><li><code>Poison</code>: <code>poisoneffect</code></li><li><code>Fire</code>: <code>Fire</code></li></ul> Depends on the property of the set:<ul><li>null: null</li><li><code>Ink</code>: <code>BubbleBurst</code></li><li><code>Sticky</code>: <code>BubbleBurst</code></li><li><code>Freeze</code>: <code>OverworldIce</code></li><li><code>Poison</code>: null</li><li><code>Fire</code>: null</li></ul> null (0.0, 0.0, 20.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence","title":"Logic sequence","text":"<ul> <li>animstate set to 107</li> <li><code>WaspKingAxeThrowCatch</code> sound plays with 0.9 pitch</li> <li>Yield for a second</li> <li>The amount of sets of hits to do is determined. It's random between 3 and 4 inclusive. A new SpriteRenderer array is created with this amount as the length to hold the projectiles objects (NOTE: this is technically wrong because it's the amount of sets and not the amount of hits per set, but it's guaranteed to contain enough anyway so it's safe still)</li> <li>For each sets of hits to do, if there's at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>The set is determined. They will be identified by the property they will have on the Projectile 1 call and the amounts of hits in the set. The set is determined randomly with weighted odds:<ul> <li>null (1 hit): 2/15</li> <li><code>Ink</code> (3 hits): 4/15</li> <li><code>Sticky</code> (3 hits): 3/15</li> <li><code>Freeze</code> (1 hit): 2/15</li> <li><code>Poison</code> (1 hit): 2/15</li> <li><code>Fire</code> (1 hit): 2/15</li> </ul> </li> <li><code>b33BotInstantMissle</code> sound plays with 1.1 pitch</li> <li>For each hit in the set:<ul> <li>If this isn't the first hit (and only) hit, <code>b33BotInstantMissle</code> sound plays with a pitch of 1.325 if it's the second hit or 1.4 if it's the third hit</li> <li>The projectile element is set to a new sprite object as described in the Projectile 1 call above depending on the property of the set</li> <li>Projectile 1 call happens with the determined set</li> <li>MainManager.MoveTowards called to move this enemy from startp + 0.5 in x to startp with 20.0 frametime without smooth and without caller (done in paralel)</li> <li>DeathSmoke particles plays at the projectile sprite position</li> <li>If this isn't the last hit of the set, animstate is set to 110. Otherwise, it's set to 109</li> <li>Yield for a random interval betweem 0.65 and 1.0 seconds if there's only 1 hit in the set or between 0.3 and 0.5 seconds if there's more than 1 hit in the set</li> <li>If there's still at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby), GetSingleTarget is called</li> </ul> </li> <li>If this isn't the last set, animstate is set to 108</li> <li>Yield for a frame</li> </ul> </li> <li>Yield all frames until all projectiles elements are null (all Projectile 1 calls completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-2-darts-throws-with-potential-poison-or-sleep-infliction","title":"Move 2 - Darts throws with potential Poison or Sleep infliction","text":"<p>A single target multiple hits dart throws that may inflict Poison or Sleep.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#projectile-calls_1","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times (4 times instead if HPPercent is less than 0.65) 3 Poison or Sleep determined randomly with uniform odds This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) A new sprite object rooted using the <code>PoisonDart</code> item sprite if property is <code>Poison</code> or the <code>NumbDart</code> item sprite if property is <code>Sleep</code> positioned at this enemy + (-0.5, 1.25, -0.1) with a z angle of -15.0 20.0 0.0 null null null null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (0.3, 2, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>GetSingleTarget called</li> <li>Camera moves to look near (-1.75, 0.0, 1.6)</li> <li>MoveTowards (2.25, 0.0, -0.5) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 103</li> <li>Yield for 0.5 seconds</li> <li><code>Jump</code> sound plays</li> <li><code>Spin2</code> sound plays on loop using <code>sounds[5]</code> with 1.2 pitch</li> <li>animstate set to 102</li> <li>y <code>spin</code> set to 20.0</li> <li>MainManager.MoveTowards called on this enemy to move them to (1.35, 2.5, -0.5) with 40.0 frametime without smooth and without local (done in paralel)</li> <li>Yield 0.5 seconds</li> <li>Yield 0.25 seconds</li> <li><code>spin</code> zeroed out</li> <li><code>sprite</code> angle set to FlipAngle</li> <li><code>sounds[5]</code> stopped</li> <li>The amount of hits is determined. It's 2 unless HPPercent is below 0.65 where it's 4 instead. A new SpriteRenderer array is created with this amount as the length to hold the projectiles objects</li> <li>For each hit to do:<ul> <li><code>Toss</code> sound plays</li> <li><code>Spin10</code> sound plays</li> <li>The property of the Projectile 1 call is determined randomly with uniform odds between Poison and Sleep</li> <li>animstate set to 111</li> <li>The projectile element is set to a new sprite object rooted using the <code>PoisonDart</code> item sprite if property is <code>Poison</code> or the <code>NumbDart</code> item sprite if property is <code>Sleep</code> positioned at this enemy + (-0.5, 1.25, -0.1) with a z angle of -15.0</li> <li>Projectile 1 call happens</li> <li>If this isn't the last hit:<ul> <li>Yield for 0.5 seconds</li> </ul> </li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-3-dash-attack-followed-by-hp-drain-attack","title":"Move 3 - Dash attack followed by <code>hp</code> drain attack","text":"<p>A single target dash attack followed by an <code>hp</code> draining attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code> 2 Always happen after DoDamage 1 This enemy The same target as DoDamage 1 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near (-1.75, 0.0, 1.6)</li> <li>MoveTowards (2.25, 0.0, -0.5) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 103</li> <li>Yield for 0.5 seconds</li> <li><code>Jump</code> sound plays</li> <li><code>Spin2</code> sound plays on loop using <code>sounds[5]</code> with 1.2 pitch</li> <li>animstate set to 102</li> <li>y <code>spin</code> set to 20.0</li> <li>MainManager.MoveTowards called on this enemy to move them to (1.35, 2.5, -0.5) with 40.0 frametime without smooth and without local (done in paralel)</li> <li>Yield 0.5 seconds</li> <li>Yield 0.25 seconds</li> <li><code>spin</code> zeroed out</li> <li><code>sprite</code> angle set to FlipAngle</li> <li><code>sounds[5]</code> stopped</li> <li><code>trail</code> set to true</li> <li>animstate set to 104</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>FastWoosh</code> sound plays</li> <li>Over the course of 21.0 frames, this enemy moves to <code>playerdata[playertargetID]</code> position + (0.75, 0.75, -0.1) via a lerp</li> <li><code>trail</code> set to false</li> <li>This enemy position set to <code>playerdata[playertargetID]</code> position + (0.35, 0.85, -0.1)</li> <li>DoDamage 1 call happens</li> <li><code>sprite</code> gets a SpriteBounce added on it with a MessageBounce using a 1.0 multiplier and a <code>speed</code> of 15.0</li> <li>animstate set to 105</li> <li>Done 3 times:<ul> <li><code>Kiss</code> sound plays with 1.1 pitch</li> <li>Yield for 0.33 seconds</li> </ul> </li> <li>DoDamage 2 call happens</li> <li>The SpriteBounce of the <code>sprite</code> gets destroyed</li> <li><code>sprite</code> scale reset to 1.0x</li> <li>Heal called to heal this enemy by <code>lastdamage</code> amount of <code>hp</code></li> <li>SetDefaultCamera called</li> <li>animstate set to 106</li> <li>z <code>spin</code> set to -15.0</li> <li><code>trail</code> set to true</li> <li><code>Spin3</code> sound plays with 0.9 pitch</li> <li>Over the course of 41.0 frames, this enemy moves to startp + 0.25 in y via a BeizierCurve3 with a ymax of 8.0</li> <li><code>trail</code> set to false</li> <li><code>spin</code> zeroed out</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>SetAnimForce called</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-4-longlegsummoner-equivalent-action","title":"Move 4 - LongLegSummoner equivalent action","text":"<p>A single target attack involving the same effects as the LongLegSummoner action where the target is a player party member.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charge</code> will not get zeroed out in post action. This doesn't effectively do anything because this enemy cannot get <code>charge</code> normally. </p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen null <code>playerdata[playertargetID]</code> after GetSingleTarget 6 Flip<sup>1</sup> empty array <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>data[0]</code> is incremented (amount of times this this move and the support items moves were used)</li> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>LonglegSummoner</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li>The <code>LonglegSummoner</code> sprite gets destroyed</li> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to a new LongLeg coroutine with <code>playerdata[playertargetID]</code> as the target from this enemy which will do similar logic than the player action version</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> <p>Here is what the coroutine ends up doing:</p> <ul> <li>Camera moves slowly towards the target slightly to the left, up and behind</li> <li>animstate set to 28 (<code>TossItem</code>)</li> <li>A new sprite is created rooted using the <code>LonglegSummoner</code> item's sprite positioned at this enemy + (0.25, 2.25, -0.1)</li> <li><code>Toss</code> sound plays</li> <li>Over the course of 51.0 frames, the sprite moves to the target position + (1.5, 0.0, 1.25) via a BeizierCurve3 with a ymax of 5.0. Before each frame yield, the sprite's z angle is increased by 10.0 * MainManager.<code>framestep</code></li> <li>animstate reset to the value before this action</li> <li><code>LongLegsGrow</code> sound plays</li> <li><code>Prefabs/Objects/LongLegs</code> instantiated offscreen with 0.0x scale</li> <li>DeathSmoke particles plays at the sprite position</li> <li>The sprite is destroyed</li> <li>Yield for a frame</li> <li><code>Prefabs/Objects/LongLegs</code> position set to where the sprite was before its destruction</li> <li>Over the course of 31.0 frames, the <code>Prefabs/Objects/LongLegs</code> moves to + 4.75 in y via a SmoothLerp and its scale changes to (1.0, 1.0, -1.0) via a SmoothLerp</li> <li>The <code>Stomp</code> animation clip plays from <code>Prefabs/Objects/LongLegs</code></li> <li><code>Grow1</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>The <code>Stomp2</code> animation clip plays from <code>Prefabs/Objects/LongLegs</code></li> <li><code>longLegsStomp</code> sound plays</li> <li>Yield for 0.15 seconds</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.75 seconds</li> <li>Over the course of 31.0 frames, the <code>Prefabs/Objects/LongLegs</code> moves to - 4.75 in y via a SmoothLerp and its scale changes to 0.0x via a SmoothLerp</li> <li>DeathSmoke particles plays at the <code>Prefabs/Objects/LongLegs</code> position</li> <li><code>ChargeDown2</code> sound plays</li> <li><code>Prefabs/Objects/LongLegs</code> is destroyed</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to null which signals the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-5-heals-stratos-by-6-hp-with-gradualhp","title":"Move 5 - Heals Stratos by 6 <code>hp</code> with GradualHP","text":"<p>Heals Stratos by 6 <code>hp</code> and gives them the GradualHP condition for 3 main turns. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>MiteBurg</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li>Heal called to heal <code>Stratos</code> by 6 <code>hp</code></li> <li>Yield for 0.5 seconds</li> <li><code>Heal3</code> sound plays</li> <li><code>MagicUp</code> particles plays at <code>Stratos</code>'s position</li> <li>ClearStatus called on <code>Stratos</code></li> <li>SetCondition called to inflict the GradualHP condition on <code>Stratos</code> for 3 main turns</li> <li><code>data[3]</code> is set to 2 (the cooldown on the usage of this move and other moves from the support items set)</li> <li>The <code>MiteBurg</code> sprite gets destroyed</li> <li>This enemy animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>data[0]</code> is incremented (amount of times this this move, the LongLegSummoner equivalent action move and other support items moves one were used)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-6-gives-stratos-the-attackup-and-defenseup-conditions","title":"Move 6 - Gives Stratos the AttackUp and DefenseUp conditions","text":"<p>Gives Stratos the AttackUp and DefenseUp conditions for 3 main turns (effectively 2 since the current main turn gets advanced soon). No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>BerryShake</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li>StatusEffect called to inflict the AttackUp condition on <code>Stratos</code> for 3 main turns (effectively 2 since the current main turn advances soon) with effect</li> <li>Yield for 0.5 seconds</li> <li>StatusEffect called to inflict the DefenseUp condition on <code>Stratos</code> for 3 main turns (effectively 2 since the current main turn advances soon) with effect</li> <li><code>data[3]</code> is set to 1 (the cooldown on the usage of this move and other moves from the support items set)</li> <li>The <code>BerryShake</code> sprite gets destroyed</li> <li>This enemy animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>data[0]</code> is incremented (amount of times this this move, the LongLegSummoner equivalent action move and other support items moves one were used)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-7-clearstatus-on-stratos","title":"Move 7 - ClearStatus on Stratos","text":"<p>Cures Stratos's negative conditions with ClearStatus. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_6","title":"Logic sequence","text":"<ul> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>ClearWater</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li><code>Heal3</code> sound plays</li> <li><code>MagicUp</code> particles plays at <code>Stratos</code>'s position</li> <li>ClearStatus called on <code>Stratos</code></li> <li><code>data[3]</code> is set to 1 (the cooldown on the usage of this move and other moves from the support items set)</li> <li>The <code>ClearWater</code> sprite gets destroyed</li> <li>This enemy animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>data[0]</code> is incremented (amount of times this this move, the LongLegSummoner equivalent action move and other support items moves one were used)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-8-increments-stratoss-moreturnnextturn","title":"Move 8 - Increments Stratos's <code>moreturnnextturn</code>","text":"<p>Increments Stratos's <code>moreturnnextturn</code> giving them an additional actor turn on the next main turn. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_7","title":"Logic sequence","text":"<ul> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>HustleSeed</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li><code>Heal3</code> sound plays</li> <li>StatEffect called on <code>Stratos</code> with type 5 (yellow up arrow)</li> <li><code>Stratos</code>'s <code>moreturnnextturn</code> incremented (this will give them an additional actor turn on the next main turn)</li> <li><code>data[3]</code> is set to 1 (the cooldown on the usage of this move and other moves from the support items set)</li> <li>The <code>HustleSeed</code> sprite gets destroyed</li> <li>This enemy animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>data[0]</code> is incremented (amount of times this this move, the LongLegSummoner equivalent action move and other support items moves one were used)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-9-clearbomb-equivalent-action","title":"Move 9 - ClearBomb equivalent action","text":"<p>Does the equivalent of the ClearBomb action which clears every actor's conditions via ClearStatus. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_8","title":"Logic sequence","text":"<ul> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>ClearBomb</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li>The <code>ClearBomb</code> sprite gets destroyed</li> <li><code>Toss</code> sound plays</li> <li><code>Toss4</code> sound plays</li> <li>A new sprite object is created rooted using the <code>ClearBomb</code> item sprite positioned at this enemy position + their (-0.5, 2.0, -0.1)</li> <li>Over the course of 51.0 frames, the <code>ClearBomb</code> sprite moves to Vector3.zero via a BeizierCurve3 with a ymax of 7.0. Before each frame yield, the z angle of the sprite increases by 15.0 * MainManager.<code>framestep</code></li> <li>The <code>ClearBomb</code> sprite gets destroyed</li> <li><code>checkingdead</code> is set to a new ClearBombEffect coroutine which will do the same logic than the player action version</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> <p>Here is what the coroutine ends up doing:</p> <ul> <li><code>IceBreak</code> sound plays at 0.6 volume</li> <li><code>impactsmoke</code> particles plays at Vector3.zero</li> <li>Yield for 0.3 seconds</li> <li><code>impactsmoke</code> particles plays at (-3.0, 0.0, 0.0)</li> <li>Yield for 0.3 seconds</li> <li><code>impactsmoke</code> particles plays at (3.0, 0.0, 0.0)</li> <li>Yield for 0.3 seconds</li> <li>ClearStatus is called on each enemy party members</li> <li>ClearStatus is called on each player party members</li> <li><code>checkingdead</code> is set to null to signal the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-10-heals-15-hp-and-clearstatus-on-themselves-and-stratos","title":"Move 10 - Heals 15 <code>hp</code> and ClearStatus on themselves and Stratos","text":"<p>Heals 15 <code>hp</code> and calls ClearStatus on themselves and Stratos. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_9","title":"Logic sequence","text":"<ul> <li><code>data[0]</code> is incremented (amount of times this this move, the LongLegSummoner equivalent action move and other support items moves one were used)</li> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>KingDinner</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li>Heal called to heal this enemy by 15 <code>hp</code></li> <li>Heal called to heal Stratos by 15 <code>hp</code></li> <li>The <code>KingDinner</code> sprite gets destroyed</li> <li>ClearStatus called on this enemy</li> <li>ClearStatus called on <code>Stratos</code></li> <li>This enemy animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>data[3]</code> is set to 2 (the cooldown on the usage of this move and other moves from the support items set)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#move-11-revives-stratos-with-7-hp","title":"Move 11 - Revives Stratos with 7 <code>hp</code>","text":"<p>Revives Stratos leaving them at 7 <code>hp</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Delilah/#logic-sequence_10","title":"Logic sequence","text":"<ul> <li><code>data[0]</code> is incremented (amount of times this this move, the LongLegSummoner equivalent action move and other support items moves one were used)</li> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>MagicDrops</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li>ReviveEnemy called with <code>reservedata</code> index 0 (<code>Stratos</code>) leaving them with 0.3% of <code>hp</code> with canmove</li> <li>Yield for a frame</li> <li>ShowDamageCounter called with type 1 (HP counter) with an ammount of 7 starting from <code>enemydata[0]</code>'s position (should be <code>Stratos</code>) + 1.0 in y and ending to Vector3.up</li> <li><code>enemydata[0]</code> (<code>Stratos</code>)'s <code>hp</code> is set to 7</li> <li><code>Heal</code> sound plays</li> <li><code>enemydata[0]</code> (<code>Stratos</code>) animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>Stratos</code>'s <code>data[3]</code> is set to 1 which activates the lock on <code>Stratos</code>'s usage of their reviving move and enemy party healing move</li> <li>The <code>MagicDrops</code> sprite gets destroyed</li> <li>This enemy animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>data[3]</code> is set to 2 (the cooldown on the usage of this move and other moves from the support items set)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/","title":"<code>DivingSpider</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: An actor turn cooldown for inflicting themselves the Shield condition in the post move logic. When inflicting themselves the condition in the post move logic, the value is set to 2. It is decremented at the end of the action if it's not 0, but the decrement is at the expense of not being able to inflict themselves the condition so it prevents it. It's only when the value becomes 0 (after 2 completed actor turns) that this enemy can inflict themsevles with the <code>Shield</code> condition again in the post move logic.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the water bubble projectiles throw move, the amount of hits changes to be random between 2 and 3 inclusive instead of being random between 1 and 2 inclusive</li> <li>In the water bubble projectiles throw move, speed of the Projectile call changes to be 27.0 (35.0 if launched with higher height) instead of being 35.0 (42.0 if launched with higher height)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>A multiple targets water bubble projectiles throw</li> </ol> <p>Move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before using a move:</p> <ul> <li>If <code>hologram</code> is true and <code>sprite</code>'s renderQueue isn't 2500:<ul> <li><code>sprite</code>'s renderQueue is set to 2500</li> <li>All Renderer childed to <code>extraanims[0]</code>'s parent's parent (this should be the same as the <code>model</code>) has their renderQueue set to 2500</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#post-move-logic","title":"Post move logic","text":"<p>The following logic is always done after using a move:</p> <ul> <li>If <code>data[0]</code> is 0 (the cooldown on the shield expired):<ul> <li>If a 5/10 RNG check passes:<ul> <li><code>Charge19</code> sound plays</li> <li>animstate set to 100</li> <li>y <code>spin</code> set to 15.0</li> <li>Yield for 0.5 seconds</li> <li>CreateShield called on this enemy which initialises their <code>bubbleshield</code></li> <li><code>Shield</code> sound plays</li> <li><code>bubbleshield</code>'s DialogueAnim's <code>targetscale</code> is set to (3.0, 3.0, 2.0)</li> <li><code>overrideshieldpos</code> set to (0.25, 1.0, 0.0)</li> <li><code>shieldenabled</code> set to true</li> <li>SetCondition called to inflict the Shield condition on this enemy for 2 main turns (effectively 1 main turn as the current main turn ends soon after)</li> <li><code>data[0]</code> set to 2 (meaning this enemy won't be able to get inflicted this condition again until they completed 2 full actor turns)</li> <li>Yield for 0.5 seconds</li> <li><code>spin</code> zeroed out</li> </ul> </li> </ul> </li> <li>Otherwise (the cooldown hasn't expired yet):<ul> <li><code>data[0]</code> is decremented</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#move-1-water-bubbles-projectiles-throw","title":"Move 1 - Water bubbles projectiles throw","text":"<p>A multiple targets water bubble projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 1 to 2 times (2 to 3 times instead if hardmode is true), but the call and further calls won't happen if there's not at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 2 null or Poison determined randomly This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new sprite object rooted using the <code>Sprites/Particles/waterbubble</code> sprite positioned at this enemy + (-1.0, 0.75, -0.1) with a scale of 0.35x and a pure magenta color if propert is <code>Poison</code> One of the 2 chosen randomly with uniform odds check:<ul><li>35.0 (27.0 instead if hardmode is true)</li><li>42.0 (35.0 instead if hardmode is true)</li></ul> 0.0 if using the faster speed, 3.0 if using the slower speed <code>keepcolor</code> <code>WaterSplash</code> (<code>PoisonEffect</code> instead if property is <code>Poison</code>) <code>BubbleBurst</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/DivingSpider/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The amount of hits is determined. It's random between 1 and 2 inclusive (random between 2 and 3 inclusive instead if hardmode is true). An array of SpriteRenderer is initialised with this amount as the length to hold the projectiles objects</li> <li>For each hit to do, if there's still at least one player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li><code>Blosh</code> sound plays</li> <li>animstate set to 100</li> <li>If a 5/10 RNG check passes, the hit will be done with slower speed / higher height and ShakeSprite is called on this enemy for 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>The projectile element is set to a new sprite object rooted using the <code>Sprites/Particles/waterbubble</code> sprite positioned at this enemy + (-1.0, 0.75, -0.1) with a scale of 0.35x and a pure magenta color if propert is <code>Poison</code> (which is determined by a 5/10 RNG check)</li> <li><code>Toss16</code> sound plays</li> <li>Projectile 1 call happens</li> <li>animstate set to 101</li> <li>MainManager.MoveTowards called to move this enemy from its position + 1.0 in x to its position with 10.0 frametime with smooth without caller (done in paralel)</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until all projectiles elements are null (all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/","title":"<code>EverlastingKing</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy is fought alone as otherwise, it would break their artifact summoning logic.</p> <p>It is also assumed this enemy is loaded with <code>SurviveWith10</code> in their weakness as it allows their phase transition logic to work as expected.</p> <p>It is also assumed this enemy's eventondeath to be configured to use the matching EventDialogue as it allows them to die with a mini cutscene and end the battle properly.</p> <p>It is also assumed this enemy is loaded with actimmobile set to true which allows them to cure themseolves of stopping condition.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#fire-damage-infliction-logic-in-calculatebasedamage","title":"Fire damage infliction logic in CalculateBaseDamage","text":"<p>This enemy has a 30% chance to be on fire on a <code>Fire</code> property attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 5 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: A cooldown until this enemy uses the position change to <code>Flying</code> move. If this enemy's <code>position</code> is <code>Ground</code>, the value is decremented before deciding which of the 2 attacking <code>Ground</code> moves to use. If after this decrement, the value becomes -3, this enemy will use the <code>position</code> change move so it will go to <code>Flying</code> which also causes this value to be reset to 0. Effectively, it means that at most, this enemy will remain on <code>Ground</code> for 2 actor turns in a row before using the <code>position</code> change move. NOTE: Since the value is only decremented when their <code>position</code> is <code>Ground</code>, if the player causes them to change to <code>Flying</code>, it freezes this cooldown, but it will still apply the moment this enemy comes back to <code>Ground</code></li> <li><code>data[1]</code>: A value that tracks the last move that was used when this enemy's position was <code>Flying</code>. This is used as an antispam on the fire pillar attack move, the artifact summoning move and the combined KeyL and KeyR attack move. See the move selection process section below for more details on how this is enforced. The value is set in the post move logic so it doesn't track the moves used when on <code>Ground</code> and it also means that the value stays the same as long as <code>position</code> is <code>Ground</code>. Here are the different possible values and their mappings:<ul> <li>0: Vine attack move (<code>Flying</code> version)</li> <li>1: Fire pillar attack move</li> <li>2: Axe throw move</li> <li>3: Artifact summoning move</li> <li>4: Double fireballs throw move</li> <li>5: Combined KeyL and KeyR attack move</li> </ul> </li> <li><code>data[2]</code>: A phase tracker. It can be only one of the following values:<ul> <li>0: The initial state and first phase. It emans this enemy hasn't underwent any phase transition. Once the first phase transition happens when this enemy's <code>hp</code> is 10 or lower in the pre move logic, the value is set to 1</li> <li>1: The second phase. It means this enemy went through the first phase transition. Once the second phase transition when this enemy's <code>hp</code> is 10 or lower in the pre move logic once again, the value is set to 2</li> <li>2: The third and last phase. It means this enemy went through both phase transitions. From now on, this value cannot influence any logic</li> </ul> </li> <li><code>data[3]</code>: A cooldown that when expires, it overrides the <code>Flying</code> move selection process to select the artifact summoning move (but it might not necessarily use it, see the move selection process for details). It has a starting value of 2 on the first main turn. When using the artifact summoning move, the value is set to 3 (which will become 2 by the end of the actor turn due to the post move logic). In the post move logic (meaning it only applies when <code>Flying</code>), the value is decremented if it is above 0. During the <code>Flying</code> move selection process, if the value is 0, the artifact summoning move will always be selected and the value will be set to 2. This can have unexpected interactions with <code>data[4]</code>, see the move selection process for more details. Effectively, if other conditions are satisfied, it means that this enemy will be using the move after 2 actor turns they spent while <code>Flying</code>. NOTE: the value is set to 0 when the first phase transition occurs in the pre move logic and it is reset to 2 when the second phase transition occurs in the pre move logic</li> <li><code>data[4]</code>: A cooldown on the usage of the artifact summoning move. When the move is used, the value is set to 2 when summoning a KeyR or to 3 when summoning a Tablet. In the post move logic (meaning it only applies when <code>Flying</code>), the value is decremented if it is above 0. For the artifact summoning move to be come usable again, the value must be 0 by the time the <code>Flying</code> move selection process happens, even if <code>data[3]</code> reached 0 causing a selection override (see the move selection section below for details on how this can interact with <code>data[3]</code>). Effectively, it means that this enemy needs to spend 1 or 2 actor turns while <code>Flying</code> before being able to use the move again. NOTE: the value is set to 5 when the second phase transition occurs in the pre move logic meaning this enemy will need to spend 5 actor turns while flying before being able to use the move again</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>When summoning any artifact enemies (whether by using the summoning move or as part of the second phase transition), the summoned enemy's <code>cantmove</code> is now decremented meaning they can act immediately on the same main turn they were summoned</li> <li>During the <code>Ground</code> move selection process, the odds of which move to use changes to favor the vine attack move (<code>Ground</code> version)</li> <li>In the vine attack move (<code>Ground</code> version), the move may hit 2 or 3 times instead of only once</li> <li>In the flower bud attack move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the vine attack move (<code>Flying</code> version), the move may hit twice instead of only once</li> <li>In the axe throw move, the amount of frames each axe throw changes to 21.0 frames from 30.0 frames on the first throw and to 17.0 frames from 21.0 frames on the second throw</li> <li>In the double fireballs throw move, the speed of each Projectile calls changes to be random between 22.0 and 28.0 instead of being Random between 29.0 and 35.0</li> <li>In the combined KeyL and KeyR attack move, the damageammount of the DoDamage call changes to 9 from 10</li> </ul> <p>Also, on HARDEST specicifically, this enemy always heals their <code>hp</code> to full on each of the 2 phase transition instead of being a fraction of their <code>maxhp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-selection","title":"Move selection","text":"<p>9 moves are possible:</p> <ol> <li>A single target vine attack (<code>Ground</code> version) that may hit multiple times followed by a 3 <code>hp</code> heal</li> <li>A single target flower bud attack that continuously drains <code>hp</code> followed by a 3 <code>hp</code> heal</li> <li>Changes their position to <code>Flying</code> and gets another actor turn</li> <li>A single target vine attack (<code>Flying</code> version) that may hit multiple times</li> <li>A party wide fire pillar attack</li> <li>A single target axe throw attack that may hit twice</li> <li>Summons an enemy from the artifact family which is composed of KeyL, KeyR and Tablet</li> <li>A multiple targets double fireballs throws</li> <li>A single target attack combining KeyL and KeyR into a laser slash attack</li> </ol> <p>There's 2 move selection process depending on Position: one for <code>Ground</code> and the other for <code>Flying</code> and they affect different moves while functioning mostly independently from each other.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#ground-move-selection-process","title":"<code>Ground</code> move selection process","text":"<p>This selection process only applies to move 1, 2 and 3. Those move are only usable when <code>position</code> is <code>Ground</code>.</p> <p>Move 3 is always (and only) used when <code>data[0]</code> is -3 or lower after a decrement (meaning the countdown to stay on <code>Ground</code> expired). This move is a way to transition to the <code>Flying</code> move selection process since this enemy always gets another actor turn when using that move.</p> <p>As for move 1 and 2, the decision of which move to use is based on odds, but the odds changes depending if hardmode is true or false. Here are the odds in either situations:</p> Move Odds when hardmode is false Odds when hardmode is true 1 40% 60% 2 60% 40%"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#flying-move-selection-process","title":"<code>Flying</code> move selection process","text":"<p>This selection process only applies to move 4, through 9. Those move are only usable when <code>position</code> is <code>Flying</code>.</p> <p>The decision of which move to use is based on odds, but some moves have additional requirements that needs to be fufilled in order for the move to be used once selected. If the requirements aren't fufilled after selecting the move, a continue directive will be issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection process. Here are all the odds and requirements of each moves:</p> Move Odds Requirements 4 3/24 None, the move is always used once selected 5 2/24 <code>data[1]</code> isn't 1 (meaning this move wasn't used on the last actor turn) 6 3/24 None, the move is always used once selected 7 6/24 <ul><li>There's less than 4 <code>enemydata</code></li><li><code>data[1]</code> isn't 3 (meaning this move wasn't used on the last actor turn)</li><li><code>data[4]</code> is 0 (the cooldown on the usage of this move expired)</li></ul> 8 3/24 None, the move is always used once selected 9 7/24 <ul><li><code>data[1]</code> isn't 3 (meaning move 7 wasn't used on the last actor turn)</li><li>A KeyL is present in <code>enemydata</code></li><li>A KeyR is present in <code>enemydata</code></li></ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-7-override-case","title":"Move 7 override case","text":"<p>Move 7 is handled in a special way on top of the table above. It is possible that the initial move selection is overriden to select move 7 if all of the following conditions are fufilled:</p> <ul> <li><code>data[3]</code> is 0 or lower (the countdown to force the usage of move 7 expired)</li> <li>There's less than 4 <code>enemydata</code></li> <li><code>data[1]</code> isn't 3 (move 7 wasn't used on the last actor turn)</li> </ul> <p>When this happens, <code>data[3]</code> is set to 2 and move 7 is always selected. However, this only guarantees the SELECTION of the move: the move is still subject to its requirements in order to actually be used. It means that there's a condition that can still cause the move to be selected like this, but not be used and that is <code>data[4]</code> could still be above 0 (meaning the cooldown on the usage of the move hasn't expired yet), but all other requirements would be met.</p> <p>Since <code>data[4]</code> isn't checked before applying this selectioon override, it's possible the override happens, but the move won't be used and another will be instead due to the continue directive. Since this override case sets <code>data[3]</code> to 2, it can't happen again once the continue directive is issued.</p> <p>Effectively, it means it's possible the move 7 override misses its chance to actually force the usage of the move depending on if <code>data[4]</code> is above 0 or not at the time the override case applies.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#summonartifact","title":"SummonArtifact","text":"<p>There is a coroutine specific to this enemy that is used everytime an artifact enemy needs to be summoned as it involved specialised logic. It is documented here for reference simplicity. It is meant to be set to <code>enemybounce[0]</code> as it will be set to null when the coroutine completed.</p> <pre><code>private IEnumerator SummonArtifact(int calledby, int type, bool hardmode)\n</code></pre>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#parameters","title":"Parameters","text":"<ul> <li><code>calledby</code>: The <code>enemydata</code> index of this enemy</li> <li><code>type</code>: An enemy id that can either be 101 (KeyR), 102 (KeyL) or 103 (Tablet). If the value is -1, it means to randomly select one that isn't present randomly with uniform odds</li> <li><code>hardmode</code>: A way for the method to get the hardmode value</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#procedure","title":"Procedure","text":"<ul> <li>This enemy's <code>enemydata</code> is obtained via calledby</li> <li><code>data[3]</code> is set to 3</li> <li>The enemy id is generated based on the type paramneter described above</li> <li><code>EverLastingKingSummonArtifact</code> sound plays</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 105</li> <li>Based on the enemy that will be summoned, the position of the summon and <code>data[4]</code> value (the cooldown on the usage of the artifact summoning move) are determined:<ul> <li><code>KeyL</code>: summoned at (1.5, 0.0, 0.5) with no <code>data[4]</code> changes</li> <li><code>KeyR</code>: summoned at (5.0, 0.0, -0.85) with <code>data[4]</code> set to 2</li> <li><code>Tablet</code>: summoned at (2.0, 0.0, -0.25) with <code>data[4]</code> set to 3</li> </ul> </li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon the selected enemy at the position determined without cantmove (meaning the enemy will be able to act on the same main turn). As for the type of the summon, it's <code>Offscreen</code> except for the <code>Tablet</code> where it's the <code>Tablet</code> type</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>This enemy animstate set to 106</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>The newly summoned enemy's diebyitself is set to true</li> <li>If hardmode is true, this enemy's <code>cantmove</code> is decremented which grants them an additional actor turn (this is meant to be undone if called from a phase transition)</li> <li><code>enemybounce[0]</code> set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic happens before the usage of any moves. It's in multiple parts done in order.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#position-adjustement","title":"Position adjustement","text":"<p>This part always happen and it causes the <code>position</code> to be set depending on <code>height</code>:</p> <ul> <li>If it's 0.5 or lower, it's set to <code>Ground</code></li> <li>If it's higher than 0.5, it's set to <code>Flying</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#stop-condition-curing","title":"Stop condition curing","text":"<p>This part only happens if this enemy IsStopped with skipimmobile:</p> <ul> <li><code>Charge7</code> sound plays with 0.8 pitch</li> <li>ShakeScreen called with an ammount of 0.1 and 0.5 time with dontreset</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>ClearStatus called on this enemy</li> <li><code>Heal3</code> sound plays</li> <li>Yield for 0.5 seconds </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#hologram-adjustements","title":"<code>hologram</code> adjustements","text":"<p>This part only happens if <code>hologram</code> is true and the only thing that happens is the <code>sprite</code>'s material's renderQueue is set to 2500 which allows the shielding effect to render correctly visually.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#phase-transition","title":"Phase transition","text":"<p>This part only happens if <code>hp</code> is 10 or lower and <code>data[2]</code> is less than 2 (meaning this enemy hasn't gone through both phase transitions yet).</p> <ul> <li>If <code>hologram</code> is false:<ul> <li>Camera moves to look near (this enemy x position, <code>sprite</code> local y position + 0.25, 2.5)</li> <li>Yield for 0.5 seconds</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[175]</code> when <code>data[2]</code> is 0 (first phase) or <code>commondialogue[176]</code> when <code>data[2]</code> is 1 (second phase)</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: This enemy</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>SetDefaultCamera called</li> <li>Yield for 0.25 seconds</li> </ul> </li> <li>animstate set to 100</li> <li>ShakeSprite called with 0.2 intensity and 30.0 frametimer</li> <li><code>Rumble</code> sound plays</li> <li>ShakeScreen called with 0.1 ammount and 2.0 time with dontreset</li> <li>Done in a separate coroutine started in paralel called MainManager.Waves:<ul> <li>A <code>Prefabs/Objects/SphereGlowEffect</code> GameObject is instantiated rooted at this enemy's world CenterPos with a scale of (50.0, 50.0, 1.0) with a pure green color</li> <li>Over the course of 121.0 frames, the scale of <code>Prefabs/Objects/SphereGlowEffect</code> changes to 0.0x via a lerp</li> <li>The <code>Prefabs/Objects/SphereGlowEffect</code> gets destroyed</li> </ul> </li> <li><code>EverLastingKingVine</code> sound plays with 0.8 pitch</li> <li>Yield for a second</li> <li>Yield for a second</li> <li><code>Rumble</code> sound plays</li> <li>The amount of <code>hp</code> to set this enemy is determined:<ul> <li>If flags 614 is true (HARDEST is active), It's all their <code>hp</code></li> <li>If <code>data[2]</code> is 0 (first phase), it's their <code>maxhp</code> * 0.9 floored. The amount is substracted by 5 if their position is <code>Ground</code></li> <li>If <code>data[2]</code> is 0 (first phase), it's their <code>maxhp</code> * 0.75 floored. The amount is substracted by 5 if their position is <code>Ground</code></li> </ul> </li> <li>Heal called to heal this enemy by the determined amount of <code>hp</code>. NOTE: this is technically missleading because it is healing by the set amount - 10, it isn't healing by the amount determined as that's the amount the <code>hp</code> will be SET AT, not the amount HEALED BY</li> <li>If flags 614 is false (HARDEST is inactive), <code>hp</code> is set to the amount determined</li> <li>Yield for 0.5 seconds</li> <li><code>data[3]</code> is set to 0 (the move selection override case is set to happen on this actor turn if all conditions are fufilled)</li> <li>If <code>hologram</code> is false:<ul> <li>Every player party member whose <code>hp</code> is 0 gets revived via RevivePlayer leaving them with 1 <code>hp</code> without showcounter</li> <li>UpdateAnim called</li> <li>Yield for 0.5 seconds</li> <li>If <code>data[2]</code> is 0 (first phase), 2 SetText occurs in dialogue mode in a row (yield all frames until the message lock released after each calls). The first one has <code>playerdata[0]</code> (<code>Bee</code>) as the parent with <code>commondialogue[199]</code> as the text and the second has <code>playerdata[1]</code> (<code>Beetle</code>) as the parent with <code>commondialogue[200]</code> as the text</li> <li>Otherwise (<code>data[2]</code> is 1 which is the second phase), 2 SetText occurs in dialogue mode in a row (yield all frames until the message lock released after each calls). The first one has <code>playerdata[1]</code> (<code>Beetle</code>) as the parent with <code>commondialogue[201]</code> as the text and the second has <code>playerdata[2]</code> (<code>Moth</code>) as the parent with <code>commondialogue[202]</code> as the text</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>If <code>data[2]</code> is 1 (performing the last phase transition):<ul> <li>SetDefaultCamera called</li> <li><code>SurviveWith10</code> is removed from this enemy weakness which makes them vulnerable to be killed</li> <li><code>enemybounce</code> set to a one element Coroutine array</li> <li><code>checkingdead</code> set to a new ChangePosition call to change position to <code>Flying</code></li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>If KeyL isn't present:<ul> <li><code>enemybounce[0]</code> is set to a new SummonArtifact call to summon a new <code>KeyL</code> enemy</li> <li>Yield all frames until <code>enemybounce[0]</code> is null (the coroutine completed)</li> </ul> </li> <li>If KeyR isn't present:<ul> <li><code>enemybounce[0]</code> is set to a new SummonArtifact call to summon a new <code>KeyR</code> enemy</li> <li>Yield all frames until <code>enemybounce[0]</code> is null (the coroutine completed)</li> </ul> </li> <li><code>data[4]</code> is set to 5 (meaning the artifact summoning move won't be usable for the next 5 actor turns spent while <code>Flying</code>)</li> <li><code>cantmove</code> is set to 0 (this undo the actor turn granted by SummonArtifact calls as they are undesired here)</li> <li><code>data[3]</code> is reset to 2</li> </ul> </li> <li><code>data[2]</code> is incremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#post-move-logic","title":"Post move logic","text":"<p>The following logic applies after a move is used, but only if position is <code>Flying</code> meaning it only applies when the <code>Flying</code> move selection process happened and a move was used.</p> <p>If the above requirements are met, the following happens:</p> <ul> <li><code>data[1]</code> is set to a value that tracks the move that was just used. See the <code>data</code> section above for the values mapping</li> <li>If the move that was just used isn't the artifacts summoning move:<ul> <li>If <code>data[3]</code> is above 0, it is decremented (this is the countdown to force the selection of the artifacts summoning move)</li> <li>If <code>data[4]</code> is above 0, it is decremented (this is the cooldown for the usage of the artifacts summoning move)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-1-vine-attack-while-on-ground","title":"Move 1 - Vine attack while on <code>Ground</code>","text":"<p>A single target vine attack (<code>Ground</code> version) that may hit multiple times followed by a 3 <code>hp</code> heal.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0. Done once if hardmode is false, from 2 to 3 times if it is true as long as <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0 This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) 5 on the first hit, 2 on the second hit and 1 on the third hit Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence","title":"Logic sequence","text":"<ul> <li>animstate set to 109</li> <li><code>EverLastingKingVine</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to a new VineAttack coroutine with 5 damageamt, actionid as the callerid with gettarget. The coroutine will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> goes to null</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>SetDefaultCamera called</li> <li>Yield for 0.25 seconds</li> <li>Heal called to heal this enemy by 3 <code>hp</code></li> <li>Yield for 0.5 seconds</li> </ul> <p>This is what the coroutine effectively ends up doing:</p> <ul> <li>GetSingleTarget called</li> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>The amount of hits is determined. It is 1 if hardmode is false and if it's true, it's random between 2 and 3 inclusive</li> <li>An array of <code>Prefabs/Objects/VenusRoot</code> are instantiated with the amount being the amount of hits to do at (<code>playertargetentity</code> x position + a random number between -2.0 and 2.0, -5.0, <code>playertargetentity</code> z position). Each instance is set to LookAt the <code>playertargetentity</code> and has its initial position incremented by (random between -1.0 and 1.0, 0.0, -0.15)</li> <li>An array of Vector3 are instantiated with the amount being the amount of hits to do with each being the normalised direction vector from <code>playertargetentity</code> to the matching <code>Prefabs/Objects/VenusRoot</code> element</li> <li>Yield for 0.75 seconds</li> <li>For each hit:<ul> <li><code>Charge8</code> sound plays</li> <li>The matching <code>Prefabs/Objects/VenusRoot</code> scale is multiplied by 1.65</li> <li>Over the course of 10.0 frames, the matching <code>Prefabs/Objects/VenusRoot</code> position lerps to its position + the matching heading direction vector * 5.0. The first time reaching the 5th frame or later when <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0, DoDamage 1 call happens before the frame yield</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.5 seconds</li> <li>If this is the last hit:<ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>The amount of damage to deal on the next hit becomes half of this one's damage floored then clamped from 1 to 99</li> </ul> </li> <li>Over the course of 60.0 frames, all <code>Prefabs/Objects/VenusRoot</code> instances has ther scale lerped to Vector3.zero</li> <li>Yield for a frame</li> <li>All <code>Prefabs/Objects/VenusRoot</code> instances gets destroyed</li> <li><code>checkingdead</code> set to null which informs the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-2-flower-bud-attack","title":"Move 2 - Flower bud attack","text":"<p>A single target flower bud attack that continuously drains <code>hp</code> followed by a 3 <code>hp</code> heal.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None -1.0 (infinite) TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Called once if <code>barfill</code> is less than 1.0 (not full) during DoCommand 1 once 0.5 seconds passed and then continously called again every 1.0 seconds until either <code>barfill</code> reaches 1.0 (checked 1.0 seconds after each call) or that <code>playerdata[playertargetID]</code>'s <code>hp</code> becomes 0 (checked after each call) This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) 1 Atleast1pierce<sup>1</sup> null false <p>1: Enemy piercing damages are disabled, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code> position</li> <li>animstate set to 109</li> <li>Yield for 0.5 seconds</li> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with 0.05 ammount and -1.0 time (infinite)</li> <li>Yield for 0.5 seconds</li> <li>ShakeScreen called with 0.2 ammount and 0.75 time with dontreset</li> <li>A <code>Prefabs/Objects/OpeningFlowerBud</code> GameObject is instantiated rooted at <code>playertargetentity</code> position - 0.1 in z whose SpriteRenderer has a material of MainManager.<code>spritemat</code> and a scale of 2.0x</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>Spin9</code> sound plays with 0.8 pitch</li> <li><code>DirtExplode</code> particles plays at <code>playertargetentity</code> position</li> <li>The <code>Close</code> animation clip is played on <code>Prefabs/Objects/OpeningFlowerBud</code>'s Animator</li> <li><code>Dig3</code> sound plays</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>Clomp</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>A SpriteBounce is added to the <code>Prefabs/Objects/OpeningFlowerBud</code> with a MessageBounce of 2.0 multiplier and with <code>startscale</code> set to true</li> <li>DoCommand 1 call happens</li> <li><code>infinitecommande</code> set to true which will prevent DoCommand 1 to end when MainManager.<code>mashcommandalt</code> is true until the action command is succeeded</li> <li>CreateHelpBox called with 4 (the TappingKey command's help)</li> <li>As long as <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0 and <code>actionroutine</code> isn't null (meaning DoCommand 1 hasn't ended yet):<ul> <li>Yield for 0.5 seconds</li> <li>If <code>barfill</code> is less than 1.0 (it isn't full yet):<ul> <li>DoDamage 1 call happens</li> <li>If <code>lastdamage</code> is above 0, Heal is called to heal this enemy by <code>lastdamage</code> amount of <code>hp</code></li> </ul> </li> <li>Yield for 0.75 seconds</li> </ul> </li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li><code>Barfill</code> sound stops</li> <li>If <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0:<ul> <li>Their animstate is set to the value it had before this action</li> <li>Jump is called on them</li> </ul> </li> <li>FinishAction is called manually to end DoCommand 1 if it wasn't already (but it should be by then)</li> <li>The <code>Open</code> animation clip is played on <code>Prefabs/Objects/OpeningFlowerBud</code>'s Animator</li> <li><code>CherryBoom</code> particles plays at the <code>playertargetentity</code> position</li> <li>ShakeScreen called with 0.1 ammount and 0.5 time with dontreset</li> <li>MainManager.MoveTowards called to move <code>Prefabs/Objects/OpeningFlowerBud</code> to - 2.0 in y with a 30.0 multiplier without smooth and without local (done in paralel)</li> <li>Yield for 0.5 seconds</li> <li>The <code>Prefabs/Objects/OpeningFlowerBud</code> gets destroyed in 2.0 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>SetDefaultCamera called</li> <li>Yield for 0.25 seconds</li> <li>Heal called to heal this enemy by 3 <code>hp</code></li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-3-changes-position-to-flying-with-another-actor-turn","title":"Move 3 - Changes position to <code>Flying</code> with another actor turn","text":"<p>Changes their position to <code>Flying</code> and gets another actor turn. No damages are dealt, but this enemy always gets another actor turn which may deal damages.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which doesn't affect anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>data[0]</code> is reset to 0 (the cooldown before using this move when position is <code>Ground</code>)</li> <li><code>checkingdead</code> set to a new ChangePosition calle to change the position of this enmey to <code>Flying</code></li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine compelted)</li> <li><code>cantmove</code> is decremented which grants another actor turn to this enemy (it transitions to the <code>Flying</code> move selection process)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-4-vine-attack-while-flying","title":"Move 4 - Vine attack while <code>Flying</code>","text":"<p>A single target vine attack (<code>Flying</code> version) that may hit multiple times.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true_3","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0. Done once if hardmode is false, from 1 to 2 times if it is true as long as <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0 This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) 3 on the first hit, 1 on the second hit (4 on the first hit and 2 on the second hit instead if <code>data[2]</code> is 2 meaning this enemy went through both phase transitions) Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>animstate set to 101</li> <li><code>EverlastingKingVine</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to a new VineAttack coroutine with 3 damageamt (4 instead if <code>data[2]</code> is 2 meaning this enemy went through both phase transitions), actionid as the callerid with gettarget. The coroutine will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> goes to null</li> </ul> <p>This is what the coroutine effectively ends up doing:</p> <ul> <li>GetSingleTarget called</li> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>The amount of hits is determined. It is 1 if hardmode is false and if it's true, it's random between 1 and 2</li> <li>An array of <code>Prefabs/Objects/VenusRoot</code> are instantiated with the amount being the amount of hits to do at (<code>playertargetentity</code> x position + a random number between -2.0 and 2.0, -5.0, <code>playertargetentity</code> z position). Each instance is set to LookAt the <code>playertargetentity</code> and has its initial position incremented by (random between -1.0 and 1.0, 0.0, -0.15)</li> <li>An array of Vector3 are instantiated with the amount being the amount of hits to do with each being the normalised direction vector from <code>playertargetentity</code> to the matching <code>Prefabs/Objects/VenusRoot</code> element</li> <li>Yield for 0.75 seconds</li> <li>For each hit:<ul> <li><code>Charge8</code> sound plays</li> <li>Over the course of 10.0 frames, the matching <code>Prefabs/Objects/VenusRoot</code> position lerps to its position + the matching heading direction vector * 5.0. The first time reaching the 5th frame or later when <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0, DoDamage 1 call happens before the frame yield</li> <li>Yield for 0.5 seconds</li> <li>If this is the last hit:<ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>The amount of damage to deal on the next hit becomes half of this one's damage floored then clamped from 1 to 99</li> </ul> </li> <li>Over the course of 60.0 frames, all <code>Prefabs/Objects/VenusRoot</code> instances has ther scale lerped to Vector3.zero</li> <li>Yield a frame</li> <li>All <code>Prefabs/Objects/VenusRoot</code> instances gets destroyed</li> <li><code>checkingdead</code> set to null which informs the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-5-fire-pillar-attack","title":"Move 5 - Fire pillar attack","text":"<p>A party wide fire pillar attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true_4","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 Fire <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 101</li> <li><code>checkingdead</code> set to a new FirePillar coroutine from this enemy without green</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> <p>Here is what the coroutine ends up doing:</p> <ul> <li>Yield for 0.5 seconds</li> <li><code>FirePillar</code> sound plays</li> <li>A new <code>Prefabs/Objects/FirePillar 1</code> GameObject is instantiated childed to the <code>battlemap</code> at <code>partymiddle</code> with a scale of (0.0, 1.0, 0.0 )and a DialogueAnim with the following:<ul> <li><code>targetscale</code>: (0.75, 1.0, 0.75)</li> <li><code>shrink</code>: false</li> <li><code>shrinkspeed</code>: 0.015</li> </ul> </li> <li>Yield for 0.65 seconds</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>shrinkspeed</code> set to 0.2</li> <li>Yield for 0.2 seconds</li> <li>ShakeScreen called with ammount of 0.25 and 0.75 time</li> <li>PartyDamage 1 call happens</li> <li>Yield for 1.15 seconds</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>targetscale</code> set to (0.0, 1.0, 0.0)</li> <li>All ParticleSystem under <code>Prefabs/Objects/FirePillar 1</code> are stopped</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>shrinkspeed</code> set to 0.05</li> <li><code>Prefabs/Objects/FirePillar 1</code> gets destroyed</li> <li><code>checkingdead</code> is set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-6-axe-throw-attack","title":"Move 6 - Axe throw attack","text":"<p>A single target axe throw attack that may hit twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true_5","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#dodamage-calls_3","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Flip<sup>1</sup> null <code>commandsuccess</code> 2 Happens after DoDamage 1 if the target's <code>hp</code> is still above 0 and either HPPercent is lower than 0.6 or <code>data[2]</code> is 2 (this enemy went through both phase transitions) This enemy The same target as DoDamage 1 3 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li><code>BagRustle</code> sound plays</li> <li>GetSingleTarget called</li> <li>animstate set to 102</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 103</li> <li>A new sprite object is created childed to the <code>battlemap</code> using the <code>Sprites/Entities/waspking2</code> sprite at index 53 (this enemy's axe) positioned at <code>sprite</code> position + (-1.0, 1.0, -0.1)</li> <li>If <code>hologram</code> is true, the <code>Sprites/Entities/waspking2</code> material is set to MainManager.<code>holosprite</code></li> <li><code>WaspKingAxToss</code> sound plays</li> <li>Over the course of 30.0 frames (21.0 frames instead if hardmode is true), the axe moves to <code>playertargetentity</code> position + (0.0, 1.0, -0.1) via a lerp. Before each frame yield, the z angle of the axe increases by 30.0 * MainManager.<code>framestep</code></li> <li>ShakeScreen called with 0.2 ammount and 0.5 time with dontreset</li> <li>DoDamage 1 call happens</li> <li>Over the course of 41.0 frames, the axe moves to <code>sprite</code> position + (-1.0, 1.0, -0.1) via a BeizierCurve3 with a ymax of 5.0. Before each frame yield, the z angle of the axe increases by 20.0 * MainManager.<code>framestep</code>. On the first frame of the second half, if <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0 and either <code>data[2]</code> is 2 (went through both phase transition) or HPPercent is lower than 0.6, the second hit will happen:<ul> <li>animstate set to 101</li> <li>Over the course of 31.0 frames, the z angle of the axe increases by an amount that progressively changes from 0.0 to -30.0 * MainManager.<code>framestep</code> which means it will progressively spin the other way in z</li> <li>Yield for 0.1 seconds</li> <li><code>WaspKingAxSpin</code> sound plays</li> <li>Over the course of 30.0 frames, the z angle of the axe increases by an amount that progressively changes from 0.0 to 60.0 * MainManager.<code>framestep</code> which means it will progressively spin faster in the original way in z</li> <li>Over the course of 21.0 frames (17.0 frames instead if hardmode is true), the axe moves to <code>playertargetentity</code> position + (0.0, 1.0, -0.1) via a lerp. Before each frame yield, the z angle of the axe increases by 30.0 * MainManager.<code>framestep</code></li> <li>ShakeScreen called with 0.2 ammount and 0.5 time with dontreset</li> <li>DoDamage 2 call happens</li> <li>The entire axe movement restarts from frame 0, but the second hit won't happen again</li> </ul> </li> <li><code>WaspKingAxeThrowCatch</code> sound plays</li> <li>The axe object gets destroyed</li> <li>animstate set to 104</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-7-artifact-summon","title":"Move 7 - Artifact summon","text":"<p>Summons an enemy from the artifact family which is composed of KeyL, KeyR and Tablet. No damages are dealt, but it is possible this enemy gets another actor turn which may deal damages.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true_6","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence_6","title":"Logic sequence","text":"<ul> <li><code>enemybounce</code> is set to a new coroutine with 1 element</li> <li><code>enemybounce[0]</code> is set a new SummonArtifact called with type -1 meaning any artifact that isn't currently present will be summoned (determined randomly if multiple aren't present)</li> <li>Yield all frames until <code>enemybounce[0]</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-8-double-fireballs-throws","title":"Move 8 - Double fireballs throws","text":"<p>A multiple targets double fireballs throws.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true_7","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times, but each calls requires that there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 3 Fire This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new <code>Prefabs/Particles/Fireball</code> GameObject childed to the <code>battlemap</code> positioned at this enemy's <code>sprite</code> position + (0.0, 4.0, -0.1) with a scale of 1.0x Random between 29.0 and 35.0 (random between 22.0 and 28.0 instead if hardmode is true) 2.0 <code>SepPart@2@4</code> <code>Fire</code> <code>WaspKingMFireball2</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence_7","title":"Logic sequence","text":"<ul> <li>A new array of 2 transform is initialised which will holds the projectiles objects</li> <li>For each hit (always 2 times), if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li><code>WaspKingMFireball1</code> sound plays</li> <li>animstate set to 107</li> <li>The projectile element is set to a new <code>Prefabs/Particles/Fireball</code> GameObject childed to the <code>battlemap</code> positioned at this enemy's <code>sprite</code> position + (0.0, 4.0, -0.1)</li> <li>Over the course of 36.0 frames, the <code>Prefabs/Particles/Fireball</code>'s scale changes from 0.0x to 1.0x via a lerp</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 103</li> <li><code>WaspKingFireball2</code> sound plays</li> <li>Projectile 1 call happens</li> <li>Yield for a random interval between 0.3 and 0.6 seconds</li> </ul> </li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until all projectile objects are null (all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#move-9-combined-keyl-and-keyr-attack","title":"Move 9 - Combined KeyL and KeyR attack","text":"<p>A single target attack combining KeyL and KeyR into a laser slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#nonphyscal-set-to-true_8","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#dodamage-calls_4","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 10 (9 instead if hardmode is true) Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/EverlastingKing/#logic-sequence_8","title":"Logic sequence","text":"<ul> <li>Camera moves to look near (this enemy x position, 2.75, 1.0)</li> <li>Both KeyL and KeyR present has their <code>inice</code> set to true and their <code>sprite</code> angles reset to Vector3.zero</li> <li>animstate set to 107</li> <li><code>ArtifactSpin</code> sound plays</li> <li>Over the course of 60.0 frames, <code>KeyL</code>'s y <code>spin</code> changes to 30.0 via a lerp over the first 30.0 frames and <code>KeyR</code>'s y <code>spin</code> changes to -30.0 via a lerp over the first 30.0 frames</li> <li>Over the course of 31.0 frames, both <code>KeyL</code> and <code>KeyR</code> moves to this enemy position + (0.0, 6.0, -0.1) - their <code>height</code> in y via a lerp</li> <li><code>ArtifactKey</code> sound plays with 1.2 pitch</li> <li>FadeIn to pure white with 0.2 speed</li> <li>Yield for 0.5 seconds</li> <li>both <code>KeyL</code> and <code>KeyR</code> position set to offscreen at -999.0 in y</li> <li>A new sprite object is created childed to the <code>battlemap</code> using the <code>Sprites/Objects/artifacts</code> sprite at index 7 (a full key with both halves together) positioned at this enemy position + (0.0, 6.0, -0.1)</li> <li>If <code>hologram</code> is true, the key's material is set to MainManager.<code>holosprite</code></li> <li>Yield for a frame</li> <li>FadeOut with 0.2 speed</li> <li>Over the course of 101.0 frames, the key's z angle changes from 2000.0 to 90.0 via a lerp</li> <li>Yield for 0.25 seconds</li> <li>ShakeScreen called with 0.1 ammount and 0.75 time with dontreset</li> <li><code>Lazer2</code> particles plays at Vector3.zero with -1.0 alivetime (infinite) childed to the key with a y angle of 90.0 and a local position of 1.0 in x</li> <li><code>OmegaEye</code> sound plays with 1.2 pitch</li> <li><code>Flash2</code> sound plays with 1.5 pitch</li> <li>Yield for a second</li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>Over the course of 51.0 frames, the key moves to <code>playertargetentity</code> position + (2.0, 3.5, -0.1) via a SmoothLerp and their angles changes to (0.0, 0.0, 65.0) via a LerpVectorAngle</li> <li><code>Charge7</code> sound plays with 1.35 pitch</li> <li>MainMansger.ShakeObject called on the key with 0.2 in x as the shake and 45.0 frametimer with returntostart (done in paralel)</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 101</li> <li><code>Slash3</code> sound plays</li> <li>Over the course of 8.0 frames, the key z angle changes from 65.0 to 300.0 via a lerp. On the first frame after 3.5 frames, DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>SetDefaultCamera called</li> <li>ShakeScreen called with 0.1 ammount and 0.65 time with dontreset</li> <li>The key gets destroyed</li> <li><code>Spin3</code> sound plays with 0.75 pitch</li> <li>Over the course of 51.0 frames, both <code>KeyL</code> and <code>KeyR</code> moves from the position of the key when it was destroyed - the <code>KeyL</code>'s <code>height</code> in y to their respective postion before this action via a BeizierCurve3 with a ymax of 6.0. Also, <code>KeyL</code>'s y <code>spin</code> changes from 30.0 to 0.0 via a lerp and <code>KeyR</code>'s y <code>spin</code> changes to -30.0 to 0.0 via a lerp</li> <li>Both <code>KeyL</code> and <code>KeyR</code> has their <code>inice</code> set to false and their <code>spin</code> zeroed out</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/","title":"<code>FalseMonarch</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the party wide mothflies attack move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the crown throw move, the amount of frames the crown takes to reach its target changes to 19.0 frames from 26.0 frames</li> <li>In the crown throw move, the damageammount of the DoDamage call changes to 5 from 4</li> <li>In the multiple mothflies projectiles throw move, the amount of hits changes to be random from 3 to 5 inclusive instead of being random from 3 to 4 inclusive</li> <li>In the multiple mothflies projectiles throw move, there is now a 40% chance for the property of the Projectile call to be Poison</li> <li>In the multiple mothflies projectiles throw move, the damage amount of the Projectile call changes to 3 from 2</li> <li>In the multiple mothflies projectiles throw move, the speed of the Projectile call changes to 20.0 from 27.0</li> <li>In the 2 MothFly summons move, after the summoning is done, every enemy party members other than this enemy now gets a DefenseUp and an AttackUp conditions for 999999 main turns (effectively infinite)</li> <li>In the 2 MothFly summons move, after the summoning is done, this enemy's <code>cantmove</code> is decremented which gives them an additional actor turn</li> <li>In the charging move, this enemy now gets a DefenseUp condition for 2 main turns (effectively 1 main turn as the current main turn ends soon after)</li> <li>In the close range mothflies attack move, the move always inflicts the AttackDown condition even if <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE) as long as the target doesn't have the Shield or Sturdy condition</li> <li>In the close range mothflies attack move, if the move inflicts the AttackDown condition, it is inflicted for 2 main turns (effectively 1 main turn since the current main turn ends soon after) if <code>commandsuccess</code> is true (blocked, ignores FRAMEONE). It is still inflicted for 3 main turns (effectively 2) if <code>commandsuccess</code> is false. The combined effect with the change above is blocking (ignoring FRAMEONE) now decrease the inflicting main turn count instead of preventing the inflicting entirely</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#move-selection","title":"Move selection","text":"<p>6 moves are possible:</p> <ol> <li>A single target crown throw that may inflict AttackDown</li> <li>A multiple targets mothflies projectiles throw</li> <li>Summons 2 new Mothfly enemies</li> <li>Prepares for a party wide attack next actor turn by setting their <code>charge</code> to 2</li> <li>A single target close range mothflies attack that may inflict AttackDown</li> <li>A party wide mothflies attack</li> </ol> <p>Move 6 is always (and only used) when <code>basestate</code> isn't 0 (<code>Idle</code>) which should means that move 4 was used on the previous actor turn as it sets the <code>basestate</code> away from 0.</p> <p>For the other moves, the decision of which one to use is based on odds, but some moves have an requirement that must be fufilled after being selected. If the move is selected, but the requirement isn't fufilled, a continue directive is issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection process. Here are the odds and requirements:</p> Move Odds Requirement 1 2/12 None, the move is always used when selected 2 3/12 None, the move is always used when selected 3 3/12 This enemy must be the last <code>enemydata</code> remaining 4 2/12 HPPercent must be 0.7 or lower 5 2/12 None, the move is always used when selected"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#move-1-crown-throw","title":"Move 1 - Crown throw","text":"<p>A single target crown throw that may inflict AttackDown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 (5 instead if hardmode is true) null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Toss16</code> sound plays</li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code> + 3.5</li> <li>MoveTowards <code>playertargetentity</code> position + (6.5, 0.0, -0.1) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 105</li> <li>Yield for a random interval between 0.5 and 0.75 seconds</li> <li><code>Toss15</code> sound plays</li> <li>animstate set to 107</li> <li>A new sprite object is created rooted using the <code>projectilepsrites[14]</code> sprite (a yellow crown) at this enemy position + (-0.5, 2.0. -0.1) with a SpinAround that has an <code>itself</code> of (0.0, 0.0, -30.0)</li> <li>If <code>hologram</code> is true, the material of the crown's SpriteRenderer is set to <code>holosprite</code></li> <li>Over the course of 26.0 frames (19.0 frames instead if hardmode is true), the crown moves to <code>playertargetentity</code> position + (0.0, 1.25, -0.1) via a lerp</li> <li><code>MetalHit</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE) and <code>playerdata[playertargetID]</code> doesn't have the Shield or Sturdy condition:<ul> <li>StatusEffect called to inflict the AttackDown condition on <code>playerdata[playertargetID]</code> for 3 main turns (effectively 2 main turns since the current main turn advances soon) with effect</li> </ul> </li> <li>animstate set to 109</li> <li>Over the course of 31.0 frames, the crown moves to this enemy position + (0.0, 2.0, -0.1) via a BeizierCurve3 with a ymax of 4.0</li> <li>animstate set to 110</li> <li>The crown object gets destroyed</li> <li>Yield for 0.25 seconds</li> <li>The local startstate is set to <code>basestate</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#move-2-mothflies-projectiles-throw","title":"Move 2 - Mothflies projectiles throw","text":"<p>A multiple targets mothflies projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 3 to 4 times inclusive determined randomly (3 to 5 times inclusive instead if hardmode is true), but each call can only happens if GetRandomAvaliablePlayer with nullable returns doesn't return -1 2 (3 instead if hardmode is true) null (if hardmode is true, this has 40% chance to be Poison instead) This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) A new <code>Prefabs/Objects/MothflyLite</code> GameObject rooted positioned at this enemy + (0.0, 1.0, -0.1) whose SpriteRenderer uses the <code>holosprite</code> material if <code>hologram</code> is true and with a pure magenta color if the porperty is Poison with a ShadowLite that is SetUp with 0.5 opacity and 0.1 size 27.0 (20.0 instead if hardmode is true) 0.0 <code>keepcolor,wait@0.5,anim@Attack,destoffscr@30@5</code> null null <code>@Toss14</code> Vector3.zero false <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>Toss15</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li><code>Toss16</code> sound plays</li> <li>animstate set to 103</li> <li>Yield for 0.25 seconds</li> <li>The amount of hits is determined which is random between 3 and 4 times (between 3 and 5 times instead if hardmode is true). A new Transform array is initialised with this amount as the length to hold the projectiles objects</li> <li>For each hit to do:<ul> <li>GetRandomAvaliablePlayer with nullable is called and if it doesn't return -1:<ul> <li><code>Toss13</code>sound plays</li> <li>The projectile element is set to a new <code>Prefabs/Objects/MothflyLite</code> GameObject rooted positioned at this enemy + (0.0, 1.0, -0.1) whose SpriteRenderer uses the <code>holosprite</code> material if <code>hologram</code> is true and with a pure magenta color if the porperty is Poison with a ShadowLite that is SetUp with 0.5 opacity and 0.1 size</li> <li>MainManager.MoveTowards is called to move the projectile to Random.insideUnitCircle * 2.0 + 4.0 in y over 20.0 frames with smooth without local (this is done in paralel)</li> <li>Projectile 1 call happens</li> <li>Yield for a random interval between 0.45 and 0.75 seconds</li> </ul> </li> </ul> </li> <li>Yield all frames until all projectiles elements are null (all Projectile 1 calls completed)</li> <li>The local startstate is set to <code>basestate</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#move-3-summons-2-mothfly","title":"Move 3 - Summons 2 Mothfly","text":"<p>Summons 2 new Mothfly enemies. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which doesn't affects anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>Toss10</code> sound plays</li> <li><code>checkingdead</code> set to a new SummonMothFly coroutine (<code>checkingdead</code> is set to null when it completes)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li>If hardmode is true:<ul> <li>SetCondition is called twice on every enemy party members except this enemy to inflict them the DefenseUp and AttackUp conditions for 999999 main turns each (infinite)</li> <li><code>cantmove</code> is decremented on this enemy which grants tham an additional actor turn</li> </ul> </li> <li>The local startstate is set to <code>basestate</code></li> </ul> <p>This is what the SummonMothfly coroutine ends up doing:</p> <ul> <li>Camera moves to look near this enemy, but zoomed in</li> <li>animstate set to 101</li> <li>Yield for 0.65 seconds</li> <li><code>rotater</code> scale increased by 30%</li> <li>Done 2 times:<ul> <li>AddNewEnemy called to a new Mothfly enemy at this enemy + (0.0, <code>height</code>, 0.1)</li> <li>Yield a frame</li> <li>The <code>enemydata[lastaddedid]</code> gets some adjustements:<ul> <li><code>maxhp</code> and <code>hp</code>: divided by 2 floored</li> <li><code>exp</code>: 0</li> <li><code>money</code>: 0</li> <li>y <code>spin</code>: 20.0</li> </ul> </li> </ul> </li> <li>Over the course of 31.0 frames, <code>rotater</code> scale changes to its original value before this coroutine via a lerp and the 2 new enemies that were just summoned moves from this enemy position to (<code>x</code>, 0.0, -0.1) via a BeizierCurve3 with a ymax of 4.0 where <code>x</code> is this enemy x position - 2.5 for the first enemy and this enemy x position + 2.5 for the second enemy</li> <li><code>rotater</code> scale is set to its value before this coroutine</li> <li>Both enemies who were just summoned has their <code>spin</code> zeroed out</li> <li><code>checkingdead</code> is set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#move-4-prepares-attack-with-2-charge","title":"Move 4 - Prepares attack with 2 <code>charge</code>","text":"<p>Prepares for a party wide attack next actor turn by setting their <code>charge</code> to 2. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#nonphyscal-set-to-true_3","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which doesn't affects anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>Charge19</code> sound plays</li> <li>animstate set to 111</li> <li>Camera moves to look near this enemy</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li>If hardmode is true, SetCondition is called to inflict the DefenseUp condition on this enemy for 2 main turns (effectively 1 main turn due to the current main turn advancing soon)</li> <li><code>StatUp</code> sound plays</li> <li><code>charge</code> set to 2</li> <li>Yield for 0.5 seconds</li> <li><code>basestate</code> set to 111 which allows this enemy to use the party wide mothflies attack move on their next actor turn</li> <li>The local startstate is set to <code>basestate</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#move-5-close-range-mothflies-attack","title":"Move 5 - Close range mothflies attack","text":"<p>A single target close range mothflies attack that may inflict AttackDown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#nonphyscal-set-to-true_4","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 (5 instead if hardmode is true) null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Toss15</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for a random interval between 0.25 and 0.5 seconds</li> <li>animstate set to 101</li> <li><code>MothflyATK</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li><code>MothflyAttack</code> particles plays at this enemy position + (-0.25, 1.0, -0.1) with 5.0 alivetime</li> <li>DoDamage 1 call happens</li> <li>If hardmode is true or <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE) and <code>playerdata[playertargetID]</code> doesn't have the Shield or Sturdy condition:<ul> <li>StatusEffect called to inflict the AttackDown condition on <code>playerdata[playertargetID]</code> for 3 main turns (2 main turns instead if hardmode and <code>commandsuccess</code> are true) with effect. This is effectively 1 main turns less because the current main turn will be advanced soon</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>The local startstate is set to <code>basestate</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#move-6-party-wide-mothflies-attack","title":"Move 6 - Party wide mothflies attack","text":"<p>A party wide mothflies attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#nonphyscal-set-to-true_5","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 5 (3 instead if <code>barfill</code> is higher than 0.95 after DoCommand 1 meaning the bar got almost filled up) null true if <code>barfill</code> is higher than 0.95 after DoCommand 1 meaning the bar got almost filled up, false otherwise 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/FalseMonarch/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li>MoveTowards (0.5, 0.0, 0.0) with 2.0 multiplier</li> <li>Camera moves to look near the midpoint between (0.5, 0.0, 0.0) and <code>partymiddle</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Toss15</code> sound plays</li> <li>animstate set to 100</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 101</li> <li><code>MothflyLong</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li>A new <code>Prefabs/Particles/MothflyAttack</code> GameObject is instantiated rooted at this enemy position + (-0.25, 1.0, -0.1) with its ParticleSystem's MainModule getting some adjustements:<ul> <li>loop: true</li> <li>simulationSpace: World</li> <li>startLifetime: 2.5</li> <li>startSpeed: A constant curve with value 7.0</li> <li>gravityModifier: A constant curve with value 0.0</li> </ul> </li> <li>CreateHelpBox called with 4 (the TappingKey command's help)</li> <li>DoCommand 1 call happens</li> <li>All player party member who isn't stopped has their y <code>spin</code> set to 15.0</li> <li>Yield all frames until <code>doingaction</code> goes to false (DoCommand 1 is done). Before each frame yield, all player party member whose <code>hp</code> is above 0 has their animstate set to 11 (<code>Hurt</code>) (but if <code>blockcooldown</code> is above 0 meaning a block was done, it's set to 24 (<code>Block</code>) instead)</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>All player party member has their <code>spin</code> getting zeroed out</li> <li>PartyDamage 1 call happens</li> <li>The <code>Prefabs/Particles/MothflyAttack</code> object gets moved offscreen at -9999.0 in y then destroyed in 5.0 seconds</li> <li>Yield for 0.5 seconds</li> <li><code>basestate</code> set to 0 (<code>Idle</code>) so this move isn't used on the next actor turn</li> <li>The local startstate is set to <code>basestate</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/","title":"<code>Fisherman</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: An actor turn cooldown for the delayed projectile move. The value is set to 2 when the move is used and it is always decremented in the post move logic if it's still above 0. The delayed projectile move requires that the value is 0 or below for the move to be used. Effectively, it's an antispam of 1 full actor turn where the delayed projectile move can't be used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the spear dash attack move, the odds to perform a loop before moving towards the target changes to 40% from 30%</li> <li>In the spear dash attack move, if a loop will be done before moving towards the target, it is now possible if a 50% RNG check passes for this eneny to jump twice instead of once at the start of the move</li> <li>In the spear dash attack move, if no loop will be done before moving towards the target, the amount of frames this enemy takes to move to its target changes to 14.0 frames from 19.0 frames</li> <li>In the delayed projectile move, the framespeed of the AddDelayedProjectile call changes to 35.0 from 48.0</li> <li>When using the delayed projectile move, the spear dash attack is now performed immediately after on the same actor turn</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target spear slash attack</li> <li>A single target spear dash attack</li> <li>Adds a delayed projectile that can inflict a bad condition which may be followed up by performing move 1</li> </ol> <p>If this enemy has the Inked, move 1 is always used.</p> <p>Otherwise, the decision of which move to use is based on the following odds:</p> Move Odds 1 3/11 2 3/11 3 5 <p>However, if move 3 is selected and <code>data[0]</code> is above 0 (meaning to cooldown on it hasn't expired yet), move 2 is used instead.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen after using a move:</p> <ul> <li>If <code>data[0]</code> is above 0, it is decremented.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#move-1-spear-slash-attack","title":"Move 1 - Spear slash attack","text":"<p>A single target spear slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#basicattack-calls","title":"BasicAttack calls","text":"# Conditions enemyid walkstate attackstate attackstate2 damage offset property shake delay sounds dontgettarget 1 Always happen This enemy 1 (<code>Walk</code>) 100 101 4 (2.0, 0.0, -0.1) Ink 0.0 Random interval between 0.5 and 0.65 seconds <code>,RuffianKickSwing</code> false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to the BasicAttack 1 call</li> <li>Yield all frames until <code>checkingdead</code> is null (the BasicAttack 1 call completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#move-2-spear-dash-attack","title":"Move 2 - Spear dash attack","text":"<p>A single target spear dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Ink null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>The decision of whether or not to loop or not is determined. It will be done if a 30% RNG check passes (40% instead if hardmode is true)</li> <li>If we decided to loop, the amount of jumps to do is determined. It's 1, but if hardmode is true and a 50% RNG check passes, it's 2</li> <li>If we decided to loop, for each jump to do:<ul> <li><code>Jump</code> sound plays</li> <li>Jump called on this enemy with an h of <code>jumpheight</code> / 1.5</li> <li>Yield for 0.1 seconds</li> <li>Yield all frames until this enemy is <code>onground</code></li> </ul> </li> <li>Otherwise (decided to not loop):<ul> <li><code>Charge7</code> sound plays</li> <li>ShakeSprite called with 0.3 intensity and 30.0 frametimer</li> <li>Over the course of 31.0 frames, this enemy moves to + 2.0 in x via a lerp</li> </ul> </li> <li><code>trail</code> set to true</li> <li>If we decided to loop:<ul> <li>Over the course of 11.0 frames, this enemy moves to the result of a lerp from <code>playertargetentity</code> to startp with a factor of 0.75 (meaning 25% of the distance towards <code>playertargetentity</code>) via a lerp</li> </ul> </li> <li>Otherwise (decided to not loop):<ul> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>Toss12</code> sound plays</li> <li>Over the course of 19.0 frames (14.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position + (2.0, 0.0, -0.1) via a lerp</li> </ul> </li> <li>If we decided to loop it is performed like the following:<ul> <li><code>Spin3</code> sound plays with 0.9 pitch</li> <li>Over the course of 31.0 frames:<ul> <li>This enemy x position goes from its existing one to BeizierFloat of -5.0 on the first half (will smoothly decrease up to 2.5 than back to no decrease) then on the second half, it will go from the existing one to BeizierFloat of 5.0 (will smoothly increase up to 2.5 than back to no increase). Basically, it will cycle to - 2.5 then back to the starting value halfway then + 2.5 then back to the starting value at the end</li> <li>This enemy y position goes from its existing one to BeizierFloat of 10.0 (will smoothly increase to 5.0 than back to no increase)</li> <li>This enemy z angle changes from 360.0 to 0.0 via a lerp</li> </ul> </li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>Over the course of 11.0 frames, this enemy moves to <code>playertargetentity</code> + (2.0, 0.0, -0.1) via a lerp</li> </ul> </li> <li>DoDamage 1 call happens</li> <li>Over the course of 31.0 frames, this enemy moves to + 1.5 in x via a BeizierCurve3 with a ymax of 4.0</li> <li><code>trail</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#move-3-adds-a-delayed-projectile","title":"Move 3 - Adds a delayed projectile","text":"<p>Adds a delayed projectile that can inflict a bad condition which may be followed up by performing move 1. No damages are dealt for this move, but if move 1 is performed, that move will deal damages.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1<sup>*</sup> Always happen A new <code>Prefabs/Objects/BombCart</code> GameObject is instantiated childed to the <code>battlemap</code> at startp + Random.insideUnitCircle * 2.5 with a y of -2.0 with a scale of 0.0x with <code>Diggin</code> particles child playing infintely. The first child's <code>sprite</code> is an item sprite that depends on the property:<ul><li>null: <code>SpicyBomb</code></li><li>Sleep: <code>SleepBomb</code></li><li>Numb: <code>NumbBomb</code></li><li>Freeze: <code>FrostBomb</code></li><li>Poison: <code>PoisonBomb</code></li><li>InkOnBlock: <code>HoneyDrop</code> with a color of 400040 (dark purple)</li></ul> <code>playertargetID</code> Depends on the property:<ul><li>3 if property is null</li><li>2 otherwise</li></ul> 2 0 Determined randomly with the following odds:<ul><li>1/7: null</li><li>1/7: Sleep</li><li>1/7: Numb</li><li>1/7: Freeze</li><li>1/7: Poison</li><li>2/7: InkOnBlock</li></ul> 48.0 (35.0 instead if hardmode is true) This enemy Depends on the property:<ul><li>null: <code>Explosion</code></li><li>Sleep: <code>Charge</code></li><li>Numb: <code>Charge19</code></li><li>Freeze: <code>IceMelt</code></li><li>Poison: <code>ChargeDown2</code></li><li>InkOnBlock: <code>WaterSplash2</code></li></ul> Depends on the property:<ul><li>null: <code>explosionsmall</code></li><li>Sleep: <code>deathsmoke</code></li><li>Numb: <code>ElecFast</code></li><li>Freeze: <code>mothicenormal</code></li><li>Poison: <code>PoisonEffect</code></li><li>InkOnBlock: <code>InkGet</code></li></ul> <code>Digging@Down</code> <p>*: The <code>delproj</code> gets the following args: <code>move,0,-0.5,0@noshadow@partoff,0,0.5,0@partoff,0,1,0</code></p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Fisherman/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>MoveTowards startp + Random.insideUnitCircle * 2.5 with a y component of 0.0 using 2.0 multiplier</li> <li>Camera moves to look near the point this enemy is moving towards</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>A new <code>Prefabs/Objects/BombCart</code> GameObject is instantiated childed to the <code>battlemap</code> at this enemy position - 2.0 in y</li> <li>animstate set to 102</li> <li>The effects of the delayed projectile is determined here (see the AddDelayedProjectile table above for details)</li> <li>If the effect of the delayed projectile won't be with <code>InkOnBlock</code> property, the <code>Prefabs/Objects/BombCart</code>'s first child's <code>sprite</code> is set to the corresponding item sprite of the effect</li> <li>Otherwise, the <code>Prefabs/Objects/BombCart</code>'s first child's <code>sprite</code> is set to a <code>HoneyDrop</code> item sprite with a color of 400040 (dark purple)</li> <li>Yield for 0.5 seconds</li> <li><code>Dig2</code> sound plays with 1.1 pitch</li> <li>Yield for 31.0 frames counted locally</li> <li><code>Digging</code> particles plays at this enemy position + (-0.25, 0.0, -0.1) with -1.0 alivetime (infinite)</li> <li>Yield for 0.5 seconds</li> <li>Over the course of 11.0 frames, <code>Prefabs/Objects/BombCart</code>'s scale changes to Vector3.zero via a lerp</li> <li>The <code>Digging</code> particles gets childed to <code>Prefabs/Objects/BombCart</code></li> <li>The <code>Digging</code> particles has their scale set to 1.0x</li> <li>AddDelayedProjectile 1 call happens</li> <li>The <code>delproj</code> that was just added has its <code>args</code> set to <code>move,0,-0.5,0@noshadow@partoff,0,0.5,0@partoff,0,1,0</code></li> <li>animstate set to 103</li> <li>Yield for 0.5 seconds</li> <li><code>data[0]</code> is set to 2 (meaning this move can't be used on the next actor turn, but it will become usable in 2 actor turns)</li> <li>If hardmode is true, the spear dash attack move is performed immediately without ending the actor turn</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/","title":"<code>Flowering</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#enemycheck-special-logic","title":"EnemyCheck special logic","text":"<p>Before this enemy is loaded, it's possible that StartBattle overrides it to a <code>GoldenSeedling</code>. See the documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the enemy support move, when healing the enemy, the minimum amount of <code>hp</code> they will be healed by is 3 instead of 2</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#move-selection","title":"Move selection","text":"<p>3 move are possible:</p> <ol> <li>Supports another enemy party member by either healing their <code>hp</code> or inflicting them an AttackUp or DefenseUp condition</li> <li>A single target aerial strike attack</li> <li>A single target tackle attack, UNUSED</li> </ol> <p>Move 1 is always used if all the following conditions are fufilled:</p> <ul> <li>position is <code>Flying</code> (this should always be the case due to the pre move logic always setting it to <code>Flying</code>)</li> <li>This enemy isn't the only enemy party member left</li> <li>If there's exactly 2 enemy party members, the other enemy party member isn't another <code>Flowering</code></li> </ul> <p>If any of the above aren't fufilled, Move 2 is used instead.</p> <p>Move 3 is never used under normal gameplay, but remains functional. This is because this move requires the position to not be <code>Flying</code>, but the pre move logic will always set it to <code>Flying</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done at the start of the actor turn if position isn't <code>Flying</code>:</p> <ul> <li><code>checkingdead</code> is set to a new ChangePosition call to set the position to <code>Flying</code> (<code>checkingdead</code> set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#move-1-enemy-support","title":"Move 1 - Enemy support","text":"<p>Supports another enemy party member by either healing them or inflicting them an AttackUp or DefenseUp condition. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#logic-sequence","title":"Logic sequence","text":"<ul> <li>An enemy party member other than this enemy is searched to see if any has their HPPercent less than 0.6. If any exists, the first one will be selected for healing. Otherwise, a condition infliction will happen on a random enemy party member other than this enemy</li> <li><code>Toss2</code> sound plays on loop using <code>sounds[9]</code> with 1.1 pitch and 0.5 volume using PlayMoveSound</li> <li>Camera moves to look near the targeted enemy party member</li> <li>ForceMove called to move to the targetted enemy party member's position + their <code>cursoroffset</code> + (0.0, 0.25, -0.1) with 60.0 frametime using 1 (<code>Walk</code>) as movestate and 0 (<code>Idle</code>) as stopstate</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li>y <code>spin</code> set to 10.0</li> <li><code>Charge14</code> sound plays</li> <li><code>Prefabs/Particles/FloweringHeal</code> particles instantiated rooted positioned at this enemy + their <code>height</code> in y</li> <li>Yield for 0.85 seconds</li> <li>If healing the enemy party member:<ul> <li>Heal is called to heal the enemy party member with an <code>hp</code> amount of their <code>maxhp</code> * 0.075 clamped from 2 to their <code>maxhp</code> (clamped from 3 to their <code>maxhp</code> instead if hardmode is true)</li> </ul> </li> <li>Otherwise (inflicting a condition on the enemy party member):<ul> <li><code>StatUp</code> sound plays</li> <li>If a 6/10 RNG check passes:<ul> <li>StatEffect is called on the target enemy party member with type 0 (red up arrow)</li> <li>SetCondition called to inflict the AttackUp condition on the target enemy party member for 2 main turns</li> </ul> </li> <li>Otherwise (4/10 RNG):<ul> <li>StatEffect is called on the target enemy party member with type 1 (blue up arrow)</li> <li>SetCondition called to inflict the DefenseUp condition on the target enemy party member for 2 main turns</li> </ul> </li> </ul> </li> <li>Yield for 0.75 seconds</li> <li><code>Prefabs/Particles/FloweringHeal</code> particles moved offscreen at -9999.0 in y then gets destroyed in 2.0 seconds</li> <li><code>spin</code> zeroed out</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#move-2-aerial-strike-attack","title":"Move 2 - Aerial strike attack","text":"<p>A single target aerial strike attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 1 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code>, but zoomed in</li> <li><code>Toss2</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code> with pitch 1.1 and volume 0.5</li> <li>MoveTowards <code>playerdata[playertargetID]</code> + (2.0, 0.0, -0.15) with 1.5 multiplier and stopstate 100</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li><code>height</code> set to 0.0</li> <li>y position set to the <code>height</code> value before this action</li> <li>animstate set to 100</li> <li><code>FastWoosh</code> sound plays</li> <li>Over the course of 1 / 0.055 frames (~18.181818 frames), position moves to its current position + 0.75 in x via a BeizierCurve3 with a ymax of -0.01</li> <li>animstate set to 101</li> <li>Yield for 0.2 seconds</li> <li>animstate set to 100</li> <li><code>Turn2</code> sound plays</li> <li>Over the course of 1 / 0.07 frames (~14.285714 frames), position lerps to <code>playerdata[playertargetID]</code> position + (0.0, 1.0, -0.1)</li> <li>DoDamage call 1 happens</li> <li>Yield for 0.15 seconds</li> <li><code>height</code> set to 0.2</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 1 / 0.045 frames (~22.22222 frames), position lerps to its position before the BeizierCurve3 movement earlier</li> <li>y position is set to 0.0</li> <li><code>height</code> is restored to its value before this action</li> <li>Yield for 0.2 seconds</li> <li><code>bobrange</code> reset to <code>startbf</code></li> <li><code>bobspeed</code> reset to <code>startbs</code></li> <li>FlipAngle called with setangle</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#move-3-tackle-attack-unused","title":"Move 3 - Tackle attack, UNUSED","text":"<p>A single target tackle attack.</p> <p>NOTE: This move is practically UNUSED, see the move selection section above for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Flowering/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to new coroutine called SeedlingTackle which will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li>FlipAngle called with setangle</li> </ul> <p>This is what the coroutine effectively does:</p> <ul> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Done 2 times:<ul> <li>Jump called</li> <li><code>Jump</code> sound plays with 0.75 pitch and 1.6 volume</li> <li>Yield for 0.1 seconds</li> <li>Yield all frames until <code>onground</code> goes to true</li> <li>Yield a frame</li> </ul> </li> <li>CameraFocusTarget called</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 3.0 in x with a 2.0 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Yield for 0.2 seconds</li> <li><code>Spin10</code> sound plays</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + (0.35, 0.0, -0.1) with a 2.5 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>DoDamage 1 call happens</li> <li>Jump called</li> <li><code>flip</code> set to false (with <code>overrideflip</code>)</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 2.0 in x with a 0.75 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> is set to false</li> <li><code>checkingdead</code> set to null indicating the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/","title":"<code>FlyTrap</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The AttackUp or DefenseUp infliction move on a MotherChomper has its RNG check odds changed to 41% from 34%</li> <li>The biting attack move has its RNG check odds changed to 65% from 75%</li> <li>Due to the biting attack move change, the enemy spawn move usage odds changes to 35% from 25%, but the RNG check for whether to actually spawn the enemy also changes to 7.5/10.0 from 5.0/10.0 bringing the overall odds to 26.25% from 12.5% to spawn a new enemy</li> <li>If an attempt was made to spawn a new enemy and either the RNG check failed or no suitable location could be found, this enemy will do a biting attack instead of ending their actor turns immediately after</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#move-selection","title":"Move selection","text":"<p>3 moves are possible as well as the possibility of doing none of them:</p> <ol> <li>Inflicts AttackUp or DefenseUp on a MotherChomper enemy party member</li> <li>A single target bite attack that may drain <code>hp</code></li> <li>Summon another <code>FlyTrap</code> enemy</li> </ol> <p>All moves don't just have base odds: they all are selected based on multiple conditions.</p> <p>Move 1 can only be used and will always be used if all of the following conditions are fufilled:</p> <ul> <li>A MotherChomper enemy party member is present (the first one will be selected)</li> <li>A 34% RNG check passes (41% instead if hardmode is true)</li> <li>The found MotherChomper enemy party member doesn't already have the AttackUp or DefenseUp conditions</li> </ul> <p>As for move 2, it will be used if any of the following conditions are fufilled:</p> <ul> <li>A failed attempt at using move 3 just occured on the same actor turn and hardmode is true</li> <li>There are 4 enemy party members (a full enemy party)</li> <li><code>locktri</code> is true (meaning this is an enemy that was spawned from another <code>FlyTrap</code>)</li> <li>A 75% RNG check passes (65% instead if hardmode is true)</li> </ul> <p>If neither move 1 or 2 are used, move 3 will be attempted to be used. It is however possible that the attempt to use the move fails if any of the following conditions occurs:</p> <ul> <li>No suitable location was found to spawn the new enemy after trying to generate one 20 times in a row</li> <li>An RNG check fails and it has 5.0/10.0 chance to pass (7.5/10.0 instead if hardmode is true)</li> </ul> <p>If neither of the fail conditions happens, move 3 will be used. If any happens however, what happens next depends if hardmode is true or not. If it's true, move 2 will be used instead, but if it's false, the actor turn ends meaning it is possible the enemy doesn't end up using any moves for their actor turn.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#move-1-boost-on-a-motherchomper","title":"Move 1 - Boost on a MotherChomper","text":"<p>Inflicts AttackUp or DefenseUp on a MotherChomper enemy party member. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The first MotherChomper enemy party member index is obtained</li> <li>MoveTowards near <code>MotherChomper</code> at 2.0 multiplier with 23 (<code>Chase</code>) walkstate and 0 (<code>Idle</code>) stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Done 3 times:<ul> <li><code>flip</code> set to true except on the last iteration where it's set to false</li> <li>Jump called</li> <li><code>Jump</code> sound plays</li> <li>Yield for 0.3 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> </ul> </li> <li><code>Spin8</code> sound plays</li> <li><code>flip</code> set to false</li> <li>y <code>spin</code> set to 25.0</li> <li>Jump called with an h of <code>jumpheight</code> * 1.5</li> <li>For the next 60.0 frames, <code>spin</code> is zeroed out whenever 15.0 frames passed and <code>onground</code> is true</li> <li><code>StatUp</code> sound plays</li> <li>SetCondition called to inflict AttackUp or DefenseUp on the <code>MotherChomper</code> enemy party member for 2 main turns. The odds to inflict <code>AttackUp</code> are 6/10 while it's 4/10 to inflict <code>DefenseUp</code></li> <li>Yield for 0.6 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#move-2-bite-attack","title":"Move 2 - Bite attack","text":"<p>A single target bite attack that may drain <code>hp</code></p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 (1 instead if <code>locktri</code> is true meaning this enemy was spawned from another <code>FlyTrap</code>) null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li><code>Scuttle3</code> sound plays on this enemy on loop</li> <li>MoveTowards <code>playertargetentity</code> position + (0.85, 0.0, -0.1) with a 2.5 multiplier using 23 (<code>Chase</code>) as walkstate and 100 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Sucttle3</code> sound stops looping</li> <li><code>Chew</code> sound plays</li> <li>Yield for 0.33 seconds</li> <li>animstate set to 102</li> <li><code>Bite</code> sound plays</li> <li>Yield for 0.05 seconds</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE):<ul> <li><code>hp</code> is increased by <code>lastdamage</code> * 0.75 ceiled then clamped from 0 to <code>maxhp</code></li> <li>ShowDamageCounter called with type 1 (HP counter) starting at this enemy + Vector3.up and ending at this enemy + 3.0 in y</li> <li><code>Heal</code> sound plays</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>SetDefaultCamera called</li> <li>MoveTowards startp at 2.5 multiplier with 23 (<code>Chase</code>) walkstate and 0 (<code>Idle</code>) stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#move-3-flytrap-summon","title":"Move 3 - <code>FlyTrap</code> summon","text":"<p>Summon another <code>FlyTrap</code> enemy. No damages are dealt.</p> <p>It is possible that attempting this move fails which results in the actor turn ending when hardmode is false or move 2 (bite attack) being used instead when hardmode is true.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/FlyTrap/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>Done 3 times:<ul> <li><code>flip</code> is toggled</li> <li><code>FlipNoise3</code> sound plays</li> <li>Jump called</li> <li>Yield for 0.15 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> <li>Yield a frame</li> </ul> </li> <li><code>Spin8</code> sound plays</li> <li><code>flip</code> set to false</li> <li>y <code>spin</code> set to 25.0</li> <li>Jump called with an h of <code>jumpheight</code> * 1.5</li> <li>A new sprite object is created rooted at this enemy position + 2.0 in y using the <code>ChomperSeed</code> item sprite on the same layer than this enemy</li> <li>A Vector3 is attempted to be generated that will corresponds to the position to spawn the new enemy. Each attempt may fail, but up to 20 attempts will be done and the first one that fufills some conditions will be used. Each attempts generates a vector where the x component is between 0.25 and 7.6, the y component is 0.0 and the z component is between -0.75 and 0.75. For the location to be accepted, any enemy part member needs to be located at a distance less than its <code>size</code> * 1.8. If no suitable locations is found after 20 attempts, the logic will proceed assuming the last one generated (but the spawning won't happen later)</li> <li>Over the course of 60.0 frames, the <code>ChomperSeed</code> sprite moves to the generated position via a BeizierCurve3 with a ymax of 6.0. Before each frame yield, the z angles increases by 20x the game's frametime. If it's been more than 15.0 frames while <code>onground</code> is true, <code>spin</code> is zeroed out</li> <li><code>spin</code> is zeroed out again</li> <li>DeathSmoke particles plays at the <code>ChomperSeed</code> sprite</li> <li>Yield a frame</li> <li>The <code>ChomperSeed</code> sprite is destroyed</li> <li><code>Woosh3</code> sound plays</li> <li>If the Vector3 was accepted earlier and a 5.0/10.0 RNG test passes (7.5/10.0 instead if hardmode is true), the spawning will occur:<ul> <li>AddNewEnemy called to add another <code>FlyTrap</code> enemy at the generated location with the <code>SeedMini</code> animation</li> <li>Yield a frame</li> <li>Yield all frames until <code>checkingdead</code> is null (the enemy summon is complete)</li> <li>The new <code>FlyTrap</code> has several fields adjustements:<ul> <li><code>cantmove</code>: 1 (can only act starting next main turn)</li> <li><code>cursoroffset</code>: increased by (0.1, -0.5, 0.0)</li> <li><code>hp</code>: The <code>hp</code> of the last <code>enemydata</code> * 0.75 floored</li> <li><code>maxhp</code>: The <code>maxhp</code> of the last <code>enemydata</code> * 0.75 floored</li> <li><code>locktri</code>: true (prevents this enemy from using this move so recursive summons aren't possible)</li> <li><code>def</code>: 0 (this cancels the effects of HARDEST being active and applicable)</li> <li><code>exp</code>: halved floored</li> <li><code>money</code>: halved floored</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>Otherwise (the spawning failed or the RNG check failed):<ul> <li><code>Fail</code> sound plays at 0.5 volume</li> <li>Yield for 0.5 seconds</li> <li>If hardmode is true, move 2 (biting attack) is used</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/","title":"<code>GoldenSeedling</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#hitaction-support-unused","title":"hitaction support, UNUSED","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves.</p> <p>NOTE: While this enemy technically supports <code>hitaction</code>, under normal gameplay, it is assumed to not be possible for this enemy to be in a <code>hitaction</code>, but the logic still exists and is functional.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#logic-sequence","title":"Logic sequence","text":"<ul> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Emoticon called with type 2 (red ! mark) with a time of 35</li> <li><code>Wam</code> sound plays</li> <li><code>checkingdead</code> set to a new Dig call on this enemy which changes its position to <code>Underground</code> (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target tackle attack</li> <li>A single target headbonk attack</li> <li>Flees the battle</li> <li>A single target undergound strike attack, UNUSED move</li> </ol> <p>Move 4 is always used (and can only be used) when position is <code>Underground</code>.</p> <p>NOTE: As explained in the <code>hitaction</code> section above, it's not possible for this enemy to be <code>Underground</code> because it's not possible for this enemy to do a <code>hitaction</code>. Nonetheless, the move exists and is functional.</p> <p>Move 3 usage is always considered first and it is used if all of the following conditions are fufilled:</p> <ul> <li>The enemy party isn't doing a firststrike</li> <li>This enemy doesn't have the Taunted condition</li> <li>A 49% RNG check passes</li> </ul> <p>If move 3 isn't used, move 1 or 2 is used and their usage is based on these odds:</p> Move Odds 1 51% 2 49%"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#move-1-tackle-attack","title":"Move 1 - Tackle attack","text":"<p>A single target tackle attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 7 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>If this enemy has the Taunted condition, their <code>charge</code> is set to 3</li> <li><code>checkingdead</code> is set to new coroutine called SeedlingTackle which will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the coroutine effectively does:</p> <ul> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Done 2 times:<ul> <li>Jump called</li> <li><code>Jump</code> sound plays with 0.75 pitch and 1.6 volume</li> <li>Yield for 0.1 seconds</li> <li>Yield all frames until <code>onground</code> goes to true</li> <li>Yield a frame</li> </ul> </li> <li>CameraFocusTarget called</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 3.0 in x with a 2.0 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Yield for 0.2 seconds</li> <li><code>Spin10</code> sound plays</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + (0.35, 0.0, -0.1) with a 2.5 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>DoDamage 1 call happens</li> <li>Jump called</li> <li><code>flip</code> set to false (with <code>overrideflip</code>)</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 2.0 in x with a 0.75 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> is set to false</li> <li><code>checkingdead</code> set to null indicating the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#move-2-headbonk-attack","title":"Move 2 - Headbonk attack","text":"<p>A single target headbonk attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 8 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>If this enemy has the Taunted condition, their <code>charge</code> is set to 3</li> <li><code>checkingdead</code> set to a new SeedlingHeadbonk coroutine with 2 damage, actionid as the attacker id, no property and without skipwalk. This coroutine sets <code>checkingdead</code> to null when completed</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>Here is what SeedlingHeadbonk effectively does with those parameters:</p> <ul> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.2) with a multiplier of 2.0</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Jump</code> sound plays</li> <li>Jump called</li> <li>Yield for 0.3 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> <li>Camera moves to look near <code>playertargetID</code></li> <li>Yield a frame</li> <li>animstate set to 100</li> <li><code>Turn</code> sound plays</li> <li>Over the course of 35.0 frames (but visually occurs as if it was 32.0 frames with the last 3 being padding), this enemy moves to <code>playertargetentity</code> position + (0.25, 2.8, -0.1) via a BeizierCurve3 with a ymax of 5.5 while the z angle gets a LerpAngle done to 180.0</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.1 seconds</li> <li><code>sprite</code> angles zeroed out</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li><code>Turn2</code> sound plays</li> <li>Over the course of 25.0 frames, this enemy moves to its current position + 2.0 in x with the y being 0.0 via a BeizierCurve3 with a ymax of 3.0</li> <li><code>checkingdead</code> is set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#move-3-flee","title":"Move 3 - Flee","text":"<p>Flees the battle. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>tryenemyheal</code> set to a new EnemyFlee coroutine to make this enemy flee the battle with 23 (<code>Chase</code>) walkstate and with afterimage (<code>tryenemyheal</code> set to null when completed)</li> <li>Yield all frames until <code>tryenemyheal</code> is null</li> <li>The local fled is set to true which changes what to do in the post-action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#move-4-undergound-strike-attack-unused","title":"Move 4 - Undergound strike attack, UNUSED","text":"<p>A single target undergound strike attack. position is set to <code>Ground</code> after.</p> <p>NOTE: This move can't be used under normal gameplay, but its logic remains functional. See the move selection section for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#about-incorrect-poison-property-logic","title":"About incorrect Poison property logic","text":"<p>While the DoDamage call features a <code>Pierce</code> property, the move ends up doing an incorrect version of the <code>Poison</code> property logic due to the single property shortcoming. Here are the differences:</p> <ul> <li>On FRAMEONE, regular blocking will incorrectly prevent the condition from being inflicted which doesn't happen normally</li> <li>The amount of turns to inflict is 3 instead of 2</li> <li>The Sturdy condition on the target won't prevent the condition to be inflicted when it normally would have</li> <li>The <code>StatusMirror</code> medal does nothing when equipped on the target when it should have inflicted the condition back to this enemy</li> <li>The <code>PoisonTouch</code> medal won't work despite the attack being physical</li> <li>The condition infliction can still happen if the target has the Numb while having the <code>ShockTrooper</code> medal equipped</li> <li>The <code>Poison</code> sound is not played when it should have been</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/GoldenSeedling/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to a new UndergroundStrike coroutine with 2 damage from this enemy with a poison property without staying underground</li> <li>Yield all frames until <code>checkingdead</code> goes to null (the coroutine is done)</li> </ul> <p>This is effectively what the coroutine does:</p> <ul> <li>Camera moves to look near <code>playerdata[playertargetID]</code>, but zoomed in</li> <li><code>Digging</code> sound plays on loop using <code>sounds[9]</code> with 1.1 pitch and 0.75 volume</li> <li>Over the course of 100.0 frames, position moves to <code>playertargetentity</code>'s position + -0.25 in z</li> <li>Yield for 0.25 seconds</li> <li><code>sounds[9]</code> stopped</li> <li><code>DigPop</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>If all of the following conditions are fufilled, SetCondition is called to inflict the Poison condition to <code>playerdata[playertargetID]</code> for 3 main turns (NOTE: this has a lot of caveats, see the section above for details):<ul> <li><code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE)</li> <li><code>playerdata[playertargetID]</code>'s <code>poisonres</code> is less than 100 (it's not immune)</li> <li>A <code>poisonres</code> resistance check passes</li> <li><code>playerdata[playertargetID]</code> doesn't have the Shield condition</li> </ul> </li> <li>y <code>spin</code> set to 20.0</li> <li><code>digging</code> set to false</li> <li>scale reset to <code>startscale</code></li> <li><code>DirtExplodeLight</code> particle plays at this enemy position</li> <li>ShakeScreen with 0.15 ammount and 0.2 time</li> <li>Over the course of 50.0 frames, position moves to <code>playertargetentity</code> + 2.0 in x using a BeizierCurve3 with a ymax of 6.0</li> <li><code>spin</code> zeroed out</li> <li>position set to <code>Ground</code></li> <li>Yield for 0.25 seconds</li> <li><code>checkingdead</code> set to null to signal DoAction that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/IceWall/","title":"<code>IceWall</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/IceWall/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>Decrements their <code>hp</code> and dies if it reaches 0 after</li> </ol> <p>Move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/IceWall/#move-1-hp-decrements","title":"Move 1 - <code>hp</code> decrements","text":"<p>Decrements their <code>hp</code> and dies if it reaches 0 after. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/IceWall/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>hp</code> is decremented</li> <li>If <code>hp</code> is 0 or below, StartDeath is called on this enemy which sets their <code>deathroutine</code> to a new Death calle with activatekill</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/","title":"<code>Ironclad</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the projectile beam, the projectile takes 1 / 0.04 frames (25 frames) for the projectile to move to its target instead of 1 / 0.03 frames (~33.3333333334 frames)</li> <li>In the dash attack move, the amount of frames this enemy takes to reach its target changes to 13.0 frames from 20.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A multiple targets projectile beams</li> <li>Prepares for a bigger attach on their next actor turn by setting their <code>charge</code> to 2 and gaining the DefenseUp condition</li> <li>A single target dash attack</li> </ol> <p>Move 3 is always (and only used) if <code>basestate</code> isn't 0 (<code>Idle</code>) meaning move 2 was used on their last actor turn as it sets the <code>basestate</code> away from 0.</p> <p>As for the other 2 moves, the decision of which move to use is based on the following odds:</p> Move Odds 1 3/5 2 2/5"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#move-1-projectile-beam","title":"Move 1 - Projectile beam","text":"<p>A multiple targets projectile beams.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times, but each calls requires that at least one player party member is alive (<code>hp</code> above 0 and not eatenby) 3 Sleep This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new GameObject rooted with a SpriteRenderer using the <code>projectilepsrites[4]</code> sprite (a bolt projectile) 0.03 (~33.33333334 frames of movement) if hardmode is false, 0.04 if it's true (25 frames of movement) 0.0 <code>keepcolor</code> <code>deathsmokelow</code> null null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> is set to new coroutine called SnailBeam which will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the coroutine effectively does:</p> <ul> <li>Done 2 times:<ul> <li>If there's at least one player party member is alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code> position</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 101</li> <li><code>Lazer</code> sound plays</li> <li>The projectile GameObject is created rooted with position being this enemy position + (-1.5, 1.5, -0.1), angles of 90.0 in z, scale of (0.5, 0.5, 0.5), sprite of <code>projectilepsrites[4]</code> sprite (a bolt projectile) and magenta color (the color is ignored because of the <code>keepcolor</code> argument sent to Projectile)</li> <li>Projectile call 1 happens</li> <li>Yield a random interval between 0.45 and 0.6 seconds</li> </ul> </li> </ul> </li> <li>Yield all frames until the projectile is null (it was destroyed meaning Projectile is done)</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to null informing the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#move-2-prepares-a-bigger-attack-with-2-charge-and-defenseup","title":"Move 2 - Prepares a bigger attack with 2 <code>charge</code> and DefenseUp","text":"<p>Prepares for a bigger attach on their next actor turn by setting their <code>charge</code> to 2 and gaining the DefenseUp condition. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>Camera moves to look near this enemy</li> <li><code>Charge7</code> sound plays</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li>StatEffect called on this enmey with type 4 (green up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enmey with type 1 (blue up arrow)</li> <li>Yield for 0.5 seconds</li> <li><code>basestate</code> and the local startstate are set to 103 which allows this enemy to use the dash attack on their next actor turn</li> <li><code>charge</code> set to 2</li> <li>SetCondition called to inflict the DefenseUp condition on this enemy for 2 main turns (effectively 1 main turn since the current main turn advances soon enough)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#move-3-dash-attack","title":"Move 3 - Dash attack","text":"<p>A single target dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ironclad/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code> position</li> <li>ShakeSprite called with 0.1 intensity and 45.0 frametimer</li> <li>MainManager.MoveTowards + 1.0 in x with 30.0 frametime with smooth without local (done in paralel)</li> <li><code>Charge7</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li><code>MothflyATK</code> sound plays</li> <li><code>trail</code> set to true</li> <li>Over the course of 20.0 frames (13.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> + (1.0, 0.0, -0.1) via a lerp</li> <li>ShakeScreen called with 0.15 ammount and 0.5 time with dontreset</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE):<ul> <li>SetDefaultCamera called</li> <li>Jump called on <code>playertargetentity</code></li> <li>SlowSpinStop called on <code>playertargetentity</code> with a spinammount of 50.0 in y and 30.0 frametime</li> <li>Over the course of 21.0 frames, this enemy moves to (-15.0, 0.0, 0.0) via a lerp</li> <li>Over the course of 41.0 frames, this enemy moves from (15.0, 0.0, 0.0) to startp via a lerp</li> </ul> </li> <li>Otherwise (blocked, ignores FRAMEONE):<ul> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 51.0 frames, this enemy moves to its position + (2.0, 0.0, -0.1) via a BeizierCurve3 with a ymax of 3.0</li> </ul> </li> <li><code>trail</code> set to false</li> <li>The local startstate and <code>basestate</code> set to 0 (<code>Idle</code>) which prevents this move to be used on the next actor turn</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/","title":"<code>JumpingSpider</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The move selection odds changes to favor the high jump attack where it becomes 40% chance to be used from 25%</li> <li>In the small jump attack move, the amount of frames this enemy takes to reach its target changes to 41.0 frames from 48.0</li> <li>In the high jump attack move, the amount of frames this enemy takes to reach its target changes to 66.0 frames from 81.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target small jump attack that may steal a standard item</li> <li>A single target high jump attack</li> </ol> <p>The decision of which move to use depends on these odds which changes depending on hardmode:</p> Move Odds when hardmode is false Odds when hardmode is true 1 75% 25% 2 60% 40%"},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/#move-1-small-jump-attack","title":"Move 1 - Small jump attack","text":"<p>A single target small jump attack that may steal a standard item.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget</li> <li>Camove moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (3.0, 0.0, -0.1) with a walkstate of 23 (<code>Chase</code>) and a stopstate of 0 (<code>Idle</code>)</li> <li>Yield all frames until <code>forcemove</code> is done and <code>onground</code></li> <li><code>Turn</code> sound plays</li> <li>Over the course of 48.0 frames (41.0 frames instead if hardmode is true), thie enemy moves to <code>playertargetentity</code> position + (-0.25, 1.5, -0.1) via a BeizierCurve3 with a ymax of 5.0. Before each frame yield, the animstate is set to 2 (<code>Jump</code>) except for the second half of the movement where it's set to 3 (<code>Fall</code>)</li> <li>DoDamage 1 call happens</li> <li>If <code>playerdata[playertargetID]</code> doesn't have the Shield condition, StealItem is called from this enemy without always and with noanim</li> <li>UpdateAnimSpecific called on this enemy</li> <li><code>Turn2</code> sound plays</li> <li>Over the course of 41.0 frames, this enemy moves to <code>playertargetentity</code> position + (2.0, 0.0, -0.1) via a BeizierCurve3 with a ymax of 3.0</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/#move-2-high-jump-attack","title":"Move 2 - High jump attack","text":"<p>A single target high jump attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 5 null BlockSoundOnly <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/JumpingSpider/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget</li> <li>Camove moves to look near the midpoint between this enemy and <code>playerdata[playertargetID]</code></li> <li>ShakeSprite called with an intensity of 0.15 and frametimer of 45.0</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li><code>BMCharge</code> sound plays with 1.2 pitch</li> <li>Over the course of 46.0 frames, the <code>rotater</code> scale is set to increase by 15% in x and decreased by 35% in y via a lerp</li> <li>animstate set to 2 (<code>Jump</code>)</li> <li>y <code>spin</code> set to 30.0</li> <li><code>rotater</code> scale set to its value before this action</li> <li><code>Turn</code> sound plays with 0.75 pitch</li> <li>Over the course of 81.0 frames (66.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position + (0.25, 2.0, -0.1) via a BeizierCurve3 with a ymax of 15.0. Before each frame yield on the second half of the movement, animstate is set to 3 (<code>Fall</code>) and after 75% of the movement, the camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>spin</code> zeroed out</li> <li>ShakeScreen called with an ammount of 0.2 and time of 0.75 with dontreset</li> <li>DoDamage 1 called</li> <li><code>BigHit</code> sound plays</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position + 0.65 in y</li> <li>Over the course of 41.0 frames, this enemy moves to <code>playertargetentity</code> position + (2.0, 0.0, -0.1) via a BeizierCurve3 with a ymax of 3.0</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/","title":"<code>Kali</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#assumptions","title":"Assumptions","text":"<p>It is assumed that there is a Beetle in the enemy party alongside this enemey. For the most part, everything this enemy does is related to <code>Beetle</code> so they are meant to be fought together. If multiple <code>Beetle</code> exists, the first occurence will be addressed.</p> <p>It is also assumed that this enemy has an <code>eventondeath</code> set to the proper EventDialogue because this EventDialogue will allow <code>Beetle</code> to die with this enemy.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: This remains at 0 until the first time that the Beetle revive move is used where it is set to 1. When it is 1, the SetText call portion of the move at the start will not be used so it essentially enforces that it only happens once per battle, but the revival will still occur no matter what when the move is used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>Heals 5 <code>hp</code> to Beetle</li> <li>Inflicts the DefenseUp condition to Beetle</li> <li>Inflicts the AttackUp condition to Beetle</li> <li>Sets Beetle's <code>charge</code> to 2</li> <li>Revives Beetle leaving them with 33.5% floored of their <code>hp</code></li> </ol> <p>Move 5 is always used (and only used) when this is the last <code>enemydata</code> left and <code>reservedata</code> is not empty.</p> <p>Move 1 through 4's usage all requires that <code>Beetle</code> is present in the enemy party (this should be guaranteed since if they weren't, they would normally be revived by move 5). If he is present, the move usage decision is done based on the following odds:</p> Move Odds 1 1/6 2 2/6 3 2/6 4 1/6 <p>However, move 1 will not be used if <code>Beetle</code>'s HPPercent is 0.9 or higher. If the move is selected and fails this requirement, move 2 is used instead</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#move-1-heals-beetle","title":"Move 1 - Heals Beetle","text":"<p>Heals 5 <code>hp</code> to Beetle. No damages are dealt</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The enemy party member of <code>Beetle</code> is obtained</li> <li><code>Magic</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for a second</li> <li>Heal called to heal <code>Beetle</code> for 5 of its <code>hp</code></li> <li>Yield for a second</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#move-2-inflicts-defenseup-to-beetle","title":"Move 2 - Inflicts DefenseUp to Beetle","text":"<p>Inflicts the DefenseUp condition to Beetle for 2 main turns (effectively 1 main turns since the current main turn advances soon enough). No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>The enemy party member of <code>Beetle</code> is obtained</li> <li><code>Magic</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for a second</li> <li><code>StatUp</code> sound plays</li> <li>SetCondition called to inflict the DefenseUp condition on <code>Beetle</code> for 2 main turns (effectively 1 main turns since the current main turn advances soon enough)</li> <li>StatEffect called on <code>Beetle</code> with type 1 (blue up arrow)</li> <li>Yield for a second</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#move-3-inflicts-attackup-to-beetle","title":"Move 3 - Inflicts AttackUp to Beetle","text":"<p>Inflicts the AttackUp condition to Beetle for 2 main turns (effectively 1 main turns since the current main turn advances soon enough). No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>The enemy party member of <code>Beetle</code> is obtained</li> <li><code>Magic</code> sound plays</li> <li>animstate set to 101</li> <li>Yield for a second</li> <li><code>StatUp</code> sound plays</li> <li>SetCondition called to inflict the AttackUp condition on <code>Beetle</code> for 2 main turns (effectively 1 main turns since the current main turn advances soon enough)</li> <li>StatEffect called on <code>Beetle</code> with type 0 (red up arrow)</li> <li>Yield for a second</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#move-4-sets-beetles-charge-to-2","title":"Move 4 - Sets Beetle's <code>charge</code> to 2","text":"<p>Sets Beetle's <code>charge</code> to 2. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>The enemy party member of <code>Beetle</code> is obtained</li> <li><code>Magic</code> sound plays</li> <li>animstate set to 101</li> <li>Yield for a second</li> <li><code>StatUp</code> sound plays</li> <li><code>Beetle</code>'s <code>charge</code> is set to 2</li> <li>StatEffect called on <code>Beetle</code> with type 4 (green up arrow)</li> <li>Yield for a second</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#move-5-revives-beetle","title":"Move 5 - Revives Beetle","text":"<p>Revives Beetle leaving them with 33.5% floored of their <code>hp</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kali/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>If <code>data[0]</code> is 0 (this portion of the move wasn't done before in the battle):<ul> <li>Yield for 0.5 seconds</li> <li><code>data[0]</code> is set to 1</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[159]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: This enemy</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>animstate set to 102</li> <li>Yield for 0.66 seconds</li> <li><code>HealBreath</code> sound plays</li> <li><code>HealSmoke</code> particles plays at this enemy position + (-1.0, 1.5, -0.1) with an alivetime of 5.0</li> <li>Yield for 0.5 seconds</li> <li>The first <code>reservedata</code> is obtained which should always be <code>Beetle</code></li> <li>Yield all frames until <code>Beetle</code>'s <code>deathroutine</code> is null (meaning it completed as it is possible it isn't fully done)</li> <li><code>Beetle</code> has ShakeSprite called on them with intensity of 0.1 and frametimer of 30.0</li> <li>Yield for 0.5 seconds</li> <li><code>Beetle</code> has Jump called on them</li> <li>ReviveEnemy called to revive reserveid 0 (should be <code>Beetle</code>) with an hppercent of 0.335 without canmove</li> <li>Yield for a frame</li> <li>ShowDamageCounter called to show an amount of 1 <code>hp</code> starting at <code>Beetle</code> position + 1.0 in y and ending at <code>Beetle</code> position + 2.0 in y. NOTE: While it shows 1, the real amount healed is percentage based and it is possible that 33.5% floored is higher than 1</li> <li><code>Heal</code> sound plays</li> <li>Yield all frames until <code>Beetle</code> is <code>onground</code></li> <li><code>Beetle</code>'s <code>exp</code> is set to 0 (avoids gaining double the <code>exp</code> by killing them again)</li> <li><code>Beetle</code> animstate set to 13 (<code>BattleIdle</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/","title":"<code>KeyR</code> and <code>KeyL</code>","text":"<p>NOTE: Both <code>KeyR</code> and <code>KeyL</code>, while different enemies, they share the exact same action logic so they are documented together.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#fire-damage-infliction-logic-in-calculatebasedamage","title":"Fire damage infliction logic in CalculateBaseDamage","text":"<p>This enemy cannot be on fire meaning any <code>Fire</code> property damages will not inflict the Fire condition.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#hpbaronother-special-logic","title":"HPBarOnOther special logic","text":"<p>This enemy has special logic in a method called HPBarOnOther which is used by RefreshEnemyHP to know if the <code>hpbar</code> should be shown despite this enemy not being spied yet. It returns true if EverlastingKing was spied which is needed because it's not possible under normal gameplay to spy this enemy, but it is possible to spy <code>EverlastingKing</code>. This means that this logic allows this enemy's <code>hpbar</code> to be displayed by spying <code>EverlastingKing</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the aerial spinning strike move, the ForceMove call's frametime before the DoDamage call changes to 17.0 from 23.5</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target laser attack</li> <li>A single target aerial spinning strike</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 49% 2 51%"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before using a move if position is <code>Ground</code> to change it to <code>Flying</code>:</p> <ul> <li>Over the course of 31.0 frames, <code>height</code> changes from <code>minheight</code> to <code>initialheight</code> via a lerp</li> <li>position is set to <code>Flying</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#move-1-laser-attack","title":"Move 1 - Laser attack","text":"<p>A single target laser attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>walkstate</code> set to 0 (<code>Idle</code>)</li> <li><code>bobspeed</code> set to 0.0</li> <li>MoveTowards <code>playertargetentity</code> position + (3.0, 0.0, -0.1) with a 3.0 multiplier using 100 as the walkstate and stopstate</li> <li>Camera moves to look near the midpoint between <code>playertargetentity</code> and <code>forcetarget</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li>A new <code>Prefabs/Particles/Charging</code> GameObject is instantiated childed to the <code>sprite</code> with a local position of -1.0 in y and a z angle of -45.0</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>Shot</code> sound plays</li> <li><code>Prefabs/Particles/Charging</code>'s position set to offscreen at 999.0 in y then destroyed in 5.0 seconds</li> <li><code>Lazer</code> particles plays at this enemy position with -1.0 alivetime then gets childed to the <code>sprite</code> with a local position of -1.0 in y and a x angle of 90.0</li> <li>DoDamage 1 call happens</li> <li>Over the course of 41.0 frames, the <code>Lazer</code> particles x and y scale changes to 0.0 via a lerp</li> <li><code>Lazer</code> particles gets destroyed</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>bobspeed</code> set to the value before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#move-2-aerial-spinning-strike","title":"Move 2 - Aerial spinning strike","text":"<p>A single target aerial spinning strike.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/KeyR%20and%20KeyL/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>walkstate</code> set to 0 (<code>Idle</code>)</li> <li><code>bobspeed</code> set to 0.0</li> <li><code>Spin</code> sound plays on loop using <code>sounds[9]</code></li> <li>animstate set to 100</li> <li><code>sprite</code> z angle set to -70.0</li> <li>y <code>spin</code> set to 30.0</li> <li>ForceMove called on this enemy to move them to + 1.5 in x with 30.0 framtime without changeanim</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li>Yield for 0.25 seconds</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>trail</code> set to true</li> <li><code>sounds[9]</code> stopped</li> <li><code>Shot2</code> sound plays</li> <li>ForceMove called on this enemy to move them to <code>playertargetentity</code> position + (0.25, 1.0 - <code>height</code>, -0.1) with 23.5 framtime (17.0 instead if hardmode is true) without changeanim</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li>DoDamage 1 call happens</li> <li>SetDefaultCamera called</li> <li><code>trail</code> set to false</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li><code>spin</code> set to (0.0, 0.0, 30.0)</li> <li>Over the course of 41.0 frames, this enemy moves to startp via a BeizierCurve3 with a ymax of 6.0</li> <li><code>spin</code> zeroed out</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>bobspeed</code> set to the value before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/","title":"<code>Kina</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#assumptions","title":"Assumptions","text":"<p>This enemy is assumed to be fought with Maki for the move selection to function otherwise, unexpected logic will occur.</p> <p>It is also assumed that the DeathType of the enemy supports the <code>reservedata</code> feature as it is needed by Maki in case they want to revive this enemy.</p> <p>It is also assumed that this enemy is loaded with a chargeonotherenemy configured so their <code>hitaction</code> logic works (typically it would be set to Maki).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>After loading this enemy, the following special adjustements happens to them if flags 614 is true (HARDEST is active):</p> <ul> <li><code>maxhp</code> and <code>hp</code> gets increased by 10</li> <li><code>def</code> gets incremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: This tells if this enemy should receive an infinite AttackUp condition. The value becomes 1 on the first actor turn's pre move logic or <code>hitaction</code> that Maki isn't found in <code>enemydata</code>. When the value is 1 at the end of the pre move logic, it allows this enemy to receive an infinite AttackUp condition if they didn't had it already</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the projectiles throw move, the odds that the property of each Projectile calls is Poison, Sleep or Numb changes to 50% from 70%</li> <li>In the projectiles throw move, the speed of each Projectile call changes to 12.0 from 19.0</li> <li>In the jump kick attack move, the amount of frames this enemy takes to reach its target changes to 21.0 from 28.0. However, after this, there is always a yield of 0.1 seconds regardless if hardmode is true or not before the DoDamage call</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>The <code>hitaction</code> logic always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of Maki is obtained if they are present</li> <li>If <code>Maki</code> is present in <code>enemydata</code>:<ul> <li><code>Wam</code> sound plays</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote for 45 time</li> <li>animstate set to 5 (<code>Angry</code>)</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>If <code>charge</code> is less than 3:<ul> <li><code>charge</code> is incremented</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>Yield for 0.5 seconds</li> </ul> </li> </ul> </li> <li>Otherwise (<code>Maki</code> isn't present), if <code>data[0]</code> is 0 (meaning their absence wasn't noticed before):<ul> <li>animstate set to 5 (<code>Angry</code>)</li> <li>Done 2 times:<ul> <li>Jump called on this enemy</li> <li><code>Jump</code> sound plays with 1.2 pitch</li> <li>Yield for 0.25 seconds</li> <li>Yield all frames until this enemy is <code>onground</code></li> </ul> </li> <li><code>data[0]</code> is set to 1 (indicating that it was found that <code>Maki</code> died which means on the next actor turn, this enemy will get an infinite AttackUp condition in the pre move logic)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A multiple targets projectiles throw with varying effects</li> <li>A single target jump kick attack</li> <li>Heals Maki by 6 <code>hp</code> and inflicts them the GradualHP condition</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 3/9 2 4/9 3 2/9 <p>However, if move 3 is selected and Maki is either not present or their HPPercent is above 0.7, a continue directive is issued to the enemy action loop which restarts the entire action. Effectively, this will reroll the move selection process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before a move is used:</p> <ul> <li>The <code>enemydata</code> index of Maki is obtained if they are present</li> <li>If <code>Maki</code> isn't present and <code>data[0]</code> is 0 (meaning their absence wasn't noticed before):<ul> <li>animstate set to 5 (<code>Angry</code>)</li> <li>Done 2 times:<ul> <li>Jump called on this enemy</li> <li><code>Jump</code> sound plays with 1.2 pitch</li> <li>Yield for 0.25 seconds</li> <li>Yield all frames until this enemy is <code>onground</code></li> </ul> </li> <li><code>data[0]</code> is set to 1 (indicating that it was found that <code>Maki</code> died)</li> </ul> </li> <li>If <code>data[0]</code> is 1 (it was found that <code>Maki</code> died just now or in a previous <code>hitaction</code>) and this enemy doesn't have the AttackUp condition, an infinite one will be inflicted with the following:<ul> <li><code>Charge7</code> sound plays</li> <li>ShakeSprite called with 0.1 intensity and 45.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>StatusEffect called to inflict the AttackUp condition on this enemy for 999999 main turns (infinite) with effect</li> <li>Yield for 0.5 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#move-1-projectiles-throw","title":"Move 1 - Projectiles throw","text":"<p>A multiple targets projectiles throw with varying effects.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 to 4 times determined randomly, but each calls requires that there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 2 null, but there is a 70% chance (50% instead if hardmode is true) that the property is determined randomly among the following with uniform odds:<ul><li>Poison</li><li>Sleep</li><li>Numb</li></ul> This enemy <code>playertargetID</code> after GetSingleTarget A new sprite object childed to the <code>battlemap</code> using the <code>projectilepsrites[12]</code> sprite (purple pointy projectile) positioned at this enemy + (-1.5, 1.5, -0.1) with a scale of 0.6x and a z angle of -90.0. The color depends on the property:<ul><li>Poison: pure magenta</li><li>Sleep: pure green</li><li>Numb: pure yellow</li></ul> 19.0 (12.0 instead if hardmode is true) 0.0 <code>keepcolor,x</code> null null null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>The property of each Projectile 1 call is determined here (see the Projectile calls table above for details)</li> <li>The amount of hits is determined which is random from 2 to 4 inclusive. A SpriteRenderer array is created with this amount as the length to hold the projectiles objects</li> <li>For each hits to do, if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li><code>FastWoosh</code> sound plays</li> <li>animstate set to 103</li> <li>The projectile element is set to a new sprite object childed to the <code>battlemap</code> using the <code>projectilepsrites[12]</code> sprite (purple pointy projectile) positioned at this enemy + (-1.5, 1.5, -0.1) with a scale of 0.6x and a z angle of -90.0</li> <li>The color of the projectile is set which depends on the property determined earlier:<ul> <li>Poison: pure magenta</li> <li>Sleep: pure green</li> <li>Numb: pure yellow</li> </ul> </li> <li>Projectile 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>animstate set to 13 (<code>BattleIdle</code>)</li> <li>Yield all frames until all projectiles elements are null (all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#move-2-jump-kick-attack","title":"Move 2 - Jump kick attack","text":"<p>A single target jump kick attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 5 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 103</li> <li><code>Toss3</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>PingShot</code> sound plays</li> <li>DeathSmoke particles plays at this enemy position + 0.5 in y with a size of 3.0x</li> <li>Yield for a frame</li> <li>GetSingleTarget called</li> <li>position set to <code>playertargetentity</code> + (0.0, 15.0, -0.1)</li> <li><code>trail</code> set to true</li> <li>animstate set to 104</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>Yield for 0.25 seconds</li> <li><code>Toss12</code> sound plays</li> <li>Over the course of 28.0 frames (21.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> + (0.0, 1.5, -0.1) via a lerp</li> <li>animstate set to 105</li> <li>Yield for 0.1 seconds</li> <li><code>Woosh5</code> sound plays with 0.8 pitch</li> <li>DoDamage 1 call happens</li> <li>animstate set to 101</li> <li>SetAnimForce called on this enemy</li> <li>z <code>spin</code> set to -25.0</li> <li>SetDefaultCamera called</li> <li>Yield for a frame</li> <li>ShakeScreen called with an ammount of 0.2 and 0.75 time with dontreset</li> <li>Over the course of 61.0 frames, this enemy moves from <code>playertargetentity</code> + (0.0, 2.5, -0.1) to startp + 1.0 in y via a BeizierCurve3 with a ymax of 7.0</li> <li><code>Drop</code> sound plays</li> <li><code>trail</code> set to false</li> <li><code>spin</code> zeroed out</li> <li>animstate set to 106</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>position set to startp</li> <li>SetAnimForce called on this enemy</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#move-3-heals-maki-with-gradualhp-infliction","title":"Move 3 - Heals Maki with GradualHP infliction","text":"<p>Heals Maki by 6 <code>hp</code> and inflicts them the GradualHP condition. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Kina/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li><code>ItemHold</code> sound plays</li> <li>A new sprite object is created childed to the <code>battlemap</code> using the <code>MiteBurg</code> item sprite positioned at this enemy position + (-0.43, 3.9, -0.1). The object is destroyed in 1 second</li> <li>Yield for a second</li> <li>Heal called to heal <code>Maki</code> by 6 <code>hp</code></li> <li>SetCondition called to inflict the GradualHP condition on <code>Maki</code> for 3 main turns</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/","title":"<code>Krawler</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>This enemy has special logic that happens on StartBattle after it is loaded:</p> <ul> <li>If calledfrom exists and its entity is <code>inice</code> or the battleentity is:<ul> <li><code>freezeres</code> increased by 70</li> <li><code>inice</code> set to true</li> <li>weakness set to a new list with one element being HornExtraDamage</li> </ul> </li> </ul> <p>Additionally, if all of the following is true, the <code>exp</code> is incremented by the floored result of a lerp from 10.0 to 3.0 with a factor of instance.<code>partylevel</code> / 27.0:</p> <ul> <li>battleentity.<code>forcefire</code> is true or we are in the <code>GiantLair</code> area except for the <code>GiantLairFridgeInside</code> map</li> <li>instance.<code>partylevel</code> is less than 27 (meaning it's not maxed)</li> <li>flags 613 is false (RUIGEE is inactive)</li> </ul> <p>For more information, consult the exp logic documentation.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#fire-damage-infliction-logic-in-calculatebasedamage","title":"Fire damage infliction logic in CalculateBaseDamage","text":"<p>This enemy has a 50% chance to be on fire on a <code>Fire</code> property attack if the current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code>. It cannot be on fire otherwise.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#getenemyportrait-logic","title":"GetEnemyPortrait logic","text":"<p>If flag 664 is true (approached the oven during Chapter 7), the portrait sprite index field of this enemy is ignored and 226 is returned instead which includes the fire variant of this enemy in the portrait.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the laser attack move, the yield time while charging the laser changes to 0.75 seconds from 0.85 seconds</li> <li>In the dash attack move, the amount of frames this enemy takes to reach the target is always 21.0 frames instead of being 27.0 frames if neither of the following were true (it would still be 21.0 if either were true even if hardmode is false):<ul> <li><code>forcefire</code> is true</li> <li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target laser attack</li> <li>A single target dash attack</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 40% 2 60%"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#move-1-laser-attack","title":"Move 1 - Laser attack","text":"<p>A single target laser attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Happens if at least one of the following is true:<ul><li><code>forcefire</code> is true</li><li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li></ul> This enemy <code>playertargetID</code> after GetSingleTarget 3 Fire null <code>commandsuccess</code> 2 Happens if DoDamage 1 didn't and <code>inice</code> is true This enemy <code>playertargetID</code> after GetSingleTarget 2 Freeze null <code>commandsuccess</code> 3 Happens if DoDamage 1 and 2 didn't This enemy <code>playertargetID</code> after GetSingleTarget 2 Numb null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>If this enemy x position is less than 2.0:<ul> <li>MoveTowards (2.5, 0.0, -0.5) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul> </li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li><code>Charge11</code> sound plays with 1.1 pitch</li> <li>A new <code>Prefabs/Particles/Charging</code> GameObject is created rooted positioned at <code>sprite</code> position + (0.0, 2.0, -0.1)</li> <li>Yield for 0.85 seconds (0.75 seconds instead if hardmode is true)</li> <li><code>Shot</code> sound plays</li> <li><code>Prefabs/Particles/Charging</code> moved offscreen at 999.0 in y</li> <li><code>Prefabs/Particles/Charging</code> gets destroyed in 5.0 seconds</li> <li>The color of the laser is determined:<ul> <li>It's pure red if all at least one of the following is true:<ul> <li><code>forcefire</code> is true</li> <li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li> </ul> </li> <li>Otherwise, it's pure cyan if <code>inice</code> is true</li> <li>Otherwise, it's pure yellow</li> </ul> </li> <li>A new LightingBolt coroutine starts which will use a <code>Prefabs/Particles/LightingBolt</code> to animate a lighting using its TrailRenderer. The coroutine only contains visual logic that doesn't affect the timing of the block so its logic will be omitted</li> <li>Yield for 0.1 seconds</li> <li>DoDamage 1, 2 or 3 happens depending on which one fits its condition requirements</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#move-2-dash-attack","title":"Move 2 - Dash attack","text":"<p>A single target dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Happens if at least one of the following is true:<ul><li><code>forcefire</code> is true</li><li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li></ul> This enemy <code>playertargetID</code> after GetSingleTarget 4 Fire null <code>commandsuccess</code> 2 Happens if DoDamage 1 didn't This enemy <code>playertargetID</code> after GetSingleTarget 3 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Krawler/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Scuttle3</code> sound plays on loop with 1.2 pitch</li> <li>Camera moves to look near the midpoint between this enemey and <code>playertargetentity</code></li> <li>animstate set to 1 (<code>Walk</code>)</li> <li><code>Prefabs/Particles/WalkDust</code> particles are instantiated childed to the <code>sprite</code> with a local position (0.0, 0.2, -0.1) with its EmissionModule's rateOverTime set to 20.0</li> <li>ShakeSprite called with an intensity of (0.1, 0.1, 0.1) and frametimer of 50.0</li> <li>Yield for a random time between 0.75 and 1.0 seconds</li> <li><code>Shot2</code> sound plays</li> <li>Camera moved to look near <code>playertargetentity</code> zoomed</li> <li><code>Prefabs/Particles/WalkDust</code>'s MainModule's startLifetime set to a constant curve with a value of 1.5 and its startSize set to 1.25</li> <li>The amount of frames for the dash is determined. It's 27.0 frames unless any of the following is true where it's 21.0 frames:<ul> <li>hardmode is true</li> <li><code>forcefire</code> is true</li> <li>The current area is <code>GiantLair</code> while the current map isn't <code>GiantLairFridgeInside</code></li> </ul> </li> <li>Over the course of the amount of frames determined, this enemy moves to <code>playertargetentity</code> position + (0.4, 0.0, -0.1) via a lerp</li> <li><code>Scuttle3</code> sound stops</li> <li>ShakeScreen called with an ammount of 0.3 and time of 0.65</li> <li><code>Death3</code> sound plays</li> <li>DoDamage 1 or 2 call happens depending on which one has its conditions requirements fufilled</li> <li><code>Prefabs/Particles/WalkDust</code> moves offscreen at 999.0 in y then destroyed in 2.0 seconds</li> <li>Over the course of 41.0 frames, this enemy moves to + 2.25 in x via a BeizierCurve3 with a ymax of 2.25</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/","title":"<code>LeafbugArcher</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy is loaded with a non empty chargeonotherenemy as it is needed for their <code>hitaction</code> logic to work. Typically, it will be set to other <code>LeafbugArcher</code>, LeafbugNinja and LeafbugClubber.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to summon an enemy from the leafbug family when HPPercent is less than 0.5 and this enemy is the last <code>enemydata</code> remaining increases to 5/10 from 3/10</li> <li>In the projectile throw move, the speed of the Projectile call changes to 20.0 from 27.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If <code>charge</code> is less than 3, it is incremented with the following:<ul> <li>animstate set to 5 (<code>Angry</code>)</li> <li><code>Wam</code> sound plays</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote with 20 time</li> <li>Yield all frames until <code>emoticoncooldown</code> expires</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li>Yield for 0.5 seconds</li> <li><code>charge</code> is incremented</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target projectile throw</li> <li>Adds a delayed projectile</li> </ol> <p>The decision of which move to use depends first on <code>charge</code>. If it is above 0, move 1 is always used.</p> <p>Otherwise, the deicision of which move to use is based on the following odds:</p> Move Odds 1 5/8 2 3/8"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen at the start of the action if all of the following conditions are met to summon a new enemy from the leafbug family:</p> <ul> <li>This enemy is the last <code>enemydata</code> left</li> <li>HPPercent is less than 0.5</li> <li>A 3/10 RNG check passes (5/10 instead if hardmode is true)</li> </ul> <p>Here is what the logic does if all the of above are fufilled:</p> <ul> <li>animstate set to 105</li> <li>Yield for 0.25 seconds</li> <li><code>Horn</code> sound plays with 1.1 pitch and 0.7 volume</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to a new SummonEnemy call to summon an enemy from the leafbug family with type <code>Offscreen</code> at a random location between (0.25, 0.0, -0.75) and (7.0, 0.0, 0.75) where the distance between any enemy party member is less than its <code>size</code> * 1.75 with cantmove (meaning the enemy needs to wait on the next main turn to act). As for the enemy to summon, it's random among the following:<ul> <li>LeafbugNinja</li> <li>Another <code>LeafbugArcher</code></li> <li>LeafbugClubber</li> </ul> </li> <li>Yield for 0.85 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#move-1-projectile-throw","title":"Move 1 - Projectile throw","text":"<p>A single target projectile throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 Pierce<sup>1</sup> This enemy <code>playertargetID</code> after GetSingleTarget A new sprite object childed to the <code>battlemap</code> using the <code>projectilepsrites[12]</code> sprite (purple pointy projectile) positioned at this enemy + (-1.0, 1.2, -0.1) with a scale of 0.65x and a z angle of -90.0 27.0 (20.0 instead if hardmode is true) 0.0 null null null null Vector3.zero false <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>A new sprite object childed to the <code>battlemap</code> using the <code>projectilepsrites[12]</code> sprite (purple pointy projectile) with a scale of 0.65x positioned offscreen at -99.0 in y</li> <li>GetSingleTarget called</li> <li>animstate set to 100</li> <li><code>Rope1</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 102</li> <li><code>Toss6</code> sound plays</li> <li>The projectile element gets positioned at this enemy + (-1.0, 1.2, -0.1) with a z angle of -90.0</li> <li>Projectile 1 call happens</li> <li>Yield all frames until the projectile is null (Projectile 1 call completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#move-2-delayed-projectile","title":"Move 2 - Delayed projectile","text":"<p>Adds a delayed projectile. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#nocharm-set-to-true","title":"nocharm set to true","text":"<p>This move always set the nocharm local to true which will prevent any UseCharm calls to occur in the post action phase. This means no <code>HealHP</code> charm can occur after this action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1 Always happen A new sprite object childed to the <code>battlemap</code> using the <code>projectilepsrites[12]</code> sprite (purple pointy projectile) positioned at (0.0, 15.0, 0.0) with a scale of 0.65x and a z angle of -20.0 GetRandomAvailablePlayer without nullable 3 1 0 Pierce<sup>1</sup> 50.0 This enemy null null <code>@Toss4</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugArcher/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>A new sprite object childed to the <code>battlemap</code> using the <code>projectilepsrites[12]</code> sprite (purple pointy projectile) with a scale of 0.65x positioned offscreen at -99.0 in y</li> <li>animstate set to 100</li> <li><code>Rope1</code> sound plays</li> <li>Yield for 0.15 seconds</li> <li>animstate set to 103</li> <li>Yield for 0.5 seconds</li> <li><code>Toss6</code> sound plays</li> <li>animstate set to 104</li> <li>The projectile has its z angle set to -150.0</li> <li>Over the course of 46.0 frames, the projectile moves from this enemy position + (-0.75, 2.15, -0.1) to (0.0, 15.0, 0.0) via a lerp</li> <li>The projectile has its z angle set to -20.0</li> <li>AddDelayedProjectile call 1 happens</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/","title":"<code>LeafbugClubber</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy is loaded with a non empty chargeonotherenemy as it is needed for their <code>hitaction</code> logic to work. Typically, it will be set to other <code>LeafbugClubber</code>, LeafbugArcher and LeafbugNinja.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If <code>charge</code> is less than 3, it is incremented with the following:<ul> <li>animstate set to 5 (<code>Angry</code>)</li> <li><code>Wam</code> sound plays</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote with 20 time</li> <li>Yield all frames until <code>emoticoncooldown</code> expires</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li>Yield for 0.5 seconds</li> <li><code>charge</code> is incremented</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target club slash</li> <li>A party wide club jumping attack</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 3/4 2 1/4"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done at the start of the action if this enemy is the last <code>enemydata</code> remaining:</p> <ul> <li><code>Charge10</code> sound plays with 0.9 pitch</li> <li>ShakeSprite called with intensity of (0.1, 0.0, 0.0) and 25.0 frametimer</li> <li>animstate set to 5 (<code>Angry</code>)</li> <li>Yield for 0.3 seconds</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 0 (red up arrow)</li> <li>SetCondition called to inflict the AttackUp condition on this enemy for 1 main turn (only the current action)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#move-1-club-slash","title":"Move 1 - Club slash","text":"<p>A single target club slash.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.5, 0.0, -0.1) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Rope2</code> sound plays with 1.1 pitch</li> <li>animstate set to 100</li> <li>Yield for 0.65 seconds</li> <li>animstate set to 102</li> <li><code>Rope2</code> sound plays</li> <li><code>Death3</code> sound plays</li> <li>DeathSmoke particles plays at <code>playertargetentity</code></li> <li>ShakeScreen called with an ammount of 0.2 and 0.5 time</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#move-2-club-jumping-attack","title":"Move 2 - Club jumping attack","text":"<p>A party wide club jumping attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 3 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugClubber/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 5 (<code>Angry</code>)</li> <li><code>checkingdead</code> set to a new JumpPartyAttackCoroutine (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the coroutine ends up doing:</p> <ul> <li>ShakeSprite called with intensity of (0.1, 0.0, 0.0) and 30.0 frametimer</li> <li><code>Grow1</code> sound plays with 0.8 pitch</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near <code>partymiddle</code></li> <li>animstate set to 103</li> <li><code>Jump</code> sound plays</li> <li><code>Launch</code> sound plays</li> <li>Over the course of 41.0 frames, this enemy moves from its position with a y component of 0.0 to (-4.0, 0.0, 0.0) via a BeizierCurve3 with a ymax of 6.0</li> <li>animstate set to 102</li> <li><code>Launch</code> sound plays</li> <li><code>Explosion5</code> sound plays</li> <li>ShakeScreen called with an ammount of 0.2 and 0.5 time</li> <li><code>impactsmoke</code> particles plays at this enemy position - 0.5 in x</li> <li>PartyDamage 1 call happens</li> <li>Yield for 0.75 seconds</li> <li><code>checkingdead</code> set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/","title":"<code>LeafbugNinja</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy is loaded with a non empty chargeonotherenemy as it is needed for their <code>hitaction</code> logic to work. Typically, it will be set to other <code>LeafbugNinja</code>, LeafbugArcher and LeafbugClubber.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#about-the-clones-special-logic","title":"About the clones special logic","text":"<p>This enemy is able to summon clones of themselves in the post move logic, but with a special property: their weakness is set to be one element being DieInOneHit. This not only changes the damage pipeline such that their <code>hp</code> is unconditionally set to 0 upon any DoDamage calls, but it allows this action to tell that they are indeed a clone. This assumes that this enemy's data does NOT contain this property in the <code>weakness</code> field as it would otherwise break this system.</p> <p>Clones have very reduced logic as besides the hitaction logic and the initialisation of <code>data</code> (which won't do anything for them), they do not share the logic of the original enemy who summoned them. If at the start of the action, their <code>hitaction</code> is false, but they have the <code>DieInOneHit</code> in their <code>weakness</code>, the ENTIRE action logic is reduced to this:</p> <ul> <li>The nocharm local is set to true which will prevent any UseCharm calls to occur in the post action phase. This means no <code>HealHP</code> charm can occur after this action</li> </ul> <p>This means the clones cannot perform any moves, summons other clones or do anything practical besides their <code>hitaction</code> logic. Only the original enemy who summoned them can have access to the full action logic.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: When this is 0, the cloning setup won't be done in the post move logic unless this enemy is the last remaining enemy party member. Once the cloning setup is performed for the first time, it is set to 1. When this happens, the cloning setup will always be performed in the post move logic even if there are more than 1 enemy party members including this enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the leaf projectiles throw move, there is now a 5/10 chance for the Projectile property to be Poison instead of Pierce. When this happens, the projectile has a color of pure magenta</li> <li>In the leaf projectiles throw move, the speed of each Projectile changes to 27.0 from 36.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves. This logic is supported by the clones, but it's only for visual effects in this case as the <code>charge</code> gained won't be useful to them.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If <code>charge</code> is less than 3, it is incremented with the following:<ul> <li>animstate set to 5 (<code>Angry</code>)</li> <li><code>Wam</code> sound plays</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote with 20 time</li> <li>Yield all frames until <code>emoticoncooldown</code> expires</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li>Yield for 0.5 seconds</li> <li><code>charge</code> is incremented</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target kick attack</li> <li>A multiple targets leaf projectiles throw</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 3/5 2 2/5"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#post-move-logic","title":"Post move logic","text":"<p>The following logic concerns the cloning setup and it is always done after a move, but only if at least one of the following is true:</p> <ul> <li>This enemy is the last <code>enemydata</code> remaining</li> <li><code>data[0]</code> is 1 (meaning this cloning setup was used before)</li> </ul> <p>If these requirements are fufilled, the cloning logic happens:</p> <ul> <li><code>charge</code> set to 0</li> <li>UpdateEntities called</li> <li><code>data[0]</code> set to 1 (allows this cloning setup to be done again even if there are more than 1 enemy party members)</li> <li>If there are less than 3 <code>enemydata</code>:<ul> <li>animstate set to 104</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>Done 2 times as long as there are less than 3 <code>enemydata</code>:<ul> <li><code>checkingdead</code> is set to a new SummonEnemy call to summon another <code>LeafbugNinja</code> with type <code>None</code> at a random location between (0.25, 0.0, -0.75) and (7.0, 0.0, 0.75) where the distance between any enemy party member is less than its <code>size</code> * 1.75 with cantmove (meaning the enemy needs to wait on the next main turn to act)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li><code>LeafClone</code> sound plays</li> <li>DeathSmoke particles plays at <code>enemydata[lastaddedid]</code> position with a size of (1.5, 2.5, 1.5)</li> <li>The fields of <code>enemydata[lastaddedid]</code> gets adjusted:<ul> <li>weakness: DieInOneHit</li> <li><code>hp</code>: This enemy's <code>hp</code></li> <li><code>destroytype</code>: NinjaLog</li> <li><code>money</code>: 0</li> <li><code>exp</code>: 0</li> <li>diebyitself: true</li> <li><code>charge</code>: This enemy's <code>charge</code></li> <li>condition: This enemy's <code>condition</code></li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>UpdateEntities called</li> <li><code>LeafCloneShuffle</code> sound plays</li> <li>From there, there are 3 position vectors that the 3 enemy party members will end up, but who will go where is determined randomly with this enemy being the first whose position will be determined. Here are the 3 position vectors:<ul> <li>(1.0, 0.0, 0.0)</li> <li>(3.5, 0.0, 0.0)</li> <li>(6.0, 0.0, 0.0)</li> </ul> </li> <li>startp is set to a random position vector among the 3 which determines the position vector of this enemy. This also determines the position vector of the other 2 enemy party members: the first free position vector will be assigned to the first <code>enemydata</code> that isn't this enemy and the last remaining one will be assigned to the remaining <code>enemydata</code></li> <li>For every enemy party members:<ul> <li>If this isn't this enemy, their <code>hp</code> is set to this enemy's <code>hp</code></li> <li>They MoveTowards (3.5, 0.0, 0.0) with a 2.0 multiplier and 1 (<code>Walk</code>) as walkstate and stopstate</li> <li>Their y <code>spin</code> set to 30.0</li> </ul> </li> <li>Yield all frames until the first 3 <code>enemydata</code>'s <code>forcemove</code> are all done</li> <li>Yield for 0.5 seconds</li> <li>For each enemy party members:<ul> <li>Their <code>spin</code> gets zeroed out</li> <li>Their <code>flip</code> gets set to false</li> <li>They get FlipAngle called with setangle</li> <li>They MoveTowards their respective position vector with a 2.0 multiplier</li> </ul> </li> <li>Yield all frames until the first 3 <code>enemydata</code>'s <code>forcemove</code> are all done</li> <li>This enemy position set to startp</li> <li>For every enemy party members, their <code>charge</code> is reset to 0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#move-1-kick-attack","title":"Move 1 - Kick attack","text":"<p>A single target kick attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.25, 0.0, -0.1) with a 3.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>ChargeDown2</code> sound plays with 1.1 pitch</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 101</li> <li><code>ChargeDown2</code> sound plays</li> <li><code>Hit3</code> sound plays</li> <li>DoDamage 1 call happens</li> <li><code>LeafFlipBack</code> sound plays</li> <li>SetDefaultCamera called</li> <li>animstate set to 102</li> <li>z <code>spin</code> set to -30.0</li> <li>Over the course of 41.0 frames, this enemy moves from its position + 1.0 in y to startp + 1.0 in y via a BeizierCurve3 with a ymax of 5.5</li> <li><code>spin</code> zeroed out</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>FlipAngle called with setangle</li> <li><code>sprite</code> angle zeroed out</li> <li>position set to startp</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#move-2-leaf-projectiles-throw","title":"Move 2 - Leaf projectiles throw","text":"<p>A multiple targets leaf projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times, but each calls requires that at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby) 2 Pierce<sup>1</sup> (if hardmode is true, this has 5/10 chance to be Poison instead) This enemy <code>playertargetID</code> after GetSingleTarget A new sprite object childed to the <code>battlemap</code> using the <code>projectilepsrites[13]</code> sprite (leaf projectile) positioned at this enemy + (-1.0, 1.0, -0.1) with a scale of 0.65x and a z angle of -90.0. If the property is Poison, the SpriteRenderer's material color is pure magenta 36.0 (27.0 instead if hardmode is true) 0.0 null null null null Vector3.zero false <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/LeafbugNinja/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>Done 3 times as long as at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>animstate set to 103</li> <li><code>Toss3</code> sound plays</li> <li>A new sprite object is created childed to the <code>battlemap</code> using the <code>projectilepsrites[13]</code> sprite (leaf projectile) positioned at this enemy + (-1.0, 1.0, -0.1) with a scale of 0.65x and a z angle of -90.0</li> <li>If hardmode is true and a 5/10 RNG check passes, the property of the Projectile 1 call will be <code>Poison</code> and the sprite object's SpriteRenderer's material color is set to pure magenta</li> <li>Projectile 1 call happens</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 100</li> <li>Yield all frames until the sprite object is null (Projectile 1 call completed)</li> <li>animstate set to 100</li> <li>Yield for 0.25 seconds</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/","title":"<code>Maki</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy is fought alongside Kina and Yin. If either or neither are present, the entire enemy action logic will behave in very unexpected ways.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>After loading this enemy, the following special adjustements happens to them if flags 614 is true (HARDEST is active):</p> <ul> <li><code>maxhp</code> and <code>hp</code> gets increased by 10</li> <li><code>def</code> gets incremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 2 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: A phase tracker that can have 3 possible states depending on the value:<ul> <li>0: The initial state, this enemy hasn't gone through a phase transition. From here, the value is only set to 1 in the pre move logic when Yin is no longer present in <code>enemydata</code> (they died)</li> <li>1: This enemy found that Yin is no longer present in <code>enemydata</code> (they died) in the pre move logic and is ready to perform the phase transition. The value will only be set to 2 when this transition is finished</li> <li>2: This enemy completed its phase transition in the pre move logic. From there, it is technically still possible to go through the phase transition again with this value, but it's not going to happen in practice because the phase transition also requires this enemy to not have an AttackUp condition, but an infinite one was inflicted during the phase transition</li> </ul> </li> <li><code>data[1]</code>: A shared cooldown on the usage of either the party wide sword slash move or the charging move. When either move is used, <code>data[1]</code> is set to 2. When either the single or double sword slash moves is used, the value is decremented after the move's usage. The value needs to reach 0 for the party wide sword slash move or the charging move to become usable again. Effectively, it's a shared antispam of 2 actor turns (not counting the one when the combo attack is used if applicable) for the usage of either moves</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A single target sword slash</li> <li>A single target double sword slash</li> <li>A party wide aerial sword slash</li> <li>Increment <code>charge</code>, then either prepares a big attack or use a move right away that consumes the <code>charge</code></li> <li>A single target double hitting attack involving the consumption of Kina's actor turn that can also hit a nearby player party member as a collateral hit</li> </ol> <p>Move 5 is always (and only used) when <code>basestate</code> isn't 13 (<code>BattleIdle</code>) meaning move 4 was used previously while Kina was present in <code>enemydata</code> as this cause <code>basestate</code> to change away from 13. </p> <p>However, it is still possible for move 5 to not actually be used when <code>basestate</code> is 13 if Kina became absent from <code>enemydata</code> (they died since move 4 was used) or they are currently stopped. When this happens while <code>basestate</code> isn't 13, it is set to 13 (alongside the local startstate) and a continue directive is issued to the enemy action loop which restarts the entire action. It effectively means that this enemy will revert to the standard move selection process detailed below which excludes move 5.</p> <p>As for the other moves, the decision of which move to use is based on odds. However, some moves have additional requirements that must be fufilled for the move to be used if selected. If the move is selected, but their requirements aren't fufilled, either another move will be used or a continue directive will be issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection. The following table contains all these informations for move 1 through 4:</p> Move Odds Requirements Falback if requirements aren't fufilled 1 4/13 None, the move is always used N/A 2 3/13 HPPercenkinaHPPercent is 0.6 or lower<li><code>data[1]</code> is 0 or lower (the cooldown on this move / the charge move expired)</li> A continue directive will be issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection 4 3/13 <ul><li><code>turns</code> is 2 or above (at least 2 main turns passed since the start of the battle)</li><li><code>data[1]</code> is 0 or lower (the cooldown on this move / the charge move expired)</li></ul> A continue directive will be issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happens before the usage of a move if <code>data[0]</code> is 0 (the phase transition hasn't happened yet) while Yin is no longer present in <code>enemydata</code> (they died):</p> <ul> <li><code>Wam</code> sound plays</li> <li>Emoticon called with the <code>Exclamation</code> emote for 45 time</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>data[0]</code> is set to 1 (mark the phase transition as starting)</li> <li>RemoveCondition called to remove the AttackUp condition on this enemy (it's possible Yin inflicted it, but it needs to be removed for the phase transition to work)</li> </ul> <p>From there, because <code>data[0]</code> is above 0 and this enemy doesn't have the AttackUp condition, it meets the requirement for the phase transition logic to occur:</p> <ul> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li><code>Charge7</code> sound plays</li> <li>ShakeSprite called with 0.1 intensity and 45.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>StatusEffect called to inflict the AttackUp condition on this enemy for 999999 main turns (effectively infinite) with effect</li> <li>Yield for 0.5 seconds</li> <li>If <code>data[0]</code> is 1 (always the case) and Kina isn't present in <code>enemydata</code> (they died), they are revived with the following logic:<ul> <li>The EntityControl with a <code>Kina</code> animid is obtained by checking all EntityControl childed to the <code>battlemap</code></li> <li>ShakeSprite called on the <code>Kina</code> entity with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>AddNewEnemy called to add a new Kina enemy positioned offscreen at -99.0 in y. NOTE: This bypasses the standard ReviveEnemy process which includes a few differences, but the main ones that matters are:<ul> <li><code>exp</code> and <code>money</code> aren't zeroed out</li> <li><code>alreadycounted</code> is NOT set to true which means that if the player defeats <code>Kina</code> again, their defeated counter in their bestiary entry will increase by 2 instead of 1</li> <li>ReorganizeEnemies with order is NOT called, but in this specific case, it doesn't change anything: <code>Kina</code> will still end up at <code>enemydata[1]</code> either way</li> <li>Their <code>hp</code> won't be restored with a percentage (it gets set to 10 soon after the call instead)</li> </ul> </li> <li>Yield for a frame</li> <li><code>enemydata[lastaddedid]</code> position set to the <code>Kina</code> entity (the one in <code>reservedata</code>)</li> <li>Heal called on <code>enemydata[lastaddedid]</code> with 10 <code>hp</code> (this doesn't actually do anything logically since <code>Kina</code> is already at full health here, but it does show the <code>hp</code> counter visually)</li> <li><code>enemydata[lastaddedid]</code>'s <code>hp</code> is set to 10</li> <li><code>enemydata[lastaddedid]</code> animstate set to 13 (<code>BattleIdle</code>)</li> <li>The <code>Kina</code> entity found earlier is destroyed. It means only the actual enemy one is left</li> <li>Yield for 0.5 seconds</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[179]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>enemydata[lastaddedid]</code> (<code>Kina</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>This enemy (<code>Maki</code>) animstate set to 13 (<code>BattleIdle</code>)</li> <li>Yield for a frame</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[180]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: This enemy (<code>Maki</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> </ul> </li> <li><code>data[0]</code> is set to 2 (mark the phase transition as completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#post-move-logic","title":"Post move logic","text":"<p>The following logic happens after the usage of the single target single and double sword slash moves:</p> <ul> <li>If <code>data[1]</code> is above 0 (the party wide sword slash move and charging move cooldowns), it is decremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#move-1-single-sword-slash","title":"Move 1 - Single sword slash","text":"<p>A single target sword slash.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 8 null {NoDamageAnim, NoSound} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 110</li> <li>Yield for 0.25 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (0.1, 2.3, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>trail</code> set to true</li> <li><code>Toss9</code> sound plays with 1.2 pitch</li> <li>ForceMove to <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with 4.0 multiplier with 112 movestate and 113 stopstate</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li><code>HugeHit</code> sound plays</li> <li><code>trail</code> set to false</li> <li>DoDamage 1 call happens</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>), but if <code>commandsuccess</code> is true (blocked, ignores FRAMEONE), the animstate is set to 24 (<code>Block</code>) instead</li> <li>Jump called on <code>playertargetentity</code> with an h of their <code>jumpheight</code> * 2.0</li> <li><code>playertargetentity</code>'s y <code>spin</code> set to 35.0</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 13 (<code>BattleIdle</code>)</li> <li>Yield all frames (up to 30.0 frames) until both this enemy and <code>playertargetentity</code> are <code>onground</code></li> <li>DeathSmoke particles plays at <code>playertargetentity</code> position</li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li><code>playertargetentity</code> animstate set to 18 (<code>KO</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#move-2-double-sword-slash","title":"Move 2 - Double sword slash","text":"<p>A single target double sword slash.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 5 null {NoDamageAnim, NoSound} <code>commandsuccess</code> 2 Always happen This enemy The same target as DoDamage 1 5 null {NoDamageAnim, NoSound} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li><code>Slash2</code> sound plays</li> <li>ShakeSprite called with 0.1 intensity and 45.0 frametimer</li> <li>animstate set to 115</li> <li>Yield for 0.25 seconds</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>trail</code> set to true</li> <li><code>Toss9</code> sound plays with 1.2 pitch</li> <li>ForceMove to <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with 4.0 multiplier with 112 movestate and 113 stopstate</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li><code>HugeHit</code> sound plays</li> <li><code>trail</code> set to false</li> <li>DoDamage 1 call happens</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>), but if <code>commandsuccess</code> is true (blocked, ignores FRAMEONE), the animstate is set to 24 (<code>Block</code>) instead</li> <li>Jump called on <code>playertargetentity</code> with an h of their <code>jumpheight</code> * 2.0</li> <li><code>playertargetentity</code>'s y <code>spin</code> set to 35.0</li> <li>Yield for 0.5 seconds</li> <li><code>Toss7</code> sound plays</li> <li>Camera moves a bit up</li> <li>Yield all frames until <code>playertargetentity</code>'s <code>rigid</code> y velocity reaches 0.0 or below (they start to fall)</li> <li>LockRigid called on the <code>playertargetentity</code> to lock their <code>rigid</code> (prevents them to fall further)</li> <li>animstate set to 116</li> <li>y position increased by 1.0</li> <li>SetAnimForce called</li> <li>z <code>spin</code> set to 20.0</li> <li>Jump called with an h of 25.0</li> <li>Yield all frames until this enemy's <code>rigid</code> y velocity reaches 0.0 or below (they start to fall)</li> <li><code>spin</code> zeroed out</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>animstate set to 106</li> <li>SetAnimForce called</li> <li>x position decreased by 0.5 and y position decreased by 1.0</li> <li>Yield all frames until this enemy y position becomes equal or lower than <code>playertargetentity</code>'s y position</li> <li>Camera moves a bit to the left</li> <li>animstate set to 107</li> <li>ShakeScreen called with 0.2 ammount and 0.5 time with dontreset</li> <li><code>HugeHit14</code> sound plays</li> <li>DoDamage 2 call happens</li> <li>ForceMove called on <code>playertargetentity</code> to 0.0 in y with 7.0 multiplier using their current animstate as movestate and 18 (<code>KO</code>) as stopstate</li> <li>Yield all frames (up to 30.0 frames) until both this enemy and <code>playertargetentity</code> are <code>onground</code></li> <li>ShakeScreen called with 0.3 ammount and 1.0 time with dontreset</li> <li><code>Thud4</code> sound plays</li> <li><code>DirtExplode</code> particles plays at <code>playertargetentity</code> position</li> <li>DeathSmoke particles plays at <code>playertargetentity</code> position</li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li><code>playertargetentity</code> animstate set to 18 (<code>KO</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#move-3-party-wide-aerial-sword-slash","title":"Move 3 - Party wide aerial sword slash","text":"<p>A party wide aerial sword slash.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 6 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>data[1]</code> is set to 2 (this is the shared cooldown of this move and the charging one)</li> <li>Camera moves to look near the midpoint between this enemy and <code>partymiddle</code></li> <li><code>Charge10</code> sound plays with 1.1 pitch</li> <li>ShakeSprite called with 0.1 intensity and 45.0 frametimer</li> <li>animstate set to 110</li> <li>Yield for 0.25 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (0.1, 2.3, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near <code>partymiddle</code></li> <li>animstate set to 116</li> <li>y position increased by 1.0</li> <li>SetAnimForce called</li> <li>z <code>spin</code> set to 20.0</li> <li>Over the course of 51.0 frames, this enemy moves to <code>partymiddle</code> + 5.0 in y via a BeizierCurve3 with a ymax of 6.0</li> <li><code>spin</code> zeroed out</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>animstate set to 106</li> <li>SetAnimForce called</li> <li>ForceMove called to move + 1.0 in y with 20.0 multiplier using 106 as movestate and stopstate</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li><code>trail</code> set to true</li> <li>Camera moves a bit to the left</li> <li>ForceMove called to <code>partymiddle</code> with 5.0 multiplier using 106 as movestate and 107 as stopstate</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li><code>trail</code> set to false</li> <li>ShakeScreen called with 0.3 ammount and 1.0 time with dontreset</li> <li><code>BigHit</code> sound plays</li> <li><code>impactsmoke</code> particles plays at <code>partymiddle</code></li> <li>For each player party members:<ul> <li>Jump called on them with an h of 15.0</li> <li>y <code>spin</code> set to 20.0</li> </ul> </li> <li>PartyDamage 1 call happens</li> <li>Yield for 0.25 seconds</li> <li>Yield all frames (up to 100.0 frames) until <code>playerdata[0]</code> (usually <code>Bee</code>) is <code>onground</code></li> <li>For each player party members:<ul> <li>DeathSmoke particles plays at their position</li> <li><code>spin</code> zeroed out on them</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#move-4-increments-charge-then-prepares-a-big-attack-or-use-a-move","title":"Move 4 - Increments <code>charge</code>, then prepares a big attack or use a move","text":"<p>Increment <code>charge</code>, then either prepares a big attack or use a move right away that consumes the <code>charge</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move sets <code>dontusecharge</code> to true if Kina is present which means <code>charges</code> will not get zeroed out in post action. If Kina is absent, it may be set to false instead which causes no changes.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>data[1]</code> is set to 2 (this is the shared cooldown with this move and the party wide sword slash one)</li> <li>If either Kina is present or <code>charge</code> is 0 (the latter should always be the case):<ul> <li>Camera moves to look near this enemy</li> <li>ShakeSprite called with 0.1 intensity and 45.0 frametimer</li> <li>animstate and <code>basestate</code> set to 110 (this slate the usage of the combo attack on the next actor turn, but this will be undone later if Kina isn't present meaning they died)</li> <li><code>Charge7</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>charge</code> is incremented</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>If Kina is present, the local startstate is set to <code>basestate</code></li> </ul> </li> <li>If Kina is absent (they died), <code>basestate</code> is set to 13 (prevents the combo attack to be used on the next actor turn) and a continue directive is issued to the enemy action loop which restarts the action and effectively uses another move immediately, but it can only be the single or double sword slash move since <code>data[1]</code>'s antispam is in effect</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#move-5-combo-attack-with-kina","title":"Move 5 - Combo attack with Kina","text":"<p>A single target double hitting attack involving the consumption of Kina's actor turn that can also hit a nearby player party member as a collateral hit.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 6 null {NoDamageAnim, NoSound} <code>commandsuccess</code> 2 Always happen This enemy The same <code>playertargetID</code> as DoDamage 1 5 null {NoDamageAnim} <code>commandsuccess</code> 3 Happens if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) after DoDamage 2 null The last <code>playerdata</code> element whose <code>hp</code> is above 0 and is not the target of DoDamage 1 and 2 4 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Maki/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of Kina is obtained</li> <li>This enemy <code>basestate</code> and the local startstate set to 13 (prevents the usage of this move on the next actor turn)</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[181]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: This enemy (<code>Maki</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>GetSingleTarget called</li> <li>Yield for a frame</li> <li><code>Kina</code> animstate set to 103</li> <li><code>Toss3</code> sound plays</li> <li><code>Slash2</code> sound plays</li> <li>This enemy animstate set to 115</li> <li>Yield for 0.5 seconds</li> <li>DeathSmoke particles plays at <code>Kina</code>'s position with a size of 2.0x</li> <li>Yield for a frame</li> <li><code>Kina</code> position set to <code>playertargetentity</code> position + (4.0, 15.0, -0.1)</li> <li><code>Kina</code>'s <code>trail</code> set to true</li> <li><code>Kina</code> animstate set to 104</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look neat <code>playerdata[playertargetID]</code></li> <li>This enemy's <code>trail</code> set to true</li> <li>ForceMove called on this enemy to move them to <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with 4.0 multiplier using 112 as movestate and 113 as stopstate</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li>This enemy's <code>trail</code> set to false</li> <li><code>Toss9</code> sound plays with 1.2 pitch</li> <li><code>HugeHit</code> sound plays</li> <li>Camera moves a bit up right and zooms in</li> <li>ShakeScreen called with 0.2 ammount and 0.5 time with dontreset</li> <li>DoDamage 1 call happens</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li>Jump called on <code>playertargetentity</code> with an h of their <code>jumpheight</code> * 2.0</li> <li><code>playertargetentity</code>'s y <code>spin</code> set to 35.0</li> <li>Yield all frames until <code>playertargetentity</code>'s <code>rigid</code> y velocity becomes 0.0 or below (they start falling)</li> <li>This enemy animstate set to 13 (<code>BattleIdle</code>)</li> <li>MainManager.ArcMovement called on this enemy to move them to startp with 10.0 height and 30.0 frametime (done in parallel)</li> <li><code>Kina</code>'s <code>sprite</code> z angle set to -20.0</li> <li>ForceMove called on <code>Kina</code> to move them to <code>playertargetentity</code> position + 1.5 in y with 27.0 multiplier using 104 as movestate and 105 as stopstate</li> <li><code>Toss12</code> sound plays</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li>Yield for 0.1 seconds</li> <li>DoDamage 2 call happens</li> <li>SetDefaultCamera called</li> <li><code>Kina</code> animstate set to 101</li> <li><code>Kina</code>'s z <code>spin</code> set to 30.0</li> <li><code>Kina</code>'s <code>sprite</code> local y position increased by 1.0</li> <li>SetAnimForce called on <code>Kina</code></li> <li><code>Woosh5</code> sound plays with 0.8 pitch</li> <li>MainManager.ArcMovement called on <code>Kina</code> to move them to their position before this action with 3.0 height and 30.0 frametime (done in parallel)</li> <li><code>playertargetentity</code>'s <code>spin</code> multiplied by -1.0 (it inverts their existing y <code>spin</code>)</li> <li>If there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby), the first one in <code>playerdata</code> order whose <code>hp</code> is above 0 and it's <code>playertargetID</code> will be set to receive the collateral damage</li> <li>ForceMove called to move <code>playertargetentity</code> to either the collateral hit receiver position + 1.0 in y if it exists or to their position before this action if it doesn't with 30.0 multiplier using 11 (<code>Hurt</code>) as movestate and stopstate</li> <li>Yield for 0.5 seconds</li> <li><code>Drop</code> sound plays</li> <li><code>Kina</code>'s <code>trail</code> set to false</li> <li><code>Kina</code>'s <code>spin</code> zeroed out</li> <li><code>Kina</code>'s animstate set to 106</li> <li><code>Kina</code>'s <code>sprite</code> angles reset to Vector3.zero</li> <li><code>Kina</code>'s position set to the value before this action</li> <li>SetAnimForce called on <code>Kina</code></li> <li>Yield for a frame</li> <li>If the collateral receiver exists:<ul> <li>DoDamage 3 call happens</li> <li>MainManager.ArcMovement called on <code>playertargetentity</code> to move them to their position before this action with 4.0 height and 30.0 frametime (done in parallel)</li> </ul> </li> <li>DeathSmoke particles plays at <code>playertargetentity</code> position</li> <li><code>playertargetentity</code> animstate set to 18 (<code>KO</code>)</li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li>Yield for 0.5 seconds</li> <li><code>Kina</code>'s <code>cantmove</code> gets incremented (meaning they will not be able to act this main turn)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MakiTutorial/","title":"<code>MakiTutorial</code>","text":"<p>NOTE: This enemy action is very complex because it plays an important part in the basic combat tutorial. It is recommended to check the documentation about it alongside this page to understand everything</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MakiTutorial/#asumptions","title":"Asumptions","text":"<p>It is assumed that fighting this enemy means that the basic combat tutorial was not given yet and that the player party is composed of only <code>Bee</code> and <code>Beetle</code> in default party order. </p> <p>It is also assumed that flags 15 is false (haven't given the basic combat tutorial yet) and that flagvar is either 1 or 3 every time this action logic runs.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MakiTutorial/#move-selection","title":"Move selection","text":"<p>1 move is possible:</p> <ol> <li>A single target sword slash attack</li> </ol> <p>Move 1 is always done.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MakiTutorial/#move-1-sword-slash-attack","title":"Move 1 - Sword slash attack","text":"<p>A single target sword slash attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MakiTutorial/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget<sup>1</sup> 2 null null <code>commandsuccess</code><sup>1</sup> <p>1: In the case of the basic combat tutorial, the tartget is <code>playerdata[0]</code> (should always be <code>Bee</code>) and the block value is true which guarantees a regular block, but not necessarily a super block. More info available at the block tutorial documentation</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MakiTutorial/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If <code>flagvar</code> 11 is 1<ul> <li>The turn flow tutorial logic occurs</li> </ul> </li> <li>Otherwise<ul> <li>GetSingleTarget is called</li> </ul> </li> <li>MoveTowards the <code>plauyertargetID</code> position + (2.0, -0.15 * <code>globalcamdir.forward</code>, 0.0) with a multipler of 1.3333334</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 101</li> <li>Yield for 0.25 seconds</li> <li>If <code>flagvar</code> 11 is 1<ul> <li>The block tutorial logic occurs</li> </ul> </li> <li>Otherwise<ul> <li>Yield for 0.2 seconds</li> </ul> </li> <li><code>FastWoosh</code> sound plays</li> <li>animstate set to 103</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>If <code>flagvar</code> 11 is less than 3 (not all basic combat tutorials were given yet), it is set to 2 (which advances the tutorial to the next phase)</li> <li>Yield all frames until <code>inevent</code> is false (shouldn't be true in general because the last EventDialogue involved here is long finished)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/","title":"<code>Mantidfly</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#asumptions","title":"Asumptions","text":"<p>It is assumed that this enemy gets loaded with more than 1 <code>moves</code> because the logic assumes this enemy has multiple actor turns per main turn.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the aerial dash move, the amount of frames this enemy takes to move changes to 30.0 frames from 35.5 frames</li> <li>In the sky drop move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the sky drop move, the amount of frames the drop takes changes to 34.0 frames from 38.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target slash attack</li> <li>A single target aerial dash attack</li> <li>A single target sky drop that the player may prevent from dealing damages</li> </ol> <p>The decision on which move to use is based on odds, but the odds changes depending on if <code>cantmove</code> is 0 or not (0 means this enemy is taking their last available actor turn of the current main turn). Here are the odds in either situations:</p> Move Odds when <code>cantmove</code> isn't 0 Odds when <code>cantmove</code> is 0 1 1/2 2/7 2 1/2 2/7 3 Never used 3/7"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before using a move:</p> <ul> <li><code>initialheight</code> set to 2.0</li> <li>GetSingleTarget called</li> <li>If position is <code>Ground</code>:<ul> <li><code>checkingdead</code> is set to a new ChangePosition call to change the position to <code>Flying</code></li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#move-1-slash-attack","title":"Move 1 - Slash attack","text":"<p>A single target slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 41.0 frames:<ul> <li><code>height</code> changes to 0.0 via a lerp calculated over 60.0 frames</li> <li>This enemy moves to <code>playertargetentity</code> position + (1.5, 0.0, -0.1) via a SmoothLerp</li> <li>Before each frame yield when <code>height</code> is above 0.0 and this enemy's <code>sound</code> isn't playing, <code>BugWing</code> sound plays on this enemy's <code>sound</code></li> </ul> </li> <li>animstate set to 100</li> <li><code>Growl2</code> sound plays with 1.1 pitch</li> <li>Yield for 0.5 seconds</li> <li><code>Slash3</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>position is set to <code>Ground</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#move-2-dash-attack","title":"Move 2 - Dash attack","text":"<p>A single target aerial dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Sleep null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>animstate set to 101</li> <li><code>BugWingFast</code> sound plays</li> <li>Over the course of 31.0 frames, this enemy moves to + 2.0 in x via a SmoothLerp. Before each frame yield, <code>height</code> decreases by BeizierFloat of 1.0 (will smoothly decrease up to 0.5 then back to no decrease)</li> <li>ShakeSprite called with an intensity of 0.1 and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 104</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>Toss4</code> sound plays</li> <li>Over the course of 35.5 frames (30.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position + (-3.0, 0.0, -0.1) via a BeizierCurve3 with a mid of <code>playertargetentity</code> position + (0.0, 0.0 - this enemy <code>height</code>, -0.1). On the first frame this enemy x position becomes lower than the <code>playertargetentity</code> x position, DoDamage 1 call happens</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#move-3-sky-drop","title":"Move 3 - Sky drop","text":"<p>A single target sky drop that the player may prevent from dealing damages.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Only happens if <code>barfill</code> is less than 0.975 (almost filled) after DoCommand 1 This enemy <code>playertargetID</code> after GetSingleTarget 5 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mantidfly/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>If <code>height</code> is above 0.1, <code>BugWing</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code></li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with a 2.5 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li>animstate set to 101</li> <li>ShakeSprite called with intensity of 0.1 and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li><code>Grow1</code> sound plays</li> <li>If <code>height</code> is above 0.1, <code>BugWing</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code></li> <li>Over the course of 11.0 frames, this enemy moves to <code>playertargetentity</code> position + (0.5, 0.0, -0.1) via a lerp and their <code>height</code> changes to 0.0 via a lerp</li> <li>animstate set to 102</li> <li><code>playertargetentity</code> gets childed to this enemy <code>sprite</code></li> <li>Yield for 0.25 seconds</li> <li>CreateHelpBox called with 4 (the <code>TappingKey</code> command's help)</li> <li>DoCommand 1 call happens</li> <li>Yield all frames until <code>doingaction</code> goes to false, but only waiting up to 166.0 frames. Over the course of this wait, this enemy moves to + 6.5 in y via a lerp</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>Yield for 0.25 seconds</li> <li><code>sounds[9]</code> stopped</li> <li>If <code>barfill</code> is 0.975 or higher (the bar was almost filled), the attack is cancelled with the following:<ul> <li><code>playertargetentity</code> animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>playertargetentity</code> gets childed to <code>battlemap</code></li> <li>This enemy <code>height</code> set to its value before this action</li> <li>This enemy y position gets decreased by the <code>height</code> value before this action</li> <li>This enemy animstate set to 0 (<code>Idle</code>)</li> <li>This enemy <code>flyinganim</code> set to true</li> <li>Yield all frames until <code>playertargetentity</code> is <code>onground</code></li> <li>SetDefaultCamera called</li> <li>This action is over early</li> </ul> </li> <li>Otherwise (the bar wasn't almost filled):<ul> <li>Over the course of 51.0 frames, this enemy moves to 15.0 in y via a lerp</li> <li>animstate set to 103</li> <li>y <code>spin</code> set to 30.0</li> <li><code>sprite</code> z angle set to 180.0</li> <li><code>Fall2</code> sound plays</li> <li>Over the course of 38.0 frames (34.0 frames instead if hardmode is true), this enemy moves to 1.25 in y via a lerp</li> <li>ShakeScreen called with an ammount of (0.2, 0.0, 0.0) with a time of 1.0 with dontreset</li> <li><code>Thud3</code> sound plays with 1.1 pitch</li> <li><code>impactsmoke</code> partciles plays at this enemy position</li> <li>DoDamage 1 call happens</li> <li><code>spin</code> zeroed out</li> <li><code>sprite</code> z angle set to 180.0</li> <li>Yield for 0.25 seconds</li> <li><code>sprite</code> angles zeroed out</li> <li>Yield for a frame</li> <li><code>playertargetentity</code> gets childed to the <code>battlemap</code></li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Over the course of 31.0 frames, this enemy moves to + 2.0 in x via a lerp and their <code>height</code> changes to the value it had before this action</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MenderBot/","title":"<code>MenderBot</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/MenderBot/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>Calls SetText in dialogue mode with a random <code>commondialogue</code> string</li> </ol> <p>Move 1 is always used</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MenderBot/#move-1-calls-settext-in-dialogue-mode","title":"Move 1 - Calls SetText in dialogue mode","text":"<p>Calls SetText in dialogue mode with a random <code>commondialogue</code> string. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MenderBot/#logic-sequence","title":"Logic sequence","text":"<ul> <li>animstate set to 11 (<code>Hurt</code>)</li> <li>Yield for a frame</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>|</code>boxstyle<code>,1||</code>shaky<code>||</code>glitchy<code>|</code> followed by a <code>commondialogue</code> string whose index is random between 125 and 129 inclusive</li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: This enemy</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock releases</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/","title":"<code>Midge</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy is loaded with a chargeonotherenemy configured so their <code>hitaction</code> logic works (typically it would be set to <code>Midge</code> so hitting them causes others <code>Midge</code> to enter in a <code>hitaction</code>).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds of move usage changes to be 1/2 for either move instead of being 3/5 for the aerial strike and 2/5 for the bite</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true. The pre move logic and the aerial strike move will be done immediately after.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Emoticon called with the <code>Exclamation</code> emote with a time of 35</li> <li><code>charge</code> is incremented</li> <li><code>Wam</code> sound plays</li> <li>Yield all frames until <code>emoticoncooldown</code> expires</li> <li>Move 1 (aerial strike) is immediately used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target aerial strike</li> <li>A single target bite attack that may drain <code>hp</code></li> </ol> <p>The odds to use each move depends on if hardmode is true or note:</p> Move Odds if hardmode is false Odds if hardmode is true 1 3/5 1/2 2 2/5 1/2 <p>However, in a <code>hitaction</code>, Move 1 is always used after the hitaction logic mentioned in the section above.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#pre-move-logic","title":"Pre move logic","text":"<p>There's logic that happens before each moves, but after the <code>hitaction</code> logic if position is <code>Ground</code>:</p> <ul> <li><code>checkingdead</code> is set to a new GotoPos coroutine on this enemy to change its position to <code>Flying</code> (<code>checkingdead</code> is set to null when the coroutine completes)</li> <li>Yield a frame</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>Here is what the coroutine effectively ends up doing:</p> <ul> <li>Over the course of 20.0 frames, <code>height</code> is lerped to <code>initialheight</code></li> <li><code>bobrange</code> and <code>bobspeed</code> set to <code>startbf</code> and <code>startbs</code> respectively</li> <li><code>height</code> set to <code>initialheight</code></li> <li>position set to <code>Flying</code></li> <li><code>checkingdead</code> set to null informing the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#move-1-aerial-strike","title":"Move 1 - Aerial strike","text":"<p>A single target aerial strike.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 1 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>Yield a frame</li> <li>GetSingleTarget called</li> <li>Camera moves to look near this enemy</li> <li><code>PingUp</code> sound plays</li> <li>animstate set to 100</li> <li>Over the course of 40.0 frames, <code>height</code> increases by 2.0 via a lerp</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li><code>trail</code> set to true</li> <li><code>sprite</code> z angle set to 20.0</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li><code>PingShot</code> sound plays</li> <li><code>FastWoosh</code> sound plays</li> <li>Over the course of 20.0 frames, <code>height</code> is lerped to 1.0 and position is lerped to from startp to <code>playertargetentity</code> position + (1.0, 0.0, -0.1)</li> <li><code>trail</code> set to false</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.2 seconds</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>Over the course of 20.0 frames, <code>height</code> is lerped to <code>initialheight</code> and position is lerped to +1.5 in x</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#move-2-bite-attack","title":"Move 2 - Bite attack","text":"<p>A single target bite attack that may drain <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Midge/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>Yield a frame</li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>BugWing</code> sound plays on loop</li> <li>Over the course of 50.0 frames, position is lerped to <code>playertargetentity</code> position + (2.0, 0.0, -0.2)</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Over the course of 15.0 frames, position is lerped to <code>playertargetentity</code> position + (0.5, 0.0, -0.1) and <code>height</code> is lerped to 1.15 + <code>playertargetentity.animid</code> * 0.2</li> <li><code>BugWing</code> sound stopped</li> <li><code>rotater</code> gets a SpriteBounce added and MessageBounce called on it which will make the sprite stretch and squeeze periodically</li> <li>animstate set to 101</li> <li>ShakeSprite called on <code>playertargetentity</code> with intensity (0.1, 0.0, 0.0) and 0.5 frametimer</li> <li><code>Kiss</code> sound plays with 0.85 pitch and 0.9 volume</li> <li>For the next 30.0 frames, <code>playertargetentity</code> animstate is set to 11 (<code>Hurt</code>) unless <code>blockcooldown</code> hasn't expired for this frame where it's set to 24 (<code>Block</code>) instead</li> <li>Camera moves to look a bit up right</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't block, ignores FRAMEONE), Heal is called to heal this enemy by <code>lastdamage</code> amount of <code>hp</code></li> <li>The SpriteBounce added earlier is destroyed</li> <li>Yield a frame</li> <li><code>rotater</code> scale is set to the one before this action</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Over the course of 20.0 frames, <code>height</code> is lerped to <code>initialheight</code> and position is lerped to be +1.5 in x</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/","title":"<code>MidgeBroodmother</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>On the start of the first actor turn that HPPercent gets lower than 0.5, a phase transition will happen that decrements this enemy's <code>cantmove</code> and sets the <code>moves</code> of this enemy to 2. The overall effect is this enemy now gets 2 actor turns per main turns including the current one</li> <li>In the dash attack move, the total amount of frames the enemy moves towards the target and past it changes to 37.0 from 48.0</li> <li>In the electric ball projectile throw move, the odds to use the Delayed Projectile version when there are no <code>delprojs</code> changes to 41% from 33%</li> <li>In the electric ball projectile throw move (multiple hits version), the amount of projectiles to throw changes to be random between 2 and 3 instead of always being 2</li> <li>In the electric ball projectile throw move (multiple hits version), the yield time before each Projectile calls changes to 0.5 seconds instead of 0.65 seconds</li> <li>In the electric ball projectile throw move (multiple hits version), the speed of each projectile changes to 40.0 from 50.0</li> <li>In the electric ball projectile throw move (Delayed Projectile version), the framespeed changes to 60.0 from 80.0</li> <li>In the electric ball projectile throw move (Delayed Projectile version), <code>cantmove</code> gets decremented at the end which grants an additional actor turn to this enemy</li> <li>In the enemy summon moves, <code>cantmove</code> gets decremented at the end which grants an additional actor turn to this enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target dash attack</li> <li>An electric ball projectile throw that either hits multiple times on multiple targets or is added as a Delayed projectile</li> <li>Summons a new Midge enemy</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 1/4 2 2/4 3 1/4 <p>However, move 3 won't be used if selected when there's already more than 2 enemy party members or if no suitable location is found to spawn the enemy after 20 attempts. If this happens, a continue directive is issued on the action loop which restarts the entire action logic in the same actor turn (this includes the pre move logic).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen at the start of the actor turn:</p> <ul> <li><code>checkingdead</code> is set to a new ChangePosition call to set the position of this enemy. The position to set is <code>Flying</code> unless move 2 (electric projectile throw) is slated for usage where the position is set to <code>Ground</code> instead</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>If hardmode is true, HPPercent is less than 0.5 and <code>moves</code> is 1 (meaning the phase transition hasn't happened yet), a phase transition occurs which notably sets <code>moves</code> to 2:<ul> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>animstate set to 103</li> <li><code>Charge7</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 5 (yellow up arrow)</li> <li>Yield for 0.5 seconds</li> <li><code>cantmove</code> is decremented which gives a free actor turn on this enemy in the current main turn</li> <li><code>moves</code> is set to 2 meaning this enemy now gets 2 actor turns per main turns (including the current one since <code>cantmove</code> was just decremented)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#move-1-dash-attack","title":"Move 1 - Dash attack","text":"<p>A single target dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 103</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li><code>BMCharge</code> sound plays</li> <li>Over the course of 41.0 frames, this enemy moves + 2.0 in x via a BeizierCurve3 with a ymax of -2.0</li> <li>ShakeSprite called with 0.1 intensity for 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 100</li> <li><code>BMCharge2</code> sound plays</li> <li>Over the course of 48.0 frames (37.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> - (distance between this enemy and <code>playertargetentity</code>) in x and -0.1 in z via a BeizierCurve3 with a ymax of 0.35 - <code>height</code>. On the first frame that this enemy x position gets lower than <code>playertargetentity</code> x position:<ul> <li>ShakeScreen called with 0.1 ammount and 0.5 time</li> <li>DoDamage 1 call happens</li> </ul> </li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.5 seconds</li> <li>SetDefaultCamera called</li> <li>Over the course of 31.0 frames, this enemy moves from (15.0, 0.0, 0.0) to startp via a lerp</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#move-2-electric-projectile-throw","title":"Move 2 - Electric projectile throw","text":"<p>An electric ball projectile throw that either hits multiple times on multiple targets or is added as a Delayed projectile without damages (but gains an actor turn if hardmode is true where damages may be dealt).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Happens only if the multiple hits version of the move is used which always happen if <code>delprojs</code> isn't empty or if it is, it's used if a 67% RNG check passes (59% instead if hardmode is true). When this call happens, it is done 2 times (from 2 to 3 times instead if hardmode is true), but each call can only happen if GetRandomAvaliablePlayer with nullable doesn't return -1 2 Numb This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) A new <code>Prefabs/Objects/EnergySphere</code> GameObject rooted positioned at this enemy + (1.15, 2.8, -0.1) with <code>NoMapColor</code> tag 50.0 (40.0 instead if hardmode is true) Random integer between 3 and 5 inclusive then cast to float <code>SepPart@3@1,keepcolor</code> <code>Stars</code> <code>PingShot</code> null Vector3.zero false <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1 Happens only if the delayed projectile version of the move is used which only happen if <code>delprojs</code> is empty and a 33% RNG check passes (41% instead if hardmode is true) A new <code>Prefabs/Objects/EnergySphere</code> GameObject rooted positioned at (0.0, 20.0, 0.0) with <code>NoMapColor</code> tag <code>playertargetID</code> after GetSingleTarget 3 Random between 2 and 3 0 Numb 80.0 (60.0 instead if hardmode is true) This enemy null null <code>Fall2</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>The version of the move is determined. It is the delayed projectile version if <code>delprojs</code> is empty and a 33% RNG check passes (41% instead if hardmode is true) and the multi hits version otherwise</li> <li>animstate set to 101</li> <li>Yield for 0.5 seconds</li> <li><code>Charge7</code> sound plays</li> <li>animstate set to 102</li> <li>A <code>Prefabs/Particles/Charging</code> particles is instantiated rooted and positioned at this enemy position + (1.15, 2.8, -0.1)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#multi-hits-version","title":"Multi hits version","text":"<p>If using the multi hits version of the move:</p> <ul> <li>The amount of hits is determined. It's always 2 (random between 2 and 3 instead if hardmode is true). A new array of GameObject is created to hold each projectiles with the amount being the length</li> <li>For each hit:<ul> <li>animstate set to 102</li> <li>GetRandomAvailablePlayer called with nullable to get a target player party member. If the result isn't -1:<ul> <li>Yield for 0.65 seconds (0.5 seconds instead if hardmode is true)</li> <li>The projectile element is set to a new <code>Prefabs/Objects/EnergySphere</code> GameObject rooted positioned at this enemy + (1.15, 2.8, -0.1) with <code>NoMapColor</code> tag</li> <li><code>Lazer2</code> sound plays</li> <li>Projectile 1 call happens</li> <li><code>Prefabs/Particles/Charging</code> particles stops playing</li> </ul> </li> <li>animstate set to 101</li> <li>If this isn't the last hit:<ul> <li>Yield for 0.5 seconds</li> <li><code>Prefabs/Particles/Charging</code> particles resumes playing</li> </ul> </li> </ul> </li> <li>Yield all frames until all projectile elements are null (meaning all Projectile calls completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#delayed-projectile-version","title":"Delayed projectile version","text":"<p>If using the delayed projectile version of the move:</p> <ul> <li>GetSingleTarget called</li> <li>Camera moves to look near this enemy</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>A new <code>Prefabs/Objects/EnergySphere</code> GameObject is created rooted positioned at this enemy position + (1.15, 2.8, -0.1) with <code>NoMapColor</code> tag</li> <li><code>Lazer2</code> sound plays</li> <li><code>Prefabs/Particles/Charging</code> particles stops playing</li> <li>animstate set to 101</li> <li>Over the course of 51.0 frames, <code>Prefabs/Objects/EnergySphere</code> moves to (0.0, 20.0, 0.0) via a lerp</li> <li>AddDelayedProjectile 1 call happens</li> <li>If hardmode is true, <code>cantmove</code> is decremented which gives an additional actor turn to this enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#cleanup","title":"Cleanup","text":"<p>This happens no matter which version of the move used:</p> <ul> <li><code>Prefabs/Particles/Charging</code> moved offscreen at -9999.0 in y then gets destroyed in 5.0 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#move-3-enemy-summon","title":"Move 3 - Enemy summon","text":"<p>Summons a new Midge enemy. No damages are dealt, but the enemy gains a free actor turn if hardmode is true where damages may be dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MidgeBroodmother/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>A Vector3 is attempted to be generated that will corresponds to the position to spawn the new enemy. Each attempt may fail, but up to 20 attempts will be done and the first one that fufills some conditions will be used. Each attempts generates a vector where the x component is between 0.25 and 7.0, the y component is 0.0 and the z component is between -0.75 and 0.75. For the location to be accepted, any enemy part member needs to be located at a distance less than its <code>size</code> * 1.75. If no suitable locations is found after 20 attempts, the entire action logic restarts (including the pre move logic)</li> <li>ShakeScreen called with 0.1 ammount and 1.0 time with dontreset</li> <li>animstate set to 103</li> <li><code>Growl</code> sound plays with 1.2 pitch</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a new Midge with type <code>Offscreen</code> at the location without cantmove (meaning the new enemy can act immediately on the same main turn)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>The new enemy's <code>exp</code> is set to 0</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>RegorganizeEnemies called</li> <li>If hardmode is true, <code>cantmove</code> is decremented which gives an additional actor turn to this enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/","title":"<code>MimicSpider</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the bubble projectiles throw move, the amount of hits to do changes to be random from 2 and 3 inclusive instead of always being 2</li> <li>In the bubble projectiles throw move, the Projectile call has 50% chance to have the Sticky property instead of always being Poison</li> <li>In the bubble projectiles throw move, the speed of each Projectile call changes to 30.0 from 37.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target bite attack</li> <li>A multiple targets bubble projectiles throw</li> </ol> <p>The decision of which move to use is based on the followings odds:</p> Move Odds 1 3/5 2 2/5"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#move-1-bite-attack","title":"Move 1 - Bite attack","text":"<p>A single target bite attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Sleep null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>Scuttle2</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code> with 1.1 pitch and 0.8 volume</li> <li>MoveTowards <code>playertargetentity</code> position + (1.35, 0.0, -0.1) with 2.4 multiplier, 23 (<code>Chase</code>) walkstate and 13 (<code>BattleIdle</code>) stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li><code>Chew</code> sound plays</li> <li>Yield for a random interval between 0.45 and 0.65 seconds</li> <li>animstate set to 107</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.65 seconds</li> <li>SetDefaultCamera called</li> <li><code>Scuttle2</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code> with 1.1 pitch and 0.8 volume</li> <li>MoveTowards startp with 2.0 multiplier, 23 (<code>Chase</code>) walkstate and 13 (<code>BattleIdle</code>) stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#move-2-bubble-projectiles-throw","title":"Move 2 - Bubble projectiles throw","text":"<p>A multiple targets bubble projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times (random between 2 to 3 times inclusive instead if hardmode is true), each calls requires that at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby) 2 Poison (if hardmode is true, this has 50% chance to be Sticky instead) This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new <code>Prefabs/Objects/PoisonBubble</code> (<code>Prefabs/Objects/StickyBubble</code> instead if the property is <code>Sticky</code>) GameObject rooted positioned at this enemy + (-1.5, 1.0, -0.1) with a scale of 0.35x 37.0 (30.0 instead if hardmode is true) 0.0 null <code>PoisonEffect</code> (<code>StickyGet</code> instead if property is <code>Sticky</code>) <code>BubbleBurst</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/MimicSpider/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>The amount of hits is determined. It's always 2 (random between 2 and 3 inclusive is hardmode is true)</li> <li>For each hits to do and as long as at least one player party member is alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li><code>Blosh</code> sound plays</li> <li>animstate set to 103</li> <li>The property of the DoDamage 1 call is determined. It's always <code>Poison</code> unless hardmode is true where it has a 50% chance to be <code>Sticky</code> instead</li> <li>Yield for 0.75 seconds</li> <li><code>Chew</code> sound plays</li> <li><code>Spin10</code> sound plays</li> <li>A new <code>Prefabs/Objects/PoisonBubble</code> (<code>Prefabs/Objects/StickyBubble</code> instead if the property is <code>Sticky</code>) GameObject is created rooted positioned at this enemy + (-1.5, 1.0, -0.1) with a scale of 0.35x</li> <li>Projectile 1 call happens</li> <li>animstate set to 104</li> <li>Yield all frames until the bubble object is null (Projectile 1 call completed)</li> </ul> </li> <li>Yield for 0.65 seconds</li> <li>SetDefaultCamera called</li> <li><code>Scuttle2</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code> with 1.1 pitch and 0.8 volume</li> <li>MoveTowards startp with 2.0 multiplier, 23 (<code>Chase</code>) walkstate and 13 (<code>BattleIdle</code>) stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/","title":"<code>MotherChomper</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In both projectile throw moves, the amount of hits is random from 2 to 3 inclusive instead of being random between 1 to 3 inclusive</li> <li>In both projectile throw moves, the amount of frames the projectile takes to reach its target changes to 35.0 frames from 41.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A multiple targets seeds projectile throw</li> <li>A multiple targets spiky projectiles throw that can infllict the Sleep condition</li> <li>A bite attack to the player party member in front</li> </ol> <p>The move usage decision is based on the following odds:</p> Move Odds 1 3/7 2 2/7 3 2/7 <p>However, move 3 has additional requirements that must be fufilled after being selected for the move to be used:</p> <ul> <li><code>playerdata[partypointer[0]]</code> (the front player party member) must have their <code>hp</code> above 0</li> <li>Either <code>forceattack</code> is -1 (the player didn't taunted the enemy party) or it is the same as <code>playerdata[partypointer[0]]</code> (the front player party member is taunting the enemy party)</li> </ul> <p>If these requirements aren't fufilled and the move is selected, move 2 is used instead.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#pre-move-logic","title":"Pre move logic","text":"<p>There are 2 parts of logic that always happen at the start of the actor turn if their conditions are fufilled. They are mentioned in order they appear.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#flytrap-summon","title":"FlyTrap summon","text":"<p>If this enemy is the last enemy party member remaining, the following happens:</p> <ul> <li>animstate set to 104</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 5 (<code>Angry</code>)</li> <li><code>Roar</code> sound plays with 1.1 pitch</li> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 101</li> <li><code>Clomp</code> sound plays</li> <li>Camera moves a bit up and right</li> <li>Yield for 1 second</li> <li>animstate set to 108</li> <li>A new sprite object is created rooted using the <code>ChomperSeed</code> item sprite position at this enemy position + (-0.75, 7.6, 0.1) with a SpinAround that has an <code>itself</code> of 20.0 in z</li> <li>Over the course of 120.0 frames, the <code>ChomperSeed</code> sprite moves to (1.0, 0.0, -0.1) via a BeizierCurve3 with a ymax of 9.0. Before each frame yield after the halfway mark, the animstate of this enemy is set to 0 (<code>Idle</code>)</li> <li>DeathSmoke particles plays at the <code>ChomperSeed</code> sprite position</li> <li><code>Charge</code> sound plays</li> <li><code>checkingdead</code> is set to a new SummonEnemy call to summon a new FlyTrap enemy with type <code>FromGroundKeepScale</code> at the <code>ChomperSeed</code> position with cantmove (meaning the new enemy cannot act on this main turn and needs to wait on the next one)</li> <li>The <code>ChomperSeed</code> sprite gets destroyed</li> <li>Yield for a frame</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#phase-transition","title":"Phase transition","text":"<p>If HPPercent is less than 0.6 and <code>moves</code> is still 1 (meaning the phase transition hasn't happened yet), the following phase transition occurs which notably sets <code>move</code> to 2 granting 2 actor turns per main turn to this enemy (excluding the current main turn):</p> <ul> <li>animstate set to 5 (<code>Angry</code>)</li> <li><code>Roat</code> sound plays with 1.1 pitch</li> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li>Yield for 0.75 seconds</li> <li>StatEffect called on this enemy with type 5 (yellow up arrow)</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.5 seconds</li> <li><code>moves</code> set to 2</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#move-1-seeds-throw","title":"Move 1 - Seeds throw","text":"<p>A multiple targets seeds projectile throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen from 1 to 3 times inclusive (from 2 to 3 times inclusive instead if hardmode is true). Each call can only happen if GetRandomAvaliablePlayer with nullable doesn't return -1, but this will be guaranteed to be the case if at least one player party member is alive (<code>hp</code> above 0 and not eatenby) This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) 3 <code>None</code> (same as null) null <code>commandsuccess</code> <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves to look at (0.7, 0.3, 1.0)</li> <li>animstate set to 101</li> <li><code>Clomp</code> sound plays</li> <li>Yield for 1.25 seconds</li> <li>A new sprite object is created rooted using the <code>HardSeed</code> item sprite positioned offscreen at 999.0 in y with a SpinAround that has an <code>itself</code> of 20.0 in z</li> <li>The amount of hits is determined. It's random between 1 and 3 inclusive (between 2 and 3 inclusive instead if hardmode is true)</li> <li>For each hit:<ul> <li><code>playertargetID</code> is set to GetRandomAvaliablePlayer with nullable</li> <li>If the above returned -1 (couldn't find a target), the hit is rerolled without counting it as long as not every player party members are dead (<code>hp</code> at 0 or below or eatenby) followed by a frame yield</li> <li>Otheriwse (a target was found):<ul> <li><code>playertargetentity</code> is set to the matching <code>playertargetID</code>'s <code>battleentity</code></li> <li>The <code>HardSeed</code> sprite position is set to this enemy position + (-5.0, 2.25, -0.1)</li> <li>animstate set to 103</li> <li><code>Spit</code> sound plays</li> <li>Over the course of 41.0 frames (35.0 frames instead if hardmode is true), the <code>HardSeed</code> sprite moves to <code>playertargetentity</code> position + (0.0, 1.0, -0.1.0) via a lerp. Before each frame yield before the halfway mark, if this isn't the last hit, this enemy animstate is set to 101</li> <li>The <code>HardSeed</code> sprite is moved offscreen at (0.0, 999.0, 0.0)</li> <li>DoDamage 1 call happens</li> </ul> </li> </ul> </li> <li>The <code>HardSeed</code> sprite gets destroyed</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#move-2-spiky-projectiles-throw","title":"Move 2 - Spiky projectiles throw","text":"<p>A multiple targets spiky projectiles throw that can infllict the Sleep condition.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen from 1 to 3 times inclusive (from 2 to 3 times inclusive instead if hardmode is true). Each call can only happen if GetRandomAvaliablePlayer with nullable doesn't return -1, but this will be guaranteed to be the case if at least one player party member is alive (<code>hp</code> above 0 and not eatenby) This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) 2 Sleep null <code>commandsuccess</code> <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#logic-sequence_1","title":"Logic sequence","text":"<p>This move has the same logic secquence than move 1 (seeds throw) with 3 changes:</p> <ul> <li>DoDamage 1 deals 2 instead of 3 as outlined above</li> <li>DoDamage has the <code>Sleep</code> property instead of <code>None</code> as outline above</li> <li>The sprite used as the projectile is <code>projectilepsrites[5]</code> (a gray spiky projectile) instead of the <code>HardSeed</code> item sprite</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#move-3-bite","title":"Move 3 - Bite","text":"<p>A bite attack to the player party member in front.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playerdata[partypointer[0]]</code> (the player party member in front) 5 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MotherChomper/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>Chew</code> sound plays with 0.85 pitch</li> <li>Camera moves to look near (1.0, 0.0, 1.76)</li> <li><code>playertargetID</code> is set to <code>partypointer[0]</code> (the player party member in front)</li> <li><code>sprite</code> y angle set to -1.0</li> <li>animstate set to 104</li> <li>Yield for 1.1 seconds</li> <li>animstate set to 106</li> <li>Camera moves to look near (-2.0, -1.0, 3.0)</li> <li><code>Bite</code> sound plays with 0.9 pitch</li> <li>Yield for 0.2 seconds</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/","title":"<code>Mothfly</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to use the self sacrifice move when all other conditions are fufilled changes to 50% from 35%</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#move-selection","title":"Move selection","text":"<p>3 move are possible:</p> <ol> <li>Self sacrifices themsevles to heal a FalseMonarch or MothflyCluster by all of this enemy's <code>hp</code></li> <li>A single target aerial strike attack</li> <li>A single target tackle attack, UNUSED</li> </ol> <p>Move 1 is always (and only) used if all the following conditions are fufilled:</p> <ul> <li>flags 400 is false (temporary global flag, but the check here is specifically meant for having this move disabled during the fight in event 222 which is the event related to the <code>Rebecca</code> BoardQuest as the event puts it to true before the fight and back to false after)</li> <li>There's at least 1 FalseMonarch or MothflyCluster in the enemy party and the first occurence of either has an HPPercent below 1.0 (not at full <code>hp</code>)</li> <li>This enemy's <code>turnsalive</code> is above 0 (they're not only alive, but they also performed a complete actor turn before)</li> <li>A 35% RNG check passes (50% instead if hardmode is true)</li> </ul> <p>If any of the above aren't fufilled, Move 2 is used instead.</p> <p>Move 3 is never used under normal gameplay, but remains functional. This is because this move requires the position to not be <code>Flying</code>, but the pre move logic will always set it to <code>Flying</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done at the start of the actor turn if position isn't <code>Flying</code>:</p> <ul> <li><code>checkingdead</code> is set to a new ChangePosition call to set the position to <code>Flying</code> (<code>checkingdead</code> set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#move-1-self-sacrifice","title":"Move 1 - Self sacrifice","text":"<p>Self sacrifices themsevles to heal a FalseMonarch or MothflyCluster by all of this enemy's <code>hp</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The first occurence of a FalseMonarch or MothflyCluster in the <code>enemydata</code> is selected as the receiver of the heal</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote with 30 time</li> <li>Yield all frames until <code>emoticoncooldown</code> expires</li> <li>Camera moves to look near the receiver position</li> <li>This enemy FaceTowards the receiver</li> <li><code>Toss12</code> sound plays</li> <li>ForceMove called on this enemy to move to the receiver position + (0.0, -0.5 or 0.75 instead if the receiver has a <code>height</code> above 0.0, -0.1) with 20.0 frametime without changeanim</li> <li>Yield all frames until <code>forcemoving</code> is done</li> <li>startp is set to this enemy's <code>startscale</code></li> <li>Over the course of 21.0 frames, this enemy's <code>startscale</code> changes to 0.0x via a lerp</li> <li>startp set to Vector3.zero</li> <li>Heal called to heal the receiver by an amount of <code>hp</code> equal to the amount of this enemy</li> <li><code>Heal</code> sound plays</li> <li><code>HealPing</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>selfsacrifice</code> set to true which prevents some logic to happen in post action since this enemy is set to die soon</li> <li>CleanKill called on this enemy which turns this enemy into a blank actor shell placing their battleentity at startp</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#move-2-aerial-strike-attack","title":"Move 2 - Aerial strike attack","text":"<p>A single target aerial strike attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 1 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code>, but zoomed in</li> <li><code>Toss2</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code> with pitch 1.1 and volume 0.5</li> <li>MoveTowards <code>playerdata[playertargetID]</code> + (2.0, 0.0, -0.15) with 1.5 multiplier and stopstate 100</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li><code>height</code> set to 0.0</li> <li>y position set to the <code>height</code> value before this action</li> <li>animstate set to 11 (<code>Hurt</code>)</li> <li><code>FastWoosh</code> sound plays</li> <li>Over the course of 1 / 0.055 frames (~18.181818 frames), position moves to its current position + 0.75 in x via a BeizierCurve3 with a ymax of -0.01</li> <li>animstate set to 100</li> <li>Yield for 0.2 seconds</li> <li>animstate set to 100</li> <li><code>Turn2</code> sound plays</li> <li>Over the course of 1 / 0.07 frames (~14.285714 frames), position lerps to <code>playerdata[playertargetID]</code> position + (0.0, 1.0, -0.1)</li> <li>DoDamage call 1 happens</li> <li>Yield for 0.15 seconds</li> <li><code>height</code> set to 0.2</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 1 / 0.045 frames (~22.22222 frames), position lerps to its position before the BeizierCurve3 movement earlier</li> <li>y position is set to 0.0</li> <li><code>height</code> is restored to its value before this action</li> <li>Yield for 0.2 seconds</li> <li><code>bobrange</code> reset to <code>startbf</code></li> <li><code>bobspeed</code> reset to <code>startbs</code></li> <li>FlipAngle called with setangle</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#move-3-tackle-attack-unused","title":"Move 3 - Tackle attack, UNUSED","text":"<p>A single target tackle attack.</p> <p>NOTE: This move is practically UNUSED, see the move selection section above for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothfly/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to new coroutine called SeedlingTackle which will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li>FlipAngle called with setangle</li> </ul> <p>This is what the coroutine effectively does:</p> <ul> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Done 2 times:<ul> <li>Jump called</li> <li><code>Jump</code> sound plays with 0.75 pitch and 1.6 volume</li> <li>Yield for 0.1 seconds</li> <li>Yield all frames until <code>onground</code> goes to true</li> <li>Yield a frame</li> </ul> </li> <li>CameraFocusTarget called</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 3.0 in x with a 2.0 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Yield for 0.2 seconds</li> <li><code>Spin10</code> sound plays</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + (0.35, 0.0, -0.1) with a 2.5 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>DoDamage 1 call happens</li> <li>Jump called</li> <li><code>flip</code> set to false (with <code>overrideflip</code>)</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 2.0 in x with a 0.75 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> is set to false</li> <li><code>checkingdead</code> set to null indicating the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/","title":"<code>MothflyCluster</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the aerial strike move, the amount of frames this enemy takes to reach its target changes to 11.0 frames from 17.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target aerial strike</li> <li>Summons 2 new Mothfly enemies</li> </ol> <p>Move 2 is always (and only) used when this enemy is the last <code>enemydata</code> remaining.</p> <p>If move 2 wasn't used, move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done at the start of the actor turn if position is <code>Ground</code>:</p> <ul> <li><code>checkingdead</code> is set to a new ChangePosition call to set the position to <code>Flying</code> (<code>checkingdead</code> set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/#move-1-aerial-strike","title":"Move 1 - Aerial strike","text":"<p>A single target aerial strike.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code>, but zoomed in</li> <li>MoveTowards <code>playerdata[playertargetID]</code> + (3.0, 0.0, -0.1) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 11 (<code>Hurt</code>)</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li><code>Charge19</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 100</li> <li><code>Toss13</code> sound plays</li> <li>Over the course of 17.0 frames (11.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> + (0.5, 0.0 - <code>height</code> + 0.5, -0.1) via a lerp</li> <li>ShakeScreen called with 0.075 ammount and 0.5 time with dontreset</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.25 seconds</li> <li>Over the course of 21.0 frames, this enemy moves to <code>playerdata[playertargetID]</code> + (2.0, 0.0, -0.1) via a lerp</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/#move-2-summons-2-mothfly","title":"Move 2 - Summons 2 Mothfly","text":"<p>Summons 2 new Mothfly enemies. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MothflyCluster/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>MoveTowards (4.0, 0.0, 0.0) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Toss11</code> sound plays</li> <li>startp set to this enemy position except for the y component which is set to 0.0</li> <li><code>checkingdead</code> set to a new SummonMothFly coroutine (<code>checkingdead</code> is set to null when it completes)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the SummonMothfly coroutine ends up doing:</p> <ul> <li>Camera moves to look near this enemy, but zoomed in</li> <li>animstate set to 11 (<code>Hurt</code>)</li> <li><code>rotater</code> gets a SpriteBounce added with 0.0 <code>frequency</code> and 20.0 <code>speed</code></li> <li>Over the course of 31.0 frames, the <code>rotater</code>'s SpriteBounce's <code>frequency</code> changes to 0.1 via a lerp</li> <li>Yield for 0.5 seconds</li> <li>The <code>rotater</code>'s SpriteBounce gets destroyed</li> <li><code>rotater</code> scale increased by 30%</li> <li><code>PingDown</code> sound plays</li> <li>Done 2 times:<ul> <li>AddNewEnemy called to a new Mothfly enemy at this enemy + (0.0, <code>height</code>, 0.1)</li> <li>Yield a frame</li> <li>The <code>enemydata[lastaddedid]</code> gets some adjustements:<ul> <li><code>maxhp</code> and <code>hp</code>: divided by 2 floored</li> <li><code>exp</code>: 0</li> <li><code>money</code>: 0</li> <li>y <code>spin</code>: 20.0</li> </ul> </li> </ul> </li> <li>Over the course of 31.0 frames, <code>rotater</code> scale changes to its original value before this coroutine via a lerp and the 2 new enemies that were just summoned moves from this enemy position to (<code>x</code>, 0.0, -0.1) via a BeizierCurve3 with a ymax of 4.0 where <code>x</code> is 1.0 for the first enemy and 7.0 for the second enemy</li> <li><code>rotater</code> scale is set to its value before this coroutine</li> <li>Both enemies who were just summoned has their <code>spin</code> zeroed out</li> <li><code>checkingdead</code> is set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/","title":"<code>Mothiva1</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#assumptions","title":"Assumptions","text":"<p>This enemy is meant to function with Zasp present as due to their hitaction logic that changes when they are the only one left in <code>enemydata</code>. This enemy also has logic change if <code>Zasp</code> is present or not.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>After this enemy is loaded on StartBattle, if flags 606 is true (won the second round of the Colosseum), the following happens on this enemy:</p> <ul> <li><code>hp</code> and <code>maxhp</code> are increased by 15</li> <li><code>hardatk</code> is incremented</li> <li><code>lockrelayreceive</code> is set to true</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: The amount of times this enemy revived Zasp from <code>reservedata</code>. This is used as a deterant on the usage on the reviving move as if all other conditions to use it are satisfied, but this value is 2 or above (1 or above instead if hardmode is true), there is a 51% chance that the kick move is used instead</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the music note throw move (party wide version), the note will take 40 frames instead of 50 frames to reach its target leading to the DoDamage call</li> <li>In the music note throw move (single targer version), the amount of hits to do changes to be random between 2 and 3 inclusive instead of being random between 1 and 3 inclusive</li> <li>The relay move may be used instead of always being redirected to either the music note throw or the kick move</li> <li>When deciding to use the revive move, it is now possible with a 51% chance to redirect to the kick move if <code>data[0]</code> is 1 or above. Normally, this would only have been possible if <code>data[0]</code> is 2 or above and pass the 51% RNG check</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#move-selection","title":"Move selection","text":"<p>6 moves are possible:</p> <ol> <li>A party wide music note throw</li> <li>A single target music note throws that may hit multiple times</li> <li>A single target kick attack that may hit multiple times</li> <li>Sings which inflicts the DefenseUp condition to Zasp</li> <li>Relay her turn which gives an actor turn to Zasp</li> <li>Revives Zasp from the <code>reservedata</code></li> </ol> <p>Move 6 is special because its decision requires all the following conditions to be true and if they are fufilled, it takes priority over all other moves:</p> <ul> <li><code>forceattack</code> is -1 (meaning the enemy party isn't affected by BeetleTaunt)</li> <li><code>reservedata</code> exists and contains Zasp</li> <li>A 75% RNG check passes</li> </ul> <p>Move 1 and 2 are treated as the same unit during the move selection process and it will be refered to as \"move 1-2\". When move 1-2 is selected and used, the decision of which move to use among the 2 is based on the following odds:</p> Move Odds 1 1/3 2 2/3 <p>All the moves except move 6 have base odds which are shown in the following table. However, the decision of the move to use may not be the final one. It is possible the move's logic decides to perform a different move instead which is reffered to as a redirection. Redirections may chain together and they typically happen when proceeding with the move is illogical or undesired.</p> <p>Here are all the move's base odds and their possible redirections:</p> Move Base odds Possible redirections 1-2 3/7 None 3 2/7 Move 1-2 if HPPercent is higher than 0.6 4 1/7 <ul><li>Move 1-2 or 3 determined randomly if any of the following is true<sup>1</sup>:<ul><li><code>forceattack</code> isn't -1 (meaning the enemy party is affected by BeetleTaunt)</li><li>Zasp is not present in <code>enemydata</code></li><li>Zasp is stopped</li></ul></li><li>Move 1-2 if the above didn't apply, but Zasp already has the DefenseUp condition<sup>1</sup></li></ul> 5 1/7 Move 1-2 or 3 determined randomly if any of the following is true<sup>1</sup>:<ul><li>hardmode is false</li><li><code>forceattack</code> isn't -1 (meaning the enemy party is affected by BeetleTaunt)</li><li>Zasp is not present in <code>enemydata</code></li><li>Zasp is stopped</li></ul> 6 N/A Move 3 if <code>data[0]</code> (amount of times revive was done) is at least 2 (at least 1 instead if hardmode is true) and a 51% RNG check passes <p>1: There is an issue if move 3 or 4 (singing or relay) redirects to move 2 (kick) because <code>nonphysical</code> will remain true even if the kick move was not meant to be <code>nonphysical</code>. This will incorrectly affect the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target of the kick.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#move-1-party-wide-music-note-throw","title":"Move 1 - Party wide music note throw","text":"<p>A party wide music note throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any targets.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen for each player party member whose <code>hp</code> is above 0 This enemy The player party member 2 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Prefabs/Particles/MusicSimple</code> instantiated near this enemy</li> <li>animstate set to 103</li> <li>All <code>Sprites/Particles/music</code> preloaded</li> <li><code>Charge4</code> sound plays</li> <li>Camera moves to look near this enemy</li> <li>Yield for 0.5 seconds</li> <li>A new GameObject with a SpriteRenderer is created using a random sprite from <code>Sprites/Particles/music</code> using a color of RainbowColor from 0 to 9 variants (determined at random) and a SpinAround with an <code>itself</code> of (0.0, 0.0, 2.0). The object is positioned at the this enemy + (0.0, 2.0, 0.1)</li> <li>Over the course of 40.0 frames, the music note moves + 2.5 in y via a lerp, gets scaled to 3x via a lerp and has its SpinAround's <code>itself</code>'s z changed to 20.0 via a lerp</li> <li>animstate set to 101</li> <li><code>Prefabs/Particles/MusicSimple</code> positioned offscreen and destroyed in 2.0 seconds</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near the player party</li> <li><code>Launch</code> sound plays</li> <li>Over the course of 50 frames (40 frames instead if hardmode is true), the music note moves to <code>partymiddle</code> using a BeizierCurve3 with a ymax of 9.0</li> <li><code>musicexplosion</code> particles played at <code>partymiddle</code></li> <li><code>impactsmoke</code> particles played at <code>partymiddle</code></li> <li><code>BigHit</code> sound plays</li> <li>ShakeScreen for (0.15, 0.15, 0.15) ammount and 0.25 time</li> <li>For each player party members whose <code>hp</code> is above 0, DoDamage 1 call happens</li> <li>The music note object is destroyed</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#move-2-single-target-music-note-throws","title":"Move 2 - Single target music note throws","text":"<p>A single target music note throws that may hit multiple times.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any targets.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 1 to 3 times (from 2 to 3 times instead if hardmode is true) 1 Pierce<sup>1</sup> This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) A new GameObject rooted with a SpriteRenderer using a random sprite in <code>Sprites/Particles/music</code> (music note sprites) using a color of a RainbowColor from 0 to 9 variants and a SpinAround with an <code>itself</code> of (0.0, 0.0, 2.0) 35 (20 instead if hardmode is true) 0.0 null null <code>PingShot</code> null Vector3.zero false <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>Prefabs/Particles/MusicSimple</code> instantiated near this enemy</li> <li>animstate set to 103</li> <li>All <code>Sprites/Particles/music</code> preloaded</li> <li><code>StatUp2</code> sound plays</li> <li>GetSingleTarget called</li> <li>The amount of hits is determined which is random between 1 and 3 times inclusive (between 2 and 3 times inclusive instead if hardmode is true)</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>Yield for 0.5 seconds</li> <li>For each hit to do:<ul> <li><code>PingUp</code> sound plays</li> <li>A new GameObject with a SpriteRenderer is created using a random sprite from <code>Sprites/Particles/music</code> using a color of RainbowColor from 0 to 9 variants (determined at random) and a SpinAround with an <code>itself</code> of (0.0, 0.0, 2.0). The object is positioned at the this enemy + (0.0, 2.0, 0.1)</li> <li>Over the course of 20.0 frames, the music note moves to 3.0 in y and 0.1 in z via a lerp and has its SpinAround's <code>itself</code>'s z changed to 15.0 via a lerp. For the new x position, it's positioned such that it is equidistant horizontally at the entity's x position -2.0 </li> </ul> </li> <li><code>Prefabs/Particles/MusicSimple</code> positioned offscreen and destroyed in 2.0 seconds</li> <li>animstate set to 101</li> <li>Yield for 0.5 seconds</li> <li>For each hit to do<ul> <li><code>Ping</code> sound plays with a pitch of 1.0 + the hit index starting from 0 * 0.1</li> <li>Projectile 1 call happens</li> <li>Yield for 0.7 seconds</li> </ul> </li> <li>Yield all frames until all projectiles fired are destroyed (All Projectile call completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#move-2-kick-attack","title":"Move 2 - Kick attack","text":"<p>A single target kick attack that may hit multiple times</p> <p>This may redirect to move 1-2 (either music note throws moves), check the move selection section above for details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#about-nonphyscal-incorrectly-being-set-to-true","title":"About <code>nonphyscal</code> incorrectly being set to true","text":"<p>If this move is performed as a result from a redirection of move 4 or 5 (singing or relay), <code>nonphysical</code> will be set to true, but this move was never supposed to do this meaning this is undesired. This will incorrectly affect the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null if <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE) and {NoDamageAnim} if it's true <code>commandsuccess</code> 2 Only happens if <code>commansuccess</code> was false (didn't blocked, ignores FRAMEONE) in DoDamage 1 and if it was, it is done 3 times null The same as DoDamage 1 1 null null false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>MoveTowards <code>playertargetentity</code> + (0.6, 0.0, -0.15) with a 1.5 multiplier with 100 walkstate and 104 stop state</li> <li>Yield for a frame</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Camera stops targetting anyone</li> <li>Yield for 0.1 seconds</li> <li><code>MothivaKick</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE):<ul> <li>Yield for a frame</li> <li><code>Turn</code> sound plays</li> <li>Camera moves slighly down and forward</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>playertargetentity</code> has Jump called on them with an h of 15.0</li> <li><code>playertargetentity</code> y <code>spin</code> set to -15.0</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until <code>playertargetentity</code> is <code>onground</code></li> <li>Yield for a frame</li> <li><code>Death3</code> sound plays</li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li><code>playertargetentity</code> has FlipAngle called on them with setangle</li> <li><code>playertargetentity</code> animstate set to 18 (<code>KO</code>)</li> <li>DeathSmoke particles plays at <code>playertargetentity</code></li> <li>ShakeScreen for 0.1 time</li> <li>Yield for 0.5 seconds</li> <li>Done 3 times:<ul> <li>animstate set to 106</li> <li>Yield for 0.15 seconds</li> <li>animstate set to 107</li> <li>DoDamage 2 call happens</li> <li><code>playertargetentity</code> has ShakeSprite called on them for (0.1, 0.0, 0.0) intensity and 0.1 frametimer</li> <li>Camera moves slightly down and forward</li> <li>Yield for 0.235 seconds</li> </ul> </li> <li>Yield for 0.75 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#move-3-singing","title":"Move 3 - Singing","text":"<p>Sings which inflicts the DefenseUp condition to Zasp. No damages are dealt.</p> <p>This may redirect to move 1-2 or 3 (either music note throw moves or kick), check the move selection section above for details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any targets.</p> <p>NOTE: It also incorrectly affects move 3 (kick) if redirected to it from this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of Zasp is obtained</li> <li>animstate set to 103</li> <li><code>Prefabs/Particles/MusicSimple</code> instantiated and positioned near this enemy</li> <li><code>StatUp2</code> sound plays</li> <li>Yield for 1 second</li> <li><code>Zasp</code> animstate set to 106</li> <li><code>BugWingFast</code> sound plays</li> <li><code>StatUp</code> sound plays</li> <li>SetCondition called on <code>Zasp</code> to inflict the DefenseUp condition for 2 turns (effectively 1 turn since the main turn gets advanced soon after)</li> <li>StatEffect on <code>Zasp</code> with type 0 (blue up arrow)</li> <li>Yield for 0.65 seconds</li> <li><code>Prefabs/Particles/MusicSimple</code> positioned offscreen and destroyed in 2.0 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#move-4-relay","title":"Move 4 - Relay","text":"<p>Relay her turn which gives an actor turn to Zasp. No damages are dealt.</p> <p>This may redirect to move 1-2 or 3 (either music note throw moves or kick), check the move selection section above for details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#nonphyscal-set-to-true_3","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any targets.</p> <p>NOTE: It also incorrectly affects move 3 (kick) if redirected to it from this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>The <code>enemydata</code> index of Zasp is obtained</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li><code>Zasp</code> animstate set to 2 (<code>Jump</code>)</li> <li>y <code>spin</code> set to 15.0</li> <li><code>Zasp</code>'s y <code>spin</code> set to 15.0</li> <li><code>Zasp</code>'s <code>cantmove</code> decremented which gives them an extra actor turn</li> <li><code>Relay</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>spin</code> zeroed out</li> <li><code>Zasp</code>'s <code>spin</code> zeroed out</li> <li><code>Zasp</code> animstate set to its <code>basestate</code></li> <li>animstate set to the <code>basestate</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#move-5-revive","title":"Move 5 - Revive","text":"<p>Revives Zasp from the <code>reservedata</code></p> <p>This may redirect to move 3 (kick), check the move selection section above for details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#nonphyscal-set-to-true_4","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any targets.</p> <p>Unlike move 4 and 5 (singing and relay), it won't incorrectly affect move 3 (kick) if redirected to it from this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mothiva1/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li>If <code>data[0]</code> is 0 (no revives was done before):<ul> <li>SetText called in dialogue mode with the following:<ul> <li>text: <code>commondialogue[95]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>cameraoffset: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: this enemy</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li><code>data[0]</code> incremented (the amount of time this move was used)</li> <li><code>MothivaRes</code> sound plays</li> <li>animstate set to 103</li> <li><code>Prefabs/Particles/MusicSimple</code> instantiated and positioned near this enemy</li> <li>Over the course of 40.0 frames, all Light under the <code>battlemap</code> has their intensity changed to be halved via a lerp</li> <li>ReviveEnemy called with Zasp's <code>reservedata</code> index leaving them with of 20% of <code>hp</code> ceiled without canmove</li> <li>The <code>enemydata</code> index of <code>Zasp</code> is obtained</li> <li><code>Prefabs/Objects/Spotlight</code> instantiated near <code>Zasp</code></li> <li>Yield for 1 second</li> <li><code>Heal</code> sound plays</li> <li>ShowDamageCounter called with type 1 (HP counter) with an ammount of <code>Zasp</code>'s <code>hp</code> starting at (0.0, 2.0, 0.0) and ending at (0.0, 1.0, 0.0)</li> <li>Yield for 0.6 seconds</li> <li><code>Zasp</code> animstate set to 105</li> <li>Yield for a second</li> <li><code>Zasp</code> animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>Prefabs/Objects/Spotlight</code> destroyed</li> <li><code>Prefabs/Particles/MusicSimple</code> positioned offscreen and destroyed in 2.0 seconds</li> <li>Over the course of 40.0 frames, all Light under the <code>battlemap</code> has their intensity changed to be their value before this action via a lerp</li> <li>All Light under the <code>battlemap</code> has their intensity set to be their value before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MrTester/","title":"<code>MrTester</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/MrTester/#about-this-enemy","title":"About this enemy","text":"<p>This isn't an enemy meant to be encountered under normal gameplay, but it does exist and has an action implementation. However, this implementation just heals their <code>hp</code> and the player party's <code>tp</code> with no way to attack. Since it is meant for this enemy to have high <code>hp</code>, it is effectively not defeatable normally.</p> <p>The purpose of such an enemy is for testing purposes only since it allows to attack someone without having to restart a battle due to the enemy dying.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MrTester/#move-selection","title":"Move selection","text":"<p>1 move is possible:</p> <ol> <li>Heals their <code>hp</code> to their <code>maxhp</code> as well as the player party's <code>tp</code> to their <code>maxtp</code></li> </ol> <p>Move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MrTester/#move-1-healing","title":"Move 1 - Healing","text":"<p>Heals their <code>hp</code> to their <code>maxhp</code> as well as the player party's <code>tp</code> to their <code>maxtp</code>. No damages are dealt</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/MrTester/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>hp</code> set to <code>maxhp</code></li> <li>HealParticle plays at this enemy with a size of Vector3.one and an offset of Vector3.up</li> <li><code>Heal</code> sound plays</li> <li>ShowDamageCounter called with type 1 (HP counter), an ammount of this enemy's <code>maxhp</code> starting at this enemy position + 2.0 in y and ending at this enemy position + 5.0 in y</li> <li>Yield for 0.5 seconds</li> <li>ShowDamageCounter called with type 2 (TP counter), an ammount of 99 starting at the front player party member + 2.0 in y and ending at the front player party member + 5.0 in y </li> <li>instance.<code>tp</code> set to instance.<code>maxtp</code></li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/","title":"<code>Mushroom</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#randomposafter-set-to-true","title":"randomposafter set to true","text":"<p>This enemy action always sets the randomposafter local to true. This means that in post-action when no enemy fled, this enemy's position will be randomly determined between <code>Ground</code> and <code>Flying</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The move selection odds changes to be uniform odds to use any moves instead of being biased towards the aerial spin attack</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target aerial spin attack</li> <li>A single target poison bubble throw</li> </ol> <p>The decision of which move to use depends on odds, but the odds changes if hardmode is true. Here are the odds in either situations:</p> Move Odds when hardmode is false Odds when hardmode is true 1 67% 33% 2 50% 50%"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#move-1-aerial-spin","title":"Move 1 - Aerial spin","text":"<p>A single target aerial spin attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Fly</code> sound played on loop using <code>sounds[8]</code> with 0.5 pitch</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>position changes to <code>Flying</code></li> <li><code>height</code> set to 0.125</li> <li><code>Idlef</code> animation clip plays on <code>anim</code></li> <li><code>flyinganim</code> set to true</li> <li>SetAnimForce called</li> <li>Over the course of a maximum of 60.0 frames, this enemy moves to <code>playerdata[playertargetID]</code> position + (3.0, 3.25, 0.3333334) via lerp with a factor of 0.05 the game's frametime. This stops on the first frame this enemy is at a distance of 0.3 or below from the target position. Before each frame yield, the <code>Idlef</code> animation clip plays on <code>anim</code></li> <li>x and z angles of <code>sprite</code> set to 0.0</li> <li>animstate set to 101</li> <li><code>Woosh2</code> sound plays</li> <li><code>sounds[8]</code> stopped</li> <li>Yield all frames until this enemy y position reaches <code>playerdata[playertargetID]</code>'s y position + 2.15 or below. On each frame, this enemy y position decreases by 0.05 the game's frametime</li> <li>animstate set to 100</li> <li>y <code>spin</code> set to 25.0</li> <li><code>Spin</code> sound plays on loop using <code>sounds[9]</code> at 0.8 pitch and 0.6 volume</li> <li>Yield all frames until this enemy x position reaches <code>playerdata[playertargetID]</code>'s x position - 2.3 or below. On each frame, this enemy moves to <code>playerdata[playertargetID]</code> position + (2.0, 0.4, 0.0) via a lerp with a factor of 0.05 of the game's frametime. On the first frame this enemy x position becomes lower than <code>playerdata[playertargetID]</code> x position - 0.1, DoDamage 1 call happens</li> <li><code>sounds[9]</code> stops</li> <li><code>height</code> set to 2.0</li> <li>Yield for 0.1 seconds</li> <li><code>sprite</code> angles reset to Vector3.zero</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#move-2-poison-bubble-throw","title":"Move 2 - Poison bubble throw","text":"<p>A single target poison bubble throw</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Poison null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Mushroom/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Yield all frames until <code>height</code> becomes 0.1 or below. On each frame:<ul> <li>animstate set to 3 (<code>Fall</code>)</li> <li><code>height</code> decreases by 0.07 * the game's frametime</li> </ul> </li> <li>position changed to <code>Ground</code></li> <li>Camera moves to look at this enemy, but zoomed in</li> <li><code>height</code> set to 0.0</li> <li>animstate set to 102</li> <li><code>Charge</code> sound plays with 0.8 pitch</li> <li>Yield for 1.25 seconds</li> <li>animstate set to 104</li> <li><code>Prefabs/Objects/PoisonBubble</code> instantiated at this enemy position + 2.0 in y</li> <li>SeDefaultCamera called</li> <li><code>Blosh</code> sound plays</li> <li><code>Wub</code> sound plays on loop using <code>sounds[9]</code> with 0.7 pitch</li> <li>Over the course of 60.0 frames the <code>Prefabs/Objects/PoisonBubble</code> moves to <code>playerdata[playertargetID]</code> position + 1.0 in y via a BeizierCurve3 with a ymax of 5.0</li> <li><code>sounds[9]</code> stopped</li> <li><code>BubbleBurst</code> sound plays</li> <li><code>PoisonEffect</code> particles plays at the <code>playertargetentity</code> position</li> <li>DoDamage 1 call happens</li> <li><code>Prefabs/Objects/PoisonBubble</code> destroyed</li> <li>Yield for 0.75 seconds</li> <li>Yield for 0.1 seconds</li> <li><code>sprite</code> angles reset to Vector3.zero</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/","title":"<code>PeacockSpider</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy is initially fought alone. This is because most of this enemy's moves directly impacts the first <code>enemydata</code> that isn't themselves which is intended to be summoned by this enemy. It is possible that inconsistent behaviors occurs if this enemy isn't fought alone initially.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>At the start of the action, if this enemy is the last <code>enemydata</code> remaining, the enemy they will summon is always going to be a DivingSpider instead of only being one when HPPercent is less than 0.5 and being a JumpingSpider when it is 0.5 or above</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#move-selection","title":"Move selection","text":"<p>6 moves are possible:</p> <ol> <li>Heals the enemy party member this enemy summoned</li> <li>Inflicts an infinite AttackUp condition on the enemy party member this enemy summoned</li> <li>Inflicts an infinite DefenseUp condition on the enemy party member this enemy summoned</li> <li>Sets the <code>charge</code> of the enemy party member this enemy summoned to 2</li> <li>Sets the <code>moves</code> of the enemy party member this enemy summoned to 2 which grants them 2 actor turns per main turns (excluding the current main turn)</li> <li>A single target triple slash attack</li> </ol> <p>The decision of which move to use is based on odds, but each moves except move 6 has an additional requirement that must be fufilled for the move to be used after it is selected. If the requirement isn't fufilled, the move is rerolled with the same odds. If the requirement is still failed after the second attempt, move 6 will be used. Here are the odds and requirements of each moves:</p> Move Odds Requirement 1 3/12 HPPercent is 0.65 or less 2 2/12 The enemy party member this enemy summoned doesn't already have the AttackUp condition 3 2/12 The enemy party member this enemy summoned doesn't already have the DefenseUp condition 4 2/12 The enemy party member this enemy summoned has a <code>charge</code> of 0 5 2/12 The enemy party member this enemy summoned has a <code>moves</code> of 1 6 1/12 None, the move is always used when selected"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#pre-move-logic","title":"Pre move logic","text":"<p>There is logic that is always performed at the start of the action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Happens only if the summoned enemy IsStopped null The summoned enemy party member 1 (this cannot be lethal to the target as enforced after the call) NoExceptions null false"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#logic-sequence","title":"Logic Sequence","text":"<ul> <li>If this enemy is the last <code>enemydata</code> remaining, an enemy will be summoned:<ul> <li>animstate set to 101</li> <li><code>PeacockSpiderNPCSummon</code> sound plays</li> <li><code>checkingdead</code> is set to a new SummonEnemy call to summon an enemy with the type <code>Offscreen</code> at Vector3.zero. The enemy to summon is always a DivingSpider unless hardmode is false and HPPercent is 0.5 or above where the enemy is a JumpingSpider</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li><code>PeacockSpiderNPCSummonSuccess</code> sound plays</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>flip</code> set to false</li> <li>Jump called on this enemy</li> <li>Yield for 0.5 seconds</li> <li>The <code>exp</code> of the summoned enemy is clamped from 0 to 3</li> </ul> </li> <li>The first enemy party member who isn't this enemy is obtained which should always be the one that was just summoned or already summoned before and no one else. This will be used throughout the action</li> <li>If the summoned enemy IsStopped, they will be cured of their condition with the following:<ul> <li><code>PeacockSpiderSlapAtkRaise</code> sound plays</li> <li>animstate set to 5 (<code>Angry</code>)</li> <li>Yield for 0.5 seconds</li> <li><code>PeacockSpiderSlapAtk</code> sound plays</li> <li>animstate set to 102</li> <li>ClearStatus called on the summoned enemy</li> <li>DoDamage 1 call happens</li> <li>If the summoned enemy's <code>hp</code> is 0 or below, it is set to 1 (meaning DoDamage 1 cannot be lethal to them)</li> <li>The summoned enemy's <code>cantmove</code> is set to 0 meaning they can act on this main turn after this enemy's action is done</li> <li>Yield for a second</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#move-1-heal-the-summoned-enemy","title":"Move 1 - Heal the summoned enemy","text":"<p>Heals the enemy party member this enemy summoned. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>A new <code>Prefabs/Particles/MagicConstant</code> GameObject is created rooted at this enemy position with a scale of 2.0x</li> <li><code>PeacockSpiderNPCBuff</code> sound plays</li> <li><code>Prefabs/Particles/MagicConstant</code>'s ParticleSystem's MainModule's startColor is set to a constant color curve with a value of pure red with 0.5 opacity</li> <li>animstate set to 103</li> <li>Camera moves to loop between this enemy and the summoned enemy with a bias towards this enemy</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li>Heal called to heal the summoned enemy to an amount of <code>hp</code> equal to their <code>maxhp</code> * 0.15 ceiled</li> <li><code>Prefabs/Particles/MagicConstant</code> moved offscreen at -9999.0 in y then destroyed in 2.0 seconds</li> <li>Yield for 1 second</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#move-2-infinite-attackup-on-the-summoned-enemy","title":"Move 2 - Infinite AttackUp on the summoned enemy","text":"<p>Inflicts an infinite AttackUp condition on the enemy party member this enemy summoned. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>A new <code>Prefabs/Particles/MagicConstant</code> GameObject is created rooted at this enemy position with a scale of 2.0x</li> <li><code>PeacockSpiderNPCBuff</code> sound plays</li> <li><code>Prefabs/Particles/MagicConstant</code>'s ParticleSystem's MainModule's startColor is set to a constant color curve with a value of FF4C00 (mostly red) with 0.5 opacity</li> <li>animstate set to 100</li> <li>Camera moves to loop between this enemy and the summoned enemy with a bias towards this enemy, but zoomed in</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li>StatusEffect called to inflict the AttackUp condition on the summoned enemy for 999999 main turns (infinite) with effect</li> <li><code>Prefabs/Particles/MagicConstant</code> moved offscreen at -9999.0 in y then destroyed in 2.0 seconds</li> <li>Yield for 1 second</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#move-3-infinite-defenseup-on-the-summoned-enemy","title":"Move 3 - Infinite DefenseUp on the summoned enemy","text":"<p>Inflicts an infinite DefenseUp condition on the enemy party member this enemy summoned. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>A new <code>Prefabs/Particles/MagicConstant</code> GameObject is created rooted at this enemy position with a scale of 2.0x</li> <li><code>PeacockSpiderNPCBuff</code> sound plays</li> <li><code>Prefabs/Particles/MagicConstant</code>'s ParticleSystem's MainModule's startColor is set to a constant color curve with a value of pure blue with 0.5 opacity</li> <li>animstate set to 100</li> <li>Camera moves to loop between this enemy and the summoned enemy with a bias towards this enemy, but zoomed in</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li>StatusEffect called to inflict the DefenseUp condition on the summoned enemy for 999999 main turns (infinite) with effect</li> <li><code>Prefabs/Particles/MagicConstant</code> moved offscreen at -9999.0 in y then destroyed in 2.0 seconds</li> <li>Yield for 1 second</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#move-4-charge-of-the-summoned-enemy-set-to-2","title":"Move 4 - <code>charge</code> of the summoned enemy set to 2","text":"<p>Sets the <code>charge</code> of the enemy party member this enemy summoned to 2. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>A new <code>Prefabs/Particles/MagicConstant</code> GameObject is created rooted at this enemy position with a scale of 2.0x</li> <li><code>PeacockSpiderNPCBuff2</code> sound plays</li> <li><code>Prefabs/Particles/MagicConstant</code>'s ParticleSystem's MainModule's startColor is set to a constant color curve with a value of pure green with 0.5 opacity</li> <li>animstate set to 101</li> <li>Camera moves to loop between this enemy and the summoned enemy with a bias towards this enemy, but zoomed in</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li>The summoned enemy's <code>charge</code> is set to 2</li> <li>StatEffect called on the summoned enemy with type 4 (green up arrow)</li> <li><code>Prefabs/Particles/MagicConstant</code> moved offscreen at -9999.0 in y then destroyed in 2.0 seconds</li> <li>Yield for 1 second</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#move-5-moves-of-the-summoned-enemy-set-to-2","title":"Move 5 - <code>moves</code> of the summoned enemy set to 2","text":"<p>Sets the <code>moves</code> of the enemy party member this enemy summoned to 2 which grants them 2 actor turns per main turns (excluding the current main turn). No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li>A new <code>Prefabs/Particles/MagicConstant</code> GameObject is created rooted at this enemy position with a scale of 2.0x</li> <li><code>PeacockSpiderDoubleTurnDance</code> sound plays</li> <li><code>Prefabs/Particles/MagicConstant</code>'s ParticleSystem's MainModule's startColor is set to a constant color curve with a value of FFBF00 (mostly orange) with 0.5 opacity</li> <li>animstate set to 101</li> <li>Camera moves to loop between this enemy and the summoned enemy with a bias towards this enemy, but zoomed in</li> <li>Yield for a second</li> <li>Yield for 0.5 seconds</li> <li>The summoned enemy's <code>moves</code> is set to 2 which grants them 2 actor turns per main turns (excluding the current main turn)</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on the summoned enemy with type 5 (yellow up arrow)</li> <li><code>Prefabs/Particles/MagicConstant</code> moved offscreen at -9999.0 in y then destroyed in 2.0 seconds</li> <li>Yield for 1 second</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#move-6-triple-slash-attack","title":"Move 6 - Triple slash attack","text":"<p>A single target triple slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 3 times This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PeacockSpider/#logic-sequence_6","title":"Logic sequence","text":"<p>It is possible that a new <code>Prefabs/Particles/MagicConstant</code> GameObject is created rooted at this enemy position with a scale of 2.0x if this move is used after failing to use another move twice in a row. If this is the case, the GameObject gets destroyed first.</p> <p>Here's the rest of the move logic:</p> <ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>PeacockSpiderSlapAtkRaise</code> sound plays</li> <li>animstate set to 5 (<code>Angry</code>)</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (0.2, 1.5, -0.2) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>Done 3 times:<ul> <li><code>PeacockSpiderSlapAtk</code> sound plays</li> <li>animstate set to 102 (except for the second hit where it's set to 104 instead)</li> <li><code>model</code> y angle set to 30.0 (except for the second hit where it's set to -30.0 instead)</li> <li>DoDamage 1 call happens</li> <li>Camera zooms in a bit</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.1 seconds</li> </ul> </li> <li><code>model</code> angles reset to Vector3.zero</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/","title":"<code>Pisci</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy is fought alongside Cenn as they have several interactions together that would work unexpectedly if a fight is started without the presence of both enemy party members at once.</p> <p>It is also assumed that this enemy is loaded with their eventondeath set to the proper EventDialogue because it allows the first fight to end early in case this enemy dies before their HPPercent becomes lower than 0.5. On the second fight, the StartBattle logic will disable it.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>This enemy has special logic after being loaded in StartBattle:</p> <ul> <li>If flags 497 is true (after beating Cenn and <code>Pisci</code> the first time):<ul> <li><code>eventondeath</code> is set to -1 which disables their EventDialogue</li> </ul> </li> <li>Otherwise (the player is fighting them for the first time):<ul> <li>AlwaysSurvive is added to this enemy's weakness</li> </ul> </li> <li><code>battlepos</code> is increased by 1.0 in x</li> <li>position is set to the new <code>battlepos</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: A cooldown for using the <code>PisciWall</code> summon moves. When the move is used, the value is set to 2 and it gets decremented in the pre move logic if it is higher than 0. The summon move only becomes usable again if the value is 0 by the time the move selection process occurs and the enemy isn't present already. Effectively, it's an antispam of 1 actor turn on the move's usage</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to heal Cenn by 4 <code>hp</code> when their HPPercen is lower than 0.75 in the pre move logic changes to 41% from 31%</li> <li>In the rocks projectiles throw move, the amount of hits to do changes to be random between 2 and 3 instead of being random between 2 and 4</li> <li>In the rocks projectiles throw move, the speed of each Projectile calls changes to be random between 38.0 and 44.0 instead of being always 47.5</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A multiple targets rocks projectiles throw</li> <li>Summons a <code>PisciWall</code> enemy</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 1/2 2 1/2 <p>However, if move 2 is selected and a <code>PisciWall</code> is already present or that <code>data[0]</code> is higher than 0 (meaning the cooldown on it hasn't expired yet), move 1 will be used instead.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before using a move. It's in 4 parts done in order: <code>data[0]</code> decrement, the first fight event logic, the infinite AttackUp condition logic and the healing Cenn logic.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#data0-decrement","title":"<code>data[0]</code> decrement","text":"<p>This part only happens if <code>data[0]</code> is higher than 0 (the <code>PisciWall</code> summon cooldown hasn't expired yet):</p> <ul> <li><code>data[0]</code> gets decremented which is the actor turn cooldown on summoning a <code>PisciWall</code> enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#first-fight-event-logic","title":"First fight event logic","text":"<p>This part only happens if flags 497 is false meaning this is the first time to player fights Cenn and <code>Pisci</code>:</p> <ul> <li>If HPPercent of this enemy or Cenn is lower than 0.5 (if they are present):<ul> <li>EventDialogue 15 is triggered</li> </ul> </li> <li>Yield all frames until <code>inevent</code> is false (if the EventDialogue above was triggered, it effectively stalls DoAction entirely until the battle almost ends)</li> </ul> <p>NOTE: If the EventDialogue is triggered here, it won't prevent DoAction from running while ReturnToOverworld without flee is ongoing. This creates a problem because the EventDialogue runs a ReorganizeEnemies which clears <code>enemeydata</code> due to killing Cenn and <code>Pisci</code> and all this happens BEFORE DoAction gets to resume. Since DoAction can't operate on an empty <code>enemydata</code>, it will immediately throw an IndexOutOfRange excpetion. Fortunately, this throw is inconsequential because ReturnToOverworld is still ongoing and the battle would already be in a terminal flow by this point. Effectively, the battle will still end without consequences because DoAction can't race against this process anyway before it throws and gets destroyed due to the battle teardown process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#infinite-attackup-condition-logic","title":"Infinite AttackUp condition logic","text":"<p>This part only happens if Cenn is not present in the enemy party and that this enemy doesn't already have the AttackUp condition:</p> <ul> <li><code>Wam</code> sound plays</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote for 30 time</li> <li>Yield for 0.5 seconds</li> <li>StatusEffect called to inflict the AttackUp condition on this enemy for 999 main turns (effectively infinite) with effect</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#healing-cenn-logic","title":"Healing Cenn logic","text":"<p>This part happens if all of the following conditions are fufilled:</p> <ul> <li><code>Cenn</code> is present</li> <li><code>Cenn</code>'s HPPercent is less than 0.75</li> <li>A 31% RNG check passes (41% instead if hardmode is true)</li> </ul> <p>If all of the above are fufilled:</p> <ul> <li><code>Ping2</code> sound plays</li> <li>Emoticon called on this enemy with the <code>Exclamation</code> emote for 30 time</li> <li>Yield for 0.5 seconds</li> <li>A new sprite object is created childed to the <code>battlemap</code> using the <code>CrunchyLeaf</code> item sprite positioned at this enemy position + its <code>cursoroffset</code> + (-0.4, -0.1, -0.1)</li> <li>animstate set to 4 (<code>Angry</code>)</li> <li><code>ItemHold</code> sound plays</li> <li>Yield for a second</li> <li>The item sprite gets destroyed</li> <li>animstate set to the local startstate</li> <li>Heal called to heal <code>Cenn</code> by 4 <code>hp</code></li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#move-1-rocks-projectiles-throw","title":"Move 1 - Rocks projectiles throw","text":"<p>A multiple targets rocks projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 to 4 times (2 to 3 times instead if hardmode is true), but the call and further calls won't happen if there's not at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 2 null This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new sprite object rooted using the <code>MightyPeeble</code> medal sprite positioned at this enemy position + (-0.5, 1.5, -0.1) with a scale of 0.85x 47.5 (random between 38.0 and 44.0 instead if hardmode is true) 3.5 null null null null (0.0, 0.0, 25.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called (but this call won't do anything)</li> <li>Camera moves to look near the midpoint between this enemy and <code>playerdata[playertargetID]</code></li> <li>The amount of hits is determined. It's random between 2 and 4 inclusive (between 2 and 3 inclusive instead if hardmode is true). A SpriteRenderer array is initialised with this amount as the length to hold the projectiles objects</li> <li>For each hit to do, if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>animstate set to 100</li> <li><code>Toss13</code> sound plays</li> <li>Yield for 0.166 seconds</li> <li>The projectile element is set to a new sprite object rooted using the <code>MightyPeeble</code> medal sprite positioned at this enemy position + (-0.5, 1.5, -0.1) with a scale of 0.85x</li> <li>Projectile 1 call happens</li> <li>Yield for a random interval between 0.45 and 0.65 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for a frame</li> </ul> </li> <li>Yield all frames until all projectiles objects are null (all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#move-2-pisciwall-summon","title":"Move 2 - <code>PisciWall</code> summon","text":"<p>Summons a <code>PisciWall</code> enemy. No damages are dealt.</p> <p>The <code>PisciWall</code> is an enemy that has no action logic and thus doesn't need a documentation page. Its only purpose is to be hinderance since it is always the first enemy party member whose poisition is <code>Ground</code> which affects some player actions's targetting.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pisci/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>data[2]</code> is set to 2 (prevents the usage of this move on the next actor turn if <code>PisciWall</code> isn't present by that time)</li> <li>MoveTowards (-0.15, 0.0, 0.0) with 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 101 as stopstate</li> <li>Camera moves to look near <code>forcetarget</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Dig2</code> sound plays with 0.7 pitch</li> <li><code>ContinuousSmokeSphere</code> particles plays at this enemy position with -1 alivetime and 0.5x scale</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a <code>PisciWall</code> with type <code>FromGroundKeepScale</code> at (-0.25, 0.0, -0.1)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li><code>enemydata[lastaddedid]</code>'s diebyitself is set to true which allows CheckDead to kill the summoned enemy if they are the only one remaining in the enemy party</li> <li>The <code>ContinuousSmokeSphere</code> particles gets moved offscreen at -9999.0 in y then destroyed in 2.0 seconds</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/","title":"<code>Pitcher</code>","text":"<p>NOTE: This enemy is involved in the complexities of the Eaten condition. It is recommended to check the condition's documentation to learn more on how it involves this enemy.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy has its eventondeath set to the matching EventDialogue as otherwise, the Eating system can break when this enemy dies with a non null <code>ate</code>.</p> <p>It is also assumed that this enemy is fought alone otherwise, his PitcherFlytrap summoning in the post move won't work correctly. It may also badly affect the value of <code>playertargetID</code> when deciding whether or not to eat after using the slam attack move if this enemy isn't intially fought alone.</p> <p>It is also assumed this enemy is loaded with the <code>Pitcher</code> animid because the eating logic assumes the presence of <code>extra[0]</code> which is initialised by CheckSpecialID for this animid.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>There is special logic in StartBattle that applies to this enemy after it is loaded:</p> <ul> <li>This enemy x position is increased by 1.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 3 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: A cooldown for summoning a PitcherFlytrap in the post move. When a summon happens in the post move, the value is set to 2 (1 instead if hardmode is true). After a move is used in the post move logic, if the value is above 0, it is decremented and a delayed projectile may happen instead. This also happens if there's already 3 or more <code>enemydata</code>. For the summon to be usable again when there's less than 3 <code>enemydata</code>, the value needs to be 0 or below. Essentially, it enforces a 2 actor turns (1 instead if hardmode is true) time where this enemy can't summon again</li> <li><code>data[1]</code>: A cooldown for launching a delayed projectile in the post move. When delayed projectile is launched in the post move, the value is set to a random number between 2 and 3 inclusive. If it was decided that a PitcherFlytrap summon won't happen in the post move, a delayed projectile will be launched, but only if this value is 0 or below. If it's not, it will be decremented instead. Essentially, it block the next 2 or 3 times to launch a delayed projectile if it otherwise would have happened</li> <li><code>data[2]</code>: A cooldown for usage of the slam and eat move. See the section below for details as there's many caveats related to this value.</li> <li><code>data[3]</code>: An actor turn countdown that tracks how many actor turns are left for the eaten player party member to be spit out (excludes the actor turn when the eating occurs). The value starts at 3 when this enemy eats a player party member (tracked by <code>ate</code>). At the end of the action in the post move logic except for the actor turn the eating happened, if this enemy <code>ate</code> a player party member and this value is above 0, it is decremented. If this decrement made the value 0, the player party member will be spit out. Effectively, this enforces that a player party member won't stay eaten for longer than 3 full actor turns spent by this enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#about-data2","title":"About <code>data[2]</code>","text":"<p>This value behaves in unexpected ways. It's supposed to be an antispam for the usage of the slam and eat move, but it only works partially.</p> <p>The main logic this value modifies is that the slam and eat move requires this value to be 0 or below. If this isn't the case, the move cannot be used even when selected.</p> <p>However, the way this value behaves extremely inconsistently and in complicated ways. Here's how it flows:</p> <ul> <li>Everytime the move is used, the value is set to 1 if HPPercent is 0.7 or above. Otherwise, the value is set to 2</li> <li>In the post move logic, the value is decremented if it is above 0, but only if <code>ate</code> isn't null meaning this enemy actually ate a player party members. This means some things:<ul> <li>If the value was set to 1, it won't have any effects. This is because if it was, it wouldn't have been possible for the eating part of the move to happen so it will always be decremented to 0 which makes the slam move usable again. Essentially, if HPPercent is 0.7 or above, the value does nothing</li> <li>If the value was set to 2, but the enemy decided to not eat, then it will prevent the slam move to be used on the next actor turn only (after that actor turn, the move becomes usable again). This can only happen if only 1 player party member was alive when the move was used (<code>hp</code> above 0 and not eatenby) or the selected <code>playerdata[playertargetID]</code> for eating had an <code>hp</code> of exactly 1</li> <li>If the value was set to 2 and the enemy decided to eat, it will never get decremented until <code>ate</code> goes to null which can only happen when SpitOut gets called either by this enemy or their EventDialogue. Effectively, it completely prevents usage of the move until the player party member is spit out so in this case, the value 2 doesn't mean anything, only that it is still above 0</li> </ul> </li> <li>When the <code>data[3]</code> countdown reaches 0 in the postmove while this enemy is still eating a player party member, <code>data[2]</code> is set to 0. This unlocks the usage of the slam move</li> <li>If SpitOut was called before <code>data[3]</code> countdown expires (happens when the player party member died during the Eaten condition's turn advance after sustaining the damages), <code>data[2]</code> won't change. This means several things:<ul> <li>It now means that the slam move still won't be usable for the next 2 actor turns because its value wasn't ever decremented and spitting the player party member out now allows the post move logic to decrement it again. Essentially, it will prevent the slam move to be used 2 actor turns after the player party member is spit out by the EventDialogue</li> <li>The source of the SpitOut call influences when the move will become usable again. If this enemy spits out, it becomes immediately usable again, but if the EventDialogue did, this enemy still needs to spend 2 actor turns after the spit before being able to use the move</li> </ul> </li> </ul> <p>Here's the summary of everything above:</p> <ul> <li>If HPPercent is 0.7 or above, <code>data[2]</code> does nothing</li> <li>If HPPercent is lower than 0.7 and the slam move was used, but this enemy decided to not eat, the move won't be usable for the next 1 actor turn. This can only happen if only 1 player party member was alive when the move was used (<code>hp</code> above 0 and not eatenby) or the selected <code>playerdata[playertargetID]</code> for eating had an <code>hp</code> of exactly 1</li> <li>If HPPercent is lower than 0.7, the slam move was used and this enemy decided to eat, then the move becomes unusable until the player party member is spit out. The exact moment the move becomes usable however depends on how the SpitOut call happened:<ul> <li>If it happened from this enemy as a result of the <code>data[3]</code> cooldown expiring, the move immediately becomes usable once this happens</li> <li>If it happened from the EventDialogue (meaning the player party member died during the Eaten condition's turn advance after sustaining the damages), the move can only becomes usable after 2 actor turns passed</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The value <code>data[0]</code> is set to when summoning a PitcherFlytrap in the post move logic changes to 1 from 2. This decreases the amount of actor turn this enemy won't be able to summon again to 1 from 2</li> <li>The framespeed of each AddDelayedProjectile done in the postmove changes to 35.0 from 42.0</li> <li>In the bubbles projectiles throw move, the speed of each Projectile calls changes to 19.0 from 25.0</li> <li>In the poison breath attack move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the poison breath attack move, the damageammount of each DoDamage calls changes to 2 from 3</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A multiple targets poison bubbles projectiles throw</li> <li>A party wide slam attack that may Eat a player party member</li> <li>A party wide poison breath attack</li> </ol> <p>Move 2 is always used if all of the following conditions are true:</p> <ul> <li>The current map is the <code>TestRoom</code> </li> <li><code>ate</code> is null (isn't eating anyone)</li> <li><code>data[2]</code> is 0 or below (move 2's cooldown expired)</li> </ul> <p>Otherwise, the decision of which move to use is based on odds, but the odds changes depending on if HPPercent is at least 0.5 or not. Here are the odds in either situations:</p> Move Odds when HPPercent &gt;= 0.5 Odds when HPPercent &lt; 0.5 1 5/11 2/10 2 3/11 6/10 3 3/11 2/10 <p>However, if move 2 is selected and <code>ate</code> isn't null (eating someone) or <code>data[2]</code> is above 0 (the cooldown on the usage of the move hasn't expired yet), a continue directive is issued to the enemy action loop which restarts the whole action and effectively rerolls the move selection process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen after using a move. It's split in 4 parts done in order: <code>data[2]</code> decrement, PitcherFlytrap summon, delayed projectile launch and SpitOut.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#data2-decrement","title":"<code>data[2]</code> decrement","text":"<p>This part only happens if <code>data[2]</code> is above 0 and <code>ate</code> is null (meaning this enemy isn't currently eating a player party member)</p> <p>The only thing that happens when the above is fufilled is <code>data[2]</code> is decremented. This has complex interations, see the <code>data</code> section above for details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#pitcherflytrap-summon","title":"PitcherFlytrap summon","text":"<p>This part only happens if <code>data[0]</code> is 0 or below (the cooldown on summoning expired) and there's less than 3 <code>enemydata</code>.</p> <p>If the above isn't fufilled, <code>data[0]</code> is decremented instead.</p> <p>Here's what the logic does if the above is all fufilled:</p> <ul> <li>SetDefaultCamera called</li> <li><code>PitcherShake</code> sound plays</li> <li>animstate set to 11 (<code>Hurt</code>)</li> <li>Yield for 0.5 seconds</li> <li><code>PitcherSummon</code> sound plays</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a PitcherFlytrap enemy with type <code>FromGroundKeepScale</code> without cantmove at the first available location among the following:<ul> <li>(5.0, 0.0, -1.15)</li> <li>(1.2, 0.0, 0.95)</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until <code>checkindead</code> is null (the coroutine completed)</li> <li><code>data[0]</code> is set to 2 (1 instead if hardmode is true) which is the cooldown for being able to summon again</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#delayed-projectile-launch","title":"delayed projectile launch","text":"<p>This part only happens if all of the following conditions are fufilled:</p> <ul> <li>The PitcherFlytrap summon part didn't happen</li> <li><code>data[1]</code> is 0 or below (the cooldown on lauching a delayed projectile expired)</li> <li>There is at least 1 player party member alive (<code>hp</code> above 0 and not eatenby)</li> </ul> <p>If the above aren't fufilled, <code>data[1]</code> is decremented instead.</p> <p>The logic sequence section below outlines what happens when all of the above are fufilled.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1 Always happen A new <code>Prefabs/Objects/PoisonBubble</code> GameObject rooted positioned at (-2.0, 15.0, 0.0) with a scale of 0.8x on layer 14 (<code>Sprite</code>) with its SpriteBounce's <code>startscale</code> set to true and a <code>PoisonEffect</code> particles child which has a scale of 1.25x <code>playertargetID</code> after GetSingleTarget 3 2 0 Poison 42.0 (35.0 instead if hardmode is true) This enemy <code>BubbleBurst</code> <code>PoisonEffect</code> <code>Fall2</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>PitcherGurgle2</code> sound plays</li> <li>Camera moves to look near (2.75, 4.5, -0.1)</li> <li>animstate set to 103</li> <li>Yield for 0.5 seconds</li> <li><code>anim</code> speed set to 2.0</li> <li>Yield for 0.5 seconds</li> <li><code>anim</code> speed set to 1.0</li> <li>animstate set to 104</li> <li><code>PitcherSpit2</code> sound plays</li> <li>A new <code>Prefabs/Objects/PoisonBubble</code> GameObject is created rooted positioned at this enemy + (-0.95, 6.5, -0.1) with a scale of 0.8x on layer 14 (<code>Sprite</code>) with its SpriteBounce's <code>startscale</code> set to true and a <code>PoisonEffect</code> particles child which has a scale of 1.25x</li> <li>MainManager.MoveTowards called to move <code>Prefabs/Objects/PoisonBubble</code> to (this enemy x position - 3.0, 15.0, 0.0) with 30.0 frametime without smooth and without local (done in paralel)</li> <li>Yield for a second</li> <li><code>Prefabs/Objects/PoisonBubble</code> position set to (-2.0, 15.0, 0.0)</li> <li>AddDelayedProjectile 1 call happens</li> <li><code>data[1]</code> is set to a random number between 2 and 3 inclusive (this is the cooldown for launching another delayed projectile)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#spitout","title":"SpitOut","text":"<p>This part happens if all of the following conditions are fufilled:</p> <ul> <li>The slam move wasn't used on this actor turn (this is to exclude the same actor turn than eating to the spit out countdown)</li> <li><code>ate</code> isn't null (this enemy is currently eating a player party member)</li> <li><code>data[3]</code> is above 0 (the spit out countdown hasn't yet expired)</li> </ul> <p>Here's what happens if all of the above are fufilled:</p> <ul> <li><code>data[3]</code> is decremented</li> <li>If <code>data[3]</code> just became 0 the player party member is spit out:<ul> <li><code>data[2]</code> is set to 0 (see the <code>data</code> section above for details on what this means)</li> <li><code>spitout</code> is set to a new SpitOut call with this enemy as the eater</li> <li>Yield for a frame</li> <li><code>gottaspit</code> set to false</li> <li>Yield all frames until <code>spitout</code> is null (the coroutine completed)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#move-1-poison-bubbles-projectiles","title":"Move 1 - Poison bubbles projectiles","text":"<p>A multiple targets poison bubbles projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 to 3 times, but each calls requires that there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 3 Poison This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new <code>Prefabs/Objects/PoisonBubble</code> GameObject rooted positioned at this enemy + (-4.25, 1.8, -0.1) 25.0 (19.0 instead if hardmode is true) 4.0 null <code>PoisonEffect</code> <code>BubbleBurst</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li><code>PitcherGurgle</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>anim</code> speed set to 2.0</li> <li>Yield for 0.5 seconds</li> <li><code>anim</code> speed set to 1.0</li> <li>The amount of hits is determined. It's random between 2 and 3 inclusive. A new GameObject array is created with this amount as the length to hold the projectiles objects</li> <li>For each hits to do, if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>animstate set to 102</li> <li>GetSingleTarget called</li> <li>Yield for a frame</li> <li><code>PitcherSpit</code> sound plays</li> <li>The projectile element is set to a new <code>Prefabs/Objects/PoisonBubble</code> GameObject rooted positioned at this enemy + (-4.25, 1.8, -0.1)</li> <li>Projectile 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 100</li> <li>Yield for 0.25 seconds</li> </ul> </li> <li>Yield all frames until all projectiles objects are null (all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#move-2-slam-and-eat","title":"Move 2 - Slam and Eat","text":"<p>A party wide slam attack that may Eat a player party member.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#logic-sequence_2","title":"Logic sequence","text":"<p>The logic is done in 3 parts: the slam, eating and ending.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#slam","title":"Slam","text":"<p>This part always happen:</p> <ul> <li><code>data[2]</code> is set to 1 unless HPPercent is less than 0.7 where it's set to 2 instead. This is the cooldown for the usage of this move. NOTE: this has several caveats, see the <code>data</code> section above for more information</li> <li>animstate set to 105</li> <li><code>PitcherGurgle2</code> sound plays</li> <li>Yield for a second</li> <li>Camera moves to look near (-3.7, 0.0, 2.1)</li> <li>animstate set to 107</li> <li>Yield for 0.5 seconds</li> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li><code>impactsmoke</code> particles plays at <code>partymiddle</code></li> <li>PartyDamage 1 call happens</li> <li><code>PitcherSpit2</code> sound plays</li> <li>For each player party members whose <code>hp</code> is above 0:<ul> <li>Their y <code>spin</code> is set to 20.0</li> <li>Jump called on them with an h of 25.0 (35.0 instead if HPPercent is lower than 0.7)</li> <li>Their animstate is set to 11 (<code>Hurt</code>)</li> </ul> </li> <li>Yield for 46.0 frames counted by a local MainManager.<code>framestep</code> counter</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#eating","title":"Eating","text":"<p>This part always happen, but the logic changes if all of the following requirements are fufilled meaning the enemy decided to eat:</p> <ul> <li>HPPercent is lower than 0.7</li> <li>There's at least 2 player party members alive (<code>hp</code> above 0 and not eatenby)</li> <li>GetRandomAvaliablePlayer without nullable returns a player party member whose <code>hp</code> is 2 or above</li> </ul> <p>If this enemy decided to not eat, this part's logic only does the following:</p> <ul> <li>SetDefaultCamera called</li> <li>animstate set to 109</li> <li>Yield for 0.5 seconds</li> </ul> <p>Otherwise, if this enemy decided to eat, the full logic happens where <code>playerdata[playertargetID]</code> is eaten:</p> <ul> <li><code>data[3]</code> is set to 3 (this is the actor turn countdown before spitting out the player party member which doesn't include the current main turn)</li> <li>If <code>playerdata[playertargetID]</code> has the Shield condition:<ul> <li>Their <code>shieldenabled</code> is set to false</li> <li>RemoveCondition is called to remove their Shield condition</li> </ul> </li> <li><code>playertargetentity</code> is set to <code>playerdata[playertargetID]</code>'s battleentity</li> <li>animstate set to 110</li> <li>Yield all frames until <code>playertargetentity</code> (who's still falling from the jump earlier) y position becomes equal or lower than this enemy's <code>extra[0]</code> (their stem's end) y position - 1.5. Before each frame yield, this enemy's middle stem bone has its position set to a lerp from the current position to (<code>playertargetentity</code> initial x position before these yields + 5.0, 4.0, <code>playertargetentity</code> z position before these yields) with a factor of 0.075 * MainManager.<code>framestep</code></li> <li>animstate set to 111</li> <li>Eat called with this enemy as the eater and <code>playertargetID</code> as the eaten for 5 main turns (the turn counter doesn't do anything practical, see the eat documentation for details)</li> <li><code>PitcherEat</code> sound plays</li> <li>Yield for a second</li> <li>SetDefaultCamera called</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>This enemy's middle stem bone's local position is reset to its value before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#ending","title":"Ending","text":"<p>This part always happens:</p> <ul> <li>Yield all frames (up to 150.0 frames) until every player party members is <code>onground</code> or their y position is 0.15 or lower</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#move-3-poison-breath-attack","title":"Move 3 - Poison breath attack","text":"<p>A party wide poison breath attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen for each player party member whose <code>hp</code> is above 0 and not eatenby This enemy The player party member 3 (2 instead if hardmode is true) Poison null <code>barfill</code> is 1.0 or above after DoCommand 1 (meaning the bar got filled)"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pitcher/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>Camera moves to look near (2.75, 1.0, 2.0)</li> <li>animstate set to 100</li> <li><code>PitcherGurgle2</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>anim</code> speed set to 2.0</li> <li>Yield for 0.5 seconds</li> <li><code>anim</code> speed set to 1.0</li> <li>animstate set to 101</li> <li>SetDefaultCamera called</li> <li><code>Mist</code> sound plays</li> <li><code>poisonsmoke</code> particles plays at this enemy position + (-4f, 1.8f, -0.1f) with 7.5 alivetime</li> <li>CreateHelpBox called with 4 (the <code>TappingKey</code> command's help)</li> <li>DoCommand 1 call happens</li> <li>All player party member whose <code>hp</code> is above 0 has their y <code>spin</code> set to 15.0</li> <li>Yield all frames until <code>doingaction</code> goes to false. Before each frame yield, all player party member whose <code>hp</code> is above 0 has their animstate set to 11 (<code>Hurt</code>) (but if <code>blockcooldown</code> is above 0 meaning a block was done, it's set to 24 (<code>Block</code>) instead)</li> <li>All player party member whose <code>hp</code> is above 0 has DoDamage 1 call happen on them followed by their <code>spin</code> getting zeroed out</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PitcherFlytrap/","title":"<code>PitcherFlytrap</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/PitcherFlytrap/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy is loaded with the <code>PicherSummon</code> animid as this action assumes the presence of <code>extra[0]</code> which is initialised by CheckSpecialID only with this animid.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PitcherFlytrap/#hpbaronother-special-logic","title":"HPBarOnOther special logic","text":"<p>This enemy has special logic in a method called HPBarOnOther which is used by RefreshEnemyHP to know if the <code>hpbar</code> should be shown despite this enemy not being spied yet. It returns true if Pitcher was spied which is needed because it's not possible under normal gameplay to spy this enemy, but it is possible to spy <code>Pitcher</code>. This means that this logic allows this enemy's <code>hpbar</code> to be displayed by spying <code>Pitcher</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PitcherFlytrap/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>A single target bite attack</li> </ol> <p>Move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PitcherFlytrap/#move-1-bite-attack","title":"Move 1 - Bite attack","text":"<p>A single target bite attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PitcherFlytrap/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PitcherFlytrap/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Chew</code> sound plays with 0.75 pitch</li> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 101</li> <li>DoDamage 1 call happens</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li><code>Bite2</code> sound plays with 0.9 pitch</li> <li>For each frames on the next 30.0 frames, <code>extra[0]</code>'s parent's parent's parent (their arm's middle bone) position increases by (3.75, 1.5, -0.1)</li> <li>SetDefaultCamera called</li> <li>Over the course of 3.0 frames, <code>extra[0]</code>'s parent's parent's parent (their arm's middle bone) moves to its position before this action via a lerp</li> <li><code>extra[0]</code>'s parent's parent's parent (their arm's middle bone) local position is set to its value before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Plumpling/","title":"<code>Plumpling</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Plumpling/#enemycheck-special-logic","title":"EnemyCheck special logic","text":"<p>Before this enemy is loaded, it's possible that StartBattle overrides it to a <code>GoldenSeedling</code>. See the documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Plumpling/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the jump attack move, the amount of frames this enemy takes to reach its target changes to 38.25 frames from 51.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Plumpling/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>A single target jump attack</li> </ol> <p>Move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Plumpling/#move-1-jump-attack","title":"Move 1 - Jump attack","text":"<p>A single target jump attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Plumpling/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Flip<sup>1</sup> {BlockSoundOnly} <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Plumpling/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> is set to a new HeavyJump coroutine for this enemy with 4 damage and 60.0 speed (45.0 if hardmode is true)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> <p>Here is what the coroutine effectively ends up doing:</p> <ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>ThumpSoft</code> sound plays on loop using <code>sounds[9]</code> with 0.65 pitch and 0.65 volume using PlayMoveSound</li> <li>MoveTowards <code>playertargetentity</code> position + (3.0, 0.0, -0.1)</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li>Yield for 0.3 seconds</li> <li><code>Jump</code> sound plays with 0.8 pitch</li> <li><code>Turn</code> sound plays with 0.7 pitch</li> <li>Over the course of 51.0 frames (38.25 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position -0.1 in z via a BeizierCurve3 with a ymax of 5.5 scaled over the course of 60.0 frames (45.0 frames instead if hardmode is true). Before each frame yield, animstate is set to 2 (<code>Jump</code>) until halfway 30.0 frames passed (27.5 frames instead if harmode is true) where it's set to 3 (<code>Fall</code>) instead</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE), ShakeScreen is called with ammount (0.075, 0.3, 0.0) and 0.75 time with dontreset</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE):<ul> <li>Over the course of 9.0 frames (16.75 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position -0.1 in z via a BeizierCurve3 with a ymax of 5.5. Before each frame yield, animstate is set to 3 (<code>Fall</code>)</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li><code>Thud4</code> sound plays</li> <li><code>HugeHit3</code> soud plays</li> </ul> </li> <li>Otherwise (blocked, ignores FRAMEONE):<ul> <li>Over the course of 41.0 frames, this enemy moves to <code>playertargetentity</code> position + (2.0, 0.0, -0.1) via a BeizierCurve3 with a ymax of 3.0. Before each frame yield, animstate is set to 3 (<code>Fall</code>)</li> <li><code>Thud4</code> sound plays</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li>ShakeScreen is called with ammount (0.05, 0.2, 0.0) and 0.5 time with dontreset</li> <li>animstate set to 0 (<code>Idle</code>)</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to null informing the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/","title":"<code>PrimalWeevil</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds for this enemy to get an AttackUp condition in the pre move logic when it didn't had it already and the numbing scream or enemy summon wasn't used changes to be 41% from 31%</li> <li>In the grab attack move, the amount of frames this enemy takes to move before attempting to grab the target changes to 36.0 frames from 43.5 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A party wide numbing scream attack</li> <li>A single target swipe attack that may hit twice</li> <li>A single target tail slash attack</li> <li>A single target grab attack that may hit twice</li> <li>Summons a new Weevil enemy</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 1/8 2 2/8 3 2/8 4 1/8 5 2/8 <p>However, if move 5 is used while this isn't the only <code>enemydata</code> left, a continue directive will be issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done before using a move if all of the following conditions are fufilled to get an AttackUp condition:</p> <ul> <li>The selected move is not the numbing scream or enemy summon move (this applies even if this is a reroll from selecting the enemy summon while this enemy isn't the last remaining <code>enemydata</code>)</li> <li>This enemy doesn't already the AttackUp condition</li> <li>A 31% RNG check passes (41% instead if hardmode is true)</li> </ul> <p>Here is the logic if all of the above are fufilled:</p> <ul> <li>animstate set to 100</li> <li><code>Charge7</code> sound plays</li> <li>ShakeSprite called with an intensity of (0.1, 0.0, 0.0) and 45.0 frametimer</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 2 (<code>Jump</code>)</li> <li>y <code>spin</code> set to 20.0</li> <li>StatusEffect called to inflict the AttackUp condition on this enemy for 2 main turn with effect</li> <li>Yield for 0.5 seconds</li> <li><code>spin</code> zeroed out</li> <li>Yield for 0.15 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#move-1-numbing-scream","title":"Move 1 - Numbing scream","text":"<p>A party wide numbing scream attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 2 Numb <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Charge7</code> sound plays</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 100</li> <li>ShakeSprite called with intensity (0.1, 0.0. 0.0) and 75.0 frametimer</li> <li>Yield for 0.75 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (-0.5, 3.0, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>SetDefaultCamera called</li> <li>animstate set to 101</li> <li><code>Roar3</code> sound plays with 0.8 pitch</li> <li>ShakeScreen called with 0.2 ammount and 0.1 time</li> <li>PartyDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#move-2-swipe-attack","title":"Move 2 - Swipe attack","text":"<p>A single target swipe attack that may hit twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Flip<sup>1</sup> null <code>commandsuccess</code> 2 Happens only if at least one of the following is true:<ul><li><code>commandsuccess</code> is true after DoDamage 1 (blocked, ignores FRAMEONE)</li><li>HPPercent is less than 0.6</li></ul> This enemy <code>playertargetID</code> after GetSingleTarget 3 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with 2.0 multiplier, 1 (<code>Walk</code>) as walkstate and 103 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 109</li> <li><code>Growl</code> sound plays</li> <li>Yield for 0.65 seconds</li> <li><code>Growl2</code> sound plays</li> <li>animstate set to 105</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is true (blocked, ignores FRAMEONE) or HPPercent is less than 0.6:<ul> <li>Yield for 0.3 seconds</li> <li>animstate set to 106</li> <li>Yield for 0.2 seconds</li> <li><code>Growl2</code> sound plays with 1.1 pitch</li> <li>DoDamage 2 call happens</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#move-3-tail-slash","title":"Move 3 - Tail slash","text":"<p>A single target tail slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 5 null {BlockSoundOnly} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.1, 0.0, -0.1) with 2.0 multiplier, 1 (<code>Walk</code>) as walkstate and 103 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 109</li> <li><code>Growl3</code> sound plays</li> <li>A random number is generated between 0.6 and 0.8</li> <li>ShakeSprite called with intensity (0.1, 0.0, 0.0) with a frametimer of 60.0 * the random number</li> <li>Yield for an amount of seconds being the random number</li> <li>animstate set to 110</li> <li><code>HugeHit</code> sound plays</li> <li><code>Slash3</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't block, ignores FRAMEONE), <code>enemybounce</code> is set to a new array with one element being a new BounceEnemy call with <code>playerdata[playertargetID]</code> using routineid 0 for 1 bounce with 1.2 multiplier</li> <li>Yield for 0.2 seconds</li> <li>FlipSimple called</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until all <code>enemybounce</code> are done</li> <li>FlipSimple called</li> <li>FlipAngle called with setangle</li> <li>Yield for a frame</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#move-4-grab-attack","title":"Move 4 - Grab attack","text":"<p>A single target grab attack that may hit twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code> 2 Happens only if <code>commandsuccess</code> is false after DoDamage 1 (din't blocked, ignores FRAMEONE) This enemy <code>playertargetID</code> after GetSingleTarget 2 null {NoSound} false"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (5.0, 0.0, -0.1) with 2.0 multiplier, 107 as walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Step</code> sound plays on loop using <code>sounds[9]</code> with 1.3 pitch</li> <li>ShakeSprite called with intensity (0.1, 0.0, 0.0) with a frametimer of 50.0</li> <li>Over the course of 41.0 frames, this enemy moves to + 2.0 in x via a SmoothLerp</li> <li>Yield for 0.35 seconds</li> <li>Over the course of 43.5 frames (36.0 frames instead if hardmode is true), this enemy moves to (-20.0, 0.0, same z position) via a lerp and <code>sounds[9]</code> volume changes to 0.0 via a lerp calculated over half of the amount of frames. On the first frame this enemy x position becomes lower than <code>playertargetentity</code> x position:<ul> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE):<ul> <li><code>Drag</code> sound plays</li> <li>animstate set to 108</li> <li><code>playertargetentity</code> gets childed to this enemy</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>playertargetentity</code> local position set to (-2.35, 0.35, -0.1)</li> <li><code>playertargetentity</code> z angle set to -90.0</li> </ul> </li> </ul> </li> <li>SetDefaultCamera called</li> <li>Over the course of 43.5 frames (36.0 frames instead if hardmode is true), this enemy moves from (20.0, 0.0, same z position) to starp via a lerp and <code>sounds[9]</code> volume changes to MainManager.<code>soundvolume</code> via a lerp calculated over half of the amount of frames</li> <li><code>sounds[9]</code> stops looping</li> <li>If <code>commandsuccess</code> was false earlier when DoDamage 1 call happened:<ul> <li>animstate set to 111</li> <li><code>playertargetentity</code> gets childed to the <code>battlemap</code></li> <li><code>sprite</code> y angle set to -180.0</li> <li>y <code>spin</code> set to 20.0</li> <li><code>Toss8</code> sound plays</li> <li><code>Toss9</code> sound plays</li> <li>Over the course of 61.0 frames, <code>playertargetentity</code> moves to the position they were at before this action via a BeizierCurve3 with a ymax of 12.0. Before each frame yield, <code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li><code>Thud3</code> sound plays</li> <li>DeathSmoke particles plays at <code>playertargetentity</code> position with a size of 2.0x</li> <li>ShakeScreen called with an ammount of 0.2 and 0.8 time</li> <li>DoDamage 2 call happens</li> <li>Yield for 0.75 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#move-5-weevil-summon","title":"Move 5 - Weevil summon","text":"<p>Summons a new Weevil enemy. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/PrimalWeevil/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 102</li> <li><code>Whistle2</code> sound plays</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a new Weevil enemy with type <code>Offscreen</code> at this enemy position + (3.0, 0.0, 0.5)</li> <li>Yield for 1.25 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/","title":"<code>Pseudoscorpion</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the pincer slash attack move, there's now a 6/10 chance for the enemy to do a fake slash animation before the real one. This will be will be indicated by jumping 2 times at the start of the move. If they do that, the DoDamage will have the sleep property as opposed to be poison</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target pincer slash attack</li> <li>Changes their position to <code>Underground</code> by digging</li> <li>A single target undergound strike attack</li> </ol> <p>Move 3 is always (and only) used if position is <code>Underground</code>.</p> <p>As for the other moves, the decision of which moves to use depends on the following odds:</p> Move Odds 1 3/5 2 2/5"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#move-1-pincer-slash-attack","title":"Move 1 - pincer slash attack","text":"<p>A single target pincer slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 If hardmode is false, it's poison. If it's true, it has 6/10 chance to be sleep instead (4/10 chance to still be poison) {BlockSoundOnly} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>This is where the 2 jumps may happen. It will if hardmode is true and a 6/10 RNG check passes (also makes the property of the Damage 1 call sleep). This is what happens 2 times if that is the case:<ul> <li><code>Jump</code> sound plays with 1.1 pitch and 0.8 volume</li> <li>Jump called</li> <li>Yield for 0.33 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> </ul> </li> <li>MoveTowards <code>playertargetentity</code> + (1.25, 0.0, -0.1). The camera moves towards this point too</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li><code>Chew</code> sound plays</li> <li>Yield for 0.6 seconds</li> <li>If the 2 jumps happened earlier, a fake attack animation is done:<ul> <li><code>Select0</code> sound plays at 0.6 volume</li> <li>animstate set to 104</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 100</li> <li>Yield for 0.6 seconds</li> </ul> </li> <li>animstate set to 102</li> <li>DoDamage 1 call happens</li> <li><code>Hit2</code> sound plays</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#move-2-changes-their-position-to-underground","title":"Move 2 - Changes their position to <code>Underground</code>","text":"<p>Changes their position to <code>Underground</code> by digging. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> set to a new Dig call on this enemy</li> <li>Yield all frames until <code>checkingdead</code> goes to null (the Dig coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#move-3-undergound-strike-attack-then-change-position-to-ground","title":"Move 3 - Undergound strike attack then change position to <code>Ground</code>","text":"<p>A single target undergound strike attack. position is set to <code>Ground</code> after.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Pseudoscorpion/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to a new UndergroundStrike coroutine with 3 damage, this enemy, no properties without staying underground</li> <li>Yield all frames until <code>checkingdead</code> goes to null (the coroutine is done)</li> </ul> <p>This is effectively what the coroutine does:</p> <ul> <li>Camera moves to look near <code>playerdata[playertargetID]</code>, but zoomed in</li> <li><code>Digging</code> sound plays on loop using <code>sounds[9]</code> with 1.1 pitch and 0.75 volume</li> <li>Over the course of 100.0 frames, this enemy moves to <code>playertargetentity</code> position + -0.25 in z</li> <li>Yield for 0.25 seconds</li> <li><code>sounds[9]</code> stopped</li> <li><code>DigPop</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>y <code>spin</code> set to 20.0</li> <li><code>digging</code> set to false</li> <li>scale reset to <code>startscale</code></li> <li>animstate set to 103</li> <li><code>DirtExplodeLight</code> particle plays at this enemy position</li> <li>ShakeScreen with 0.15 ammount and 0.2 time</li> <li>Over the course of 50.0 frames, position moves to <code>playertargetentity</code> + 2.0 in x using a BeizierCurve3 with a ymax of 6.0</li> <li><code>spin</code> zeroed out</li> <li>position set to <code>Ground</code></li> <li>Yield for 0.25 seconds</li> <li><code>checkingdead</code> set to null to signal DoAction that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/","title":"<code>Ruffian</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#assumptions","title":"Assumptions","text":"<p>It is assumed that enemy is loaded with more than 1 <code>moves</code> as there is a distinction in the move selection if they are performing their last actor turn of the main turn or not.</p> <p>It is also assumed that this eneny has the <code>Ruffian</code> animid as it is required for <code>extra[3]</code> to be present which is normally initialised from UpdateAnimSpecific in the logic specific to the <code>Ruffian</code> animid.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the kick attack move, the damage of the BasicAttack call changes to 3 from 4 (under normal gameplay, this enemy has a <code>hardatk</code> of 1 which would make it do the same on this move regardless of hardmode being true or not)</li> <li>In the ball and chain attack move, the property of the DoDamage call is DefDownOnBlock instead of null</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#move-selection","title":"Move selection","text":"<p>4 moves are possible:</p> <ol> <li>A single target kick attack</li> <li>A single target arms slam attack</li> <li>Prepares themselves for a big attack next actor turn by setting their <code>charge</code> to 1</li> <li>A single target ball and chain attack</li> </ol> <p>Move 4 is always (and only) used when <code>charge</code> is higher than 0 meaning move 3 was used previously.</p> <p>As for the other moves, the decision of which move to use is based on odds, but the odds changes depending if <code>cantmove</code> is 0 or not (0 means that this enemy is performing their last actor turn of the main turn). Here are the odds in either situations:</p> Move Odds when <code>cantmove</code> &lt; 0 Odds when <code>cantmove</code> is 0 1 1/4 1/2 2 1/4 1/2 3 2/4 Never used"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#move-1-kick-attack","title":"Move 1 - Kick attack","text":"<p>A single target kick attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#basicattack-calls","title":"BasicAttack calls","text":"# Conditions enemyid walkstate attackstate attackstate2 damage offset property shake delay sounds dontgettarget 1 Always happen This enemy 1 (<code>Walk</code>) 102 103 4 (3 instead if hardmode is true) (1.5, 0.0, -0.1) null 0.0 0.5 seconds <code>RuffianBindingShake,RuffianBindingSwing</code> false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to the BasicAttack 1 call</li> <li>Yield all frames until <code>checkingdead</code> is null (the BasicAttack 1 call completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#move-2-arms-slam-attack","title":"Move 2 - Arms slam attack","text":"<p>A single target arms slam attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#basicattack-calls_1","title":"BasicAttack calls","text":"# Conditions enemyid walkstate attackstate attackstate2 damage offset property shake delay sounds dontgettarget 1 Always happen This enemy 1 (<code>Walk</code>) 100 101 3 (1.5, 0.0, -0.1) Flip<sup>1</sup> 0.075 0.5 seconds <code>RuffianKickShake,RuffianKickSwing</code> false <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to the BasicAttack 1 call</li> <li>Yield all frames until <code>checkingdead</code> is null (the BasicAttack 1 call completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#move-3-prepares-a-big-attack-with-1-charge","title":"Move 3 - Prepares a big attack with 1 <code>charge</code>","text":"<p>Prepares themselves for a big attack next actor turn by setting their <code>charge</code> to 1. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called (it won't do anything for this move)</li> <li><code>Charge7</code> sound plays</li> <li>animstate set to 11 (<code>Hurt</code>)</li> <li>ShakeSprite called with 0.125 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>charge</code> set to 1</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#move-4-ball-and-chain-attack","title":"Move 4 - Ball and chain attack","text":"<p>A single target ball and chain attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null (DefDownOnBlock instead if hardmode is true) null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Ruffian/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>MoveTowards <code>playertargetentity</code> position + (2.25, 0.0, -0.1) with 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 104 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>RuffianBallShake</code> sound plays</li> <li>ShakeSprite called with 0.075 intensity and 40.0 frametimer</li> <li>FlipSimple called on this enemy</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.1 seconds</li> <li>animstate set to 105</li> <li>FlipSimple called on this enemy</li> <li><code>RuffianBallKick</code> sound plays</li> <li>Over the course of 11.0 frames, <code>extras[3]</code> (this enemy's iron ball) moves to <code>playertargetentity</code> position + (0.0, 2.0, -0.1) via a BeizierCurve3 with a ymax of -2.0. On the second half of the movement, <code>flip</code> is set to true before each frame yield</li> <li><code>flip</code> set to false</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWall/","title":"<code>SandWall</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWall/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>Decrements their <code>hp</code> and dies if it reaches 0 after</li> </ol> <p>Move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWall/#move-1-hp-decrements","title":"Move 1 - <code>hp</code> decrements","text":"<p>Decrements their <code>hp</code> and dies if it reaches 0 after. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWall/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>hp</code> is decremented</li> <li>If <code>hp</code> is 0 or below, StartDeath is called on this enemy which sets their <code>deathroutine</code> to a new Death calle with activatekill</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/","title":"<code>SandWyrm</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#special-enemy-party-layout","title":"Special enemy party layout","text":"<p>This enemy is meant to function in tandem with another: the SandWyrmTail.</p> <p>The <code>SandWyrmTail</code> should always be present when this enemy is not stopped and the battle should always starts with both. This is enforced by the EnemyCheck logic and this enemy's pre move action logic. They also have each a VenusBattle that references each other so they can have synchronized and consistent animstate logic.</p> <p>In this configuration, the <code>SandWyrmTail</code> is more an instrument to this enemy even if they are both completely separate enemies. The action logic of either assumes the presence of the other with the only exception being when the <code>SandWyrmTail</code> dies where its EventDialogue will inflict Flipped to <code>SandWyrm</code> for 2 main turns. This effectively will make them not act for 1 main turn due to how DoAction will skip the action if more than 1 main turns are left on it (but on the next main turn, the condition gets removed and they get to act again so overall, it's 1 main turn of no action).</p> <p>At that moment, the <code>SandWyrm</code> is stopped for a main turn and the <code>SandWyrmTail</code> removed since they died. However, the moment the <code>SandWyrm</code> gets to act again on the next main turn, they will summon the <code>SandWyrmTail</code> again. Essentially, killing the tail will only remove it temporarilly from the battle.</p> <p>This setup is tore down on <code>SandWyrm</code>'s EventDialogue when it dies. In that case, both it and the <code>SandWyrmTail</code> will be killed together if the <code>SandWyrmTail</code> still exists by then (it is possible it didn't since it's possible it died and <code>SandWyrm</code> couldn't summon it).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy has an <code>eventondeath</code> set to the proper EventDialogue because this EventDialogue will allow the SandWyrmTail to die with this enemy.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: The value determines the enemy to summon in the enemy summon move and it toggles between 0 and 1 after the summon each time the move is used. A value of 0 (the starting value) means a Strider will be summoned while a value of 1 means a DivingSpider will be summoned</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>This enemy features special logic during StartBattle before and after it is loaded.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#before-the-enemy-is-loaded-enemycheck","title":"Before the enemy is loaded (EnemyCheck)","text":"<p>If StartBattle was called with any elements of enemyids containing this enemy or SandWyrmTail, the entire enemyids is overriden to be {<code>SandWyrm</code>, SandWyrmTail}.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#after-the-enemy-is-loaded-enemy-party-setup","title":"After the enemy is loaded (enemy party setup)","text":"<p>If <code>enemydata</code> contains this enemy, a VenusBattle is added to the first 2 elements of the enemy party where the parent is the other enemy and the target is themselves. Since the EnemyCheck logic already enforced the layout of the enemy party, it effectively means that:</p> <ul> <li>This enemy gets a VenusBattle SetUp with a target of themselves and the parent being the SandWyrmTail</li> <li>The SandWyrmTail gets a VenusBattle SetUp with a target of themselves and the parent being this enemy</li> </ul> <p>This means that each have a VenusBattle that checks each other to make sure they have matching animstate and animations. It allows to keep them in sync visually in a consistent manner.</p> <p>This part of the logic also changes the <code>battlepos</code> of this enemy and the SandWyrmTail:</p> <ul> <li>This enemy: (3.0, 0.0, 0.0)</li> <li>The SandWyrmTail: (5.9, 0.0, 0.0)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the bubble spray move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target bite attack</li> <li>A party wide bubble spray attack</li> <li>Summons a new Strider or DivingSpider enemy</li> </ol> <p>The decision of the move to use is based on odds, but those odds changes if InputIO.IsEditor is true which can't happen under normal gameplay (it would mean the game is being ran inside the Unity editor). Here are the odds:</p> Move Odds in Unity player Odds in Unity editor 1 3/6 3/7 2 2/6 4/7 3 1/6 Never used <p>However, if move 3 is selected and there's already 3 or more enemy party members, a continue directive is issued on the enemy actions loop which restart the entire action logic and effectively rerolls the move selection.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#pre-move-logic","title":"Pre move logic","text":"<p>There's logic that will always be done at the start of the action. It's in 2 parts done in order.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#sandwyrmtail-summon","title":"SandWyrmTail summon","text":"<p>If <code>SandWyrmTail</code> isn't in <code>enemydata</code>, it is summoned back by doing the following (normally happens when this enemy acts after the tail died):</p> <ul> <li>ShakeScreen called with an ammount of 0.05 and a time of 1.35</li> <li>animstate set to 100</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a new SandWyrmTail enemy with type <code>Raise</code> at (5.9, 0.0, 0.0)</li> <li>Yield for a frame</li> <li>The <code>SandWyrmTail</code> has their <code>height</code> and <code>initialheight</code> set to 0.0</li> <li>Yield for 1.35 seconds</li> <li><code>Prefabs/Objects/WaterSplash</code> instiantiated at (5.9, 0.0, 0.0) and destroyed in 0.75 seconds</li> <li>Yield all frames until <code>checkingdead</code> is null (the summoning completed)</li> <li><code>size</code> set to 1.75</li> <li><code>cursoroffset</code> set to (-1.75, 4.45, 0.0)</li> <li>The local startstate and <code>basestate</code> set to 0 (<code>Idle</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#changing-startp","title":"Changing startp","text":"<p>The following logic always happen if there's exactly 2 enemy party members (this essentially restores the startp this enemy had before it summoned an enemy):</p> <ul> <li>MoveTowards (3.0, 0.0, 0.0)</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>startp is set to this enemy position except the y component which is set to 0.0</li> <li><code>flip</code> is set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#move-1-bite-attack","title":"Move 1 - Bite attack","text":"<p>A single target bite attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#basicattack-calls","title":"BasicAttack calls","text":"# Conditions enemyid walkstate attackstate attackstate2 damage offset property shake delay sounds dontgettarget 1 Always happen This enemy 1 (<code>Walk</code>) 100 101 3 (3.25, 0.0, -0.1) null 0.0 Random between 0.65 seconds and 0.85 seconds <code>TidalWormBite</code> false"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> is set to the BasicAttack 1 call</li> <li>Yield all frames until <code>checkingdead</code> is null (the BasicAttack 1 call completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#move-2-bubble-spray","title":"Move 2 - Bubble spray","text":"<p>A party wide bubble spray attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 3 null true only if <code>barfill</code> is at least 0.9 after DoCommand 1, false otherwise 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>Camera moves to look near (-2.45, 0.0, 2.45)</li> <li><code>TidalWormBubbleBeamAudioCue</code> sound plays</li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 103</li> <li><code>TidalWormBubbleSpray</code> sound plays</li> <li>The <code>model</code>'s first child (bubbles particles) gets some adjustmenets on its ParticleSystem:<ul> <li>MainModule: startSpeed of 10.0 constant curve and startLifetime of 1.0 constant curve</li> <li>EmissionModule: rateOverTime of 40.0 constant curve</li> </ul> </li> <li>DoCommand 1 call happens</li> <li>All player party member whose <code>hp</code> is above 0 has their y <code>spin</code> set to 20.0 and their animstate set to 11 (<code>Hurt</code>)</li> <li>Yield all framed until <code>doingaction</code> is false (DoCommand 1 is done)</li> <li>All player party member has their <code>spin</code> zeroed out</li> <li>PartyDamage 1 call happens</li> <li>The <code>model</code>'s first child (bubbles particles) gets some adjustmenets on its ParticleSystem:<ul> <li>MainModule: startSpeed of 5.0 constant curve and startLifetime of 0.75 constant curve</li> <li>EmissionModule: rateOverTime of 20.0 constant curve</li> </ul> </li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#move-3-enemy-summon","title":"Move 3 - Enemy summon","text":"<p>Summons a new Strider or DivingSpider enemy. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrm/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>Camera moves to look near (-1.15, 0.0, 2.0)</li> <li>animstate set to 100</li> <li><code>TidalWormSummon</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>All player party member whose <code>hp</code> is above 0 has their animstate set to 11 (<code>Hurt</code>)</li> <li>ShakeScreen called with an ammount of 0.1 and a time of 0.75</li> <li>animstate set to 104</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a new Strider enemy if <code>data[0]</code> is 0 or a DivingSpider enemy if it's 1  with type <code>Offscreen</code> at (0.5, 0.0, -0.5)</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>Yield for 0.25 seconds</li> <li><code>data[0]</code> is toggled (if it was 0, it becomes 1 and if it was 1, it becomes 0)</li> <li>If flags 166 is true (during a B.O.S.S session in EX mode), the new enemy party member has their <code>hp</code> and <code>maxhp</code> divided by 2 floored</li> <li>MoveTowards + 1.0 in x</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>startp is set to this enemy position except the y component where it's 0.0</li> <li><code>flip</code> is set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/","title":"<code>SandWyrmTail</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#special-enemy-party-layout","title":"Special enemy party layout","text":"<p>See the SandWyrm documentation to learn more about how it interacts with this enemy very closely together. This enemy can be viewed as an instrument of the <code>SandWyrm</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy has an <code>eventondeath</code> set to the proper EventDialogue because this EventDialogue needs to inflict Flipped on the SandWyrm.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>This enemy features special logic during StartBattle before and after it is loaded.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#before-the-enemy-is-loaded-enemycheck","title":"Before the enemy is loaded (EnemyCheck)","text":"<p>If StartBattle was called with any elements of enemyids containing this enemy or SandWyrm, the entire enemyids is overriden to be {SandWyrm, <code>SandWyrmTail</code>}.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#after-the-enemy-is-loaded-enemy-party-setup","title":"After the enemy is loaded (enemy party setup)","text":"<p>If <code>enemydata</code> contains this enemy, a VenusBattle is added to the first 2 elements of the enemy party where the parent is the other enemy and the target is themselves. Since the EnemyCheck logic already enforced the layout of the enemy party, it effectively means that:</p> <ul> <li>This enemy gets a VenusBattle SetUp with a target of themselves and the parent being the SandWyrm</li> <li>The SandWyrm gets a VenusBattle SetUp with a target of themselves and the parent being this enemy</li> </ul> <p>This means that each have a VenusBattle that checks each other to make sure they have matching animstate and animations. It allows to keep them in sync visually in a consistent manner.</p> <p>This part of the logic also changes the <code>battlepos</code> of this enemy and the SandWyrmTail:</p> <ul> <li>The SandWyrm: (3.0, 0.0, 0.0)</li> <li>This enemy: (5.9, 0.0, 0.0)</li> </ul> <p>Additionally, the following adjustements also happens to this enemy:</p> <ul> <li><code>height</code> is set to 0.0</li> <li><code>initialheight</code> is set to 0.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the delayed projectile move, the amount of damage the projectile will do changes to 3 from 2</li> <li>In the delayed projectile move, the framespeed changes to 45.0 from 55.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>Launches a bubble delayed projectile</li> </ol> <p>Move 1 is always used, but only if the SandWyrm is not stopped (it should always be present due to the EnemyCheck logic).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#move-1-delayed-projectile-launch","title":"Move 1 - delayed projectile launch","text":"<p>Launches a bubble delayed projectile. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1 Always happen A new <code>Prefabs/Objects/WaterBubble</code> GameObject positioned at (0.0, 0.15, 0.0) childed to the <code>battlemap</code> with a scale of 1.5x GetRandomAvaliablePlayer without nullable 2 (3 instead if hardmode is true) 2 0 null 55.0 (45.0 instead if hardmode is true) This enemy <code>WaterSplash2</code> <code>WaterSplash</code> <code>Fall2</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SandWyrmTail/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The SandWyrm enemy party member is obtained (it should always be present due to the logic enforced by EnemyCheck)</li> <li>Camera moves to look near the midpoint between this enemy and the <code>SandWyrm</code>, but a bit up</li> <li><code>SandWyrm</code> animstate set to 100</li> <li>animstate set to 100</li> <li><code>TidalWormDropplet</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>A new <code>Prefabs/Objects/WaterBubble</code> GameObject is created positioned at this enemy + (0.5, 0.0, -0.1) childed to the <code>battlemap</code></li> <li>A new <code>Prefabs/Objects/WaterSplash</code> GameObject is created childed to the <code>Prefabs/Objects/WaterBubble</code> with its AudioSource disabled and destroyed in 0.75 seconds</li> <li>The <code>Prefabs/Objects/WaterBubble</code> scale is set to 1.5x</li> <li><code>WaterOut</code> sound plays</li> <li>Over the course of 61.0 frames, <code>Prefabs/Objects/WaterBubble</code> moves to (0.0, 15.0, 0.0) via a lerp</li> <li><code>SandWyrm</code> animstate set to 0 (<code>Idle</code>)</li> <li>AddDelayedProjectile call 1 happens</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sandworm/","title":"<code>Sandworm</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Sandworm/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the underground attack move, the time the enemy takes to move towards its target by digging is 31.0 frames instead of 41.0 frames. This happens before the actual attack movement after undigging</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sandworm/#move-selection","title":"Move selection","text":"<p>1 moves are possible:</p> <ol> <li>A single target underground attack</li> </ol> <p>Move 1 is always used</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sandworm/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen at the start of the actor turn:</p> <ul> <li><code>checkingdead</code> is set to a new Dig coroutine for this enemy to change its position to <code>Underground</code> with 0 jump (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sandworm/#move-1-underground-attack","title":"Move 1 - Underground attack","text":"<p>A single target underground attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sandworm/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sandworm/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Digging</code> sound plays on loop using <code>sounds[9]</code></li> <li>Camera moves to look near the midpoint between this this enemy and <code>playertargetentity</code></li> <li>Over the course of 51.0 frames, this enemy moves in x to startp.x + a BeizierFloat with a height of 2.25</li> <li>animstate set to 100</li> <li>Over the course of 41.0 frames (31.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position + (2.0, 0.0, -0.1)</li> <li><code>digging</code> set to false</li> <li><code>spin</code> zeored out</li> <li><code>digtime</code> set to 99.0</li> <li>FlipAngle called with setangle</li> <li><code>sounds[9]</code> stopped</li> <li><code>DigPop</code> sound plays</li> <li>Over the course of 21.0 frames, this enemy moves in x to <code>playertargetentity</code> x position + a lerp from 2.0 to -2.0 and <code>hright</code> is set to a BeizierFloat curve with a height of 1.6. On the first frame that this enemy x position is equal or less than <code>playertargetentity</code> x position, DoDamage 1 call happens</li> <li>Yield a frame</li> <li><code>checkingdead</code> is set to a new Dig coroutine for this enemy to change its position to <code>Underground</code> with 0 jump (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li>animstate set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/","title":"<code>Scarlet</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#startbattle-logic","title":"StartBattle logic","text":"<p>This enemy has special logic that occurs after load on StartBattle:</p> <ul> <li><code>basestate</code> is set to 5 (<code>Angry</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: When move 5 is used (the party wide explosion move), this value is set to 4 and decreases at the end of the action including the current actor turn. Everytime that move 5 is selected, it is rerolled if this value is still higher than 0. Effectively, it's a cooldown in amount of actor turns left before being able to use the move again which is 3 full actor turns</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The HPPercent threshold for getting a 999999 main turns (infinite) AttackUp condition changes to 0.65 from 0.5 until <code>hp</code> goes above this threshold at which point, the condition is removed until it reaches the threshold again. This threshold also changes the moment that the <code>hp</code> drain fraction increases from 1/2 ceiled to 2/3 ceiled for every applicable move except the party wide explosion</li> <li>On the first actor turn that HPPercent threshold reaches less than 0.4, this enemy will get a 999999 mnain turns (infinite) DefenseUp condition which is never removed</li> <li>In the shockwave attack move, the wave takes 25.0 frames instead of 35.0 frames to reach its target</li> <li>In the heart projectile attack move, the heart takes 60.0 frames to reach its target instead of 80.0</li> <li>In the umbrealla throw move, each half of the umbrealla trajectory takes 50.0 frames instead of 60.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#move-selection","title":"Move selection","text":"<p>7 moves are possible:</p> <ol> <li>A single target slash attack that drains <code>hp</code></li> <li>A single target shockwave attack</li> <li>A single target faster slash attack that inflicts AttackDown and drains <code>hp</code></li> <li>A single target heart projectile attack that inflicts DefenseDown and drains <code>hp</code></li> <li>Have a flower bud appear and inflict AttackUp to themselves</li> <li>A party wide explosion attack that drains <code>hp</code></li> <li>A single target umbrella throw that hits twice and drains <code>hp</code></li> </ol> <p>The decision of which move to use is based on odds, but the odds changes depending if HPPercent is less than 0.45 or not. Here are the odds in either situations:</p> Move HPPercent &gt;= 0.45 HPPercent &lt; 0.45 1 2/9 3/13 2 2/9 1/13 3 1/9 3/13 4 1/9 Never used 5 1/9 Never used 6 1/9 3/13 7 1/9 3/13 <p>Selecting move 5 however will reroll the move selection if this enemy already has the AttackUp condition.</p> <p>Selecting move 6 will also reroll the move selection if HPPercent is higher than 0.7 or if <code>data[0]</code> is higher than 0 (meaning the actor turns cooldown on the move hasn't yet expired, see the <code>data</code> usage section for details).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#pre-move-logic","title":"Pre move logic","text":"<p>There's logic that always happen at the start of the action. There's 3 parts to it: the inifinite AttackUp, the infinite DefenseUp and some logic that always happen.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#infinite-attackup","title":"Infinite AttackUp","text":"<p>If HPPercent is less than 0.5 (0.65 is hardmode is true) and this enemy doesn't already have the <code>AttackUp</code> condition, the following happens to inflict it (it also increases the drain fractions of all moves except the explosion attack from 1/2 to 2/3):</p> <ul> <li><code>Charge10</code> sound plays</li> <li>animstate set to 120</li> <li>ShakeSrprite called with intensity (0.1, 0.0, 0.0) and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 113</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 0 (red up arrow)</li> <li>Yield for 0.65 seconds</li> <li><code>basestate</code> set to 13 (<code>BattleIdle</code>)</li> <li>SetCondition called to inflict the <code>AttackUp</code> condition on this enemy for 999999 main turns (infinite)</li> </ul> <p>However, if they are above the <code>hp</code> threshold and they have the <code>AttackUp</code> condition with more than 10 turns, it is assumed they received the infinite condition before, but are no longer in the <code>hp</code> threshold. In that case, it is removed by doing the following (it also reverts the drain fractions of all moves except the explosion attack to 1/2):</p> <ul> <li>RemoveCondition called to remove the <code>AttackUp</code> condition on this enemy</li> <li><code>basestate</code> set to 5 (<code>Angry</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#inifinite-defenseup","title":"Inifinite DefenseUp","text":"<p>If hardmode is true, HPPercent is less than 0.4 and this enemy doesn't already have the <code>DefenseUp</code> condition, the following happens to inflict it (it is never removed):</p> <ul> <li><code>Charge10</code> sound plays</li> <li>animstate set to 120</li> <li>ShakeSrprite called with intensity (0.1, 0.0, 0.0) and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 113</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 1 (blue up arrow)</li> <li>SetCondition called to inflict the <code>DefenseUp</code> condition on this enemy for 999999 main turns (infinite)</li> <li>Yield for 0.65 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#logic-that-always-happen","title":"Logic that always happen","text":"<p>The local startstate is always set to <code>basestate</code> (after both of the section above occured).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen at the end of the action:</p> <ul> <li>If <code>data[0]</code> is higher than 0 (the move 5 cooldown hasn't expired yet), it is decremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#move-1-slash-attack","title":"Move 1 - Slash attack","text":"<p>A single target slash attack that drains <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + (2.0, 0.0, -0.15) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li>Yield for 0.25 seconds</li> <li><code>Charge10</code> sound plays</li> <li>ShakeSrprite called with intensity (0.1, 0.0, 0.0) and 20.0 frametimer</li> <li>Yield for 0.3 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (0.25, 2.1, -0.1) with 0.5 alivetime</li> <li>Yield for 0.3 seconds</li> <li>animstate set to 102</li> <li>DoDamage 1 call happens</li> <li><code>HugeHit</code> sound plays</li> <li>ShakeScreen called with an ammount of 0.1 and 0.15 time</li> <li>Camera moves up and back a bit</li> <li><code>playertargetentity</code> has Jump called on them with an h of 15.0 if <code>commandsuccess</code> is false (didn't block, ignores FRAMEONE) or 7.5 if it's true (blocked, ignores FRAMEONE)</li> <li><code>playertargetentity</code> has SlowSpinStop called on them with a spinammount of 30.0 in y and 30.0 frametime</li> <li>Yield for 0.5 seconds</li> <li>If <code>lastdamage</code> is higher than 0, Heal is called to heal this enemy's <code>hp</code> by that value / 2.0 ceiled. That fraction changes to be 2/3 ceiled if the first <code>hp</code> threshold is reached (see the pre move logic section above for details)</li> <li>Yield all frames until <code>playertargetentity</code> is <code>onground</code> and has its <code>spin</code>'s magnitude become 0.1 or lower</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#move-2-shockwave-attack","title":"Move 2 - Shockwave attack","text":"<p>A single target shockwave attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 120</li> <li><code>Charge12</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li><code>CherryCharge</code> and <code>CherryBall</code> particles plays at this enemy position + (0.8, 1.0, -0.1) with a time of -1.0</li> <li><code>CherryBall</code> particles has their scale zeroed out</li> <li>ShakeSrprite called with intensity (0.05, 0.0, 0.0) and 45.0 frametimer</li> <li>Over the course of 40.0 frames, <code>CherryBall</code> particles has their scale lerped to Vector3.one</li> <li>Yield for 0.25 seconds</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li><code>CherryCharge</code> and <code>CherryBall</code> particles gets destroyed</li> <li>Yield a frame</li> <li><code>Lazer2</code> sound plays</li> <li>A new <code>Prefabs/Objects/WaveProjectile</code> object gets instantiated offscreen at -999.0 in y</li> <li>animstate set to 117</li> <li>Over the course of 35.0 frames (25.0 frames instead if hardmode is true), the <code>Prefabs/Objects/WaveProjectile</code> object moves from this enemy + (-1.0, 1.5, 0.0) to <code>playertargetentity</code> position + (0.25, 1.25, 0.0) via a lerp and its y scale gets lerped to 1.5</li> <li><code>CherryBoom</code> particles plays at <code>playertargetentity</code> position + (0.0, 1.25, -0.1)</li> <li><code>Prefabs/Objects/WaveProjectile</code> gets destroyed</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#move-3-faster-slash-attack","title":"Move 3 - Faster slash attack","text":"<p>A single target faster slash attack that inflicts AttackDown and drains <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>Camera moves to look near this enemy</li> <li>GetSingleTarget called</li> <li>animstate set to 120</li> <li><code>Charge12</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li><code>CherryCharge</code> and <code>CherryBall</code> particles plays at this enemy position + (0.8, 1.0, -0.1) with a time of -1.0</li> <li><code>CherryBall</code> particles has their scale zeroed out</li> <li>ShakeSrprite called with intensity (0.05, 0.0, 0.0) and 45.0 frametimer</li> <li><code>Woosh3</code> sound plays</li> <li>Over the course of 30.0 frames, <code>CherryBall</code> particles has their scale lerped to Vector3.one</li> <li>Yield for 0.25 seconds</li> <li>Camera moves a bit to the left</li> <li><code>CherryCharge</code> and <code>CherryBall</code> particles gets destroyed</li> <li>Yield a frame</li> <li>animstate set to 101</li> <li><code>trail</code> set to true</li> <li>Over the course of 17.0 frames, this enemy moves to <code>playertargetentity</code> position + (1.5, 0.0, -0.15) via a lerp</li> <li><code>trail</code> set to false</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (0.25, 2.1, -0.1) with 0.5 alivetime</li> <li>Yield for 0.3 seconds</li> <li>animstate set to 102</li> <li>DoDamage 1 call happens</li> <li><code>CherryBoom</code> particles plays at <code>playertargetentity</code> position + (0.0, 1.25, -0.1)</li> <li><code>HugeHit</code> sound plays</li> <li><code>StatDown</code> sound plays</li> <li>StatEffect called on <code>playertargetentity</code> with type 2 (red down arrow)</li> <li>ShakeScreen called with an ammount of 0.1 and 0.15 time</li> <li>Camera moves up and back a bit</li> <li><code>playertargetentity</code> has Jump called on them with an h of 15.0 if <code>commandsuccess</code> is false (didn't block, ignores FRAMEONE) or 7.5 if it's true (blocked, ignores FRAMEONE)</li> <li><code>playertargetentity</code> has SlowSpinStop called on them with a spinammount of 30.0 in y and 30.0 frametime</li> <li>Yield for 0.5 seconds</li> <li>If <code>lastdamage</code> is higher than 0, Heal is called to heal this enemy's <code>hp</code> by that value / 2.0 ceiled. That fraction changes to be 2/3 ceiled if the first <code>hp</code> threshold is reached (see the pre move logic section above for details)</li> <li>Yield all frames until <code>playertargetentity</code> is <code>onground</code> and has its <code>spin</code>'s magnitude become 0.1 or lower</li> <li>SetCondition called on <code>playertargetentity</code> to inflict AttackDown for main 2 turns (effectively 1 main turn since the current main turn gets advanced soon after)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#move-4-heart-projectile","title":"Move 4 - Heart projectile","text":"<p>A single target heart projectile attack that inflicts DefenseDown and drains <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#dodamage-calls_3","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 104</li> <li>Yield for 0.75 seconds</li> <li><code>Kiss</code> sound plays</li> <li><code>Lazer3</code> sound plays</li> <li>animstate set to 105</li> <li>A new sprite object is created rooted and offscreen at 999.0 in y using the <code>Sprites/Particles/plainheart</code> sprite with a color of E57F8C (light red) with a scale of 0.65x and a ShadowLite SetUp with 0.3 opacity and 0.6 size</li> <li>Yield for 0.3 seconds</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>Over the course of 80.0 frames (60.0 frames instead if hardmode is true), <code>Sprites/Particles/plainheart</code> moves from this enemy position + (-1.0, 1.85, -0.1) to <code>playertargetentity</code> position + (0.0, 1.0, -0.1). Before each yield, the z angle is set to Sin(Time.time * 3.0) * 10.0</li> <li>Camera moves to look near the rooted MainCam object</li> <li><code>Sprites/Particles/plainheart</code> gets destroyed</li> <li>DoDamage 1 call happens</li> <li><code>StatDown</code> sound plays</li> <li>StatEffect called on <code>playertargetentity</code> with type 3 (blue down arrow)</li> <li>SetCondition called on <code>playertargetentity</code> to inflict DefenseDown for 3 main turns (2 main turns instead if <code>commandsuccess</code> is true which means the player blocked ignoring FRAMEONE). Effectively, it's 2 or 1 main turns since the current main turns ends soon after</li> <li>Yield for 0.5 seconds</li> <li>SetDefaultCamera called</li> <li>If <code>lastdamage</code> is higher than 0, Heal is called to heal this enemy's <code>hp</code> by that value / 2.0 ceiled. That fraction changes to be 2/3 ceiled if the first <code>hp</code> threshold is reached (see the pre move logic section above for details)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#move-5-flower-bud-giving-attackup","title":"Move 5 - Flower bud giving AttackUp","text":"<p>Have a flower bud appear and inflict AttackUp to themselves. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li><code>Disappear</code> sound plays</li> <li>A new <code>Prefabs/Objects/OpeningFlowerBud</code> object is created rooted at this enemy position + (0.0, 0.0, -0.1) whose SpriteRenderer color gets set to pure white half opaque</li> <li>Camera moves look near this enemy</li> <li>animstate set to 107</li> <li>Yield for 1 second</li> <li>The <code>Prefabs/Objects/OpeningFlowerBud</code>'s Animator has the <code>Close</code> animation clip played</li> <li>animstate set to 109</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 0 (red up arrow)</li> <li><code>Prefabs/Objects/OpeningFlowerBud</code> gets destroyed</li> <li><code>CherryBoom</code> particles plays at this enemy position + (0.0, 1.25, -0.1)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#move-6-explosion-attack","title":"Move 6 - Explosion attack","text":"<p>A party wide explosion attack that drains <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#dodamage-calls_4","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen, done for each player party member whose <code>hp</code> is above 0 This enemy The player party member 3 null {BlockSoundOnly} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li><code>data[0]</code> is set to 4 (meaning this move won't be used until 4 actor turns passes including the current one)</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 111</li> <li><code>Charge10</code> sound plays</li> <li>Yield for 0.4 seconds</li> <li>ShakeSrprite called with intensity (0.1, 0.0, 0.0) and 30.0 frametimer</li> <li><code>CherryCharge</code> particles plays at this enemy position + (0.0, 1.5, -0.1) with a time of -1.0</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near the player party</li> <li>Yield for 0.3 seconds</li> <li><code>CherryCharge</code> moved offscreen at 999.0 in y</li> <li><code>Charge14</code> sound plays</li> <li><code>GrowingBuds</code> particles plays at this enemy + (0.15, 2.4, -0.1) with an alivetime of 0.5 and a scale of (1.5, 0.5, 2.0)</li> <li>Yield for 0.85 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (0.15, 2.1, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 113</li> <li><code>GrowingBuds</code> particles has LerpObject called to go -1.0 in y over 100.0 frames with destroyonend</li> <li><code>CherryCharge</code> particles gets destroyed in 5.0 seconds</li> <li><code>Explosion2</code> sound plays</li> <li><code>FlowerImpact</code> particles plays at (-4.5, 0.0, 0.0)</li> <li><code>impactsmoke</code> particles plays at (-4.5, 0.0, 0.0)</li> <li>ShakeScreen called with an ammount of 0.1 and 0.15 time</li> <li>For each player party members whose <code>hp</code> is above 0, DoDamage 1 calls happens with them</li> <li>Yield for 0.75 seconds</li> <li>If the sum of all the <code>lastdamage</code> values after each DoDamage 1 calls is higher than 0, Heal is called to heal this enemy's <code>hp</code> by that value clamped from 0 to 8</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#move-7-umbrella-throw","title":"Move 7 - Umbrella throw","text":"<p>A single target umbrella throw that hits twice and drains <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#nonphyscal-set-to-true_3","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#dodamage-calls_5","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code> 2 Always happen after DoDamage 1 This enemy Same as DoDamage 1 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scarlet/#logic-sequence_6","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and  <code>playertargetentity</code></li> <li><code>Charge10</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.25 seconds</li> <li>ShakeSrprite called with intensity (0.1, 0.0, 0.0) and 20.0 frametimer</li> <li>Yield for 0.3 seconds</li> <li>ShakeSrprite called with intensity (0.15, 0.0, 0.0) and 30.0 frametimer</li> <li>Yield for 0.35 seconds</li> <li>animstate set to 122</li> <li><code>Woosh4</code> sound plays</li> <li>A new sprite object is created rooted at this enemy position + (0.0, 2.0, -0.1) using the <code>Sprites/Entities/scarlet[18]</code> sprite (the umbrella) with an AudioSource setup to play the <code>Audio/Sounds/Woosh</code> audio clip on loop with a volume of MainManager.<code>soundvolume</code> * 2.0 with a maxDistance of 100.0 and a spatialBlend of 1.0</li> <li>SetDefaultCamera called</li> <li>Over the course of 60.0 frames (50.0 instead if hardmode is true), the umbrella moves to (-15.0, 0.75, <code>playertargetentity</code>'s z position -0.1) and on the first frame that its x position becomes lower than the <code>playertargetentity</code> x position, DoDamage 1 call happen. This is immeditately followed by the reverse trajectory over the same amount of frames, but on the first frame that the umbrella's x position is higher than the <code>playertargetentity</code> x position, DoDamage 2 call happens</li> <li>The umbrella gets destroyed</li> <li><code>Toss</code> sound plays</li> <li><code>Drop</code> sound plays with 1.1 pitch and 0.8 volume</li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li>If the sums of DoDamage 1 and 2's <code>lastdamage</code> values is higher than 0, Heal is called to heal this enemy's <code>hp</code> by that value / 2.0 ceiled. That fraction changes to be 2/3 ceiled if the first <code>hp</code> threshold is reached (see the pre move logic section above for details)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/","title":"<code>Scorpion</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the boulder throw move, the time the boulder takes to reach its target changes to 46.0 frames from 61.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target claw swipe that can hit twice</li> <li>A single target tail thrust that may inflict Sleep</li> <li>A party wide boulder throw</li> </ol> <p>The decision of which move to use is determined by the following odds:</p> Move Odds 1 3/7 2 2/7 3 2/7"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#move-1-claw-swipes","title":"Move 1 - Claw swipes","text":"<p>A single target claw swipe that can hit twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code> 2 Only happens if after DoDamage 1, HPPercent is 0.5 or less This enemy The same <code>playertargetID</code> as DoDamage 1 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (3.0, 0.0, -0.15) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li><code>ScorpionClaw1</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 102</li> <li><code>ScorpionClaw2</code> sound plays</li> <li>Yield for 0.05 seconds</li> <li>DoDamage 1 call happens</li> <li>If HPPercent is 0.5 or less:<ul> <li>Yield for 0.35 seconds</li> <li><code>ScorpionClaw1</code> sound plays with 0.95 pitch</li> <li>animstate set to 104</li> <li>Yield for 0.5 seconds</li> <li><code>ScorpionClaw2</code> sound plays</li> <li>animstate set to 106</li> <li>Yield for 0.05 seconds</li> <li>DoDamage 2 call happens</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#move-2-tail-thrust","title":"Move 2 - Tail thrust","text":"<p>A single target tail thrust that may inflict Sleep.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#about-incorrect-poison-and-sleep-properties-logic","title":"About incorrect Poison and Sleep properties logic","text":"<p>While the DoDamage call features a <code>Pierce</code> property, the move ends up doing an incorrect version of the <code>Poison</code> or <code>Sleep</code> property logic due to the single property shortcoming. Here are the differences:</p> <ul> <li>On FRAMEONE, regular blocking will incorrectly prevent the condition from being inflicted which doesn't happen normally</li> <li>When inflicting either conditions, the resistance check is off by one. See the StatusEffect documentation for details</li> <li>When inflicting <code>Poison</code>, the <code>PoisonTouch</code> medal won't work despite the attack being physical</li> <li>When inflicting <code>Sleep</code>, the amount of turns to inflict is 2 instead of 3 even if the target didn't already had the condition</li> <li>When inflicting <code>Poison</code> and the target had the <code>Sleep</code> condition without a <code>HeavySleeper</code> medal, its <code>Sleep</code> condition is not removed when it otherwise would have been. NOTE: in practice, nothing changes because the DoDamage 1 call will remove the <code>Sleep</code> condition anyway</li> <li>When inflicting <code>Sleep</code>, there is no resistance increase</li> <li>The condition infliction can still happen if the target has the Numb while having the <code>ShockTrooper</code> medal equipped</li> <li>When inflicting <code>Poison</code>, the <code>Poison</code> sound is not played when it should have been</li> <li>When inflicting <code>Sleep</code>, the <code>Sleep</code> sound is not played when it should have been</li> <li>When inflicting <code>Sleep</code>, <code>isasleep</code> is not set to true when it should have been. NOTE: this doesn't affect anything since the value gets fixed when the main turn advance occurs and no potential impact can happen under normal gameplay until it advances</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (3.5, 0.0, -0.15) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 107</li> <li><code>ScorpionTail3</code> sound plays</li> <li>Yield for a random amount of time between 0.65 seconds and 0.85 seconds</li> <li>animstate set to 109</li> <li><code>ScorpionTail4</code> sound plays</li> <li>Yield for 0.05 seconds</li> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE) and <code>playerdata[playertargetID]</code> doesn't have the Shield or Sturdy conditions, StatusEffect is called on <code>playerdata[playertargetID]</code> to inflict a randomly chosen condition between Poison and Sleep for 2 main turns (effectively 1 main turn since the current one is advanced soon)</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#move-3-boulder-throw","title":"Move 3 - Boulder throw","text":"<p>A party wide boulder throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Scorpion/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 110</li> <li><code>Dig2</code> sound plays</li> <li><code>Digging</code> particles plays at this enemy position -3.0 in x</li> <li>A new <code>Prefabs/Objects/CrackedRock</code> GameObject is created without its MeshCollider and Fader with a position of (0.0, -10.0, this enemy z position + 0.3) a scale of 3x and an x angle of 180.0</li> <li>Yield for 0.65 seconds</li> <li>The <code>Digging</code> particles are moved offscreen at -999.0 in y</li> <li>animstate set to 111</li> <li>Yield for 0.35 seconds</li> <li><code>RockPluck</code> sound plays</li> <li>animstate set to 112</li> <li>ShakeScreen called with an ammount of 0.25 and a time of 0.2</li> <li><code>DirtExplode2</code> particles plays at this enemy position -3.0 in x</li> <li>Over the course of 11.0 frames, the <code>Prefabs/Objects/CrackedRock</code> moves from this enemy postion + (-3.5, -1.25, -0.1) to this enemy position + (-0.85, 5.45, 0.0) via a BeizierCurve3 with a ymax of 2.0</li> <li>Yield for 0.3 seconds</li> <li>animstate set to 114</li> <li>Yield for 0.1 seconds</li> <li><code>Toss7</code> sound plays</li> <li>Over the course of 61.0 frames (46.0 instead if hardmode is true), the <code>Prefabs/Objects/CrackedRock</code> moves to (-4.5, 1.0, 0.0) via a BeizierCurve3 with a ymax of 6.0</li> <li><code>Thud5</code> sound plays</li> <li><code>impactsmoke</code> particles plays at the <code>Prefabs/Objects/CrackedRock</code> position</li> <li>ShakeScreen called with an ammount of 0.25 and frametimer of 0.65</li> <li>A <code>Prefabs/Objects/CrackRockBreak</code> is instantiated with same position and scale as the <code>Prefabs/Objects/CrackedRock</code> (this gets destroyed in 60.0 seconds via the CrackRockBreak component attached to it) </li> <li><code>Prefabs/Objects/CrackedRock</code> is destroyed</li> <li>PartyDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/","title":"<code>Seedling</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/#enemycheck-special-logic","title":"EnemyCheck special logic","text":"<p>Before this enemy is loaded, it's possible that StartBattle overrides it to a <code>GoldenSeedling</code>. This also applies to the <code>FlyingSeedling</code> variant. See the documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/#move-selection","title":"Move selection","text":"<p>2 move are possible:</p> <ol> <li>A single target aerial strike attack</li> <li>A single target tackle attack</li> </ol> <p>Move 1 is always done when the position is <code>Flying</code> while move 2 is always done otherwise.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/#move-1-aerial-strike-attack","title":"Move 1 - Aerial strike attack","text":"<p>A single target aerial strike attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code>, but zoomed in</li> <li><code>Toss2</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code> with pitch 1.1 and volume 0.5</li> <li>MoveTowards <code>playerdata[playertargetID]</code> + (2.0, 0.0, -0.15) with 1.5 multiplier and stopstate 100</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li><code>height</code> set to 0.0</li> <li>y position set to the <code>height</code> value before this action</li> <li>animstate set to 26 (<code>AirTackle</code>)</li> <li><code>FastWoosh</code> sound plays</li> <li>Over the course of 1 / 0.055 frames (~18.181818 frames), this enemy moves to its current position + 0.75 in x via a BeizierCurve3 with a ymax of -0.01</li> <li>animstate set to 100</li> <li>Yield for 0.2 seconds</li> <li>animstate set to 26 (<code>AirTackle</code>)</li> <li><code>Turn2</code> sound plays</li> <li>Over the course of 1 / 0.07 frames (~14.285714 frames), this enemy moves to <code>playerdata[playertargetID]</code> position + (0.0, 1.0, -0.1) via a lerp</li> <li>DoDamage call 1 happens</li> <li>Yield for 0.15 seconds</li> <li><code>height</code> set to 0.2</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 1 / 0.045 frames (~22.22222 frames), this enemy moves to its position before the BeizierCurve3 movement earlier via a lerp</li> <li>y position is set to 0.0</li> <li><code>height</code> is restored to its value before this action</li> <li>Yield for 0.2 seconds</li> <li><code>bobrange</code> reset to <code>startbf</code></li> <li><code>bobspeed</code> reset to <code>startbs</code></li> <li>FlipAngle called with setangle</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/#move-2-tackle-attack","title":"Move 2 - Tackle attack","text":"<p>A single target tackle attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Seedling/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to new coroutine called SeedlingTackle which will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li>FlipAngle called with setangle</li> </ul> <p>This is what the coroutine effectively does:</p> <ul> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Done 2 times:<ul> <li>Jump called</li> <li><code>Jump</code> sound plays with 0.75 pitch and 1.6 volume</li> <li>Yield for 0.1 seconds</li> <li>Yield all frames until <code>onground</code> goes to true</li> <li>Yield a frame</li> </ul> </li> <li>CameraFocusTarget called</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 3.0 in x with a 2.0 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Yield for 0.2 seconds</li> <li><code>Spin10</code> sound plays</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + (0.35, 0.0, -0.1) with a 2.5 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>DoDamage 1 call happens</li> <li>Jump called</li> <li><code>flip</code> set to false (with <code>overrideflip</code>)</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 2.0 in x with a 0.75 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> is set to false</li> <li><code>checkingdead</code> set to null indicating the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/","title":"<code>SeedlingKing</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: When the value is 0, it means this enemy hasn't went through its phase transition yet which happens on the start of the actor turn if their HPPercent reaches 0.5 or below. When this transition occurs, the value is set to 1 so the transition only happens once per battle</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>When the phase transition occurs in the pre move logic, this enemy gains a DefenseUp condition for 9999999 main turns (effectively infinite)</li> <li>In the enemy summon move, the summoned enemy gains an AttackUp and a DefenseUp conditions for 999999 each (effectively infinite)</li> <li>If this enemy attempts to use the enemy summon move when there's already 3 or more enemy party members and the phase transition hasn't happened yet a seeds throw move will be used instead of not using any moves</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#move-selection","title":"Move selection","text":"<p>4 moves are possible:</p> <ol> <li>A single target tackle attack</li> <li>A party wide rolling attack</li> <li>Summons up to 2 new enemies from the seedlings family of enemies</li> <li>Multiple seeds throws targetting random player party members</li> </ol> <p>The decision of which move to use is based on odds, but those odds changes if HPPercent becomes 0.5 or lower. Here are the base odds of each move in either situations:</p> Move Odds when HPPercent &gt; 0.5 Odds when HPPercent &lt;= 0.5 1 Never used 4/11 2 Never used 3/11 3 3/4 2/11 4 1/4 2/11 <p>However, move 3 will not be used if there are already 3 or more enemy party members. What happens in that situation when it is selected is decided by the following logic:</p> <ul> <li>If HPPercent is 0.5 or lower, Move 1 is used</li> <li>Otherwise, if hardmode is false, the entire action ends with no moves being used</li> <li>Otherwise (hardmode is true), move 4 is used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen at the start of the actor turn.</p> <p>The game determines if we are before or after phase transition threshold by checking if HPPercent is 0.5 or below. If it is and <code>data[0]</code> is 0, it means the transition has yet to happen. Notably, it sets <code>moves</code> to 2 which grants 2 actor turns per main turns to this enemy (excluding the current main turns). This is the phase transition logic:</p> <ul> <li>If hardmode is true, SetCondition called to inflict the DefenseUp condition on the new enemy for 9999999 main turns (effectively infinite)</li> <li>Emoticon called with emote <code>Exclamation</code> for 50 time</li> <li><code>Wam</code> sound plays</li> <li><code>data[0]</code> set to 1 so this transition doesn't happen again</li> <li>animstate set to 100</li> <li><code>Prefabs/Particles/AngryParticle</code> instantiated childed to the <code>sprite</code> with a local position of <code>freezeoffset</code></li> <li>Yield for 0.75 seconds</li> <li><code>Prefabs/Particles/AngryParticle</code> gets destroyed</li> <li>animstate set to 2 (<code>Jump</code>)</li> <li>Jump called with an h of 15.0</li> <li><code>Turn</code> sound plays with 0.9 pitch</li> <li>Yield for 0.5 seconds</li> <li><code>height</code> and <code>minheight</code> set to 0.0</li> <li><code>subentity</code> set to null after saving their elements into a local array</li> <li>All previous <code>subentity</code> elements gets rooted and their animstate set to 11 (<code>Hurt</code>)</li> <li>Yield until this enemy is <code>onground</code></li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>SetAnim called with <code>f</code></li> <li><code>Thump5</code> sound plays</li> <li><code>impactsmoke</code> particles plays at this enemy position</li> <li>For each older <code>subentity</code> elements:<ul> <li>x angles set to 85.0</li> <li>FadeSprite called with 90.0 frametime with destroy</li> </ul> </li> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li>Yield for 0.75 seconds</li> <li><code>moves</code> set to 2 (meaning this enemy now gets 2 actor turns per main turns)</li> <li>SetAnim called with empty string</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#move-1-tackle-attack","title":"Move 1 - Tackle attack","text":"<p>A single target tackle attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null {BlockSoundOnly} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>MoveTowards <code>playertargetentity</code> position + (3.0, 0.0, -0.1) with 2.0 multiplier using both 1 (<code>Walk</code>) as walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Grow1</code> sound plays with 0.7 pitch</li> <li>ShakeSprite called with intensity (0.1, 0.0, 0.0) and 45.0 frametimer</li> <li>This enemy moves +1.0 in x via MainManager.MoveTowards with 45.0 frametime with smooth with local</li> <li>Yield for 0.75 seconds</li> <li><code>Grow2</code> sound plays</li> <li>Over the course of 10.5 frames, this enemy moves to <code>playertargetentity</code> position + (0.75, 0.0, -0.1) via a lerp</li> <li><code>HugeHit</code> sound plays</li> <li>ShakeScreen called with ammount (0.2, 0.0, 0.0) with 0.75 time with dontreset</li> <li>DoDamage 1 call happens</li> <li>Over the course of 31.0 frames, this enemy moves + 1.5 in x via a BeizierCurve3 with a ymax of 3.0</li> <li><code>ThumpSoft</code> sound plays</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#move-2-rolling-attack","title":"Move 2 - Rolling attack","text":"<p>A party wide rolling attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 3 null <code>commandsuccess</code> 10.0 (0.0, 20.0, 0.0) false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>ShakeSprite called with intensity (0.1, 0.0, 0.0) and 60.0 frametimer</li> <li>This enemy moves +1.0 in x via MainManager.MoveTowards with 60.0 frametime with smooth without local</li> <li>Jump called</li> <li><code>Spin5</code> sound plays on loop using <code>sounds[5]</code></li> <li>Yield for a second</li> <li><code>trail</code> set to true</li> <li>SetDefaultCamera called</li> <li><code>sounds[5]</code> stopped</li> <li><code>SeedlingKingRoll</code> sound plays</li> <li>Over the course of 37.5 frames, this enemy moves to (-15.0, 0.0, 0.0) via a lerp. On the first frame their x position gets less than -4.5:<ul> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li>DoDamage 1 call happens</li> </ul> </li> <li><code>trail</code> set to false</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Yield for 0.75 seconds</li> <li>Over the course of 38.0 frames, this enemy moves from (10.0, 0.0, 0.0) to startp via a lerp</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#move-3-enemies-summon","title":"Move 3 - Enemies summon","text":"<p>Summons up to 2 new enemies from the seedlings family of enemies.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li><code>rustling1</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li>The position of the new enemies is determined depending on if their place is taken or not. The left location is at (0.25, 0.0, -0.1) and the right location is at (7.0, 0.0, 0.1). The left one takes priority if available, but both will be summoned if both locations are free</li> <li>Yield for 0.33 seconds</li> <li>For each free location available to summon from the 2 ones above:<ul> <li><code>rustling1</code> sound plays</li> <li>A new sprite object is created rooted using the <code>TangyBerry</code> item sprite</li> <li>Over the course of 61.0 frames, the sprite moves to the target location via a BeizierCurve3 with a ymax of 6.0. Before each frame yield, the z angle is set to the frame index * 20.0</li> <li>The sprite is destroyed</li> <li>A seedling family enemy id is generated using the following odds:<ul> <li>Seedling: 2/7</li> <li>Acornling: 2/7</li> <li>Underling: 2/7</li> <li>Cactus: 1/7 (overriden to <code>Seedling</code> if this is the left location)</li> </ul> </li> <li><code>Charge</code> sound plays</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon the enemy with the generated id with type <code>FromGroundInstant</code> at the location without cantmove (meaning this enemy will be able to act immeditely on the current main turn)</li> <li>Yield until <code>checkingdead</code> is null (the coroutine completed)</li> <li>The new enemy gets some adjustements:<ul> <li><code>maxhp</code>: Divided by 2 floored</li> <li><code>hp</code>: Set to their <code>maxhp</code></li> <li><code>exp</code>: Divided by 2 floored</li> </ul> </li> <li>If hardmode is true:<ul> <li>SetCondition called to inflict the AttackUp condition on the new enemy for 999999 main turns (effectively infinite)</li> <li>SetCondition called to inflict the DefenseUp condition on the new enemy for 999999 main turns (effectively infinite)</li> </ul> </li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#move-4-seeds-throw","title":"Move 4 - Seeds throw","text":"<p>Multiple seeds throws targetting random player party members.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen for half the amount of seeds thrown ceiled, but each call can only happen if GetRandomAvaliablePlayer with nullable doesn't return -1. The amount of seeds thrown is random between 3 and 5 inclusive 2 null This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) A new GameObject rooted with a SpriteRenderer using the <code>HardSeed</code> item sprite  positioned at this enemy + (0.0, 3.0, 0.1) using the <code>spritemat</code> material on layer 0 (Default) 55.0 A random integer between 6 and 8 inclusive which is then cast to float null null <code>WoodHit</code> Empty string (0.0, 0.0, random integer between -20 and 20 which is then cast to float) false <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SeedlingKing/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>ShakeScreen called for 0.05 ammount and -1.0 time</li> <li><code>animstate</code> set to 100</li> <li><code>rustling1</code> sound plays on loop using <code>sounds[5]</code></li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to a new SeedShake coroutine called in such a way that it effectively ends up doing the following:<ul> <li>A SpriteRenderer array is created to contain the seeds with the length being the amount to throw which is random between 3 and 5 inclusive</li> <li>For each seeds to throw:<ul> <li>The seed element of the array is initialised to a new GameObject rooted with a SpriteRenderer using the <code>HardSeed</code> item sprite  positioned at this enemy + (0.0, 3.0, 0.1) using the <code>spritemat</code> material on layer 0 (Default)</li> <li>GetRandomAvailablePlayer called with nullable. NOTE: This targetting scheme is broken, see the nullable GetRandomAvailablePlayer documentation for details</li> <li>If the seed index is even and the target player party member isn't -1, <code>Ping</code> sound plays followed by a Projectile 1 call. If it's odd, <code>PingUp</code> sound plays with 0.75 volume followed by the seed object moving via MainManager.ArcMovement to a random vector between (0.0, 0.0, -5.0) and (10.0, 0.0, 5.0) with destroyonend and using the same spin, height and frametime than the Projectile 1 call</li> <li>Yield for a random interval between 0.3 and 0.6 seconds</li> </ul> </li> <li>Yield all frames until all elements of the seeds array are null (all Projectile 1 calls completed)</li> <li><code>checkingdead</code> set to null</li> </ul> </li> <li>Yield all frames until <code>checkingdead</code> is null (SeedShake completed)</li> <li>MainManager.<code>screenshake</code> set to Vector3.zero</li> <li><code>sounds[5]</code> stopped</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ShockWorm/","title":"<code>ShockWorm</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/ShockWorm/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>After attacking, the odds to set isdefending to true with 2 <code>defenseonhit</code> changes to 51% from 31% which also means that the chances they set <code>isdefending</code> to false with 0 <code>defenseonhit</code> changes to 49% from 69%</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ShockWorm/#move-selection","title":"Move selection","text":"<p>1 move is possible:</p> <ol> <li>A single target electric shock attack</li> </ol> <p>Move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ShockWorm/#post-move-logic","title":"Post move logic","text":"<p>The following logic is always done after using a move:</p> <ul> <li>If a 31% RNG check passes (51% instead if hardmode is true):<ul> <li>FlipAngle called with setangle</li> <li><code>TextBack</code> sound plays</li> <li>IsDefending set to true</li> <li><code>defenseonhit</code> set to 2</li> <li>animstate and the local startstate set to 24 (<code>Block</code>)</li> <li>FlipSimple called</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>Otherwse (the RNG check failed):<ul> <li>If isdefending is true, <code>TextBack2</code> sound plays</li> <li>The local startstate is set to 0 (<code>Idle</code>)</li> <li><code>isdefending</code> set to false</li> <li><code>defenseonhit</code> set to 0</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ShockWorm/#move-1-electric-shock-attack","title":"Move 1 - Electric shock attack","text":"<p>A single target electric shock attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ShockWorm/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Numb null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ShockWorm/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.0, 0.0, -0.1) with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li><code>Charge17</code> sound plays</li> <li>ShakeSprite called with intensity (0.1, 0.0, 0.0) and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 101</li> <li>DoDamage 1 call happens</li> <li><code>ElecFast</code> particles plays at this enemy position + (0.0, 0.5, -0.1)</li> <li><code>Shock</code> sound plays</li> <li>Yield for 0.7 seconds</li> <li>SetDefaultCamera called</li> <li>MoveTowards startp with 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/","title":"<code>SkullCaterpillar</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: This is a cooldown for the usage of the screaming attack move. See the move selection section for details on how this cooldown works as it doesn't behave like a typical actor turn cooldown</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the rolling attack move, the amount of frames this takes to move changes to 28.0 frames from 33.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A party wide rolling attack</li> <li>A party wide screaming attack</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 3/5 2 2/5 <p>However, move 2 won't be used if <code>data[0]</code> (its usage cooldown) hasn't expired yet. If this happens, move 1 is used instead. </p> <p>The cooldown is set to expire after either 1 or 2 decrements determined randomly. Move 1 always causes a decrement when used, but move 2 will too if it is selected and the cooldown hasn't expired yet. This means that effectively:</p> <ul> <li>If it was set to expire after 1 decrement, move 2 becomes usable after the next actor turn no matter which move is selected and used</li> <li>If it was set to expire after 2 decrements, then it depends on which move is selected on the next actor turn:<ul> <li>If it's move 1, then move 2 still won't be usable on the next actor turn</li> <li>If it's move 2, it will become usable on the next actor turn</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#move-1-rolling-attack","title":"Move 1 - Rolling attack","text":"<p>A party wide rolling attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 2 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Curl</code> sound plays</li> <li>Camera moves to look near this enemy</li> <li>animstate set to 100</li> <li>Jump called on this enemy</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until this enemy is <code>onground</code></li> <li><code>Spin2</code> sound plays on loop using <code>sounds[9]</code> with 1.25 pitch</li> <li>ShakeSprite called with an intensity of (0.1, 0.0, 0.0) and 45.0 frametimer</li> <li>Yield for 0.75 seconds</li> <li>SetDefaultCamera called</li> <li><code>sounds[9]</code> pitch set to 1.1</li> <li>Over the course of 33.0 frames (28.0 frames instead if hardmode is true), this enemy moves to (-15.0, 0.0, 0.0) via a lerp. On the first frame its x position becomes lower than 4.5:<ul> <li>ShakeScreen called with 0.15 ammount and 0.8 time</li> <li>PartyDamage 1 call</li> </ul> </li> <li>Over the course of 41.0 frames, this enemy moves to startp via a lerp</li> <li>Jump called on this enemy</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until this enemy is <code>onground</code></li> <li><code>data[0]</code> is decremented if it is above 0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#move-2-screaming-attack","title":"Move 2 - Screaming attack","text":"<p>A party wide screaming attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#partydamage_1","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 2 Numb <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/SkullCaterpillar/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> set to a new ScreamWaves (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li><code>data[0]</code> is set to either 1 or 2 determined randomly</li> </ul> <p>This is what the coroutine ends up doing:</p> <ul> <li>Camera moves to look near this enemy</li> <li>animstate set to 101</li> <li>ShakeSprite called with an intensity of (0.05, 0.0, 0.0) and 85.0 frametimer</li> <li>Yield for 0.85 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy's <code>sprite</code> + its CenterPos + (0.5, 1.0, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>Done 5 times in a separate coroutine started in paralel called MainManager.Waves:<ul> <li>A <code>Prefabs/Objects/SphereGlowEffect</code> GameObject is instantiated rooted at this enemy's world CenterPos with a scale of 0.0x</li> <li>Over the course of 31.0 frames, the scale of <code>Prefabs/Objects/SphereGlowEffect</code> changes to (50.0, 50.0, 1.0) via a lerp</li> <li>The <code>Prefabs/Objects/SphereGlowEffect</code> gets destroyed</li> <li>Yield for 0.25 seconds</li> </ul> </li> <li>SetDefaultCamera called</li> <li><code>MadesphyScream</code> sound plays</li> <li>animstate set to 103</li> <li>ShakeScreen called with an ammount of 0.2 and 1.0 time</li> <li>Yield for 0.25 seconds</li> <li>PartyDamage 1 call happens</li> <li>Yield for a second</li> <li><code>checkingdead</code> set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sneil/","title":"<code>Sneil</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Sneil/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the projectile beam move, the projectile takes 1 / 0.04 frames (25 frames) for the projectile to move to its target instead of 1 / 0.03 frames (~33.3333333334 frames)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sneil/#move-selection","title":"Move selection","text":"<p>1 move is possible:</p> <ol> <li>A single target projectile beam</li> </ol> <p>Move 1 is always done.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sneil/#move-1-projectile-beam","title":"Move 1 - Projectile beam","text":"<p>A single target projectile beam</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sneil/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sneil/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 Sleep This enemy <code>playertargetID</code> after GetSingleTarget A new GameObject rooted with a SpriteRenderer using the <code>projectilepsrites[4]</code> sprite (a bolt projectile) 0.03 (~33.33333334 frames of movement) if hardmode is false, 0.04 if it's true (25 frames of movement) 0.0 <code>keepcolor</code> <code>deathsmokelow</code> null null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Sneil/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> is set to new coroutine called SnailBeam which will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the coroutine effectively does:</p> <ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code> position</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 101</li> <li><code>Lazer</code> sound plays</li> <li>The projectile GameObject is created rooted with position being this enemy position + (-1.25, 1.0, -0.1), angles of 90.0 in z, scale of (0.5, 0.5, 0.5), sprite of <code>projectilepsrites[4]</code> sprite (a bolt projectile) and magenta color (the color is ignored because of the <code>keepcolor</code> argument sent to Projectile)</li> <li>Projectile call 1 happens</li> <li>Yield all frames until the projectile is null (it was destroyed meaning Projectile is done)</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to null informing the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/","title":"<code>Spuder</code>","text":"<p>NOTE: There are 5 related EventDialogues to this enemy action. They supplement the logic presented here in significant ways since it is expected that there are at least 3 different encounters with this enemy. Check the documentation to learn more about the first 2 encounter's changes to the action logic and for the 2 EventDialogues used on the third encounter. This page mostly talks about the logic on the third encounter which is the typical one and won't talk much about the first 2.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>This enemy has special logic in StartBattle after it is loaded:</p> <ul> <li>If flags 41 is false (before the end of chapter 1) and either <code>flags</code> 613  or 614 are true (RUIGEE or HARDEST are active), the <code>hp</code> and <code>maxhp</code> are decreased by 15. This happens regardless of the value of hardmode.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#relation-with-spuderreal","title":"Relation with <code>SpuderReal</code>","text":"<p><code>SpuderReal</code> is an enemy entry that has no action logic and it acts as a variant of this enemy meaning it ends up being loaded as a <code>Spuder</code> with the exception of some fields. It is only used when fighting them using the B.O.S.S system.</p> <p>In practice, everything ends up being equivalent with one exception: <code>SpuderReal</code> has its notired set to true which means specifically for its B.O.S.S encounter, their exhaustion is disabled even when the <code>DoublePain</code> medal is unequipped.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: Represents a main turn countdown that tracks the state of the position of the enemy:<ul> <li>-1: A temporary state where the enemy was <code>Flying</code> since 2 main turns and it decided to drop down to <code>Ground</code>, but all of the actor turns of the enemy aren't over yet. Once all of their actor turns are over, the value changes to 0</li> <li>0: The initial state, the enemy could decide to rise in the air to <code>Flying</code> on its own which will set the value to 2</li> <li>1: This enemy rose in the air to be <code>Flying</code> 2 main turns ago and it will drop down to <code>Ground</code> on the next main turn if it is still <code>Flying</code> by then which will change the value to -1</li> <li>2: This enemy rose in the air to be <code>Flying</code> on the last main turn and it will continue to be <code>Flying</code> on the next main turn if it is still <code>Flying</code> by then, but the value will decrease to 1</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the poison breath move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the poison bubble throw move, each bubbles takes 1 / 0.02 frames (50.0) for the projectile to move to its target instead of 1 / 0.0175 frames (~57.1429)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A Single target bite attack</li> <li>Change their position to <code>Flying</code> by rising in the air</li> <li>A party wide poison breath attack</li> <li>A multiple target poison bubble throws</li> <li>Change their position to <code>Ground</code> by dropping down from the air</li> </ol> <p>Move 4 requires the enemy position to be <code>Flying</code>, but it is always selected if it is <code>Flying</code>. This logic applies to all of the 3 encounters.</p> <p>Move 5 is always used at the start of the their first action of the main turn if <code>data[0]</code> is 1. However, it is the only move that won't end the action as this enemy will use move 1 or 3 in the same action right after. Notably, it sets <code>data[0]</code> to -1 which has effects on the move selection detailed further below.</p> <p>As for moves 1 to 3 when on <code>Ground</code> or just dropped from <code>Flying</code>, the decision of which moves to use depends on odds, but those odds changes depending on whether or not <code>hp</code> is less than their <code>maxhp</code> / 2 floored and whether <code>data[0]</code> is -1 or not. The latter is because the logic is built in such a way that this enemy cannot rise in the air to <code>Flying</code> if they already decided to drop down to <code>Ground</code> on this main turn. When that happens, it redirects the move selection to another move between 1 and 3 with different odds than normal.</p> <p>Here is a table representing the different odds of using move 1, 2 or 3 depending on these factors:</p> <code>hp</code> &lt; <code>maxhp</code> / 2 floored? <code>data[0]</code> is -1? (decided to drop down) Move selection chances No No <ol><li>1/2</li><li>1/2</li><li>Never uses</li></ol> No Yes <ol><li>4/5</li><li>Never uses</li><li>1/5</li></ol> Yes No <ol><li>1/3</li><li>1/3</li><li>1/3</li></ol> Yes Yes <ol><li>8/15</li><li>Never uses</li><li>7/15</li></ol>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen after the usage of a move:</p> <ul> <li>If position is <code>Ground</code>, <code>data[0]</code> is -1 (this enemy decided to drop down after waiting long enough) and <code>cantmove</code> is 0 (meaning this is this enemy's last actor turn of the main turn):<ul> <li><code>data[0]</code> is reset to 0</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#move-1-bite-attack","title":"Move 1 - Bite attack","text":"<p>A single target bite attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Scuttle2</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code> with 0.9 pitch and 0.8 volume</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetID</code> position + (1.1, 0.0, -0.25) with a multiplier of 1.3333334</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li>animstate set to 105</li> <li>Yield for 0.2 seconds</li> <li>animstate set to 103</li> <li><code>Bite</code> sound plays</li> <li>Yield for 0.3 seconds</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#move-2-change-their-position-to-flying","title":"Move 2 - Change their position to <code>Flying</code>","text":"<p>Change their position to <code>Flying</code> by rising in the air. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>animstate set to 106</li> <li>A new GameObject is created called <code>line</code> childed to the model's first child with a LineRenderer with several properties set such as a pure white color and the <code>spritemat</code> material</li> <li><code>Chew</code> sound plays</li> <li>Over the couse of 50.0 frames, <code>line</code>'s second position changes to the local startp + 15.0 in y via a lerp</li> <li>Yield for a frame</li> <li><code>basestate</code>, <code>animstate</code> and the local startstate set to 108</li> <li><code>Rise</code> sound plays</li> <li><code>height</code> increases each frame for 0.25 of the game's frametime until it reaches 3.0 or above</li> <li>position set to <code>Flying</code></li> <li><code>data[0]</code> set to 2</li> <li>Yield for 0.3 seconds</li> <li>If <code>tempdata</code> was 1 (meaning this was the second encounter), it is set to 0 so it won't override move selection again the same way. See the second encounter documentation to learn more</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#move-3-poison-breath-attack","title":"Move 3 - Poison breath attack","text":"<p>A party wide poison breath attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any player party member whose <code>hp</code> is above 0.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen for each player party members whose <code>hp</code> is above 0 This enemy The player party member 1 poison null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>Blosh</code> sound plays</li> <li>animstate set to 113</li> <li>Camera moves to look at this enemy, but zoomed in</li> <li>Yield for 1 second</li> <li><code>Clomp</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 104</li> <li>SetDefaultCamera called</li> <li><code>Mist</code> sound plays</li> <li><code>poisonsmoke</code> particles plays at this enemy position + 1.5 in y with 7.5 alivetime</li> <li>CreateHelpBox called with 4 (the <code>TappingKey</code> command's help)</li> <li>DoCommand 1 call happens</li> <li>All player party member whose <code>hp</code> is above 0 has their y <code>spin</code> set to 15.0</li> <li>Yield all frames until <code>doingaction</code> goes to false. Before each frame yield, all player party member whose <code>hp</code> is above 0 has their animstate set to 11 (<code>Hurt</code>) (but if <code>blockcooldown</code> is above 0 meaning a block was done, it's set to 24 (<code>Block</code>) instead)</li> <li>All player party member whose <code>hp</code> is above 0 has DoDamage 1 call happen on them followed by their <code>spin</code> getting zeroed out</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#move-4-poison-bubble-throws","title":"Move 4 - Poison bubble throws","text":"<p>A multiple target poison bubble throws</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any targets.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Happens once if there's at least one player party member alive (<code>hp</code> above 0 and not eatenby). If that is still the case after and <code>hp</code> is less than <code>maxhp</code> / 2 floored, it happens a second time 2 Poison This enemy <code>playertargetID</code> after GetSingleTarget (changes for each calls) A new instance of <code>Prefabs/Objects/PoisonBubble</code> childed to this enemy's model's first child's first child 0.0175 (~57.1429 frames of movement) if hardmode is false, 0.02 if it's true (50.0 frames of movement) 0.0 null <code>PoisonEffect</code> <code>BubbleBurst</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>animstate set to 109</li> <li><code>Blosh</code> sound plays</li> <li>Camera moves to look at this enemy, but zoomed in</li> <li>Yield for 1.25 seconds</li> <li>Camera moves to look near the center between this enemy and <code>playerdata[0]</code></li> <li>animstate set to 111</li> <li><code>Wub</code> sound plays on loop using <code>sounds[9]</code> with 0.7 pitch</li> <li>The amount of hits is determined which is 1 unless <code>hp</code> is less than <code>maxhp</code> / 2 where it's 2 instead. An array of GameObject is initialised to hold the projectiles elements with this amount as the length</li> <li>For each hit to do:<ul> <li>If there's at least one player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>The element of the bubbles array is initialised to a new instance of <code>Prefabs/Objects/PoisonBubble</code> childed to the model's first child's first child whose SpriteRender has a material's renderQueue of 10000</li> <li>animstate set to 111</li> <li><code>Clomp</code> sound plays</li> <li>Projectile 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>If this is the last bubble to throw, animstate set to 109 followed by <code>Blosh</code> sound plays followed by Yield for 0.5 seconds</li> </ul> </li> <li>Otherwise:<ul> <li>The element of the bubbles array is reinitialised to a new GameObject</li> <li>Yield for a frame</li> <li>The element of the bubbles array is destroyed</li> </ul> </li> </ul> </li> <li>Yield all frames until all elements of the bubbles array are null (all Projectile 1 calls completed)</li> <li><code>sounds[9]</code> stopped</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#move-5-change-their-position-to-ground","title":"Move 5 - Change their position to <code>Ground</code>","text":"<p>Change their position to <code>Ground</code> by dropping down from the air. No damages are dealt.</p> <p>The bite attack move or the poison breath attack move will be used right after this one without ending the actor turn.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Spuder/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>Yield for 0.2 seconds</li> <li><code>data[0]</code> set to -1</li> <li><code>line</code> gets destroyed</li> <li><code>RopeSnap</code> sound plays</li> <li>animstate and the local startstate are set to 0 (<code>Idle</code>)</li> <li>Yield for 0.1 seconds</li> <li>Over the course of 20.0 frames, <code>height</code> changes to 0.0 via a lerp</li> <li><code>height</code> set to 0.0</li> <li><code>impactsmoke</code> particles plays at this enemy position</li> <li>ShakeScreen called with 0.2 ammount and 45.0 time</li> <li><code>Thud</code> sound plays with 1.2 pitch and 0.9 volume</li> <li>Yield for 0.6 seconds</li> <li>position set to <code>Ground</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/","title":"<code>Stratos</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy is fought with them and Delilah only in the enemy party as they strongly interact together. If this assumption isn't respected, exceptions may be thrown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 5 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: The amount of times the reviving move or the enemy party healing move are used. The value is incremented each time either of these moves are used and once it reaches 5, the usage of these moves are no longer allowed. Essentially, it's a hard limit to this enemy where they cannot use either moves more than 5 times combined in the entire battle</li> <li><code>data[1]</code>: The amount of times the reviving move was used. The value is incremented each time the reviving move is used. When the value reaches 3, the odds that the move is used when all other conditions are fufilled lowers to 20% from 70%. Essentially, it's a deterrent on the usage of the reviving move more than 3 times</li> <li><code>data[2]</code>: A cooldown on the usage of the reviving move and the enemy party healing move. When either move is used, the value is set to 2. On every actor turns that either of these move isn't used, the value is decremented in the post move logic. For either of the moves to become usable again, the value must be 0 or below. Essentially, it's a 2 actor turn antispams where both moves can't be used again</li> <li><code>data[3]</code>: A lock on the usage of the reviving move and the enemy party healing move. When the value is 1, it prevents either move to be used. The value is reset to 0 in the post move logic after any moves is used except these 2 moves. The lock is never activated by this enemy, but rather by Delilah which sets it to 1 when they use their reviving move</li> <li><code>data[4]</code>: This doesn't do anything meaningful in practice. It is set to 1 when the party wide sword jump attack is used and it is supposed to prevent the use of the charging move if the value is 1, but this doesn't work. This is because the value is always set to 0 on the same actor turn as the usage of the party wide sword jump attack move is used which undoes the effect it would have had.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-selection","title":"Move selection","text":"<p>8 moves are possible:</p> <ol> <li>A single target downard sword slash that can inflict DefenseDown</li> <li>A single target triple downward sword slash</li> <li>A single target sword hit shockwave attack</li> <li>Prepares for a big attack by setting <code>charge</code> to 2</li> <li>A single target sideway sword slash that can inflict AttackDown</li> <li>A party wide sword jump attack that can inflict DefenseDown</li> <li>Heals 15 <code>hp</code> and calls ClearStatus on themselves and Delilah</li> <li>Revives Delilah leaving them at 7 <code>hp</code></li> </ol> <p>Move 7 and 8 are isolated in the move selection process and their usage consideration takes priority over anything else. </p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#7-and-8-selection-process","title":"7 and 8 selection process","text":"<p>To have a chance to use either move 7 or 8, all of the following conditions must be fufilled:</p> <ul> <li><code>data[3]</code> is 0 (the lock on using either moves wasn't activated by Delilah)</li> <li><code>charge</code> is 0 (this doesn't necessarily mean that move 4 was used previously as it is possible the player cleared this enemy's <code>charge</code>)</li> <li><code>data[0]</code> is less than 5 (this enemy hasn't reached its limit of move 7 or 8's usage)</li> <li><code>turns</code> is above 1 (at least 2 main turns passed since the start of the battle)</li> <li><code>data[2]</code> is 0 or below (the cooldown for being able to use move 7 or 8 expired)</li> </ul> <p>If all of the above are fufilled, it is now possible that move 7 or 8 is used. However, either requires specific conditions for the move to actually be used and it's still possible neither are. If neither are, the standard move selection process happens with move 1 through 6.</p> <p>Move 8 is checked first and it will be used if all of the following conditions are fufilled:</p> <ul> <li>Delilah isn't present in <code>enemydata</code> (they died)</li> <li>Either of the following is true:<ul> <li><code>forceattack</code> is -1 (not taunted)</li> <li>HPPercent is less than 0.3 and a 40% RNG check passes</li> </ul> </li> <li>A 70% RNG check passes (20% instead if <code>data[1]</code> is at least 3 meaning this enemy already used this move 3 times before)</li> </ul> <p>If move 8 was decided to not be used, move 7 is checked next. It's only used if all of the following conditions are fufilled:</p> <ul> <li>Delilah is present in <code>enemydata</code></li> <li>Both this enemy and Delilah have an HPPercent lower than 0.25</li> <li>A 35% RNG check passes</li> </ul> <p>If neither moves are used, the standard move selection process is done instead.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#standard-move-selection","title":"Standard move selection","text":"<p>Move 6 is always (and only used) if <code>basestate</code> is 106 (meaning move 4 was used before as it sets <code>basestate</code> to 106).</p> <p>As for move 1 through 5, the decision of which move to use is based on the following odds:</p> Move Odds 1 3/10 2 1/10 3 3/10 4 1/10 5 2/10 <p>However, move 4 has additional requirements for the move to actually be used once selected. The following conditions must all be fufilled for move 4 to be used once selected:</p> <ul> <li>HPPercent is above 0.15 and below 0.75</li> <li><code>cantmove</code> is 0 (meaning this is the last actor turn of the main turn for this enemy)</li> <li><code>data[4]</code> is 0 (thid doesn't do anything in practice and it will always be true)</li> </ul> <p>If the move selected, but the conditions above aren't fufilled, move 3 is used instead</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done before the usage of a move:</p> <ul> <li><code>walkstate</code> is set to 23 (<code>Chase</code>)</li> <li>If HPPercent is less than 0.5 and <code>moves</code> is 1 (meaning this phase transition hasn't happened yet), this enemy goes into a phase transition where they get 2 actor turns per main turn including the current one:<ul> <li><code>Charge18</code> sound plays with 1.1 pitch</li> <li>y <code>spin</code> set to 10.0</li> <li>animstate set to 4 <code>ItemGet</code></li> <li>Yield for 0.5 seconds</li> <li><code>spin</code> zeroed out</li> <li>StatEffect called with type 5 (yellow up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>moves</code> set to 2 and <code>cantmove</code> is decremented which gives 2 actor turn per main turn to this enemy including the current one</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#post-move-logic","title":"Post move logic","text":"<p>The following logic is always done after the usage of a move except fot the reviving move and the enemy party healing move:</p> <ul> <li><code>data[4]</code> is set to 0 (this undoes any effect this value would have had, see the <code>data</code> section above for details)</li> <li><code>data[2]</code> is decremented (the cooldown for the usage of the reviving move and the enemy party healing move)</li> <li><code>data[3]</code> is set to 0 (resets the lock on the usage of the reviving move and the enemy party healing move that was activated by Delilah)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-1-single-downward-sword-slash","title":"Move 1 - Single downward sword slash","text":"<p>A single target downard sword slash that can inflict DefenseDown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 7 DefDownOnBlock null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playerdata[playertargetID]</code> + (3.0, 0.0, -0.15)</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Woosh6</code> sound plays</li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>WaspKingAxToss</code> sound plays with 0.95 pitch</li> <li>animstate set to 103</li> <li><code>Thud4</code> sound plays with 1.1 pitch</li> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-2-triple-downward-sword-slash","title":"Move 2 - Triple downward sword slash","text":"<p>A single target triple downward sword slash.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code> 2 Always happen 2 times after DoDamage 1 This enemy The same target as DoDamage 1 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playerdata[playertargetID]</code> + (3.0, 0.0, -0.15)</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Woosh6</code> sound plays</li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>WaspKingAxToss</code> sound plays with 0.95 pitch</li> <li>animstate set to 103</li> <li><code>Thud4</code> sound plays with 1.1 pitch</li> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (-0.45, 2.4, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>Done 2 times:<ul> <li>animstate set to 102</li> <li>Yield for a frame</li> <li><code>WaspKingAxToss</code> sound plays with 0.95 pitch</li> <li>animstate set to 103</li> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li>DoDamage 1 call happens</li> <li><code>Thud4</code> sound plays with 1.1 pitch</li> <li>Yield for 0.33 seconds</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-3-sword-hit-shockwave-attack","title":"Move 3 - Sword hit shockwave attack","text":"<p>A single target sword hit shockwave attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 6 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>MoveTowards <code>playertargetentity</code> position + (8.5, 0.0, -0.1) with 1.5 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> set to false</li> <li><code>Woosh</code> sound plays</li> <li>animstate set to 102</li> <li>ShakeSprite called with 0.1 intensity and 45.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 103</li> <li><code>WaspKingAxToss</code> with 0.95 pitch</li> <li><code>Thump5</code> sound plays</li> <li>ShakeScreen called with 0.1 ammount and -1.0 time (infinite)</li> <li>A new <code>Prefabs/Objects/StratosWave</code> GameObject is instantiated rooted</li> <li>Over the course of 21.0 frames, the <code>Prefabs/Objects/StratosWave</code> moves from this enemy position + (-2.0, 0.0, -0.1) to <code>playertargetentity</code> position - 0.1 in z via a lerp</li> <li><code>HugeHit4</code> sound plays</li> <li>DeathSmoke particles plays at <code>playertargetentity</code> position with 4.0x size</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code> position</li> <li>The <code>Prefabs/Objects/StratosWave</code> is moved offscreen at -9999.0 in y then destroyed in 1.0 second</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>MainManager.<code>screenshake</code> zeroed out</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-4-prepares-a-big-attack-with-2-charge","title":"Move 4 - Prepares a big attack with 2 <code>charge</code>","text":"<p>Prepares for a big attack by setting <code>charge</code> to 2. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>Charge18</code> sound plays with 1.1 pitch</li> <li>The local startstate, animstate and <code>basestate</code> set to 106 (this allows to use the party wide sword jump attack on the next actor turn when not using the reviving move or the enemy party healing move)</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>charge</code> is set to 2</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-5-single-sideway-sword-slash","title":"Move 5 - Single sideway sword slash","text":"<p>A single target sideway sword slash that can inflict AttackDown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#dodamage-calls_3","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 7 AtkDownOnBlock {NoSound} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 104</li> <li>Yield for 0.5 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy + (0.0, 2.3, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li><code>trail</code> set to true</li> <li>Camera moves to look near <code>playertargetentity</code> position + (1.0, 0.5, 0.0)</li> <li>Over the course of 6.0 frames, this enemy moves to <code>playertargetentity</code> position + (2.5, 0.0, -0.1) via a lerp</li> <li><code>trail</code> set to false</li> <li><code>Slash2</code> sound plays</li> <li>animstate set to 105</li> <li>Yield for a frame</li> <li><code>HugeHit</code> sound plays</li> <li>DoDamage 1 call happens</li> <li><code>enemybounce</code> set to a new coroutine being a new BounceEnemy call on <code>playerdata[playertargetID]</code> with routineid 0 for 1 bounce with 1.2 multiplier</li> <li>Yield for 0.25 seconds</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until <code>enemybounce[0]</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-6-party-wide-sword-jump-attack","title":"Move 6 - Party wide sword jump attack","text":"<p>A party wide sword jump attack that can inflict DefenseDown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 5 DefDownOnBlock <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li>The local startstate is set to 13 (<code>BattleIdle</code>)</li> <li><code>checkingdead</code> set to a new JumpPartyAttackCoroutine (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li><code>basestate</code> is set to the local startstate (this will prevent the usage of this move on the next actor turn)</li> <li><code>data[4]</code> is set to 1 (this does nothing, see the <code>data</code> section above for details)</li> </ul> <p>This is what the coroutine ends up doing:</p> <ul> <li>ShakeSprite called with intensity of (0.1, 0.0, 0.0) and 30.0 frametimer</li> <li><code>Grow1</code> sound plays with 0.8 pitch</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near <code>partymiddle</code></li> <li>animstate set to 107</li> <li><code>Jump</code> sound plays</li> <li><code>Launch</code> sound plays</li> <li>Over the course of 51.0 frames, this enemy moves from its position with a y component of 0.0 to (-4.0, 0.0, 0.0) via a BeizierCurve3 with a ymax of 8.0</li> <li>animstate set to 103</li> <li><code>Launch</code> sound plays</li> <li><code>Explosion5</code> sound plays</li> <li>ShakeScreen called with an ammount of 0.2 and 0.5 time</li> <li><code>impactsmoke</code> particles plays at this enemy position - 0.5 in x</li> <li>PartyDamage 1 call happens</li> <li>Yield for 0.75 seconds</li> <li><code>checkingdead</code> set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-7-heals-15-hp-and-clearstatus-on-themselves-and-delilah","title":"Move 7 - Heals 15 <code>hp</code> and ClearStatus on themselves and Delilah","text":"<p>Heals 15 <code>hp</code> and calls ClearStatus on themselves and Delilah. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#logic-sequence_6","title":"Logic sequence","text":"<ul> <li><code>data[0]</code> is incremented (amount of times this this move and the enemy party healing one was used)</li> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>KingDinner</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li>Heal called to heal this enemy by 15 <code>hp</code></li> <li>Heal called to heal Delilah by 15 <code>hp</code></li> <li>The <code>KingDinner</code> sprite gets destroyed</li> <li>ClearStatus called on this enemy</li> <li>ClearStatus called on <code>Delilah</code></li> <li>This enemy animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>Delilah</code>'s <code>data[1]</code> is set to 1 which activates the lock on <code>Delilah</code>'s usage of any moves from their support items move selection set (see their move selection documentation for details)</li> <li><code>data[2]</code> is set to 2 (the cooldown on the usage of this move and the enemy party healing one)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#move-8-revives-delilah","title":"Move 8 - Revives Delilah","text":"<p>Revives Delilah leaving them at 7 <code>hp</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Stratos/#logic-sequence_7","title":"Logic sequence","text":"<ul> <li><code>data[0]</code> is incremented (amount of times this this move and the enemy party healing one was used)</li> <li><code>data[1]</code> is incremented (amount of times this move was used)</li> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted using the <code>MagicDrops</code> item sprite positioned at this enemy position + their <code>itemoffset</code></li> <li>Yield for a second</li> <li>ReviveEnemy called with <code>reservedata</code> index 0 (<code>Delilah</code>) leaving them with 0.3% of <code>hp</code> with canmove</li> <li>Yield for a frame</li> <li>ShowDamageCounter called with type 1 (HP counter) with an ammount of 7 starting from <code>enemydata[1]</code>'s position (should be <code>Delilah</code>) + 1.0 in y and ending to Vector3.up</li> <li><code>enemydata[1]</code> (<code>Delilah</code>)'s <code>hp</code> is set to 7</li> <li><code>Heal</code> sound plays</li> <li><code>enemydata[1]</code> (<code>Delilah</code>) animstate set to 13 (<code>BattleIdle</code>)</li> <li>The <code>MagicDrops</code> sprite gets destroyed</li> <li>This enemy animstate set to the local startstate</li> <li>Yield for 0.5 seconds</li> <li><code>data[2]</code> is set to 2 (the cooldown on the usage of this move and the enemy party healing one)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/","title":"<code>Strider</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the dash attack move, the amount of frames this enemy takes to move changes to 41.0 frames from 49.0 frames</li> <li>In the water projectiles throw move, the amount of hits changes to be random from 2 to 3 inclusive instead of always being 2</li> <li>In the water projectiles throw move, the speed of each Projectile call changes to 25.0 from 32.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target dash attack</li> <li>A multiple targets water projectiles throw</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 1/2 2 1/2"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done before using a move if position is <code>Flying</code>:</p> <ul> <li><code>overrideanimfunc</code> set to true</li> <li>ExtraAnimPlay called with name <code>EndFly</code></li> <li><code>Rope1</code> sound plays with 0.8 pitch</li> <li>Over the course of 26.0 frames, <code>height</code> changes to 0.0 via a lerp</li> <li><code>overrideanimfunc</code> set to false </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#post-move-logic","title":"Post move logic","text":"<p>The following logic is always done after a move is used:</p> <ul> <li>If a 5/10 RNG check passes:<ul> <li>Yield for 0.5 seconds</li> <li><code>overrideanimfunc</code> set to true</li> <li><code>Rope1</code> sound plays</li> <li>ExtraAnimPlay called with name <code>StartFly</code></li> <li>Over the course of 26.0 frames, <code>height</code> changes from 0.0 to 1.8 via a lerp</li> <li>position set to <code>Flying</code></li> <li><code>overrideanimfunc</code> set to false </li> </ul> </li> <li>Otherwise (5/10 chance to fail the RNG check):<ul> <li>position set to <code>Ground</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#move-1-dash-attack","title":"Move 1 - Dash attack","text":"<p>A single target dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Over the course of 21.0 frames, this enemy moves to + 2.0 in x via a lerp</li> <li>ShakeSprite called with an intensity of 0.1 and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li><code>Toss15</code> sound plays</li> <li>Over the course of 49.0 frames (41.0 frames instead if hardmode is true), this enemy moves to (-15.0, 0.0, <code>playertargetentity</code> z position - 0.1) via a lerp. On the first game this enemy x position becomes lower than <code>playertargetentity</code> x position + 1.0:<ul> <li>DoDamage 1 call happens</li> <li>If <code>commandsuccess</code> is true (blocked, ignores FRAMEONE), the movement stops abruptly</li> </ul> </li> <li>If <code>commandsuccess</code> is true (blocked, ignores FRAMEONE):<ul> <li><code>Toss14</code> sound plays</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Over the course of 36.0 frames, this enemy moves to <code>playertargetentity</code> position + 2.0 in x via a BeizierCurve3 with a ymax of 3.0</li> <li>Yield for 0.25 seconds</li> <li>SetDefaultCamera called</li> <li>MoveTowards startp with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> set to false</li> </ul> </li> <li>Otherwise (didn't block, ignores FRAMEONE):<ul> <li>SetDefaultCamera called</li> <li>Over the course of 26.0 frames, this enemy moves from (15.0, 0.0, 0.0) to startp via a SmoothLerp</li> <li>animstate set to 0 (<code>Idle</code>)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#move-1-water-projectiles-throw","title":"Move 1 - Water projectiles throw","text":"<p>A multiple targets water projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times (random between 2 and 3 times instead if hardmode is true), but the call and further calls won't happen if there's not at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 2 null This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new sprite object named <code>temp</code> rooted using the <code>projectilepsrites[15]</code> sprite (an inverted honey projectile so it looks like a water projectile) positioned at this enemy + (-0.5, 1.4, -0.1) with a scale of (0.65, 0.4, 1.0) 32.0 (25.0 instead if hardmode is true) 0.0 null <code>WaterSplash</code> <code>WaterSplash</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Strider/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called (this call won't do anything here as it will get recalled later)</li> <li>Camera moves to look neat the midpoint between this enemy and <code>partymiddle</code></li> <li>The amount of hits is determined. It's always 2 (random between 2 and 3 instead if hardmode is true) and a SpriteRenderer array is initialised with this amount as the length to hold the projectiles</li> <li>For each hits to do:<ul> <li>If there's at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>animstate set to 100</li> <li><code>Charge19</code> sound plays with 1.1 pitch</li> <li>Yield for 0.5 seconds</li> <li><code>WaterOut</code> sound plays</li> <li>animstate set to 101</li> <li>The projectile element is set to a new sprite objected named <code>temp</code> rooted using the <code>projectilepsrites[15]</code> sprite (an inverted honey projectile so it looks like a water projectile) positioned at this enemy + (-0.5, 1.4, -0.1) with a scale of (0.65, 0.4, 1.0)</li> <li>Projectile 1 call happens</li> <li>Yield for 0.25 seconds</li> <li>If this is the last hit, animstate is set to 0 (<code>Idle</code>)</li> <li>Yield for a random interval between 0.35 and 0.65 seconds</li> </ul> </li> <li>Otherwise:<ul> <li>animstate set to 0 (<code>Idle</code>)</li> <li>No more hits are performed</li> </ul> </li> </ul> </li> <li>Yield all frames until all projectiles objects are null (all Projectile 1 calls completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/","title":"<code>TANGYBUG</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the Beetle action move logic, refer to their documentation to learn more on their hardmode changes</li> <li>In the Mushroom action move logic, refer to their documentation to learn more on their hardmode changes</li> <li>In the Cape action move logic, refer to their documentation to learn more on their hardmode changes</li> <li>The vine attack move may now hit twice instead of only once</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>Perform the exact action logic of a Beetle</li> <li>Perform the exact logic of a Mushroom</li> <li>Perform the exact logic of a Cape</li> <li>Multiple seeds throws targetting random player party members</li> <li>A single target vine attack that may hit multiple times</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 4/16 2 4/16 3 3/16 4 2/16 5 3/16"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#move-1-beetle-action","title":"Move 1 - Beetle action","text":"<p>Perform the exact action logic of a Beetle. Refer to the enemy action logic documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#move-2-mushroom-action","title":"Move 2 - Mushroom action","text":"<p>Perform the exact action logic of a Mushroom. Refer to the enemy action logic documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#move-3-cape-action","title":"Move 3 - Cape action","text":"<p>Perform the exact action logic of a Cape. Refer to the enemy action logic documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#move-4-seeds-throw","title":"Move 4 - Seeds throw","text":"<p>Multiple seeds throws targetting random player party members.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen for half the amount of seeds thrown ceiled, but each call can only happen if GetRandomAvaliablePlayer with nullable doesn't return -1. The amount of seeds thrown is random between 3 and 5 inclusive 2 Poison This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) A new GameObject rooted with a SpriteRenderer using the <code>HardSeed</code> item sprite  positioned at this enemy + 1.0 in y using the <code>spritemat</code> material on layer 0 (Default) 50.0 A random integer between 6 and 8 inclusive which is then cast to float null null <code>WoodHit</code> Empty string (0.0, 0.0, random integer between -20 and 20 which is then cast to float) false <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> set to a new SeedShake coroutine called in such a way that it effectively ends up doing the following:<ul> <li>A SpriteRenderer array is created to contain the seeds with the length being the amount to throw which is random between 3 and 5 inclusive</li> <li>For each seeds to throw:<ul> <li>The seed element of the array is initialised to a new GameObject rooted with a SpriteRenderer using the <code>HardSeed</code> item sprite  positioned at this enemy + 1.0 in y using the <code>spritemat</code> material on layer 0 (Default)</li> <li>GetRandomAvailablePlayer called with nullable. NOTE: This targetting scheme is broken, see the nullable GetRandomAvailablePlayer documentation for details</li> <li>If the seed index is even and the target player party member isn't -1, <code>Ping</code> sound plays followed by a Projectile 1 call. If it's odd, <code>PingUp</code> sound plays with 0.75 volume followed by the seed object moving via MainManager.ArcMovement to a random vector between (0.0, 0.0, -5.0) and (10.0, 0.0, 5.0) with destroyonend and using the same spin, height and frametime than the Projectile 1 call</li> <li>Yield for a random interval between 0.3 and 0.6 seconds</li> </ul> </li> <li>Yield all frames until all elements of the seeds array are null (all Projectile 1 calls completed)</li> <li><code>checkingdead</code> set to null</li> </ul> </li> <li>Yield all frames until <code>checkingdead</code> is null (SeedShake completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#move-5-vine-attack","title":"Move 5 - Vine attack","text":"<p>A single target vine attack that may hit multiple times.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0. Done once if hardmode is false, from 1 to 2 times if it is true as long as <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0 This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) 3 on the first hit, 2 on the second hit Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TANGYBUG/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> is set to a new VineAttack coroutine with 3 damageamt, actionid as the callerid with gettarget. The coroutine will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> goes to null</li> </ul> <p>This is what the coroutine effectively ends up doing:</p> <ul> <li>GetSingleTarget called</li> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>The amount of hits is determined. It is 1 if hardmode is false and if it's true, it's random between 1 and 2</li> <li>An array of <code>Prefabs/Objects/VenusRoot</code> are instantiated with the amount being the amount of hits to do at (<code>playertargetentity</code> x position + a random number between -2.0 and 2.0, -5.0, <code>playertargetentity</code> z position). Each instance is set to LookAt the <code>playertargetentity</code> and has its initial position incremented by (random between -1.0 and 1.0, 0.0, -0.15)</li> <li>An array of Vector3 are instantiated with the amount being the amount of hits to do with each being the normalised direction vector from <code>playertargetentity</code> to the matching <code>Prefabs/Objects/VenusRoot</code> element</li> <li>Yield for 0.75 seconds</li> <li>For each hit:<ul> <li><code>Charge8</code> sound plays</li> <li>Over the course of 10.0 frames, the matching <code>Prefabs/Objects/VenusRoot</code> position lerps to its position + the matching heading direction vector * 5.0. The first time reaching the 5th frame or later when <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0, DoDamage 1 call happens before the frame yield</li> <li>Yield for 0.5 seconds</li> <li>If this is the last hit:<ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>The amount of damage to deal on the next hit becomes half of this one's damage floored then clamped from 1 to 99</li> </ul> </li> <li>Over the course of 60.0 frames, all <code>Prefabs/Objects/VenusRoot</code> instances has ther scale lerped to Vector3.zero</li> <li>Yield a frame</li> <li>All <code>Prefabs/Objects/VenusRoot</code> instances gets destroyed</li> <li><code>checkingdead</code> set to null which informs the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Tablet/","title":"<code>Tablet</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Tablet/#assumptions","title":"Assumptions","text":"<p>It is assumed that a EverlastingKing is always present alongside this enemy as otherwise, this enemy will cause an exception to be thrown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Tablet/#fire-damage-infliction-logic-in-calculatebasedamage","title":"Fire damage infliction logic in CalculateBaseDamage","text":"<p>This enemy cannot be on fire meaning any <code>Fire</code> property damages will not inflict the Fire condition.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Tablet/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: An actor cooldown before using the shield move. When the move is used, the value is set to 2 (1 instead if hardmode is true). Every actor turn that this value is above 0, it is decremented, but at the expense of not using the shield move meaning it prevents it. The move only becomes usable again when the value is 0 or lower. Effectively, it's an antispam of 2 (1 if hardmode is true) completed actor turns before the shield move can be used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Tablet/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The value <code>data[0]</code> is set to when using the shield move changes to 1 from 2. It means that this enemy only needs to wait for 1 complete actor turn before using the move again instead of having to wait 2 complete actor turns</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Tablet/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>Places a shield on EverlastingKing which inflicts them the Shield condition</li> </ol> <p>Move 1 is always (and only) used if <code>data[0]</code> is 0 or below (the cooldown on the usage of the move expired).</p> <p>Otherwise, the action is limited to <code>data[0]</code> being decremented, but move 1 won't be used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Tablet/#move-1-shields-everlastingking","title":"Move 1 - Shields EverlastingKing","text":"<p>Places a shield on EverlastingKing which inflicts them the Shield condition. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Tablet/#logic-sequence","title":"Logic sequence","text":"<ul> <li>y <code>spin</code> set to 20.0</li> <li><code>EverLastingKingSummonArtifact</code> sound plays</li> <li><code>TabletSpawn</code> particles plays at this enemy position + 2.0 in y with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>The first occurence of EverlastingKing in <code>enemydata</code> is obtained (its presence is assumed)</li> <li>CreateShield called on <code>EverlastingKing</code></li> <li><code>Shield</code> sound plays</li> <li><code>EverlastingKing</code>'s <code>bubbleshield</code>'s <code>targetscale</code> set to (1.5, 3.0, 2.0)</li> <li><code>EverlastingKing</code>'s <code>overrideshieldpos</code>'s set to (0.0, 1.65, 0.0)</li> <li><code>EverlastingKing</code>'s <code>shieldenabled</code>'s set to true</li> <li>SetCondition called to inflict the Shield condition on <code>EverlastingKing</code> for 2 main turns</li> <li><code>data[0]</code> set to 2 (1 instead if hardmode is true)</li> <li>SlowSpinStop called on this enemy's <code>spin</code> with 30.0 frametime</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/","title":"<code>TermiteNasute</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#assumptions","title":"Assumptions","text":"<p>While not required, this action assumes that this enemy is not alone in the enemy party. Typically, they will be paired with a TermiteSoldier, but it isn't strictly required. It mostly makes the condition grant move more logical.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the projectiles throw move, the amount of hits changes to be always 2 instead of being random between 2 and 3</li> <li>In the projectiles throw move, the speed of each Projectile call changes to 31.0 from 37.5</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target projectiles throw that may hit multiple times</li> <li>A single target slash attack</li> <li>Grants 1 of 3 beneficial condition to themselves or the first enemy party member other than themselves</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 2/5 2 2/5 3 1/5 <p>However, move 3 may cause a reroll of the move selection by issuing a continue directive to the enemy action loop which restarts the entire action. The conditions in which this happens is complex and it depends who will receive the condition as well as which condition is selected to be inflicted.</p> <p>The receiver is determined by doing the following:</p> <ul> <li>If this enemy is the last <code>enemydata</code> remaining, the receiver is this enemy</li> <li>Otherwise, the reciever has 6/10 chance to be this enemy and 4/10 chance to be the first enemy party member who isn't this enemy</li> </ul> <p>Whoever the receiver is, the condition to inflict to them is determined randomly with the following odds:</p> Condition Odds GradualHP 2/4 AttackUp 1/4 DefenseUp 1/4 <p>After selecting both the receive and the condition, the receiver must not have the condition already for the move to be used. If they have it already, a continue directive is issued to the enemy action loop which rerolls the entire move selection process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before using a move:</p> <ul> <li><code>locktri</code> is set to false (this doesn't do anything for this enemy)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#move-1-projectiles-throw","title":"Move 1 - Projectiles throw","text":"<p>A single target projectiles throw that may hit multiple times.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 to 3 times (always 2 time if hardmode is true) 2 Poison This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) A new sprite object rooted using the <code>projectilepsrites[10]</code> sprite (a honey projectile) positioned at this enemy + (-1.85, 1.65, -0.1) with scale of 0.75x and a color of pure magenta 37.5 (31.0 instead if hardmode is true) 0.0 null <code>PoisonEffect</code> <code>PingDown</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between thsi enemy and <code>playertargetentity</code></li> <li>animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li><code>Slash</code> sound plays</li> <li>animstate set to 103</li> <li>Yield for 0.3 seconds</li> <li><code>Charge7</code> sound plays</li> <li>Yield for 0.45 seconds</li> <li>The amount of hits is determined which is random between 2 and 3 (always 2 if hardmode is true). A new SpriteRenderer array with this amount to hold the projectiles</li> <li>For each hit to do:<ul> <li><code>PingShot</code> sound plays</li> <li>animstate set to 105 (104 instead if this is the last hit)</li> <li>The projectile element is set to a new sprite object rooted using the <code>projectilepsrites[10]</code> sprite (a honey projectile) positioned at this enemy + (-1.85, 1.65, -0.1) with scale of 0.75x</li> <li>HitPart particles plays at the projectile element</li> <li>Projectile 1 call happens</li> <li>Yield for a frame</li> <li>The projectile element material color is set to pure magenta</li> <li>Yield for 0.75 seconds</li> <li>If this is the last hit, animstate is set to 13 (<code>BattleIdle</code>)</li> </ul> </li> <li>Yield all frames until all projectiles element is null (all Projectile 1 calls completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#move-2-slash-attack","title":"Move 2 - Slash attack","text":"<p>A single target slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.5, 0.0, -0.1) with a 2.0 multiplier, 1 (<code>Walk</code>) as walkstate and 100 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Spin9</code> sound plays</li> <li>Yield for a random interval between 0.45 and 0.65 seconds</li> <li>animstate set to 101</li> <li><code>Slash2</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#move-3-grants-a-benefical-condition-to-themselves-or-another-enemy-party-member","title":"Move 3 - Grants a benefical condition to themselves or another enemy party member","text":"<p>Grants 1 of 3 beneficial condition to themselves or the first enemy party member other than themselves.</p> <p>NOTE: If the GradualHP condition is selected, it will be inflicted on this enemy multiple times (once for each enemy party member that exists including this enemy) which is unexpected as it was presumably supposed to inflict the condition once on each enemy party member.</p> <p>See the move selection process to see how the receiver and the condition to inflict is determined.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteNasute/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>The receiver and the condition to inflict on them is determined as mentioned in the move selection section</li> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted at this enemy position + (-0.75, 3.0, -0.1). The sprite to use is an item sprite and which one is used depends on the condition to inflict:<ul> <li>GradualHP: <code>CookedJellyBean</code></li> <li>AttackUp: <code>VitalitySeed</code></li> <li>DefenseUp: <code>GenerousSeed</code></li> </ul> </li> <li>Yield for a second</li> <li>animstate set to the local startstate</li> <li>The item sprite is destroyed</li> <li>The logic of the condition to inflict happens:<ul> <li>GradualHP:<ul> <li><code>Heal2</code> sound plays</li> <li>For each <code>enemydata</code> elements SetCondition is called to inflict the condition for 2 main turns on this enemy (NOT each <code>enemydata</code>) followed by the <code>MagicUp</code> particles played at this enemy position (NOT each <code>enemydata</code> position). Effectively, if there are multiple enemy party members, this enemy will get the condition for an amount of main turn equal to 2 * the amount of enemy party members</li> </ul> </li> <li>AttackUp: StatusEffect is called to inflict the condition on the receiver for 2 main turns with effect</li> <li>DefenseUp: StatusEffect is called to inflict the condition on the receiver for 2 main turns with effect</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/","title":"<code>TermiteSoldier</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#assumptions","title":"Assumptions","text":"<p>While not required, this action assumes that this enemy is not alone in the enemy party. Typically, they will be paired with a TermiteNasute, but it isn't strictly required. It mostly makes the condition grant move more logical.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the projectiles throw move, the amount of hits changes to be always 1 instead of being random between 1 and 2</li> <li>In the projectiles throw move, the speed of each Projectile call changes to 27.0 from 33.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target projectiles throw that may hit multiple times</li> <li>A single target slash attack</li> <li>Grants 1 of 3 beneficial condition to themselves or the first enemy party member other than themselves</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 2/5 2 2/5 3 1/5 <p>However, move 3 may cause a reroll of the move selection by issuing a continue directive to the enemy action loop which restarts the entire action. The conditions in which this happens is complex and it depends on who will receive the condition as well as which condition is selected to be inflicted.</p> <p>The receiver is determined by doing the following:</p> <ul> <li>If this enemy is the last <code>enemydata</code> remaining, the receiver is this enemy</li> <li>Otherwise, the reciever has 6/10 chance to be this enemy and 4/10 chance to be the first enemy party member who isn't this enemy</li> </ul> <p>Whoever the receiver is, the condition to inflict to them is determined randomly with the following odds:</p> Condition Odds GradualHP 2/4 AttackUp 1/4 DefenseUp 1/4 <p>After selecting both the receiver and the condition, the receiver must not have the condition already for the move to be used. If they have it already, a continue directive is issued to the enemy action loop which rerolls the entire move selection process.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before using a move:</p> <ul> <li><code>locktri</code> is set to false (this doesn't do anything for this enemy)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#move-1-projectiles-throw","title":"Move 1 - Projectiles throw","text":"<p>A single target projectiles throw that may hit multiple times.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 1 to 2 times (always 1 time if hardmode is true) 3 Pierce<sup>1</sup> This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) A new sprite object rooted using the <code>projectilepsrites[12]</code> sprite (a pink pointy projectile) positioned at this enemy + (-1.65, 1.25, -0.1) with scale of 0.5x and a z angle of -90.0 33.0 (27.0 instead if hardmode is true) 0.0 null null null null Vector3.zero false <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between thsi enemy and <code>playertargetentity</code></li> <li>animstate set to 100</li> <li>Yield for 0.45 seconds</li> <li>The amount of hits is determined which is random between 1 and 2 (always 1 if hardmode is true). A new SpriteRenderer array with this amount to hold the projectiles</li> <li>For each hit to do:<ul> <li><code>Toss3</code> sound plays</li> <li>animstate set to 101</li> <li>The projectile element is set to a new sprite object rooted using the <code>projectilepsrites[12]</code> sprite (a pink pointy projectile) positioned at this enemy + (-1.65, 1.25, -0.1) with scale of 0.5x and a z angle of -90.0</li> <li>HitPart particles plays at the projectile element</li> <li>Projectile 1 call happens</li> <li>Yield for a frame</li> <li>Yield for 0.35 seconds</li> <li>If this is the last hit, animstate is set to 13 (<code>BattleIdle</code>)</li> <li>Otherwise:<ul> <li><code>Creak</code> sound plays with 1.3 volume</li> <li>animstate set to 100</li> <li>Yield for 0.4 seconds</li> </ul> </li> </ul> </li> <li>Yield all frames until all projectiles element is null (all Projectile 1 calls completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#move-2-slash-attack","title":"Move 2 - Slash attack","text":"<p>A single target slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.5, 0.0, -0.1) with a 2.0 multiplier, 1 (<code>Walk</code>) as walkstate and 102 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Creak3</code> sound plays</li> <li>Yield for a random interval between 0.45 and 0.65 seconds</li> <li>animstate set to 103</li> <li><code>Slash2</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#move-3-grants-a-benefical-condition-to-themselves-or-another-enemy-party-member","title":"Move 3 - Grants a benefical condition to themselves or another enemy party member","text":"<p>Grants 1 of 3 beneficial condition to themselves or the first enemy party member other than themselves.</p> <p>NOTE: If the GradualHP condition is selected, it will be inflicted on this enemy multiple times (once for each enemy party member that exists including this enemy) which is unexpected as it was presumably supposed to inflict the condition once on each enemy party member.</p> <p>See the move selection process to see how the receiver and the condition to inflict is determined.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/TermiteSoldier/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>The receiver and the condition to inflict on them is determined as mentioned in the move selection section</li> <li><code>ItemHold</code> sound plays</li> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>A new sprite object is created rooted at this enemy position + (-0.75, 3.0, -0.1). The sprite to use is an item sprite and which one is used depends on the condition to inflict:<ul> <li>GradualHP: <code>CookedJellyBean</code></li> <li>AttackUp: <code>VitalitySeed</code></li> <li>DefenseUp: <code>GenerousSeed</code></li> </ul> </li> <li>Yield for a second</li> <li>animstate set to the local startstate</li> <li>The item sprite is destroyed</li> <li>The logic of the condition to inflict happens:<ul> <li>GradualHP:<ul> <li><code>Heal2</code> sound plays</li> <li>For each <code>enemydata</code> elements SetCondition is called to inflict the condition for 2 main turns on this enemy (NOT each <code>enemydata</code>) followed by the <code>MagicUp</code> particles played at this enemy position (NOT each <code>enemydata</code> position). Effectively, if there are multiple enemy party members, this enemy will get the condition for an amount of main turn equal to 2 * the amount of enemy party members</li> </ul> </li> <li>AttackUp: StatusEffect is called to inflict the condition on the receiver for 2 main turns with effect</li> <li>DefenseUp: StatusEffect is called to inflict the condition on the receiver for 2 main turns with effect</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/","title":"<code>Thief</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the gust attack move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target aerial strike attack that may steal an item</li> <li>A party wide wind gust attack</li> <li>Flees the battle</li> </ol> <p>Move 3 is always (and only) used if this enemy has an <code>holditem</code>.</p> <p>As for the other moves, the decision of which moves to use is based on the following odds:</p> Move Odds 1 4/10 2 6/10"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#pre-move-logic","title":"Pre move logic","text":"<p>If the fleeing move wasn't used, the enemy will always change its position to <code>Flying</code> if it was <code>Ground</code> by doing the following:</p> <ul> <li>Over the course of 20.0 frames, <code>height</code> is lerped from 0 to <code>initialheight</code></li> <li><code>height</code> set to <code>initialheight</code></li> <li><code>bobrange</code> set to <code>startbf</code></li> <li><code>bobspeed</code> set to <code>startbs</code></li> <li>position set to <code>Flying</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#move-1-aerial-strike-attack-with-potential-item-steal","title":"Move 1 - Aerial strike attack with potential item steal","text":"<p>A single target aerial strike attack that may steal an item.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 102</li> <li>Yield for 0.1 seconds</li> <li><code>Gleam</code> particles played with <code>Gleam</code> sound at this enemy position + (0.25, 1.0 + <code>height</code>, -0.1) with an alivetime of 0.5</li> <li>Yield for 0.5 seconds</li> <li><code>BugWing</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code></li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 30.0 frames:<ul> <li><code>height</code> changes to 4.0 via a lerp</li> <li>position is changes to (-1.0, 0.0, 0.0)</li> </ul> </li> <li><code>sounds[9]</code> is stopped</li> <li><code>spin4</code> sound plays</li> <li>z <code>spin</code> set to 30.0</li> <li>ResetTrail called</li> <li><code>trail</code> set to false</li> <li>Yield for a frame</li> <li>Yield for 0.34 seconds</li> <li><code>spin</code> zeroed out</li> <li><code>Woosh2</code> sound plays</li> <li><code>sprite</code>'s angles reset to Vector3.zero</li> <li>Yield for a frame</li> <li><code>trail</code> set to true</li> <li>Over the course of 15.0 frames, position is lerped to <code>playertargetentity</code> position</li> <li><code>flip</code> set to true</li> <li>DoDamage 1 call happens</li> <li>If <code>playerdata[playertargetID]</code> doesn't have the Shield condition, StealItem is called</li> <li>If an item was stolen from the call above, the local startstate is set to 4 (<code>ItemGet</code>)</li> <li>Over the course of 20.0 frames, this enemy moves to startp + the <code>height</code> before this action in y via a BeizierCurve3 with a ymax of 7.0</li> <li>position set to startp</li> <li><code>height</code> set to the value before this action</li> <li><code>trail</code> set to false</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#move-2-wind-gust-attack","title":"Move 2 - Wind gust attack","text":"<p>A party wide wind gust attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any player party member whose <code>hp</code> is above 0.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 165.0 TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen for each player party member whose <code>hp</code> is above 0 This enemy The player party member 1 null null <code>barfill</code> &gt;= 1<sup>1</sup> <p>1: The super block timing is affected by the DoCommand timing caveat even if the regular block is true from suceeding DoCommand 1</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>BugWing</code> sound plays via PlayMoveSound on loop using <code>sounds[9]</code></li> <li>MoveTowards (-1.5, 0.0, -0.2)</li> <li><code>blockcooldown</code> set to 0.0 which resets the blocking state to be expired (doesn't matter since there is enough yields later to make up for this)</li> <li>Camera moves to look near <code>partypos[0]</code> which is the front player party member position</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>sounds[9]</code> stopped</li> <li>animstate set to 100</li> <li>CreateHelpBox called with 4 (the <code>TappingKey</code> command's help)</li> <li><code>Woosh</code> sound plays on loop using <code>sounds[8]</code> with 0.5 pitch and 0.7 volume</li> <li>A <code>Prefabs/Particles/ThiefSmoke</code> is instantiated and positioned at (-4.0, 0.0, 0.0) rooted</li> <li>DoCommand 1 call happens</li> <li>Yield all frames until <code>doingaction</code> goes to false and that 80.0 frames passed or more. Before each frame yield:<ul> <li>All player party member whose <code>hp</code> is above 0 has their animstate set to 11 (<code>Hurt</code>) (but if <code>blockcooldown</code> is above 0 meaning a block was done, it's set to 24 (<code>Block</code>) instead)</li> <li>All player party member whose <code>hp</code> is above 0 has their y <code>spin</code> set to 20.0 * the frame number since the start of these yields / 40.0 clamped from 0.0 to 1.0</li> <li><code>sounds[8]</code> pitch set to the frame number since the start of these yields / 80.0 clamped from 0.4 to 1.0</li> </ul> </li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li><code>Prefabs/Particles/ThiefSmoke</code> positioned offscreen at -9999..0 in y, destroyed in 1.0 second and set to null</li> <li><code>sounds[8]</code> stops with a 0.02 delay</li> <li>All player party member whose <code>hp</code> is above 0 has their <code>spin</code> getting zeroed out followed by DoDamage 1 call happen on them</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#move-3-flee","title":"Move 3 - Flee","text":"<p>Flees the battle, no damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Thief/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>tryenemyheal</code> set to a new EnemyFlee coroutine with walkstate 27 (<code>ItemWalk</code>) with afterimage on this enemy</li> <li>Yield all frames until <code>tryenemyheal</code> goes to null (the coroutine completed)</li> <li>The local fled is set to true indicating a different post action will be done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/","title":"<code>ToeBiter</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#battlecontrolgetexp-special-logic","title":"BattleControl.GetEXP special logic","text":"<p>This enemy is part of the set of the enemies that yields a different clamping on the rewarded amount of exp given their scaled <code>exp</code> field when they die (processed by CheckDead).</p> <p>If all of these conditions are fufilled, the rewarded amount of exp is clamped to 20 instead of 15 like most other enemies:</p> <ul> <li>flags 613 is false (RUIGEE is inactive)</li> <li><code>partylevel</code> is less than 27 (not yet at max rank)</li> <li>Flags 166 is false (not during an EX mode B.O.S.S session)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: This is a cooldown for the behavior the rock pickup move has where it may or may not issue a continue directive to the enemy action loop which would inevitably cause them to use the rock throw move on the same actor turn instead of waiting on the next actor turn. It only has an effect if hardmode is true as this behavior never happens if it is false regardless of this value. When hardmode is true, it is set to 3 on the first time the rock pickup move is used. Everytime the rock throw move is used, the value is decremented. For the rock to be thrown on the same actor turn than its pickup, the value needs to be 0 or lower. Effectively, it's an antispam on hardmode where this enemy will need to wait 2 other rock throws usage before being able to throw the next one on the same actor turn than its pickup</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the rock pickup move, it is now possible to use the rock throw move immediately on the same actor turn if <code>data[0]</code> is 0 or less (see the <code>data</code> section for details on how this cooldown works)</li> <li>In the rock throw move, the amount of frames the rock takes to reach its target changes to 36.0 frames from 43.5 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>Picks up a rock in their <code>helditem</code> for throwing it later. This may lead to the usage of move 3 immediately on the same actor turn</li> <li>A single target arms slam attack</li> <li>A single target rock throw from the one held in their <code>helditem</code></li> </ol> <p>Move 3 is always (and only) used when <code>helditem</code> isn't null.</p> <p>For the other moves, the decision of which move to use is based on the following odds:</p> Move Odds 1 1/2 2 1/2 <p>However, move 1 is special because after picking up the rock, it is possible to issue a continue directive to the enemy action loop which restarts the entire action on the same actor turn. Since <code>helditem</code> won't be null on the second iteration, it will inevitably lead to the usage of move 3 still on the same actor turn than picking up the rock. In order for this to happen, the following conditions must be fufilled by the end of move 1:</p> <ul> <li>hardmode is true</li> <li><code>data[0]</code> is 0 or less (see the <code>data</code> section for more details on how this cooldown works)</li> </ul> <p>If the above conditions aren't fufilled by the end of move 1, the action ends as usual.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#move-1-rock-pickup","title":"Move 1 - Rock pickup","text":"<p>Picks up a rock in their <code>helditem</code> for throwing it later. This may lead to the usage of the rock throw move immediately on the same actor turn. No damages are dealt by this move, but if the rock throw move is used immediately after, that move will deal damages.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#logic-sequence","title":"Logic sequence","text":"<ul> <li>A new <code>Prefabs/Objects/CrackedRock</code> GameObject is created without its MeshCollider and Fader positioned offscreen at (0.0, -999.0, 0.0) with a scale of 0.65x</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>RockPluck</code> sound plays</li> <li>ShakeScreen called with 0.25 ammount and 0.2 time</li> <li><code>DirtExplode2</code> particles plays at this enemy position + (-2.0, 0.0, -0.1)</li> <li>animstate set to 101</li> <li>Over the course of 11.0 frames, <code>Prefabs/Objects/CrackedRock</code> moves from this enemy position + (-2.0, -3.0, -0.1) to this enemy position + its <code>itemoffset</code> via a lerp</li> <li>CreateHeldItem is called with -2 as the itemid which sets <code>holditem</code> to -2 and initialises this enemy's <code>helditem</code> to be a new SpriteRenderer with no sprite set childed to this enemy's <code>sprite</code> using the <code>spritemat</code> material on layer 14 (<code>Sprite</code>) with a FaceCamera component</li> <li><code>Prefabs/Objects/CrackedRock</code> gets childed to this enemy's <code>helditem</code></li> <li>animstate and the local startstate set to 4 (<code>ItemGet</code>)</li> <li>If hardmode is true and <code>data[0]</code> is 0 or less (the cooldown expired, see the <code>data</code> section for more details), a continue directive is issued to the enemy action loop which restarts the entire action on the same actor turn. This will lead to the immediate usage of the rock throw move because <code>helditem</code> got initialised</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#move-2-arms-slam","title":"Move 2 - Arms slam","text":"<p>A single target arms slam attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.25, 0.0, -0.1) with 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 102 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Creak</code> sound plays with 1.2 pitch</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>ShakeScreen called with 0.15 ammount and 0.5 time with dontreset</li> <li><code>Toss16</code> sound plays</li> <li>animstate set to 28 (<code>TossItem</code>)</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#move-3-rock-throw","title":"Move 3 - Rock throw","text":"<p>A single target rock throw from the one held in their <code>helditem</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 5 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ToeBiter/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li><code>Charge19</code> sound plays</li> <li>ShakeSprite called with 0.2 intensity and 45.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 28 (<code>TossItem</code>)</li> <li><code>Toss12</code> sound plays</li> <li>Over the course of 43.5 frames (36.0 frames instead if hardmode is true), this enemy's <code>helditem</code> moves to <code>playertargetentity</code> position + (0.0, 2.0. -0.1)</li> <li>ShakeScreen called with 0.2 ammount and 0.65 time with dontreset</li> <li>DoDamage 1 call happens</li> <li><code>RockBreak</code> sound plays</li> <li>A <code>Prefabs/Objects/CrackRockBreak</code> is instantiated childed to this enemy's <code>helditem</code> with same position and scale as the <code>Prefabs/Objects/CrackedRock</code> (this gets destroyed in 60.0 seconds via the CrackRockBreak component attached to it) </li> <li>This enemy's <code>helditem</code> is destroyed (eventually will be set to null which prevents to use this move on the next actor turn at first)</li> <li><code>holditem</code> set to -1</li> <li>animstate and the local startstate set to 0 (<code>Idle</code>)</li> <li><code>data[0]</code> is decremented</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/","title":"<code>UltimaxTank</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#assumptions","title":"Assumptions","text":"<p>It is assumed this enemy's eventondeath is set to its matching EventDialogue.</p> <p>It is also assumed this enemy is loaded with the <code>UltimaxTank</code> animid as the presence of <code>extra</code> elements are assumed which are normally initialised by AnimSpecificQuirk for this animid.</p> <p>It is also assumed this enemy is initially fought alone so their summoning move logic works in expected ways.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the canonballs throw move, the amount of hits to do changes to 3 from 2</li> <li>In the canonballs throw move, the amount of frames each canonball takes to reach its target changes to 21.0 frames from 29.0 frames</li> <li>In the canonballs throw move, the damageammount of each DoDamage calls changes to 3 from 4</li> <li>In the canonballs throw move, each canonballs now inflicts the AttackDown condition to the target if <code>commandsuccess</code> is false after the DoDamage call (didn't blocked, ignores FRAMEONE) and the target doesn't have the Shield condition</li> <li>In the bomb throw move, the amount of frames the bomb moves to reach its target changes to 37.0 frames from 44.5 frames</li> <li>In the spinning dash attack move, the amount of frames this enemy moves changes to 71.0 frames from 91.0 frames</li> <li>In the thrusting dash attack move, the amount of frames this enemy moves changes to 36.0 frames from 46.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#move-selection","title":"Move selection","text":"<p>6 moves are possible:</p> <ol> <li>A multiple targets canonballs throws</li> <li>A party wide bomb throw of a random type</li> <li>A party wide spining dash attack</li> <li>Prepares themselves for a big attack with 2 <code>charge</code> and DefenseUp condition</li> <li>Summons a new WaspTrooper or WaspHealer</li> <li>A party wide thrusting dash attack</li> </ol> <p>Move 6 is always (and only) used if <code>basestate</code> is 104 (meaning move 4 was used before since it sets it to that value).</p> <p>Move 1 and 2 are treated as the same during the move selection process. If it's selected, what determines the move used between the 2 is <code>locktri</code> (this is only true after the phase transition in the pre move logic happened). If it's false, move 1 is used and if it's true, move 2 is used. They will be refered to as \"move 1-2\" in the move selection process below.</p> <p>As for the decision of which move to use among move 1-2 through 5, it is based on odds. However, some moves have additional requirements that must be fufilled for the move to be used if selected. If the move is selected, but their requirements aren't fufilled, either another move will be used or a continue directive will be issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection. The following table contains all these informations for every moves:</p> Move Odds Requirements Falback if requirements aren't fufilled 1-2 3/10 None, the move is always used N/A 3 2/10 HPPercent is 0.8 or below Move 1-2 is used 4 2/10 HPPercent is 0.65 or below Move 1-2 is used 5 3/10 This enemy is the last remaining <code>enemydata</code> and <code>turns</code> is above 0 (past the first main turn of the battle) Continue directive issued to the enemy action loop which restarts the entire action and rerolls the move selection process"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before a move is used if <code>locktri</code> is false (this logic hasn't happened before) and HPPercent is below 0.5. If those requirements are met, a phase transition happens:</p> <ul> <li>animstate set to 11 (<code>Hurt</code>)</li> <li>MainManager.GradualScale called on <code>model</code>'s 0-0-1-2 child (the canon's pipe) to change their scale to (0.85, 1.3, 1.0) with 60.0 frametime without destroy (done in paralele)</li> <li><code>UltimaxPartExplodeShake</code> sound plays</li> <li>Done 3 times:<ul> <li>DeathSmoke particles plays at this enemy + (1.0 + a random number between -2.0 and 2.0, 2.0, -1.5)</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li><code>UltimaxPartExplode</code> sound plays</li> <li><code>explosionsmall</code> particles plays at this enemy position (-2.25, 3.0, 0.0)</li> <li><code>model</code>'s 1-3 child's ParticleSystem (some some particles flowing up) plays</li> <li><code>model</code>'s 0-0-1-2 child (the canon's normal pipe) is disabled</li> <li><code>model</code>'s 0-0-1-4 child (the canon's broken pipe) is enabled</li> <li><code>locktri</code> set to true (this prevents this logic from happening again for this battle)</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#post-move-logic","title":"Post move logic","text":"<p>The following logic happens after a move is used only if all of the following conditions are met:</p> <ul> <li><code>turns</code> % 2 is 0 (every 2 main turns starting from the first one)</li> <li><code>basestate</code> isn't 0 (the charging move wasn't used)</li> <li>GetRandomAvaliablePlayer with nullable doesn't return -1. NOTE: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details. Also, this is separate from the AddDelayedProjectile 1 calls mentioned requirement below. The actual return isn't used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#adddelayedprojectile-calls","title":"AddDelayedProjectile calls","text":"# Conditions obj targetpos damage turnstohit areadamage property framespeed summonedby hitsound hitparticle whilesound 1 Happens up to 2 times, but each calls requires that a GetRandomAvaliablePlayer call with nullable doesn't return -1<sup>1</sup> A new <code>Prefabs/Objects/BeeRocket</code> GameObject rooted whose SpriteRenderer's sprite uses the <code>projectilepsrites[17]</code> sprite (a brown missile projectile) positioned at (0.0, 20.0, 0.0) and with a z angle of 75.0 A random <code>playerdata</code> with uniform probability among the elements (NOTE: all GetRandomAvaliablePlayer calls with nullable do NOT have their returns used to determine the target, only to check that the call may happen) 4 2 0 null 60.0 This enemy <code>Explosion3</code> <code>explosion</code> <code>MisseleFall</code> <p>1: This is separate from the post move logic requirement. NOTE: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details. The actual return value isn't used, the target is determined separately from this call, but it actually makes it more broken because it not only disregard the player party formation, but it also disregard <code>forceattack</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#logic-sequence","title":"Logic sequence","text":"<ul> <li>SetDefaultCamera called</li> <li>MoveTowards startp with 2.0 multipluer</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Camera moves to look near (3.0. 1.0, 0.0)</li> <li>Yield for 0.25 seconds</li> <li>For each hits (2 times):<ul> <li>GetRandomAvaliablePlayer with nullable call and if it returns -1, the hit is skipped</li> <li>animstate set to 101</li> <li>A new <code>Prefabs/Objects/BeeRocket</code> GameObject rooted whose SpriteRenderer's sprite uses the <code>projectilepsrites[17]</code> sprite (a brown missile projectile) positioned at the second to last <code>extra</code> (the missile launcher of the <code>model</code>) position and with a z angle of -60.0</li> <li>DeathSmoke plays at the <code>Prefabs/Objects/BeeRocket</code> position</li> <li>HitPart particles plays at the <code>Prefabs/Objects/BeeRocket</code> position</li> <li><code>b33BotRocketLaunchInAir</code> sound plays</li> <li>Over the course of 41.0 frames, the <code>Prefabs/Objects/BeeRocket</code> moves to (this enemy x position - 1.0, 10.0, 0.0) via a SmoothLerp. On the second half, before each yield, this enemy animstate is set to 0 (<code>Idle</code>)</li> <li><code>Prefabs/Objects/BeeRocket</code> position set to (0.0, 20.0, 0.0)</li> <li><code>Prefabs/Objects/BeeRocket</code> z angle set to 75.0</li> <li>AddDelayedProjectile 1 call happens</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#move-1-canonballs-throws","title":"Move 1 - Canonballs throws","text":"<p>A multiple targets canonballs throws.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 2 times (3 times instead if hardmode is true), but each calls requires that there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) 4 (3 if hardmode is true) null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>Camera moves to look near (1.75, 0.0, 0.0)</li> <li><code>UltimaxMove</code> sound plays</li> <li>MoveTowards + 2.5 in x using 1 (<code>Walk</code>) as walkstate and 100 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Done for each hit which is 2 times (3 times instead if hardmode is true):<ul> <li>If there's no alive player party members (<code>hp</code> above 0 and not eatenby), the hit is skipped</li> <li>GetSingleTarget called</li> <li>animstate set to 100</li> <li>MainManager.GradualScale called on the <code>model</code>'s 0-0-1-2 child (the canon's pipe) to change its scale to (0.7, 1.0, 1.25) with 20.0 frametime without destroy (done in paralel)</li> <li><code>UltimaxCannonBallSuckIn</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>model</code>'s 0-0-1-2 child (the canon's pipe)'s scale set to (1.25, 1.0, 0.7)</li> <li>MainManager.GradualScale called on the <code>model</code>'s 0-0-1-2 child (the canon's pipe) to change its scale to 1.0x with 10.0 frametime without destroy (done in paralel)</li> <li>A new <code>Prefabs/Objects/RollingRock</code> GameObject is created rooted positioned at <code>model</code>'s 0-0-1-2 child (the canon's pipe) position + (-5.4, -0.3, 0.0) with a scale of 0.5x</li> <li>ShakeScreen called with an ammount of 0.1 and 0.3 time with dontreset</li> <li>animstate set to 101</li> <li><code>Prefabs/Objects/RollingRock</code>'s first material's color is set to 404040 (mostly dark gray)</li> <li>This enemy x position increases by 0.85</li> <li>MainManager.MoveTowards called on this enemy to move them to - 0.85 in x with 20.0 frametime without smooth and without local (done in paralel)</li> <li><code>UltimaxCannonBallShot</code> sound plays</li> <li><code>explosionsmall</code> particles plays at the <code>Prefabs/Objects/RollingRock</code> position</li> <li>Over the course of 29.0 frames (21.0 frames instead if hardmode is true), <code>Prefabs/Objects/RollingRock</code> moves to <code>playertargetentity</code> position + 1.0 in y. Before each frame yield, z angle is increased by 20.0 * MainManager.<code>framestep</code></li> <li>ShakeScreen called with an ammount of 0.1 and 0.6 time with dontreset</li> <li>DoDamage 1 call happens</li> <li>If hardmode is true, <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE) and <code>playerdata[playertargetID]</code> doesn't have the Shield condition:<ul> <li>StatusEffect called to inflict the AttackDown condition on <code>playerdata[playertargetID]</code> for 2 main turns (effectively 1 since the current main turn ends soon enough) with effect</li> </ul> </li> <li>MainManager.ArcMovement called on <code>Prefabs/Objects/RollingRock</code> to - 10.0 in x with the y component at 0.0 with a spin of -20.0 in z, 5.0 height and 40.0 frametime with destroyonend</li> <li>Yield for 0.5 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#move-2-bomb-throw","title":"Move 2 - Bomb throw","text":"<p>A party wide bomb throw of a random type.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#partydamage-calls","title":"PartyDamage calls","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 2 (4 instead if the bomb thrown is a <code>SpicyBomb</code>) Depends on the bomb thrown:<ul><li><code>SpicyBomb</code> or <code>BurlyBomb</code><sup>1</sup>: null</li><li><code>NumbBomb</code>: Numb</li><li><code>FrostBomb</code>: Freeze</li><li><code>SleepBomb</code>: Sleep</li><li><code>PoisonBomb</code>: Poison</li></ul> <code>commandsuccess</code> 0.0 Vector3.zero false null <p>1: This is unexpected because of an issue where no effects are applied to this bomb type. It was expected to inflict DefenseDown, but that doesn't happen even after this call</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>TwistDoorEnter</code> sound plays</li> <li>animstate set to 103</li> <li>ShakeSprite called with 0.1 intensity and 3.0 frametimer</li> <li>Yield for a frame</li> </ul> <p>The bomb type is then determined with random odds:</p> <ul> <li><code>SpicyBomb</code>: 1/5</li> <li><code>PoisonBomb</code>: 1/5</li> <li><code>SleepBomb</code>: 1/5</li> <li><code>FrostBomb</code>: 1/5</li> <li><code>NumbBomb</code>: 1/5</li> </ul> <p>However, if it's a <code>SleepBomb</code>, <code>FrostBomb</code> or <code>NumbBomb</code> and any of the player party members have the Freeze, Numb or Sleep conditions, the result is rerolled to be one of the following with equal chances each:</p> <ul> <li><code>SpicyBomb</code></li> <li><code>PoisonBomb</code></li> <li><code>BurlyBomb</code></li> </ul> <p>After determining the bomb type, this is what the logic does:</p> <ul> <li>A new sprite object is created rooted with the matching item sprite</li> <li>Over the course of 31.0 frames, the item sprite moves from the <code>model</code>'s 0-0-1-1 child position (the SpriteRenderer near the lid) + (-0.4, 1.92, -0.1) to + (0.95, 1.73, 0.0) via a lerp, but calculated over 4 frames (further frames won't have any changes, but still have yields)</li> <li><code>Toss4</code> sound plays</li> <li><code>Toss3</code> sound plays</li> <li>Over the course of 44.5 frames (37.0 frames instead if hardmode is true), the item sprite position moves to <code>partymiddle</code> via a BeizierCurve3 with a ymax of 6.0. Before each yield, the item sprite's z angle increases by 10.0 * MainManager.<code>framestep</code></li> <li>The item sprite is destroyed</li> <li><code>Explosion</code> sound plays</li> <li>Different effects happens depending on the bomb type (except for <code>BurlyBomb</code> where no effects happen):<ul> <li><code>SpicyBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.2 and 0.75 time with dontreset</li> <li><code>explosion</code> particles plays at <code>partmymiddle</code></li> </ul> </li> <li><code>PoisonBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li><code>PoisonEffect</code> particles plays at <code>partmymiddle</code> with 2.0x scale</li> </ul> </li> <li><code>SleepBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li>DeathSmoke particles plays at <code>partmymiddle</code> with 3.0x size</li> </ul> </li> <li><code>FrostBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li><code>mothicenormal</code> particles plays at <code>partmymiddle</code> with 3.0x scale</li> </ul> </li> <li><code>NumbBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li><code>ElecFast</code> particles plays at <code>partmymiddle</code> with 2.0x scale</li> <li><code>impactsmoke</code> particles plays at <code>partmymiddle</code></li> </ul> </li> </ul> </li> <li>PartyDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#move-3-spinning-dash-attack","title":"Move 3 - Spinning dash attack","text":"<p>A party wide spining dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 null <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>UltimaxMove</code> sound plays</li> <li>MoveTowards this enemy + 5.0 in x with a 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 100 as stopstate</li> <li>Camera moves to look near (3.75, 0.0, 0.0)</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> set to false</li> <li><code>UltimaxSpinAttackSqueeze</code> sound plays</li> <li>Over the course of 31.0 frames, <code>startscale</code> changes to (0.8, 1.25, 1.0) via a lerp</li> <li>SetDefaultCamera called</li> <li><code>UltimaxSpinAttack</code> sound plays</li> <li><code>model</code>'s 1-1 child's ParticleSystem (smoke particles going outwards) plays</li> <li>Over the course of 91.0 frames (71.0 frames instead if hardmode is true):<ul> <li>This enemy moves to (-20.0, 0.0, 0.0) via a lerp</li> <li><code>startscale</code> changes to the value before this action via a lerp, but the factor is multiplied by 3 (meaning it will reach 1.0 after a third of the way)</li> <li>y <code>spin</code> set to 15.0 * (current frame / total frames * 5.0) clamped from 5.0 to 15.0 (meaning from 75.0 to 225.0 reaching the max after a 1/5 of the way)</li> <li>On the first frame this enemy x position becomes lower than -4.5:<ul> <li>ShakeScreen called with 0.1 ammount and 0.5 time with dontreset</li> <li>PartyDamage 1 call happens</li> </ul> </li> </ul> </li> <li><code>spin</code> zeroed out</li> <li>FlipAngle called with setangle</li> <li>position set to (20.0, 0.0, 0.0)</li> <li>SetDefaultCamera called</li> <li><code>UltimaxMove</code> sound plays</li> <li>MoveTowards startp with 4.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#move-4-prepares-big-attack-with-2-charge-and-defenseup-condition","title":"Move 4 - Prepares big attack with 2 <code>charge</code> and DefenseUp condition","text":"<p>Prepares themselves for a big attack with 2 <code>charge</code> and DefenseUp condition. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li><code>UltimaxChargeAttackSqueeze</code> sound plays</li> <li>Camera moves to look near this enemy</li> <li><code>basestate</code>, animstate and the local startstate are all set to 104 which allows this enemy to use the thrusting dash attack move on the next actor turn</li> <li>ShakeSprite called with 0.2 intensity and 45.0 frametimer</li> <li>SahkeScreen called with an ammount of 0.05 and 0.75 time with dontreset</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>StatusEffect called to inflict the DefenseUp condition on this enemy for 2 main turns (effectively 1 since the current main turn ends soon) with effect</li> <li>Yield for 0.25 seconds</li> <li>StatEffect called on this enemy with type 4 (green up arrow)</li> <li>Yield for 0.5 seconds</li> <li><code>charge</code> set to 2</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#move-5-summons-a-wasptrooper-or-wasphealer","title":"Move 5 - Summons a WaspTrooper or WaspHealer","text":"<p>Summons a new WaspTrooper or WaspHealer. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li><code>TwistDoorEnter</code> sound plays</li> <li>animstate set to 102</li> <li>Camera moves to look near this enemy</li> <li>Yield for 0.5 seconds</li> <li><code>Whistle</code> sound plays</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon either a WaspTrooper or WaspHealer enemy (determined randomly with uniform odds) with type <code>Offscreen</code> at (0.95, 0.0, -1.25)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li><code>enemydata[lastaddedid]</code> gets some adjustements:<ul> <li><code>hp</code> and <code>maxhp</code>: value gets multiplied by 0.5 then floored</li> <li><code>exp</code>: divided by 10 floored</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#move-6-thrusting-dash-attack","title":"Move 6 - Thrusting dash attack","text":"<p>A party wide thrusting dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#partydamage_1","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 Pierce<sup>1</sup> <code>commandsuccess</code> 0.0 Vector3.zero false null <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/UltimaxTank/#logic-sequence_6","title":"Logic sequence","text":"<ul> <li>Camera moves to look near (3.75, 0.0, 0.0)</li> <li>ShakeSprite called with 0.1 intensity and 57.0 frametimer</li> <li><code>UltimaxChargeAttackSqueeze</code> sound plays</li> <li>Over the course of 31.0 frames, this enemy moves to + 4.0 in x via a lerp and <code>startscale</code> changes to (0.8, 1.25, 1.0) via a lerp</li> <li><code>model</code>'s 1-2 child's ParticleSystem (blue thrust particles) plays</li> <li>Yield for 0.5 seconds</li> <li>SetDefaultCamera called</li> <li><code>UltimaxChargeAttack</code> sound plays</li> <li>Over the course of 46.0 frames (36.0 frames instead if hardmode is true):<ul> <li>This enemy moves to (-20.0, 0.0, 0.0) via a lerp</li> <li><code>startscale</code> changes to the value before this action via a lerp, but the factor is multiplied by 3 (meaning it will reach 1.0 after a third of the way)</li> <li>On the first frame this enemy x position becomes lower than -4.5:<ul> <li>PartyDamage 1 call happens</li> </ul> </li> </ul> </li> <li><code>model</code>'s 1-2 child's ParticleSystem (blue thrust particles) stops playing</li> <li>Yield for 0.25 seconds</li> <li>position set to startp + 15.0 in y</li> <li><code>UltimaxChargeAttackFallBack</code> sound plays</li> <li>Over the course of 21.0 frames, this enemy moves to startp via a lerp</li> <li><code>startscale</code> set to (1.25, 0.8, 1.25)</li> <li>ShakeScreen called with 0.2 ammount and 1.0 time with dontreset</li> <li><code>impactsmoke</code> particles plays at this enemy position</li> <li>Over the course of 31.0 frames, <code>startscale</code> changes to the value it had before this action via a lerp</li> <li><code>basestate</code>, animstate and the local startstate all set to 0 (<code>Idle</code>) to prevent this enemy from using this move again on the next actor turn</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/","title":"<code>Underling</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy gets loaded with a isdefending of -1 so their <code>hitaction</code> logic works.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#enemycheck-special-logic","title":"EnemyCheck special logic","text":"<p>Before this enemy is loaded, it's possible that StartBattle overrides it to a <code>GoldenSeedling</code>. See the documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#logic-sequence","title":"Logic sequence","text":"<ul> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Emoticon called with the <code>Exclamation</code> emote with a time of 35</li> <li><code>Wam</code> sound plays</li> <li><code>checkingdead</code> set to a new Dig call on this enemy which changes its position to <code>Underground</code> (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target tackle attack</li> <li>A single target headbonk attack</li> <li>A single target undergound strike attack</li> </ol> <p>Move 3 is always used (and can only be used) when position is <code>Underground</code>.</p> <p>As for other moves, the decision of which move to use is based on the following odds:</p> Move Odds 1 51% 2 49%"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#move-1-tackle-attack","title":"Move 1 - Tackle attack","text":"<p>A single target tackle attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to new coroutine called SeedlingTackle which will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the coroutine effectively does:</p> <ul> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Done 2 times:<ul> <li>Jump called</li> <li><code>Jump</code> sound plays with 0.75 pitch and 1.6 volume</li> <li>Yield for 0.1 seconds</li> <li>Yield all frames until <code>onground</code> goes to true</li> <li>Yield a frame</li> </ul> </li> <li>CameraFocusTarget called</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 3.0 in x with a 2.0 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Yield for 0.2 seconds</li> <li><code>Spin10</code> sound plays</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + (0.35, 0.0, -0.1) with a 2.5 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>DoDamage 1 call happens</li> <li>Jump called</li> <li><code>flip</code> set to false (with <code>overrideflip</code>)</li> <li>MoveTowards <code>playerdata[playertargetID]</code> position + 2.0 in x with a 0.75 multiplier and both the current animstate as the walkstate and stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> is set to false</li> <li><code>checkingdead</code> set to null indicating the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#move-2-headbonk-attack","title":"Move 2 - Headbonk attack","text":"<p>A single target headbonk attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> set to a new SeedlingHeadbonk coroutine with 2 damage, actionid as the attacker id, no property and without skipwalk. This coroutine sets <code>checkingdead</code> to null when completed</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>Here is what SeedlingHeadbonk effectively does with those parameters:</p> <ul> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.2) with a multiplier of 2.0</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Jump</code> sound plays</li> <li>Jump called</li> <li>Yield for 0.3 seconds</li> <li>Yield all frames until <code>onground</code> is true</li> <li>Camera moves to look near <code>playertargetID</code></li> <li>Yield a frame</li> <li>animstate set to 100</li> <li><code>Turn</code> sound plays</li> <li>Over the course of 35.0 frames (but visually occurs as if it was 32.0 frames with the last 3 being padding), this enemy moves to <code>playertargetentity</code> position + (0.25, 2.8, -0.1) via a BeizierCurve3 with a ymax of 5.5 while the z angle gets a LerpAngle done to 180.0</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.1 seconds</li> <li><code>sprite</code> angles zeroed out</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li><code>Turn2</code> sound plays</li> <li>Over the course of 25.0 frames, this enemy moves to its current position + 2.0 in x with the y being 0.0 via a BeizierCurve3 with a ymax of 3.0</li> <li><code>checkingdead</code> is set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#move-3-undergound-strike-attack","title":"Move 3 - Undergound strike attack","text":"<p>A single target undergound strike attack. position is set to <code>Ground</code> after.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#about-incorrect-poison-property-logic","title":"About incorrect Poison property logic","text":"<p>While the DoDamage call features a <code>Pierce</code> property, the move ends up doing an incorrect version of the <code>Poison</code> property logic due to the single property shortcoming. Here are the differences:</p> <ul> <li>On FRAMEONE, regular blocking will incorrectly prevent the condition from being inflicted which doesn't happen normally</li> <li>The amount of turns to inflict is 3 instead of 2</li> <li>The Sturdy condition on the target won't prevent the condition to be inflicted when it normally would have</li> <li>The <code>StatusMirror</code> medal does nothing when equipped on the target when it should have inflicted the condition back to this enemy</li> <li>The <code>PoisonTouch</code> medal won't work despite the attack being physical</li> <li>The condition infliction can still happen if the target has the Numb while having the <code>ShockTrooper</code> medal equipped</li> <li>The <code>Poison</code> sound is not played when it should have been</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Underling/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>checkingdead</code> is set to a new UndergroundStrike coroutine with 2 damage from this enemy with a poison property without staying underground</li> <li>Yield all frames until <code>checkingdead</code> goes to null (the coroutine is done)</li> </ul> <p>This is effectively what the coroutine does:</p> <ul> <li>Camera moves to look near <code>playerdata[playertargetID]</code>, but zoomed in</li> <li><code>Digging</code> sound plays on loop using <code>sounds[9]</code> with 1.1 pitch and 0.75 volume</li> <li>Over the course of 100.0 frames, position moves to <code>playertargetentity</code>'s position + -0.25 in z</li> <li>Yield for 0.25 seconds</li> <li><code>sounds[9]</code> stopped</li> <li><code>DigPop</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>If all of the following conditions are fufilled, SetCondition is called to inflict the Poison condition to <code>playerdata[playertargetID]</code> for 3 main turns (NOTE: this has a lot of caveats, see the section above for details):<ul> <li><code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE)</li> <li><code>playerdata[playertargetID]</code>'s <code>poisonres</code> is less than 100 (it's not immune)</li> <li>A <code>poisonres</code> resistance check passes</li> <li><code>playerdata[playertargetID]</code> doesn't have the Shield condition</li> </ul> </li> <li>y <code>spin</code> set to 20.0</li> <li><code>digging</code> set to false</li> <li>scale reset to <code>startscale</code></li> <li>animstate set to 100</li> <li><code>DirtExplodeLight</code> particle plays at this enemy position</li> <li>ShakeScreen with 0.15 ammount and 0.2 time</li> <li>Over the course of 50.0 frames, position moves to <code>playertargetentity</code> + 2.0 in x using a BeizierCurve3 with a ymax of 6.0</li> <li><code>spin</code> zeroed out</li> <li>position set to <code>Ground</code></li> <li>Yield for 0.25 seconds</li> <li><code>checkingdead</code> set to null to signal DoAction that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/","title":"<code>VenusBoss</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy's animid (not enemy id) is <code>VenusGuardian</code>. This is because this animid has special logic in UpdateAnimSpecific that involves <code>data[0]</code> which can influence animation logic. It also is what contains the logic of a rather complex entity structure with <code>extras</code> and <code>extraanims</code> involving animations which are bound to this animid and that the action logic assumes is present. There's also logic bound to this animid in AnimSpecificQuirks. This enemy won't function correctly if another animid is assigned to it in endata.</p> <p>Additionally, it is assumed this enemy has actimmobile enabled. This is necessary because if hardmode is true, it is possible for this enemy to cure some stopping conditions and act instead of skipping their actor turn.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 3 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: A value that UpdateAnimSpecific and AnimSpecificQuirks uses to apply some custom animations logic. Here are the different values:<ul> <li>0: Set when using the arm slam move, but it is effectively UNUSED because this value doesn't influence any logic</li> <li>1: Set when using the arm sweep move which allows to play the <code>ArmSweep</code> animation clip on <code>extraanims[1]</code> (the arm of <code>VenusGuardian</code> facing the camera) when the animstate is 102</li> <li>2: Set when using the grounded seeds throw move or flying in the air move which allows to play the <code>ArmHold</code> animation clip on all <code>extraanims</code> (both arms of <code>VenusGuardian</code>) when the animstate is 100 or 102</li> </ul> </li> <li><code>data[1]</code>: A phase tracker. There are 3 possible states:<ul> <li>0: The initial state. Nothing special happens until HPPercent is 0.65 or lower. On the first actor turn this happens, the first phase transition happens (more details in the pre logic section) and the value is set to 1</li> <li>1: The second state reached when HPPercent reached 0.65 or lower. The value will stay at this state until HPPercent is 0.375 or lower where the second phase transition happens (more details in the pre logic section) as well as using the enemy summon move for this actor turn. The value is then set to 2</li> <li>2: The last state. This value can no longer influence the action logic from now on when set to it</li> </ul> </li> <li><code>data[2]</code>: This value is UNUSED</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>If the enemy is affected by Freeze, Sleep or Numb, those conditions will be removed at the start of the actor turn so this enemy get to cure them and act immediately after instead of not performing any logic which simulates as if the actor turn was skipped</li> <li>The single target arm slam move has the yield time between the <code>Creak2</code> and <code>Crea6</code> sounds changed to be random between 0.7 and 0.9 seconds instead of being random between 0.7 and 1.05 seconds</li> <li>The party wide arm sweep move deals 1 damage per affected player party member instead of 2</li> <li>The grounded seeds throw move deals 1 damage per hit instead of 2 and the amount of seeds thrown is between 3 and 8 inclusive instead of between 3 and 7 inclusive (the amount of Projectile calls is half of that number ceiled)</li> <li>When using the grounded seeds throw move or single target multiple hits version of the aerial seeds throw move, the chances to receive a <code>HardSeed</code> item in the player's standard items inventory is 75% instead of being guaranteed</li> <li>The party wide version of the aerial seeds throw move has each DoDamage calls deal 2 damages instead of 3. </li> <li>In the party wide version of the aerial seeds throw move, the amount of frames the seed takes to reach the player party changes to 22.5 frames from 30.0 frames. </li> <li>The odds of using the party wide version of the aerial seeds throw move changes to 1/3 from 1/4 meaning the odds of using the single target multiple hits version changes to 2/3 from 3/4</li> <li>The single target multiple hits version of the aerial seeds throw move has each Projectile calls deal 1 damages instead of 2. </li> <li>In the single target multiple hits version of the aerial seeds throw move, the speed of each Projectile calls changes to 32.5 instead of 40.0 </li> <li>In the single target multiple hits version of the aerial seeds throw move, the yield time between throws changes to 0.45 seconds from 0.6 seconds</li> <li>The base odds of this enemy inflicting themselves the AttackUp or DefenseUp conditions if they didn't already had them after using certain moves (check the post move logic section for details) changes to 36% from 21%</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#startbattle-logic","title":"StartBattle logic","text":"<p>After this enemy is loaded, there are some logic that happens with them on StartBattle where <code>extraentities</code> gets initialised to one element being a new entity named <code>Venus</code> with the <code>Venus</code> animid childed to the <code>battlemap</code> and positioned at (0.0, 0.0, 4.0). The entity also has these characteristics:</p> <ul> <li><code>hologram</code> is set to true if flags 162 is true (during a B.O.S.S or Cave Of Trials session)</li> <li><code>alwaysactive</code> is set to true</li> <li><code>activeonpause</code> is set to true</li> <li>A VenusBattle is added to the entity and SetUp such that it targets this enemy's <code>battleentity</code>. This allows the 2 entities to have special animation logic depending on each other's animation state. It's updated during Update, but it only includes visual changes.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#move-selection","title":"Move selection","text":"<p>6 moves are possible:</p> <ol> <li>A single target arm slam attack</li> <li>A party wide arm sweep attack</li> <li>Multiple seeds throws targetting random player party members</li> <li>Flies in the air to change position to <code>Flying</code></li> <li>Summons a new AngryPlant enemy and inflicts DefenseUp on themselves</li> <li>An aerial seed throwing move that is either party wide or single target with multiple hits</li> </ol> <p>Move 6 is only used when position is <code>Flying</code> and it is always used if that is the case. It is however possible this move is used on the same actor turn right after move 4.</p> <p>Move 4 is only used and always will be used after the first phase transition, but before the second one if position is <code>Ground</code> meaning move 6 will always be used after due to the position becoming <code>Flying</code>. See the pre move logic section for more details.</p> <p>Move 5 is only used once in the battle on the actor turn where the second phase transition occurs, but only if position is <code>Ground</code>. See the pre move logic section below for more details.</p> <p>As for move 1, 2 or 3, they can only be used when position is <code>Ground</code> and none of the special conditions mentioned above occurs so it's basically the \"standard\" moveset. In that case, the decision of which move to use is based on the following odds:</p> Move Odds 1 3/7 2 2/7 3 2/7"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#pre-move-logic","title":"Pre move logic","text":"<p>There is some logic that can happen at the start of the action regardless of the situation which involves curing stopping conditions, some animation logic that always happen and some logic that happens only in a specific situation involving phase transitions.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#curing-stopping-conditions","title":"Curing stopping conditions","text":"<p>This logic only happens if the enemy at least one of the following stopping conditions:</p> <ul> <li>Freeze</li> <li>Sleep</li> <li>Numb</li> </ul> <p>What happens next depends on if hardmode is true or not. If it's false, the entire action stops here with an early break because curing stopping conditions is disabled meaning the enemy will simulate not being able to act by omiting their action completely.</p> <p>If hardmode is true however, the stopping conditions gets cured allowing the enemy to act immediately after on the same actor turn. Here is the logic that happens in that case:</p> <ul> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 101</li> <li>If <code>icecube</code> exists, <code>shakeice</code> is set to true</li> <li>Yield for 0.5 seconds</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 101</li> <li>If <code>icecube</code> exists:<ul> <li>BreakIce called</li> <li><code>IceBreak</code> sound plays</li> </ul> </li> <li>RemoveCondition called to remove the Freeze condition on this enemy</li> <li>RemoveCondition called to remove the Sleep condition on this enemy</li> <li>RemoveCondition called to remove the Numb condition on this enemy</li> <li><code>isnumb</code> and <code>isasleep</code> set to false</li> <li>The startstate local is set to 0 (<code>Idle</code>)</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>MagicUp</code> sound plays (NOTE: there is no Audioclip that exists by this name so this will silently fail)</li> <li>UpdateAnim called</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#animation-logic","title":"Animation logic","text":"<p>This always happen unless hardmode was false and the above logic caused the action to stop immediately:</p> <ul> <li><code>extraentities[0]</code> (<code>Venus</code>)'s <code>anim</code>'s speed set to 1.0</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#phase-transition-logic","title":"Phase transition logic","text":"<p>There are some logic that happens before a move is selected which relates to phase transitions and first actor turn. All of the following logic are mutually exclusive: the first one mentioned that applies will be performed.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#first-actor-turn","title":"First actor turn","text":"<p>This logic happens when <code>data</code> first initialises. Since this can only happen on the first actor turn of the enemy, it can be thought of as the first actor turn logic:</p> <ul> <li>Camera moves to look near (1.25, 1.5, 2.0)</li> <li>Yield for 0.5 seconds</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[89]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>extraentities[0]</code> (<code>Venus</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>SetDefaultCamera</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#first-phase-transition","title":"First phase transition","text":"<p>When <code>data[1]</code> transitions from 0 to 1 as HPPercent reached 0.65 or lower, this is the logic that occurs:</p> <ul> <li>Camera moves to look near (1.25, 1.5, 2.0)</li> <li>Yield for 0.5 seconds</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[90]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>extraentities[0]</code> (<code>Venus</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>SetDefaultCamera</li> <li><code>data[1]</code> is set to 1</li> </ul> <p>On top of this, until the second phase transition, move 4 (flying in the air) will always be used from now on if position is <code>Ground</code> meaning move 6 (aerial seed throw) will always be used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#second-phase-transition","title":"Second phase transition","text":"<p>When <code>data[1]</code> transitions from 1 to 2 as HPPercent is 0.375 or lower, this is the logic that occurs:</p> <ul> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 17 (<code>WeakBattleIdle</code>)</li> <li>Camera moves to look near (1.25, 1.5, 2.0)</li> <li>Yield for 0.5 seconds</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[91]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: <code>extraentities[0]</code> (<code>Venus</code>)</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>SetDefaultCamera</li> <li><code>data[1]</code> is set to 2</li> </ul> <p>On top of this, move 5 (AngryPlant summon) will always be used on this actor turn, but only if postion is <code>Ground</code>. If it's <code>Flying</code>, this enemy will never use this move in the entire battle.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#post-move-logic","title":"Post move logic","text":"<p>There is some logic that may happen after a move's usage, but only if all of the following conditions are fufilled:</p> <ul> <li>Either move 1 or 2 was used (arm slam or arm sweep) or move 3 was used (grounded seeds throws), but the additional quantity of seeds to throw was either 1 or 2 which has 2/3 chances to happen (2/4 instead if hardmode is true)</li> <li>Either an RNG check passes with 21% (36% if hardmode is true) or all of the following conditions are fufilled at once:<ul> <li>HPPercent is 0.33 or lower</li> <li>This enemy is the only enemy party member left</li> <li>A 61% RNG check passes</li> </ul> </li> <li>This enemy doesn't already have the AttackUp condition</li> <li>This enemy doesn't already have the DefenseUp condition</li> </ul> <p>If all of the above is fufilled, the enemy will inflict themselves the AttackUp or DefenseUp condition by doing the following:</p> <ul> <li>animstate and <code>basestate</code> set to 0 (<code>Idle</code>)</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 101</li> <li>Yield for 0.65 seconds</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 102</li> <li><code>StatUp</code> sound plays</li> <li>The condition to inflict between AttackUp or DefenseUp is decided with an RNG check. 2/3 chance to be <code>AttackUp</code> and 1/3 chance to be <code>DefenseUp</code></li> <li>SetCondition called to inflict the condition determined above to this enemy for 3 main turns (effectively 2 since the main turn advances soon after)</li> <li>StatEffect on this enemy with type 0 (red up arrow) if <code>AttackUp</code> was inflicted and type 1 (blue up arrow) if <code>DefenseUp</code> was inflicted</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#move-1-arm-slash","title":"Move 1 - Arm slash","text":"<p>A party wide arm slash attack</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#logic-sequence","title":"Logic sequence","text":"<p>The arm object is reffered to <code>extraanims[1]</code>'s 6th grand children which is a bone attached to <code>VenusGuardian</code>'s arm that faces the camera.</p> <ul> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 103</li> <li><code>data[0]</code> set to 0 (doesn't end up affecting anything)</li> <li>GetSingleTarget called</li> <li>animstate set to 100</li> <li><code>Creak2</code> sound plays</li> <li>Yield for a random interval between 0.7 and 1.05 seconds (the upper bound is 0.9 seconds instead if hardmode is true)</li> <li><code>Creak6</code> sound plays</li> <li>animstate set to 102</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 105</li> <li><code>latetrans</code> set to the arm</li> <li>Over the course of 10.0 frames, <code>latepos</code> changes to <code>playertargetentity</code> position + 0.05 in y</li> <li>The arm has its local position set to <code>playertargetentity</code> position + 0.05 in y</li> <li>ShakeScreen called for 0.2 ammount and 0.15 time</li> <li><code>Thud4</code> sound plays</li> <li><code>impactsmoke</code> particles plays at <code>playertargetentity</code></li> <li>DoDamage 1 call happens</li> <li>Yield for 0.75 seconds</li> <li>StopLate called</li> <li>The arm has its local position set to the one it had before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#move-2-arm-sweep","title":"Move 2 - Arm sweep","text":"<p>A party wide arm sweep attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen for each player party member whose <code>hp</code> is above 0 This enemy The player party member 2 (1 instead if hardmode is true) null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#logic-sequence_1","title":"Logic sequence","text":"<p>The arm object is reffered to <code>extraanims[1]</code>'s 6th grand children which is a bone attached to <code>VenusGuardian</code>'s arm that faces the camera.</p> <ul> <li><code>data[0]</code> set to 1 (will play the <code>ArmSweep</code> animation clip on <code>extraanims[1]</code> (the arm of <code>VenusGuardian</code> facing the camera) when the animstate is set to 102)</li> <li>animstate set to 100</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 106</li> <li><code>Creak3</code> sound plays</li> <li>Over the course of 30.0 frames, <code>sprite</code>'s angles lerped to (0.0, -30.0, 0.0)</li> <li>ShakeSprite called with (0.1, 0.1, 0.1) intensity and 0.5 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 102</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 108</li> <li><code>Woosh6</code> sound plays with 0.75 pitch</li> <li>Over the course of 40.0 frames, <code>sprite</code> y angle gets LerpAngle to 25.0. When reaching the 20th frame or later for the first time:<ul> <li><code>impactsmoke</code> particles played at <code>partymiddle</code></li> <li><code>Dust</code> sound plays</li> <li>DoDamage 1 call happens for every affected player party members</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>The arm has its local postion set to the one it had before this action</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#move-3-grounded-seeds-throw","title":"Move 3 - Grounded seeds throw","text":"<p>Multiple seeds throws targetting random player party members.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen for half the amount of seeds thrown ceiled, but each call can only happen if GetRandomAvaliablePlayer with nullable doesn't return -1. The amount of seeds thrown is random between 3 and 7 inclusive (between 3 and 8 inclusive instead if hardmode is true) 2 (1 if hardmode is true) null This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) A new GameObject rooted with a SpriteRenderer using the <code>HardSeed</code> item sprite  positioned at this enemy + (0.0, 3.0, 0.5) using the <code>spritemat</code> material on layer 0 (Default) 60.0 (50.0 instead if hardmode is true) A random integer between 6 and 8 inclusive which is then cast to float null null <code>WoodHit</code> Empty string (0.0, 0.0, random integer between -20 and 20 which is then cast to float) false <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>The amount of additional throws is generated to be between 1 and 3 (between 1 and 4 instead if hardmode is true). This will be added later to the base amount which is between 2 and 4 (but the additional amout influences the post move logic, see its section for details)</li> <li><code>data[0]</code> set to 2 which will play the <code>ArmHold</code> animation clip on all <code>extraanims</code> (both arms of <code>VenusGuardian</code>) when the animstate is 100 or 102</li> <li><code>animstate</code> set to 100</li> <li><code>Creak2</code> sound plays</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 101</li> <li>Yield for 0.625 seconds</li> <li>animstate set to 102</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 102</li> <li>Yield for 0.25 seconds</li> <li>animstate set to 104</li> <li>ShakeScreen called for 0.15 ammount and -1.0 time</li> <li><code>Thud3</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>MainManager.<code>screenshake</code> set to (0.09, 0.09, 0.09)</li> <li>The amount of seeds to throw is determined. It's random between 3 and 7 inclusive (between 3 and 8 inclusive instead if hardmode is true)</li> <li><code>checkingdead</code> set to a new SeedShake coroutine called in such a way that it effectively ends up doing the following (it receives the amount of seeds to throw):<ul> <li>A SpriteRenderer array is created to contain the seeds with the length being the amount to throw</li> <li>For each seeds to throw:<ul> <li>The seed element of the array is initialised to a new GameObject rooted with a SpriteRenderer using the <code>HardSeed</code> item sprite  positioned at this enemy + (0.0, 3.0, 0.5) using the <code>spritemat</code> material on layer 0 (Default)</li> <li>GetRandomAvailablePlayer called with nullable. NOTE: This targetting scheme is broken, see the nullable GetRandomAvailablePlayer documentation for details</li> <li>If the seed index is even and the target player party member isn't -1, <code>Ping</code> sound plays followed by a Projectile 1 call. If it's odd, <code>PingUp</code> sound plays with 0.75 volume followed by the seed object moving via MainManager.ArcMovement to a random vector between (0.0, 0.0, -5.0) and (10.0, 0.0, 5.0) with destroyonend and using the same spin, height and frametime than the Projectile 1 call</li> <li>Yield for a random interval between 0.3 and 0.6 seconds</li> </ul> </li> <li>Yield all frames until all elements of the seeds array are null (all Projectile 1 calls completed)</li> <li><code>checkingdead</code> set to null</li> </ul> </li> <li>Yield all frames until <code>checkingdead</code> is null (SeedShake completed)</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Over the course of 20.0 frames, MainManager.<code>screenshake</code> gets lerped to Vector3.zero</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 8 (<code>Happy</code>)</li> <li>MainManager.<code>screenshake</code> set to Vector3.zero</li> <li>GetRandomAvailablePlayer called with nullable. NOTE: This targetting scheme is broken, see the nullable GetRandomAvailablePlayer documentation for details</li> <li><code>checkingdead</code> set to a new HardSeedVenus coroutine call with the target player party member index just obtained as a and the hardmode value as harmode which effectively does the following:<ul> <li>The corutine does nothing except setting <code>checkingdead</code> to null if not all of the following conditions are fufilled:<ul> <li><code>hasblocked</code> is true (At least one Projectile call had its DoDamage call blocked)</li> <li>The target isn't -1</li> <li><code>items[0]</code> is less than instance.<code>maxitems</code> (not full standard items inventory)</li> <li>Either hardmode is false or a 75% RNG check passes if it is true</li> </ul> </li> <li>If the above are all fufilled, some animation logic occurs and <code>items[0]</code> gets a <code>HardSeed</code> item appended to it </li> </ul> </li> <li>Yield all frames until <code>checkingdead</code> is null (HardSeedVenus completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#move-4-flies-in-the-air","title":"Move 4 - Flies in the air","text":"<p>Flies in the air to change position to <code>Flying</code>. No damages are dealt, but since move 6 (aerial seeds throw) is always used after this move, damages will be dealt there.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which doesn't affect anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 101</li> <li>Camera moves to look to the enemy party zoomed out and angled downward</li> <li><code>data[0]</code> set to 2 which will play the <code>ArmHold</code> animation clip on all <code>extraanims</code> (both arms of <code>VenusGuardian</code>) when the animstate is 100 or 102</li> <li>animstate set to 104</li> <li><code>bobrange</code> and <code>bobspeed</code> reset to <code>startbf</code> and <code>startbs</code> respectively</li> <li>Yield for 0.75 seconds</li> <li>The first 2 <code>extras</code> (<code>VenusGuardian</code>'s wings) are enabled and has the following happen on each:<ul> <li>scale set to Vector3.zero</li> <li>x angle set to 150.0 for the first wing and -150.0 for the second wing</li> <li><code>LeafExplode</code> sound plays</li> <li><code>leafexplode</code> particles plays at the wing with scale (3.25, 3.25, 1.5)</li> </ul> </li> <li>Over the course of 15.0 frames, both wings has their scale changed to their initial value before they were set to Vector3.zero via a lerp</li> <li>animstate set to 100</li> <li>Yield for 0.75 seconds</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 102</li> <li>Yield for 0.5 seconds</li> <li><code>Flap</code> sound plays on loop</li> <li>Over the course of 60.0 frames, <code>height</code> changes to 4.0 via a lerp and when it goes higher than 0.25, animstate is set to 0 (<code>Idle</code>) before each frame yield</li> <li><code>Flap</code> sound stopped</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>height</code> set to 4.0</li> <li>position set to <code>Flying</code></li> <li><code>basestate</code> and the startstate local set to 13 (<code>BattleIdle</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#move-5-enemy-summon","title":"Move 5 - Enemy summon","text":"<p>Summons a new AngryPlant enemy and inflicts DefenseUp on themselves. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 103</li> <li>Yield for 0.5 seconds</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 105</li> <li><code>Charge</code> sound plays</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon an AngryPlant with type being <code>FromGround</code> at (6.0, 0.0, -1.0) without cantmove (meaning they will be able to act immediately after this action)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>Yield for 0.5 seconds</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 101</li> <li>Yield for 0.5 seconds</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 102</li> <li><code>StatUp</code> sound plays</li> <li>SetCondition called to inflict DefenseUp on this enemy for 3 main turns (effectively 2 since this is always the last actor turn of this enemy)</li> <li>StatEffect called on this enemy with type 1 (blue up arrow)</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#move-6-aerial-seeds-throw","title":"Move 6 - Aerial seeds throw","text":"<p>An aerial seed throwing move that is either party wide or single target with multiple hits.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Only happens in the party wide version of the move and done for each player party member whose <code>hp</code> is above 0 This enemy The player party member 3 (2 instead if hardmode is true) null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#projectile-calls_1","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Only happens in the single target multiple hits version of the move from 2 to 3 times 2 (1 instead if hardmode is true) null This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for all calls) A new GameObject rooted with a SpriteRenderer using the <code>HardSeed</code> item sprite  positioned at this enemy + (0.0, 3.0, 0.5) using the <code>spritemat</code> material 40.0 (32.5 instead if hardmode is true) 0.0 null null <code>WoodHit</code> Empty string (0.0, 0.0, 20.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/VenusBoss/#logic-sequence_5","title":"Logic sequence","text":"<p>The version of the move to use is decided first with an RNG check. The odds are 3/4 (2/3 instead if hardmode is true) for the single target multiple hits version and 1/4 (1/3 instead if hardmode is true) for the party wide version.</p> <p>The flower SpriteRenderer is <code>extra[3]</code> which is the flower at the end of <code>VenusGuardian</code>'s arm facing the camera.</p> <ul> <li>Camera moves a bit up left</li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 103</li> <li>If using the single target version:<ul> <li>GetSingleTarget called</li> <li><code>Jump2</code> sound plays</li> </ul> </li> <li>If using the party wide version:<ul> <li>The flower's color is set to pure red</li> <li><code>Charge3</code> sound plays with 1.25 pitch</li> </ul> </li> <li>animstate set to 106</li> <li>Yield for an interval that depends on the version of the move:<ul> <li>Single target: random between 0.6 and 0.8 seconds</li> <li>Party wide: 1.25 seconds</li> </ul> </li> <li>The amount of seeds to throw is determined:<ul> <li>Single target: random between 2 and 3</li> <li>Party wide: 1</li> </ul> </li> <li>A SpriteRenderer array is created to contain each seeds to throw</li> <li>For each seeds to throw:<ul> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 105</li> <li>animstate set to 108</li> <li>The seed array initialised to a new GameObject rooted with a SpriteRenderer using the <code>HardSeed</code> item sprite  positioned at this enemy + (0.0, 3.0, 0.5) using the <code>spritemat</code> material</li> <li>The flower color changes to pure white</li> <li>If this is the party wide version of the move:<ul> <li><code>PingShot</code> sound plays with 0.6 pitch</li> <li>HitPart particles plays near the flower object</li> <li>Over the course of 40.0 frames (32.5 frames instead if hardmode is true), the seed position is lerped to <code>partymiddle</code> and before each frame yield, it Rotate in z by 30.0 * the game's framtime</li> <li><code>explosion</code> particles plays at <code>partymiddle</code></li> <li><code>Explosion</code> sound plays</li> <li>ShakeScreen with an ammount of (0.2, 0.2, 0.2) and time of 0.25</li> <li>DoDamage 1 call happens for each affected player party members</li> <li>The seed is destroyed</li> </ul> </li> <li>If this is the single target version of the move:<ul> <li>Projectile call 1 happens</li> <li><code>PingShot</code> sound plays</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>If this is the last throw:<ul> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 103</li> <li>animstate set to 106</li> <li><code>Jump2</code> sound plays</li> <li>Yield for 0.6 seconds (0.45 seconds instead if hardmode is true)</li> </ul> </li> </ul> </li> <li><code>extraentities[0]</code> (<code>Venus</code>) animstate set to 8 (<code>Happy</code>)</li> <li>Yield all frames until all the seeds elements are null (meaning that all throws are done no matter the version of the move used)</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> </ul> <p>After, if the single target version of the move was used:</p> <ul> <li>GetRandomAvailablePlayer called with nullable. NOTE: This targetting scheme is broken, see the nullable GetRandomAvailablePlayer documentation for details</li> <li><code>checkingdead</code> set to a new HardSeedVenus coroutine call with the target player party member index just obtained as a and the hardmode value as harmode which effectively does the following:<ul> <li>The coroutine does nothing except setting <code>checkingdead</code> to null if not all of the following conditions are fufilled:<ul> <li><code>hasblocked</code> is true (At least one Projectile call had its DoDamage call blocked)</li> <li>The target isn't -1</li> <li><code>items[0]</code> is less than instance.<code>maxitems</code> (not full standard items inventory)</li> <li>Either hardmode is false or a 75% RNG check passes if it is true</li> </ul> </li> <li>If the above are all fufilled, some animation logic occurs and <code>items[0]</code> gets a <code>HardSeed</code> item appended to it</li> </ul> </li> <li>Yield all frames until <code>checkingdead</code> is null (HardSeedVenus completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspBomber/","title":"<code>WaspBomber</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspBomber/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the bomb throw move, the amount of frames the bomb takes to reach its target is random between 41.0 and 50.0 frames instead of being random between 41.0 and 60.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspBomber/#move-selection","title":"Move selection","text":"<p>1 moves is possible:</p> <ol> <li>A party wide bomb throw of a random type</li> </ol> <p>Move 1 is always used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspBomber/#move-1-bomb-throw","title":"Move 1 - Bomb throw","text":"<p>A party wide bomb throw of a random type.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspBomber/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspBomber/#partydamage-calls","title":"PartyDamage calls","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 2 (4 instead if the bomb thrown is a <code>SpicyBomb</code>) Depends on the bomb thrown:<ul><li><code>SpicyBomb</code> or <code>BurlyBomb</code><sup>1</sup>: null</li><li><code>NumbBomb</code>: Numb</li><li><code>FrostBomb</code>: Freeze</li><li><code>SleepBomb</code>: Sleep</li><li><code>PoisonBomb</code>: Poison</li></ul> <code>commandsuccess</code> 0.0 Vector3.zero false null <p>1: This is unexpected because of an issue where no effects are applied to this bomb type. It was expected to inflict DefenseDown, but that doesn't happen even after this call</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspBomber/#logic-sequence","title":"Logic sequence","text":"<p>The bomb type is determined with random odds:</p> <ul> <li><code>SpicyBomb</code>: 3/7</li> <li><code>PoisonBomb</code>: 1/7</li> <li><code>SleepBomb</code>: 1/7</li> <li><code>FrostBomb</code>: 1/7</li> <li><code>NumbBomb</code>: 1/7</li> </ul> <p>However, if it's a <code>SleepBomb</code>, <code>FrostBomb</code> or <code>NumbBomb</code> and any of the player party members have the Freeze, Numb or Sleep conditions, the result is rerolled to be one of the following with equal chances each:</p> <ul> <li><code>SpicyBomb</code></li> <li><code>PoisonBomb</code></li> <li><code>BurlyBomb</code></li> </ul> <p>After determining the bomb type, this is what the logic does:</p> <ul> <li>animstate set to 100</li> <li><code>TwistDoorEnter</code> sound plays</li> <li>A new sprite object is created rooted with the matching item sprite at this enemy position + (-0.6, 1.4, -0.1)</li> <li>Over the course of 23.0 frames, the bomb moves to this enemy position + (-0.6, 3.2, -0.1)</li> <li>Yield for 0.15 seconds</li> <li><code>Toss12</code> sound plays</li> <li>Over the course of an amount of frames between 41.0 and 61.0 (the upper bound is 51.0 instead if hardmode is true), the bomb moves to <code>partymiddle</code> via a BeizierCurve3 with a ymax of the total amount of frames / 10.0 + 2. Before each frame yield, the z angle of the bomb increases by 20.0</li> <li><code>Explosion</code> sound plays</li> <li>Different effects happens depending on the bomb type (except for <code>BurlyBomb</code> where no effects happen):<ul> <li><code>SpicyBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.2 and 0.75 time with dontreset</li> <li><code>Explosion</code> particles plays at <code>partmymiddle</code></li> </ul> </li> <li><code>PoisonBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li><code>PoisonEffect</code> particles plays at <code>partmymiddle</code> with 2x scale</li> </ul> </li> <li><code>SleepBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li>DeathSmoke particles plays at <code>partmymiddle</code> with 2x size</li> </ul> </li> <li><code>FrostBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li><code>mothicenormal</code> particles plays at <code>partmymiddle</code> with 3x scale</li> </ul> </li> <li><code>NumbBomb</code>:<ul> <li>ShakeScreen called with an ammount of 0.1 and 0.75 time</li> <li><code>ElecFast</code> particles plays at <code>partmymiddle</code> with 2x scale</li> <li><code>impactsmoke</code> particles plays at <code>partmymiddle</code></li> </ul> </li> </ul> </li> <li>PartyDamage 1 call happens</li> <li>The bomb gets destroyed</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/","title":"<code>WaspDriller</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: This is set to 2 when using the digging underground move and every actor turn where this enemy attacks with position set to <code>Underground</code>, it is decremented. Once it reaches 0 after the decrement, the enemy goes back to <code>Ground</code>. Effectively, this value represents the amount of actor turns left that this enemy can stay <code>Underground</code> before going back to <code>Ground</code> by themselves.</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the underground attack move, the total amount of frames for the enemy to move is 31.0 frames instead of being 39.0 frames. The DoDamage calls still happens on the first frame the enemy x position becomes lower than the <code>playertargetentity</code> one, but since the total amount of frames is reduced, this moment happens sooner</li> <li>In the grounded drill attack move, the enemy takes 26.0 frames to move to its target instead of 32.25 frames</li> <li>In the triple hits version of the grounded drill attack move, the yield time before the second and third hit changes to 0.45 seconds from 0.65 seconds</li> <li>In the rock debris attack move, the amount of rocks thrown is random between 2 and 4 inclusive instead of being random between 2 and 3 inclusive</li> <li>In the rock debris attack move, the speed of each projectile is random between 40 and 48 inclusive cast to float instead of being random between 40 and 56 cast to float</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#move-selection","title":"Move selection","text":"<p>4 moves are possible:</p> <ol> <li>A single target drill dash attack</li> <li>A multiple targets rock debris thrown from drilling the ground</li> <li>Digs to set the position to <code>Underground</code></li> <li>A single target underground drill attack</li> </ol> <p>Move 4 is always (and only) used when position is <code>Underground</code>.</p> <p>As for the other moves, the decision of which move to use is based on the following odds:</p> Move Odds 1 3/8 2 3/8 3 2/8"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#move-1-drill-dash-attack","title":"Move 1 - Drill dash attack","text":"<p>A single target drill dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE) This enemy <code>playertargetID</code> after GetSingleTarget 4 Pierce<sup>2</sup> null false 1_b <code>commandsuccess</code> is true (blocked, ignores FRAMEONE), done 3 times This enemy <code>playertargetID</code> after GetSingleTarget 1 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>MoveTowards <code>playertargetentity</code> position + (7.0, 0.0, -0.1) with 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 5 (<code>Angry</code>) as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Charge7</code> sound plays</li> <li>ShakeSprite called with intensity (0.1, 0.0, 0.0) and 50.0 frametimer</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li><code>WaspDrill</code> sound plays on loop using <code>sounds[9]</code></li> <li>Over the course of 32.25 frames (26.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position + (2.5, 0.0, -0.1) via a lerp</li> <li>If <code>commandsuccess</code> is false (the player didn't blocked, ignores FRAMEONE):<ul> <li>DoDamage 1_a call happens</li> <li>Over the course of 61.0 frames, this enemy moves to (-20.0, 0.0, z doesn't change) via a lerp</li> <li>SetDefaultCamera called</li> <li><code>sounds[9]</code> stopped</li> <li>Over the course of 71.0 frames, this enemy moves from (20.0, 0.0, z doesn't change) to startp via a lerp. Before each frame yield, animstate is set to 1 (<code>Walk</code>)</li> </ul> </li> <li>Otherwise (the player blocked, ignores FRAMEONE):<ul> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li>Done 3 times:<ul> <li>DoDamage 1_b call happens</li> <li>Yield for 0.65 seconds (0.45 seconds instead if harmode is true)</li> </ul> </li> <li>Over the course of 31.0 frames, this enemy moves to + 2.0 in x via a lerp</li> <li><code>sounds[9]</code> stopped</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#move-2-rock-debris-throw","title":"Move 2 - Rock debris throw","text":"<p>A multiple targets rock debris thrown from drilling the ground.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 to 3 times (2 to 4 times instead if hardmode is true), but each calls requires that there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 2 null This enemy The return of GetRandomAvailablePlayer without nullable (target changes each calls) A new sprite object rooted with a SpriteRenderer using the <code>MightyPeeble</code> medal sprite positioned at this enemy Random between 40 and 56 inclusive then cast to float (random between 40 and 48 inclusive instead if hardmode is true) 6.0 null null null null (0.0, 0.0, 20.0) false"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>Camera moves to loop near (-2.45, 0.0, 1.9)</li> <li>MoveTowards (0.5, 0.0, -0.5) with 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 5 (<code>Angry</code>) as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 100</li> <li><code>WaspDrill</code> sound plays on loop using <code>sounds[9]</code></li> <li><code>DirtFlying</code> particles plays near this enemy</li> <li>ShakeScreen called with an ammount of 0.05 and -1.0 time</li> <li>Yield for 0.5 seconds</li> <li>A new SpriteRenderer array is created with the amount of rocks to throw as the length. The amount is random between 2 and 3 inclusive (between 2 and 4 inclusive if hardmode is true)</li> <li>For each rock to throw, if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetRandomAvailablePlayer without nullable is called</li> <li><code>DigPop</code> sound plays</li> <li>The rock element is assigned to a new sprite object rooted with a SpriteRenderer using the <code>MightyPeeble</code> medal sprite positioned at this enemy</li> <li>Projectile 1 call happens</li> <li>Yield for a random interval between 0.65 and 0.85 seconds</li> </ul> </li> <li>Yield all frames until all rocks array elements are null (meaning all Projectile 1 calls completed)</li> <li>The <code>DirtFlying</code> particles created earlier are moved offscreen and destroyed in 5.0 seconds</li> <li>MainManager.<code>screenshake</code> zeroed out</li> <li>Yield for 0.3 seconds</li> <li><code>sounds[9]</code> stopped</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#move-3-digging-underground","title":"Move 3 - Digging underground","text":"<p>Digs to set the position to <code>Underground</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which doesn't affect anything for this move.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 5 (<code>Angry</code>)</li> <li>Yield for 0.5 seconds</li> <li><code>WaspDrill</code> sound plays on loop using <code>sounds[9]</code></li> <li>animstate set to 100</li> <li>Yield for 0.35 seconds</li> <li><code>data[0]</code> set to 2 (meaning this enemy will stay underground and attack for up to 2 actor turns)</li> <li><code>checkingdead</code> set to a new Dig coroutine for this enemy with 0 jump which eventually set position to <code>Underground</code> (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> <li><code>sounds[9]</code> stopped</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#move-4-underground-drill-attack","title":"Move 4 - Underground drill attack","text":"<p>A single target underground drill attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#nonphyscal-set-to-true_3","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspDriller/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>GetSingleTarget</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li><code>Digging</code> sound plays on loop using <code>sounds[9]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (4.0, 1.6, -0.1) with 1.6 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>digging</code> set to false</li> <li>animstate set to 101</li> <li>SetAnimForce called</li> <li>y position subtracted by 0.65 in y</li> <li><code>sprite</code> has its z angle set to 35.0</li> <li><code>sprite</code> has its scale set to Vector3.one</li> <li><code>WaspDrill</code> sound plays on loop using <code>sounds[9]</code> with 1.3 pitch</li> <li>Yield for 0.5 seconds</li> <li>Over the course of 39.0 frames (31.0 frames instead if hardmode is true), this enemy moves -7.0 in x via a lerp. On the first frame the enemy x position becomes less than the <code>playertargetentity</code> x position, DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li><code>digging</code> set to true</li> <li><code>sprite</code> has its scale set to Vector3.zero</li> <li><code>sprite</code> has its angle reset to Vector3.zero</li> <li>y position set to 0.0</li> <li><code>sounds[9]</code> stopped</li> <li><code>data[0]</code> decremented</li> <li><code>Digging</code> sound plays</li> <li>If <code>data[0]</code> reached 0 (meaning all underground actor turns were spent):<ul> <li>SetDefaultCamera called</li> <li>MoveTowards startp with a 3.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> set to false</li> <li><code>DirstExplode</code> particle plays at this enemy</li> <li><code>DigPop</code> sound plays</li> <li><code>digging</code> set to false</li> <li>position set to <code>Ground</code></li> <li>Yield for 0.5 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/","title":"<code>WaspGeneral</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: This is set to 1 the first time the triple slap move is used and it prevents some animation logic to occur for the rest of the battle when the move is used again</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>Grants an AttackUp condition to the first <code>enemydata</code> other than themselves who didn't already had it for 3 main turns</li> <li>Grants a DefenseUp condition to the first <code>enemydata</code> other than themselves who didn't already had it for 3 main turns</li> <li>Heals the first <code>enemydata</code> other than themselves who has an HPPercent less than 0.6 by 4 <code>hp</code></li> <li>Does nothing</li> <li>A single target triple slap attack</li> </ol> <p>Move 5 is always (and only) used if this enemy is the last <code>enemydata</code> remaining.</p> <p>As for the other moves, the decision of which move to use is based on odds. However, with the exception of move 4, each move has an additional requirement that must be fufilled in order for the move to be used after it is selected. If the requirement is not fufilled and the move is selected, move 4 will be used instead. Here are the odds and requirements:</p> Move Odds Requirment 1 2/8 At least one <code>enemydata</code> other than this enemy doesn't already have the AttackUp condition 2 2/8 At least one <code>enemydata</code> other than this enemy doesn't already have the DefenseUp condition 3 3/8 At least one <code>enemydata</code> other than this enemy has an HPPercent lower than 0.6 4 1/8 None, the move is always used"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#move-1-grants-an-attackup-condition-to-another-enemy-party-member","title":"Move 1 - Grants an AttackUp condition to another enemy party member","text":"<p>Grants an AttackUp condition to the first <code>enemydata</code> other than themselves who didn't already had it for 3 main turns. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The receiver of the heal is determined. It's the first <code>enemydata</code> other than themselves who didn't already have the AttackUp condition</li> <li>animstate set to 103</li> <li>Yield for 0.6 seconds</li> <li>A new sprite object is created rooted using the <code>VitalitySeed</code> item sprite positioned at this enemy + (-1.0, 2.0, -0.1) and destroyed in 0.75 seconds</li> <li>animstate set to 104</li> <li><code>ItemHold</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>StatusEffect is called to inflict the AttackUp condition on the enemy party member determined earlier for 3 main turns with effect</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#move-2-grants-a-defenseup-condition-to-another-enemy-party-member","title":"Move 2 - Grants a DefenseUp condition to another enemy party member","text":"<p>Grants a DefenseUp condition to the first <code>enemydata</code> other than themselves who didn't already had it for 3 main turns. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>The receiver of the heal is determined. It's the first <code>enemydata</code> other than themselves who didn't already have the DefenseUp condition</li> <li>animstate set to 103</li> <li>Yield for 0.6 seconds</li> <li>A new sprite object is created rooted using the <code>GenerousSeed</code> item sprite positioned at this enemy + (-1.0, 2.0, -0.1) and destroyed in 0.75 seconds</li> <li>animstate set to 104</li> <li><code>ItemHold</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>StatusEffect is called to inflict the DefenseUp condition on the enemy party member determined earlier for 3 main turns with effect</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#move-3-heals-another-enemy-party-member-hp","title":"Move 3 - Heals another enemy party member <code>hp</code>","text":"<p>Heals the first <code>enemydata</code> other than themselves who has an HPPercent less than 0.6 by 4 <code>hp</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>The receiver of the heal is determined. It's the first <code>enemydata</code> other than themselves who has an HPPercent less than 0.6</li> <li>animstate set to 103</li> <li>Yield for 0.6 seconds</li> <li>A new sprite object is created rooted using the <code>CrunchyLeaf</code> item sprite positioned at this enemy + (-1.0, 2.0, -0.1) and destroyed in 0.75 seconds</li> <li>animstate set to 104</li> <li><code>ItemHold</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Heal is called on the enemy party member determined earlier to heal their <code>hp</code> by 4</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#move-4-does-nothing","title":"Move 4 - Does nothing","text":"<p>Does nothing. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>animstate set to 101</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#move-5-triple-slap-attack","title":"Move 5 - Triple slap attack","text":"<p>A single target triple slap attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 3 times This enemy <code>playertargetID</code> after GetSingleTarget 1 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspGeneral/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>If <code>data[0]</code> is 0 (this move wasn't used before):<ul> <li><code>Jump</code> sound plays with 1.1 pitch</li> <li>Jump is called on this enemy</li> <li><code>basestate</code> and animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>walkstate</code> set to 23 (<code>Chase</code>)</li> <li>Yield for 0.75 seconds</li> <li><code>data[0]</code> is set to 1 (meaning this logic won't happen again when this moved is used again)</li> <li>A new <code>Prefabs/Particles/Tired</code> GameObject is instantiated chiled to this enemy with a local position of <code>cursoroffset</code> - 0.5 in y with angles of (-130.0, 270.0, 0.0)</li> </ul> </li> <li>If <code>inevent</code> is false (no EventDialogue is ongoing):<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.25, 0.0, -0.1) with a 2.0 multiplier using 23 (<code>Chase</code>) as walkstate and 100 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>UltimaxAtk</code> sound plays</li> <li>Done 3 times:<ul> <li>DoDamage 1 call happens</li> <li>Yield for 0.65 seconds</li> </ul> </li> <li>SetDefaultCamera called</li> <li>MoveTowards <code>playertargetentity</code> startp with a 2.0 multiplier using 23 (<code>Chase</code>) as walkstate and the local startstate as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/","title":"<code>WaspHealer</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#mainmanagergetexp-special-logic","title":"MainManager.GetEXP special logic","text":"<p>This enemy features special exp handling logic. Check the documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the needles throw move, the property of all the Projectile calls is always Poison instead of only being <code>Poison</code> with a 6/10 chance and null with a 4/10 chance</li> <li>In the needles throw move, the damage is always 1 instead of being 2 (3 instead if instance.<code>areaid</code> is the <code>RubberPrison</code> or <code>MetalLake</code> areas)</li> <li>In the needles throw move, the speed is 10.0 instead of 15.0</li> <li>In the needles throw move, the yield time between each hits is 0.35 seconds instead of being 0.25 seconds</li> <li>In the aerial strike move, the amount of frames this enemy takes to reach its target from near the target is 9.0 frames instead of 11.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target aerial needles throw that hits twice</li> <li>A single target aerial strike</li> <li>Summons another <code>WaspHealer</code> enemy and change position to <code>Ground</code>.</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 2/4 2 1/4 3 1/4 <p>However, in order for move 3 to actually be used, the following conditions needs to be fufilled after selecting it:</p> <ul> <li>This enemy is alone in <code>enemydata</code></li> <li><code>locktri</code> is false (meaning it hasn't summoned before and it wasn't a summoned <code>WaspHealer</code>)</li> </ul> <p>If the move was selected, but the conditions above aren't fufilled, move 2 is used instead.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#move-1-needles-throw","title":"Move 1 - Needles throw","text":"<p>A single target aerial needles throw that hits twice.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 times <ul><li>If harmode is false, it's 2 (3 instead if instance.<code>areaid</code> is the <code>RubberPrison</code> or <code>MetalLake</code> areas)</li><li>If hardmode is true, it's always 1</li></ul> null (Poison instead if hardmode is true) This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for all calls) A new GameObject childed to <code>battlemap</code> with a SpriteRenderer using the <code>projectilepsrites[2]</code> sprite (a needle) with the <code>spritemate</code> material (if hardmode is true color is set to pure magenta) positioned at this enemy's <code>sprite</code> + (-1.5, 0.25, -0.1) with a z angle of -45.0 on layer 14 (<code>Sprite</code>) 15 (10 if hardmode is true) 0.0 null null null null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> set to a new ChangePosition call on this enemy to change its position to <code>Flying</code> (<code>checkingdead</code> is set to null when completed)</li> <li>Yield until <code>checkingdead</code> is null</li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (3.25, 0.0, -0.25) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li>Yield for 0.4 seconds</li> <li>A new Transform array of 2 elements is created to contain each needles</li> <li>Done 2 times for each needle to throw:<ul> <li><code>Toss</code> sound plays</li> <li>animstate set to 102</li> <li>Needle element initialized to a new GameObject childed to <code>battlemap</code> with a SpriteRenderer using the <code>projectilepsrites[2]</code> sprite (a needle) with the <code>spritemate</code> material (if hardmode is true color is set to pure magenta) positioned at this enemy's <code>sprite</code> + (-1.5, 0.25, -0.1) with a z angle of -45.0 on layer 14 (<code>Sprite</code>)</li> <li>Projectile 1 call happens</li> <li>Yield for 0.25 seconds (0.35 instead if hardmode is true)</li> <li>If this is the last needle:<ul> <li>animstate set to 100</li> <li>Yield for 0.4 seconds</li> </ul> </li> </ul> </li> <li>Yield all frames until all the needles array elements are null (meaning all Projectile calls completed)</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#move-2-aerial-strike","title":"Move 2 - Aerial strike","text":"<p>A single target aerial strike.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 (4 instead if instance.<code>areaid</code> is the <code>RubberPrison</code> or <code>MetalLake</code> areas) null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> set to a new ChangePosition call on this enemy to change its position to <code>Flying</code> (<code>checkingdead</code> is set to null when completed)</li> <li>Yield until <code>checkingdead</code> is null</li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (3.25, 0.0, -0.25) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 101</li> <li><code>height</code> set to 0.0</li> <li>y position increased by the <code>height</code> value before this action</li> <li><code>BugWingFast</code> sound plays</li> <li>Over the course of 31.0 frames, this enemy moves + 1.25 in x via a BeizierCurve3 with a ymax of -1.5</li> <li>ShakeSprite called with intensity (0.1, 0.0, 0.0) and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 105</li> <li><code>trail</code> set to true</li> <li><code>Woosh2</code> sound plays</li> <li>Over the course of 11.0 frames (8.0 frames instead if hardmode is true), this enemy moves to <code>playertargetentity</code> position + (0.75, 0.75, -0.1) via a lerp</li> <li>ShakeScreen called with an ammount of 0.05 and time of 0.2</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.35 seconds</li> <li>animstate set to 104</li> <li>Over the course of 11.0 frames, this enemy moves to <code>playertargetentity</code> position + (2.0, <code>height</code> value of this enemy before this action, -0.2) via a lerp</li> <li><code>trail</code> set to false</li> <li><code>height</code> set to the value before this action</li> <li>y position set to 0.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#move-3-summons-another-wasphealer","title":"Move 3 - Summons another <code>WaspHealer</code>","text":"<p>Summons another <code>WaspHealer</code> enemy and change position to <code>Ground</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#nocharm-set-to-true","title":"nocharm set to true","text":"<p>This move always set the nocharm local to true which will prevent any UseCharm calls to occur in the post action phase. This means no <code>HealHP</code> charm can occur after this action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspHealer/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> set to a new ChangePosition call on this enemy to change its position to <code>Ground</code> (<code>checkingdead</code> is set to null when completed)</li> <li>Yield until <code>checkingdead</code> is null</li> <li>animstate set to 106</li> <li>Yield for 0.3 seconds</li> <li><code>Whistle</code> sound plays with 0.9 pitch and 0.7 volume</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a new <code>WaspHealer</code> with an <code>Offscreen</code> type at a random location between (0.25, 0.0, -0.75) and (7.0, 0.0, 0.75) where the distance between any enemy party member is less than its <code>size</code> * 1.75 with cantmove (meaning the enemy needs to wait on the next main turn to act)</li> <li>Yield for 0.85 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li><code>locktri</code> set to true (prevents from using this move again)</li> <li><code>enemydata[lastaddedid]</code>'s <code>locktri</code> set to true which prevents the summoned enemy from using this move. NOTE: It is technically possible that the summoning hasn't completed yet, but the previous yield makes it very unlikely in practice</li> <li>Yield until <code>checkingdead</code> is null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/","title":"<code>WaspKing</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#assumptions","title":"Assumptions","text":"<p>It is assumed that this enemy is loaded with actimmobile set to true because it is required for this enemy to be able to cure themselves of stopping condition if hardmode is true.</p> <p>It is also assumed this enemy's eventondeath is set to its matching EventDialogue.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#fire-damage-infliction-logic-in-calculatebasedamage","title":"Fire damage infliction logic in CalculateBaseDamage","text":"<p>This enemy has a 30% chance to be on fire on a <code>Fire</code> property attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: An actor turn cooldown on the usage of the fire pillar move. When the move is used, the value is set to 3. In the post move logic, the value is decremented if it is above 0. For the fire pillar move to be usable, the value needs to be above 0. Effectively, it's an antispam for the fire pillar move where this enemy needs to wait 2 full actor turns before the move becomes usable again</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>If this enemy has a stopping condition, it will now be cured in the pre move logic by calling ClearStatus on this enemy</li> <li>In the axe throw move, the amount of frames the axe takes to reach its target changes to 21.0 frames from 30.0 frames</li> <li>In the fire balls projectiles move, the odds to use the single target version of the move when HPPercent is lower than 0.7 changes to 40% from 30%</li> <li>In the fire balls projectiles move (single target version), the amount of frames the fire ball takes to reach its target changes to 26.0 frames from 34.0 frames</li> <li>In the fire balls projectiles move, (multiple targets version), the speed of each Projectile call changes to be random between 22.0 and 28.0 instead of being random between 29.0 and 35.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#move-selection","title":"Move selection","text":"<p>5 moves are possible:</p> <ol> <li>A single target axe slash attack</li> <li>A single target axe throw attack</li> <li>A party wide fire pillar attack</li> <li>A single or multiple targets fire balls projectiles throw</li> <li>Heals themselves for some <code>hp</code> and gets either the AttackUp or DefenseUp condition</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 3/12 2 2/12 3 2/12 4 3/12 5 2/12 <p>However, if move 3 is selected and <code>data[0]</code> isn't 0 (the cooldown on this move's usage hasn't expired yet), a continue directive is issued to the enemy action loop which restarts the entire action and rerolls the move selection process.</p> <p>Also, the same happens if move 5 was selected and any of the following are true:</p> <ul> <li>HPPercent is above 0.8</li> <li><code>moves</code> is above 1 (meaning it was upgraded to 2 in the phase transition logic of the pre move logic) while <code>cantmove</code> is higher than -1 (meaning this enemy is doing their last actor turn of the main turn)</li> <li>This enemy already has the AttackUp condition</li> <li>This enemy already has the DefenseUp condition</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before using a move. It is in 2 parts done in order: stop conditions curing and phase transition.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#stop-condition-curing","title":"Stop condition curing","text":"<p>This part only happens if hardmode is true and this enemy IsStopped with skipimmobile:</p> <ul> <li>ShakeScreen called with an ammount of 0.1 and 0.5 time with dontreset</li> <li><code>Charge7</code> sound plays with 0.8 pitch</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>ClearStatus called on this enemy</li> <li><code>Heal3</code> sound plays</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#phase-transition","title":"Phase transition","text":"<p>This part only happens if HPPercent is 0.4 or lower and <code>locktri</code> is false (meaning this part hasn't happened before as it will be set to true) where a phase transition happens. Notably, <code>moves</code> is set to 2 with <code>cantmove</code> decremented (this enemy will now get 2 actor turns per main turn including the current main turn) as well as increases the damageammount of the axe slash move by 1:</p> <ul> <li><code>Charge7</code> sound plays with 0.8 pitch</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li><code>cantmove</code> gets decremented and <code>moves</code> set to 2 which gives this enemy 2 actor turns per main turn including the current main turn</li> <li>StatEffect called on this enemy with type 5 (yellow up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>locktri</code> set to false so this logic isn't done again, but it also increases the damageammount of the axe slash move by 1</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen after using a move:</p> <ul> <li>If <code>data[0]</code> is above 0, it is decremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#move-1-axe-slash-attack","title":"Move 1 - Axe slash attack","text":"<p>A single target axe slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 5 (6 instead if <code>locktri</code> is true which means the phase transition in the pre move logic occured before) Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li>Yield for 0.65 seconds</li> <li>ShakeScreen called with 0.2 ammount and 0.5 time</li> <li>animstate set to 101</li> <li><code>Slash</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>Jump called on <code>playertargetentity</code></li> <li>Yield for 0.75 seconds</li> <li>animstate set to 103</li> <li>Yield for 0.35 seconds</li> <li>Yield all frames until <code>playertargetentity</code> is <code>onground</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#move-2-axe-throw-attack","title":"Move 2 - Axe throw attack","text":"<p>A single target axe throw attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 6 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 100</li> <li>Yield for 0.65 seconds</li> <li><code>WaspKingAxToss</code> sound plays</li> <li>animstate set to 114</li> <li>A new sprite object is created childed to the <code>battlemap</code> using the <code>Sprites/Entities/waspking</code> index 62 sprite (their axe) positioned at this enemy position + (-1.0, 2.0, 0.0)</li> <li><code>WaspKingAxSpin</code> sound plays</li> <li>Over the course of 30.0 frames (21.0 frames instead if hardmode is true), the axe moves to <code>playertargetentity</code> position + (0.0, 1.25, -0.1) via a lerp. Before each frame yield, the axe's z angle increases by 52.0 * MainManager.<code>framestep</code></li> <li><code>WaspKingAxSpin</code> sound plays</li> <li>ShakeScreen called with 0.2 ammount and 0.5 time</li> <li>DoDamage 1 call happens</li> <li>Over the course of 46.0 frames, the axe moves to this enemy position + (-1.0, 2.0, 0.0) via a BeizierCurve3 with a ymax of 5.0. Before each frame yield, the axe's z angle increases by 25.0 * MainManager.<code>framestep</code></li> <li>The axe object gets destroyed</li> <li><code>WaspKingAxeThrowCatch</code> sound plays</li> <li>animstate set to 101</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 103</li> <li>Yield for 0.35 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#move-3-fire-pillar-attack","title":"Move 3 - Fire pillar attack","text":"<p>A party wide fire pillar attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 Fire <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 105</li> <li><code>checkingdead</code> set to a new FirePillar coroutine from this enemy without green</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> <p>Here is what the coroutine ends up doing:</p> <ul> <li>Yield for 0.5 seconds</li> <li><code>FirePillar</code> sound plays</li> <li>A new <code>Prefabs/Objects/FirePillar 1</code> GameObject is instantiated childed to the <code>battlemap</code> at <code>partymiddle</code> with a scale of (0.0, 1.0, 0.0 )and a DialogueAnim with the following:<ul> <li><code>targetscale</code>: (0.75, 1.0, 0.75)</li> <li><code>shrink</code>: false</li> <li><code>shrinkspeed</code>: 0.015</li> </ul> </li> <li>Yield for 0.65 seconds</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>shrinkspeed</code> set to 0.2</li> <li>Yield for 0.2 seconds</li> <li>ShakeScreen called with ammount of 0.25 and 0.75 time</li> <li>PartyDamage 1 call happens</li> <li>Yield for 1.15 seconds</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>targetscale</code> set to (0.0, 1.0, 0.0)</li> <li>All ParticleSystem under <code>Prefabs/Objects/FirePillar 1</code> are stopped</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>shrinkspeed</code> set to 0.05</li> <li><code>Prefabs/Objects/FirePillar 1</code> gets destroyed</li> <li><code>data[0]</code> is set to 3</li> <li><code>checkingdead</code> is set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#move-4-fire-balls-projectiles","title":"Move 4 - Fire balls projectiles","text":"<p>A single or multiple targets fire balls projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Only happens on the single target version of the move This enemy <code>playertargetID</code> after GetSingleTarget 5 Fire {BlockSoundOnly} <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Only happens on the multiple targets version of the move from 2 to 3 times (always 3 times instead if <code>moves</code> isn't 1 meaning the phase transition in the pre move logic occured before), but each calls requires that there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 2 Fire This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new <code>Prefabs/Particles/Fireball</code> GameObject childed to the <code>battlemap</code> positioned at this enemy + (-1.25, 2.5, 0.0) with a scale of 0.75x Random between 29.0 and 35.0 (random between 22.0 and 28.0 instead if hardmode is true) 2.0 <code>SepPart@2@4</code> <code>Fire</code> <code>WaspKingMFireball2</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#logic-sequence_3","title":"Logic sequence","text":"<p>The version of the move is determined first. It is the single target version ifthere's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) - HPPercent is less than 0.7 - A 30% RNG check passes (40% instead if hardmode is true)</p> <p>The multiple targets version is used otherwise.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#single-target-version","title":"Single target version","text":"<ul> <li>GetSingleTarget called</li> <li><code>WaspKingFireball1</code> sound plays</li> <li>animstate set to 112</li> <li>Yield for 0.25 seconds</li> <li>A <code>Prefabs/Particles/Fireball</code> is instantiated childed to the <code>battlemap</code> positioned at this enemy position + (-1.25, 2.5, 0.0)</li> <li>Over the course of 31.0 frames, the <code>Prefabs/Particles/Fireball</code>'s scale changes from 0.0x to 1.0x via a lerp</li> <li>animstate set to 115</li> <li>Over the course of 61.0 frames, the <code>Prefabs/Particles/Fireball</code> moves to the same position via a BeizierCurve3 with a ymax of 15.0. Before each frame yield on the second half, animstate is set to 100</li> <li>animstate set to 101</li> <li><code>WaspKingFireball2</code> sound plays</li> <li>ShakeScreen called with 0.1 ammount and 0.4 time with dontreset</li> <li>Over the course of 34.0 frames (26.0 frames instead if hardmode is true), the <code>Prefabs/Particles/Fireball</code> moves to <code>playertargetentity</code> position + 0.9 in y via a BeizierCurve3 with a ymax of 3.0</li> <li>ShakeScreen called with 0.2 ammount and 0.5 time with dontreset</li> <li><code>Fire</code> particles plays at the <code>Prefabs/Particles/Fireball</code> position</li> <li><code>BigHit</code> sound plays</li> <li>DoDamage 1 call happens</li> <li><code>Prefabs/Particles/Fireball</code> is moved offscreen at -9999.0 in y then destroyed in 4.0 seconds</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#multiple-targets-version","title":"Multiple targets version","text":"<ul> <li>The amount of hits is determined. It's random from 2 to 3 inclusive, but if <code>moves</code> isn't 1, it's always 3 (meaning the phase transition in the pre move occured before). A new Transform array is created with this amount as the length to hold the projectiles objects</li> <li>For each hits to do, if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li><code>WaspKingMFireball1</code> sound plays</li> <li>animstate set to 112</li> <li>Yield for 0.25 seconds</li> <li>The projectile element is set to a new <code>Prefabs/Particles/Fireball</code> GameObject childed to the <code>battlemap</code> positioned at this enemy + (-1.25, 2.5, 0.0)</li> <li>Over the course of 21.0 frames, <code>Prefabs/Particles/Fireball</code>'s scale changes from 0.0x to 0.75x via a lerp</li> <li>Yield for 0.1 seconds</li> <li>animstate set to 113</li> <li>Projectile 1 call happens</li> <li>Yield for a random interval between 0.35 and 0.6 seconds</li> </ul> </li> <li>Yield all frames until all projectiles objects are null (all Projectile 1 calls completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#move-5-heals-hp-with-attackup-or-defenseup-condition","title":"Move 5 - Heals <code>hp</code> with AttackUp or DefenseUp condition","text":"<p>Heals themselves for some <code>hp</code> and gets either the AttackUp or DefenseUp condition. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKing/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li>Yield for 0.25 seconds</li> <li><code>ItemHold</code> sound plays</li> <li>The effect is determined among the following determined with uniform odds:<ul> <li>Heal 5 <code>hp</code> with DefenseUp condition using the <code>BurlyChips</code> item sprite</li> <li>Heal 4 <code>hp</code> with AttackUp condition using the <code>FrenchFries</code> item sprite</li> </ul> </li> <li>A new sprite object is created childed to <code>battlemap</code> using the item sprite of the effect positioned at this enemy position + (-0.85, 2.65, -0.1). The object is destroyed in 0.75 seconds</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li>StatusEffect called to inflict the condition of the effect to this enemy for 3 main turns (effectively 2 since the current main turn ends soon enough) with effect</li> <li>Yield for 0.5 seconds</li> <li>Heal called to heal this enemy by the amount of <code>hp</code> the effect heals by</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/","title":"<code>WaspKingIntermission</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#assumptions","title":"Assumptions","text":"<p>This enemy is a lite version of WaspKing, they actually share logic, but this enemy imposes heavy restrictions. They will be taken for granted in this page for the sake of simplicity.</p> <p>It is assumed that MainManager.<code>battleloseevent</code> is true because this enemy will deal an absurdly high damaging party wide attack on the 3rd main turn which is meant to kill the player party. Setting this field to true allows DeadParty to not call GameOver and simply exit the battle via ReturnToOverworld.</p> <p>It is assumed that this enemy is immune to Freeze, Sleep and Numb conditions which avoids delaying the usage of his fire pillar move since this enemy can't be stopped.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: Effectively UNUSED here because while it normally would be an actor turn cooldown to using the fire pillar move, this enemy has it disabled so it has no effect. It is set to 3 when the move is used and decremented after, but this will be ignored and have no effects</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target axe slash attack</li> <li>A party wide fire pillar attack that always kills the player party</li> </ol> <p>Move 1 is always used until <code>turns</code> is 2 or above where move 2 is always used (meaning on the 3rd main turn, this enemy is locked to use move 2).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic is always done at the start of the action:</p> <ul> <li><code>hp</code> is set to 999 (effectively making this enemy impossible to kill as their data should also be 999 <code>maxhp</code>)</li> <li>If <code>turns</code> is 2 or above (2 main turns fully advanced since the start of the battle):<ul> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>commondialogue[119]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: This enemy</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li>Every player party members with a Shield condition has it removed via RemoveCondition</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#move-1-axe-slash","title":"Move 1 - Axe slash","text":"<p>A single target axe slash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 5 Flip<sup>1</sup> null <code>commandsuccess</code> <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>animstate set to 100</li> <li>Yield for 0.65 seconds</li> <li>ShakeScreen called with 0.2 ammount and 0.5 time</li> <li>animstate set to 101</li> <li><code>Slash</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>Jump called on <code>playertargetentity</code></li> <li>Yield for 0.75 seconds</li> <li>animstate set to 103</li> <li>Yield for 0.35 seconds</li> <li>Yield all frames until <code>playertargetentity</code> is <code>onground</code></li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#move-2-fire-pillar-instakill","title":"Move 2 - Fire pillar instakill","text":"<p>A party wide fire pillar attack that always kills the player party.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 99 NoExceptions false 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspKingIntermission/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>animstate set to 105</li> <li><code>checkingdead</code> set to a new FirePillar coroutine from this enemy without green</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> <p>Here is what the coroutine ends up doing:</p> <ul> <li>Yield for 0.5 seconds</li> <li><code>FirePillar</code> sound plays</li> <li>A new <code>Prefabs/Objects/FirePillar 1</code> GameObject is instantiated childed to the <code>battlemap</code> at <code>partymiddle</code> with a scale of (0.0, 1.0, 0.0 )and a DialogueAnim with the following:<ul> <li><code>targetscale</code>: (0.75, 1.0, 0.75)</li> <li><code>shrink</code>: false</li> <li><code>shrinkspeed</code>: 0.015</li> </ul> </li> <li>Yield for 0.65 seconds</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>shrinkspeed</code> set to 0.2</li> <li>Yield for 0.2 seconds</li> <li>ShakeScreen called with ammount of 0.25 and 0.75 time</li> <li>PartyDamage 1 call happens</li> <li>Yield for 1.15 seconds</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>targetscale</code> set to (0.0, 1.0, 0.0)</li> <li>All ParticleSystem under <code>Prefabs/Objects/FirePillar 1</code> are stopped</li> <li><code>Prefabs/Objects/FirePillar 1</code>'s DialogueAnim's <code>shrinkspeed</code> set to 0.05</li> <li><code>Prefabs/Objects/FirePillar 1</code> gets destroyed</li> <li><code>data[0]</code> is set to 3 (effectively does nothing because this <code>data</code> slot is unused for this enemy)</li> <li><code>checkingdead</code> is set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/","title":"<code>WaspTrooper</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#mainmanagergetexp-special-logic","title":"MainManager.GetEXP special logic","text":"<p>This enemy features special exp handling logic. Check the documentation to learn more.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the spear thrust move, the MoveTowards call is done with a multiplier of 2.7 instead of 2.5</li> <li>In the spear throw move, the yield interval before the throw is random between 0.6 and 0.9 seconds instead of being between 0.6 and 0.75 seconds</li> <li>In the spear throw move, the amount of frames that the spear takes to reach its target is random between 37.0 and 49.0 inclusive instead of always being 60.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#move-selection","title":"Move selection","text":"<p>3 moves are possible:</p> <ol> <li>A single target spear thrust</li> <li>A single target spear slash</li> <li>A single target spear throw</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 3/8 2 2/8 3 3/8"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#move-1-spear-thrust","title":"Move 1 - Spear thrust","text":"<p>A single target spear thrust</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 2 Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Done 3 times:<ul> <li><code>Jump</code> sound played</li> <li>Jump called</li> <li>Yield for 0.25 seconds</li> <li>Yield all frames while `onground is true</li> </ul> </li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Yield a frame</li> <li><code>trail</code> set to true</li> <li>MoveTowards <code>playertargetentity</code> position + (2.25, 0.0, -0.1) with 2.5 multiplier (2.7 instead if hardmode is true) using 23 (<code>Chase</code>) as walkstate and 100 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>trail</code> set to false</li> <li><code>Woosh4</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#move-2-spear-slash","title":"Move 2 - Spear slash","text":"<p>A single target spear slash</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li><code>Woosh5</code> sound plays</li> <li>animstate set to 101</li> <li>Yield for 0.5 seconds</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Yield a frame</li> <li><code>trail</code> set to true</li> <li>MoveTowards <code>playertargetentity</code> position + (2.0, 0.0, -0.1) with 2.25 multiplier using 23 (<code>Chase</code>) as walkstate and 102 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Woosh</code> sound plays</li> <li><code>trail</code> set to false</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#move-3-spear-throw","title":"Move 3 - Spear throw","text":"<p>A single target spear throw</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#dodamage-calls_2","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WaspTrooper/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 103</li> <li>Yield for a random interval between 0.6 and 0.75 seconds (the upper bound is 0.9 seconds instead if hardmode is true)</li> <li>animstate set to 28 (<code>TossItem</code>)</li> <li><code>Toss3</code> sound plays</li> <li><code>Toss4</code> sound plays</li> <li>A new sprite object is created rooted using <code>projectilepsrites[6]</code> sprite (a spear) at this enemy position + (0.0, 1.5, -0.1)</li> <li>Over the course of 60.0 frames (random between 37.0 and 50.0 frames instead if hardmode is true), the spear moves to <code>playertargetentity</code> position + (0.75, 1.25, -0.1) via a BeizierCurve3 with a ymax of 5.0 and its z angle changes from 50.0 to 140.0 via a lerp</li> <li>The spear gets destroyed</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li><code>Woosh5</code> sound plays</li> <li>animstate set to 101</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/","title":"<code>Weevil</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The enemy party member chewing move, if all other conditions applies, has a 8/10 chance to occur instead of 5/10</li> <li>In the enemy party member chewing move, this enemy now gets healed their <code>hp</code> to their <code>maxhp</code> instead of 5 <code>hp</code></li> <li>In the player party member chewing move, the odds to gain an AttackUp conditions if it wasn't already inflicted changes to 5/10 from 3/10</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target chewing attack</li> <li>Chews on the first Seedling, AngryPlant or FlyTrap among the enemy party which defeats them, but drains their <code>hp</code></li> </ol> <p>Move 2 is always used if all of the following conditions are fufilled:</p> <ul> <li>HPPercent is less than 0.65</li> <li>A 5/10 RNG check passes (8/10 instead if hardmode is true)</li> <li>A Seedling, AngryPlant or FlyTrap is present among the enemy party</li> <li>The applicable enemy party member's position is <code>Ground</code></li> </ul> <p>If these conditions aren't all fufilled, move 1 is always used instead.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/#pre-move-logic","title":"Pre move logic","text":"<p>Before the move, the first <code>enemydata</code> index who is a Seedling, AngryPlant or FlyTrap is obtained if one exists. This is done to both check if move 2 can be used and also to get the right <code>enemydata</code> index for it.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/#move-1-chewing-attack-on-player-party-member","title":"Move 1 - Chewing attack on player party member","text":"<p>A single target chewing attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If this enemy doesn't already have the AttackUp condition and a 3/10 RNG check passes (5/10 instead if hardmode is true):<ul> <li>Camera moves to look near this enemy zoomed in</li> <li><code>WeevilAwoo</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.8 seconds</li> <li>StatEffect called with type 0 (red up arrow)</li> <li>SetCondition called to inflict the AttackUp condition on this enemy for 2 main turns</li> <li>Yield for 0.75 seconds</li> </ul> </li> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playertargetentitiy</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.0, 0.0, -0.1) at 2.0 multiplier using 23 (<code>Chase</code>) as walkstate and 103 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>playertargetentity</code>'s y <code>spin</code> set to 15.0</li> <li>Done 4 times:<ul> <li>position set to (<code>playertargetentity</code> x position +/- 1.5, 0.0, <code>playertargetentity</code> z position - 0.1). The x position offset is -1.5 on the first and third time while it's +1.5 on the second and fourth time</li> <li>FaceTowards <code>playertargetentity</code></li> <li><code>sprite</code> angles set to its FlipAngle</li> <li><code>Chew</code> sound plays with volume 1.1 + 0.1 * the 0 based index of this loop</li> <li>For the next 10.0 frames, <code>playertargetentity</code> animstate is set to 11 (<code>Hurt</code>) unless <code>blockcooldown</code> hasn't expired where it's set to 24 (<code>Block</code>) instead</li> </ul> </li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li>SetDefaultCamera called</li> <li><code>flip</code> set to true</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.2 seconds</li> <li>MoveTowards startp at 2.0 multiplier using 23 (<code>Chase</code>) as walkstate and 0 (<code>Idle</code>) as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> set to false</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/#move-2-chewing-attack-on-seedling-angryplant-or-flytrap-enemy-party-member","title":"Move 2 - Chewing attack on Seedling, AngryPlant or FlyTrap enemy party member","text":"<p>Chews on the first Seedling, AngryPlant or FlyTrap among the enemy party which defeats them, but drains their <code>hp</code>. No damages are dealt to the player party and for the enemy party members, nothing happens through the damage pipeline (everything is done manually).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Weevil/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>playertargetentity</code> is set to the targetted enemy party member</li> <li>Emoticon called with the <code>Exclamation</code> emote with a time of 30</li> <li>Yield for 0.6 seconds</li> <li>Camera moves to look near <code>playertargetentitiy</code></li> <li>MoveTowards <code>playertargetentity</code> position + (1.0, 0.0, -0.1) at 2.0 multiplier using 23 (<code>Chase</code>) as walkstate and 103 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>playertargetentity</code>'s y <code>spin</code> set to 15.0</li> <li>Done 4 times:<ul> <li>position set to (<code>playertargetentity</code> x position +/- 1.5, 0.0, <code>playertargetentity</code> z position - 0.1). The x position offset is -1.5 on the first and third time while it's +1.5 on the second and fourth time</li> <li>FaceTowards <code>playertargetentity</code></li> <li><code>sprite</code> angles set to its FlipAngle</li> <li><code>Chew</code> sound plays with volume 1.1 + 0.1 * the 0 based index of this loop</li> <li>For the next 10.0 frames, <code>playertargetentity</code> animstate is set to 11 (<code>Hurt</code>)</li> </ul> </li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li>SetDefaultCamera called</li> <li><code>flip</code> set to true</li> <li><code>Damage0</code> sound plays</li> <li>HitPart particles played at <code>playertargetentity</code> + Vector3.up</li> <li>Heal called to heal this enemy for 5 <code>hp</code> (to its <code>maxhp</code> instead if hardmode is true which heals them to full)</li> <li>The targeted enemy party member's <code>hp</code> is set to 0</li> <li>The targeted enemy party member's <code>exp</code> is set to 0</li> <li>The targeted enemy party member's <code>money</code> is set to 0</li> <li>Yield for 0.2 seconds</li> <li>MoveTowards startp at 2.0 multiplier using 23 (<code>Chase</code>) as walkstate and 0 (<code>Idle</code>) as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>flip</code> set to false</li> <li>StartDeath is called on the targetted enemy party member which ends up setting its <code>deathcoroutine</code> to a new Death call with activatekill followed by a frame yield.</li> </ul> <p>NOTE: The StartDeath call doesn't do everything that CheckDead was supposed to do outside of the bestiary change and rewards setup (which were undesired already). Here are what is omitted to be done:</p> <ul> <li>DestroyConditionIcons is not called on the targetted enemy party member's battleentity. This allows them to be rendered for a very brief moment before their death and eventual destruction which normally wouldn't happen since they would be destroyed before their death process happens</li> <li>If the enemy party member had any <code>holditem</code>, they aren't dropped via DropItem</li> <li>If the enemy party member had an eventondeath, it is not triggered</li> </ul> <p>However, if the enemy party member's deathtype doesn't end with their destructions, some information that was supposed to be cleared will be persisted:</p> <ul> <li><code>charge</code> isn't zeroed out</li> <li>condition aren't cleared</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/","title":"<code>WildChomper</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The odds to summon a new FlyTrap enemy in the pre move logic when this enemy is the last <code>enemydata</code> remaining changes to 51% from 36%</li> <li>In the seeds throw move, there is now a 5/10 chance for the property of each DoDamage calls to be Poison</li> <li>In the seeds throw move, the amount of seeds to throw changes to be random between 2 and 3 inclusive instead of being random between 1 and 3 inclusive</li> <li>In the seeds throw move, the amount of frames each seed takes to reach its target changes to 35.0 frames from 41.0 frames</li> <li>The vine attack move may hit twice instead of only once</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A multiple target seeds throw</li> <li>A single target vine attack that may hit multiple times</li> </ol> <p>The decision of which move to use is based on the following odds:</p> Move Odds 1 3/5 2 2/5"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen before any move is used if this enemy is the last <code>enemydata</code> remaining and a 36% RNG check passes (51% instead if hardmode is true):</p> <ul> <li>A Vector3 is attempted to be generated that will corresponds to the position to spawn the new enemy. Each attempt may fail, but up to 20 attempts will be done and the first one that fufills some conditions will be used. Each attempts generates a vector where the x component is between 0.25 and 7.0, the y component is 0.0 and the z component is between -0.75 and 0.75. For the location to be accepted, any enemy part member needs to be located at a distance less than its <code>size</code> * 1.75. If no suitable locations is found after 20 attempts, the logic will not proceed and move selection is done immeditately</li> <li>If a suitable location is found:<ul> <li>animstate set to 100</li> <li><code>Clomp</code> sound plays</li> <li>Camera moves to look near this enemy + 1.0 in y</li> <li>Yield for 0.5 seconds</li> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with 0.1 ammount and 0.65 time</li> <li>Yield for 0.65 seconds</li> <li>Camera moves to look near the location</li> <li><code>Charge</code> sound plays</li> <li>DeathSmoke particles plays at the location</li> <li><code>checkingdead</code> is set to a new NewEnemy call to a summon a FlyTrap with the <code>SeedMini</code> animation at the location</li> <li>Yield for a frame</li> <li><code>enemydata[lastaddedid]</code> gets some adjustements:<ul> <li>z position: 0.0</li> <li><code>locktri</code>: true (prevents them to summon another <code>FlyTrap</code>)</li> <li>If <code>cotunknown</code> is false, <code>spritebasecolor</code> is set to pure cyan</li> <li><code>exp</code>: divided by 2 floored</li> <li><code>hp</code> and <code>maxhp</code>: divided by 2 floored</li> <li>If <code>hologram</code> is false, <code>sprite</code>'s material's color is set to pure cyan</li> </ul> </li> <li>UpdateEntities called</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>SetDefaultCamera called</li> <li>Yield for 0.5 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen after a move is used if <code>hp</code> is less than <code>maxhp</code>:</p> <ul> <li>animstate set to 0 (<code>Idle</code>)</li> <li>SetDefaultCamera called</li> <li>Yield for 0.25 seconds</li> <li>Heal called to heal this enemy by 1 <code>hp</code></li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#move-1-seeds-throw","title":"Move 1 - Seeds throw","text":"<p>A multiple target seeds throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen 1 to 3 times inclusive determined randomly (2 to 3 times inclusive instead if hardmode is true), but the call and no further calls happen if GetRandomAvaliablePlayer with nullable returns -1 This enemy GetRandomAvaliablePlayer with nullable<sup>1</sup> (target changes for each calls) 3 null (Poison instead if hardmode is true and a 5/10 RNG check passes) null <code>commandsuccess</code> <p>1: This targetting scheme is broken. See the nullable GetRandomAvaliablePlayer documentation for more details.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The property of the DoDamage 1 call is determined. It's null, but if hardmode is true and a 5/10 RNG check passes, it's Poison instead</li> <li><code>checkingdead</code> is set to a new SpiSeed coroutine call which will set <code>checkingdead</code> to null when done</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>Here is what the coroutine ends up doing:</p> <ul> <li>animstate set to 100</li> <li>Camera moves to look near <code>partymiddle</code></li> <li><code>Clomp</code> sound plays</li> <li>Yield for 0.25 seconds</li> <li>A new sprite object is created rooted offscreen at 999.0 in y using the <code>HardSeed</code> item sprite with a SpinAround that has an <code>itself</code> of 20.0 in z</li> <li>The amount of hits is determined. It's random between 1 and 3 inclusive (between 2 and 3 instead if hardmode is true)</li> <li>For each hit to do as long as GetRandomAvaliablePlayer with nullable doesn't return -1 (result stored in <code>playertargetID</code>):<ul> <li><code>playertargetentity</code> is manually set to <code>playerdata[playertargetID]</code>'s battleentity</li> <li>animstate set to 100</li> <li>Yield for 0.35 seconds</li> <li>animstate set to 102</li> <li>Yield for 0.2 seconds</li> <li>The <code>HardSeed</code> position set to this enemy + (-2.0, 1.25, -0.1)</li> <li>Over the course of 41.0 frames (35.0 frames instead if hardmode is true), <code>HardSeed</code> moves to <code>playertargetentity</code> position + (0.0, 1.0, -0.1) via a lerp. During the second half of the movement, if this isn't the last hit, animstate is set to 101</li> <li><code>HardSeed</code> moves offscreen at 999.0</li> <li>DoDamage 1 call happens</li> </ul> </li> <li><code>HardSeed</code> gets destroyed</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to null which signals the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#move-2-vine-attack","title":"Move 2 - Vine attack","text":"<p>A single target vine attack that may hit multiple times.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0. Done once if hardmode is false, from 1 to 2 times if it is true as long as <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0 This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) 3 on the first hit, 2 on the second hit Pierce<sup>1</sup> null <code>commandsuccess</code> <p>1: Enemy piercing damages are disabled so this property does nothing, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/WildChomper/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 100</li> <li>Yield for 0.65 seconds</li> <li><code>checkingdead</code> is set to a new VineAttack coroutine with 2 damageamt, actionid as the callerid without gettarget. The coroutine will set <code>checkingdead</code> to null upon completion</li> <li>Yield all frames until <code>checkingdead</code> goes to null</li> </ul> <p>This is what the coroutine effectively ends up doing:</p> <ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Camera moves to look near <code>playertargetentity</code></li> <li>The amount of hits is determined. It is 1 if hardmode is false and if it's true, it's random between 1 and 2</li> <li>An array of <code>Prefabs/Objects/VenusRoot</code> are instantiated with the amount being the amount of hits to do at (<code>playertargetentity</code> x position + a random number between -2.0 and 2.0, -5.0, <code>playertargetentity</code> z position). Each instance is set to LookAt the <code>playertargetentity</code> and has its initial position incremented by (random between -1.0 and 1.0, 0.0, -0.15)</li> <li>An array of Vector3 are instantiated with the amount being the amount of hits to do with each being the normalised direction vector from <code>playertargetentity</code> to the matching <code>Prefabs/Objects/VenusRoot</code> element</li> <li>Yield for 0.75 seconds</li> <li>For each hit:<ul> <li><code>Charge8</code> sound plays</li> <li>Over the course of 10.0 frames, the matching <code>Prefabs/Objects/VenusRoot</code> position lerps to its position + the matching heading direction vector * 5.0. The first time reaching the 5th frame or later when <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0, DoDamage 1 call happens before the frame yield</li> <li>Yield for 0.5 seconds</li> <li>If this is the last hit:<ul> <li><code>Rumble3</code> sound plays</li> <li>ShakeScreen called with an ammount of (0.1, 0.05, 0.0), time of 0.75 with dontreset</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>The amount of damage to deal on the next hit becomes half of this one's damage floored then clamped from 1 to 99</li> </ul> </li> <li>Over the course of 60.0 frames, all <code>Prefabs/Objects/VenusRoot</code> instances has ther scale lerped to Vector3.zero</li> <li>Yield a frame</li> <li>All <code>Prefabs/Objects/VenusRoot</code> instances gets destroyed</li> <li><code>checkingdead</code> set to null which informs the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/","title":"<code>Yin</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#assumptions","title":"Assumptions","text":"<p>This enemy is assumed to not be fought alone because if they are fought alone, they will always immediately kills themselves on their first actor turn which is unexpected.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#a-note-about-misshandling-of-the-target-field","title":"A note about misshandling of the <code>target</code> field","text":"<p>This enemy always writes to the <code>target</code> field, but they aren't supposed to because this field is reserved for the player party's targetting. The field is never supposed to be used for an enemy party member, but this one does and it can overwrite its value.</p> <p>However, it turns out that this is inconsequential. Due to how GetChoiceInput and GotoSelect works in the player UI system, it's not possible to poison DoAction by leaving <code>target</code> with an illogical value. There is an extremely narrow cause where the HardCharge and Sturdy actions may leave <code>target</code> to the value this enemy set, but doing so will have no effect on the logic of DoAction.</p> <p>Effectively, while this field is used when it shouldn't on this eneny, it has no consequential impact on the rest of the battle system. The field that should have been used for this purpose is either a local or <code>playertargetID</code> which is designed to hold the enemy's targetting and it is constantly written to before usage for most enemies.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>After loading this enemy, the following special adjustements happens to them if flags 614 is true (HARDEST is active):</p> <ul> <li><code>maxhp</code> and <code>hp</code> gets increased by 10</li> <li><code>def</code> gets incremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#move-selection","title":"Move selection","text":"<p>6 moves are possible:</p> <ol> <li>Calls ClearStatus on another enemy party member</li> <li>Heal another enemy party member by 5 <code>hp</code></li> <li>Gives the AttackUp condition on another enemy party member</li> <li>Gives the DefenseUp condition on another enemy party member</li> <li>Does nothing</li> <li>Kills themselves</li> </ol> <p>Move 6 is always (and only) used if they are the last <code>enemydata</code> remaining.</p> <p>For for move 1 through 4, the decision of which moves to use is complex and it involves checking every enemy party members to select a receiver and the move to use on them. Each are checked in <code>enemydata</code> order to see if one of these 4 moves can be used on them. Each moves has requirements that must be fufilled on the potential receiver and it may also require an RNG check or for the potential receiver to not be this enemy. For each receiver, each requirement and RNG check are done in move order (meaning move 1 has the highest priority per receiver while move 4 has the lowest).</p> <p>Here is a table that summarises all of these requirements:</p> Move Receiver requirement RNG check required? Receiver can be this enemy? 1 The receiver is stopped or they have the Poison condition while their <code>hp</code> is above 0 No, the move is always used if the receiver requirement is met Yes<sup>1</sup> 2 The receiver's HPPercent is lower than 0.65 Yes, 50% chance to pass Yes 3 The receiver doesn't already have the AttackUp condition Yes, 50% chance to pass No 4 The receiver doesn't already have the DefenseUp condition Yes, 50% chance to pass No <p>1: Practically, being able to cure conditions on themselves only matters if this eneny has the Poison condition because if this enemy is stopped, they wouldn't have been able to perform this action.</p> <p>If a receiver is found, the move will be used with the receiver being the enemy party members that gets the benefit of the move.</p> <p>If no receivers could be found (which typically happens if all the RNG checks applicable failed), move 5 is used.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#move-1-clearstatus-on-another-enemy-party-member","title":"Move 1 - ClearStatus on another enemy party member","text":"<p>Calls ClearStatus on another enemy party member. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#logic-sequence","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li><code>Magic</code> sound plays</li> <li><code>MagicUp</code> particles plays at this enemy position</li> <li>y <code>spin</code> set to 15.0</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>spin</code> zeroed out</li> <li>The selected receiver's <code>spin</code> is zeroed out</li> <li>DeathSmoke particles plays at the receiver position with 2.0x size</li> <li><code>Heal3</code> sound plays</li> <li>ClearStatus is called on the receiver</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#move-2-heal-another-enemy-party-member-by-5-hp","title":"Move 2 - Heal another enemy party member by 5 <code>hp</code>","text":"<p>Heal another enemy party member by 5 <code>hp</code>. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li><code>Magic</code> sound plays</li> <li><code>MagicUp</code> particles plays at this enemy position</li> <li>y <code>spin</code> set to 15.0</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>spin</code> zeroed out</li> <li>The selected receiver's <code>spin</code> is zeroed out</li> <li>Heal called to heal the receiver by 5 <code>hp</code></li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#move-3-gives-attackup-condition-on-another-enemy-party-member","title":"Move 3 - Gives AttackUp condition on another enemy party member","text":"<p>Gives the AttackUp condition on another enemy party member. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>The selected receiver's y <code>spin</code> is set to 15.0</li> <li>animstate set to 100</li> <li><code>Magic</code> sound plays</li> <li><code>MagicUp</code> particles plays at this enemy position</li> <li>y <code>spin</code> set to 15.0</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>spin</code> zeroed out</li> <li>The selected receiver's <code>spin</code> is zeroed out</li> <li>StatusEffect called to inflict the AttackUp condition on the receiver for 3 main turns with effect</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#move-4-gives-defenseup-condition-on-another-enemy-party-member","title":"Move 4 - Gives DefenseUp condition on another enemy party member","text":"<p>Gives the DefenseUp condition on another enemy party member. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>The selected receiver's y <code>spin</code> is set to 15.0</li> <li>animstate set to 100</li> <li><code>Magic</code> sound plays</li> <li><code>MagicUp</code> particles plays at this enemy position</li> <li>y <code>spin</code> set to 15.0</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>spin</code> zeroed out</li> <li>The selected receiver's <code>spin</code> is zeroed out</li> <li>StatusEffect called to inflict the DefenseUp condition on the receiver for 3 main turns with effect</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#move-5-does-nothing","title":"Move 5 - Does nothing","text":"<p>Does nothing. No damages are dealt</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li><code>target</code> is set to a random <code>enemydata</code> index and it is rerolled if it matches this enemy or if the enemy party memebr is stopped. It should be noted that not only it is guaranteed that no other enemy party members is stopped by this point, but that this doesn't do anything. <code>target</code> cannot influence anything by changing it so this entire logic doesn't do anything significant</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#move-6-kills-themselves","title":"Move 6 - Kills themselves","text":"<p>Kills themselves. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Yin/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li>Done 2 times:<ul> <li>ForceMove called to move this enemy + 1.0 in x with 45.0 frametime using 101 as movestate and 103 as stopstate</li> <li>Yield for 1 second</li> <li>Yield for 0.25 seconds</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>FlipSimple called on this enemy</li> <li>Yield for 0.1 seconds</li> <li>startp set to (15.0, 0.0, 0.0)</li> <li>ForceMove called to move this enemy to startp with 60.0 frametime using 102 as movestate and stopstate</li> <li><code>exp</code> set to 0</li> <li><code>hp</code> set to 0 (this will cause CheckDead to kill this enemy later)</li> <li>deathtype set to 0</li> <li><code>destroytype</code> set to None</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/","title":"<code>Zasp</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#assumptions","title":"Assumptions","text":"<p>This enemy is meant to function with a another <code>enemydata</code> one due to their hitaction logic that changes when they are the only one left in <code>enemydata</code>. It is meant that this enemy's chargeonotherenemy has the id of this second enemy. Under normal gameplay, this should be Mothiva1.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#startbattle-special-logic","title":"StartBattle special logic","text":"<p>After this enemy is loaded on StartBattle, if flags 606 is true (won the second round of the Colosseum), the following happens on this enemy:</p> <ul> <li><code>hp</code> and <code>maxhp</code> are increased by 15</li> <li><code>hardatk</code> is incremented</li> <li><code>lockrelayreceive</code> is set to true</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 1 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: This value does nothing, but it was supposed to prevent to use the taunt move again after it had been used in earlier in the same main turn (which would have been tracked by this value being 1). It is only set to 1 at the end of using the taunt move. However, it is always set to 0 after using any move or <code>hitaction</code> meaning it never performs an action without being set to 0 so it effectively cancels out the set to 1 if it happened. This means that this value does nothing and this enemy can use their taunt move multiple times in a row or even in one main turn if hardmode is true</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the the strike attack move, the amount of hit changes to be from 1 to 3 inclusive instead of being from 1 to 2 inclusive</li> <li>The taunt move will now always decrement <code>cantmove</code> which gives this enemy an additional actor turn after this one</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#hitaction-support","title":"hitaction support","text":"<p>This enemy supports <code>hitaction</code> logic and it will be performed when <code>hitaction</code> is true instead of any moves</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>The <code>hitaction</code> logic always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#logic-sequence","title":"Logic sequence","text":"<p>The following logic is performed instead of any moves:</p> <ul> <li>animstate set to 111</li> <li>Emoticon called with the <code>Exclamation</code> emote for 35 time</li> <li><code>Wam</code> sound plays</li> <li>Yield all frames until <code>emotioncooldown</code> expires</li> <li>animstate set to 106</li> <li><code>StatUp</code> sound plays</li> <li>If this is the only enemy left in <code>enemydata</code>:<ul> <li>SetCondition called to inflict the AttackUp condition on this enemy for 999999 main turns (effectively infinite)</li> <li>StatEffect called with type 0 (red up arrow)</li> <li><code>BugWingFast</code> sound plays</li> </ul> </li> <li>Otherwise, if <code>charge</code> is less than 1:<ul> <li><code>charge</code> is incremented</li> <li>StatEffect called with type 4 (green up arrow)</li> </ul> </li> <li>Yield for 0.65 seconds</li> <li><code>data[0]</code> set to 0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#move-selection","title":"Move selection","text":"<p>4 moves are possible:</p> <ol> <li>A multiple target warp strike attack done multiple times</li> <li>A multiple target needle throw done multiple times</li> <li>A single target taunt inflicting the Taunted condition</li> <li>Uses a <code>VitalitySeed</code> item to get the AttackUp condition</li> </ol> <p>The decision of which move to use is based on odds. However, some moves has additional requirements that must be fufilled for the move to be used once it is selected. If the move is selected, but the requirements aren't fufilled, a continue directive is issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection process. Here are all these informations for all moves:</p> Move Odds Requirements 1 4/12 None, the move is always used once selected 2 3/12 None, the move is always used once selected 3 2/12 <ul><li><code>data[0]</code> is 0 or below (this is alwaus the case, see the <code>data</code> usage section above for why)</li><li>This enemy doesn't already have the Taunted condition</li><li>HPPercent is 0.2 or above</li></ul> 4 3/12 <ul><li>This enemy doesn't already have the AttackUp condition</li><li>HPPercent is between 0.2 and 0.65 inclusive"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#post-move-logic","title":"Post move logic","text":"<p>After using any move, the folowing is always done:</p> <ul> <li><code>sprite</code> enabled</li> <li><code>overrideanim</code> set to false</li> <li><code>rigid</code> has its gravity enabled without kinematic</li> <li><code>onground</code> set to true</li> <li><code>data[0]</code> set to 0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#move-1-warp-strike-attacks","title":"Move 1 - Warp strike attacks","text":"<p>A multiple targets warp strike attack done multiple times</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happens 2 times (3 times instead if hardmode is true), but each calls requires that there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) This enemy <code>playertargetID</code> after GetSingleTarget (changes for each calls) 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li><code>specialanim</code> set to a new disappearing ZaspWarp coroutine</li> <li>Yield all frames until <code>specialanim</code> goes to null (the coroutine completed)</li> <li>The amount of hits is generated being uniformly random between 1 and 2 (between 1 and 3 instead if hardmode is true)</li> <li>For each hits, if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li>An offset vector is generated as follows (each has 50% chance):<ul> <li>Upper strike (-2.025 or 2.025 determined with a 50/50, 0.5, -0.1)</li> <li>Lower strike (-2.25 or 2.25 determined with a 50/50, 0.23, -0.1)</li> </ul> </li> <li><code>specialanim</code> set to a new appearing ZaspWarp coroutine with a pos of <code>playertargetentity</code> + the offset vector</li> <li>Yield a frame</li> <li>FaceTowards <code>playertargetentity</code></li> <li>Yield all frames until <code>specialanim</code> goes to null (the coroutine completed)</li> <li>animstate set to 102 if it was an upper strike, 107 if it was a lower strike</li> <li><code>Toss3</code> sound plays</li> <li>Yield for 0.15 seconds</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> <li><code>specialanim</code> set to a new disappearing ZaspWarp coroutine</li> <li>Yield all frames until <code>specialanim</code> goes to null (the coroutine completed)</li> </ul> </li> <li><code>specialanim</code> set to a new appearing ZaspWarp coroutine with a pos of startp</li> <li>Yield a frame</li> <li><code>flip</code> set to false</li> <li>Yield all frames until <code>specialanim</code> goes to null (the coroutine completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#move-2-needle-throws","title":"Move 2 - Needle throws","text":"<p>A multiple targets needle throw done multiple times</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on any targets.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happens 3 times, but each calls requires that there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby) 2 null This enemy <code>playertargetID</code> after GetSingleTarget (changes for each calls) A new GameObject named <code>needle</code> rooted with a SpriteRenderer using the <code>projectilepsrites[2]</code> (needle sprite) positioned at this enemy position + (-1.0, 1.0, 0.1) with a z angle of -50.0 0.04 (25 frames of movement) 0.0 null null null null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 2 (<code>Jump</code>)</li> <li><code>Spin</code> sound plays on loop using <code>sounds[9]</code></li> <li><code>Woosh</code> sound plays</li> <li>Over the course of 10.0 frames, this enemy moves to startp + 3.5 in y via a lerp</li> <li>The amount of hits is generated being uniformly random between 1 and 3</li> <li>For each hits if there's at least 1 player party member alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget called</li> <li><code>sounds[9]</code> volume set to MainManager.<code>soundvolume</code></li> <li>position offset by (-0.35, 1.15, 0.0)</li> <li>animstate set to 101</li> <li>z <code>spin</code> set to 30.0</li> <li>Yield for 0.5 seconds</li> <li><code>sounds[9]</code> volume set to 0.0</li> <li>animstate set to 102</li> <li>position set to the one before this hit</li> <li><code>spin</code> zeroed out</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>Yield for 0.15 seconds</li> <li>A new GameObject called <code>needle</code> is created rooted with a SpriteRenderer using the <code>projectilepsrites[2]</code> sprite (needle) with -50.0 z angle positioned at this enemy position + (-1.0, 1.0, 0.1)</li> <li><code>Toss</code> sound plays</li> <li>Projectile 1 call happens</li> <li>Yield all frames until <code>needle</code> is null (destroyed as the Projectile coroutine completed)</li> </ul> </li> <li>animstate set to 101</li> <li>z <code>spin</code> set to 20.0</li> <li>Over the course of 15.0 frames, position lerped to startp + 3.5 in y</li> <li><code>sounds[9]</code> stopped</li> <li>position set to startp</li> <li>animstate set to 103</li> <li><code>spin</code> zeroed out</li> <li><code>sprite</code> angles reset to Vector3.zero</li> <li>Yield for 0.45 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#move-3-taunt","title":"Move 3 - Taunt","text":"<p>A single target taunt inflicting the Taunted condition. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#dontusecharge-set-to-true_1","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>animstate set to 108</li> <li><code>Taunt2</code> sound plays on loop using <code>sounds[9]</code></li> <li>Yield for 0.85 seconds</li> <li>SetCondition called to inflict the Taunted condition on <code>playerdata[playertargetID]</code> for 2 turns (effectively 1 since the main turn gets advanced soon)</li> <li><code>Taunt</code> sound plays</li> <li>animstate of <code>playertargetentity</code> set depending on <code>playertargetID</code> (their <code>trueid</code>)<ul> <li>0 (<code>Bee</code>): 10 (<code>Flustered</code>)</li> <li>1 (<code>Beetle</code>): 5 (<code>Angry</code>)</li> <li>2 (<code>Moth</code>): 102</li> </ul> </li> <li><code>Prefabs/Particles/AngryParticle</code> instantiated childed to <code>playertargetentity</code> with local position being Vector3.up</li> <li>Yield for 0.85 seconds</li> <li><code>sounds[9]</code> stopped</li> <li>animstate set to 8 (<code>Happy</code>)</li> <li>Yield for 0.85 seconds</li> <li><code>Prefabs/Particles/AngryParticle</code> destroyed</li> <li><code>playertargetentity</code> animstate restored to its value before this action</li> <li>If hardmode is true, <code>cantmove</code> is decremented (gives an additional actor turn to this enemy immediately)</li> <li><code>data[0]</code> set to 1 (this does nothing, see the <code>data</code> usage section for why)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#move-4-uses-a-vitalityseed-item","title":"Move 4 - Uses a <code>VitalitySeed</code> item","text":"<p>Uses a <code>VitalitySeed</code> item to get the AttackUp condition. No Damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#dontusecharge-set-to-true_2","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zasp/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>animstate set to 4 (<code>ItemGet</code>)</li> <li><code>ItemHold</code> sound plays</li> <li>A new GameObject with a SpriteRenderer is created rooted using the <code>VitalitySeed</code> item sprite positioned near this enemy</li> <li>Yield for a second</li> <li>The item GameObject is destroyed</li> <li>animstate set to 106</li> <li><code>Magic</code> sound plays</li> <li>y <code>spin</code> set to 20.0</li> <li>Yield for 0.75 seconds</li> <li>StatEffect called with type 0 (red up arrow)</li> <li><code>StatUp</code> sound plays</li> <li>SetCondition called to inflict the AttackUp condition on this enemy for 3 turns (effectively 2 since the main turn gets advanced soon)</li> <li><code>spin</code> zeroed out</li> <li>Yield for 0.75 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/","title":"<code>Zombee</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The move usage odds changes to favor more the darts throws move</li> <li>In the darts throws move, the speed of each projectile changes to 21.0 from 32.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A single target double slash</li> <li>A multiple targets triple darts throws</li> </ol> <p>The decision of which move to use are based on the following odds which changes based on if hardmode is true or not:</p> Move Odds when hardmode is false Odds when hardmode is true 1 59% 39% 2 41% 61%"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#move-1-double-slash","title":"Move 1 - Double slash","text":"<p>A single target double slash.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#basicattack-calls","title":"BasicAttack calls","text":"# Conditions enemyid walkstate attackstate attackstate2 damage offset property shake delay sounds dontgettarget 1 Always happen This enemy 1 (<code>Walk</code>) 100 102 2 (1.25, 0.0, -0.1) Poison 0.0 0.5 seconds <code>,Toss7</code> false 2 Always happen after BasicAttack 1 This enemy 1 (<code>Walk</code>) 102 103 2 (1.25, 0.0, -0.1) Sleep 0.0 0.2 seconds <code>,Toss8</code> true"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> set to the BasicAttack 1 call</li> <li>Yield all frames until <code>checkingdead</code> is null (BasicAttack 1 completed)</li> <li><code>checkingdead</code> set to the BasicAttack 2 call</li> <li>Yield all frames until <code>checkingdead</code> is null (BasicAttack 2 completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#move-2-triple-darts-throws","title":"Move 2 - Triple darts throws","text":"<p>A multiple targets triple darts throws.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 3 times, but each calls requires to have at least 1 player party member whose <code>hp</code> is above 0 and not eatenby 3 Sleep This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new sprite object using the <code>projectilepsrites[2]</code> sprite (spiky projectile) positioned at this enemy + (-1.0, 1.0, -0.1) with a pure gray color and a z angle of -90.0 32.0 (21.0 instead if hardmode is true) 0.0 null null null null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombee/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>Done 3 times:<ul> <li>If there isn't at least 1 player party member whose <code>hp</code> is above 0 and not eatenby, this action ends prematurely</li> <li>GetSingleTarget called</li> <li><code>Rope</code> sound plays</li> <li>Camera moves to look near the midpoint between this enemy and <code>playertargetentity</code></li> <li>animstate set to 28 (<code>TossItem</code>)</li> <li>Yield for 0.5 seconds</li> <li><code>Toss</code> sound plays</li> <li>A new sprite object is created using the <code>projectilepsrites[2]</code> sprite (spiky projectile) positioned at this enemy + (-1.0, 1.0, -0.1) with a pure gray color and a z angle of -90.0</li> <li>DoProjectile 1 call happens</li> <li>Yield for 0.33 seconds</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>Yield all frames until the sprite object is null (Projectile 1 completed)</li> <li>Yield for 0.5 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/","title":"<code>Zombeetle</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The move usage odds changes to favor more the party wide dash move</li> <li>In the dash move, the amount of frames the entire dash takes changes to 25.0 from 33.0</li> <li>In the boulder throw move, the amount of frames the boulder takes to reach its targer changes to 41.0 from 54.0</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#move-selection","title":"Move selection","text":"<p>2 moves are possible:</p> <ol> <li>A party wide dash attack</li> <li>A single target boulder throw that has a secondary hit that targets the other player party members</li> </ol> <p>The decision of which move to use are based on the following odds which changes based on if hardmode is true or not:</p> Move Odds when hardmode is false Odds when hardmode is true 1 69% 59% 2 31% 41%"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#move-1-party-wide-dash","title":"Move 1 - Party wide dash","text":"<p>A party wide dash attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 Flip<sup>1</sup> <code>commandsuccess</code> 0.0 Vector3.zero false null <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#logic-sequence","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called (but it will have no impact on this move)</li> <li><code>checkingdead</code> is set to a new BeetleDash coroutine with the following parameters (<code>checkingdead</code> is set to null when completed):<ul> <li>enemyid: This enemy</li> <li>damage: 4</li> <li>animprepare: 100</li> <li>animdash: 23 (<code>Chase</code>)</li> <li>startp: startp</li> <li>speed: 33 (25 instead if hardmode is true)</li> </ul> </li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the coroutine effectively ends up doing:</p> <ul> <li><code>playertargetID</code> set to -1</li> <li>Camera moves slightly to the left</li> <li>MoveTowards (-0.5, 0.0, 0.0) at 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>Charge3</code> sound plays using <code>sounds[9]</code> with 1.2 pitch</li> <li>animstate set to 100</li> <li>ShakeSprite called with (0.25, 0.0, 0.0) intensity and 60.0 frametimer</li> <li>Over the course of 41.0 frames, this enemy moves 2.0 to the left via a lerp</li> <li>ShakeSprite called with 0.1 intensity and 40.0 frametimer</li> <li>Yield for 41.0 frames counted by framestep</li> <li><code>sounds[9]</code> stopped</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li><code>trail</code> set to true</li> <li><code>FastWoosh</code> sound plays</li> <li>Over the course of 34 frames (26 frames instead if hardmode is true), this enemy moves to (-15.0, 0.0, 0.0) via a lerp. On the first frame that the x position is less than -4.5, the following happens only once:<ul> <li>ShakeScreen called with an ammount of (0.25, 0.0, 0.0) for 0.65 time with dontreset</li> <li><code>HugeHit</code> sound plays</li> <li>PartyDamage 1 call happens</li> </ul> </li> <li>position set to (15.0, 0.0, 0.0)</li> <li><code>trail</code> set to false</li> <li>SetDefaultCamera called</li> <li>animstate set to 1 (<code>Walk</code>)</li> <li>Over the course of 61.0 frames, this enemy moves to startp via a lerp while having its animstate set to 1 (<code>Walk</code>)</li> <li><code>checkingdead</code> set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#move-2-boulder-throw","title":"Move 2 - Boulder throw","text":"<p>A single target boulder throw that has a secondary hit that targets the other player party members.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code> 2 Always happen for each other player party members than DoDamage 1's target whose <code>hp</code> is above 0 This enemy The player party member 2 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zombeetle/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called (but it will have no impact on this move)</li> <li>MoveTowards (1.5, 0.0, -0.5) with a 2.0 multiplier using 1 (<code>Walk</code>) as the walkstate and 101 as the stopstate</li> <li>Camera moves to look near <code>forcetarget</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>ShakeSprite called with intensity 0.05 and 30.0 frametimer</li> <li><code>Dig2</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>A new <code>Prefabs/Objects/CrackedRock</code> GameObject is created without its MeshCollider and Fader at this enemy position +  (-1.0, -2.0, -0.1) a scale of 0.5x and a z angle of 35.0</li> <li>animstate set to 102</li> <li><code>DirtExplode</code> particles played at the <code>Prefabs/Objects/CrackedRock</code> position except for the y component which is 0.0</li> <li><code>DigPop</code> sound plays with a pitch of 0.9</li> <li>ShakeScreen called with an ammount of 0.1 and a time of 0.5</li> <li><code>Toss9</code> sound plays</li> <li>Over the course of 21.0 frames, the <code>Prefabs/Objects/CrackedRock</code> moves to + 20.0 in y via a lerp and this enemy moves to + 1.5 in x via a lerp</li> <li>animstate set to 23 (<code>Chase</code>)</li> <li>Over the course of 31.0 frames, the <code>Prefabs/Objects/CrackedRock</code> moves to 1.0 in y via a lerp. On the first frame after 22.5 frames:<ul> <li><code>Toss7</code> sound plays</li> <li>ForceMove called to move this enemy to the <code>Prefabs/Objects/CrackedRock</code> position except for the y component where it's 0.0 with a framtime of 7.0 without changeanim</li> </ul> </li> <li><code>Damage0</code> sound plays</li> <li><code>Spin10</code> sound plays</li> <li>Camera moves to look near <code>playertargetentity</code> + 1.0 in y</li> <li>Over the course of 54.0 frames (41.0 frames instead if hardmode is true), the <code>Prefabs/Objects/CrackedRock</code> moves to + 1.0 in y via a BeizierCurve3 with a ymax of 7.0 and this enemy moves to + 2.0 in x via a BeizierCurve3 with a ymax of 3.0</li> <li>If there are more than 1 player party members, the ones other than <code>playertargetID</code> will be slated for getting the secondary hit. For each of them, a copy of the <code>Prefabs/Objects/CrackedRock</code> is intstantiated with halved scale</li> <li>A <code>Prefabs/Objects/CrackRockBreak</code> is instantiated with same position and scale as the <code>Prefabs/Objects/CrackedRock</code> (this gets destroyed in 60.0 seconds via the CrackRockBreak component attached to it) </li> <li><code>Prefabs/Objects/CrackedRock</code> is destroyed</li> <li><code>RockBreak</code> sound plays</li> <li>DoDamage 1 call happens</li> <li>animstate set to 0 (<code>Idle</code>)</li> <li>If the secondary hit was slated to occur to the other player party members:<ul> <li><code>playertargetID</code> set to -1</li> <li>Over the course of ~47.95652174 frames (~36.65217391 frames instead if hardmode is true), each <code>Prefabs/Objects/CrackedRock</code> moves to their matching player party memeber position + 1.0 in y via a BeizierCurve3 with a ymax of 5.0</li> <li><code>RockBreak</code> sound plays with 1.1 pitch and 0.75 volume</li> <li>For each player party members slated to receive the secondary hit:<ul> <li>Their matching <code>Prefabs/Objects/CrackedRock</code> gets destroyed</li> <li>If their <code>hp</code> is above 0, DoDamage 2 call happens with them</li> </ul> </li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/","title":"<code>ZombieRoach</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 4 element with a starting value of 0 for each element except <code>data[1]</code> where the starting value is 2.</p> <ul> <li><code>data[0]</code>: This tells the \"mode\" this enemy is on which drastically changes the move selection process because it changes the sets of move they can use. The value can only be 0 or 1 and it is toggled between the 2 when <code>data[1]</code> is 0 at the end of the action which will cause them to switch the current mode in the post move logic and have <code>data[1]</code> set back to 2 (meaning the current mode won't change until 2 main turns). Here are the details of the 2 modes:<ul> <li>0: Sand mode. Here are the moveset changes:<ul> <li>The energy spheres throw move is accessible, but not the single target ice attack move</li> <li>The moving sand attack move is accessible, but not the party wide icicle throw move</li> <li>When summoning an enemy, it will always be a SandWall</li> <li>After using a magic boost or heal, the energy spheres throw move will always be used</li> </ul> </li> <li>1: Ice mode. Here are the moveset changes:<ul> <li>The single target ice attack move is accessible, but not the energy spheres throw move </li> <li>The party wide icicle throw move is accessible, but not the moving sand attack move</li> <li>When summoning an enemy, it will always be an IceWall</li> <li>After using a magic boost or heal, the single target ice attack move will always be used</li> </ul> </li> </ul> </li> <li><code>data[1]</code>: This is the main turn cooldown before <code>data[0]</code> is toggled which causes a mode switch. Its starting value is 2 and it decreases at the end of their last actor turn of the main turn in the post move logic. When it reaches 0 after the decrement, <code>data[0]</code> is toggled between 0 and 1 which causes a mode change</li> <li><code>data[2]</code>: This is an actor turn cooldown that restricts the usage of the moving sand move and party wide icicle throw move. When the former is used, the value is set to 2 and when the latter is used, the value is set to 3. At the start of every actor turn in the pre move logic, the value decrements when it is above 0. For either moves to be selectable (whichever one is appropriate for the current mode), the value needs to be 0 after the decrement. However, this doesn't apply if this enemy's position is <code>Underground</code> as the moving sand move is always used in that case. It also doesn't completely prevent either move to be used if the enemy selects the wall enemy summon move while there is already one in <code>enemydata</code>. See the move selection section below for details</li> <li><code>data[3]</code>: Effectively UNUSED because while it is written to when this enemy heals themselves and it is decremented in the post move logic if it's higher than 0, it is never read meaning this value effectively doesn't do anything</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>The HPPercent threshold changes for getting a moves of 2 and a decremented <code>cantmove</code> (2 actor turns per main turns including the current one). It changes to be when it reaches lower than 0.5 from 0.33</li> <li>In the energy spheres throw move, the amount of projectiles to throw changes to be random between 2 and 3 inclusive instead of always being 2</li> <li>In the energy spheres throw move, the base damage dealt per each projectile changes to 2 from 3</li> <li>In the energy spheres throw move, the yield time before each Projectile calls changes to 0.5 seconds from 0.65 seconds</li> <li>In the energy spheres throw move, the speed of each projectile changes to 40.0 from 50.0</li> <li>In the single target ice attack move, the amount of frames the ice pillar takes to reach its target and appear changes to 71.0 frames from 81.0 frames</li> <li>In the moving sand attack move, the DoCommand call (which is a TappingKey) has <code>barfill</code> decrease 25% faster each frame. However, this change doesn't affect anything if <code>mashcommandalt</code> is true making the command a SequentialKeys</li> <li>In the moving sand attack move, the damageammount of each DoDamage calls changes to 0 from 1 (this doesn't mean the call no longer does damages because it is meant for the <code>hardatk</code> effect to apply which could deal a non zero amount of damages and the call also has AtLeast1Pierce which guarantees a non zero amount of damages)</li> <li>In the enemy summon move, <code>cantmove</code> gets decremented which grants an additonal actor turn to this enemy</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#move-selection","title":"Move selection","text":"<p>6 moves are possible:</p> <ol> <li>A multiple targets energy spheres throw</li> <li>A single target ice attack</li> <li>A single target moving sand attack that may hit multiple times and drain <code>hp</code></li> <li>A party wide icicle throw</li> <li>Summons a new SandWall or IceWall enemy</li> <li>Uses magic to boost or heal themselves, then performs move 1 or 2</li> </ol> <p>The move selection process is complex because it involves the current mode (see the <code>data[0]</code> explanation above), odds (which can change depending on <code>data[2]</code>) as well as some special cases.</p> <p>For the mode, it changes which pair of moves is usable amongst move 1 through 4 and it also decides the enemy to summon in move 5. The other pair is innacessible and will never be used until the mode toggles. Here is a table that summarises each mode (the starting mode is the sand mode):</p> Mode Moves accessible Enemy summoned on move 5 Sand <ul><li>1 - Energy spheres throw</li><li>3 - Moving sand attack</li></ul> SandWall Ice <ul><li>2 - Single target ice attack</li><li>4 - Party wide icicle throw</li></ul> IceWall <p>What's important is that move 1 and 2 as well as move 3 and 4 are viewed as the same during the move selection process. The actual move to use from each of these pairs is determined by the mode, but they still feature completely different logic which is why they are also documented as separate moves. For the sake of simplicity, each pair will be refered to as \"move 1-2\" and \"move 3-4\" since they are viewed the same way during the selection process.</p> <p>Next, the odds to use a move. Here are the base odds to use each move:</p> Move or pair Odds 1-2 2/7 3-4 2/7 5 1/7 6 2/7 <p>However, there are 2 special cases to this:</p> <ul> <li>If position is <code>Underground</code>, move 3-4 is always used (this should only and always be the case after using move 3 and in such case, move 3 will be used again)</li> <li>If move 3-4 was selected and <code>data[2]</code> is above 0 (after the decrement), the move can't be selected because the actor turn cooldown on it hasn't expired yet</li> </ul> <p>In that second case, the entire move selection is rerolled with different odds that don't include move 3/4. Here are those special odds:</p> Move or pair Odds 1-2 2/5 5 1/5 6 2/5 <p>Finally, move 5 may cause another move to be used instead once selected if there are more than 1 <code>enemydata</code> including this enemy (which means move 5 was used and the summoned enemy is still present). When this happens, move 1-2 or move 3-4 will be used which is determined by an RNG check with uniform probabilities (1/2 chance each).</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#pre-move-logic","title":"Pre move logic","text":"<p>The following logic always happen at the start of the action:</p> <ul> <li>If <code>data[2]</code> is above 0, it is decremented (this is the move 3-4 cooldown tracking)</li> </ul> <p>Next is a phase transition that happens if all of the following conditions are fufilled:</p> <ul> <li>BattlePosition isn't <code>Underground</code></li> <li>HPPercent is less than 0.33 (0.5 instead if hardmode is true)</li> <li>This enemy's moves is 1 (meaning this transition didn't happen yet)</li> </ul> <p>Here is what happens in the phase transition:</p> <ul> <li><code>Magic</code> sound plays</li> <li><code>MagicUp</code> particles plays at this enemy position</li> <li>animstate set to 100</li> <li>y <code>spin</code> set to 15.0</li> <li>Yield for 0.75 seconds</li> <li><code>spin</code> zeroed out</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 5 (yellow up arrow)</li> <li><code>moves</code> set to 2 and <code>cantmove</code> decremented (gives 2 actor turns per main turn including the current main turn)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#post-move-logic","title":"Post move logic","text":"<p>The following logic always happen after using a move:</p> <ul> <li>If <code>cantmove</code> is 0 (meaning this is the end of the last actor turn of this enemy which acts as a pseudo main turn ending check), <code>data[1]</code> is decremented. If after this decrement, it became 0 or below (meaning the main turn cooldown for toggling the mode just expired):<ul> <li>If position is <code>Underground</code>, it is changed to <code>Ground</code> with the following logic (it is assumed that the moving sand attack move was used):<ul> <li>MoveTowards startp with a 2.0 multiplier</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>digging</code> set to false</li> <li><code>flip</code> set to false</li> <li>FlipAngle called with setangle</li> <li><code>checkingdead</code> set to a new ChangePosition call to change this enemy's <code>position</code> to <code>Ground</code></li> <li>Over the course of 31.0 frames, <code>extra[1]</code> (a <code>Prefabs/Objects/MovingSand</code> from the moving sand attack move) scale changes from 0.5x to 0.0x via a lerp</li> <li><code>extra[1]</code> gets destroyed</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> </li> <li><code>initialheight</code> set to 0.3</li> <li><code>data[0]</code> toggled (becomes 1 if it was 0 or becomes 0 if it was 1)</li> <li>y <code>spin</code> set to 15.0</li> <li><code>Cloth</code> sound plays</li> <li>If <code>data[0]</code> is 1 (ice mode):<ul> <li>The local startstate is set to 13 (<code>BattleIdle</code>)</li> <li><code>minheight</code> and <code>height</code> set to 0.0</li> <li>animstate set to 102</li> </ul> </li> <li>Otherwise (sand mode):<ul> <li>The local startstate is set to 0 (<code>Idle</code>)</li> <li><code>height</code> and <code>minheight</code> set to <code>initialheight</code></li> <li>animstate set to 103</li> <li><code>bobspeed</code> and <code>bobrange</code> set to <code>startbs</code> and <code>startbf</code> respectively</li> </ul> </li> <li><code>data[1]</code> set to 2 (reset the main turn cooldown before toggling modes again)</li> <li>Yield for 0.5 seconds</li> <li><code>spin</code> zeroed out</li> <li>FlipAngle called with setangle</li> <li><code>basestate</code> and animstate set to the local startstate</li> </ul> </li> <li>If <code>data[3]</code> is above 0, it is decremented (this doesn't do anything since this <code>data</code> slot is effectively UNUSED)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#move-1-energy-spheres-throw","title":"Move 1 - Energy spheres throw","text":"<p>A multiple targets energy spheres throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen from 2 times (random between 2 and 3 times instead if hardmode is true), but each call requires that at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby) 3 (2 instead if hardmode is true) null This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each call) A new <code>Prefabs/Objects/EnergySphere</code> GameObject rooted positioned at this enemy position + (-2.0, 4.0, 0.0) + a random vector between (-1.5, -1.0, 0.0) and (1.5, 1.0, 0.0) with a <code>NoMapColor</code> tag 50.0 (40.0 instead if hardmode is true) 1.0 (-0.5 instead if it's the second hit) <code>SepPart@3@1,keepcolor</code> <code>Stars</code> <code>PingShot</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#logic-sequence","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>The amount of hits is determined which is 2 (random between 2 and 3 instead if hardmode is true)</li> <li><code>checkingdead</code> set to an EnergySpheres coroutine with the amount of hits to do (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the EnergySpheres coroutine ends up doing:</p> <ul> <li>A GameObject array is created to hold each projectile objects</li> <li>For each hits to do:<ul> <li>If at least one player party member is alive (<code>hp</code> above 0 and not eatenby):<ul> <li>GetSingleTarget</li> <li><code>Charge7</code> sound plays</li> <li>A new <code>Prefabs/Particles/Charging</code> GameObject is created rooted positioned at this enemy position +  (-2.0, 4.0, 0.0) + a random vector between (-1.5, -1.0, 0.0) and (1.5, 1.0, 0.0)</li> <li>Yield for 0.65 seconds (0.5 seconds instead if hardmode is true)</li> <li>The projectile element is set to a new <code>Prefabs/Objects/EnergySphere</code> GameObject rooted positioned at the <code>Prefabs/Particles/Charging</code> position with a <code>NoMapColor</code> tag</li> <li><code>Lazer2</code> sound plays</li> <li>Projectile 1 call happens</li> <li><code>Prefabs/Particles/Charging</code> moves offscreen at 999.0 in y</li> <li><code>Prefabs/Particles/Charging</code> gets destroyed in 3.0 seconds</li> <li>Yield all frames until the projectile element is null (the Projectile call completed)</li> </ul> </li> </ul> </li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> set to null which signals the caller that the coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#move-2-single-target-ice-attack","title":"Move 2 - Single target ice attack","text":"<p>A single target ice attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 3 Freeze null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget</li> <li>animstate set to 101</li> <li><code>IceMothThrow</code> sound plays</li> <li>A new <code>Prefabs/Objects/SingleSphere</code> GameObject is created childed to a new <code>Prefabs/AnimSpecific/mothbattlesphere</code> GameObject</li> <li>Over the course of 31.0 frames, the <code>Prefabs/AnimSpecific/mothbattlesphere</code> moves from this enemy position + (1.1, 1.85, -0.1) to this enemy position + (-2.0, -0.5, 5.0) via a BeizierCurve3 with a ymax of 5.0</li> <li>The <code>Prefabs/Objects/SingleSphere</code> gets rooted</li> <li>If <code>hologram</code> is true, the <code>Prefabs/Objects/SingleSphere</code> Renderer's color is set to 8080FF (mostly blue) with half opacity</li> <li><code>Prefabs/AnimSpecific/mothbattlesphere</code> gets destroyed</li> <li><code>WatcherIce</code> sound plays</li> <li>Over the course of 81.0 frames (71.0 instead if hardmode is true), <code>Prefabs/Objects/SingleSphere</code> moves from its position with the y component at 0.0 to <code>playertargetentity</code> position via a SmoothLerp</li> <li><code>Prefabs/Objects/SingleSphere</code> gets destroyed</li> <li>animstate set to 104</li> <li><code>IceMothHit</code> sound plays</li> <li>A new <code>Prefabs/Particles/mothicenormal</code> GameObject is created rooted at <code>playertargetentity</code> position + 0.5 in y then destroyed in 2.0 seconds</li> <li>A new <code>Prefabs/Objects/icepillar</code> is created rooted at <code>playertargetentity</code> position with a DialogueAnim that has a <code>targetscale</code> of (0.5, 0.5, 1.0)</li> <li>DoDamage 1 call happens</li> <li>Yield for 0.65 seconds</li> <li>The <code>Prefabs/Objects/icepillar</code>'s DialogueAnim has its <code>shrink</code> set to true with a <code>shrinkspeed</code> of 0.025</li> <li>The <code>Prefabs/Objects/icepillar</code> gets destroyed in 5.0 seconds</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#move-3-moving-sand-attack","title":"Move 3 - Moving sand attack","text":"<p>A single target moving sand attack that may hit multiple times and drain <code>hp</code>.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None -1.0 (infinite) TappingKey <ul><li>{4.0, 8.0, 0.8<sup>1</sup>, 1.0} if hardmode is false</li><li>{4.0, 8.0, 1.25<sup>1</sup>, 1.0} if hardmode is true</li></ul> <p>1: Due to the clamping logic related to this value, it means that the decrease value per frame is 0.005 * the game's frametime when hardmode is false and 0.00625 * the game's frametime when hardmode is true. Effectively, it means that hardmode being true makes <code>barfil</code> decrease 25% more per frame</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#dodamage-calls_1","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Called once if <code>barfill</code> is less than 1.0 (not full) during DoCommand 1 once 0.5 seconds passed and then continously called again every 1.25 seconds until either <code>barfill</code> reaches 1.0 (checked 0.75 seconds after each call) or that <code>playerdata[playertargetID]</code>'s <code>hp</code> becomes 0 This enemy <code>playertargetID</code> after GetSingleTarget (target is the same for each calls) 1 (0 instead if hardmode is true<sup>1</sup>) Atleast1pierce<sup>2</sup> null false <p>1: This doesn't mean the call won't deal any damage because not only <code>Atleast1pierce</code> guarantees 1 damage is dealt, but also because it is meant to function with <code>hardatk</code> in mind which takes effect when hardmode is true 2: Enemy piercing damages are disabled, see the CalculateBaseDamage documentation to learn more</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li><code>data[2]</code> set to 3 (this is the actor turn cooldown to use this move or the party wide icicle throw, it will effectively be 2 actor turns since the decrement happens before)</li> <li><code>WatcherSandLoop</code> sound plays on loop using <code>sounds[9]</code></li> <li>If this enemy position isn't already <code>Underground</code>, it is changed to it with the following:<ul> <li><code>digging</code> set to true</li> <li><code>checkingdead</code> set to a new ChangePosition call to change this enemy's <code>position</code> to <code>Underground</code></li> <li><code>extra[1]</code> initialised to a new <code>Prefabs/Objects/MovingSand</code> GameObject childed to this enemy with a Renderer's color of pure gray</li> <li>Over the course of 61.0 frames, <code>extra[1]</code> scale changes from 0.0x to 0.5x via a lerp</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> </ul> </li> <li>GetSingleTarget called</li> <li>MoveTowards <code>playertargetentity</code></li> <li>Yield all frames until <code>forcemove</code> is done</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>y <code>spin</code> set to 13.0</li> <li><code>playertargetentity</code> animstate set to 11 (<code>Hurt</code>)</li> <li>Over the course of 30.0 frames, <code>playertargetentity</code> moves to -0.5 in y via a lerp</li> <li><code>infinitecommande</code> set to true which will prevent DoCommand 1 to end when MainManager.<code>mashcommandalt</code> is true until the action command is succeeded</li> <li>CreateHelpBox called with 4 (the TappingKey command's help)</li> <li>DoCommand 1 call happens</li> <li>As long as <code>playerdata[playertargetID]</code>'s <code>hp</code> is above 0 and <code>actionroutine</code> isn't null (meaning DoCommand 1 hasn't ended yet):<ul> <li>Yield for 0.5 seconds</li> <li>If <code>barfill</code> is less than 1.0 (it isn't full yet):<ul> <li>DoDamage 1 call happens</li> <li>If <code>lastdamage</code> is above 0, Heal is called to heal this enemy by <code>lastdamage</code> amount of <code>hp</code></li> </ul> </li> <li>Yield for 0.75 seconds</li> </ul> </li> <li><code>Barfill</code> sound stops</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>FinishAction is called manually to end DoCommand 1 if it wasn't already (but it should be by then)</li> <li>MoveTowards + 3.0 in x</li> <li><code>playertargetentity</code>'s y <code>spin</code> set to 20.0</li> <li>Over the course of 30.0 frames, <code>playertargetentity</code> moves from its position - 0.5 to its position before this action via a BeizierCurve3 with a ymax of 2.0</li> <li>SetDefaultCamera called</li> <li><code>playertargetentity</code>'s <code>spin</code> zeroed out</li> <li><code>sounds[9]</code> stopped</li> <li>If <code>playertargetentity</code>'s <code>hp</code> is above 0, its animstate is set to the value they had before this action</li> <li>Yield all frames until <code>forcemove</code> is done</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#move-4-party-wide-icicle-throw","title":"Move 4 - Party wide icicle throw","text":"<p>A party wide icicle throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 4 Freeze <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>animstate set to 100</li> <li>A new <code>Prefabs/Objects/icecle</code> GameObject is created rooted positioned at this enemy position + (-2.0, 4.5, 0.0) with a scale of 0.0x and its BoxCollider destroyed</li> <li><code>Spin</code> sound plays on loop using <code>sounds[8]</code></li> <li>Over the course of 60.0 frames, <code>Prefabs/Objects/icecle</code> scale changes to 1.25x via a lerp, the y angle goes towards 10.0 and the <code>sounds[8]</code> pitch changes from 0.0 to 1.0</li> <li>A new UI object is created named <code>t</code> childed to the <code>GUICamera</code> using the <code>guisprites[41]</code> sprite (a crosshair) on layer 15 (<code>3DUI</code>)</li> <li>animstate set to 101</li> <li><code>Crosshair</code> sound plays on loop using <code>sounds[9]</code> with 0.9 pitch and 0.35 volume</li> <li>Over the course of 81.0 frames, <code>t</code> moves from (0.0, 3.0, 0.0) to (-4.5, 1.0, 0.0) via a SmoothLerp + a number in the y component that goes from Sin(Time.time * 2.0) * -3.0 to 0.0. Before each yield, <code>t</code> z angle increases by 5x the game's frametime and <code>Prefabs/Objects/icecle</code> y angles increases by 10.0</li> <li><code>sounds[8]</code> and <code>sounds[9]</code> stopped</li> <li><code>IceMothThrow</code> sound plays</li> <li><code>t</code> gets destroyed</li> <li><code>Prefabs/Objects/icecle</code> angles set to (0.0, 0.0, -45.0)</li> <li>Over the course of 26.0 frames, <code>Prefabs/Objects/icecle</code> moves to (-4.5, 1.0, 0.0) via a lerp</li> <li><code>IceMothHit</code> sound plays</li> <li><code>mothicenormal</code> particles plays at the <code>Prefabs/Objects/icecle</code> position with a scale of 2.0x</li> <li><code>Prefabs/Objects/icecle</code> gets destroyed</li> <li>PartyDamage 1 call happens</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#move-5-wall-enemy-summon","title":"Move 5 - Wall enemy summon","text":"<p>Summons a new SandWall or IceWall enemy. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li><code>Charge12</code> sound plays</li> <li>animstate set to 100</li> <li>Yield for 0.5 seconds</li> <li>ShakeScreen called with 0.2 ammount and 0.75 time</li> <li>Yield for 0.75 seconds</li> <li>animstate set to 104</li> <li><code>Charge15</code> sound plays</li> <li><code>impactsmoke</code> particles plays at this enemy position - 3.0 in x</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon a SandWall enemy (in sand mode) or IceWall enemy (in ice mode) at this enemy position - 3.0 in x</li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li>If hardmode is true, <code>cantmove</code> is decremented which grants an additional actor turn to this enemy</li> <li><code>enemydata[1]</code> (which should always be the wall that was just summoned) has its <code>diebyitself</code> set to true which mean if they are the only enemy party member alive, CheckDead will kill them</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#move-6-magic-boost-or-heal-followed-by-move-1-or-2","title":"Move 6 - Magic boost or heal followed by move 1 or 2","text":"<p>Uses magic to boost or heal themselves, then performs move 1 (Energy spheres / Single target ice). No damages are dealt for this move, but move 1 will causes damages to be dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/ZombieRoach/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li><code>Magic</code> sound plays</li> <li><code>MagicUp</code> particles plays at this enemy position</li> <li>animstate set to 100</li> <li>y <code>spin</code> set to 15.0</li> <li>Yield for 0.75 seconds</li> <li><code>spin</code> zeroed out</li> </ul> <p>From there, 3 effects can occur: a heal, AttackUp condition or DefenseUp condition. The one that will be done depends on 2 checks:</p> <ol> <li><code>locktri</code> is false and a 2.5/10.0 RNG check passes</li> <li>HPPercent is less than 0.4 and a 5/10 RNG check passes</li> </ol> <p>Here is a table that summarises which one will be done when according to these 2 checks (note that check 2 is only tested if check 1 was true):</p> Check 1 Check 2 Effect false N/A DefenseUp true false AttackUp condition true true Heal <p>The <code>locktri</code> requirement for the <code>AttackUp</code> and heal is set to true when the heal effect happens. This means that healing will prevent this enemy from ever healing or getting the <code>AttackUp</code> condition again by the usage of this move.</p> <p>Here is what happens in the <code>DefenseUp</code> condition effect:</p> <ul> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on this enemy with type 1 (blue up arrow)</li> <li>SetCondition called to inflict the DefenseUp condition on this enemy for 2 main turns</li> </ul> <p>Here is what happens for the <code>AttackUp</code> condition effect:</p> <ul> <li>StatEffect called on this enemy with type 0 (red up arrow)</li> <li>SetCondition called to inflict the AttackUp condition on this enemy for 2 main turns</li> <li><code>StatUp</code> sound plays</li> </ul> <p>And here's what happens in the healing effect:</p> <ul> <li>Heal is called to heal this enemy by its <code>maxhp</code> * 0.1 floored</li> <li><code>locktri</code> is set to true (this will prevent this enemy to heal or get an AttackUp condition by using this move again)</li> <li><code>data[3]</code> set to 3 (this doesn't do anything because this <code>data</code> slot is UNUSED)</li> </ul> <p>Finally, after the effect is done, the following happens:</p> <ul> <li>Yield for 0.5 seconds</li> <li>Move 1 or 2 (whichever is appropriate based on the current mode) is used immediately without ending this actor turn</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/","title":"<code>Zommoth</code>","text":""},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#assumptions","title":"Assumptions","text":"<p>It is assumed that if <code>hologram</code> is false that the fight is started with <code>Moth</code> present in the player party with an EventStop condition. This assumption doesn't apply if <code>hologram</code> is true.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#data-usage","title":"<code>data</code> usage","text":"<p>At the start of the action, if <code>data</code> is null or empty, it's initialised to be 2 element with a starting value of 0.</p> <ul> <li><code>data[0]</code>: This is a tracker to indicate that the first main turns cutscenes with <code>Moth</code> completed. A value of 0 allows the multiple cutscenes and scripted parts of the fight to occur. It is only set to 1 at the end of the first usage of the laser attack move where the last cutscene segments happen. The value has no effects and doesn't change if <code>hologram</code> is true because in that case, the cutscenes don't apply</li> <li><code>data[1]</code>: This is an actor turn cooldown for the usage of the charging move. The value is set to 3 when the move is used and it is decremented if it is above 0 in the post move logic (except when using the laser attack move). The value needs to be 0 or below for the charging move to be usable again. Effectively, it's an antispam of 2 actor turns on the usage of the move not counting actor turns when the laser attack move is used</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#hardmode-changes","title":"HardMode changes","text":"<p>HardMode being true does the following changes:</p> <ul> <li>In the shadow balls projectiles move, the speed of each Projectile calls changes to 27.0 from 35.0</li> <li>In the shadow balls projectiles move, the extraargs of each Projectile now ends with <code>,atkdown@3@2@2</code> which allows the projectile to potentially inflict AttackDown</li> <li>In the laser attack move, the amount of frames the laser takes to move each times changes to 51.0 frames from 61.0 frames</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#move-selection","title":"Move selection","text":"<p>7 moves are possible:</p> <ol> <li>A single target arm slam attack</li> <li>A single target tail swipe attack</li> <li>A multiple targets shadow balls projectiles throw</li> <li>Summons an enemy from the fungi family</li> <li>Prepares a big attack next actor turn by setting <code>charge</code> to 1 and getting the DefenseUp condition</li> <li>A party wide scream attack</li> <li>A party wide laser attack that hits twice with the ability to inflict AttackDown</li> </ol> <p>There are 2 move selection process: regular and scripted. The scripted one applies when <code>hologram</code> is false and <code>data[0]</code> is 0 (haven't yet completed the first main turns cutscenes when they are applicable).</p> <p>No matter the move selection process, move 7 is always (and only) used when <code>basestate</code> isn't 0 (<code>Idle</code>) meaning move 5 was used before because this move sets <code>basestate</code> away from 0.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#scripted-move-selection","title":"Scripted move selection","text":"<p>If <code>hologram</code> is false and <code>data[0]</code> is 0 (haven't yet completed the first main turns cutscenes when they are applicable), the move selection process is overriden to the following:</p> <ul> <li>When <code>turns</code> is 0 (first main turn), move 3 is used</li> <li>When <code>turns</code> isn't 0 (second main turn and later), move 5 is used which sets the <code>basestate</code> away from 0 (<code>Idle</code>)</li> <li>Due to <code>basestate</code> not being 0 (<code>Idle</code>) move 7 is used on the next actor turn</li> <li><code>data[0]</code> is set to 1 as part of move 7 which ends this temporary override</li> </ul> <p>After the override ends or if <code>hologram</code> is true, the regular move selection process happens.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#regular-move-selection","title":"Regular move selection","text":"<p>If <code>hologram</code> is true or <code>data[0]</code> is 1 (the cutscenes completed or they weren't applicable), the decision of which move to use is based on the following odds:</p> Move Odds 1 2/15 2 3/15 3 3/15 4 2/15 5 2/15 6 3/15 <p>However, if move 4 is selected and this enemy is the last remaining <code>enemydata</code> left, a continue directive is issued to the enemy action loop which restarts the entire action and effectively rerolls the move selection process.</p> <p>This also happens if move 5 is selected while <code>data[1]</code> is above 0 meaning the cooldown on the usage of that move hasn't yet expired.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#post-move-logic","title":"Post move logic","text":"<p>The following logic is always done after using a move except for the laser attack move:</p> <ul> <li>If <code>data[1]</code> is above 0, it is decremented</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#move-1-arm-slam-attack","title":"Move 1 - Arm slam attack","text":"<p>A single target arm slam attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#basicattack-calls","title":"BasicAttack calls","text":"# Conditions enemyid walkstate attackstate attackstate2 damage offset property shake delay sounds dontgettarget 1 Always happen This enemy 1 (<code>Walk</code>) 100 101 3 (1.45, 0.0, -0.1) null 0.0 Random between 0.5 and 0.75 seconds <code>ZammothMelee1,ZammothMelee2</code> false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> is set to the BasicAttack 1 call</li> <li>Yield all frames until <code>checkingdead</code> is null (the BasicAttack 1 call completed)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#move-2-tail-swipe-attack","title":"Move 2 - Tail swipe attack","text":"<p>A single target tail swipe attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Always happen This enemy <code>playertargetID</code> after GetSingleTarget 4 null null <code>commandsuccess</code>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#logic-sequence_1","title":"Logic sequence","text":"<ul> <li>GetSingleTarget called</li> <li>Camera moves to look near <code>playerdata[playertargetID]</code></li> <li>MoveTowards <code>playertargetentity</code> position + (2.5, 0.0, -0.1) with 2.0 multiplier using 1 (<code>Walk</code>) as walkstate and 102 as stopstate</li> <li>Yield all frames until <code>forcemove</code> is done</li> <li><code>ZammothMelee1</code> sound plays</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Over the course of 31.0 frames, <code>model</code>'s y angle changes to -30.0 via LerpAngle</li> <li><code>ZammothSwipe</code> sound plays</li> <li><code>model</code> angles reset to Vector3.zero</li> <li>animstate set to 103</li> <li>MainManager.spin called in parallel on this enemy towards y angles of 360.0 for 30.0 frametime with smooth</li> <li>Yield for 0.25 seconds</li> <li>DoDamage 1 called</li> <li>If <code>commandsuccess</code> is false (didn't blocked, ignores FRAMEONE), <code>enemybounce</code> is set to a new array of one element being a BounceEnemy call on <code>playerdata[playertargetID]</code> using routineid 0 for 1 bounce and 1.25 multiplier</li> <li>Yield for 0.5 seconds</li> <li>Yield all frames until <code>enemybounce[0]</code> is done if it was started</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#move-3-shadow-balls-projectiles","title":"Move 3 - Shadow balls projectiles","text":"<p>A multiple targets shadow balls projectiles throw.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#nonphyscal-set-to-true","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#projectile-calls","title":"Projectile calls","text":"# Conditions damage property attacker playertarget obj speed height extraargs destroyparticle audioonhit audiomoving spin nosound 1 Always happen 2 times, but the second call requires that at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby) 3 Poison This enemy <code>playertargetID</code> after GetSingleTarget (target changes for each calls) A new <code>Prefabs/Objects/ShadowBall</code> GameObject rooted positioned at this enemy position + (1.5, 3.0, -0.1) on the first hit and this enemy position + (-1.35, 3.0, -0.1) on the second hit 35.0 (27.0 instead if hardmode is true) 0.0 <code>SepPart@3@1,keepcolor</code> (<code>SepPart@3@1,keepcolor,atkdown@3@2@2</code> instead if hardmode is true) <code>Stars</code> <code>PingShot</code> null Vector3.zero false"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#logic-sequence_2","title":"Logic sequence","text":"<ul> <li>Camera moved to look near the midpoint between this enemy and <code>partymiddle</code></li> <li><code>ZammothMelee1</code> sound plays</li> <li>animstate set to 102</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li>ShakeScreen called with 0.05 ammount and 0.5 time</li> <li><code>ZammothOrb1</code> sound plays</li> <li>2 projectiles elements are initialised:<ul> <li>Each is a new <code>Prefabs/Objects/ShadowBall</code> GameObject rooted positioned at this enemy position + (0.0, 3.0, -0.1)</li> <li>MainManager.MoveTowards called on the object to move it in x by +1.5 on the first one and -1.35 on the seocond one for 10.0 frametime with smooth without local (started in paralel)</li> </ul> </li> <li>animstate set to 104</li> <li>GetSingleTarget called</li> <li>Yield for 0.5 seconds</li> <li>animstate set to 105</li> <li>Yield for 0.33 seconds</li> <li>Done 2 times (each hit):<ul> <li><code>ZammothOrb2</code> sound plays</li> <li>Projectile 1 call happens</li> <li>If this is the first hit:<ul> <li>Yield for 0.33 seconds</li> <li>Yield for 0.33 seconds</li> <li>If there's not at least 1 player party member is alive (<code>hp</code> above 0 and not eatenby), the second projectile element is destroyed and the second hit doesn't happen</li> <li>Otherwise (the second hit will happen), GetSingleTarget is called</li> </ul> </li> </ul> </li> <li>Yield all frames until both projectiles objects are null (all Projectile 1 calls completed)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#move-4-enemy-summon","title":"Move 4 - Enemy summon","text":"<p>Summons an enemy from the fungi family. No damages are dealt</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#logic-sequence_3","title":"Logic sequence","text":"<ul> <li>Camera moves to look near this enemy</li> <li><code>ZammothRumble</code> sound plays</li> <li>animstate set to 102</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Yield for 0.5 seconds</li> <li><code>ZammothSummon</code> sound plays</li> <li>ShakeScreen called with 0.075 ammount and 0.5 time</li> <li>animstate set to 104</li> <li><code>checkingdead</code> set to a new SummonEnemy call to summon an enemy from the fungi family with type <code>Offscreen</code> at (1.3, 0.0, 0.45). The enemy to summon is determined randomly among the following with uniform odds:<ul> <li>Zombee</li> <li>CordycepsAnt</li> <li>Zombeetle</li> <li>Mushroom</li> <li>Bloatshroom</li> </ul> </li> <li>Yield all frames until <code>checkingdead</code> is null (the coroutine completed)</li> <li><code>enemydata[lastaddedid]</code>'s <code>exp</code> gets divided by 2 floored</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#move-5-prepares-a-big-attack-with-1-charge-and-defenseup","title":"Move 5 - Prepares a big attack with 1 <code>charge</code> and DefenseUp","text":"<p>Prepares a big attack next actor turn by setting <code>charge</code> to 1 and getting the DefenseUp condition. No damages are dealt.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#dontusecharge-set-to-true","title":"<code>dontusecharge</code> set to true","text":"<p>This move always sets <code>dontusecharge</code> to true which means <code>charges</code> will not get zeroed out in post action.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#logic-sequence_4","title":"Logic sequence","text":"<ul> <li>Camera moves to look near this enemy</li> <li>animstate set to 102</li> <li><code>ZammothRumble</code> sound plays</li> <li><code>ZammothOrb1</code> sound plays with 0.4 pitch</li> <li>ShakeScreen called with 0.075 ammount and 0.5 time</li> <li>ShakeSprite called with 0.1 intensity and 60.0 frametimer</li> <li>Done in a separate coroutine started in paralel called MainManager.Waves:<ul> <li>A <code>Prefabs/Objects/SphereGlowEffect</code> GameObject is instantiated rooted at this enemy's <code>model</code>'s first child's first child (purple particles in their chest) with a scale of (50.0, 50.0, 1.0) with a pure magenta color</li> <li>Over the course of 81.0 frames, the scale of <code>Prefabs/Objects/SphereGlowEffect</code> changes to 0.0x via a lerp</li> <li>The <code>Prefabs/Objects/SphereGlowEffect</code> gets destroyed</li> </ul> </li> <li>Yield for 1 second</li> <li>StatusEffect called to inflict the DefenseUp condition to this enemy for 2 main turns (effectively 1 as the current main turn is advanced soon) with effect</li> <li><code>charge</code> set to 1</li> <li><code>basestate</code> and the local startstate set to animstate (this allows to use the laser attack move on the next actor turn)</li> <li>Yield for 0.5 seconds</li> <li>If <code>hologram</code> is false and <code>data[0]</code> is 0 (haven't yet completed the first main turns cutscenes when they are applicable):<ul> <li>SetDefault called</li> <li>Yield for 0.5 seconds</li> <li>If <code>Moth</code> from the player party has an <code>hp</code> of 0 or below, RevivePlayer is called on them leaving them with 1 <code>hp</code> without showcounter</li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>|</code>tail<code>,0|</code> followed by <code>map.dialogues[5]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: null</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> </ul> </li> <li><code>data[1]</code> is set to 3 (the move won't be usable for the next 3 actor turns including the laser attack one)</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#move-6-scream-attack","title":"Move 6 - Scream attack","text":"<p>A party wide scream attack.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#nonphyscal-set-to-true_1","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#partydamage","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 3 DefDownOnBlock <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#logic-sequence_5","title":"Logic sequence","text":"<ul> <li><code>checkingdead</code> set to a new ScreamWaves call (<code>checkingdead</code> is set to null when completed)</li> <li>Yield all frames until <code>checkingdead</code> is null</li> </ul> <p>This is what the coroutine ends up doing:</p> <ul> <li>Camera moves to look near this enemy</li> <li>animstate set to 102</li> <li>ShakeSprite called with an intensity of (0.05, 0.0, 0.0) and 85.0 frametimer</li> <li>Yield for 0.85 seconds</li> <li><code>Gleam</code> particles plays with the <code>Gleam</code> sound at this enemy's <code>sprite</code> + its CenterPos + (0.5, 1.0, -0.1) with 0.5 alivetime</li> <li>Yield for 0.5 seconds</li> <li>Done 5 times in a separate coroutine started in paralel called MainManager.Waves:<ul> <li>A <code>Prefabs/Objects/SphereGlowEffect</code> GameObject is instantiated rooted at this enemy's world CenterPos with a scale of 0.0x</li> <li>Over the course of 31.0 frames, the scale of <code>Prefabs/Objects/SphereGlowEffect</code> changes to (50.0, 50.0, 1.0) via a lerp</li> <li>The <code>Prefabs/Objects/SphereGlowEffect</code> gets destroyed</li> <li>Yield for 0.25 seconds</li> </ul> </li> <li>SetDefaultCamera called</li> <li><code>ZammothSummon</code> sound plays</li> <li>animstate set to 104</li> <li>ShakeScreen called with an ammount of 0.2 and 1.0 time</li> <li>Yield for 0.25 seconds</li> <li>PartyDamage 1 call happens</li> <li>Yield for a second</li> <li><code>checkingdead</code> set to null which signals the caller that this coroutine completed</li> </ul>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#move-7-laser-attack","title":"Move 7 - Laser attack","text":"<p>A party wide laser attack that hits twice with the ability to inflict AttackDown.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#nonphyscal-set-to-true_2","title":"<code>nonphyscal</code> set to true","text":"<p>This move always sets <code>nonphyscal</code> to true which affects the effects of the <code>FrostBite</code>, <code>SpikeBod</code> and <code>PoisonTouch</code> medal if equipped on the target.</p>"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#partydamage_1","title":"PartyDamage","text":"# Conditions caller damage property block jumpheight spinammount jumpevenonblock overrides 1 Always happen This enemy 3 Poison <code>commandsuccess</code> 0.0 Vector3.zero false null 2 Always happen This enemy 2 Poison <code>commandsuccess</code> 0.0 Vector3.zero false null"},{"location":"Battle%20system/Enemy%20actions/Enemies/Zommoth/#logic-sequence_6","title":"Logic sequence","text":"<ul> <li>ShakeScreen called with 0.075 ammount and 0.5 time with dontreset</li> <li><code>ZammothRumble</code> sound plays</li> <li>ShakeSprite called with 0.1 intensity and 30.0 frametimer</li> <li>Camera moves to look near this enemy</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.25 seconds</li> <li><code>ZammothBeam</code> sound plays with 0.8 pitch</li> <li>ShakeScreen called with 0.075 ammount and -1.0 time with dontreset</li> <li>Camera moves to look near the midpoint between this enemy and <code>partymiddle</code></li> <li>animstate set to 103</li> <li>Yield for a frame</li> <li>If <code>hologram</code> is false and <code>data[0]</code> is 0 (haven't yet completed the first main turns cutscenes when they are applicable):<ul> <li>If <code>Moth</code> from the player party has an <code>hp</code> of 0 or below, RevivePlayer is called on them leaving them with 1 <code>hp</code> without showcounter</li> <li>RemoveCondition is called to remove the EventStop condition from <code>Moth</code></li> <li><code>Moth</code>'s animstate set to 116</li> <li>Yield for 0.5 seconds</li> <li><code>Shield</code> sound plays</li> <li>For each player party members:<ul> <li>SetCondition called to inflict the Shield condition on them for 1 main turn (but the condition will be manually removed later in this move)</li> <li>Their <code>shieldenabled</code> is set to true</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul> </li> <li><code>BigLazer</code> particles plays at this enemy's <code>model</code>'s first child's first child position (purple particles in their chest) with angles of (-40.0, -90.0, -90.0) and -1.0 alivetime</li> <li>Yield for 0.5 seconds</li> <li>Over the course of 61.0 frames (51.0 frames instead if hardmode is true), <code>BigLazer</code> particles's x angle changes to 0.0 via a LerpVectorAngle. On the first frame after 42.0 frames (35.0 frames instead if hardmode is true):<ul> <li>PartyDamage 1 call happens</li> <li>All player party members whose <code>hp</code> is above 0 and without the Shield condition has SetCondition called on them to inflict them the AttackDown condition for 3 main turns (effectively 2 since the current main turn advanced soon) with effects</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>Over the course of 61.0 frames (51.0 frames instead if hardmode is true), <code>BigLazer</code> particles's x angle changes to 40.0 via a LerpVectorAngle. On the first frame after 18.0 frames (15.0 frames instead if hardmode is true):<ul> <li>PartyDamage 2 call happens</li> <li>All player party members whose <code>hp</code> is above 0 and without the Shield condition has SetCondition called on them to inflict them the AttackDown condition for 3 main turns (effectively 2 since the current main turn advanced soon) with effects</li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>GradualScale called to change the scale of <code>BigLazer</code> particles to (0.0, 0.0, 1.0) over the course of 31.0 frames then destroy the object</li> <li>Yield for 0.5 seconds</li> <li>MainManager.<code>screenshake</code> reset to Vector3.zero</li> <li><code>basestate</code>, animstate and the local startstate all set to 0 (<code>Idle</code>) which prevents to use this move again on the next actor turn</li> <li>If <code>hologram</code> is false and <code>data[0]</code> is 0 (haven't yet completed the first main turns cutscenes when they are applicable):<ul> <li><code>Moth</code>'s <code>cantmove</code> is set to 1 (meaning they need to have their actor turn advanced once before they can act)</li> <li><code>Moth</code>'s animstate set to 13 (<code>BattleIdle</code>)</li> <li>For each player party members:<ul> <li>RemoveCondition called to remove their Shield condition</li> <li>Their <code>shieldenabled</code> is set to false</li> </ul> </li> <li>SetText is called in dialogue with the following:<ul> <li>text: <code>|</code>tail<code>,0|</code> followed by <code>map.dialogues[6]</code></li> <li>fonttype: 0 (<code>BubblegumSans</code>)</li> <li>linebreak: <code>messagebreak</code></li> <li>tridimensional: false</li> <li>position: Vector3.zero</li> <li>size: Vector3.one</li> <li>parent: null</li> <li>caller: null</li> </ul> </li> <li>Yield all frames until the message lock is released</li> <li><code>data[0]</code> is set to 1 indicating that all of the first main turns cutscenes completed</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20UI/Actions/","title":"Actions","text":"<p>This enum describes the current sub interface the player selected or is in the process of configuring. The current one is stored in the <code>currentchoice</code> field. It can be thought as the sub interface to Pick.</p> Value Name Description 0 Attack The player chose to use a basic attack 1 Skill The player chose to use a skill 2 Item The player chose to use an item 3 Strategy The player chose to use a strategy 4 Relay The player chose to relay 5 Swap The player chose the Swap option in the strategy menu"},{"location":"Battle%20system/Player%20UI/AttackArea/","title":"AttackArea","text":"<p>This is a general purpose enum to specify the valid targets of anything.</p> Value Name Description 0 SingleEnemy Can target an enemy party member 1 AllEnemies Can target the enemy party 2 SingleAlly Can target a player party member 3 AllParty Can target the player party 4 All Can target all actors 5 None No target 6 User Can target the actor itself"},{"location":"Battle%20system/Player%20UI/CancelList/","title":"CancelList","text":"<p>This method is used to go back to the main vine action menu from an ItemList during a battle.</p> <ul> <li><code>option</code> is set to <code>lastoption</code></li> <li><code>currentaction</code> is set to <code>BaseAction</code> (the main vine action menu)</li> <li><code>turncooldown</code> is set to 5.0 (this prevents GetChoiceInput calls during PlayerTurn for 5 FixedUpdate cycles)</li> <li>SetMaxOptions is called</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Player%20UI/GetChoiceInput/","title":"GetChoiceInput","text":"<p>This method manages the UI naviguation called from PlayerTurn when <code>turncooldown</code> expired.</p> <p>The logic depends on the currentaction and most of the logic involves input handling through the different menus. The logics are located in their own page matching the corresponding Pick value handled by this method (the others are handled somewhere else such as MainManager in the case of an ItemList).</p> <code>currentaction</code> Link to its UI handling logic page <code>BaseAction</code> BaseAction <code>SelectEnemy</code> BaseAction <code>SelectPlayer</code> BaseAction"},{"location":"Battle%20system/Player%20UI/GotoSelect/","title":"GotoSelect","text":"<p>If the confirmation handling needs to move to target selection (which happens from SetItem), a method called GotoSelect is involved receiving a boolean called overridemax which prepares the state for GetChoiceInput to handle this.</p> <pre><code>private void GotoSelect(bool overridemax)\n</code></pre> <p>Here is the logic of that method depending on the itemarea (nothing happens if it's not among them):</p>"},{"location":"Battle%20system/Player%20UI/GotoSelect/#singleally","title":"<code>SingleAlly</code>","text":"<ul> <li><code>maxoptions</code> is set to the length of <code>playerdata</code></li> <li>currentaction is set to <code>SelectPlayer</code></li> </ul>"},{"location":"Battle%20system/Player%20UI/GotoSelect/#singleenemy","title":"<code>SingleEnemy</code>","text":"<ul> <li>If overridemax is false, <code>maxoptions</code> is set to the length of <code>availabletargets</code></li> <li>currentaction is set to <code>SelectEnemy</code></li> </ul>"},{"location":"Battle%20system/Player%20UI/GotoSelect/#allenemies","title":"<code>AllEnemies</code>","text":"<ul> <li><code>option</code> is set to 0</li> <li><code>maxoptions</code> is set to 1</li> <li>currentaction is set to <code>SelectEnemy</code></li> </ul>"},{"location":"Battle%20system/Player%20UI/GotoSelect/#allparty","title":"<code>AllParty</code>","text":"<ul> <li><code>option</code> is set to <code>currentturn</code></li> <li><code>maxoptions</code> is set to 1</li> <li>currentaction is set to <code>SelectPlayer</code></li> </ul>"},{"location":"Battle%20system/Player%20UI/GotoSelect/#all","title":"<code>All</code>","text":"<ul> <li><code>option</code> is set to 0</li> <li><code>maxoptions</code> is set to 1</li> <li>currentaction is set to <code>SelectEnemy</code></li> </ul>"},{"location":"Battle%20system/Player%20UI/Pick/","title":"Pick","text":"<p>This enum describes the current top level interface the player is naviguating. The current one is stored in the <code>currentaction</code> field. It can be thought as the top level interface while Actions is the sub level one.</p> Value Name Description 0 BaseAction The main vine action menu 1 SelectEnemy Selecting an enemy party member 2 SelectPlayer Selecting a player party member 3 SkillList Selecting a skill in its ItemList 4 ItemList Selecting an item in its ItemList 5 StrategyList Selecting a strategy in its ItemList 6 Relay UNUSED 7 Chompy The chompy vine menu used in Chompy"},{"location":"Battle%20system/Player%20UI/SetItem/","title":"SetItem","text":"<p>This method is a special handler whenever a confirmation of an ItemList occurs. The listtype handled here are only the ones related to BattleControl except for the chompy ribbons list type as this one is handled by the Chompy action coroutine. The ItemList handled are only the ones that were setup by GetChoiceInput</p> <p>The method receives the <code>listvar</code> option that was confirmed which is set to <code>selecteditem</code>. <code>turncooldown</code> is set to 5.0 and <code>option</code> to 0. The <code>turncooldown</code> prevents GetChoiceInput to be called from PlayerTurn for 5 FixedUpdate cycles.</p> <p>From there, this is where the list type is handled. Only 3 are possible:</p> <ul> <li>Battle strategy list type</li> <li>Skills list type</li> <li>Standard items list type</li> </ul> <p>The logics are located in their own page matching the corresponding <code>listtype</code>. No matter which one, UpdateText is called after.</p> listtype Link to its UI handling logic page Battle strategy Battle strategy list type Skills Skills list type Standard items Standard items list type"},{"location":"Battle%20system/Player%20UI/SetMaxOptions/","title":"SetMaxOptions","text":"<p>This method sets <code>maxoptions</code>, <code>availabletargets</code> and the <code>vineicons</code> meterials (greyscale if the choice is available, but disabled).</p> <ul> <li><code>maxoption</code> is set to 3 (gives access to attack, skills and items options)</li> <li>If flag 15 is true (after combat tutorial), <code>maxoption</code> is incremented (gives access to the stategies option)</li> <li>If flag 16 is true (Leif is able to fight in battle), <code>maxoption</code> is incremented (gives access to the turn relay option)</li> <li>SetTargets is called</li> <li>If <code>choivevine</code> exists and <code>currentturn</code> isn't negative (a player is selected for acting), the materials of the <code>vineicons</code> are updated to MainManager.<code>grayscale</code> if the choice is disabled or MainManager.<code>spritedefaultunity</code> if the choice is enabled (only applicable if the element at the index exists):<ul> <li><code>vineicons[0]</code> (attack) option is disabled if there's no <code>availabletargets</code>, enabled otherwise</li> <li><code>vineicons[1]</code> (skills) option is disabled if any of the following are true about the <code>playerdata</code> of <code>currentturn</code> (enabled otherwise):<ul> <li>It has no skills</li> <li>Its <code>lockskills</code> is true</li> <li>It has the Inked condition</li> <li>It has the Taunted condition</li> </ul> </li> <li><code>vineicons[2]</code> (items) option is disabled if instance.<code>items[0]</code> is empty (no standard items) or any of the following are true about the <code>playerdata</code> of <code>currentturn</code> (enabled otherwise):<ul> <li>Its <code>lockitems</code> is true</li> <li>It has the Sticky condition</li> <li>It has the Taunted</li> </ul> </li> <li><code>vineicons[4]</code> (turn relay) option is disabled if there's only one <code>playerdata</code> or any of the following are true about the <code>playerdata</code> of <code>currentturn</code> (enabled otherwise):<ul> <li>Its <code>haspassed</code> is true (a relay from this player party member already happened in the same main turn)</li> <li>Its <code>locktri</code> is true (relay is disabled)</li> <li>It has the Taunted</li> </ul> </li> </ul> </li> <li><code>vineoption</code> is set to <code>maxoption</code></li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/","title":"<code>BaseAction</code> ChoiceInput logic","text":"<p>This page details the logic of GetChoiceInput when currentaction is <code>BaseAction</code>.</p> <p>All of the logic present here involves handling inputs. The input isn't processed if <code>caninputcooldown</code> hasn't expired yet and nothing happens except decreasing the cooldown by MainManager.<code>framestep</code>.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#input-7-toggle-hud","title":"Input 7 (toggle HUD)","text":"<p>This input is handled specifically where pressing it will set <code>idletimer</code> to 250 when pressed which will show the <code>hexpcounter</code> without needing to wait 200 frames. Any other input will cause the <code>idletimer</code> to be set to 0 which resets the timer.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#input-2-3-left-right","title":"Input 2 / 3 (left / right)","text":"<p>These inputs changes the <code>option</code> by one depending on the direction (decrement if right, increment if left with wrap around from 0 to <code>maxoptions</code> - 1). </p> <p>Either input will have <code>caninputcooldown</code> set to 2.0 frames, a <code>Scroll</code> sound played on <code>sounds[10]</code> and UpdateText being called.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#input-5-cancel","title":"Input 5 (cancel)","text":"<p>This input is only processed if GetFreePlayerAmmount returns more than 1 player being free to act.</p> <ul> <li><code>caninputcooldown</code> is set to 2.0 frames</li> <li>The <code>Money</code> sound is player with a pitch of 1.0 + <code>currentturn</code> / 10.0 which shifts the pitch slightly using a rate that depends on the selected player that we are switching away from</li> <li><code>lastoption</code> is set to <code>option</code></li> <li><code>currentturn</code> is set to -1 which unselects the player (the new one will be cycle on the next player phase update)</li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#input-6-switch-party","title":"Input 6 (switch party)","text":"<p>This input is only processed when AllPartyFree returns true (all <code>playerdata</code> have a <code>cantmove</code> of 0 or below) or GetAlivePlayerAmmount returns exactly 1 (there is only one player with an <code>hp</code> above 0 with no <code>eatenby</code>):</p> <ul> <li><code>caninputcooldown</code> is set to 2.0</li> <li>The <code>Switch</code> sound is played</li> <li>The SwitchParty action coroutine is started (without fast) which changes to an uncontrolled flow</li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#input-4-confirm","title":"Input 4 (confirm)","text":"<ul> <li><code>caninputcooldown</code> is set to 2.0</li> <li>instance.<code>inputcooldown</code> is set to 2.0</li> <li>A <code>Confirm</code> sound is played on <code>sounds[10]</code></li> <li><code>lastoption</code> is set to <code>option</code></li> <li><code>vineoption</code> is set to <code>maxoptions</code></li> <li><code>lastaction</code> is set to <code>option</code></li> <li>currentchoice is set to the <code>Actions</code> value whose numerical value is <code>option</code></li> </ul> <p>From there, what happens depends on currentchoice and after, UpdateText is called.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#attack","title":"<code>Attack</code>","text":"<ul> <li>SetTargets is called</li> <li>If there's no <code>availabletargets</code>, PlayBuzzer is called (the attack usage is denied because no targets is available)</li> <li>Otherwise (the basic attack is accepted):<ul> <li><code>maxoptions</code> is set to the length of <code>availabletargets</code></li> <li>currentaction is set to <code>SelectEnemy</code></li> <li>itemarea is set to <code>SingleEnemy</code></li> <li><code>option</code> is set to 0</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#skill","title":"<code>Skill</code>","text":"<ul> <li><code>excludeself</code> is set to false</li> <li><code>playerdata[currentturn].lockskills</code> is true or it has the Taunted or Inked condition, PlayBuzzer is called (the skill usage is denied)</li> <li>Otherwise (the skill usage is accepted):<ul> <li>currentaction is set to <code>SkillList</code></li> <li>MainManager.RefreshSkills is called</li> <li>A couple of ItemList fields are initialised (with an instance.<code>inputcooldown</code> of 5.0):<ul> <li><code>storeid</code>: 0</li> <li>listtype: -<code>currentturn</code> - 1 which is the skills list type of the corresponding player party member</li> <li><code>listammount</code>: 5</li> <li><code>listdesc</code>: true</li> <li><code>listsell</code>: false</li> </ul> </li> <li>ShowItemList is called with -<code>currentturn</code> - 1 as the list type, MainManager.<code>defaultlistpos</code> as the position with showdescription and without sell</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#item","title":"<code>Item</code>","text":"<ul> <li><code>excludeself</code> is set to false</li> <li>GetAvaliableTargets is called with onlyground without onlyfront using -1 as the acttackid</li> <li>If instance.<code>items[0]</code> is empty (no standard items) or <code>playerdata[currentturn].lockitems</code> is true or it has the Taunted or Sticky condition, PlayBuzzer is called (the item usage is denied)</li> <li>Otherwise (the item usage is accepted):<ul> <li>currentaction is set to <code>ItemList</code></li> <li>A couple of ItemList field are initialised (with an instance.<code>inputcooldown</code> of 5.0):<ul> <li><code>storeid</code>: 0</li> <li>listtype: 0 which is the standard items list type</li> <li><code>listammount</code>: 5</li> <li><code>listdesc</code>: true</li> <li><code>listsell</code>: false</li> </ul> </li> <li>ShowItemList is called with 0 as the list type, MainManager.<code>defaultlistpos</code> as the position with showdescription and without sell</li> <li>UpdateText is called</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#strategy","title":"<code>Strategy</code>","text":"<ul> <li>currentaction is set to <code>StrategyList</code></li> <li>A couple of ItemList field are initialised (with an instance.<code>inputcooldown</code> of 5.0):<ul> <li><code>storeid</code>: 0</li> <li>listtype: 9 which is the battle strategy list type</li> <li><code>listammount</code>: 6</li> <li><code>listdesc</code>: true</li> <li><code>listsell</code>: false</li> </ul> </li> <li>ShowItemList is called with 9 as the list type, MainManager.<code>defaultlistpos</code> as the position with showdescription and without sell</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#relay","title":"<code>Relay</code>","text":"<ul> <li>If there's 1 or less <code>playerdata</code> or <code>playerdata[currentturn].locktri</code> (unable to relay) or <code>haspassed</code> is true (already relayed on the same main turn) or it has the Taunted condition, PlayBuzzer is called (the relay is denied)</li> <li>Otherwise (the relay is accepted):<ul> <li><code>excludeself</code> is set to true</li> <li><code>option</code> is set to 0</li> <li><code>helpboxid</code> is set to -1</li> <li><code>maxoptions</code> is set to the length of <code>playerdata</code></li> <li><code>itemarea</code> is set to <code>SingleAlly</code></li> <li><code>option</code> is incremented with wrap around to <code>maxoptions</code> - 1 repeatedly via IncreaseOption until its value is <code>currentturn</code></li> <li>currentaction is set to <code>SelectPlayer</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/BaseAction/#swap","title":"<code>Swap</code>","text":"<ul> <li><code>excludeself</code> is set to true</li> <li><code>option</code> is set to 0</li> <li><code>helpboxid</code> is set to -1</li> <li><code>maxoptions</code> is set to the length of <code>playerdata</code></li> <li><code>option</code> is incremented with wrap around to <code>maxoptions</code> - 1 repeatedly via IncreaseOption until its value is <code>currentturn</code></li> <li>currentaction is set to <code>SelectPlayer</code></li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectEnemy/","title":"<code>SelectEnemy</code> ChoiceInput logic","text":"<p>This page details the logic of GetChoiceInput when currentaction is <code>SelectEnemy</code>.</p> <p>CreateHelpBox is called followed by <code>excludeself</code> being set to false.</p> <p>The rest is input handling logic.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectEnemy/#input-2-3-left-right","title":"Input 2 / 3 (left / right)","text":"<p>These 2 inputs are only processed if itemarea isn't <code>AllParty</code>, <code>AllEnemies</code> or <code>All</code>.</p> <p>These inputs changes the <code>option</code> by one depending on the direction (decrement if left, increment if right with wrap around from 0 to <code>maxoptions</code> - 1 using DecreaseOption and IncreaseOption). </p> <p>Additionally, a <code>Scroll</code> sound played on <code>sounds[10]</code> before changing the <code>option</code> and UpdateText is called after changing it.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectEnemy/#input-5-cancel","title":"Input 5 (cancel)","text":"<p>ReturnToMainSelect is called which does the following:</p> <ul> <li>The <code>Cancel</code> sound is played on AudioSource 10</li> <li>currentaction is set to <code>BaseAction</code></li> <li><code>option</code> is set to <code>lastoption</code></li> <li><code>selecteditem</code> is set to -1</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>SetMaxOptions is called</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectEnemy/#input-4-confirm","title":"Input 4 (confirm)","text":"<p>A <code>Confirm</code> sound is played on <code>sounds[10]</code> followed by <code>target</code> being set to <code>option</code>.</p> <p>What happens after depends on the currentchoice (nothing happen if it's not among these <code>Actions</code>).</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectEnemy/#attack","title":"<code>Attack</code>","text":"<p>A DoAction action coroutine is started changing to an uncontrolled flow on <code>playerdata[currentturn].battleentity</code> using -1 as the action id (the basic attack id).</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectEnemy/#item","title":"<code>Item</code>","text":"<p>CheckItemUse is called with the <code>selecteditem</code> which ends starting a UseItem action coroutine changing to an uncontrolled flow.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectEnemy/#skill","title":"<code>Skill</code>","text":"<ul> <li><code>lastskill</code> is set to <code>selecteditem</code></li> <li>A DoAction action coroutine is started changing to an uncontrolled flow on <code>playerdata[currentturn].battleentity</code> using <code>selecteditem</code> as the action id (the skill id).</li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectEnemy/#strategy","title":"<code>Strategy</code>","text":"<ul> <li>ItemList's <code>listredirect</code> is set to -1 (this workarounds a potential inlist issue)</li> <li>currentaction is set to <code>BaseAction</code></li> <li>A Tattle action coroutine is started changing to an uncontrolled flow if <code>disablespy</code> is false.</li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectPlayer/","title":"<code>SelectPlayer</code> ChoiceInput logic","text":"<p>This page details the logic of GetChoiceInput when currentaction is <code>SelectPlayer</code>.</p> <p>All the logic present here is input handling logic.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectPlayer/#input-2-3-left-right","title":"Input 2 / 3 (left / right)","text":"<p>These 2 inputs are only processed if itemarea isn't <code>AllParty</code>, <code>AllEnemies</code> or <code>All</code>.</p> <p>These inputs changes the <code>option</code> by one depending on the direction (decrement if left, increment if right with wrap around from 0 to <code>maxoptions</code> - 1 using DecreaseOption and IncreaseOption). However, there are 2 exceptions (only one is applied)</p> <ul> <li>If <code>excludeself</code> is true, the increment/decrement is redone over and over until <code>option</code> isn't <code>currentturn</code> (meaning the player that will be selected isn't the one performing an action)</li> <li>Otherwise, if PartyInOrder returns false (meaning more than 1 member exists and swaps occured such that it is no longer in one of the 3 expected order), the reverse change will be done instead. This works because all combinations where the party is out of order happens to cycle in reverse order (intuitively, think of fixing the first number, your only choices are +1 and -1 in the cycle which locks in the last one and the latter choice is out of order while the former choice is in order)</li> </ul> <p>Additionally, a <code>Scroll</code> sound played on <code>sounds[10]</code> before changing the <code>option</code> and UpdateText is called after changing it.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectPlayer/#input-5-cancel","title":"Input 5 (cancel)","text":"<p>ReturnToMainSelect is called which does the following:</p> <ul> <li>The <code>Cancel</code> sound is played on AudioSource 10</li> <li>currentaction is set to <code>BaseAction</code></li> <li><code>option</code> is set to <code>lastoption</code></li> <li><code>selecteditem</code> is set to -1</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>SetMaxOptions is called</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectPlayer/#input-4-confirm","title":"Input 4 (confirm)","text":"<p>If itemarea is <code>AllParty</code>, <code>option</code> is set to <code>currentturn</code>.</p> <p>What happens after depends on the currentchoice (nothing happen if it's not among these <code>Actions</code>).</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectPlayer/#item","title":"<code>Item</code>","text":"<p>CheckItemUse is called with the <code>selecteditem</code> which may end starting a UseItem action coroutine changing to an uncontrolled flow.</p> <p>However, this item usage may be denied which won't cause UseItem to be called and instead, PlayBuzzer will be called.</p> <p>The condition for the item usage to be allowed is <code>playerdata[option].eatenby</code> must not exist and either <code>playerdata[option].hp</code> is above 0 or it's not, but the item data of <code>selecteditem</code> has a  <code>Revive</code> or <code>ReviveAll</code> <code>ItemUsage</code> (meaning the player party member isn't eaten, but it's dead while the item can revive them). It is disallowed otherwise.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectPlayer/#relay","title":"<code>Relay</code>","text":"<p>If CanBeRelayed returns true on <code>option</code>, a Relay action coroutine is started changing to an uncontrolled flow otherwise, PlayBuzzer is called.</p> <p>For CanBeRelayed to return true, all of the following must be true on <code>playerdata[option]</code> (false is returned otherwise):</p> <ul> <li>Its <code>hp</code> is above 0</li> <li>Its <code>lockrelayreceive</code> is false (nothing is preventing the actor from being relayed to)</li> <li>It doesn't have the Numb condition</li> <li>It doesn't have the Sleep condition</li> <li>It doesn't have the Freeze condition</li> <li>It doesn't have the Taunted condition</li> <li>It doesn't have the Sturdy condition</li> <li>It doesn't have the EventStop condition</li> <li>It doesn't have an <code>eatenby</code></li> </ul>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectPlayer/#swap","title":"<code>Swap</code>","text":"<p>A SwitchPos action coroutine is started changing to an uncontrolled flow to swap <code>currentturn</code> as the called with <code>option</code> as the target.</p>"},{"location":"Battle%20system/Player%20UI/Confirmation%20handling/SelectPlayer/#skill","title":"<code>Skill</code>","text":"<p>For the skill to be used, if the skilldata of <code>tempskill</code> reports that it can only target alive party members, <code>playerdata[target].hp</code> must be above 0. Alternatively, if the<code>skilldata</code> of <code>tempskill</code> reports that it can only target dead party members, <code>playerdata[target].hp</code> must be 0 or below. This doesn't apply if neither restrictions applies on the skill, but no matter what, <code>playerdata[target].eatenby</code> must not exist.</p> <p>If the skill can be used, a DoAction action coroutine is started changing to an uncontrolled flow on <code>playerdata[currentturn].battleentity</code> using <code>tempskill</code> as the action id.</p> <p>Otherwise, PlayBuzzer is called</p>"},{"location":"Battle%20system/Player%20UI/ItemList%20confirmation%20handling/Battle%20strategy%20list%20type/","title":"Battle strategy list type confirmation handling","text":"<p>This page describes the logic SetItem has when handling a listtype of Battle strategy.</p> <p>The logic depends on the <code>listvar</code> option:</p>"},{"location":"Battle%20system/Player%20UI/ItemList%20confirmation%20handling/Battle%20strategy%20list%20type/#271-swap","title":"271 (Swap)","text":"<p>This acts as if 0 (Switch) was selected if there is 2 or less <code>playerdata</code>.</p> <p>Otherwise:</p> <ul> <li>itemarea is set to <code>SingleAlly</code></li> <li>currentchoice is set to <code>Swap</code></li> <li><code>helpboxid</code> is set to -1</li> <li><code>excludeself</code> is set to true</li> <li>If <code>currentturn</code> is 0, <code>option</code> is set to 1</li> <li>GotoSelect without overridemax is called</li> </ul>"},{"location":"Battle%20system/Player%20UI/ItemList%20confirmation%20handling/Battle%20strategy%20list%20type/#2-do-nothing","title":"2 (Do Nothing)","text":"<p>DoNothing is called which does the following:</p> <ul> <li>If <code>playerdata[currentturn].didnothing</code> is false (the player party member didn't already did nothing), several effects can happen depending on at least 1 instance of a specific medal being equipped on the <code>currentturn</code> player party member (more can stack, these aren't mutually exclusive):<ul> <li><code>Meditation</code>: instance.<code>tp</code> is incremented by the amount of medals equipped then clamped from 0 to instance.<code>maxtp</code>. This is followed by the <code>Heal2</code> sound being played and <code>MagicUp</code> particles playing at <code>playerdata[currentturn].battleentity</code> position + (0.0, 0.5, 0.0)</li> <li><code>Prayer</code>: <code>playerdata[currentturn].hp</code> is incremented by the amount of medals equipped * 2 then clamped from 0 to <code>playerdata[currentturn].maxhp</code>. This is followed by the <code>Heal</code> sound being played (If no <code>Meditation</code> is equipped) and <code>Heal</code> particles playing at <code>playerdata[currentturn].battleentity</code> position + (0.0, 0.5, 0.0)</li> <li><code>Reflection</code>: If no <code>Prayer</code> or <code>Meditation</code> medals is equipped, the <code>StatUp</code> sound is played. This is followed by a StatEffect starting on the battleentity with type 1 (blue, up arrow) and if the player party member doesn't have the Reflection condition, SetCondition is called with <code>Reflection</code> on the player party member with a turn amount being the amount of medals equipped</li> </ul> </li> <li><code>playerdata[currentturn].didnothing</code> is set to true which prevents the medals effects to apply on a second do nothing</li> <li>EndPlayerTurn is called</li> <li>CancelList is called</li> </ul>"},{"location":"Battle%20system/Player%20UI/ItemList%20confirmation%20handling/Battle%20strategy%20list%20type/#0-switch","title":"0 (Switch)","text":"<p>The <code>Switch</code> sound is played followed by a SwitchParty action coroutine starting switching to an uncontrolled flow.</p>"},{"location":"Battle%20system/Player%20UI/ItemList%20confirmation%20handling/Battle%20strategy%20list%20type/#1-spy","title":"1 (Spy)","text":"<ul> <li>ItemList's <code>listredirect</code> is set to -1 (this is to workaround a potential inlist issue)</li> <li><code>availabletargets</code> is set to the return of GetTattleable which is all <code>enemydata</code> whose <code>notattle</code> is false</li> <li>If <code>availabletargets</code> is empty, PlayBuzzer is called followed by ReloadStrategy being called and invoked another time in 0.1 seconds. The method does the following (essentially denies the spy):<ul> <li>currentaction is set to <code>StrategyList</code></li> <li><code>helpboxid</code> is set to -1</li> <li>A couple of ItemList field are initialised (with an instance.<code>inputcooldown</code> of 5.0):<ul> <li><code>storeid</code>: 0</li> <li>listtype: 9 which is the battle strategy list type</li> <li><code>listammount</code>: 6</li> <li><code>listdesc</code>: true</li> <li><code>listsell</code>: false</li> </ul> </li> <li>ShowItemList is called with 9 as the list type, MainManager.<code>defaultlistpos</code> as the position with showdescription and without sell</li> <li>UpdateText is called</li> </ul> </li> <li>Otherwise (the spy is accepted):<ul> <li>CreateHelpBox with id 0 is called</li> <li>itemarea is set to <code>SingleEnemy</code></li> <li><code>maxoptions</code> is set to the length of <code>availabletargets</code></li> <li>currentaction is set to <code>SelectEnemy</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20UI/ItemList%20confirmation%20handling/Battle%20strategy%20list%20type/#3-flee","title":"3 (Flee)","text":"<p>If <code>canflee</code> is true, a TryFlee action coroutine is started changing to an uncontrolled flow. This ends the handler.</p> <p>If it's false however (this denies the flee with a message):</p> <ul> <li>CancelList is called</li> <li>ItemList's <code>listredirect</code> is set to -1 (this is to workaround a potential inlist issue)</li> <li>SetText is called in dialogue mode using <code>|</code>boxstyle<code>,4||</code>spd<code>,0|</code> followed by <code>menutext[73]</code> (a message informing the player they cannot flee) as the text and the following:<ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>linebreak of MainManager.<code>messagebreak</code></li> <li>No tridimensional</li> <li>position of Vector3.zero</li> <li>No cameraoffset</li> <li>size of Vector2.one</li> <li>No parent</li> <li>No caller</li> </ul> </li> <li>A <code>WaitForMessage</code> coroutine is started which yields as long as the message lock is grabbed followed by calling UpdateText followed by a frame yield</li> <li>UpdateText is called</li> </ul>"},{"location":"Battle%20system/Player%20UI/ItemList%20confirmation%20handling/Skills%20list%20type/","title":"Skills list type confirmation handling","text":"<p>This page describes the logic SetItem has when handling a listtype of Skills.</p> <ul> <li><code>maxoptions</code> is set to the length of <code>availabletargets</code>. This should be up to date as SetTargets was called the last time PlayerTurn happened while we were in the main vine menu</li> <li><code>tempskill</code> is set to the sent <code>listvar</code> option which is the chosen skill id</li> <li>currentchoice is set to <code>Skill</code></li> <li><code>helpboxid</code> is set to the one that comes from the skilldata, but if MainManager.<code>mashcommandalt</code> is true (sequential keys is set in the settings):<ul> <li>4 (<code>TappingKey</code>) is overriden to 8 (<code>RandomTappingKeysTimer</code>)</li> <li>10 (<code>RandomTappingBar</code>) is overriden to 8 (<code>RandomTappingKeysTimer</code>)</li> <li>11 (<code>RandomPressKeyTimer</code>) is overriden to 8 (<code>RandomTappingKeysTimer</code>)</li> <li>9 (<code>RandomPressBar</code>) is overriden to 12 (<code>MultiPressBar</code>)</li> </ul> </li> <li>itemarea is set to the <code>AttackArea</code> from skilldata</li> <li><code>excludeself</code> is set to the the value from skilldata</li> <li>If itemarea is <code>User</code>, there is no need to have GetChoiceInput handle this so it is handled immediately by starting a DoAction action coroutine changing to an uncontrolled flow</li> <li>Otherwise, GotoSelect is called with overridemax</li> </ul>"},{"location":"Battle%20system/Player%20UI/ItemList%20confirmation%20handling/Standard%20items%20list%20type/","title":"Standard items list type confirmation handling","text":"<p>This page describes the logic SetItem has when handling a listtype of standard items.</p> <ul> <li>We first check if the item is usable. There are 2 ways in which an item may not be usable:<ul> <li>Any <code>ItemUse</code> from itemdata has an <code>UsageType</code> of <code>None</code></li> <li>The AttackArea from itemdata is <code>AllEnemies</code> or <code>SingleEnemy</code> and GetAvaliableTargets for attackid -1 without onlyground or onlyground, but with excludeunderground causes <code>availabletargets</code> to become empty (in other words, the item affects one or all enemy party members, but there's no one above ground to be targetted)</li> </ul> </li> <li>If the item isn't usable, ReturnToMainSelect is called which does the following:<ul> <li>The <code>Cancel</code> sound is played on AudioSource 10</li> <li>currentaction is set to <code>BaseAction</code></li> <li><code>option</code> is set to <code>lastoption</code></li> <li><code>selecteditem</code> is set to -1</li> <li>DestroyHelpBox is called which sets <code>helpboxid</code> to -1 and destroys <code>helpbox</code> if it existed in 0.5 seconds with shrink before setting it to null</li> <li>SetMaxOptions is called</li> <li>UpdateText is called</li> </ul> </li> <li>Otherwise, if the item is usable:<ul> <li>currentchoice is set to <code>Item</code></li> <li>itemarea is set to the one from itemdata</li> <li><code>helpboxid</code> is set to -1</li> <li>GotoSelect is called without overridemax</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20actions/Player%20actions/","title":"Player Actions","text":"<p>This directory contains all the player actions logic contained in DoAction. They are important and complex enough to warrant its own directory in the BattleControl documentation.</p> <p>A player action is any piece of logic that is specific to the case where the actor sent to DoAction is a player party member. In that case, the actionid is an id that uniquely identifies an action (it may or may not be backed by a skill) and the actor's information as well as the battle state (such as <code>selecteditem</code> for an item usage) will be used alongside the actionid to determine the specific logic the action should be doing.</p> <p>Anything else is detailed in the DoAction documentation. For the enemy actions, check the enemy actions documentation.</p>"},{"location":"Battle%20system/Player%20actions/Player%20actions/#player-actions-table","title":"Player actions table","text":"<p>The following is a list of the action per their actionid. Please note the vast majority (but not all) of the actionid doubles as a skill id, but some of them (such as 9) have a broader meaning and some actionid aren't backed by a skill (such as regular attacks) and thus, doesn't have a corresponding skill. If a skill backs the action, its name and English name will be provided for convenience alongside some notes about its semantics if anything special is worth to mention.</p> <p>Here is the player actions table:</p> ID Name English Name Notes -2 - - The action for using a <code>LonglegSummoner</code> items. This action is documented here -1 - - Any player party member's basic attacks performed when confirming an Attack in the player UI:<ul><li>Bee</li><li>Beetle</li><li>Moth</li></ul> 0 RESERVED RESERVED This action is UNUSED 1 RESERVED2 RESERVED This action is UNUSED 2 BeeRangMultiHit Tornado Toss 3 BeetleTaunt Taunt 4 Icefall Icefall 5 BeeFly Fly Drop 6 BeetleDig Under Strike 7 BubbleShield Bubble Shield 8 Empower Charge Up 9 PeebleToss Pebble Toss This is also the action used for every toss item usage other than <code>LonglegSummoner</code>. Anything not in the following list will default to the default item toss action:<ul><li>abombhoney</li><li>BurlyBomb</li><li>CherryBomb</li><li>ClearBomb</li><li>FlameRock</li><li>FrostBomb</li><li>HardSeed</li><li>Ice</li><li>NumbBomb</li><li>NumbDart</li><li>PoisonBomb</li><li>PoisonDart</li><li>SleepBomb</li><li>SpicyBomb</li></ul> 10 HornDash Dash Through 11 SecretStash Secret Stash 12 DefenseBreak1 Break 13 DefenseBreakAll Break+ 14 AttackUp Empower 15 DefenseUp Fortify 16 NeedleToss Needle Toss 17 BubbleShieldLite Bubble Shield Lite 18 HurricaneBeemerang Hurricane Toss 19 PebbleTossPlus Boulder Toss 20 RevivalMassage Revival Massage There is no action for this skill 21 FrigidCoffin Frigid Coffin 22 ChargeUpPlus Charge Up+ 23 EmpowerPlus Empower+ 24 NeedlePincer Needle Pincer 25 IceRain Ice Rain 26 IceBeemerang Frost Relay 27 IceDrill Frozen Drill 28 AttackDown Enfeeble 29 AttackDownPlus Enfeeble+ 30 DefenseUpPlus Fortify+ 31 IceSphere Frost Bowling 32 HeavyStrike Heavy Strike 33 Sturdy Sturdy 34 FieldBeemerang Beemerang Toss There is no action for this skill 35 FieldHalt Beemerang Halt There is no action for this skill 36 FieldFly Bee Fly There is no action for this skill 37 FieldHorn Horn Slash There is no action for this skill 38 FieldDash Horn Dash There is no action for this skill 39 FieldDig Beetle Dig There is no action for this skill 40 FieldFreeze Freeze There is no action for this skill 41 FieldIcecle Icicle There is no action for this skill 42 FieldShield Shield There is no action for this skill 43 PepTalk Pep Talk 44 HeavyThrow Heavy Throw 45 SharingStash Sharing Stash 46 RoyalDecree Royal Decree 47 Cleanse Cleanse 48 HardCharge Hard Charge 49 FirstDash Dash There is no action for this skill"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Bee/","title":"<code>Bee</code>'s basic attack","text":""},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Bee/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 70.0 RandomPressBar {25.0, 70.0, 25.0, 2.0}"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Bee/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a DoCommand 1 set <code>commandsuccess</code> to true <code>Bee</code>'s player party member <code>availabletargets[target]</code> <code>Bee</code>'s <code>atk</code> unclamped null null false 1_b DoCommand 1 set <code>commandsuccess</code> to false <code>Bee</code>'s player party member <code>availabletargets[target]</code> <code>Bee</code>'s <code>atk</code> clamped from -99 to 1 null {FailSound} false"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Bee/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If in <code>demomode</code>, CreateHelpBox is called with id 0</li> <li><code>Bee</code> MoveTowards in front of party, but still left side of the stage at 2.0 multiplier</li> <li>Move the camera to be the halfway point between <code>Bee</code>'s destination position and targetentity (the enemy party member chosen)</li> <li>Yield until <code>Bee</code> is done with its <code>forcemove</code></li> <li><code>Bee</code>.animstate set to 103</li> <li>0.17 seconds yield</li> <li><code>Bee</code>.animstate set to 104</li> <li>DoCommand 1 call</li> <li>Frame yield</li> <li>Yield until <code>doingaction</code> is false (DoCommand is done)</li> <li>If <code>commandsuccess</code> is true (successful action command), <code>bee</code>.animstate is set to 105. If it's false (failed action command), it's set to 106 instead</li> <li>0.05 seconds yield</li> <li><code>Woosh</code> sound played on <code>sounds[8]</code> at 1.1 pitch on loop</li> <li>A <code>Prefabs/Objects/BeerangBattle</code> is instantiated and positioned above <code>Bee</code>. It will travel towards a position above <code>availabletargets[target]</code> (the selected enemy) and back using a BeizierCurve3 over the corse of 40.0 frames while continuously rotating on the z axis. The midpoint of the curve changes depending on <code>commandsuccess</code> (higher in the air if true, extruding the stage if false). The first time the object reaches the halfway point at 20.0 frames, its curve midpoint will change to be intruding the stage. On top of this, if <code>commandsuccess</code> is true when this happens, DoDomage 1_a is called</li> <li>The <code>BeerangBattle</code> is destroyed</li> <li>The <code>Woosh</code> sound is stopped with 0.1 fade speed</li> <li>if <code>commandsuccess</code> is false, DoDamage 1_b is called</li> <li>0.15 seconds yield</li> <li><code>bee</code>.animstate set to 13 (<code>BattleIdle</code>)</li> <li>0.25 seconds yield</li> </ul>"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Beetle/","title":"<code>Beetle</code>'s basic attack","text":""},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Beetle/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 20.0 HoldKeyCountdown {4.0, 1.0}"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Beetle/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a DoCommand 1 set <code>commandsuccess</code> to true <code>Beetle</code>'s player party member <code>availabletargets[target]</code> <code>Beetle</code>'s <code>atk</code> unclamped Flip null false 1_b DoCommand 1 set <code>commandsuccess</code> to false while <code>DoublePain</code> is unequipped and HARDEST isn't active <code>Beetle</code>'s player party member <code>availabletargets[target]</code> <code>Beetle</code>'s <code>atk</code> clamped from 0 to 1. NOTE: This incorrectly removes influences of negative <code>atk</code> values Flip {FailSound} false 1_c DoCommand 1 set <code>commandsuccess</code> to false while <code>DoublePain</code> is equipped or HARDEST is active <code>Beetle</code>'s player party member <code>availabletargets[target]</code> <code>Beetle</code>'s <code>atk</code> / 2 floored, unclamped. NOTE: This incorrectly increases <code>atk</code> when it is negative. Additionally, it can also result in a higher value than 1_b's damageammount if the <code>atk</code> value is high enough which is unexpected null {FailSound} false"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Beetle/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If in <code>demomode</code>, CreateHelpBox is called with id 1</li> <li>Camera is moved to look at targetentity</li> <li>targetentity gets <code>overridejump</code> set to true</li> <li><code>Beetle</code> MoveTowards in front of the enemy (calculated based on its <code>size</code> or <code>freezesize</code>)</li> <li>Yield until <code>Beetle</code> is done with its <code>forcemove</code></li> <li>Camera zooms in slightly</li> <li><code>Beetle</code> animstate set to 103</li> <li>DoCommand 1 call happens</li> <li>Yield until <code>doingaction</code> is false</li> <li>Camera zooms out slightly</li> <li>If <code>commandsuccess</code> (the action command succeeded):<ul> <li>DoDamage 1_a call happens</li> <li><code>Beetle</code> animstate set to 104</li> <li>BounceEnemy for the targetentity with bounce of 0 and multiplier of 1.0</li> <li>yield until the BounceEnemy is done</li> <li>0.15 seconds yield</li> </ul> </li> <li>Otherwise (the action command failed)<ul> <li>If flags 614 is false (HARDEST is inactive) and <code>DoublePain</code> medal is unequipped, DoDamage 1_b call happens</li> <li>Otherwise (on hard mode or HARDEST), DoDamage 1_c call happens</li> <li><code>Beetle</code> gets <code>overridejump</code> and <code>overrideanim</code> set to true</li> <li><code>Beetle</code> jumps with an animstate of 106 and a slight -z <code>spin</code></li> <li>0.3 seconds yielded</li> <li><code>Beetle</code> animstate set to 105 with a very slight +z <code>spin</code></li> <li>Yield until <code>Beetle</code> is <code>onground</code></li> <li><code>Beetle</code> animstate set to 107</li> <li><code>Prefabs/Particles/deathsmokelow</code> instantated and destroyed in 1.0 seconds</li> <li>Frame yield</li> <li><code>Beetle</code> x/z angles reset to 0.0 and <code>spin</code> zeroed out</li> <li>0.45 seconds yield</li> </ul> </li> <li>targetentity gets <code>overrideanim</code> set to false</li> <li><code>Beetle</code> gets <code>overridejump</code> and <code>overrideanim</code> set to false</li> <li><code>Beetle</code> spin is zeroed out</li> <li>targetentity gets <code>overridejump</code> set to false</li> </ul>"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Moth/","title":"<code>Moth</code>'s basic attack","text":""},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Moth/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 25.0 RandomPressKeyTimer {0.0, 4.0}"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Moth/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a DoCommand 1 set <code>commandsuccess</code> to true <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> unclamped Magic {NoSound} false 1_b DoCommand 1 set <code>commandsuccess</code> to false <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> clamped from 0 to 1. NOTE: This incorrectly removes influences of negative <code>atk</code> values null {NoSound} false"},{"location":"Battle%20system/Player%20actions/Basic%20attacks/Moth/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If in <code>demomode</code>, CreateHelpBox is called with id 2</li> <li>Camera is zoomed in at 0.01 speed from the midpoint between <code>Moth</code> and targetentity</li> <li><code>IceMothThrow</code> sound plays</li> <li><code>Moth</code> animstate set to 108</li> <li>A <code>Prefabs/AnimSpecific/mothbattlesphere</code> is instantiated a bit up-left from <code>Moth</code> position with 90.0 degress rotatex in x with a <code>Prefabs/Objects/SingleSphere</code> as child at half transparency. The <code>mothbattlesphere</code> will be destroyed in 2.0 seconds</li> <li>DoCommand 1 happens</li> <li>Yield until DoCommand is done</li> <li>Camera is reset to default at 0.3 speed</li> <li>A <code>Prefabs/Particles/mothicenormal</code> appears slighly up from targetentity with x rotation of -90.0 and destroyed in 2.0 seconds</li> <li><code>Prefabs/Objects/icepillar</code> appears at targetentity with x rotation of -90.0, a DialogueAnim with x/y targetscale of 0.5 and destroyed in 4.0 seconds</li> <li>If <code>commandsuccess</code> is true (action command succeeded):<ul> <li><code>Moth</code> animstate set to 111</li> <li>DoDamage 1_a happens</li> <li><code>IceMothHit</code> sound plays</li> <li>1.0 second yield</li> </ul> </li> <li>Otherwise (action command failed):<ul> <li><code>icepillar</code>'s DialogueAnim targetscale is set to (0.4, 0.4, 0.5)</li> <li><code>Moth</code> animstate set to 109</li> <li><code>IceMothMiss</code> sound plays</li> <li>DoDamage 1_b happens</li> <li>1.2 seconds yield</li> <li>A <code>Prefabs/Particles/IceShatter</code> appears slighly up from <code>Moth</code> with x rotation of -90.0 and destroyed in 1.0 seconds</li> <li><code>Moth</code> animstate set to 0 (<code>Idle</code>)</li> </ul> </li> <li>If <code>Prefabs/Objects/icepillar</code> still exists, its DialogueAnim is set to shrink at 0.05 speed</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/Abombhoney/","title":"<code>Abombhoney</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/Abombhoney/#object-movement","title":"Object movement","text":"<p>The object will move to (0.0, 0.0, -0.5) with a ymax of 5.0 instead.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/Abombhoney/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Done for each player party member whose <code>hp</code> is above 0 without an eatenby without <code>plating</code> and without a Shield condition null The player party member 10 NoExceptions empty array false 2 Done for each enemy party members without a Shield condition and whose enemy id isn't <code>Ahoneynation</code> or <code>Abomihoney</code> null The enemy party member 10 NoExceptions empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/Abombhoney/#effects-on-player-party-members","title":"Effects on player party members","text":"<p>Only applies to those with an <code>hp</code> above 0 without an eatenby:</p> <ul> <li>If the player party member has the Shield condition, it is removed via RemoveCondition followed by their <code>shieldenabled</code> set to false</li> <li>If the above didn't apply and they don't have <code>plating</code>, DoDamage 1 call happens with them. If they did had a <code>plating</code>, the DoDamage call won't happen, but their <code>plating</code> is set to false</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/Abombhoney/#effects-on-enemy-party-members","title":"Effects on enemy party members","text":"<ul> <li>If the enemy party member has the Shield condition, it is removed via RemoveCondition followed by their <code>shieldenabled</code> set to false</li> <li>Otherwise, if their enemy id is <code>Ahoneynation</code> or <code>Abomihoney</code>, Heal is called on them to heal for 10 <code>hp</code></li> <li>Otherwise, DoDamage 2 call happens on them</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/Abombhoney/#effects-on-player-party","title":"Effects on player party","text":"<ul> <li>If not all of the applicable player party members above had a Shield condition:<ul> <li>instance.<code>tp</code> is increased by instance.<code>maxtp</code> * 0.4 floored clamped from 6 to 12. instance.<code>tp</code> is then clamped again from 0 to instance.<code>maxtp</code></li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/Abombhoney/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Splat1</code> sound plays</li> <li><code>Fuse</code> sound plays</li> <li><code>Prefabs/Objects/Abombnation</code> instantiated rooted at the object position</li> <li>The object is destroyed</li> <li>Yield for 2.0 seconds</li> <li><code>explosion</code> particles plays at the <code>Prefabs/Objects/Abombnation</code> position</li> <li><code>Explosion3</code> sound plays</li> <li><code>Splat2</code> sound plays</li> <li><code>Prefabs/Objects/Abombnation</code> destroyed</li> <li>ShakeScreen with ammount of 0.25 for 0.75 time</li> <li>The player party members effects described above are performed</li> <li>The enemy party members effects described above are performed</li> <li><code>Sprites/Objects/splatter</code> instantiated</li> <li>The following is done exactly 3 times (the position and scale of the splatter are hardcoded):<ul> <li>A new UI object called <code>splat</code> is created childed to the <code>GUICamera</code> with the corresponding position and scale that was hardcoded and a sortorder of -5 - index (between 0 and 2) with a flipX of false except for the second one</li> <li>A DialogueAnim is added to <code>splat</code> with a <code>targetscale</code> of its initial scale and a <code>shrinkspeed</code> of 0.15</li> <li>scale of <code>splat</code> set to Vector3.zero (so it will grow to its hardcoded scale)</li> <li><code>splat</code>'s <code>color</code> set to FFBF00 (bright orange)</li> <li>Yield for 0.025 seconds</li> </ul> </li> <li>Over the course of 100.0 frames (only on the last 50.0 frames), the alpha of all the <code>splat</code> colors goes to 0.0 (transparent)</li> <li>All the <code>splat</code> are destroyed</li> <li>If not all of the applicable player party members above had a Shield condition:<ul> <li>ShowDamageCounter is called with type 2 (TP counter) with ammount of instance.<code>maxtp</code> * 0.4 floored clamped from 6 to 12 starting at the attacker + Vector3.up and ending at (0.0, 2.0, 0.0)</li> <li>instance.<code>tp</code> is increased by the same ammount then clamped from 0 to instance.<code>maxtp</code></li> <li><code>Heal2</code> sound plays</li> <li>Yield for 0.5 seconds</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/BurlyBomb/","title":"<code>BurlyBomb</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/BurlyBomb/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None null <code>availabletargets[target]</code> 4 null empty array false 2 Done for each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5 null The enemy party member 2 null empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/BurlyBomb/#defensedown-infliction","title":"DefenseDown infliction","text":"<p>After DoDamage 1, the <code>target</code> enemy party member will have StatusEffect called on it to inflict DefenseDown for 2 turns with visual effects.</p> <p>After DoDamage 2, the applicable enemy party member will have the same thing happen, but for 3 turns instead.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/BurlyBomb/#item-logic","title":"Item logic","text":"<ul> <li>DoDamage 1 call happens and its related StatusEffect call</li> <li><code>explosion</code> particles plays at the <code>target</code> enemy party member</li> <li>For each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5, DoDamage 2 call happens with them and its related StatusEffect call</li> <li><code>Explosion</code> sound plays</li> <li>ShakeScreen is called with an ammount of (0.1, 0.1, 0.1) for 0.15 time</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/CherryBomb/","title":"<code>CherryBomb</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p> <p>It's a special item action because <code>selecteditem</code> will get overriden to be one of the following item ids with uniform probabilities:</p> <ul> <li><code>SpicyBomb</code></li> <li><code>PoisonBomb</code></li> <li><code>FrostBomb</code></li> <li><code>NumbBomb</code></li> <li><code>SleepBomb</code></li> <li><code>BurlyBomb</code></li> </ul> <p>The logic performed is the same than the new value of <code>selecteditem</code> with one exception: every DoDamage calls will have its damageammount increased by 2 compared to the normal call.</p> <p>The rest is the same than if it was the actual overriden item.</p> <p>There is some dead logic specifically related to this item however and it only contains the following DoDamage call, but it never happens under normal gameplay:</p> Conditions attacker target damageammount property overrides block Done for each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5 null The enemy party member 5 null empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/ClearBomb/","title":"<code>ClearBomb</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/ClearBomb/#object-movement","title":"Object movement","text":"<p>Since this targets everyone, the object will move to Vector3.zero with a ymax of 5.0 instead.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/ClearBomb/#item-logic","title":"Item logic","text":"<ul> <li>The object is destroyed</li> <li><code>checkingdead</code> is set to a new ClearBombEffect coroutine (see the section below for details)</li> <li>Yield until <code>checkingdead</code> is null</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/ClearBomb/#clearbombeffect","title":"ClearBombEffect","text":"<p>This is a parameterless coroutine specifically made for this action. It sets <code>checkingdead</code> to null once completed:</p> <ul> <li><code>IceBreak</code> sound plays at 0.6 volume</li> <li><code>impactsmoke</code> particles plays at Vector3.zero</li> <li>Yield for 0.3 seconds</li> <li><code>impactsmoke</code> particles plays at (-3.0, 0.0, 0.0)</li> <li>Yield for 0.3 seconds</li> <li><code>impactsmoke</code> particles plays at (3.0, 0.0, 0.0)</li> <li>Yield for 0.3 seconds</li> <li>ClearStatus is called on each enemy party members</li> <li>ClearStatus is called on each player party members</li> <li><code>checkingdead</code> is set to null signaling that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/Default%20toss%20action/","title":"Default toss action","text":"<p>This action is a toss item action and as such, parts of its logic are based off the PeebleToss action.</p> <p>This is an action logic defined that normally doesn't happen under normal gameplay. It would happen for any toss item (has a Battle itemUse), but whose item id does not belong in the list of action backed items documented here. In that case, the logic defaults to the following DoDamage call:</p> # Conditions attacker target damageammount property overrides block 1 Done for each player party member whose <code>hp</code> is above 0 and who doesn't have an eatenby null The player party member 10 NoExceptions empty array false 2 Done for each enemy party member who doesn't have a Shield condition and whose enemy id isn't <code>Ahoneynation</code> or <code>Abomihoney</code> null The enemy party member 10 NoExceptions empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/FlameRock/","title":"<code>FlameRock</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/FlameRock/#item-logic","title":"Item logic","text":"<p>The folowing DoDamage call happens:</p> attacker target damageammount property overrides block null <code>availabletargets[target]</code> 2, but if the target has a Magic in its weakness, it's 4 instead Fire empry array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/FrostBomb/","title":"<code>FrostBomb</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/FrostBomb/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None null <code>availabletargets[target]</code> 5 Freeze empty array false 2 Done for each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5 null The enemy party member 3 Freeze empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/FrostBomb/#item-logic","title":"Item logic","text":"<ul> <li>DoDamage 1 call happens</li> <li><code>mothicenormal</code> particles plays at the <code>target</code> enemy party member with a uniform scale of 3.0x</li> <li>For each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5, DoDamage 2 call happens with them</li> <li><code>Explosion</code> sound plays</li> <li>ShakeScreen is called with an ammount of (0.1, 0.1, 0.1) for 0.15 time</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/HardSeed/","title":"<code>HardSeed</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/HardSeed/#item-logic","title":"Item logic","text":"<p>The folowing DoDamage call happens:</p> attacker target damageammount property overrides block null <code>availabletargets[target]</code> 2 null empry array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/Ice/","title":"<code>Ice</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/Ice/#item-logic","title":"Item logic","text":"<p>The folowing DoDamage call happens:</p> attacker target damageammount property overrides block null <code>availabletargets[target]</code> 2 Freeze empry array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/LonglegSummoner/","title":"<code>LonglegSummoner</code>","text":"<p>This action has a special id being -2 and it is reserved specifically when using a <code>LongLegSummoner</code> item.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/LonglegSummoner/#no-charges-usage-items-and-skill","title":"No charges usage (items and skill)","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/LonglegSummoner/#logic-sequence","title":"Logic Sequence","text":"<p>What happens here is:</p> <ul> <li><code>checkingdead</code> is set to a new LongLeg coroutine with the attacker as the entity and <code>enemydata[target]</code> as the target</li> <li>Yield until <code>checkingdead</code> is null (happens when LongLeg is fully done)</li> </ul> <p>So most of the logic is into the LongLeg coroutine which is what will be documented here.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/LonglegSummoner/#longleg","title":"LongLeg","text":"<p>A coroutine specific to a <code>LongLegSummoner</code> item item logic. entity is the user and target is the receiver of the item's effects.</p> <p>It interestingly supports the target being a player party member and an entity being an enemy party member which allows to have an enemy party member simulate the usage of the item as if the player party used it during enemy actions.</p> <p>It is expected that the caller sets the coroutine to <code>checkingdead</code> which will be set to null when the coroutine is done.</p> <pre><code>private IEnumerator LongLeg(EntityControl entity, MainManager.BattleData target)\n</code></pre>"},{"location":"Battle%20system/Player%20actions/Items%20usage/LonglegSummoner/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a target is a player party member null <code>playerdata[playertargetID]</code> 6 Flip<sup>1</sup> empty array <code>commandsuccess</code> 1_b target is an enemy party member null target enemy party member 6 Flip empty array false <p>1: This property gets overriden to null in CalculateBaseDamage as the target is a player party member so it does nothing.</p> <p>Here is its logic:</p> <ul> <li><code>dontusecharge</code> set to true</li> <li>Camera moves slowly towards the target slightly to the left, up and behind</li> <li>entity animstate set to 28 (<code>TossItem</code>)</li> <li>A new sprite is created rooted a bit up from the entity using the <code>LonglegSummoner</code> item's <code>itemsprites</code></li> <li><code>Toss</code> sound plays</li> <li>Over the course of 51.0 frames, the sprite moves towards the front of the target (relative to which side the target is) using a BeizierCurve3 with a ymax of 5.0. During the move, the z angle is set to framestep * -10.0 (* -1.0 if the target is on the left of the entity)</li> <li>entity animstate reset to the value before this coroutine</li> <li><code>LongLegsGrow</code> sound plays</li> <li><code>Prefabs/Objects/LongLegs</code> instantiated offscreen with Vector3.zero scale either rotated 0.0 or 180.0 in y depending on which side the target is and its animator is obtained</li> <li>DeathSmoke particles plays where the sprite landed</li> <li>The sprite is destroyed</li> <li>Yield for a frame</li> <li><code>Prefabs/Objects/LongLegs</code> position set to where the sprite was</li> <li>Over the course of 31.0 frames, the <code>Prefabs/Objects/LongLegs</code> moves up by 4.75 in y via a SmoothLerp while its scale goes to (1.0, 1.0, -1.0) via a SmoothLerp</li> <li>The <code>Stomp</code> animation clip plays from <code>Prefabs/Objects/LongLegs</code></li> <li><code>Grow1</code> sound plays</li> <li>Yield for 0.75 seconds</li> <li>The <code>Stomp2</code> animation clip plays from <code>Prefabs/Objects/LongLegs</code></li> <li><code>longLegsStomp</code> sound plays</li> <li>Yield for 0.15 seconds</li> <li>DoDamage 1_a or 1_b happens depending on the party of target</li> <li>Yield for 0.75 seconds</li> <li>Over the course of 31.0 frames, the <code>Prefabs/Objects/LongLegs</code> moves down by 4.75 in y via a SmoothLerp while its scale goes to Vector3.zero via a SmoothLerp</li> <li>DeathSmoke particles plays at the <code>Prefabs/Objects/LongLegs</code> position</li> <li><code>ChargeDown2</code> sound plays</li> <li><code>Prefabs/Objects/LongLegs</code> is destroyed</li> <li>Yield for 0.5 seconds</li> <li><code>checkingdead</code> is set to null which signals the caller that the coroutine is done</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/NumbBomb/","title":"<code>NumbBomb</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/NumbBomb/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None null <code>availabletargets[target]</code> 5 Numb1Turn empty array false 2 Done for each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5 null The enemy party member 3 Numb1Turn empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/NumbBomb/#item-logic","title":"Item logic","text":"<ul> <li>DeathSmoke particles plays at the <code>target</code> enemy party member with a uniform scale of 3.0x</li> <li><code>ElecFast</code> particles plays at the <code>target</code> enemy party member with a uniform scale of 2.0x</li> <li>DoDamage 1 call happens</li> <li>For each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5, DoDamage 2 call happens with them</li> <li><code>Explosion</code> sound plays</li> <li>ShakeScreen is called with an ammount of (0.1, 0.1, 0.1) for 0.15 time</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/NumbDart/","title":"<code>NumbDart</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/NumbDart/#item-logic","title":"Item logic","text":"<p>The folowing DoDamage call happens:</p> attacker target damageammount property overrides block null <code>availabletargets[target]</code> 2 Sleep empry array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/NumbDart/#object-movement","title":"Object movement","text":"<p>The starting angle of the object in z is 135.0.</p> <p>As for the movement, it will occur over the course of 25.0 frames instead of 40.0 without rotation and the movement is done via a simple lerp.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/PoisonBomb/","title":"<code>PoisonBomb</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/PoisonBomb/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None null <code>availabletargets[target]</code> 5 Poison empty array false 2 Done for each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5 null The enemy party member 3 Poison empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/PoisonBomb/#item-logic","title":"Item logic","text":"<ul> <li>DoDamage 1 call happens</li> <li><code>PoisonEffect</code> particles plays at the <code>target</code> enemy party member</li> <li>For each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5, DoDamage 2 call happens with them</li> <li><code>Explosion</code> sound plays</li> <li>ShakeScreen is called with an ammount of (0.1, 0.1, 0.1) for 0.15 time</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/PoisonDart/","title":"<code>PoisonDart</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/PoisonDart/#item-logic","title":"Item logic","text":"<p>The folowing DoDamage call happens:</p> attacker target damageammount property overrides block null <code>availabletargets[target]</code> 2 Poison empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/PoisonDart/#object-movement","title":"Object movement","text":"<p>The starting angle of the object in z is 135.0.</p> <p>As for the movement, it will occur over the course of 25.0 frames instead of 40.0 without rotation and the movement is done via a simple lerp.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/SleepBomb/","title":"<code>SleepBomb</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/SleepBomb/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None null <code>availabletargets[target]</code> 5 Sleep empty array false 2 Done for each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5 null The enemy party member 3 Sleep empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/SleepBomb/#item-logic","title":"Item logic","text":"<ul> <li>DeathSmoke particles plays at the <code>target</code> enemy party member with a uniform scale of 4.0x</li> <li>DoDamage 1 call happens</li> <li>For each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5, DoDamage 2 call happens with them</li> <li><code>Explosion</code> sound plays</li> <li>ShakeScreen is called with an ammount of (0.1, 0.1, 0.1) for 0.15 time</li> </ul>"},{"location":"Battle%20system/Player%20actions/Items%20usage/SpicyBomb/","title":"<code>SpicyBomb</code>","text":"<p>This item is a toss item and as such, parts of its logic are based off the PeebleToss action.</p>"},{"location":"Battle%20system/Player%20actions/Items%20usage/SpicyBomb/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None null <code>availabletargets[target]</code> 5 Pierce empty array false 2 Done for each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5 null The enemy party member 3 null empty array false"},{"location":"Battle%20system/Player%20actions/Items%20usage/SpicyBomb/#item-logic","title":"Item logic","text":"<ul> <li>DoDamage 1 call happens</li> <li><code>explosion</code> particles plays at the <code>target</code> enemy party member</li> <li>For each enemy party member other than the <code>target</code> whose position + <code>freezeoffset</code> + their <code>height</code> in y has a square distance off the object after movement less than 15.5, DoDamage 2 call happens with them</li> <li><code>Explosion</code> sound plays</li> <li>ShakeScreen is called with an ammount of (0.1, 0.1, 0.1) for 0.15 time</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/AttackDown/","title":"<code>AttackDown</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>AddBuff is called which does a SetCondition to inflict the AttackDown conditiion on <code>target</code> enemy party member for 2 turns</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/AttackDown/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/AttackDown/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> set to true</li> <li>attacker animstate set to 111</li> <li><code>FastWoosh</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>AddBuff is called which does a SetCondition to inflict the AttackDown conditiion on <code>target</code> for 2 turns</li> <li>StatEffect called on <code>target</code> with type 2 (red down arrow)</li> <li>A SpriteBounce is added on the <code>target</code>'s <code>rotater</code> with <code>speed</code> of 20.0</li> <li><code>target</code> animstate set to 30 (<code>FakeHurt</code>)</li> <li><code>StatDown</code> sound plays</li> <li><code>Prefabs/Particles/MagicUp</code> particles instantiated and played at <code>target</code> + 0.5 in y</li> <li>Yield for 0.85 seconds</li> <li>The SpriteBounce of the <code>target</code> is destroyed</li> <li>Yield for a frame</li> <li>The scale of <code>target</code> is reset to its initial value before the action</li> <li>Yield for 0.1 seconds</li> <li><code>Prefabs/Particles/MagicUp</code> of the <code>target</code> moved offscreen and destroyed</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/AttackDownPlus/","title":"<code>AttackDownPlus</code>","text":"<p>The same as AttackDown, but with the following changes:</p> <ul> <li>The action applies to all enemy party members instead of just the <code>target</code> one. This include the AddBuff call and any visual effects or animation logic</li> <li>The AttackDown condition is inflicted for 3 turns per enemy party members instead of 2 for just the <code>target</code> one</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/AttackDownPlus/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/AttackUp/","title":"<code>AttackUp</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>AddBuff is called which does a SetCondition to inflict the AttackUp conditiion on <code>target</code> for 2 turns</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/AttackUp/#battle-itemusage","title":"Battle ItemUsage","text":"<p>This action will be processed if a <code>VitalitySeed</code> item is used with a <code>Battle</code> ItemUsage. If this is what caused this action, it features less animation logic.</p>"},{"location":"Battle%20system/Player%20actions/Skills/AttackUp/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/AttackUp/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> is set to true</li> <li>If currentaction is <code>ItemList</code> (the action was called from item usage):<ul> <li>Yield for 0.25 seconds</li> </ul> </li> <li>Otherwise (the action was called from skill usage):<ul> <li><code>Magic</code> sound plays</li> <li><code>Prefabs/Particles/MagicUp</code> particles instantiated slightly above the attacker</li> <li>attacker animstate set to 4 (<code>ItemGet</code>)</li> <li>attacker y spin set to -20.0</li> <li><code>target</code> player party member's y <code>spin</code> set to -15.0</li> <li>Yield for 0.75 seconds</li> <li><code>Prefabs/Particles/MagicUp</code> particles moved offscreen</li> <li><code>Prefabs/Particles/MagicUp</code> particles destroyed in 5.0 seconds</li> </ul> </li> <li><code>StatUp</code> sound plays</li> <li>AddBuff is called which does a SetCondition to inflict the AttackUp conditiion on <code>target</code> for 2 turns</li> <li>StatEffect called on the <code>target</code> with type 0 (red up arrow)</li> <li><code>target</code>'s <code>spin</code> is zeroed out</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/BeeFly/","title":"<code>BeeFly</code>","text":"<p>This is a MultiSkillMove with <code>Bee</code> and <code>Beetle</code> and as such, it is assumed that the attacker is either one and it also means that post-action won't consume their actor turns like normal.</p>"},{"location":"Battle%20system/Player%20actions/Skills/BeeFly/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 170.0 TappingKey {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input), 8.0, 0.8, 1.0} 2 DoCommand 1 set <code>barfill</code> above 0.5 50.0 * <code>barfill</code> clamped from 25.0 to 50.0 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)}"},{"location":"Battle%20system/Player%20actions/Skills/BeeFly/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a DoCommand 2 executed and set <code>commandsuccess</code> to true null <code>availabletargets[target]</code> GetMultiDamage for <code>Bee</code> and <code>Beetle</code> + 2 then 2 is added to it if <code>barfill</code> is 1.0 or higher Pierce empty array false 1_b Either DoCommand 2 didn't executed or it did, but set <code>commandsuccess</code> to false null <code>availabletargets[target]</code> (GetMultiDamage for <code>Bee</code> and <code>Beetle</code> + 2 then 2 is added to it if <code>barfill</code> is 1.0 or higher) * 0.25 floored clamped from 1 to 99 null empty array false 2 DoDamage 1_a happened and the <code>target</code> enemy party member position is <code>Flying</code> with a <code>ToppleFirst</code> weakness null <code>availabletargets[target]</code> 1 Pierce {NoCounter} false"},{"location":"Battle%20system/Player%20actions/Skills/BeeFly/#logic-seqeunce","title":"Logic seqeunce","text":"<ul> <li>Both <code>Bee</code> and <code>Beetle</code> have LockRigid(true) called on them with <code>overrideanim</code> and <code>overridejump</code> set to true</li> <li><code>Jump</code> sound plays</li> <li>Over the course of 31.0 frames, <code>Bee</code> moves to <code>Beetle</code> + Vector3.up via a BeizierCurve3 with a ymax of 4.0. During the move, <code>Bee</code> animstate is set to 2 (<code>Jump</code>)</li> <li>Camera moves slowly to look at the <code>target</code> enemy party member + 4.25 + its <code>height</code> in y and -9.5 in z</li> <li><code>BeeFly</code> sound plays on <code>sounds[9]</code> on loop</li> <li><code>Bee</code> position set to <code>Beetle</code>'s - 0.1 in z</li> <li><code>Bee</code> and <code>Beetle</code> animstate set to 102</li> <li><code>Beetle</code> gets childed to <code>Bee</code></li> <li>DoCommand 1 call happens and it's set to <code>actionroutine</code></li> <li>Over the course of 171.0 frames, <code>Bee</code> moves towards the <code>target</code> enemy party member's world CenterPos + (0.0, 0.0 -0.1) in x and for the y, it's the same, but + 5.0 + a lerp from 0.5 to 5.0 with a factor of <code>barfill</code> (the z is 0.0). Essentially, <code>Bee</code> will move up more as <code>barfil</code> fills up, but will still align themselves with the <code>target</code> enemy party member horizontally. During the move, <code>sounds[9]</code> pitch is set to a lerp from 1.0 to 1.2</li> <li><code>sounds[9]</code> is stopped</li> <li><code>Fall</code> sound plays</li> <li><code>Beetle</code> gets childed back to the <code>battlemap</code></li> <li><code>Beetle</code> animstate set to 119</li> <li><code>Beetle</code>'s <code>sprite</code>.flipY set to true</li> <li><code>Beetle</code>'s y <code>spin</code> set to 25.0 * <code>barfill</code></li> <li><code>Bee</code> animstate set to 114</li> <li>If <code>barfill</code> is higher than 0.5 (by then, DoCommand 1 should be done even if it wasn't confirmed finished):<ul> <li>FinishAction is called manualled to end DoCommand 1 if it wasn't already (but it should be by then)</li> <li>Yield for 0.5 seconds</li> <li>DoCommand 2 call happens</li> </ul> </li> <li>Over the course of x frames, but continued indefinetely if <code>doingaction</code> is still true (x is 50.0 * <code>barfill</code> clamped from 25.0 to 50.0):<ul> <li><code>Bee</code> moves to 20.0 in x and up by 10.0 in y from their current position via a BeizierCurve3 with a ymax of -3.0</li> <li><code>Beetle</code> moves to the <code>target</code> enemy party member's world CenterPos + (0.0, 0.0 -0.1)</li> </ul> </li> <li><code>Bee</code> is moved offscreen</li> <li>If <code>commandsuccess</code> is true (by this point, DoCommand 2 is confirmed finished):<ul> <li><code>AtkSuccess</code> sound plays</li> <li>ShakeScreen with 0.2 ammount and 0.5 time with dontreset</li> <li><code>HugeHit</code> sound plays</li> <li>DoDamage 1_a call happens</li> <li>If the <code>target</code> enemy party member position is <code>Flying</code> with a <code>ToppleFirst</code> weakness, DoDamage 2 call happens</li> <li>Yield until <code>Beetle</code> y position gets to 0.0 or lower while it decreases by 1/4 of the game's frametime every frame</li> <li><code>DirtExplode</code> particles plays at <code>Beetle</code> position</li> <li><code>Dig</code> sound plays at 1.2 pitch</li> <li><code>Beetle</code>'s <code>digging</code> is set to true</li> <li><code>Beetle</code>'s <code>sprite</code>.flipY is reset to false</li> <li><code>Beetle</code>'s <code>spin</code> is zeroed out</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>Otherwise (<code>commandsuccess</code> is false):<ul> <li>DoDamage 1_b call happens</li> <li><code>Beetle</code> animstate set to 105</li> <li><code>Beetle</code>'s <code>sprite</code>.flipY is reset to false</li> <li><code>Beetle</code>'s <code>spin</code> is zeroed out</li> <li>Over the course of 51.0 frames, <code>Beetle</code> moves to its initial position before this action via a BeizierCurve3 with a ymax of 5.0</li> </ul> </li> <li>Camera is reset to default</li> <li>Over the course of 46.0 frames:<ul> <li><code>Bee</code> moves to their initial position before this action + Vector3.down</li> <li>If <code>commandsuccess</code> is true, <code>Beetle</code> moves to its initial position before this action</li> </ul> </li> <li><code>Bee</code> animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>Bee</code> has SetAnim called with empty args with force</li> <li><code>Bee</code> position is set to their initial position before this action</li> <li>If <code>Beetle</code> is <code>digging</code>:<ul> <li><code>DigPop</code> sound plays</li> <li><code>DirtExplode</code> particles plays at <code>Beetle</code> position</li> </ul> </li> <li>Both <code>Bee</code> and <code>Beetle</code> have LockRigid(false) called on them with <code>digging</code>, <code>overrideanim</code> and <code>overridejump</code> set to true</li> <li>MultiSkillMove is called with 0 and 1 (normally <code>Bee</code> and <code>Beetle</code>)</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/BeeRangMultiHit/","title":"<code>BeeRangMultiHit</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/BeeRangMultiHit/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 0.01 LongRandomBar <ul><li>{3.0, 1.25} if <code>Beemerang2</code> medal is not equipped</li><li>{4.0, 1.25} if <code>Beemerang2</code> medal is equipped</li></ul>"},{"location":"Battle%20system/Player%20actions/Skills/BeeRangMultiHit/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None <code>playerdata[currentturn]</code> <code>availabletargets[target]</code> <code>playerdata[currentturn].atk</code> - 1 clamped from 0 to 99. NOTE: This incorrectly ignores a base <code>atk</code> of 0 or lower due to the lower bound clamp null Empty array false 2_a DoDamage 1's result was higher than 0 null <code>availabletargets[target]</code> DoDamage 1's result - <code>i</code>, done <code>successfulchain</code> - 1 times (value after DoCommand 1) where <code>i</code> starts at 1 and increments after each iteration NoExceptions Empty array false 2_b DoDamage 1's result was 0 or lower null <code>availabletargets[target]</code> 0, done <code>successfulchain</code> - 1 times (value after DoCommand 1) null null false"},{"location":"Battle%20system/Player%20actions/Skills/BeeRangMultiHit/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>combo</code> set to 0</li> <li>Camera moved to zoom in slowly towards the left of the stage</li> <li>attacker MoveTowards in front of the party, but still towards the left side of the stage</li> <li>Yield until attacker is done with its <code>forcemove</code></li> <li>attacker animstate set to 100</li> <li>Yield for 0.3 seconds</li> <li>DoCommand 1 happens</li> <li>Yield for a frame</li> <li><code>Woosh</code> sound played on <code>sounds[9]</code> at 0.5 pitch and 0.6 volume on loop</li> <li>Yield until <code>doingaction</code> is false. Before each frame yield, attacker's y <code>spin</code> is set to 10 * (<code>successfulchain</code> + 1) followed by <code>sounds[9].pitch</code> changed to <code>successfulchain</code> / 4.0 * 1.25 clamped from 0.5 to 1.5</li> <li><code>sounds[9]</code> is stopped at 0.1 speed</li> <li><code>Toss</code> sound is played</li> <li><code>Woosh</code> sound played on <code>sounds[8]</code> at 0.9 pitch and 0.5 volume on loop</li> <li>attacker's <code>spin</code> is zeroed out</li> <li>attacker animstate set to 101</li> <li><code>Prefabs/Objects/BeerangBattle</code> instantiated at the attacker's position</li> <li>Camera reset to default</li> <li>If <code>successfulchain</code> higher than 0, <code>commandsuccess</code> is set to true</li> <li>For each <code>successfullchain</code> + 1:<ul> <li><code>Prefabs/Objects/BeerangBattle</code> is set to go towards slightly up from the targetentity using a BeizierCurve3 with a midpoint up and back the target over the course of 40.0 frames (12.5 frames instead if it's not the first iteration) with a z rotation of 20.0 each frame</li> <li>If this is the first iteration:<ul> <li>DoDamage 1 call happens</li> <li><code>lastdamage</code> is set to a local int</li> <li><code>combo</code> is decremented (undoes what DoDamage did so it stays at 0)</li> </ul> </li> <li>Othewise, if the <code>lastdamage</code> value of DoDamage 1 was higher than 0:<ul> <li>DoDamage 2_a call happens (index is this loop's index)</li> <li>ShowComboMessage is called with targetentity without block</li> </ul> </li> <li>Otherwise:<ul> <li>DoDamage 2_b call happens</li> </ul> </li> <li>If this isn't the last iteration, <code>Prefabs/Objects/BeerangBattle</code> is set to go towards slightly up from its position using a BeizierCurve3 with a midpoint up and back forward its initial position over the course of 1 / 0.045 frames (~22.22 frames) with a z rotation of 20.0 each frame</li> <li><code>sounds[8].pitch</code> is increased by 0.07</li> </ul> </li> <li>If <code>successfulchain</code> is 3 or higher, <code>AtkSuccess</code> sound plays</li> <li><code>Prefabs/Objects/BeerangBattle</code> is set to go towards the attacker using a BeizierCurve3 with a ymax of 5.0 over the course of 40.0 frames with a z rotation of 20.0 each frame</li> <li><code>sounds[8]</code> is stopped</li> <li>attacker animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>Prefabs/Objects/BeerangBattle</code> is destroyed</li> <li>If targetentity's <code>hp</code> is above 0, its animstate is set to its basestate</li> <li>Yield of 0.2 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/BeetleDig/","title":"<code>BeetleDig</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/BeetleDig/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 60.0 PressKeyTimer {Random between Confirm, Cancel and Switch inputs id}"},{"location":"Battle%20system/Player%20actions/Skills/BeetleDig/#damagewithinpos-calls","title":"DamageWithinPos calls","text":"# Conditions playerid damageammount property radius xonly 1 Done for each party member who ended up fufilling the IsInRadius check after target selection (see the section below for details) <code>currentturn</code> <code>playerdata[currentturn].atk</code> clamped from 1 to 99. NOTE: This clamp is unecessary because of the property which already clamps the final value from 1 and it also incorrectly removes the influences of any base <code>atk</code> value of 0 or below Atleast1pierce 2.0 true 2 Done for each enemy party member who fufills these conditions:<ul><li>DamageWithinPos 1 applied</li><li>DoCommand 1 set <code>commandsuccess</code> to true</li></ul> <code>currentturn</code> <code>playerdata[currentturn].atk</code> / 1.5 rounded to nearest clamped from 1 to 99. NOTE: This clamp is unecessary because of the property which already clamps the final value from 1 and it also incorrectly removes the influences of any base <code>atk</code> value of 0 or below Atleast1pierce 2.0 true"},{"location":"Battle%20system/Player%20actions/Skills/BeetleDig/#about-the-target-selection","title":"About the target selection","text":"<p>There is a \"fake\" action command in this action that happens before DamageWithinPos 1, but its outcome influences both DamageWithinPos calls because it involves the attacker's position moving horizontally back and forth until the Confirm input is pressed. Since the method will use the player party member's position as the point to compare with the radius, this is effectively a target selection.</p> <p>It works by having an indefinite loop that won't stop yielding frames until the Confirm input is pressed. Before each yield, the attacker's y/z positions are zeroed out, but the x is lerped from the existing one to sin curve being 3.75 + Sin(Time.time * 2.0) * 7.0 with a factor of 0.025.</p> <p>NOTE: Mathematically, this lerp makes no sense. Using simulation reveals the curve changes phase shift and amplitude and it can approximated by 3.75 + sin(2 * Time.tim - 0.92) * 4.23 but this is framerate dependant. Had the curve been followed correctly, it would have actually covered too large of a range, but the lerp accidentally fixes it despite making no sense mathematically.</p> <p>Once the input is pressed the x position is determined, it won't change and it will be used for both DamageWithinPos calls, but with xonly to true so only the x distance is checked to fall within 2.0.</p>"},{"location":"Battle%20system/Player%20actions/Skills/BeetleDig/#additional-flip-logic","title":"Additional flip logic","text":"<p>Neither of the DamageWithinPos calls comes with a <code>Flip</code> property, but the action comes with custom logic that does a reduced version of what the property did. It only concerns the conditions management and the <code>basestate</code> set in case of a Topple.</p> <p>The logic is contained in a method called FlipWithinPos which is only used in this action. The method takes the x position of the attacker after it was determined using the logic mentioned in the section above and find every enemy party members who satisfies all the following conditions:</p> <ul> <li>Their position isn't <code>OutOfReach</code></li> <li>Their <code>hp</code> is above 0</li> <li>They are IsInRadius (without getair and xonly) of (x position of the attacker, 0.0, 0.0) where the radius is 2.0. NOTE: This should have had xonly as true, but it ends up being a non issue in practice because getair being false means that the physical position of <code>Flying</code> enemy party members will count as being in radius if close enough. Since all <code>Flying</code> enemy party members uses their <code>height</code> field to render in the air and their physical position remains at 0 in y and z, this ends up not affecting the logic badly</li> </ul> <p>For each enemy party members found, Flip is called on them. This method features the same flip handling logic than the damage pipeline, but with 3 key differences:</p> <ul> <li>It doesn't have any logic about the damage effects (it doesn't apply here)</li> <li>It doesn't feature a DropItem call if the enemy party member was holding an item</li> <li>It doesn't feature setting <code>isdefending</code> to false meaning it will not break their guarding</li> </ul> <p>The rest (including the toppling management and the Flipped condition infliction) are the same.</p>"},{"location":"Battle%20system/Player%20actions/Skills/BeetleDig/#logic-sequence","title":"Logic sequence","text":"<ul> <li>attacker's <code>shieldenabled</code> value is saved and then set to false which visually hides the shield (it will be restored when the action is over and it doesn't affect the logic, only visuals)</li> <li><code>Dig</code> sound played</li> <li><code>checkingdead</code> set to a KabbuDig coroutine which initiates a digging animation of the attacker with particles, <code>Dig</code> sound, sprite local position/angles changes and set <code>overrideanim</code>, <code>overrideflip</code> and <code>overrideheight</code> to true. The coroutine lasts 40.0 frames and sets <code>checkingdead</code> to null at the end</li> <li>Yield until <code>checkingdead</code> goes to null</li> <li>attacker animstate set to 1 (<code>Walk</code>)</li> <li><code>Digging</code> sound plays on <code>sounds[9]</code> at 0.75 volume on loop</li> <li><code>Prefabs/Particles/Digging</code> instantiated childed to the attacker</li> <li>attacker ForceMove to (-0.5, 0.0, 0.0) over the course of 40.0 frames with both movestate and stopstate to 1 (<code>Walk</code>)</li> <li>Yield for a frame</li> <li>Yield until attacker's <code>forcemoving</code> goes to null</li> <li>A new Confirm ButtonSprite is SetUp without description childed to the GUICamera at (-6.0, 2.0, 10.0) with a sortorder of 10</li> <li>The camera slowly moves to look at the right side of the stage</li> <li>Yield for a frame</li> <li>All enemy party members whose position isn't <code>Underground</code> or <code>OutOfReach</code> has TempCrosshair called on them and their resulting transforms stored in a local array</li> <li>The target selection input logic mentioned above takes place, but with the added logic that the ButtonSprite's <code>basesprite</code>.color periodically switches between pure white and pure grey where it's the former when Sin(Time.time * 5.0) * 10.0 is higher than 0.0, it's the latter otherwise. This won't proceed until the Confirm input is pressed.</li> <li>All TempCrosshair are destroyed</li> <li><code>sounds[9]</code> is stopped</li> <li><code>DigPop</code> sound plays</li> <li>attacker animstate set to 119</li> <li>ButtonSprite's <code>basesprite</code>.color is set to pure white then disabled</li> <li>ShakeScreen with 0.25 ammount for 0.55 time</li> <li>attacker's <code>overrideheight</code> set to false</li> <li>attacker's <code>overridejump</code> set to true</li> <li><code>Prefabs/Particles/Digging</code> positioned offscreen</li> <li><code>DireExplode</code> particles plays</li> <li>DoDamageWithinPos 1 call happens</li> <li>The FlipWithinPos logic mentioned above happens</li> <li>attacker gets LockRigid(true) called</li> <li>attacker's <code>overrideflip</code> set to false</li> <li>attacker's y <code>spin</code> set to 20.0</li> <li>Over the course of 61.0 frames, the attacker moves along a BeizierCurve where both ends are its current position, but with a ymax of 10.0 meaning they will move up to 10.0 and down back to where they started. After half of the frames passed, the following happens on the first applicable frame once:<ul> <li>DoCommand 1 call happens</li> <li>Yield for a frame</li> <li>Yield until <code>doingaction</code> goes to false</li> <li>If <code>commandsuccess</code> is true:<ul> <li><code>Turn</code> sound plays</li> <li>instance.<code>camoffset</code> increases by (0.0, 0.5, -0.5)</li> <li>attacker animstate set to 101</li> <li>attacker's <code>spin</code> zeroed out</li> <li>Over the course of 21.0 frames, the attacker moves along a BeizierCurve where it goes from its current position to the same position + (0.0, 1.0, 0.0)</li> <li>attacker animstate set to 119</li> <li>attacker's <code>sprite</code>.flipY set to true</li> <li>attacker's y <code>spin</code> set to 30.0</li> <li><code>Woosh4</code> sound played</li> <li>Over the course of 16.0 frames, attacker moves to 0.0 in y and z</li> <li>attacker's y position set to -2.0 and z position set to 0.0</li> <li><code>Dig</code> sound plays</li> <li><code>DirtExplode</code> particles plays at attacker's x position (0.0 in y and z) for 1.0 seconds</li> <li>ShakeScreen with 0.35 ammount for 0.85 time</li> <li>DamageWithinPos 2 call happens</li> <li>Yield for 1.0 seconds</li> <li>break out of the ascension loop early</li> </ul> </li> <li>attacker's <code>sprite</code>.flipY set to true</li> <li>attacker's <code>height</code> set to 1.0</li> </ul> </li> <li>attacker's <code>overrideanim</code> set to false</li> <li>attacker's <code>overridejump</code> set to false</li> <li><code>Prefabs/Particles/Digging</code> repositioned locally at Vector3.zero</li> <li>attacker position reset to what it was before the ascencion</li> <li>attacker's <code>overrideheight</code> set to true</li> <li>attacker's <code>sprite</code> y local position set to -2.0 and flipY to false</li> <li>attacker gets LockRigid(false) called</li> <li>Camera reset to default</li> <li>attacker MoveTowards its position before this action</li> <li>Yield while attacker is done with its <code>forcemove</code></li> <li><code>DirtExplode</code> particles plays with <code>DigPop</code> sound at the attacker's position</li> <li>attacker's <code>overrideheight</code> set to false</li> <li>attacker's <code>height</code> reset to 0.0</li> <li><code>Prefabs/Particles/Digging</code> destroyed</li> <li>ButtonSprite destroyed</li> <li>attacker's <code>shieldenabled</code> reset to the value at the start of this action</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/BeetleTaunt/","title":"<code>BeetleTaunt</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/BeetleTaunt/#explanation-of-how-taunt-works","title":"Explanation of how taunt works","text":"<p>This action has a special interaction with GetRandomAvailablePlayer where it will force the target selection by setting <code>forceattack</code> to <code>currentturn</code> (meaning the attacker performing this action). </p> <p>While the enemy party members gets the Taunted condition (if they didn't had notaunt enabled), the condition doesn't actually do anything logically and it only visuals. </p> <p>What will influence the battle logically solely has to do with <code>forceattack</code> being set. This action only features that and the animations related to it.</p>"},{"location":"Battle%20system/Player%20actions/Skills/BeetleTaunt/#logic-sequence","title":"Logic sequence","text":"<ul> <li>attacker animstate set to 109</li> <li><code>dontusecharge</code> set to true</li> <li><code>Taunt2</code> sound played on <code>sounds[9]</code> at 0.9 pitch on loop</li> <li>Camera positioned to the attacker a bit up and back</li> <li>Yield for 1.25 seconds</li> <li>Camera reset to default</li> <li>For every enemy party member whose notaunt is false:<ul> <li><code>Prefabs/Particles/AngryParticle</code> instantiated and childed to the enemy party member positioned at their world CenterPos + -0.1 on z</li> <li>enemy party member's <code>overridejump</code> set to true with the old value saved temporarilly</li> <li>SetCondition called to add the Taunted condition on the enemy party member for 1 turn</li> <li>If <code>TauntPlus</code> medal is equipped: <ul> <li>SetCondition called to add the AttackUp condition on the enemy party member for 1 turn</li> <li>SetCondition called to add the DefenseDown condition on the enemy party member for 1 turn</li> </ul> </li> </ul> </li> <li><code>sounds[9]</code> is stopped</li> <li>For the next 100.0 frames and for each enemy party member whose notaunt is false, the <code>Taunt</code> sound may be played if it wasn't playing already (or it is, but its time is past 0.25 seconds) under 2 conditions:<ul> <li>Every 20.0 frames while the enemy party member's <code>weight</code> is 100.0 or higher</li> <li>The enemy party member's <code>weight</code> is less than 100.0, it is <code>onground</code>, its <code>jumpcooldown</code> expired and a 10% RNG test passes (this will also have Jump called on the entity party member before the sound playing)</li> </ul> </li> <li>For each enemy party member:<ul> <li>Their <code>Prefabs/Particles/AngryParticle</code> is destroyed</li> <li>Yield until the enemy party member is <code>onground</code></li> <li>The enemy party member's <code>overridejump</code> is reverted to its initial value it had at the start of the action</li> </ul> </li> <li><code>forceattack</code> is set to <code>currentturn</code></li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/BubbleShield/","title":"<code>BubbleShield</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>Inflicts the Shield condition for 1 turn on every player party member whose <code>hp</code> is above 0 and who doesn't have an eatenby</li> <li>Increment <code>playerdata[currentturn].cantmove</code> (meaning the attacker looses an actor turn)</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/BubbleShield/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/BubbleShield/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> set to true</li> <li>Camera moves slowly towards the attacker</li> <li>attacker animstate set to 102</li> <li>Yield for 0.75 seconds</li> <li>attacker animstate set to 119</li> <li>Yield for 0.25 seconds</li> <li>Camera reset to default</li> <li><code>Shield</code> sound plays</li> <li>SetCondition called to inflict the Shield condition for 1 turn on every player party member whose <code>hp</code> is above 0 and who doesn't have an eatenby</li> <li>Yield for 0.75 seconds</li> <li><code>playerdata[currentturn].cantmove</code> is incremented (meaning the attacker looses an actor turn)</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/BubbleShieldLite/","title":"<code>BubbleShieldLite</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/BubbleShieldLite/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p> <p>The same than BubbleShield, but it has the following changes:</p> <ul> <li>It assumes a single <code>target</code> which will be the only one that will get inflicted the Shield condition for 1 turn if its <code>hp</code> is above 0 and it doesn't have an eatenby. The other player party members will not get the infliction</li> <li><code>playerdata[currentturn].cantmove</code> is not incremented meaning the attacker doesn't loose an actor turn</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/ChargeUpPlus/","title":"<code>ChargeUpPlus</code>","text":"<p>The same as Empower, but with the following changes:</p> <ul> <li>The action doesn't just concerns the <code>target</code>, it concerns the whole player party. Every player party members whose <code>hp</code> is above 0 without an eatenby will have their <code>charge</code> incremented if it was less than 3</li> <li>All applicable player party members above will have StatEffect called on them instead of just the <code>target</code></li> <li>All applicable player party members will have their y <code>spin</code> changed instead of just the <code>target</code></li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/Cleanse/","title":"<code>Cleanse</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>ClearStatus is called on <code>target</code> enemy party member</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/Cleanse/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/Cleanse/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> set to true</li> <li>attacker animstate set to 111</li> <li><code>FastWoosh</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>ClearStatus is called on <code>target</code> enemy party member</li> <li>DeathSmoke particles play on the <code>target</code> enemy party member with uniform 3x scale</li> <li>A SpriteBounce is added on the <code>target</code>'s <code>rotater</code> with <code>speed</code> of 20.0</li> <li><code>target</code> animstate set to 30 (<code>FakeHurt</code>)</li> <li><code>Heal3</code> sound plays</li> <li><code>Prefabs/Particles/MagicUp</code> particles instantiated and played at <code>target</code> + 0.5 in y</li> <li>Yield for 0.85 seconds</li> <li>The SpriteBounce of the <code>target</code> is destroyed</li> <li>Yield for a frame</li> <li>The scale of <code>target</code> is reset to its initial value before the action</li> <li>Yield for 0.1 seconds</li> <li><code>Prefabs/Particles/MagicUp</code> of the <code>target</code> moved offscreen and destroyed</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseBreak1/","title":"<code>DefenseBreak1</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>AddBuff is called which does a SetCondition to inflict the DefenseDown conditiion on <code>target</code> enemy party member for 2 turns</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseBreak1/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseBreak1/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> set to true</li> <li>attacker animstate set to 111</li> <li><code>FastWoosh</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>AddBuff is called which does a SetCondition to inflict the DefenseDown conditiion on <code>target</code> for 2 turns</li> <li>StatEffect called on <code>target</code> with type 3 (blue down arrow)</li> <li>A SpriteBounce is added on the <code>target</code>'s <code>rotater</code> with <code>speed</code> of 20.0</li> <li><code>target</code> animstate set to 30 (<code>FakeHurt</code>)</li> <li><code>StatDown</code> sound plays</li> <li><code>Prefabs/Particles/MagicUp</code> particles instantiated and played at <code>target</code> + 0.5 in y</li> <li>Yield for 0.85 seconds</li> <li>The SpriteBounce of the <code>target</code> is destroyed</li> <li>Yield for a frame</li> <li>The scale of <code>target</code> is reset to its initial value before the action</li> <li>Yield for 0.1 seconds</li> <li><code>Prefabs/Particles/MagicUp</code> of the <code>target</code> moved offscreen and destroyed</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseBreakAll/","title":"<code>DefenseBreakAll</code>","text":"<p>The same as DefenseBreak1, but with the following changes:</p> <ul> <li>The action applies to all enemy party members instead of just the <code>target</code> one. This include the AddBuff call and any visual effects or animation logic</li> <li>The DefenseDown condition is inflicted for 3 turns per enemy party members instead of 2 for just the <code>target</code> one</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseBreakAll/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseUp/","title":"<code>DefenseUp</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>AddBuff is called which does a SetCondition to inflict the DefenseUp conditiion on <code>target</code> for 2 turns</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseUp/#battle-itemusage","title":"Battle ItemUsage","text":"<p>This action will be processed if a <code>GenerousSeed</code> item is used with a <code>Battle</code> ItemUsage. If this is what caused this action, it features less animation logic.</p>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseUp/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseUp/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> is set to true</li> <li>If currentaction is <code>ItemList</code> (the action was called from item usage):<ul> <li>Yield for 0.25 seconds</li> </ul> </li> <li>Otherwise (the action was called from skill usage):<ul> <li><code>Magic</code> sound plays</li> <li><code>Prefabs/Particles/MagicUp</code> particles instantiated slightly above the attacker</li> <li>attacker animstate set to 4 (<code>ItemGet</code>)</li> <li>attacker y spin set to -20.0</li> <li><code>target</code> player party member's y <code>spin</code> set to -15.0</li> <li>Yield for 0.75 seconds</li> <li><code>Prefabs/Particles/MagicUp</code> particles moved offscreen</li> <li><code>Prefabs/Particles/MagicUp</code> particles destroyed in 5.0 seconds</li> </ul> </li> <li><code>StatUp</code> sound plays at 0.9 pitch</li> <li>AddBuff is called which does a SetCondition to inflict the DefenseUp conditiion on <code>target</code> for 2 turns</li> <li>StatEffect called on the <code>target</code> with type 0 (red up arrow)</li> <li><code>target</code>'s <code>spin</code> is zeroed out</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/DefenseUpPlus/","title":"<code>DefenseUpPlus</code>","text":"<p>The same as DefenseUp, but with the following changes:</p> <ul> <li>The action is never called from an ItemUsage and requires to be called by skill usage</li> <li>The action doesn't just concerns the <code>target</code>, it concerns the whole player party. Every player party members whose <code>hp</code> is above 0 without an eatenby will have AddBuff  called on them which does a SetCondition to inflict the DefenseUp conditiion for 3 turns</li> <li>The condition is inflicted for 3 turns instead of 2</li> <li>All applicable player party members above will have StatEffect called on them instead of just the <code>target</code></li> <li>All applicable player party members will have their y <code>spin</code> changed instead of just the <code>target</code></li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/Empower/","title":"<code>Empower</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>If the <code>target</code> has less than 3 <code>charge</code>, its <code>charge</code> is incremented</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/Empower/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/Empower/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> is set to true</li> <li><code>Magic</code> sound plays</li> <li><code>Prefabs/Particles/MagicUp</code> particles instantiated slightly above the attacker</li> <li>attacker animstate set to 4 (<code>ItemGet</code>)</li> <li>attacker y spin set to -20.0</li> <li><code>target</code> player party member's y <code>spin</code> set to -15.0</li> <li>Yield for 0.75 seconds</li> <li><code>Prefabs/Particles/MagicUp</code> particles moved offscreen</li> <li><code>Prefabs/Particles/MagicUp</code> particles destroyed in 5.0 seconds</li> <li><code>StatUp</code> sound plays at 1.25 pitch</li> <li>StatEffect called on the <code>target</code> with type 4 (green up arrow)</li> <li>If the <code>target</code> has less than 3 <code>charge</code>, its <code>charge</code> is incremented</li> <li><code>target</code>'s <code>spin</code> is zeroed out</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/EmpowerPlus/","title":"<code>EmpowerPlus</code>","text":"<p>The same as AttackUp, but with the following changes:</p> <ul> <li>The action is never called from an ItemUsage and requires to be called by skill usage</li> <li>The action doesn't just concerns the <code>target</code>, it concerns the whole player party. Every player party members whose <code>hp</code> is above 0 without an eatenby will have AddBuff  called on them which does a SetCondition to inflict the AttackUp conditiion for 3 turns</li> <li>The condition is inflicted for 3 turns instead of 2</li> <li>All applicable player party members above will have StatEffect called on them instead of just the <code>target</code></li> <li>All applicable player party members will have their y <code>spin</code> changed instead of just the <code>target</code></li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/FrigidCoffin/","title":"FrigidCoffin","text":"<p>Many of the logic here is shared by Moth's basic attack. As such, it is assumed that the actor is <code>Moth</code>'s player party member.</p> <p>It is also assumed that this action cannot target a <code>Flying</code> target.</p>"},{"location":"Battle%20system/Player%20actions/Skills/FrigidCoffin/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 25.0 RandomPressKeyTimer {0.0, 4.0} 2 DoCommand 1 set <code>commandsuccess</code> to true 120.0 SequentialKeys {3.0}"},{"location":"Battle%20system/Player%20actions/Skills/FrigidCoffin/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a DoCommand 1 set <code>commandsuccess</code> to true <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> unclamped - 1 + <code>combo</code> after DoCommand 2 (from 0 to 3 inclusive) Magic Empty array false 1_b DoCommand 1 set <code>commandsuccess</code> to false <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> unclamped null {NoSound} false"},{"location":"Battle%20system/Player%20actions/Skills/FrigidCoffin/#freeze-infliction-logic","title":"Freeze infliction logic","text":"<p>Right after the DoDamage 1_a call happens, there is some custom Freeze infliction logic that falls outside of CalculateBaseDamage. Since this DoDamage call doesn't have a <code>Freeze</code> property, it can't inflict it, but the action still can with this custom logic that differs slightly from the one used in the damage pipeline.</p> <p>The condition will be inflicted if all of the following are true:</p> <ul> <li>If <code>combo</code> is higher than 2 (all inputs were pressed correctly after DoCommand 2)</li> <li><code>lastdamage</code> is higher than 0 (DoDamage 1_a dealt more than 0 damage to the target)</li> <li>target's <code>freezeres</code> is lower than 100 (it's not immune)</li> <li>A resistance test passes with target's <code>freezeres</code> - 30 (- 35 instead if <code>Moth</code> has <code>StatusBoost</code> medal equipped).</li> </ul> <p>The resistance test is performed by generating a random number between 0 and 99 inclusive and seeing if this number is at least the calculated resistance. The test pass if it is and fails if it's not. Exceptionally, if the target's <code>freezeres</code> was already 30 or below, the test always passes.</p> <p>These conditions differs from the ones in the damage pipeline logic. Here's the differences:</p> <ul> <li>The resitence test has 2 changes:<ul> <li>The target's <code>freezeres</code> - 30 is used instead of using the <code>freezeres</code> directly and it also allows any <code>freezeres</code> of 30 or below to always pass the test</li> <li>The <code>StatusBoost</code> medal decreases further <code>freezeres</code> by 5 instead of 15. This means that if it is equipped, the resistence used is <code>freezeres</code> - 35 instead of <code>freezeres</code> - 15</li> </ul> </li> <li>The infliction doesn't require the target to not have the Sturdy condition, but it should be noted that this can't happen under normal gameplay</li> </ul> <p>If all of the above conditions are met, the infliction occurs by doing the following:</p> <ul> <li>SetCondition called on target to inflict Freeze for 2 turns</li> <li>If target's <code>originalid</code> + 1's endata's <code>hasiceanim</code> is true, target's <code>inice</code> set to true</li> <li>If target's actimmobile is false, its <code>cantmove</code> is set to 1 (needs one actor turn before being able to act again)</li> <li>Freeze is called on the target</li> <li>If target's <code>frozenlastturn</code> is true, its <code>freezeres</code> increments by 25. Otherwise, target's <code>freezeres</code> increments by 13 (18 instead if on HardMode)</li> </ul> <p>However, this logic differs from the one used in the damage pipeline in the following ways:</p> <ul> <li>The condition is inflicted for 2 turns instead of 1</li> <li>The condition is added immediately instead of being a delayed condition. This only has a visual difference: the <code>Prefabs/Particles/Snowflakes</code> that normally appears won't appear</li> <li>The target's <code>inice</code> being set to true condition does not account for being at the <code>GiantLairFridgeInside</code> map or in any maps outside of the <code>GiantLair</code> area. Additionally, it doesn't reset the target's weakness to only contain <code>HornExtraDamage</code> if the conditions are fufilled</li> <li>The damage pipeline logic has no requirements regarding <code>actimmobile</code> being false to set <code>cantmove</code> to 1. This shouldn't affect anything in practice because other parts of the battle system allows to bypass inaction via <code>actimmobile</code></li> <li>The <code>freezeres</code> increase match with the exception that it lacks an increase by 70 that the damage pipeline logic can do. It would have done so if target's <code>originalid</code> + 1's endata's <code>hasiceanim</code> is true while being at the <code>GiantLairFridgeInside</code> map or in any maps outside of the <code>GiantLair</code> area</li> <li>If the target had a Topple condition, it is not removed unlike the damage pipeline logic</li> <li>If the target had a Sleep condition, it is not removed if 0 damage is dealt while it normally would be in the damage pipeline logic. It is removed otherwise by DoDamage as it usually does. Unintuitively, because the damage pipeline logic was incorrect, this ends up workarounding the issue because it allows DoDamage to enforce the correct waking up logic</li> <li>The damage pipeline logic normally includes a Drop of the target if its position is <code>Ground</code> while having a <code>height</code> above 0.05. While this action doesn't feature this in the freeze infliction logic, a variation of it is included after meaning it applies regardless if the infliction happened or not. The only meaningful difference (as this action is assumed to not be possible on <code>Flying</code> enemy party members) is the <code>height</code> requirements for the drop is being above 0.1 instead of 0.05. This shouldn't affect anything under normal gameplay</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/FrigidCoffin/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If in <code>demomode</code>, CreateHelpBox is called with id 2</li> <li>Camera is zoomed in at 0.01 speed from the midpoint between <code>Moth</code> and targetentity</li> <li><code>IceMothThrow</code> sound plays</li> <li><code>Moth</code> animstate set to 108</li> <li>A <code>Prefabs/AnimSpecific/mothbattlesphere</code> is instantiated a bit up-left from <code>Moth</code> position with 90.0 degress rotatex in x with a <code>Prefabs/Objects/SingleSphere</code> as child at half transparency. The <code>mothbattlesphere</code> will be destroyed in 2.0 seconds</li> <li>DoCommand 1 happens</li> <li>Yield until DoCommand is done</li> <li>Camera is reset to default at 0.3 speed</li> <li>A <code>Prefabs/Particles/mothicenormal</code> appears slighly up from targetentity with x rotation of -90.0 and destroyed in 2.0 seconds</li> <li><code>Prefabs/Objects/icepillar</code> appears at targetentity with x rotation of -90.0, a DialogueAnim with x/y targetscale of 0.5</li> <li>If <code>commandsuccess</code> is true (action command succeeded):<ul> <li><code>Moth</code> animstate set to 111</li> <li><code>IceMothHit</code> sound plays</li> <li><code>icepillar</code>'s DialogueAnim targetscale is set to half of the target's <code>size</code></li> <li>target animstate set to 11 (<code>Hurt</code>) and not <code>digging</code></li> <li>target's position is set to <code>Ground</code></li> <li>0.5 seconds yield</li> <li><code>Moth</code> animstate set to 105</li> <li><code>icepillar</code> gets childed to the target's <code>sprite</code></li> <li>Target has LockRigid(true) called</li> <li>Over the course of 15.0 frames, the target is lifted up in y to 1.5 * (1 - target's weight / 100.0 clamped from 0.0 to 1.0) and while this happens, the target's y <code>spin</code> is continuously incremented every frame by 10.0 * (1 - target's weight / 100.0) * the ratio of the 15.0 progression</li> <li><code>Moth</code> animstate set to 102</li> <li>DoCommand 2 call happens</li> <li>Frame yield</li> <li>Yield until <code>doingaction</code> is false</li> <li><code>Moth</code> animstate is set to 116</li> <li>Frame yield</li> <li>DoDamage 1_a call happens</li> <li>The custom freeze infliction logic mentioned above is performed</li> <li><code>icepillar</code> destroyed</li> <li>ShakeScreen called with ammount of (0.1, 0.1, 0.1) and time of 0.1</li> <li><code>IceShatter</code> particles played with <code>IceBreak</code> sound at slightly above the target</li> <li>0.5 seconds yield</li> <li>target <code>spin</code> zeroed out</li> <li>Over the course of 10.0 frames, the target is moved back to its original position</li> <li>StopAllCoroutine on the target's <code>battleentity</code></li> <li><code>Moth</code> animstate set to 118</li> <li>0.5 seconds yield</li> <li>LockRigid(false) called on the target</li> <li>target's <code>basestate</code> restored to what it was before</li> <li>If target's <code>height</code> is above 0.1 while its cantfall is false, target's <code>droproutine</code> is set to a new Drop call followed by its position set to <code>Ground</code></li> <li>target's <code>onground</code> set to false</li> </ul> </li> <li>Otherwise (action command failed):<ul> <li><code>icepillar</code>'s DialogueAnim targetscale is set to (0.4, 0.4, 0.5)</li> <li><code>Moth</code> animstate set to 109</li> <li><code>IceMothMiss</code> sound plays</li> <li>DoDamage 1_b happens</li> <li>1.2 seconds yield</li> <li>A <code>Prefabs/Particles/IceShatter</code> appears slighly up from <code>Moth</code> with x rotation of -90.0 and destroyed in 1.0 seconds</li> <li><code>Moth</code> animstate set to 0 (<code>Idle</code>)</li> </ul> </li> <li>If <code>Prefabs/Objects/icepillar</code> still exists, its DialogueAnim is set to shrink at 0.05 speed</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/HardCharge/","title":"<code>HardCharge</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>attacker player party member has its <code>charge</code> set to 3</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/HardCharge/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/HardCharge/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> set to true</li> <li><code>Charge7</code> sound plays</li> <li>attacker animstate set to 24 (<code>Block</code>)</li> <li>ShakeSprite called on attacker player party member with an x intensity of 0.1 for 30.0 of frametimer</li> <li>Yield for 0.5 seconds</li> <li>The following is performed 3 times:<ul> <li>StatEffect called on attacker player party member with type 4 (green up arrow)</li> <li><code>StatUp</code> sound plays with a pitch of 0.1 * this loop's index (from 0 to 2) + 0.9 (meaning it does 0.9 first, 1.0 second and 1.1 third)</li> <li>Yield for 0.1 seconds</li> <li>Yield for 0.1 seconds</li> </ul> </li> <li>attacker player party member has its <code>charge</code> set to 3    </li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/HeavyStrike/","title":"HeavyStrike","text":"<p>Many of the logic here is shared by Beetle's basic attack. As such, it is assumed that the actor is <code>Beetle</code>'s player party member.</p>"},{"location":"Battle%20system/Player%20actions/Skills/HeavyStrike/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 25.0 HoldKeyCountdown {6.0, 1.0}"},{"location":"Battle%20system/Player%20actions/Skills/HeavyStrike/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a DoCommand 1 set <code>commandsuccess</code> to true <code>Beetle</code>'s player party member <code>availabletargets[target]</code> <code>Beetle</code>'s <code>atk</code> + 2 unclamped Flip {NoSound} false 1_b DoCommand 1 set <code>commandsuccess</code> to false <code>Beetle</code>'s player party member <code>availabletargets[target]</code> <code>Beetle</code>'s <code>atk</code> clamped from 0 to 2. NOTE: This incorrectly removes influences of negative <code>atk</code> values Flip Empty array false"},{"location":"Battle%20system/Player%20actions/Skills/HeavyStrike/#logic-sequence","title":"Logic sequence","text":"<ul> <li>If in <code>demomode</code>, CreateHelpBox is called with id 1</li> <li>Camera is moved to look at targetentity</li> <li>targetentity gets <code>overridejump</code> set to true</li> <li><code>Beetle</code> MoveTowards in front of the enemy (calculated based on its <code>size</code> or <code>freezesize</code>)</li> <li>Yield until <code>Beetle</code> is done with its <code>forcemove</code></li> <li>Camera zooms in slightly</li> <li><code>Beetle</code> animstate set to 103</li> <li>DoCommand 1 call happens</li> <li><code>Charge3</code> sound played on <code>sounds[9]</code> with 0.5 pitch on loop</li> <li>Yield until <code>doingaction</code> is false (for each yield, the <code>Charge9</code> sound pitch is increased by 0.01 and clamped from 0.5 to 1.25 while <code>Beetle</code> sprite shakes slightly by random displacement)</li> <li><code>sounds[9]</code> (<code>Charge3</code> sound) is stopped</li> <li>Camera zooms out slightly</li> <li>If <code>commandsuccess</code> (the action command succeeded):<ul> <li>DoDamage 1_a call happens</li> <li>ShakeScreen called with ammount of (0.1, 0.1, 0.1) and time of 0.25</li> <li><code>HugeHit</code> sound is played</li> <li><code>Beetle</code> animstate set to 104</li> <li>BounceEnemy for the targetentity with bounce of 1 and multiplier of 1.6</li> <li>yield until the BounceEnemy is done</li> <li>0.15 seconds yield</li> </ul> </li> <li>Otherwise (the action command failed)<ul> <li><code>AtkFail</code> sound plays</li> <li>DoDamage 1_b call happens</li> <li><code>Beetle</code> gets <code>overridejump</code> and <code>overrideanim</code> set to true</li> <li><code>Beetle</code> jumps with an animstate of 106 and a slight -z <code>spin</code></li> <li>0.3 seconds yielded</li> <li><code>Beetle</code> animstate set to 105 with a very slight +z <code>spin</code></li> <li>Yield until <code>Beetle</code> is <code>onground</code></li> <li><code>Beetle</code> animstate set to 107</li> <li><code>Prefabs/Particles/deathsmokelow</code> instantated and destroyed in 1.0 seconds</li> <li>Frame yield</li> <li><code>Beetle</code> x/z angles reset to 0.0 and <code>spin</code> zeroed out</li> <li>0.45 seconds yield</li> </ul> </li> <li>targetentity gets <code>overrideanim</code> set to false</li> <li><code>Beetle</code> gets <code>overridejump</code> and <code>overrideanim</code> set to false</li> <li><code>Beetle</code> spin is zeroed out</li> <li>targetentity gets <code>overridejump</code> set to false</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/HeavyThrow/","title":"<code>HeavyThrow</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/HeavyThrow/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 235.0 TappingKey {-1.0, 6.0, 0.25, 1.0} 2 None 60.0 PressKeyTimer {random between 4 and 6 (Confirm, Cancel or Switch)}"},{"location":"Battle%20system/Player%20actions/Skills/HeavyThrow/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> + (3.0 * <code>barfill</code> floored) null {NoSound} false 2 DoCommand 2 set <code>commandsuccess</code> to false null <code>playerdata[currentturn]</code> 3 (this can be lethal) null Empty array false"},{"location":"Battle%20system/Player%20actions/Skills/HeavyThrow/#additional-status-infliction-logic","title":"Additional status infliction logic","text":"<p>After DoDamage 1 call, if DoCommand 1 set <code>barfill</code> to 0.85 or higher, StatusEffect is called on the target to inflict a DefenseDown for 2 turns with visual effects.</p>"},{"location":"Battle%20system/Player%20actions/Skills/HeavyThrow/#caveats-with-docommand-2","title":"Caveats with DoCommand 2","text":"<p>This action command is set to run for 60.0 frames, but the game won't actually wait that it is fully finished and leave up to 13 frames unaccounted for where the command is still running, but the game will read its result. This means that if the player succeeds the command, but was late enough, it will still result in DoDamage 2 call happening even if the command was succeeded. This means effectively, the action command's timing is 17.0 frames instead of 30.0 with the last 13.0 frames not being seen as a success by the action despite the UI indicating that it was.</p>"},{"location":"Battle%20system/Player%20actions/Skills/HeavyThrow/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves slowly towards the left of the stage and back a bit up</li> <li>attacker MoveTowards in front of the player party at 2.0 speed</li> <li>Yield until attacker's <code>forcemove</code> is done</li> <li>attacker animstate set to 100</li> <li>Yield for 0.17 seconds</li> <li>DoCommand 1 call happens</li> <li>Yield until <code>doingaction</code> goes to false (during the yield, attacker's y <code>spin</code> goes from 20.0 to 40.0 with a factor of <code>barfill</code> and if <code>barfill</code> goes above 0.5, a ShakeSprite happens on the attacker for 0.1 intensity and 1.0 frametimer with an additional yield for a frame)</li> <li>attacker <code>sprite</code> local positon reset to Vector3.zero</li> <li>attacker animstate set to 101</li> <li><code>Prefabs/Objects/BeerangBattle</code> instantiated without angles with a SpinAround that has an <code>itself</code> of (0.0, 0.0, 30.0 * <code>barfill</code> clamped from 0.5 to 1.0) </li> <li><code>Toss8</code> sound plays</li> <li>Over the course of x frames, <code>Prefabs/Objects/BeerangBattle</code> moves to the world CenterPos of the target where x is 15.0 * lerp from 2.0 to 1.0 with a factor of <code>barfill</code> clamped from 0.5 to 1.0 (maximum is 15.0 frames, but it will go towards 7.5 frames as <code>barfil</code> gers lower)</li> <li>ShakeScreen with 0.4 * <code>barfill</code> ammount and 0.75 time</li> <li>DoDamage 1 call happens</li> <li>If <code>barfill</code> is 0.85 or higher, StatusEffect is called on the target to inflict DefenseDown for 2 turns with visual effects</li> <li><code>HugeHit</code> sound plays</li> <li>Over the course of 81.0 frames, <code>Prefabs/Objects/BeerangBattle</code> moves towards the attacker + Vector3.up via a BeizierCurve3 with a ymax of 15.0. On the first frame that's more than 40% of the way (33th frames and later), DoCommand 2 call happens</li> <li><code>Prefabs/Objects/BeerangBattle</code> is destroyed</li> <li>If <code>commandsuccess</code> is false:<ul> <li>ShakeScreen with 0.1 ammount for 0.75 time</li> <li>attacker <code>overrideanim</code> set to true</li> <li>attacker animstate set to 11 (<code>Hurt</code>)</li> <li>DoDamage 2 call happens</li> </ul> </li> <li>Otherwise:<ul> <li><code>DLGammaStep</code> sound plays</li> <li>attacker animstate set to 100</li> </ul> </li> <li>SlowSpinStop called on the attacker with (0.0, 30.0, 0.0) spinamount for 60.0 frametime</li> <li>Yield for 1.0 seconds</li> <li>The SlowSpinStop coroutine is stopped</li> <li>attacker <code>spin</code> is zeroed out</li> <li>attacker <code>overrideanim</code> set to false</li> <li>FlipAngle(true) called on the attacker which sets its y <code>sprite</code> angle to 0.0 or 180.0 according to its <code>flip</code></li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/HornDash/","title":"<code>HornDash</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/HornDash/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 170.0 TappingKey {4.0, 8.0, 1.25, 1.0}"},{"location":"Battle%20system/Player%20actions/Skills/HornDash/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Done for each enemy party member whose position is <code>Ground</code> <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> * <code>barfill</code> (value after DoCommand 1) ceiled then clamped from 1 to 99. If <code>barfill</code> is exactly 1.0 (the bar was fully filled), 1 is added after the clamp. NOTE: This clamp incorrectly removes the influence of negative <code>atk</code> values Flip Empty array false"},{"location":"Battle%20system/Player%20actions/Skills/HornDash/#logic-sequence","title":"Logic sequence","text":"<ul> <li>attacker MoveTowards in fron of the player party, but still to the left of the stage at 2.0 speed stopping at animstate 116</li> <li>The camera moves up and back slowly</li> <li>Yield until the attacker's <code>forcemove</code> is done</li> <li>attacker <code>overridejump</code> set to true</li> <li>attacker <code>overrideanim</code> set to true</li> <li><code>Prefabs/Particles/WalkDust</code> particles instantiated childed to the attacker's <code>sprite</code> slightly up and back from it with x angle of -90.0</li> <li>Yield for a frame</li> <li>DoCommand 1 call happens</li> <li>Yield until <code>doingaction</code> goes to false (during the yield, the <code>Prefabs/Particles/WalkDust</code> particles's emission.rateOverTime is set to <code>barfill</code> * 20.0 clamped from 3.0 to 15.0 and their local position set to (Sin(Time.time * 7.0) * 0.25 * <code>barfill</code>, 0.2, -0.1) meaning they will oscillate left and right as <code>barfill</code> goes higher)</li> <li>Camera is reset to default</li> <li>attacker <code>rigid</code> has its gravity disabled</li> <li><code>enemybounce</code> initialised to a new array with length being the <code>availabletargets</code>'s length</li> <li>attacker animstate set to 117</li> <li><code>Prefabs/Particles/WalkDust</code> particles's main.startLifetime set to 1.5 and startSize to 1.25</li> <li>If <code>barfill</code> is higher than 0.3 (more than 30% filled), attacker's <code>trail</code> is set to true</li> <li><code>FastWoosh</code> sound plays</li> <li>Over the course of x amount of frames where x is 1 / (0.04 * (<code>barfill</code> clamped from 0.45 to 1.0)) (basically, 25.0 frames if <code>barfill</code> is 1.0, 55.5556 frames if <code>barfill</code> is 0.45 or below), attacker moves from (-1.0, 0.0, -0.25) to (15.0, 0.0, 0.0). If they get past an enemy party member whose position is <code>Ground</code> and they didn't received damages already:<ul> <li>DoDamage 1 call happens on the enemy party member</li> <li>A BounceEnemy coroutine starts on the enemy party member and stored in <code>enemybounce</code> with the corresponding <code>availabletargets</code> index with 2 bounced and 1.5 multiplier</li> </ul> </li> <li>Yield until all <code>enemybounce</code> elements goes to null (meaning all EnemyBounce coroutines are fully done)</li> <li>attacker's <code>trail</code> is set to false</li> <li>attacker position set to (-10.0, 0.0, 0.0)</li> <li>attacker <code>overridejump</code> is set to false</li> <li>attacker <code>overrideanim</code> is set to false</li> <li>attacker animstate set to 1 (<code>Walk</code>) with a SetAnimForce call</li> <li><code>Prefabs/Particles/WalkDust</code> particles is destroyed</li> <li>attacker MoveTowards its initial position before this action</li> <li>Yield until attacker's <code>forcemove</code> is done</li> <li>attacker <code>rigid</code> gets its gravity enabled back</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/HurricaneBeemerang/","title":"<code>HurricaneBeemerang</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/HurricaneBeemerang/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None <ul><li>220.0 if <code>Beemerang2</code> medal is not equipped</li><li>250.0 if <code>Beemerang2</code> medal is equipped</li></ul> TappingKey <ul><li>{-1f, 6.5f, 0.15f, 1f, 0f, 0f, 0f, 0f, 0f, 4f} if <code>Beemerang2</code> medal is not equipped</li><li>{-1f, 6.5f, 0.15f, 1f, 0f, 0f, 0f, 0f, 0f, 5f} if <code>Beemerang2</code> medal is equipped</li></ul>"},{"location":"Battle%20system/Player%20actions/Skills/HurricaneBeemerang/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 None <code>playerdata[currentturn]</code> <code>availabletargets[target]</code> <code>playerdata[currentturn].atk</code> - 1 clamped from 0 to 99. NOTE: This incorrectly ignores a base <code>atk</code> of 0 or lower due to the lower bound clamp Flip Empty array false 2_a DoDamage 1's result was higher than 0 null <code>availabletargets[target]</code> DoDamage 1's result - <code>i</code> clamped from 1 to 99, done <code>x</code> - 1 times where <code>i</code> starts at 1 and increments after each iteration and <code>x</code> is the amount of hits which is 2 + the amount of 1/2 parts contained in <code>barfill</code> value after DoCommand 1 (amount of 1/3 parts instead if <code>Beemerang2</code> medal is equipped) Empty array false 2_b DoDamage 1's result was 0 or lower null <code>availabletargets[target]</code> 0, done <code>x</code> - 1 times where <code>x</code> is the amount of hits which is 2 + the amount of 1/2 parts contained in <code>barfill</code> value after DoCommand 1 (amount of 1/3 parts instead if <code>Beemerang2</code> medal is equipped) null null false"},{"location":"Battle%20system/Player%20actions/Skills/HurricaneBeemerang/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>combo</code> set to 0</li> <li>Camera moved to zoom in slowly towards the left of the stage</li> <li>attacker MoveTowards in front of the party, but still towards the left side of the stage</li> <li>Yield until attacker is done with its <code>forcemove</code></li> <li>attacker animstate set to 100</li> <li>Yield for 0.3 seconds</li> <li>Yield for a frame</li> <li><code>Prefabs/Particles/Hurricane</code> is instantiated childed to the attacker's <code>sprite</code> slightly up and forward from it rotated -90.0 in x</li> <li>Yield for a frame</li> <li><code>Woosh</code> sound played on <code>sounds[9]</code> at 0.5 pitch and 0.6 volume on loop</li> <li>DoCommand 1 happens</li> <li>Yield for a frame</li> <li>Yield until <code>doingaction</code> is false. Before each frame yield, <code>Prefabs/Particles/Hurricane</code>'s particle emission's RateOverTime is set to 40.0 * <code>barfill</code> clamped from 3.0 to 40.0 followed by attacker's y <code>spin</code> is set to 40.0 * (<code>barfill</code> clamped from 0.3 to 1) followed by <code>sounds[9].pitch</code> changed to <code>successfulchain</code> / 4.0 * 1.25 clamped from 0.5 to 1.5. NOTE: This pitch should have been based on <code>barfill</code> as <code>successfulchain</code> is not used for a TappingKey action command. This means the pitch won't change before each frame yield and the exact pitch is dependant on the result of the last <code>TappingKey</code> action command which is unexpected</li> <li><code>sounds[9]</code> is stopped at 0.1 speed</li> <li><code>Toss</code> sound is played</li> <li><code>Woosh</code> sound played on <code>sounds[8]</code> at 0.9 pitch and 0.5 volume on loop</li> <li>attacker's <code>spin</code> is zeroed out</li> <li>attacker animstate set to 101</li> <li><code>Prefabs/Objects/BeerangBattle</code> instantiated at the attacker's position</li> <li>Camera reset to default</li> <li><code>Prefabs/Objects/BeerangBattle</code> is set to go towards slightly up from the targetentity using a BeizierCurve3 with a midpoint being the actual midpoint of the entire trajectory, but a bit forward over the course of 20.0 frames with a z rotation of 20.0 * framestep each frame</li> <li>The amount of hits is calculated which is done by doing the following:<ul> <li>Take 2.0 * <code>barfill</code> (3.0 * <code>barfill</code> instead if <code>Beemerang2</code> medal is equipped)</li> <li>Ceil the result and clamp it from 1 to 99</li> <li>Add 1 (Add 2 instead if <code>barfill</code> is 1.0 or higher)</li> </ul> </li> <li><code>enemybounce</code> is set to a new array of one element being either null if targetentity's deathtype is 12 or if it isn't, a new BounceEnemy coroutine starting on targetentity. In practice, it means all but the <code>KeyR</code>, <code>KeyL</code>, <code>Tablet</code> enemies will have a BounceEnemy coroutine started on them if they are the target of this action</li> <li><code>Prefabs/Particles/Hurricane</code>'s particle emission's RateOverTime is set to 50.0 * <code>barfill</code> clamped from 20.0 to 50.0</li> <li><code>Prefabs/Objects/BeerangBattle</code> has a SpinAround added to it with a z <code>itself</code> of 35.0</li> <li><code>HurricaneBig</code> particles are played without destroy at the targetentity position</li> <li><code>combo</code> is set to 0</li> <li>For each amount of hits + 1:<ul> <li>If this is the first iteration:<ul> <li>DoDamage 1 call happens</li> <li><code>lastdamage</code> is set to a local int</li> </ul> </li> <li>Otherwise, if the <code>lastdamage</code> value of DoDamage 1 was higher than 0:<ul> <li>DoDamage 2_a call happens (index is this loop's index)</li> <li>ShowComboMessage is called with targetentity without block. NOTE: This is incorrect because at this point, <code>combo</code> will be 2 which means the word 1 (GREAT) will be skipped</li> </ul> </li> <li>Otherwise:<ul> <li>DoDamage 2_b call happens</li> </ul> </li> <li>Yield for 0.75 / (amount of hits) seconds</li> </ul> </li> <li>The <code>HurricaneBig</code> particles are placed offscreen then destroyed in 3.0 seconds</li> <li>The <code>Prefabs/Objects/BeerangBattle</code>'s SpinAround is destroyed</li> <li>The <code>Prefabs/Particles/Hurricane</code> is moved offscreen, rooted and destroyed in 3.0 seconds</li> <li><code>Prefabs/Objects/BeerangBattle</code> is set to go towards the attacker using a BeizierCurve3 with a with a midpoint being the actual midpoint of the entire trajectory, but a bit forward over the course of 20.0 frames with a z rotation of 20.0 each frame</li> <li><code>sounds[8]</code> is stopped</li> <li><code>Prefabs/Objects/BeerangBattle</code> is destroyed</li> <li>attacker animstate set to 13 (<code>BattleIdle</code>)</li> <li>Yield for a frame if the first <code>enemybounce</code> isn't null</li> <li>Yield for 0.25 seconds</li> <li>targetentity basestate set to the one it had at the start of this action</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceBeemerang/","title":"<code>IceBeemerang</code>","text":"<p>This is a MultiSkillMove with <code>Bee</code> and <code>Moth</code> and as such, it is assumed that the attacker is either one and it also means that post-action won't consume their actor turns like normal.</p>"},{"location":"Battle%20system/Player%20actions/Skills/IceBeemerang/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 60.0 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 2 DoCommand 1 set <code>commandsuccess</code> to true 60.0 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 3 DoCommand 2 set <code>commandsuccess</code> to true 54.5454521 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 4 DoCommand 3 set <code>commandsuccess</code> to true 60.0 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 5 DoCommand 4 set <code>commandsuccess</code> to true 54.5454521 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 6 DoCommand 5 set <code>commandsuccess</code> to true 60.0 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 7 DoCommand 6 set <code>commandsuccess</code> to true 54.5454521 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 8 DoCommand 7 set <code>commandsuccess</code> to true 60.0 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 9 DoCommand 8 set <code>commandsuccess</code> to true 54.5454521 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 10 DoCommand 9 set <code>commandsuccess</code> to true 47.0 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 11 DoCommand 10 set <code>commandsuccess</code> to true 42.727272 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)} 12 DoCommand 11 set <code>commandsuccess</code> to true 34 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)}"},{"location":"Battle%20system/Player%20actions/Skills/IceBeemerang/#dodamage-calls","title":"DoDamage calls","text":"<p>NOTE: The clampings done in the damageammount columns can incorrectly remove the influence of negative <code>atk</code> value or disproportionally benefits positive CalculateBaseDamage effects as opposed to a higher base <code>atk</code> value. Also note: the / 1.15 ceiled operation effectively doesn't change an <code>atk</code> value from 0 to 7, but it will it increase by 1 for a value of -2 or -1 and decrease it by 1 for a value of 8 or 9.</p> # Conditions attacker target damageammount property overrides block 1 DoCommand 1 set <code>commandsuccess</code> to true <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> / 1.15 ceiled clamped from 0 to 99 Freeze {NoSound} false 2 DoCommand 2 set <code>commandsuccess</code> to true <code>Bee</code>'s player party member <code>availabletargets[target]</code> <code>Bee</code>'s <code>atk</code> / 1.15 ceiled clamped from 0 to 99 null empty array false 3 DoCommand 3 set <code>commandsuccess</code> to true <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> / 1.15 ceiled - 1 clamped from 0 to 99 Freeze {NoSound} false 4 DoCommand 4 set <code>commandsuccess</code> to true <code>Bee</code>'s player party member <code>availabletargets[target]</code> <code>Bee</code>'s <code>atk</code> / 1.15 ceiled - 1 clamped from 0 to 99 null empty array false 5 DoCommand 5 set <code>commandsuccess</code> to true <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> / 1.15 ceiled - 2 clamped from 0 to 99 Freeze {NoSound} false 6 DoCommand 6 set <code>commandsuccess</code> to true <code>Bee</code>'s player party member <code>availabletargets[target]</code> <code>Bee</code>'s <code>atk</code> / 1.15 ceiled - 2 clamped from 0 to 99 null empty array false 7 DoCommand 7 set <code>commandsuccess</code> to true <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> / 1.15 ceiled - 3 clamped from 0 to 99 Freeze {NoSound} false 8 DoCommand 8 set <code>commandsuccess</code> to true <code>Bee</code>'s player party member <code>availabletargets[target]</code> <code>Bee</code>'s <code>atk</code> / 1.15 ceiled - 3 clamped from 0 to 99 null empty array false 9 DoCommand 9 set <code>commandsuccess</code> to true <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> / 1.15 ceiled - 1 clamped from 1 to 99 - 4 clamped from 0 to 99 Freeze {NoSound} false 10 DoCommand 10 set <code>commandsuccess</code> to true <code>Bee</code>'s player party member <code>availabletargets[target]</code> <code>Bee</code>'s <code>atk</code> / 1.15 ceiled - 1 clamped from 1 to 99 - 4 clamped from 0 to 99 null empty array false 11 DoCommand 11 set <code>commandsuccess</code> to true <code>Moth</code>'s player party member <code>availabletargets[target]</code> <code>Moth</code>'s <code>atk</code> / 1.15 ceiled - 2 clamped from 1 to 99 - 5 clamped from 0 to 99 Freeze {NoSound} false 12 DoCommand 12 set <code>commandsuccess</code> to true <code>Bee</code>'s player party member <code>availabletargets[target]</code> <code>Bee</code>'s <code>atk</code> / 1.15 ceiled - 2 clamped from 1 to 99 - 5 clamped from 0 to 99 null empty array false F1 DoCommand 1<sup>*</sup>, 2, 4, 6, 8, 10 or 12 set <code>commandsuccess</code> to false <code>Bee</code>'s player party member <code>availabletargets[target]</code> 1 null empty array false F2 DoCommand 3, 5, 7, 9 or 11 set <code>commandsuccess</code> to false <code>Moth</code>'s player party member <code>availabletargets[target]</code> 1 null empty array false <p>*: It is unexpected for F1 to happen instead of F2 if DoCommand 1 set <code>commandsuccess</code> to false because <code>Moth</code> would have attacked first, not <code>Bee</code></p>"},{"location":"Battle%20system/Player%20actions/Skills/IceBeemerang/#custom-charge-reset-logic","title":"Custom <code>charge</code> reset logic","text":"<ul> <li>After DoDamage 1 (if it occurs), <code>Moth</code>'s <code>charge</code> is set to 0. The same happen with DoDamage 3, 5, 7, 9 or 11, but they don't influence the logic since the value was already set to 0</li> <li>After DoDamage 2 (if it occurs), <code>Bee</code>'s <code>charge</code> is set to 0. The same happen after DoDamage 4, 6, 8, 10 or 12, but they don't influence the logic since the value was already set to 0</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceBeemerang/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves +1.5 in x towards the left side of the stage</li> <li>The <code>atk</code> of <code>Bee</code> / 1.15 ceiled and <code>Moth</code> / 1.15 ceiled are saved in a local array which will be refered to as their \"rounded base atk\" from now on</li> <li>Both <code>Bee</code> and <code>Moth</code> have LockRigid(false) called on them with <code>overrideflip</code> set to true</li> <li><code>Bee</code> MoveTowards (-2.2, 0.0, -0.9) at 2.0x multiplier with a stopstate of 13 (<code>BattleIdle</code>)</li> <li><code>Moth</code> MoveTowards (-3.65, 0.0, -1.55) at 2.0x multiplier with a stopstate of 13 (<code>BattleIdle</code>)</li> <li>Yield until <code>Bee</code> and <code>Moth</code>'s <code>forcemove</code> are done</li> <li><code>Bee</code> animstate set to 0 (<code>Idle</code>)</li> <li>DoCommand 1 happens</li> <li>Yield until <code>doingaction</code> goes to false</li> <li><code>Prefabs/Objects/BeerangBattle</code> is instantiated rooted</li> <li>If <code>commandsuccess</code> is false, refer to the section below when DoCommand 1 fails which will eventually end the action</li> <li>Otherwise, the following is done up to 6 times (index tracked in reverse so it goes from 6 to 1) as long as DoCommand calls keep setting <code>commandsuccess</code> to true (the first one that sets it to false causes a breakout early which will eventually end the action early):<ul> <li>If theres less than 3 cycles left:<ul> <li>The rounded base atk of <code>Bee</code> and <code>Moth</code> decreases by 1 and then clamped from 1 to 99</li> <li>FinishAction is called manually (shouldn't do anything in practice)</li> <li>Yield for a frame</li> </ul> </li> <li><code>Prefabs/Objects/BeerangBattle</code> moved offscreen</li> <li><code>Bee</code> animstate set to 103</li> <li><code>Moth</code> animstate set to 111</li> <li><code>mothicenormal</code> particles plays at the world CenterPos of <code>target</code> enemy party member - Vector3.up</li> <li><code>IceMothHit</code> sound plays</li> <li>DoDamage 1 + 2x call happens (<code>Moth</code> as attacker) where x starts at 0 and increments after each cycle</li> <li><code>Moth</code>'s <code>charge</code> set to 0</li> <li>Yield for 0.5 - <code>combo</code> * 0.025 clamped from 0.0 to 1.0 seconds (this wait gets shorter as more DoDamage call happens within this action)</li> <li><code>Moth</code> animstate set to 102</li> <li>Yield for 0.1 seconds</li> <li>DoCommand 2 + 2x call happens where x starts at 0 and increments after each cycle</li> <li>Yield for a frame</li> <li>Yield until <code>doingaction</code> goes to false</li> <li><code>Toss</code> sound plays</li> <li>If <code>commandsuccess</code> is false, refer to the section below where <code>Bee</code>'s associated DoCommand fails which will breakout of this loop early and eventually end this action</li> <li>Yield for 0.1 seconds</li> <li><code>Toss2</code> sound plays on <code>sounds[9]</code> with pitch 1.0 + 0.1 * <code>combo</code> on loop (this sound will increase pitch after each DoDamage calls within this action)</li> <li><code>Bee</code> animstate set to 105</li> <li>Over the course of the last DoCammand's <code>timer</code> value / 1.5 + 1.0 frames, <code>Prefabs/Objects/BeerangBattle</code> moves from <code>Bee</code>'s position + 1.0 in y to the world CenterPos of <code>target</code> enemy party member. During the move, the object z angle is set to framestep * 10.0 + 2.0 * <code>combo</code> (meaning it rotates faster after each DoDamage call within this action)</li> <li>DoDamage 2 + 2x call happens (<code>Bee</code> as attacker) where x starts at 0 and increments after each cycle</li> <li><code>Bee</code>'s <code>charge</code> set to 0</li> <li>FinishAction is called manually (shouldn't do anything in practice)</li> <li>Yield for 0.1 seconds</li> <li>If this isn't the last cycle, DoCommand 3 + 2x call happens where x starts at 0 and increments after each cycle</li> <li>Over the course of the first DoCammand call of this cycle's <code>timer</code> value + 1.0 frames, <code>Prefabs/Objects/BeerangBattle</code> moves from the world CenterPos of <code>target</code> enemy party member to <code>Bee</code>'s position + 1.0 in y via a BeizierCurve3 with a ymax of 8.0. During the move, the object z angle is set to framestep * -10.0 - 2.0 * <code>combo</code> (meaning it rotates faster after each DoDamage call within this action)</li> <li><code>sounds[9]</code> is stopped</li> <li>Yield until <code>doingaction</code> goes to false</li> <li>If this is the last cycle, <code>Bee</code> animstate set to 13 (<code>BattleIdle</code>). Otheriwse, <code>mothicenormal</code> particles plays at the world CenterPos of <code>target</code> enemy party member - 1.0 in y (uniform scale of 0.5x if <code>commandsuccess</code> is false)</li> <li>If <code>commandsuccess</code> is false refer to the section below where <code>Moth</code>'s associated DoCommand fails which will breakout of this loop early and eventually end this action</li> <li>If <code>target</code> enemy party member's <code>hp</code> reached 0 or below:<ul> <li><code>commandsuccess</code> is set to true</li> <li><code>target</code> enemy party member's <code>flip</code> is set to false</li> <li>Refer to the ending section below where the action will be ended early</li> </ul> </li> <li>FinishAction is called manually (shouldn't do anything in practice)</li> <li>Yield for a frame</li> </ul> </li> <li>Once all cycles are done without a breakout early:<ul> <li><code>target</code> enemy party member's <code>flip</code> is set to false</li> <li>Refer to the ending section below where the action will be ended early</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceBeemerang/#docommand-1-2-4-6-8-10-or-12-set-commandsuccess-to-false","title":"DoCommand 1, 2, 4, 6, 8, 10 or 12 set <code>commandsuccess</code> to false","text":"<p>This happens whenever a <code>Bee</code> related action command is failed and it causes the action to end early:</p> <ul> <li>FinishAction is called manually (shouldn't do anything in practice)</li> <li><code>Bee</code> animstate set to 106</li> <li><code>Moth</code> animstate set to 14 (<code>Sleep</code>)</li> <li><code>Toss2</code> sound plays on <code>sounds[9]</code> with pitch 0.9 on loop</li> <li><code>Prefabs/Objects/BeerangBattle</code> angles zeroed out</li> <li>Over the course of 46.0 frames, <code>Prefabs/Objects/BeerangBattle</code> moves from <code>Bee</code>'s position + 1.0 in y to the world CenterPos of <code>target</code> enemy party member via a BeizierCurve3 with a ymax of 8.0. During the move, the object's z angle is set to framestep * 10.0</li> <li><code>sounds[9]</code> is stopped</li> <li><code>AtkFail</code> sound plays</li> <li>DoDamage F1 call happens</li> <li><code>target</code> enemy party member's <code>flip</code> is set to false</li> <li>Refer to the ending section below where the action will be ended early</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceBeemerang/#docommand-3-5-7-9-or-11-set-commandsuccess-to-false","title":"DoCommand 3, 5, 7, 9 or 11 set <code>commandsuccess</code> to false","text":"<p>This happens whenever a <code>Moth</code> related action command is failed and it causes the action to end early:</p> <ul> <li><code>Prefabs/Objects/BeerangBattle</code> is moved offscreen</li> <li><code>IceMothMiss</code> sound plays</li> <li>DoDamage F2 call happens</li> <li><code>Bee</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>Moth</code> animstate set to 110</li> <li>Yield for 1.0 seconds</li> <li><code>IceShatter</code> particles plays at <code>Moth</code>'s position + 1.0 in y</li> <li><code>Moth</code> animstate set to 13 (<code>BattleIdle</code>)</li> <li>Refer to the ending section below where the action will be ended early</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceBeemerang/#ending","title":"Ending","text":"<p>All branches ends here eventually:</p> <ul> <li><code>Prefabs/Objects/BeerangBattle</code> is destroyed</li> <li>Yield for 0.5 seconds</li> <li>Camera resets to default</li> <li>Both <code>Bee</code> and <code>Moth</code> MoveTowards their initial position before this action with 2.0x speed with <code>overrideflip</code> set to true</li> <li>Yield until <code>Bee</code> and <code>Moth</code>'s <code>forcemove</code> are done</li> <li>Both <code>Bee</code> and <code>Moth</code>'s positions are set to their initial position before this action with <code>overrideflip</code> set to false and <code>flip</code> set to true</li> <li>UpdateAnim is called</li> <li>MultiSkillMove is called with 0 and 2 (normally <code>Bee</code> and <code>Moth</code>)</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceDrill/","title":"<code>IceDrill</code>","text":"<p>This is a MultiSkillMove with <code>Beetle</code> and <code>Moth</code> and as such, it is assumed that the attacker is either one and it also means that post-action won't consume their actor turns like normal.</p>"},{"location":"Battle%20system/Player%20actions/Skills/IceDrill/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 250.0 SequentialKeys {6.0} 2 DoCommand 1 set <code>combo</code> to a value higher than 2 60.0 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)}"},{"location":"Battle%20system/Player%20actions/Skills/IceDrill/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1_a DoCommand 1 set <code>combo</code> to a value higher than 2, done 3 times null <code>availabletargets[target]</code> GetMultiDamage for <code>Beetle</code> and <code>Moth</code> / 2.0 * <code>barfill</code> rounded to nearest (to nearest even if ending in .5) + 1 Pierce empty array false 1_b Either one of the following happened:<ul><li>DoCommand 1 set <code>combo</code> to a value of 2 or lower</li><li>DoCommand 2 set <code>commandsuccess</code> to false</li></ul> null <code>availabletargets[target]</code> 1 null empty array false 2 DoCommand 2 set <code>commandsuccess</code> to true null <code>availabletargets[target]</code> GetMultiDamage for <code>Beetle</code> and <code>Moth</code> / 2.0 * <code>barfill</code> rounded to nearest (to nearest even if ending in .5) + 2 null empty array false"},{"location":"Battle%20system/Player%20actions/Skills/IceDrill/#additional-flip-logic","title":"Additional flip logic","text":"<p>DoDamage 1_a doesn't have a <code>Flip</code> property, but the action comes with custom logic that does a reduced version of what the property does and it is also done 3 times, each being done right after DoDamage 1_a call. It only concerns the conditions management and the <code>basestate</code> set in case of a Topple.</p> <p>Flip is called on the <code>target</code> enemy party member. This method features the same flip handling logic than the damage pipeline, but with 3 key differences:</p> <ul> <li>It doesn't have any logic about the damage effects (it doesn't apply here)</li> <li>It doesn't feature a DropItem call if the enemy party member was holding an item</li> <li>It doesn't feature setting <code>isdefending</code> to false meaning it will not break their guarding</li> </ul> <p>The rest (including the toppling management and the Flipped condition infliction) are the same.</p>"},{"location":"Battle%20system/Player%20actions/Skills/IceDrill/#logic-seqeunce","title":"Logic seqeunce","text":"<ul> <li>Both <code>Beetle</code> and <code>Moth</code> have LockRigid(false) called on them with <code>flip</code> and <code>overrideflip</code> set to true</li> <li><code>Beetle</code> MoveTowards (-2.95, 0.0, -1.45) at 2.0x speed</li> <li><code>Moth</code> MoveTowards (-4.25, 0.0, -2.0) at 2.0x speed</li> <li>Yield until <code>Beetle</code> and <code>Moth</code>'s <code>forcemove</code> are done</li> <li>Both <code>Beetle</code> and <code>Moth</code> have <code>flip</code> set to true and <code>overrideflip</code> set to false</li> <li>Camera moves slowly to the midpoint between the attacker and the <code>target</code> enemy party member</li> <li><code>Moth</code> animstate set to 108</li> <li><code>Prefabs/AnimSpecific/mothbattlesphere</code> instantiated rooted at <code>Moth</code>'s position + (-0.75, 1.55, 0.0) with 90.0 angle in x</li> <li><code>Prefabs/Objects/SingleSphere</code> instantiated childed to the <code>Prefabs/AnimSpecific/mothbattlesphere</code> with a local position of Vector3.zero and a MeshRenderer's materiral.color of pure white with half transparency</li> <li><code>Prefabs/AnimSpecific/mothbattlesphere</code> moves via an ArcMovement to its position + (2.0, -5.0, 0.0) with 3.0 height over the course of 40.0 frametime</li> <li><code>Prefabs/AnimSpecific/mothbattlesphere</code> destroyed in 2.0 seconds</li> <li><code>Dig</code> sound plays</li> <li><code>checkingdead</code> set to a new KabbuDig call on <code>Beetle</code></li> <li>Yield until <code>checkingdead</code> is done</li> <li>Yield for 0.5 seconds</li> <li>LockRigid(true) called on <code>Beetle</code></li> <li><code>Beetle</code> moves towards (MainManager.MoveTowards) the <code>target</code> enemy party member + -0.1 in z over 75.0 frametime with smooth</li> <li>DoCommand 1 call happens</li> <li>Yield for 1.0 seconds</li> <li>Yield until <code>doingaction</code> is false</li> <li><code>commandsuccess</code> is set to whether or not <code>combo</code> is higher than 2 (the command is considered succeeded for this specific action if it is)</li> <li><code>DigPop</code> sound plays</li> <li><code>DirtExplode</code> particles plays at the <code>target</code> enemy party member position</li> <li>ShakeScreen for 0.1 ammount for 0.75 time with dontreset</li> <li>If <code>commandsuccess</code> is true:<ul> <li><code>WaspDrill</code> sound plays on loop</li> <li><code>Prefabs/Objects/IceDrill</code> instantiated rooted at the <code>target</code> enemy party member + -5.0 in y with -90.0 angle in x</li> <li><code>Prefabs/Objects/IceDrill</code> moves towards (MainManager.MoveTowards) the <code>target</code> enemy party member over the course of 10.0 frametime with local (this will smoothly reveal the object from the ground)</li> <li><code>Moth</code> animstate set to 101</li> <li><code>Prefabs/Objects/IceDrill</code> z scale set to 0.75</li> <li>Camera moves to look at the <code>target</code> enemy party member + 2.0 in y</li> <li><code>Moth</code> animstate set to 108</li> <li><code>Prefabs/Objects/IceDrill</code> gets a SpinAround added with an <code>itself</code> of (0.0, 0.0, -1.5 * <code>combo</code>)</li> <li><code>Beetle</code> is set to not be <code>digging</code></li> <li><code>Beetle</code> y position decreases by 3.0</li> <li>If the <code>target</code> enemy party member's weight is less than 100.0:<ul> <li>LockRigid(true) called on them</li> <li>Their y <code>spin</code> is set to 2.5 * <code>combo</code></li> </ul> </li> <li><code>target</code> enemy party member gets <code>overrideanim</code> and <code>overridejump</code> set to true</li> <li><code>target</code> enemy party member animstate set to 11 (<code>Hurt</code>)</li> <li>The following is done 3 times:<ul> <li>If the <code>target</code> enemy party member's weight is less than 100.0, they will move to 1.5 in y via an ArcMovement with 4.0 height over 40.0 frametime with their <code>onground</code> set to false</li> <li><code>ShieldHit</code> sound plays with 0.65 volume</li> <li>DoDamage 1_a call happens</li> <li>Flip is called on the <code>target</code> enemy party member (see the section above for more details)</li> <li>If this is the last (third) iteration, DoCommand 2 call happens</li> <li><code>Moth</code> animstate set to 104</li> <li>Yield for 0.5 seconds</li> <li>Yield for 0.1 seconds</li> </ul> </li> <li>Yield until <code>doingaction</code> is false</li> <li><code>Beetle</code>'s <code>sprite</code> local position set to Vector3.zero</li> <li><code>target</code> enemy party member's <code>spin</code> zeroed out</li> <li><code>WaspDrill</code> sound stopped</li> <li>If <code>commandsuccess</code> is true (set by DoCommand 2):<ul> <li><code>BigHit</code> sound plays</li> <li><code>OverworldIce</code> sound plays at 0.9 pitch</li> <li><code>DirtExplode</code> particles plays at the <code>target</code> enemy party member</li> <li><code>mothicenormal</code> particles plays at <code>Prefabs/Objects/IceDrill</code> + 2.0 in y with a uniform scale of 2.5x</li> <li><code>IceShatter</code> particles plays at <code>Prefabs/Objects/IceDrill</code> + 2.0 in y with a uniform scale of 2.5x</li> <li><code>Prefabs/Objects/IceDrill</code> destroyed</li> <li>ShakeScreen with an ammount of 0.2 for 0.85 time with dontreset</li> <li><code>Beetle</code>'s y <code>spin</code> set to 30.0</li> <li><code>Beetle</code>'s <code>overrideflip</code> set to false</li> <li><code>Beetle</code> animstate set to 119</li> <li>If the <code>target</code> enemy party member's weight is less than 100.0, they will move to 0.0 in y via an ArcMovement with 7.5 height over 60.0 frametime with their <code>onground</code> set to false</li> <li>DoDamage 2 call happens</li> <li><code>Beetle</code> moves to its initial position before this action + Vector3.up via an ArcMovement with a height of 10.0 over 60.0 frametime</li> <li>Yield for 1.0 seconds</li> </ul> </li> </ul> </li> <li>FlipAngle(true) called on <code>Beetle</code></li> <li>Camera reset to default slowly</li> <li><code>Beetle</code>'s <code>sprite</code> local position set to Vector3.zero</li> <li>If <code>commmandsuccess</code> is false (meaning DoCommand 1 set <code>combo</code> to 2 or lower OR DoCommand 2 set <code>commandsuccess</code> to false):<ul> <li><code>Moth</code> animstate set to 109 if DoCommand 1 didn't set <code>combo</code> to higher than 2</li> <li><code>DirtExplode</code> particles plays at the <code>target</code> enemy party member</li> <li>If <code>Prefabs/Objects/IceDrill</code> exists:<ul> <li><code>IceShatter</code> particles plays where it is + 1.0 in y</li> <li>It is destroyed</li> </ul> </li> <li>DoDamage 1_b call happens</li> <li><code>Beetle</code> moves to its initial position before this action via an ArcMovement with a height of 10.0 over 60.0 frametime</li> <li><code>Beetle</code> animstate set to 11 (<code>Hurt</code>)</li> <li>Yield for 1.0 seconds</li> </ul> </li> <li>Both <code>Beetle</code> and <code>Moth</code> have the following happen to them:<ul> <li>MoveTowards their initial position before this action at 2.0x speed with a stopstate of 13 (<code>BattleIdle</code>)</li> <li><code>overrideflip</code> set to true</li> <li><code>overrideanim</code> set to false</li> <li><code>spin</code> zeroed out</li> <li>LockRigid(false) called on them</li> </ul> </li> <li>Yield until <code>Beetle</code> and <code>Moth</code>'s <code>forcemove</code> are done</li> <li>Both <code>Beetle</code> and <code>Moth</code> have the following happen to them:<ul> <li><code>overrideanim</code> set to false</li> <li><code>flip</code> set to true</li> <li>position set to initial position before this action</li> </ul> </li> <li>LockRigid(false) called on <code>target</code> enemy party member</li> <li><code>target</code> enemy party member's <code>overrideanim</code> set to false</li> <li>MultiSkillMove is called with 1 and 2 (normally <code>Beetle</code> and <code>Moth</code>)</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceRain/","title":"<code>IceRain</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/IceRain/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Done 4 times for each enemy party members that fufills these conditions:<ul><li>Their <code>hp</code> is above 0</li><li>Their position isn't <code>OutOfReach</code> or <code>Underground</code></li><li>They are IsInRadius (without getair and xonly) with a radius of 2.0 of the crosshair's x position (see the section below for more details)</li></ul> <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> unclamped Freeze Empty array false"},{"location":"Battle%20system/Player%20actions/Skills/IceRain/#about-the-target-selection","title":"About the target selection","text":"<p>There is a \"fake\" action command in this action that happens before all the DoDamage 1 calls, but its outcome influences all of these calls because it involves the position used for IsInRadius moving horizontally back and forth until the Confirm input is pressed. Since the method will change the position of the radius, this is effectively a target selection.</p> <p>To indicate the x position, a new UI object is created called <code>crosshair</code> rooted on layer 15 (<code>3DUI</code>) with a SpriteRenderer using the sprite <code>guisprite[41]</code> (a crosshair without a ring).</p> <p>Before each DoDamage call, there will be an indefinite loop that won't stop yielding frames until the Confirm input is pressed. Before each yield, the <code>crosshair</code>'s z angle increases by 10x the game's frametime, y position is set to 6.0 and the z to 0.0, but the x is the result of a sin curve. That curve is 3.5 + Sin(Time.time * 5.0) * 3.0 which means the <code>crosshair</code>'s x position will cycle from 0.5 to 6.5 with a period of 2pi / 5 seconds (~1.2566 seconds).</p> <p>Once the input is pressed the <code>crosshair</code> x position is determined and the z is fixed to 0.0, but the y has some special logic to it. It will try to go towards 0.0, but it's possible the it won't be 0.0. It happens if the x of the <code>crosshair</code> was less than 1.0 away from the x world CenterPos x of any enemy party member checked in <code>enemydata</code> order. In that case, the y component will be the first y position of an icicle object dropping from 6.0 to 0.0 where the value becomes less than the enemy party member's y world CenterPos. This drops occurs in a span of 46.0 frames. Intuitively, it can be thought of that if an object would fall on top of an enemy party member, the <code>crosshair</code> will stop short instead of going to the ground at 0.0. This can affect the radius check.</p> <p>Once the <code>crosshair</code> position is fully determined, it won't change and it will be used for the next DoDamage call and apply to each enemy party members that fall within 2.0. of this point. NOTE: The IsInRadius call has getair to false meaning it will accept either the physical position or the world CenterPos of the enemy party member.</p> <p>This process is repeated for each instances of DoDamage 1 calls so each uses a different base point to check for the radius that is controlled by the player.</p>"},{"location":"Battle%20system/Player%20actions/Skills/IceRain/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves towards the right side of the stage</li> <li>attacker animstate set to 105</li> <li>Yield for 0.5 seconds</li> <li>The crosshair mentioned in the section above is created</li> <li>A local array of 4 GameObject is initialised which will contain the 4 icicles used for the action</li> <li>All enemy party members whose position isn't <code>Underground</code> or <code>OutOfReach</code> has TempCrosshair called on them and their resulting transforms stored in a local array</li> <li>Loop done exactly 4 times:<ul> <li><code>Crosshair</code> sound played on <code>sounds[9]</code> with 0.9 pitch and 0.35 volume on loop</li> <li>attacker animstate set to 105</li> <li>Yield for a frame</li> <li>The target selection loop mentioned in the section above occurs. During it, every enemy party members whose <code>hp</code> is 0 or below will have its TempCrosshair disabled if it wasn't already</li> <li>The main <code>crosshair</code> used for the target selection is disabled</li> <li><code>sounds[9]</code> stops playing</li> <li>The corresponding element of the icicle array is initialised to a new <code>Prefabs/Objects/icecle</code> rooted at (main <code>crosshair</code>'x position, 15.0, 0.0)</li> <li>An IceRain corotine starts with a startpos of the <code>crosshair</code>'s x position and the newly created <code>Prefabs/Objects/icecle</code> as icicle (see the section below for details)</li> <li>attacker animstate set to 100</li> <li>Yield for 0.5 seconds</li> </ul> </li> <li>All TempCrosshair are destroyed</li> <li>attacker animstate set to 102</li> <li>Yield until icicles used are completely null (they are supposed to be destroyed, but it can take some time before they get set to null)</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceRain/#icerain_1","title":"IceRain","text":"<p>This is a coroutine that is specific to this action. It is started after each Confirm input press and it is the coroutine that performs the icicle drop mentioned earlier as well as the DoDamage 1 call.</p> <pre><code>private IEnumerator IceRain(float startpos, Transform icecle)\n</code></pre>"},{"location":"Battle%20system/Player%20actions/Skills/IceRain/#parameters","title":"Parameters","text":"<ul> <li><code>startpos</code>: The <code>crosshair</code>'s x position used for targetting like mentioned earlier</li> <li><code>icicle</code>: An icicle object to drop, has to be a different instance on each call (which it is normally)</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceRain/#about-possible-race-conditions","title":"About possible race conditions","text":"<p>This coroutine is never yielded on: it simply starts with DoDaction not paying close attention on it. The only thing DoAction does after starting it is to yield for 0.5 seconds, but this coroutine is designed to take longer than that.</p> <p>However, this is safe to do this: the icicle parameter are different elements of an array and each calls gets a different one. The coroutine limits itself to perform tasks that doesn't affect what DoAction is doing so even if they are both running concurently, in practice, this is safe to do so. The only effect it has is it allows for the player to drop the next icicle slightly before the previous one's drop ended. This is again, safe because the coroutine doesn't introduce any race conditions with DoAction.</p> <p>Additionally, the last step of the coroutine involves destroying the icicle and DoAction makes sure to yield until all of the ones that were passed to this coroutine are set to null meaning all instances of the coroutines are guaranteed to be done after these yields on DoAction's end.</p>"},{"location":"Battle%20system/Player%20actions/Skills/IceRain/#procedure","title":"Procedure","text":"<ul> <li>Each enemy party members is checked if they are so close to the icicle horizontally that the drop should be stopping short if it touches that enemy party member. See the section above about target selection to learn more, but the result is stored in the form of the <code>enemydata</code> index if it applies or -1 if it doesn't</li> <li>Over the course of 46.0 frames, the icile drop occurs where the icicle moves towards 0.0 in y with its y angle increased by 20x the game's frametime each frames. This is also where the target position can stop short in y if the icicle falls below the concerned enemy party member (see the section about target selection above to learn more)</li> <li><code>mothicenoraml</code> particles played at the target position + (0.0, 1.0, 0.0) with a scale of (2.0, 2.0, 2.0)</li> <li>For each targetted enemy party members that satisfied the DoDamage 1 call's conditions, the call happens with them</li> <li>The icicle is moved offscreen</li> <li>Yield for 0.5 seconds</li> <li>The icicle is destroyed (DoAction will wait that all of them are fully set to null)</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/IceSphere/","title":"<code>IceSphere</code>","text":"<p>This is a MultiSkillMove with <code>Bee</code>, <code>Beetle</code> and <code>Moth</code> and as such, it is assumed that the attacker is one of them and it also means that post-action won't consume their actor turns like normal.</p>"},{"location":"Battle%20system/Player%20actions/Skills/IceSphere/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 275.0 SequentialKeys {6.0, 1.0} 2 None 53.3333321 PressKeyTimer {Random integer (cast to float) between 4 and 6 (Confirm, Cancel or Switch input)}"},{"location":"Battle%20system/Player%20actions/Skills/IceSphere/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Done for each enemy party member that fufills these conditions:<ul><li>Their position isn't <code>OutOfReach</code> or <code>Underground</code></li><li>Their <code>height</code> is higher than 3.0</li><li>The iceball x position + 1.0 passes the enemy party member's x position (see the section below for details)</li></ul> null The enemy party member GetMultiDamage with <code>Bee</code>, <code>Beetle</code> and <code>Moth</code> (halved ceiled if DoCommand 2 set <code>commandsuccess</code> to false) * (<code>barfill</code> if it's 0.9 or higher otherwise, take <code>barfill</code> * 0.8 clamped from 0.25 to 1.0) ceiled clamped from 2 to 99 Freeze empty array false"},{"location":"Battle%20system/Player%20actions/Skills/IceSphere/#damagewithinpos-calls","title":"DamageWithinPos calls","text":"# Conditions playerid damageammount property radius xonly 1 DoCommand 2 set <code>commandsuccess</code> to true and the Confirm input was pressed to explode the iceball. The iceball's position is effectively used as the position since <code>Bee</code>'s position is set to it (see the section below for details) 0 (<code>Bee</code>) GetMultiDamage with <code>Bee</code>, <code>Beetle</code> and <code>Moth</code> (halved ceiled if DoCommand 2 set <code>commandsuccess</code> to false) / 2.0 * (<code>barfill</code> if it's 0.9 or higher otherwise, take <code>barfill</code> * 0.8 clamped from 0.25 to 1.0) clamped from 1.0 floored Freeze 3.0 false"},{"location":"Battle%20system/Player%20actions/Skills/IceSphere/#iceball-rolling-logic","title":"Iceball rolling logic","text":"<p>The damaging logic of this action is affected by an iceball rolling to the right towards the enemy party and by its optional explosion that the player can trigger.</p> <p>How it works is a <code>Prefabs/Objects/IceSphere</code> gets instantiated and after a bunch of animation logic (after DoCommand 2), it ends up being rooted at (-4.5, 1.75 * x + 0.25 * (1.0 - x), 0.0) where x is <code>barfill</code> if it's 0.9 or higher otherwise, it's <code>barfill</code> * 0.8 clamped from 0.25 to 1.0.</p> <p>From there, over the course of 81.0 frames (101.0 frames instead if DoCommand 2 set <code>commandsuccess</code> to false), the iceball will move to 10.0 in x via a lerp. During this move, this is where DoDamage 1 call can take effect if the iceball's position + 1.0 goes past an enemy party member's position (they still need to respect some other conditions as the DoDamage table above shows).</p> <p>However, during the move, the player can at any point interrupt it by pressing the Confirm input when past 34.0 frames. This is only available if DoCommand 2 set <code>commandsuccess</code> to true. This is optional: the player may decide to not press the input and let the iceball move all the way to 10.0 in x.</p> <p>If it is pressed, the iceball immediately stops, <code>Bee</code>'s position is set to the iceball's position and DoDamageWithinPos 1 call happens. Since <code>Bee</code>'s position is the same as the iceball's for that moment, the iceball's position is what is going to be used as the position to compare the radiuses and determine which enemy party members is affected.</p>"},{"location":"Battle%20system/Player%20actions/Skills/IceSphere/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>Bee</code> MoveTowards (-4.5, 0.0, 0.0) at 2.0x speed</li> <li><code>Beetle</code> MoveTowards (-8.2, 0.0, 0.0) at 2.0x speed</li> <li><code>Moth</code> MoveTowards (-6.45, 0.0, -0.85) at 2.0x speed</li> <li>Camera is set to look at at the left side of the stage</li> <li>Yield until <code>Bee</code>, <code>Beetle</code> and <code>Moth</code>'s <code>forcemove</code> are done</li> <li><code>Bee</code>, <code>Beetle</code> and <code>Moth</code> have LockRigid(true) called on them with <code>overrideflip</code>, <code>overrideanim</code>, <code>overidefly</code> and <code>flip</code> set to true</li> <li><code>Moth</code> animstate set to 105</li> <li><code>Bee</code> animstate set to 11 (<code>Hurt</code>)</li> <li><code>Prefabs/Objects/IceSphere</code> instantiated rooted with a scale of Vector3.zero and stored in a local named iceball with its first child named bsrpite which is rooted and moved offscreen</li> <li><code>IceRadius</code> particles played at <code>Bee</code>'s position + Vector3.up infinetly with 7.0x uniform scale chiled to <code>Bee</code>'s <code>sprite</code></li> <li>iceball gets childed to <code>Bee</code>'s <code>sprite</code></li> <li><code>OverworldIce</code> sound plays</li> <li><code>mothicenormal</code> particles plays without sound at <code>Bee</code>'s position + 1.0 in y for 3.0 alivetime and 3500 rendersort</li> <li>iceball local position set to Vector3.up</li> <li><code>Bee</code>'s <code>bobrange</code> set to 1.0</li> <li>DoCommand 1 call happens</li> <li><code>Spin</code> sound plays on <code>sounds[9]</code> with 0.5 pitch on loop</li> <li>Yield until <code>doingaction</code> goes to false. Before each frame yield:<ul> <li>A value is calculated being the lerp from the previous value of <code>barfill</code> clamped from 0.25 to 1.0 (starting at 0.0) to its current value clamped from 0.25 to 1.0 with a factor of 1/10th of the game's frametime. This controls progression through <code>barfill</code></li> <li><code>Bee</code>'s y <code>spin</code> set to 20.0 * the <code>barfill</code> progression value</li> <li>iceball scale set to a lerp from Vector3.zero to Vector3.one * 200.0 with a factor of the <code>barfill</code> progression value clamped from 0.5 to 1.0</li> <li><code>Bee</code>'s <code>height</code> set to a lerp from the existing one to 2.5 with a factor of 0.0075 * the game's frametime</li> <li><code>IceRadius</code>'s ParticleSystem's emmision's rateOverTime set to a lerp from 1.0 to 20.0 with a factor of the <code>barfill</code> progression value</li> <li><code>sounds[9]</code>'s pitch set to a lerp from 0.5 to 0.75 with a factor of <code>barfill</code></li> <li>instance.<code>camoffset</code> set to a lerp from <code>defaultcamoffset</code> to (0.0, 2.5, -11.0) with a factor of the <code>barfill</code> progression value</li> </ul> </li> <li><code>sounds[9]</code> is stopped</li> <li>The corrected <code>barfill</code> amount is calculated by taking its value (or the value * 0.8 if it's less than 0.9) and clamping it from 0.25 to 1.0</li> <li>iceball's scale set to uniform 200.0x * the corrected <code>barfill</code> value clamped from 0.5 to 1.0</li> <li>instance.<code>camoffset</code> set to (0.0, 3.2, -9.85)</li> <li><code>IceRadius</code> moved offscreen and destroyed in 5.0 seconds</li> <li>iceball gets rooted</li> <li>bsprite gets childed to the iceball with a scale of Vector3.zero</li> <li><code>Bee</code> is moved offscreen</li> <li><code>Freeze</code> sound plays</li> <li><code>mothicenormal</code> particles plays without sound at bsprite's position + Vector3.one for 3.0 alivetime and 3500 rendersort with a scale of uniform 2.0x * the corrected <code>barfill</code> value</li> <li>Yield for 0.5 seconds</li> <li><code>Beetle</code> has LockRigid(false) called on them</li> <li><code>Beetle</code>'s <code>overrideflip</code> set to true</li> <li><code>Beetle</code> MoveTowards (-9.5, 0.0, 0.0) with a stopstate of 116</li> <li><code>Charge7</code> sound plays at 0.7 pitch</li> <li>Over the course of max 81.0 frames (or until the DoCommand 2 call is done with <code>doingaction</code> going false after it started), the iceball moves to its position + 2.0 in y via a BeizierCurve3 with a ymax of 8.0. Before each frame yield, the following happens:<ul> <li>If <code>Beetle</code>'s <code>forcemove</code> is done, it gets ShakeSprite called with 0.1 intensity and 1.0 frametimer</li> <li><code>Beetle</code> animstate set to 116</li> <li>Yield for an additional extra frame</li> <li>If DoCommand 2 call didn't happened yet and we are past 32.0 frames, DoCommand 2 call happens</li> </ul> </li> <li><code>Beetle</code>'s <code>sprite</code> local position is reset to Vector3.zero</li> <li><code>Beetle</code> has LockRigid(true) called on them</li> <li><code>Moth</code> animstate set to 102</li> <li>If <code>commandsuccess</code> is true, <code>PingShot</code> sound plays at 0.9 pitch. Otherwise, <code>Beetle</code> animstate set to 105</li> <li>Over the course of 16.0 frames (26.0 frames instead if <code>commandsuccess</code> is false), iceball moves in y to 1.75f * x + 0.25f * (1f - x) where x is the corrected <code>barfill</code> value and <code>Beetle</code> moves to the iceball initial position before this move -1.0 in x (0.0 for y and z)</li> <li>ShakeScreen with an ammount of 0.2 * the corrected <code>barfill</code> value for 0.5 time with dontreset</li> <li>A SpinAround gets added to iceball</li> <li>Camera reset to default</li> <li><code>hitpart</code> (the particles) plays at <code>Beetle</code>'s position</li> <li>If <code>commandsuccess</code> is true:<ul> <li>iceball's SpinAround's <code>itself</code> set to (-10.0, -3.0, -8.0) * the corrected <code>barfill</code> value</li> <li><code>BigHit</code> sound plays</li> </ul> </li> <li>Otherwise:<ul> <li>iceball's SpinAround's <code>itself</code> set to (-10.0, -3.0, -8.0) * the corrected <code>barfill</code> value / 3.0</li> <li><code>Beetle</code> animstate set to 18 (<code>KO</code>)</li> <li>DeathSmoke particles plays at <code>Beetle</code>'s position</li> <li><code>Damage0</code> sound plays</li> </ul> </li> <li>If <code>commandsuccess</code> is true:<ul> <li><code>Beetle</code> moves to its position + (-1.5, 0.0, 0.0) via an ArcMovement with a height of 3.0 over 40.0 frametime</li> <li><code>presskey</code> set to 4 (Confirm)</li> <li>If the corrected <code>barfill</code> value is higher than 0.6, a ButtonSprite is SetUp with the <code>presskey</code> input childed to the <code>GUICamera</code> with a local positon of (0.0, 2.0, 10.0) and a sortorder of 10. The ButtonSprite is disabled for now</li> </ul> </li> <li><code>spin5</code> sound plays on <code>sounds[9]</code> with 1.5 pitch and 0.9 volume on loop</li> <li>Yield for a frame</li> <li>Over the course of 81.0 frames (101.0 frames instead if <code>commandsuccess</code> is false), the iceball moves to (10.0, its current y position, 0.0). During the move:<ul> <li>If <code>commandsuccess</code> is true and we are past 24 frames:<ul> <li>The ButtonSprite gets enabled</li> <li>The ButtonSprite's <code>basesprite</code>'s color is set to grey or white (white if Sin(Time.time * 20.0) is higher than 0.0, grey otherwise)</li> <li>If <code>presskey</code> (Confirm) is pressed, the iceball moves breaks out early and the explosion damage will happen</li> </ul> </li> <li>DoDamage 2 call happens for each applicable enemy party members if they hadn't received the call yet</li> </ul> </li> <li>The ButtonSprite is destroyed</li> <li><code>Beetle</code> and <code>Moth</code> animstate set to 13 (<code>BattleIdle</code>)</li> <li><code>sounds[9]</code> is stopped</li> <li><code>Explosion5</code> sound plays</li> <li><code>IceShatter</code> particles plays at the iceball with a scale of uniform 3.0x</li> <li><code>Bee</code>'s position is set to the iceball's</li> <li>The iceball is destroyed</li> <li>If the Confirm input press was accepted earlier:<ul> <li>ShakeScreen for 0.3 ammount and 1.25 time with dontreset</li> <li><code>mothicenormal</code> particles played at <code>Bee</code>'s position + 1.0 in y with scale of uniform 4.0 * corrected value of <code>barfill</code></li> <li>DamageWithinPos 1 call happens</li> </ul> </li> <li>Otherwise (<code>commandsuccess</code> was false or no Confirm input was pressed), ShakeScreen for 0.2 ammount for 0.75 time with dontreset</li> <li><code>Bee</code>'s y <code>spin</code> set to 30.0</li> <li><code>Bee</code>'s <code>height</code> set to 0.0</li> <li>Over the course of 61.0 frames, <code>Bee</code> moves to their initial position before this action via a BeizierCurve3 with a ymax of 7.0</li> <li><code>Bee</code> animstate set to 18 (<code>KO</code>)</li> <li><code>Bee</code>'s <code>spin</code> is zeroed out</li> <li>DeathSmoke particles played at <code>Bee</code>'s position</li> <li><code>Death3</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>Bee</code>, <code>Beetle</code> and <code>Moth</code> have LockRigid(false) called on them, they MoveTowards their initial position before this action with a 2.0x speed with <code>overrideflip</code>, <code>overrideanim</code>, <code>overridejump</code> and <code>overidefly</code> set to false</li> <li>Yield until <code>Bee</code>, <code>Beetle</code> and <code>Moth</code>'s <code>forcemove</code> are done</li> <li><code>Bee</code>, <code>Beetle</code> and <code>Moth</code> have their <code>flip</code> set to true and their position set to their initial one before this action</li> <li>UpdateAnim is called</li> <li>Yield for a frame</li> <li>MultiSkillMove is called with 0, 1 and 2 (normally <code>Bee</code>, <code>Beetle</code> and <code>Moth</code>)</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/Icefall/","title":"<code>Icefall</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/Icefall/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Done for each enemy party member that fufills these conditions:<ul><li>Its position must not be <code>OutOfReach</code> or <code>Underground</code></li><li>After confirming the crosshair position, it must be IsInRadius of the enemy party's member with a radius of 3.3 (see the section below for details)</li></ul> <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> Freeze Empty array false"},{"location":"Battle%20system/Player%20actions/Skills/Icefall/#icicle-launch","title":"Icicle launch","text":"<p>This action doesn't feature an action command, but it does feature some logic involving an icicle being launch at an angle determined by the player. In a way, it's a \"fake\" action command because it's logic specific to this action, but it does involve user inputs.</p> <p>The way it works is after some initial animations, a new UI object called <code>crosshair</code> is created rooted to the scene with a sprite of <code>guisprites[41]</code> (a crosshair without its ring) on layer 15 (<code>3DUI</code>).</p> <p>From there, all frames are yielded until the Confirm input is pressed, but before the yield, the <code>crosshair</code> z angle and x/y position changes. The angle is only for visual effects (it gets incremented by 5x the game's frametime each frame), but the position is what affects the action's logic. The x and y changes with a sin and cos curve respectively (the t term is Time.time):</p> <ul> <li>x: sin(5t) * 3.25 + 3.5</li> <li>y: cos(2x) * 2 + 2.5</li> </ul> <p>This can be summarised by the following:</p> <ul> <li>The x varies between 0.5 and 6.75 with a period of 2pi / 5 (~1.26 seconds)</li> <li>The y varies between 0.5 and 4.5 with a period of pi (~3.1416 seconds)</li> </ul> <p>This essentially creates a sort of zig zag movement over a rectangle with a lower left corner at (0.5, 0.5) and an upper right corner at (6.75, 4.5).</p> <p>However, it should be noted for the y position, the camera's y <code>camoffset</code> will be added to any point if it was above 4.0. This moves the whole rectangle up to line up with the camera and it allows to compensate for a vertically high camera.</p> <p>The final position when Confirm is pressed will be the one used to call IsInRadius with and for damages to be dealt, the point needs to be less than 3.3 units away from the enemy party member. This test is performed for each enemy party members that aren't <code>OutOfReach</code> or <code>Underground</code>. Damages won't be dealt if the enemy party member is too far away.</p> <p>This means it allows to target multiple enemy party emmebrs are once, but regardless of where the <code>crosshair</code> lands, damages are dealt or not dealt, there is no analogue variation.</p>"},{"location":"Battle%20system/Player%20actions/Skills/Icefall/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera is set to look at the center</li> <li>attacker animstate set to 105</li> <li><code>Prefabs/Objects/icecle</code> instantiated rooted above the party, but with a scale of Vector3.zero and its BoxCollider destroyed</li> <li><code>Spin</code> sound played on <code>sounds[8]</code> with a pitch of 0.0 on loop</li> <li>Over the course of 60.0 frames, the <code>Prefabs/Objects/icecle</code>'s scale grows to Vector3.one and its y angle increases continuously until it reaches a 10.0 increment. Also, <code>sounds[8].pitch</code> increases towards 1.0</li> <li>attacker animstate set to 106</li> <li>The <code>crosshair</code> UI object is created like mentioned in the section above</li> <li><code>Crosshair</code> sound plays on <code>sounds[9]</code> with 0.9 pitch and 0.35 volume on loop</li> <li>All enemy party members whose position isn't <code>OutOfReach</code> or <code>Underground</code> have TempCrosshair called on them without groundpos and the return is stored in a temporary array</li> <li>Yield for a frame</li> <li>The Confirm input loop mentioned above occurs, but before each yield, <code>Prefabs/Objects/icecle</code>'s y angle gets incremented by 10.0. This continues indefinetely until the Confirm input is pressed</li> <li><code>sounds[9]</code> is stopped with a 0.1 fade speed</li> <li><code>sounds[8]</code> is stopped with a 0.1 fade speed</li> <li><code>IceMothThrow</code> sound is played</li> <li>attacker animstate set to 107</li> <li><code>crosshair</code> is disabled (this is to stop rendering it, but it is still physically present)</li> <li><code>Prefabs/Objects/icecle</code> angles are reset to (0.0, 0.0, 45.0 + <code>crosshair</code>'s y position * 4.0)</li> <li>Over the course of 11/200 frames (~18.18), <code>Prefabs/Objects/icecle</code>'s position goes towards the <code>crosshair</code>'s position</li> <li>All TempCrosshair created earlier gets destroyed</li> <li><code>IceMothHit</code> sound plays</li> <li><code>Prefabs/Particles/mothicenormal</code> instantiated childed to <code>Prefabs/Objects/icecle</code> with -90.0 degrees rotation in x and a scale of (2.0, 2.0, 2.0) and destroyed in 5.0 seconds</li> <li><code>Prefabs/Objects/icecle</code> is destroyed</li> <li>The position of <code>crosshair</code> is obtained and the UI object is then destroyed</li> <li>Each enemy is checked for the DoDamage 1 call and it is performed if applicable as mentioned in the section above</li> <li>If DoDamage 1 was called at least once, <code>AtkSucess</code> sound plays</li> <li>Yield for 1.0 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/NeedlePincer/","title":"<code>NeedlePincer</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/NeedlePincer/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 60.0 PressKeyTimer {random between 4 and 6 include (Confirm, Cancel or Switch)} 2 DoCommand 1 set <code>commandsuccess</code> to true 45.0 PressKeyTimer {random between 4 and 6 include (Confirm, Cancel or Switch)} 3 <code>Beemerang2</code> medal is equipped and DoCommand 2 set <code>commandsuccess</code> to true 45.0 PressKeyTimer {random between 4 and 6 include (Confirm, Cancel or Switch)}"},{"location":"Battle%20system/Player%20actions/Skills/NeedlePincer/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1a DoCommand 1 set <code>commandsuccess</code> to true <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> unclamped Pierce Empty array false 1b DoCommand 1 set <code>commandsuccess</code> to false <code>playerdata[currentturn]</code> The enemy party member attacker's <code>atk</code> clamped from -99 to 1 null {FailSound} false 2a DoCommand 2 set <code>commandsuccess</code> to true <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> * 0.7 floored clamped from 1 to 99. NOTE: This clamp incorrectly removes the influences of negative <code>atk</code> values Pierce Empty array false 2b DoCommand 2 set <code>commandsuccess</code> to false <code>playerdata[currentturn]</code> The enemy party member attacker's <code>atk</code> clamped from -99 to 1 null {FailSound} false 3a <code>Beemerang2</code> medal is equipped and DoCommand 3 set <code>commandsuccess</code> to true <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> * 0.49 floored clamped from 1 to 99. NOTE: This clamp incorrectly removes the influences of negative <code>atk</code> values Pierce Empty array false 3b <code>Beemerang2</code> medal is equipped and DoCommand 3 set <code>commandsuccess</code> to false <code>playerdata[currentturn]</code> The enemy party member attacker's <code>atk</code> clamped from -99 to 1 null {FailSound} false"},{"location":"Battle%20system/Player%20actions/Skills/NeedlePincer/#pincerstatus","title":"PincerStatus","text":"<p>Every DoDamage call after <code>commandsuccess</code> was set to true from the last DoCommand call has Pierce meaning they can't inflict any conditions by themselves. However, after each DoDamage call (if applicable), a method called PincerStatus happens which is exclusive to this action and NeedlePincer. It implies custom condition infliction logic.</p> <p>What's unique about this infliction logic is multiple conditions could be inflicted at once and each requires at least having a medal equipped for the infliction attempt to occur. Here are the possible conditions and their requirements (not mutually exclusive, checked and attempted in the order presented):</p> <ul> <li>If <code>PoisonNeedle</code> medal is equipped, 2 turns of Poison</li> <li>If <code>ElecNeedles</code> medal is equipped, 1 turn of Numb</li> <li>If <code>NumbNeedle</code> medal is equipped and the enemy party member doesn't have the Numb condition, 2 turns of Sleep</li> </ul> <p>However, the way the infliction attempt is done isn't via SetCondition, but via a method only used by PincerStatus called TryCondition which behaves similarily to CalculateBaseDamage.</p> <p>NOTE: Although similar, TryCondition has many differences depending on the condition compared to CalculateBaseDamage and it even has an off by one error in the resistance check. Check its documentation to learn more</p>"},{"location":"Battle%20system/Player%20actions/Skills/NeedlePincer/#logic-sequence","title":"Logic Sequence","text":"<ul> <li>attacker animstate set to 115</li> <li>Yield for 0.65 seconds</li> <li>The camera moves slowely up and back</li> <li>attacker MoveTowards in front of the target (offset in x by its size) at 2.0 speed stopping at animstate 121</li> <li>Yield until the attacker's <code>forcemove</code> is done</li> <li>DoCommand 1 call happens</li> <li>Yield for a frame</li> <li>Yield until <code>doingaction</code> goes to false</li> <li>If <code>commandsuccess</code> is false:<ul> <li><code>AtkFail</code> sound plays if it wasn't already playing</li> <li>attacker animstate set to 106</li> <li>Yield for 0.25 seconds</li> <li>DoDamage 1b happens</li> </ul> </li> <li>Otherwise (<code>commandsuccess</code> is true):<ul> <li>attacker MoveTowards 0.65 in x over 10.0 frames then back to its original position (MainManager coroutine)</li> <li>DoDamage 1a happens</li> <li>PincerStatus is called (check the section above for more details)</li> <li>attacker animstate set to 122</li> <li>Yield until <code>commandsprite[0]</code> goes to null (this means not only the action command is done, but that FinishAction's destroy calls are done)</li> <li>Yield for a frame</li> <li>Second and third hit loop (only one iteration unless <code>Beemerang2</code> medal is equipped where it's 2 iterations):<ul> <li>DoCommand 2 (or 3) happens</li> <li>Yield for a frame</li> <li>Yield until <code>doingaction</code> goes to false</li> <li>If <code>commandsuccess</code> is false, the same logic done than the first hit fail mentioned above is done (with DoDamage 2b or 3b) and break out of the loop early</li> <li>attacker MoveTowards 0.65 in x over 10.0 frames then back to its original position (MainManager coroutine)</li> <li>DoDamage 2a (or 3a) happens</li> <li>PincerStatus is called (check the section above for more details)</li> <li>attacker animstate set to 123</li> <li>Break out of the loop if <code>Beemerang2</code> medal is not equipped or if it's the second time this is reached</li> <li>Yield until <code>commandsprite[0]</code> goes to null (this means not only the action command is done, but that FinishAction's destroy calls are done)</li> <li>Yield for a frame</li> <li>attacker animsate set to 121</li> </ul> </li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/NeedleToss/","title":"<code>NeedleToss</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/NeedleToss/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1 Done on the first enemy party member (checked in <code>enemydata</code> order every 2 frames starting from the second one up to 41.0 frames) that fufills these conditions:<ul><li>Its position must not be <code>Underground</code></li><li>Its <code>hp</code> must be above 0</li><li>After confirming the crosshair position, its world CenterPos + 0.25 in x must be within a radius of 1.5 of the thrown dart (see the target selection section for more details)</li></ul> <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> - 1 unclamped Pierce Empty array false 2 Same as DoDamage 1, but this is the second throw only <code>playerdata[currentturn]</code> The enemy party member Depends if this is the same enemy party member targetted by DoDamage 1:<ul><li>If it's the same, it's <code>playerdata[currentturn].atk</code> - 1 * 0.65 floored clamped from 1 to <code>playerdata[currentturn].atk</code> - 1. NOTE: This clamp breaks with any base <code>atk</code> values of 1 and below because the lower bound is higher than the upper bound. The lower bound clamps always takes priority over the upper bound clamp in these cases</li><li>If it's not the same, it's <code>playerdata[currentturn].atk</code> - 1 unclamped</li></ul> Pierce Empty array false 3 Same as DoDamage 1 and 2, but this is the third throw only which can only happens if the <code>Beemerang2</code> medal was equipped <code>playerdata[currentturn]</code> The enemy party member Depends if this is the same enemy party member targetted by DoDamage 2:<ul><li>If it's the same, it's <code>playerdata[currentturn].atk</code> - 1 * 0.65 floored * 0.65 floored clamped from 1 to <code>playerdata[currentturn].atk</code> - 1. NOTE: This clamp breaks with any base <code>atk</code> values of 1 and below because the lower bound is higher than the upper bound. The lower bound clamps always takes priority over the upper bound clamp in these cases</li><li>If it's not the same, it's <code>playerdata[currentturn].atk</code> - 1 unclamped</li></ul> Pierce Empty array false"},{"location":"Battle%20system/Player%20actions/Skills/NeedleToss/#target-selection","title":"Target selection","text":"<p>This action features custom target selection logic involving a  \"fake\" action command where a cursor periodically rotate along the attacker which dictates the direction of a dart's throwing direction.</p> <p>How it works is there will be 3 sprites setup in a line formation around the attacker that will rotate periodically. The last 2 are hexagons that are only visually align with the crosshair and the attacker which the first one is the crosshair and is the furthest away. The crosshair is the one that matters to determine the direction.</p> <p>For the direction, there's an infinite input loop that won't stop until the Confirm input is pressed. This will be done for each thrown darts which is normally 2, but can be 3 if the <code>Beemerang2</code> medal is equipped. Here's what happens during this loop on each frame:</p> <ul> <li>The crosshair position is set to a new postion where the x and y are components are the result of sin and cos curve:<ul> <li>x: attacker's x position (should be -3.5 by then) + 1.0 + abs(cos(Time.time * 2.5)) * 2.0</li> <li>y: 3.5 + sin(Time.time * 2.5) * 2.55</li> <li>z: 0.0</li> </ul> </li> <li>The 2 hexagons rotates by -6.0 in z</li> <li>The closest hexagon's position is set to a lerp from the existing one + 3.5 in y to the crosshair with a factor of 1.0/3.0</li> <li>The closest hexagon's position is set to a lerp from the existing one + 3.5 in y to the crosshair with a factor of 2.0/3.0</li> </ul> <p>This means the crosshair positions varies in the following manner:</p> <ul> <li>x: Between -2.5 and 0.05 with a period of 2pi / 5 seconds (~1.2566)</li> <li>y: Between 0.95 and 6.05 with a period of 2pi / 5 seconds (~1.2566)</li> </ul> <p>It's essentially a warped circle where it's more oval shaped and stretched horizontally.</p> <p>Once the crosshair position has been determined, the normalised direction from the attacker to it determines the angle of the dart's throw. The exact direction is determined by the following 2 vectors:</p> <ul> <li>From: (attacker's x + 1.0, attacker's y + 2.5)</li> <li>To: (crosshair's x, crosshair's y - 0.25)</li> </ul> <p>Effectively, this is the range of the crosshair direction before normalisation:</p> <ul> <li>x: Between 0.0 and 2.0</li> <li>y: Between -1.8 and 3.3</li> </ul> <p>The dart appears at the attacker's <code>sprite</code> + (1.0, 0.5, -0.1). The attacker should be at (-3.5, 0.0, -0.65) by then. With that, a target position of the dart is calculated by doing the following:</p> <p>dart's position + crosshair direction * 15.0 + (0.0, -2.0, 0.0)</p> <p>The final z angle of the dart is the y of this heading direction - 3.0 and then multiplied by 5.0.</p> <p>Effectively the z angle is calculated by doing the following:</p> <ul> <li>The dart's initial y position is 0.5</li> <li>It gets added to the normalised crosshair direction * 15.0</li> <li>It gets subtracted by -2.0</li> <li>It gets subtracted by 3.0</li> <li>It gets multiplied by 5.0</li> </ul> <p>This gives an angle between -77.5 and 72.5 in z.</p> <p>As for the dart's target:</p> <ul> <li>Initial dart position: (-2.5, 0.5, -0.75) </li> <li>It gets added to the crosshair normalized direction * 15.0</li> <li>It gets added to (0.0, -2.0, 0.0)</li> </ul> <p>This gives us the following range:</p> <ul> <li>x: -2.5 to 8.0</li> <li>y: -16.5 to 13.5</li> <li>z: -0.75</li> </ul> <p>This is a broad range, but that's because the selection is almost half a circle on the right. What's important is the dart starts near the attacker, goes towards the crosshair (at least close enough) and -2.0 in y.</p> <p>The dart will move towards its target over the course of 41.0 frames. Every 2 frames (starting from the second one), every enemy party members is checked to see if they can receive damage. The first enemy party member found that can receive damage is the only one that will receive any meaning this is a single target action.</p> <p>For the enemy party member to receive damage, they need to fufill the following conditions (checked in <code>enemydata</code> order):</p> <ul> <li>Their <code>hp</code> must be above 0</li> <li>Their position must not be <code>Underground</code></li> <li>The xy distance between the dart and the enemy party member's position + their <code>cursoroffset</code> + (0.25, -1.0 + their <code>height</code>, 0.0) must be less than 1.5. NOTE: This is almost the same then the world CenterPos of the enemy party member, but it is shifted by 0.25 in x so it's slightly off to the right. However, this shift is 1/6th of the radius meaning it barely matters.</li> </ul> <p>As for the damage logic itself, it depends on which hits it is.</p> <p>For the first one, DoDamage 1 call happens For the second one, DoDamage 2 call happens For the third one (if applicable), DoDamage 3 happens</p> <p>Regardless of which DoDamage call is done:</p> <ul> <li>PincerStatus is called (see the section below for details)</li> <li>UpdateAnim is called</li> <li>The dart movement loop is stopped and the next throw input loop (if applicable) starts</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/NeedleToss/#pincerstatus","title":"PincerStatus","text":"<p>Every DoDamage call has Pierce meaning they can't inflict any conditions by themselves. However, after each DoDamage call (if applicable), a method called PincerStatus happens which is exclusive to this action and NeedlePincer. It implies custom condition infliction logic.</p> <p>What's unique about this infliction logic is multiple conditions could be inflicted at once and each requires at least having a medal equipped for the infliction attempt to occur. Here are the possible conditions and their requirements (not mutually exclusive, checked and attempted in the order presented):</p> <ul> <li>If <code>PoisonNeedle</code> medal is equipped, 2 turns of Poison</li> <li>If <code>ElecNeedles</code> medal is equipped, 1 turn of Numb</li> <li>If <code>NumbNeedle</code> medal is equipped and the enemy party member doesn't have the Numb condition, 2 turns of Sleep</li> </ul> <p>However, the way the infliction attempt is done isn't via SetCondition, but via a method only used by PincerStatus called TryCondition which behaves similarily to CalculateBaseDamage.</p> <p>NOTE: Although similar, TryCondition has many differences depending on the condition compared to CalculateBaseDamage and it even has an off by one error in the resistance check. Check its documentation to learn more</p>"},{"location":"Battle%20system/Player%20actions/Skills/NeedleToss/#logic-sequence","title":"Logic sequence","text":"<ul> <li>attacker animstate set to 115</li> <li>Yield for 0.65 seconds</li> <li>attacker's <code>overridefly</code> set to true</li> <li>attacker animstate set to 117</li> <li>The camera moves a bit to the left and back of the stage</li> <li>Over the course of 21.0 frames, the attacker moves to be in front of the player party, but still on the left side of the stage while their <code>height</code> increases towards 2.75</li> <li>All enemy party members whose position isn't <code>Underground</code> or <code>OutOfReach</code> has TempCrosshair called on them and their resulting transforms stored in a local array</li> <li>Loop performed 2 times (3 times if <code>Beemerang2</code> medal is equipped):<ul> <li>attacker animstate set to 118</li> <li>attacker's <code>bobspeed</code> set to 0.1 and <code>bobrange</code> to 3.0</li> <li>A local array of 3 SpriteRenderer is initialised. They form the line leading to the crosshair for the targetting selection (read the section above for more details). All of them are from a new ui object named <code>crosshair</code> on layer 15 (<code>3DUI</code>) rooted:<ul> <li>0: <code>guisprites[41]</code> (crosshair without ring)</li> <li>1: <code>guisprites[41]</code> (white hexagon) with a local scale of 0.1875 uniform</li> <li>2: <code>guisprites[41]</code> (white hexagon) with a local scale of 0.375 uniform</li> </ul> </li> <li><code>Crosshair</code> sound plays on <code>sounds[9]</code> with 0.9 pitch and 0.35 volume on loop</li> <li>The input loop mentioned in the targetting section above occurs and will continue until the Confirm input is pressed in addition that every enemy party members whose <code>hp</code> is 0 or below has their TemporaryCursor disabled if they weren't already. Also, the first 2 SpriteRenderer (the hexagons) all rotates by -6.0 in z every frames</li> <li><code>sounds[9]</code> stops looping</li> <li>The normalised direction from <code>crosshair[0]</code> (y - 0.25 and z at 0.0) to the attacker (x + 1.0, y + 2.5 and z at 0.0) is obtained</li> <li>All the 3 SpriteRenderer created earlier are destroyed</li> <li>attacker's <code>overrideanim</code> is set to true</li> <li>attacker's <code>bobrange</code> and <code>bobspeed</code> are reset to 0.0</li> <li>attacker animstate set to 119</li> <li><code>Toss</code> sound plays</li> <li>Yield for 0.05 seconds</li> <li>A <code>projectilepsrites[2]</code> (needle dart) is created rooted at the attacker position + (1.0, 0.5, -0.1) with a ShadowLite SetUp on it, a scale of 1.15 uniform and z angle determined by the direction of the crosshair (see the targetting selection section for more details)</li> <li>Over a maximum of 41.0 frames, the dart moves towards its target. Every 2 frames (starting from the second one), all enemy party members are checked to see if they will receive damage. See the section above for more details</li> <li>The dart is destroyed</li> <li>Yield for 0.5 seconds if an enemy party member was hit</li> </ul> </li> <li>All TempCrosshair are destroyed</li> <li>Over the course of 16.0 frames, the attacker's <code>height</code> decreases to 0.0 and then set to 0.0 after</li> <li>attacker's <code>overrideanim</code> set to false</li> <li>attacker's <code>overridfly</code> set to false</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/PebbleTossPlus/","title":"<code>PebbleTossPlus</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/PebbleTossPlus/#docommand-calls","title":"DoCommand calls","text":"# Conditions timer commandtype data 1 None 180.0 SequentialKeys {5.0}"},{"location":"Battle%20system/Player%20actions/Skills/PebbleTossPlus/#dodamage-calls","title":"DoDamage calls","text":"# Conditions attacker target damageammount property overrides block 1a DoCommand 1 set <code>combo</code> to 1 or above <code>playerdata[currentturn]</code> The enemy party member <code>playerdata[currentturn].atk</code> + (<code>combo</code> - 2) null Empty array false 1b DoCommand 1 set <code>combo</code> to less than 1 null <code>playerdata[currentturn]</code> 3 (later, the attacker's <code>hp</code> gets clamped from 1 to its <code>maxhp</code> so this cannot be lethal) null null false 2 DoCommand 1 set <code>combo</code> to 3 or above, done up to 2 times for each of the enemy party members directly adjacent to the target of DoDamage 1a whose position isn't <code>Underground</code> or <code>OutOfReach</code> null The enemy party member 2 null null false"},{"location":"Battle%20system/Player%20actions/Skills/PebbleTossPlus/#multi-targets","title":"Multi targets","text":"<p>This action can target the enemy party member directly to the left or right of the original target if they exists and their position isn't <code>Underground</code> or <code>OutOfReach</code>.</p>"},{"location":"Battle%20system/Player%20actions/Skills/PebbleTossPlus/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves slowly to the left of the stage slightly up and back</li> <li>CreateRock is created at half uniform scale offscreen under the map and assigned to a local called boulder</li> <li>attacker MoveTowards the back of the party at 2.0 speed</li> <li>Yield until attacker's <code>forcemove</code> is done</li> <li><code>Dig</code> sound plays</li> <li>KabbuDig coroutine starts and set to <code>checkingdead</code> which animates the attacker's <code>sprite</code> going underground with <code>Prefabs/Particles/DirtFlying</code> particles and its <code>overrideanim</code>, <code>overrideflip</code> and <code>overrideheight</code> going to true</li> <li>Yield until <code>checkingdead</code> is done</li> <li>Yield for 0.5 seconds</li> <li>ShakeScreen for 0.2 ammount for 0.5 time</li> <li>attacker <code>overrideanim</code>, <code>overrideflip</code> and <code>overrideheight</code> set back to false</li> <li>attacker animstate set to 103</li> <li><code>DirtExplode2</code> particles played at the attacker position</li> <li><code>PebbleAtkDigUp</code> sound plays</li> <li>Over the course of 31.0 frames, the boulder moves via SmoothLerp towards (0.0, 12.0, 0.0). The first iteration after 15.5 frames will have the DoCommand 1 call happen (and set to <code>actionroutine</code>)</li> <li>Over the course of 204.0 frames, the boulder moves via Lerp from (0.0, 42.5, 0.0) to the attacker + Vector3.up. However, whenever <code>commandsuccess</code> goes to true or <code>actionroutine</code> is done, each frame may be counted multiple times which accelerates the movements (2x until 50% then 3x until 80% and then back to 1x)</li> <li>FinishAction is called manually which force ends the action (it normally will end before however because the <code>timer</code> is shorter then the full time it takes for the boulder to move)</li> <li>If <code>combo</code> is 0 or below:<ul> <li><code>RockBreak</code> sound plays</li> <li>RockBreak is called which instantiates a <code>Prefabs/Objects/CrackRockBreak</code> childed to the boulder and gets the boulder destroyed</li> <li>ShakeScreen with 0.2 ammount for 0.5 time</li> <li>DoDamage 1b call happens</li> <li>attacker <code>hp</code> set to clamp from 1 to its <code>maxhp</code> (meaning DoDamage 1b cannot be lethal to the attacker)</li> </ul> </li> <li>Otherwise (<code>combo</code> is 1 or higher):<ul> <li>Camera moves 2.0 in x</li> <li>attacker animstate set to 104</li> <li><code>PebbleAtkLaunch</code> sound plays</li> <li>Over the course of 41.0 frames, the boulder moves from (0.0, 2.0, 0.0) towards the target + its <code>height</code> + 1.0 in y using a <code>BeizierCurve3</code> with a ymax of the target's <code>height</code> + 5.0</li> <li><code>PebbleAtkHit1</code> sound plays</li> <li>DoDamage 1a call happens</li> <li>If <code>combo</code> is 3 or above:<ul> <li><code>PebbleAtkHit2</code> sound is set to play in 0.5 seconds</li> <li>2 new boulders are instantiated with a uniform 0.25 scale at the original target + Vector3.up. One will go towards the left enemy party member positon + its <code>height</code> and the other will do the same, but for the right enemy party member. If no enemy party members exists there, it will instead go towards the attacker + 2.5 in x. The movement is done via ArcMovement for 30.0 frames at 4.0 height with no spin and with destroy after. If the enemy party member exists and its position isn't <code>Underground</code> or <code>OutOfReach</code>, DoDamage 2 call is set to happen in 0.5 seconds</li> </ul> </li> <li>RockBreak is called which instantiates a <code>Prefabs/Objects/CrackRockBreak</code> childed to the boulder and gets the boulder destroyed</li> <li>Yield for 0.5 seconds if any directly adjacent enemy party member was hit by DoDamage 2, </li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/","title":"<code>PeebleToss</code>","text":""},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#about-this-actions-usage","title":"About this action's usage","text":"<p>This action is special because it shares a lot of logic with lots of items usage in the game since it doubles as a generic item toss action.</p> <p>This page documents the skills, but for clarity when documenting the items, the sections that are specific to this skills will be pointed out as the rest of the logic is either the same or extremely similar for the items which will be documented separately, but refer to this page for convenience.</p> <p>The one notable change every items usage has is the sprite determination results in the corresponding sprite of the item that was used instead of a rock or Tanjerin/Cerise. The main changes specific items usage has is the object movement section may change in logic and the DoDamage call the skill does is replaced with the item's own logic.</p>"},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#dodamage-calls-skill-specific","title":"DoDamage calls (skill specific)","text":"# Conditions attacker target damageammount property overrides block 1 None null <code>availabletargets[target]</code> 1 NoExceptions null false"},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#no-charges-usage-items-and-skill","title":"No charges usage (items and skill)","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#logic-seqeunce","title":"Logic seqeunce","text":""},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#setup-items-and-skill","title":"Setup (items and skill)","text":"<ul> <li><code>dontusecharge</code> set to true</li> <li>Yield for 0.1 seconds</li> <li>attacker animstate set to 28 (<code>TossItem</code>)</li> <li>Yield for 0.1 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#rock-sprite-determination-skill-specific","title":"Rock Sprite determination (skill specific)","text":"<ul> <li>The sprite of the object thrown is determined and it's <code>itemssprites[1, 13]</code> normally (<code>MightyPeeble</code>'s medal sprite), but if flags 275 is true (completed the Huuuuuuuuuu\u2026!!! quest) and a 1/128 RNG test passes, it's overriden to a <code>Sprites/Entities/moth0</code> sprite with a uniform scale of 0.9x and with flipX. In such case, the index in the sprite array is determined by the following:<ul> <li>If flags 555 is false (not yet reached postgame), it's index 93 (Tanjerin as they lift something with a patched horn)</li> <li>Otherwise (reached the postgame), if flags 682 is false (haven't yet talked to Cerise for the first time at Bandit Hideout), it's index 92 (Tanjerin as they lift something with a normal horn)</li> <li>Otherwise (postgame after talking to Cerise at the Bandit Hideout), the index is randomly chosen between 92 (Tanjerin as they lift something with a normal horn) and 91 (Cerise gasping)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#object-movement-items-and-skill","title":"Object movement (items and skill)","text":"<ul> <li>Over the course of 40.0 frames, the object moves from the attacker + its <code>cursoroffset</code> - 1.0 in y to the <code>target</code> enemy party member + its <code>cursoroffset</code> + its <code>height</code> - 1.0 in y via a BeizierCurve3 with a ymax of 5.0 + the <code>target</code> enemy party member <code>height</code>. During the move, the z angle changes to (0.0 - framestep) * 20.0</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#damage-logic-skill-specific","title":"Damage logic (skill specific)","text":"<ul> <li>DoDamage 1 call happens</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/PeebleToss/#destruction-and-ending-items-and-skill","title":"Destruction and ending (items and skill)","text":"<ul> <li>If the rock sprite wasn't overriden earlier (or this is an item usage), it is destroyed immediately. Otherwise:<ul> <li>The sprite moves via an ArcMovement to (15.0, 0.0, 0.0) with a height of 5.0 over the course of 60.0 frames</li> <li>The sprite gets a SpinAround with an <code>itself</code> of (0.0, 0.0, 20.0)</li> <li>The sprite is destroyed in 2.0 seconds</li> </ul> </li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/PepTalk/","title":"<code>PepTalk</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>If the <code>target</code> player party member's <code>hp</code> is 0 or below, RevivePlayer is called on them leaving them with 4 <code>hp</code> with showcounter</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/PepTalk/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/PepTalk/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> set to true</li> <li>Camera moves slowely to look at the <code>target</code> player party member</li> <li>attacker MoveTowards the <code>target</code> player party member slightly to the right of it and behind with a stopstate of 5 (<code>Angry</code>)</li> <li>Yield until attacker's <code>forcemove</code> is done</li> <li>Yield for a frame</li> <li>attacker FaceTowards the <code>target</code> player party member</li> <li><code>Taunt2</code> sound plays on loop</li> <li>Yield for 0.75 seconds</li> <li><code>Taunt2</code> sound stops playing</li> <li>If <code>target</code> player party member's <code>hp</code> is above 0 (this shouldn't happen under normal gameplay because the skill can normally only be used on dead player party members):<ul> <li><code>target</code> player party member animstate is set to the return of AngryAnim which is a value that depends on the player animid: 10 (<code>Flustered</code>) for <code>Bee</code>, 5 (<code>Angry</code>) for <code>Beetle</code> and 102 for <code>Moth</code> Yield for 0.75 seconds</li> </ul> </li> <li>Otheriwse:<ul> <li>Yield until the <code>target</code> player party member's <code>deathcoroutine</code> is done</li> <li>ShakeSprite called on <code>target</code> player party member with an x intensity of 0.1 for 40.0 of frametimer</li> <li>Yield for 0.66 seconds</li> <li>RevivePlayer is called on <code>target</code> player party member leaving them with 4 <code>hp</code> with showcounter</li> <li><code>target</code> player party member's <code>overridejump</code> set to false</li> <li>Jump called on <code>target</code> player party member</li> <li>Yield for 0.8 seconds</li> </ul> </li> <li>UpdateAnim called</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/RoyalDecree/","title":"<code>RoyalDecree</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>All player party members whose <code>hp</code> is above 0 has StatusEffect called on them to inflict the AttackUp condition for 2 turns with visual effects</li> <li>All player party members whose <code>hp</code> is above 0 has StatusEffect called on them to inflict the DefenseUp condition for 2 turns with visual effects</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/RoyalDecree/#logic-sequence","title":"Logic sequence","text":"<ul> <li>Camera moves slowly to look at the player party</li> <li><code>Prefabs/Objects/ElizantSkill</code> is instantiated rooted at (-15.0, 0.0, 2.0) and its Animator obtained with a scale of <code>AntQueen</code>'s enddata's <code>startscale</code></li> <li>Over the course of 71.0 frames, <code>Prefabs/Objects/ElizantSkill</code> moves towards -8.0 in x</li> <li>The animation clip <code>1</code> plays on <code>Prefabs/Objects/ElizantSkill</code>'s Animator</li> <li>Yield for 0.5 seconds</li> <li>All player party members whose <code>hp</code> is above 0 has StatusEffect called on them to inflict the AttackUp condition for 2 turns with visual effects</li> <li>Yield for 0.5 seconds</li> <li>All player party members whose <code>hp</code> is above 0 has StatusEffect called on them to inflict the DefenseUp condition for 2 turns with visual effects</li> <li>Yield for 0.5 seconds</li> <li><code>Prefabs/Objects/ElizantSkill</code> MoveTowards -15.0 in x over the course of 50.0 frames with smooth without local (MainManager.MoveTowards)</li> <li><code>Prefabs/Objects/ElizantSkill</code> is destroyed in 1.0 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/SecretStash/","title":"<code>SecretStash</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>Heal is called on the <code>target</code> player party member with the ammount being 4 + the amount of <code>HealPlus</code> medals equipped on the <code>target</code> player party member</li> <li>RemoveCondition is called on the <code>target</code> player party member to remove its Poison condition</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/SecretStash/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/SecretStash/#logic-sequence","title":"Logic sequence","text":"<ul> <li><code>dontusecharge</code> is set to true</li> <li>attacker animstate set to 112</li> <li><code>BagRustle</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li>attacker animstate set to 109</li> <li><code>ItemHold</code> sound plays</li> <li>A new sprite object is created childed to the attacker's <code>sprite</code> slightly offset left, up and back without angles. The sprite itself is the <code>itemsprites</code> of a random regular item amongst the following:<ul> <li><code>CrunchyLeaf</code></li> <li><code>Mushroom</code></li> <li><code>AphidEgg</code></li> </ul> </li> <li>Yield for 0.5 seconds</li> <li>attacker y <code>spin</code> set to 15.0</li> <li>Yield for 0.5 seconds</li> <li>attacker <code>spin</code> zeroed out</li> <li>attacker animstate set to 101</li> <li>The item sprite object is rooted to the scene</li> <li><code>Toss</code> sound plays</li> <li>Over the course of 40.0 frames, the item sprite moves the <code>target</code> player party member + 2.0 in y via a BeizierCurve3 with a ymax of 7.25</li> <li>The item sprite object is destroyed</li> <li>The <code>target</code> player party member is healed and has its poison removed like mentioned above</li> <li>Yield for 0.5 seconds</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/SharingStash/","title":"<code>SharingStash</code>","text":"<p>The same as SecretStash, but with the following changes:</p> <ul> <li>The action doesn't just concerns the <code>target</code>, it concerns the whole player party. Every player party members whose <code>hp</code> is above 0 without an eatenby will have the following happen to them:<ul> <li>Heal is called on the player party member with nosound with the ammount being 2 + the amount of <code>HealPlus</code> medals equipped on the <code>target</code> player party member</li> <li>RemoveCondition is called on the player party member to remove its Poison condition</li> <li>SetCondition is called on the player party member to inflict the GradualHP condition for 2 turns</li> </ul> </li> <li>There will be multiple item sprites objects initialsed, one for each applicable player party member that will go towards them from the attacker at the same time</li> <li>After every applicable player party members were healed, the following happens:<ul> <li><code>Heal</code> sound plays</li> <li>Yield for 0.5 seconds</li> <li><code>Heal2</code> sound plays</li> <li><code>MagicUp</code> particles plays on each applicable player party members</li> <li>The final 0.5 seconds yield still happens</li> </ul> </li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/SharingStash/#no-charges-usage","title":"No charges usage","text":"<p>This action sets <code>dontusecharge</code> to true and as such, it will not consume any attacker's <code>charge</code> as it would normally.</p>"},{"location":"Battle%20system/Player%20actions/Skills/Sturdy/","title":"<code>Sturdy</code>","text":"<p>This action features no action commands or damages logic. It only does the following:</p> <ul> <li>The target player party member is selected to be the attacker if it's a skill usage or the <code>target</code> if it's an ItemUsage (see the section below for details). It is possible that the <code>target</code> is the attacker if the item was used on themselves</li> <li>SetCondition is called on the target to inflict the Sturdy conditiion for 1 turn</li> <li>If the absolute value of the attacker's <code>cantmove</code> is above 0, Heal is called on the target to heal it by that amount. NOTE: This is incorrect. The heal was supposed to be for the absolute value of <code>cantmove</code> when it is negative because this would have healed by the amount of extra actor turns, but this logic will incorrectly heal extra inactive actor turns (for example, a <code>cantmove</code> of 1 would heal by 1 despite the target being unable to act already)</li> <li>The target's <code>lockcantmove</code> is set to true</li> <li>The target's <code>cantmove</code> is set to 1. NOTE: This is incorrect if the attacker is the target because the actor turn of the attacker will be consumed in post-action making its <code>cantmove</code> go to 2 while the main turn will advance it to 1 which would have made them unable to act. The task below does workaround this, but in a disruptive and unecessary way</li> <li>If this is a skill usage or it's an ItemUsage where the attakcer is the target, the attacker's <code>moreturnnextturn</code> is incremented. NOTE: This is incorrect, but it workarounds the issue mentioned above with <code>cantmove</code>. The correct logic was to set <code>cantmove</code> to 0 if the attacker is the <code>target</code>, but the game rather set it to 1 and advances the leftover inactive actor turn via <code>moreturnnextturn</code> which allows the actor to act again on the next main turn</li> </ul>"},{"location":"Battle%20system/Player%20actions/Skills/Sturdy/#battle-itemusage","title":"Battle ItemUsage","text":"<p>This action will be processed if a <code>ShellOil</code> item is used with a <code>Battle</code> ItemUsage or any item with a <code>Sturdy</code> ItemUsage (the latter is never used under normal gameplay). This manner of triggering the action is the only one that allows to have a different target than the attacker which has different logic implications as mentioned above. It is assumed for the skill usage that the attacker is the target while the ItemUsage may or may not be.</p>"},{"location":"Battle%20system/Player%20actions/Skills/Sturdy/#issue-with-dontusecharge","title":"Issue with <code>dontusecharge</code>","text":"<p>This action doesn't deal damages to an enemy party member, but it doesn't set <code>dontusecharge</code> to true. This means this action will incorrectly consume the <code>charges</code> accumulated on the attacker. This includes the ItemUsage mentioned above which means that using a <code>SheilOil</code> also incorrectly consume <code>charges</code> on the user.</p>"},{"location":"Battle%20system/Player%20actions/Skills/Sturdy/#startstate-changes","title":"startstate changes","text":"<p>This action changes the startstate to 24 (<code>Block</code>).</p>"},{"location":"Battle%20system/Player%20actions/Skills/Sturdy/#logic-sequence","title":"Logic sequence","text":"<ul> <li>The target player party member is selected to be the attacker if it's a skill usage or the <code>target</code> if it's an ItemUsage (see the section below for details). It is possible that the <code>target</code> is the attacker if the item was used on themselves</li> <li>SetCondition is called on the target to inflict the Sturdy conditiion for 1 turn</li> <li>Target <code>overrideanim</code> set to true</li> <li>Target animstate set to 4 (<code>ItemGet</code>)</li> <li>Target y <code>spin</code> set to 30.0</li> <li>Yield for 0.75 seconds</li> <li>Target <code>spin</code> zeroed out</li> <li><code>StatUp</code> sound plays</li> <li>StatEffect called on target with type 1 (blue up arrow)</li> <li>Target animstate and startstate set to 24 (<code>Block</code>)</li> <li>Yield for 0.5 seconds</li> <li>The target's <code>lockcantmove</code>, <code>cantmove</code> and <code>moreturnnextturn</code> are modified as explained above</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20halfload/","title":"StartBattle - Post <code>halfload</code>","text":"<p>This is the last of 3 phases of StartBattle.</p> <p>This section occurs after <code>halfload</code> is set to true and the coroutine yielded making the new value visible to the rest of the game.</p>"},{"location":"Battle%20system/StartBattle%20phases/Post%20halfload/#last-player-and-enemy-setup","title":"Last player and enemy setup","text":"<p>This part only contains miscellaneous initialisations logic mainly about the <code>playerdata</code> and <code>enemydata</code>: </p> <ul> <li>All <code>enemydata</code> battleentity have their <code>rigid</code> gravity enabled</li> <li>The <code>dimmer</code> gets childed to the <code>battlemap</code> with a clear color and then disabled (this reveals the scene as it was hidden earlier)</li> <li>If instance.<code>firstbattleaction</code> is false (this is the first StartBattle call since the save was loaded)<ul> <li>A DoAction call starts with the first <code>playerdata</code> battleentity with action -555. -555 is a special value that will bypass most meaningful logic of the coroutine. In other words, it can be viewed as doing a blank call: nothing of note will happen and no actual action will be processed. The reason this is done has to do with a performance issue with DoAction where its IL code is large enough to stutter the game when compiling it with the JIT and this provokes this stutters early. Because this is done right before the battle out transition, it's less perceivable than if it was on the first action, hence this odd logic.</li> <li>All frames are yielded while <code>action</code> is true until it goes to false</li> <li>0.5 seconds are yielded</li> <li>instance.<code>firstbattleaction</code> gets set to true</li> </ul> </li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20halfload/#battle-out-transition","title":"Battle out transition","text":"<p>This part only plays the battle out transition by calling PlayTransition with id 3 (the battle out transition), the data being the map.<code>battleleaftype</code> at 0.025 speed and the color being the same one used for the previous transition played earlier.</p> <p>0.2 seconds are yielded after.</p>"},{"location":"Battle%20system/StartBattle%20phases/Post%20halfload/#switchicon-initialisation","title":"<code>switchicon</code> initialisation","text":"<p>This part initialises the <code>switchicon</code> if it didn't exist as a new GameObject with name <code>switchicon</code> childed to the <code>GUICamera</code> with a local position of (0.0, 99.0, 0.0). </p> <p>It also causes 3 children to get added to it:</p> <ul> <li>A new UI object named <code>arrow0</code> with size Vector3.one * 0.4 using the sprite <code>guisprites[92]</code> (right turn black arrow) with a sortingOrder of 3 with angles (0.0, 0.0, 180.0). The local y/z positions is 0 and the x is -1.0 except if <code>longcancel</code> is true where it becomes -1.25</li> <li>Another instance of the above, but the name is <code>arrow1</code>, there is no angles and the x position is the positive version instead of the negative one</li> <li>A new GameObject named <code>button</code> with a ButtonSprite component with SetUp called on it using input 5 (Cancel), -1 as onlytype, no description, local position of Vector3.zero, iconsize of Vector3.on * 0.4, sortingOrder of 0 and the <code>switchicon</code> as the parent making it also the actual parent when its Start occurs</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20halfload/#state-reset","title":"State reset","text":"<p>This resets some important state fields:</p> <ul> <li><code>currentturns</code> is set to -1 (no player selected)</li> <li><code>turns</code> is set to 0</li> <li><code>cancelupdate</code> is set to false</li> <li><code>enemy</code> is set to false</li> <li>instance.<code>inbattle</code> is set to true</li> <li>if <code>sadv</code> is not negative, adv is set to it</li> <li><code>sadv</code> is set to adv (which only does anything if it was 3)</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20halfload/#enemy-first-strike","title":"Enemy first strike","text":"<p>This part only happens if adv is 3:</p> <ul> <li><code>enemy</code> is set to true (we temporarilly go into the enemy phase)</li> <li>firststrike is set to true</li> <li>UpdateAnim is called</li> <li>instance.<code>hudcooldown</code> is set to 10.0 which shows the main HP / TP HUD</li> <li>instance.<code>showmoney</code> is set to -1.0 which hides the berry count HUD</li> <li><code>action</code> is set to true (enter an uncontrolled flow)</li> <li>RefreshEnemyHP is called</li> <li>0.15 seconds are yielded</li> <li>A DoAction call is started on <code>enemydata[0]</code></li> <li>All frames are yielded while <code>action</code> is true until it goes to false. This yield doesn't just yield until DoAction is done because Update has priority over StartBattle as StartBattle is a coroutine. It will yield until </li> <li><code>enemydata[0].tired</code> is set to 0</li> <li><code>enemydata[0].cantmove</code> is set to 0</li> <li><code>action</code> is set to true (goes back into an uncontrolled flow)</li> <li>A CheckDead is started with the coroutine being stored in <code>checkingdead</code></li> <li>All frames are yielded while <code>checkingdead</code> is in progress</li> <li>All <code>enemydata</code> have their <code>tired</code> and <code>cantmove</code> set to 0. NOTE: This is incorrect and it should been set to -moves + 1. The overall effect of this error is enemies with a <code>moves</code> of 2 or above looses all, but one actor turn on the battle's first main turn</li> <li><code>currentturns</code> is set to -1</li> <li><code>action</code> is set to false (resets to a uncontrolled flow)</li> <li>firststrike is set to false</li> <li><code>enemy</code> is set to false (reset to be in the player phase)</li> <li>SetLastTurns is called which resets <code>lastturns</code> to a new array with the length being the amount of free players - 1 and all elements being -1</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20halfload/#conditions-special-logic","title":"Conditions special logic","text":"<p>This part manages the player and enemies conditions as they have special logic to them that must occur at the very end.</p> <p>If <code>saveddata</code> is true (this is a retry), SetStartConditions is called which will do the following:</p> <ul> <li>Add all the corresponding <code>sdata.psc</code> to each <code>playerdata</code>'s condition from the existing ones</li> <li>Add all the corresponding <code>sdata.esc</code> to each <code>enemydata</code>'s condition from the existing ones</li> <li>Add all the corresponding <code>sdata.enemyweakness</code> to each <code>enemydata</code>'s weakness from the existing ones</li> <li>SetLastTurns is called which resets <code>lastturns</code> to a new aray with the length being the amount of free players - 1 and all elements being -1</li> </ul> <p>After, all <code>playerdata</code>'s <code>condition</code>'s element that have a turn count of 0 or below are removed</p> <p>From there, the <code>RandomStart</code> medal takes effect if it's equipped for each <code>playerdata</code> that has it. The effec involves a GetChance test that is performed with 16 weights with outcomes from 0 to 6 and what happens here depends on the result:</p> <ul> <li>0 (3/16): StatusEffect is called on the <code>playerdata</code> with AttackUp for 2 actor turns with effect</li> <li>1 (3/16): StatusEffect is called on the <code>playerdata</code> with DefenseUp for 2 actor turns with effect</li> <li>2 (2/16): <ul> <li>The <code>StatUp</code> sound is played if it wasn't already </li> <li>StatEffect is called with the battleentity using type 4 (green up arrow)</li> <li>The player party member's <code>charge</code> is incremented</li> </ul> </li> <li>3 (2/16): If the <code>playerdata</code>'s <code>poisonres</code> is 100 or above (it's immune to poison), this is treated as an outcome of 2 described above. If it's not:<ul> <li>The <code>Poison</code> sound is played if it wasn't already</li> <li>The <code>PoisonEffect</code> particles are played on the battleentity position</li> <li>SetCondition is called with Poison on the player party member for 2 actor turns unless the <code>Eternal Venom</code> medal is equipped on it where it's 99999 actor turns instead</li> </ul> </li> <li>4 (2/16): The <code>StatUp</code> sound is played if it wasn't already followed by a StatEffect coroutine being started with the battleentity using type 5 (yellow up arrow) followed by the <code>playerdata</code>'s <code>cantmove</code> being decremented (gives an additional actor turn)</li> <li>5 (2/16): <ul> <li>The <code>Heal3</code> sound is played if it wasn't already</li> <li>The <code>MagicUp</code> particles being played on the battleentity position without sound</li> <li>SetCondition is called with GradualHP on the player party member for 2 actor turns</li> </ul> </li> <li>6 (2/16): <ul> <li>The <code>Heal3</code> sound is played if it wasn't already</li> <li>The <code>MagicUp</code> particles are played on the battleentity position without sound</li> <li>SetCondition is called with GradualTP on the player party member for 2 actor turns</li> </ul> </li> </ul> <p>Finally, UpdateConditionIcons is called which calls UpdateConditionBubbles on the battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</p>"},{"location":"Battle%20system/StartBattle%20phases/Post%20halfload/#final-setup","title":"Final setup","text":"<p>These are the final steps of StartBattle:</p> <ul> <li><code>turns</code> is set to 0</li> <li>MainManager.SortLights is called</li> <li>If MainManagr.<code>music[0]</code> is played and its clip exists, <code>sdata.music</code> is set to the clip's name</li> <li><code>saveddata</code> is set to true</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/","title":"StartBattle - Post <code>haltbattleload</code>","text":"<p>This is the second of 3 phases of StartBattle.</p> <p>This phase occurs after the <code>haltbattleload</code> yield, but before battle.<code>halfload</code> is set to true. Since the value is only visible after the first yield, the phase ends after yielding when <code>halfload</code> becomes true.</p>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/#further-initialisations","title":"Further initialisations","text":"<p>This part only contains miscellaneous initialisations logic:</p> <ul> <li>If the stageid is <code>FarGrasslands</code>, the existing RenderSettings.fogEndDistance is saved into <code>fogdist</code> while it gets overriden to 75.0 (this adds a foggy effect more suitable visuablly for this BattleMap)</li> <li>The money HUD is hidden by setting instance.showmoney to -1</li> <li>MainManager.RefreshHUDValues is called which forces the displayed hp, tp and berry count to their real ones</li> <li>If <code>tskybox</code> exists (meaning this is a retry as it was saved before the StartBattle call), RenderSettings.skybox is set to it</li> <li>All NPCControl have StopForceBehavior called on them</li> <li>A frame is yielded</li> <li>The <code>LevelUp</code> music and <code>Gameover</code> sound are loaded, but not stored. This is purely to preload them to not get a stutter when they eventually play</li> <li><code>damcounters</code> is reset to a new list</li> <li><code>charmdance</code> is set to 2 elements being sprite 98 and 99 of <code>Sprites/Entities/moth0</code>. These are the 2 Charmy's sprites used when they performs a charm</li> <li><code>scopeequipped</code> is set to whether or not the <code>HPScope</code> medal is equipped</li> <li><code>dimmer</code> is set to a new Sprite of 1 pure black pixel named <code>MainDimmer</code> scaled to 100.0 on layer 5 (UI) uniformely with position Vector3.zero and with a pivot at (0.5, 0.5, 0.5). This covers the whole screen during the load</li> <li>If this isn't a retry (meaning it wasn't an existing battle):<ul> <li>The camera limits are removed, but saved to their temporary fields before</li> <li><code>oldcamoffset</code> is set to instance.<code>camoffset</code></li> <li><code>oldcamrotation</code> is set to instance.<code>camangleoffset</code></li> <li><code>oldcamtarget</code> is set to instance.<code>camtarget</code></li> <li><code>oldcamspeed</code> is set to instance.<code>camspeed</code></li> </ul> </li> <li>SetDefaultCamera is called</li> <li><code>chompylock</code> is set to false</li> <li><code>lockmmatter</code> is set to false</li> <li><code>gameover</code> is set to null</li> <li><code>attackedally</code> is set to -1</li> <li>instance.<code>camspeed</code> is set to 99.0</li> <li>MainManager.parent (the <code>MainCam</code> object) angles are set to instance. <code>camangleoffset</code></li> <li><code>caller</code> is set to calledfrom</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/#battle-map-creation","title":"Battle map creation","text":"<p>This part disables the overworld map and creates/enables the battle one:</p> <ul> <li>If the map is enabled:<ul> <li>MainManager.RefreshEntities is called</li> <li>A frame is yielded</li> <li>All <code>playerdata</code> entities have the following happen to each of them:<ul> <li><code>flyinganim</code> is set to false</li> <li>SetAnimForce is called</li> <li>A frame is yielded</li> <li>The entity.gameObject is disabled</li> </ul> </li> <li>The map is disabled</li> </ul> </li> <li><code>battlemap</code> is set to a new GameObject named <code>Battle</code></li> <li>The corresponding <code>Prefabs/BattleMaps/X</code> battle map prefab is instantiated where X is the BattleMaps enum name of the stageid and it is childed to <code>battlemap</code></li> <li>All colliders in the battle map are disabled</li> <li>A BoxCollider is added to <code>battlemap</code> with center (0.0, -0.5, 0.0) and size (100.0, 1.0, 50.0). This is essentially the physical ground for both parties</li> <li><code>battlemap</code>.layer is set to 8 (<code>Ground</code>)</li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/#music-setup","title":"Music setup","text":"<p>This part selects the music to play if any and plays it:</p> <ul> <li>MainManager.<code>music[0]</code> pitch is set to normal</li> <li>If MainManager.map.<code>nobattlemusic</code> is false or we are instance.<code>inevent</code>, the music is changed via MainManager.ChangeMusic with a 1.0 fadespeed where the clip varies depending on some conditions:<ul> <li>If the sent music isn't null, that will be the clip used</li> <li>Otherwise, If the current area is <code>UpperSnakemouth</code>, <code>Battle6</code> will be used</li> <li>Otherwise, if flag 348 (Start of chapter 5) is true and the current area is among <code>BarrenLands</code>, <code>FarGrasslands</code>, <code>WildGrasslands</code>, <code>RubberPrison</code>, <code>MetalLake</code> or <code>StreamMountain</code>, <code>Battle6</code> will be used</li> <li>Otherwise, <code>Battle0</code> will be used</li> </ul> </li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/#enemy-party-setup","title":"Enemy party setup","text":"<p>This part goes through all the enemyids and initialises the corresponding <code>enemydata</code> element. The array is initialised to a new one with a length of enemyids.length for this purpose. The main portion of the data comes from GetEnemyData with entity creation.</p> <p>From there, the following happens on each <code>enemydata</code> after setting it to the return of GetEnemyData:</p> <ul> <li>battleentity.<code>battleid</code> is set to the corresponding index of the <code>enemydata</code></li> <li><code>turnsnodamage</code> is set to -1</li> <li>battleentity.<code>alwaysactive</code> is set to true</li> <li>battle.<code>estimatedexp</code> is incremented by the <code>enemydata</code>'s <code>exp</code></li> <li>If the enemy's <code>animid</code> (the enemy id) is less than the amount of instance.<code>enemyencounter</code> elements (which is normally 256) and battleentity.<code>cotunknown</code> is false (it's not a Cave of Trials battle entity), the corresponding <code>enemyencounter</code> element's seen counter is incremented</li> <li>The battleentity position is determined:<ul> <li>x: This depends on the amount of enemy party member and the <code>enemydata</code> index of the element:<ul> <li>2 enemies: 1.5 * <code>enemydata</code>'s index + 3.5</li> <li>3 enemies: 1.5 * <code>enemydata</code>'s index + 2.5</li> <li>4 enemies: 0.75 * <code>enemydata</code>'s index + 2.0</li> </ul> </li> <li>y: always 0.1</li> <li>z: 0.0 for the 1st enemy, 0.15 for the 2nd, 0.30 for the 3rd and 0.45 for the 4th</li> </ul> </li> <li>The battleentity gets childed to the <code>battlemap</code></li> <li>battleentity.<code>hologram</code> gets set to the value of flag 162 (we are in a B.O.S.S or Cave of Trials session)</li> <li><code>battlepos</code> is set to the battleentity's position</li> <li>Some enemies have additional logic here:<ul> <li><code>VenusBoss</code>: <code>extraentities</code> is initialised to a new array with one element being a new entity created via CreateNewEntity with a name of <code>Venus</code>, an animid of 80 (<code>Venus</code>) and a position of (0.0, 0.0, 4.0) childed to the <code>battlemap</code>. This entity gets further adjustements:<ul> <li><code>hologram</code> gets set to the value of flag 162 (we are in a B.O.S.S or Cave of Trials battle)</li> <li><code>alwaysactive</code> gets set to true</li> <li><code>activeonpause</code> gets set to true</li> <li>A VenusBattle component gets added to the gameObject and its SetUp gets called on it with itself as the parent and the battleentity as the target</li> </ul> </li> <li><code>Scarlet</code>: battleentity.<code>basesate</code> is set to 5 (<code>Angry</code>)</li> <li><code>BeeBoss</code>: <code>battlepos</code> and the battleentity position are set to (4.5, 0.0, 0.0)</li> <li><code>SandWyrmTail</code>: entity.<code>height</code> and entity.<code>initialheight</code> are set to 0.0</li> <li><code>Cenn</code> and <code>Pisci</code>: If flags 497 is true (beat them for the first time) , eventondeath is set to -1. If it's false, <code>AlwaysSurvive</code> is added to the weakness. In either cases, <code>battlepos</code> and the battleentity position are set to (1.0, 0.0, 0.0)</li> <li><code>Spuder</code> and <code>SpuderReal</code>: If flags 41 is false (before the end of chapter 1) and either flags 613 (RUIGEE) or 614 (HARDEST) is true, the <code>hp</code> and <code>maxhp</code> are decreased by 15</li> <li><code>Zasp</code> and <code>Mothiva</code>: If flags 606 is true (after the second round of the colosseum in chapter 6), <code>hp</code> / <code>maxhp</code> are increased by 15, <code>hardatk</code> is incremented and <code>lockrelayreceive</code> is set to true</li> <li><code>Pitcher</code>: battleentity position is incremented by Vector3.right</li> <li><code>Maki</code>, <code>Kina</code> and <code>Yin</code>: If flags 614 is true (HARDEST is active), <code>hp</code> / <code>maxhp</code> are increased by 10 and <code>def</code> is incremented</li> </ul> </li> <li>If the calledfrom.entity or the battleentity is <code>inice</code> while it's a <code>Krawler</code> or <code>CursedSkull</code> enemy:<ul> <li><code>freezeres</code> is incremented by 70 (affects freeze inflictions)</li> <li>battleentity.<code>inice</code> is set to true</li> <li>weakness is set to a new list with one element being <code>HornExtraDamage</code></li> </ul> </li> <li>If battleentity.<code>forcefire</code> or we are in the <code>GiantLair</code> area except for the <code>GiantLairFridgeInside</code> map while the enemy is a <code>Krawler</code>, <code>CursedSkull</code> or <code>Cape</code>:<ul> <li>If instance.<code>partylevel</code> is less than 27 (meaning it's not maxed) and flags 613 is false (RUIGEE is inactive), the <code>exp</code> is incremented by the floored result of a lerp from 10.0 to 3.0 with a factor of instance.<code>partylevel</code> / 27.0</li> <li><code>freezeres</code> is set to 110 (immune to freeze inflictions)</li> <li><code>hp</code> and <code>maxhp</code> are increased by 3</li> <li>weakness is set to a new list with one element being <code>Magic</code></li> </ul> </li> <li>A frame is yielded</li> <li>battleentity.animstate is set to its <code>basesate</code></li> </ul> <p>After, there are more setup logic, but this time, it's based on the entire <code>enemydata</code> array instead of each element:</p> <ul> <li>If it contains a <code>MotherChomper</code> enemy with a length of 3, the <code>battlepos</code> are changed as follows depending on their <code>enemydata</code> indexes:<ul> <li>0: (1.2, 0.0, 1.0)</li> <li>1: (2.7, 0.0, -0.5)</li> <li>2: (4.6, 0.0, -0.1)</li> </ul> </li> <li>If it contains a <code>UltimaxTank</code> enemy, the <code>battlepos</code> of the first element is incremented by (0.0, 0.0, 1.0)</li> <li>If it contains a <code>SandWyrm</code> enemy, the first 2 elements gets a VenusBattle component added to their battleentity.gameObject with its SetUp called on them where the target is the battleentity itself and the parent being the other of the 2 battleentity. It also changes their <code>battlepos</code> depending on their <code>enemydata</code> indexes:<ul> <li>0: (3.0, 0.0, 0.0)</li> <li>1: (5.9, 0.0, 0.0)</li> </ul> </li> <li>All battleentity in <code>enemydata</code> gets their position set to their corresponding <code>battlepos</code></li> <li>A frame is yielded</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/#player-party-setup","title":"Player party setup","text":"<p>This part initialises the <code>playerdata</code> elements for the battle. It first involves initialising <code>partyentities</code>, <code>tiredpart</code> and <code>receivedrelay</code> to new arrays with a length of the instance.<code>playerdata</code> length.</p> <p>From there, the following fields gets initialised to each <code>playerdata</code>:</p> Field Initial value battleentity A new entity created via CreateNewEntity with the name <code>PlayerX</code> where X is the index of the element <code>tired</code> 0 <code>cantmove</code> 0 <code>charge</code> 0 <code>atkdownonloseatkup</code> false battleentity's position Depends on the <code>playerdata</code> index:<ul><li>0: (-3.0, 0.1, 0.0)</li><li>1: (-5.0, 0.1, 1.0)</li><li>2: (-6.0, 0.1, 0.0)</li></ul> battleentity's tag <code>Player</code> battleentity.animid The corresponding <code>trueid</code> (see battle party addressing for why this happens) battleentity.<code>flip</code> true battleentity.<code>battle</code> true <code>moreturnnextturn</code> 0 <code>turnssincedeath</code> 0 <code>turnsalive</code> 0 battleentity.<code>overridejump</code> true battleentity.<code>alwaysactive</code> true <code>eatenby</code> null <code>didnothing</code> false battleentity.<code>nocondition</code> false <code>isnumb</code> false <code>pointer</code> The <code>playerdata</code> index <code>plating</code> Whether or not the player party member has the <code>Plating</code> medal equipped <code>isasleep</code> false <code>isdefending</code> false battleentity.<code>battleid</code> The <code>playerdata</code> index battleentity.parent <code>battlemap</code> (gets childed to it) battleentity.gameObject.layer 9 (<code>Follower</code>) battleentity.<code>emoticonoffset</code> (0.0, 1.8 + 0.25 * the <code>playerdata</code> index, 0.0) battleentity.<code>destroytype</code> PlayerDeath battleentity.animstate 13 (<code>BattleIdle</code>) <code>eventondeath</code> -1 <code>cursoroffset</code> (0.0, 2.5, 0.0) <code>haspassed</code> false <code>weakness</code> New empty list condition New empty list battleentity.<code>dead</code> If <code>hp</code> is 0, it's set to true <p>Additionally, the following also happens for each <code>playerdata</code>:</p> <ul> <li>The corresponding <code>partyentities</code> element gets set to the battlentity</li> <li>The corresponding battle.<code>tiredpart</code> gets initialised to the transform of a new <code>Prefabs/Particles/Tired</code> with the following:<ul> <li>Childed to the battleentity</li> <li>Local position being the <code>cursoroffset</code> + (0.0, -5.0, 0.0)</li> <li>Angles of (-45.0, 270.0, 0.0)</li> <li>Disabled for now</li> </ul> </li> </ul> <p>After initialising all player party members, MainManager.ApplyBadges is called.</p>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/#chompy-setup","title":"Chompy setup","text":"<p>This part involves the initialisation of the <code>chompy</code> field. It happens if flags 402 is true (Chompy is with Team Snakemouth).</p> <p><code>chompy</code> is initialised to a new entity created via CreateNewEntity with name <code>chompy</code> with the <code>ChompyChan</code> animid with a position of (-0.5, 0.0, 1) with the following:</p> <ul> <li>Childed to the <code>battlemap</code></li> <li>gameObject.layer set to 9 (<code>Follower</code>)</li> <li><code>flip</code> set to true</li> <li><code>battle</code> set to true</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/#ai-setup","title":"AI setup","text":"<p>This part initialises battle <code>aiparty</code> which is a battle AI. A battle AI is an entity that sits closely to the player party, but has scripted actions after the player party's actions (and <code>chompy</code> if applicable) is over. They are only added under specific conditions, usually involving having a follower. </p> <p>The method used for this is called AddAI and it initalises <code>aiparty</code> to a new entity created via CreateNewEntity with name <code>ai party</code> using the matching animid and am animstate with position (-3.0, 0.0, 2.0) childed to the <code>battlemap</code> and with a <code>flip</code> and <code>battle</code> field set to true. </p> <p>The method takes an animid and am animstate to set to the entity (the animstate parameter is called basestate, but it actually sets the <code>animstate</code> field).</p> <p>While technically, the method can be called multiple time, this isn't supported and will likely result in entities not being tracked by the game should this happen.</p> <p>Here are the different AIs added and their conditions by their animid:</p> <ul> <li><code>Maki</code> is added with animstate 13 (<code>BattleIdle</code>) if any of the following is true:<ul> <li>The MainManager.map.<code>mapid</code> is the <code>FGClearing</code> map</li> <li>flags 594 is true (Chapter 7 when maki should be present in battle) </li> <li><code>Maki</code> is a tempfollower while the current area is <code>FarGrasslands</code> or <code>WildGrasslands</code> or the map is the <code>TestRoom</code></li> </ul> </li> <li><code>KungFuMantis</code> is added with animstate 5 (<code>Angry</code>) if they are a tempfollower</li> <li><code>Madeleine</code> is added with animstate 0 (<code>Idle</code>) if they are a tempfollower</li> <li><code>AntCapitain</code> is added with animstate 13 (<code>BattleIdle</code>) if map.<code>mapid</code> is the <code>AbandonedCity</code> map and flags 400 is true (reserved temporary flag). If they are added, it also causes every element of <code>enemydata</code> to have MainManager.SetCondition called twice on them as the entity with <code>AttackUp</code> and <code>DefenseUp</code> for 999999 actor turns</li> </ul> <p>Finally, a frame is yielded.</p>"},{"location":"Battle%20system/StartBattle%20phases/Post%20haltbattleload/#last-pre-halfload-initialisations","title":"Last pre <code>halfload</code> initialisations","text":"<p>This part only contains miscellaneous initialisations logic before <code>halfload</code> is set to true:</p> <ul> <li>MainManager.RefreshEntities is called</li> <li>instance.<code>camspeed</code> is set to 0.1</li> <li>If <code>actiontext</code> doesn't exist, it is created as a SpriteRenderer component added to a new GameObject named <code>ActionText</code> and the following:<ul> <li>Childed to the <code>GUICamera</code></li> <li>Local position of (-5.0, 4.0, 10.0)</li> <li>Scale of (1.15, 1.75, 1.1)</li> <li>No angles</li> <li>sprite of <code>guisprites[0]</code> (white rectangle)</li> <li>gameObject.layer of 5 (UI)</li> <li>sortingOrder of -1</li> <li>color of pure white with 75% opacity</li> </ul> </li> <li>CreateCursor is called which initialises <code>cursor</code> to a new GameObject named <code>cursor</code> with the following:<ul> <li>A SpriteRenderer with the sprite being <code>cursorsprite[0]</code> (the leaf cursor sprite) with a sortingOrder of -20</li> <li>A SpriteBounce with MessageBounce called on it</li> <li>Childed to the <code>battlemap</code></li> <li>gameObject.layer set to 15 (<code>3DUI</code>)</li> <li>Angles of (0.0, 0.0, 270.0)</li> </ul> </li> <li><code>avaliableplayers</code> is set to the return of MainManager.GetFreePlayerAmmount</li> <li>A frame is yielded</li> <li>The <code>cursor</code> position is set to (0.0, 999.0, 0.0)</li> <li>The SpriteRenderer material of the <code>cursor</code> has its renderQueue set to 10000</li> <li>UpdateText is called</li> <li>MainManager.RefreshSkills is called</li> <li>RefreshAllData is called which sets <code>alldata</code> to a new list which consists of all the <code>playerdata</code> followed by all the <code>enemydata</code> appended together</li> <li>If the <code>fronticon</code> doesn't exist, it is initialised to the SpriteRenderer of a new UI object with the name <code>attackicon</code> childed to the <code>GUICamera</code> with position of Vector.zero, size of Vector3.one / 3.0, sortingOrder of 20 and with a sprite of <code>guisprites[63]</code> (the red arrow of the front icon in battle)</li> <li>A frame is yielded</li> <li>We exit the <code>pause</code> entered earlier</li> <li>If there's more than one <code>playerdata</code> element, then as long as the first <code>partypointer</code> doesn't match the first instance.<code>partyorder</code> (meaning the <code>battle</code> doesn't point to the leading party member), a SwitchParty action coroutine is started with fast (which ends up calling MainManager.SwitchParty immediately) followed by a frame yield until they both match. NOTE: It does mean the coroutine calls can be spammed, but in theory, the while condition gets updated information everytime since the StartCoroutine call immediately causes the party to be updated. For more information on why this is done, check battle party addressing.</li> <li>If calledfrom exists with a <code>dizzytime</code> above 0.0 (the player should get the advantage):<ul> <li>The <code>playerdata</code> with a <code>trueid</code> (which is the animid) that matches the first <code>partypointer</code> is found and its <code>cantmove</code> is set to -1 and <code>receivedrelay</code> of the corresponding <code>playerdata</code> index is set to true. This essentially gives an additional turn to the lead party member and also allows their <code>tiredpart</code> to be enabled by UpdateAnim</li> <li>calledfrom.<code>dizzytime</code> is set to 0.0</li> </ul> </li> <li>If the <code>StrongStart</code> medal is equipped on a party member, the corresponding <code>playerdata</code> gets its <code>cantmove</code> decremented which gives it an additional turn. NOTE: The <code>tiredpart</code> may not render after the first actor turn because the corresponding <code>receviedrelay</code> may not be set to true</li> <li>UpdateConditionIcons is called which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true)</li> <li>All frames are yielded while <code>action</code> is true until it goes to false (this is done to ensure all remainings SwitchParty calls done earlier are fully finished)</li> <li>RefreshEXP is called</li> <li>SetLastTurns is called which resets <code>lastturns</code> to a new aray with the length being the amount of free players - 1 and all elements being -1 (this resets the player selection cycle)</li> <li><code>halfload</code> is set to true</li> <li>All <code>playerdata</code> battleentity have their <code>rigid</code> gravity enabled, <code>onground</code> set to true and animstate set to 13 (<code>BattleIdle</code>)</li> <li>0.1 seconds are yielded</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/","title":"StartBattle - Pre <code>haltbattleload</code>","text":"<p>This is the first of 3 phases of StartBattle.</p> <p>This phase is the first that ever happens. It ends by yielding as long as <code>haltbattleload</code> is true which can be set by the caller.</p>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#instancebattle-init","title":"instance.<code>battle</code> init","text":"<p>This part does basic initialisation and creates the instance.<code>battle</code> if needed:</p> <ul> <li>The current MainManager.<code>screenshake</code> is zeroed out</li> <li>MainManager.<code>battleenemyfled</code> is set to false</li> <li>instance.<code>lastdefeated</code> is reset to a new list</li> <li>All OverWorldProjectile are destroyed</li> <li>ItemList's <code>inlist</code> is set to false</li> <li>The <code>camanglespeed</code> is set to 0.1 and <code>camanglechange</code> to false</li> <li>MainManager.<code>battleresult</code> is set to true</li> <li>MainManager.<code>battlenoexp</code> is reset to false</li> <li>The discovery HUD element is hidden by setting instance.<code>discoveryhud</code> to 0.0</li> <li>CancelAction is called on the player</li> <li>If it's not an existing battle, MainManager.<code>battle</code> is set to a new BattleControl component added to the instance's gameObject. From now on, all BattleControl fields mentioned comes from that instance</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#start-data-init","title":"Start data init","text":"<p>This part only occurs when <code>saveddata</code> is false which can only happen when the battle was started for the first time because this field is only set to true at the very end of StartBattle.</p> <p>This part initialises the <code>sdata</code> which is a StartUpData that persists informations about the battle and restored when it's retried. A retry involves calling StartBattle when the current one still exists which doesn't need this part's logic to occur.</p>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#enemycheck","title":"EnemyCheck","text":"<p>If calledfrom is null or its <code>eventid</code> is 0 or below EnemyCheck is called which can modify the enemyids using 2 special overrides.</p> <p>The first one involves a potential override to <code>GoldenSeedling</code> if instance.<code>inevent</code> is false and flags 41 is true (chapter 1 ended). This is only applicable for the following enemies:</p> <ul> <li><code>Seedling</code></li> <li><code>FlyingSeedling</code></li> <li><code>Acornling</code></li> <li><code>Underling</code></li> <li><code>Plumpling</code></li> <li><code>Flowering</code></li> </ul> <p>Any of these have a 1% chance to changed to a <code>GoldenSeedling</code>. However, there are 2 cases where these odds increases applied in order (Not mutually exclusive):</p> <ul> <li>If the current map is <code>SeedlingHaven</code>, the odds are 7.5%</li> <li>If the <code>Seedling</code> medal is equipped, it multiplies the base odds by 2.5 (meaning 2.5% or 18.75% at <code>SeedlingHaven</code>)</li> </ul> <p>This results in the following odds:</p> map is <code>SeedlingHaven</code>? <code>Seedling</code> medal is equipped Chances of <code>GoldenSeedling</code> (per applicable enemy party member) No No 1% No Yes 2.5% Yes No 7.5% Yes Yes 18.75% <p>The second override applies if any enemy is a <code>SandWyrm</code> or a <code>SandWyrmTail</code>. If this is the case, the entire enemyids array is overriden to be 2 elements with the first being <code>SandWyrm</code> and the second being <code>SandWyrmTail</code></p>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#startdata","title":"StartData","text":"<p>After, StartData is called:</p> <ul> <li>If the player is <code>dashing</code>, StopDash is called without hitting a wall</li> <li><code>sdata</code> is first reset to default values</li> <li>All <code>sdata</code> fields except <code>psc</code>, <code>esc</code> and <code>enemyweakness</code> are initialised to their respective values (see the StartUpDate documentation to learn more)</li> <li>From there, GetStartConditions is invoked in 2.5 seconds which completes this saving process by setting <code>sdata.psc</code>, <code>sdata.esc</code> and <code>sdata.enemyweakness</code> to their respective values (the whole thing is enclosed in a try catch block whose catch will invoke it again in 0.5 seconds).</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#battle-fought-counter-increment","title":"Battle fought counter increment","text":"<p>Finally, flagvar 40 (number of battles fought) is incremented</p>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#essential-setups","title":"Essential setups","text":"<p>This part will do further initialisation:</p> Field Initial value Notes <code>reservedata</code> New empty list <code>hideenemyhp</code> false <code>overworldmusic</code> MainManager.<code>music[0]</code>.clip Only set if MainManager.map.<code>musicid</code> is not negative and MainManager.map.<code>music</code> isn't empty<sup>1</sup> <code>overmusic</code> MainManager.<code>music[0]</code>.time Only set if <code>overworldmusic</code> was and MainManager.<code>keepmusicafterbattle</code> is true <code>canflee</code> canescape Sent as parameter currentaction <code>BaseAction</code> (the main vine action menu) currentchoice <code>Attack</code> <code>option</code> 0 <code>action</code> false <code>alreadyending</code> false <code>expreward</code> 0 <code>moneyreward</code> 0 <code>partypointer</code> New array with {0, 1, 2} See battle party addressing <code>longcancel</code> The return value of InputIO.LongButton with input 5 (Cancel) Determines if the input rendering should be a wide one or not <p>1: Additionally, FadeMusic is called with a speed of 0.025 if all of the following are true:</p> <ul> <li><code>overworldmusic</code> isn't null</li> <li><code>overworldmusic</code>.name doesn't match the sent music </li> <li>MainManager.map.<code>nobattlemusic</code> is false </li> </ul> <p>After, the following procedure is done:</p> <ul> <li>We enter a <code>pause</code></li> <li>MainManager.ApplyBadges is called</li> <li>MainManager.ApplyStatBonus is called</li> <li>StopMovingEntities is called on the map</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#battle-map","title":"Battle map","text":"<p>This section determins the battle map and the <code>extraenemies</code> if needed:</p> <ul> <li>If the sent stage is -1, it is overriden to the instance.<code>battlestage</code> (the value got set on the last MapControl.Start which sets it to the MainManager.map.<code>battlemap</code>)</li> <li>If the stageid is <code>SandCastle</code> or <code>SandCastleDark</code> while calledfrom's entity was <code>inice</code>, the stageid is incremented which sets it to <code>SandCastleIce</code> or <code>SandCastleDarkIce</code> respectively</li> </ul>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#extraenemies-setup","title":"<code>extraenemies</code> setup","text":"<p>If the sent enemyids has more than 4 elements, all the elements after the 4th one are placed in order in <code>extraenemies</code> (after clearing it) and enemyids is overriden to only have the first 4 elements</p>"},{"location":"Battle%20system/StartBattle%20phases/Pre%20haltbattleload/#battle-in-transition","title":"Battle in transition","text":"<p>This section setup the battle in transition:</p> <ul> <li>A <code>BattleStart0</code> sound is played (<code>BattleStart3</code> if the MainManager.map.<code>battleleaftype</code> is <code>Bee</code>) at 0.65 volume</li> <li>If the sent adv is 3 (enemy advantage) while we aren't <code>inevent</code>:<ul> <li>A <code>Hurt</code> sound is played followed by a <code>AtkFail</code> one</li> <li>HurtParticle is called on the player position + Vector3.up with the <code>Hurt</code> sound (meaning the same sound will play twice on that frame)</li> <li>All player party members's battleentity have their animstate set to 11 (<code>Hurt</code>) with a SetAnimForce call which will force a SetAnim call with force which renders the animation immediately</li> </ul> </li> <li>If the player.entity.<code>sound</code> exists, it is stopped</li> <li>PlayTransition is called with id 2 (the battle in transition), the data being the map.<code>battleleaftype</code> at 0.075 speed and the color being the map.<code>battleleafcolor</code> unless adv was 3 (enemy advantage) when we aren't <code>inevent</code> where the color is overriden to pure red</li> <li>1.5 seconds are yieled which lets the transition renders</li> <li>If MainManager.<code>haltbattleload</code> is true, all frames are yielded until it goes to false</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/CameraFocusTarget/","title":"CameraFocusTarget","text":"<p>A parameterless method that moves the camera to look at <code>playerdata[playertargetID]</code> with some offset to have a zoomed in view of the current player party member being targetted by an enemy action</p> <pre><code>private void CameraFocusTarget()\n</code></pre>"},{"location":"Battle%20system/Visual%20rendering/CameraFocusTarget/#procedure","title":"Procedure","text":"<ul> <li>instance.<code>camoffset</code> set to (1.0, 2.3, -6.0)</li> <li>instance.<code>camtarget</code> set to null</li> <li>instance.<code>camtargetpos</code> set to <code>playerdata[playertargetID]</code> position</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/CreateHelpBox/","title":"CreateHelpBox","text":"<p>This method creates the <code>helpbox</code> which presents the action command help text with id <code>helpboxid</code> by using SetText in non dialogue mode.</p> <pre><code>private void CreateHelpBox(int id)\n</code></pre>"},{"location":"Battle%20system/Visual%20rendering/CreateHelpBox/#parameters","title":"Parameters","text":"<ul> <li><code>id</code>: The <code>helpboxid</code> to use. There is an overload without this parameter that will use the existing value. NOTE: if this is sent and MainManager.<code>mashcommandalt</code> is true (sequential keys is set in the settings):<ul> <li>4 (<code>TappingKey</code>) is overriden to 8 (<code>RandomTappingKeysTimer</code>)</li> <li>10 (<code>RandomTappingBar</code>) is overriden to 8 (<code>RandomTappingKeysTimer</code>)</li> <li>11 (<code>RandomPressKeyTimer</code>) is overriden to 8 (<code>RandomTappingKeysTimer</code>)</li> <li>9 (<code>RandomPressBar</code>) is overriden to 12 (<code>MultiPressBar</code>)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Visual%20rendering/CreateHelpBox/#procedure","title":"Procedure","text":"<p>The method does nothing if <code>helpboxid</code> is negative or <code>helpbox</code> exists already.</p> <ul> <li><code>helpbox</code> is created as the DialogueAnim of a new 9box with position (-3.0, -4.25, 10.0), size of (12.0, 1.75) with type 0, a sortingOrder of -5 with grow and a color of pure white</li> <li>SetText is called in non dialogue mode using MainManager.<code>commandhelptext[helpboxid]</code> as the text with the following properties:<ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>linebreak of 9.0</li> <li>No tridimensional</li> <li>position of (-5.5, 0.1, 0.0)</li> <li>No cameraoffset</li> <li>size of (0.75, 0.75)</li> <li>parent of <code>helpbox</code></li> <li>No caller</li> </ul> </li> </ul>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/","title":"DoDamageAnim","text":"<p>This coroutine is only called as part of DoDamage when applicable and as part of UseItem when processing a <code>HPto1</code> item use.</p> <p>It only performs animstate and other visual update on an actor to indicate that they have sustained damage.</p> <pre><code>private IEnumerator DoDamageAnim(MainManager.BattleData entity, int damage, bool block, bool nosound, bool fail, bool noanim, bool fakeanim)\n</code></pre> <p>There is a coroutine overload available that starts this one where <code>nosound</code>, <code>fail</code>, <code>noanim</code> and <code>fakeanim</code> are all false with the only logic difference being there's a frame yield after the coroutine started.</p>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#parameters","title":"Parameters","text":"<ul> <li><code>entity</code>: The actor sustaining the damage</li> <li><code>damage</code>: The amount of damage the actor is sustaining</li> <li><code>block</code>: If the actor is a player party member, whether the player sucessfully blocked the damage it is sustaining</li> <li><code>nosound</code>: If true, no sound will be played</li> <li><code>fail</code>: If <code>nosound</code> is false, this tells if the player failed the attack's action command which changes some logic regarding sounds being played. This is ignored if <code>nosound</code> is true</li> <li><code>noanim</code>: If true, there won't be any animstate updates on the actor even if entity.battleentity.<code>overridenanim</code> is false</li> <li><code>fakeanim</code>: If <code>noanim</code> is false, this changes the animstate value to set the actor's battleentity to 30 (<code>FakeHurt</code>) instead of 11 (<code>Hurt</code>) when damage is above 0 and block is false. This is ignored if <code>noanim</code> is true, <code>damage</code> isn't above 0 or <code>block</code> is true.</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#procedure","title":"Procedure","text":"<p>The following describes the logic divided by sections as it contains a lot of conditional logic.</p>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#overrideanim","title":"<code>overrideanim</code>","text":"<p>If noanim and entity.battleentity.<code>overrideanim</code> are false, entity.battleentity.<code>overrideanim</code> is set to true</p>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#nosound-is-false","title":"nosound is false","text":"<p>This part is skipped if nosound is true:</p> <ul> <li>If fail is true, the <code>AtkFail</code> sound is played</li> <li>If block is true, the <code>Block</code> sound is played if it wasn't playing already with a time of 0.1 seconds or below</li> <li>If damage is above 0 while block is false, the <code>Damage0</code> sound is played if it wasn't already with a time of 0.1 seconds or below. As for the pitch and volume:<ul> <li>If fail is true, the pitch is 0.7 and volume is 0.6</li> <li>If fail is false, the pitch is 1.0 + combo * 0.125 and the volume is 1.0</li> </ul> </li> <li>If damage is above 0 while block is false, the <code>WoodHit</code> sound is played  with a volume of 0.8 if it wasn't playing already with a time of 0.1 seconds or below</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#damage-is-above-0","title":"damage is above 0","text":"<p>This part is skipped if no damage was sustained</p> <ul> <li>The <code>hitpart</code> is played at entity.battleentity's position + (0.0, entity.<code>cursoroffset</code>.y / 2.0 + entity.battleentity.<code>height</code>, 0.0)</li> <li>If MainManager.<code>screenshake</code>'s magnitude is below 0.05, ShakeScreen is called with an ammount of (0.1, 0.1, 0.1) for 0.15 seconds with dontreset to true</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#noanim-yield-break","title":"noanim yield break","text":"<p>If entity.battleentity.<code>overrideanim</code> or noanim is true, the coroutine ends here with a yield break</p>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#animation-updates","title":"Animation updates","text":"<p>The rest of the logic deals with visual animations.</p>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#first-animstate-logic","title":"First animstate logic","text":"<p>entity.battleentity.animstate may be set depending on conditions (mutually exclusive, only the first one applies in order):</p> <ul> <li>21 (<code>Woobly</code>) if entity has the Topple animation</li> <li>16 (<code>HurtFallen</code>), if entity has the Flipped animation</li> <li>If damage is above 0:<ul> <li>24 (<code>Block</code>) if block is true</li> <li>11 (<code>Hurt</code>) if block is false. This is 30 (<code>FakeHurt</code>) instead if fakeanim is true</li> </ul> </li> <li>If none of the above happened:<ul> <li>It's set to 24 (<code>Block</code>) if block is true</li> <li>A ShakeSprite coroutine starts on the entity.battleentity with an intensity of (0.1, 0.0, 0.0) and a frametimer of 20.0</li> </ul> </li> <li>0.35 seconds are yielded</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#topple-animation","title":"Topple animation","text":"<p>There are some special handling on top of the above if entity has the Topple animation:</p> <ul> <li>entity.battleentity.<code>basestate</code> is set to 21 (<code>Woobly</code>)</li> <li>entity.battleentity.<code>overrideanim</code> is set to false</li> <li>entity.battleentity.animstate is set to its <code>basestate</code></li> </ul>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#flipped-animation","title":"Flipped animation","text":"<p>If the Topple logic above didn't apply, but entity has the Flipped animation:</p> <ul> <li>entity.battleentity.<code>basestate</code> is set to 15 (<code>Fallen</code>)</li> <li>entity.battleentity.<code>overrideanim</code> is set to false</li> <li>entity.battleentity.animstate is set to its <code>basestate</code></li> </ul>"},{"location":"Battle%20system/Visual%20rendering/DoDamageAnim/#alive-animation-entityhp-is-above-0","title":"Alive animation (entity.<code>hp</code> is above 0)","text":"<p>The following applies on top of all the animations logic above if entity.<code>hp</code> is above 0:</p> <ul> <li>entity.battleentity.<code>overrideanim</code> is set to false</li> <li>if entity has the Sleep condition, entity.battleentity.animstate is set to 14 (<code>Sleep</code>)</li> <li>Otherwise, if the entity is a player party member with an <code>hp</code> of 4 or below, its animstate is set to 17 (<code>WeakBattleIdle</code>)</li> <li>Otherwise, entity.battleentity.animstate is set to its value before this coroutine started unless it was 31 (<code>Dig</code>) or 32 (<code>DigMove</code>) where it's the <code>basestate</code> it had at the start instead</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/FixedUpdate/","title":"FixedUpdate","text":"<p>The FixedUpdate of BattleControl contains logic relating to updating the <code>choicevine</code>, <code>cursor</code> and the color of the actor's sprites visually. It also updates <code>turncooldown</code>'s decreases. It does nothing however in a terminal flow.</p>"},{"location":"Battle%20system/Visual%20rendering/FixedUpdate/#choicevine-updates","title":"<code>choicevine</code> updates","text":"<p>This section only applies if <code>choicevine</code> exists which is after StartBattle called CreateVine.</p> <ul> <li>If currentaction is <code>BaseAction</code> (the main vine action menu):<ul> <li>All children of <code>basevine</code> (which are all the actual vines object) has their scale set to a lerp from the existing one to (2.5, 2.5, 2.5) with a factor of 0.15</li> <li>UpdateRotation is called which updates the y angle of the <code>choicevine</code> given the current <code>option</code>. The new y angle is a LerpAngle from the existing one to -(360 / <code>vineoption</code> * <code>option</code>) - 24.0 * (1.0 - the horizontal viewport position of the <code>choicevine</code>)</li> </ul> </li> <li>Otherwise:<ul> <li>UpdateRotation is called which updates the y angle of the <code>choicevine</code> given the current <code>lastoption</code>. The new y angle is a LerpAngle from the existing one to -(360 / <code>vineoption</code> * <code>lastoption</code>) - 24.0 * (1.0 - the horizontal viewport position of the <code>choicevine</code>)</li> <li>All children of <code>basevine</code> (which are all the actual vines object) has their scale set to a lerp from the existing one to (2.5, 1.5, 2.5) with a factor of 0.15 unless the vine index matches <code>lastoption</code> in which case, it's the same, but the y scale is 2.5 (2.0 if currentaction is <code>SelectPlayer</code>)</li> </ul> </li> <li>If we are in an uncontrolled flow, the <code>choicevine</code> position is set to offscreen at (0.0, 999.0, 0.0)</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/FixedUpdate/#cursor-updates","title":"<code>cursor</code> updates","text":"<p>This section only applies if <code>cursor</code> exists which is after StartBattle called CreateCursor.</p> <p>The <code>cursor</code> is only rendered on screen if we are in a controlled flow while currentaction isn't <code>BaseAction</code> (the main vine action menu) and itemarea is <code>SingleAlly</code> or <code>SingleEnemy</code>. Otherwise, its position is set to offscreen at (0.0, 100.0, 0.0) When it needs to be rendered, the <code>cursor</code> position setting logic depends on currentaction.</p>"},{"location":"Battle%20system/Visual%20rendering/FixedUpdate/#selectenemy","title":"<code>SelectEnemy</code>","text":"<p>The position is set to a lerp from the existing one to the actor's battleentity position + an offset vector with a factor of 0.2 unless the <code>cursor</code> y position is above 20.0 where the factor is 1.0 (instant) instead. The actor is <code>avaliabletargets[option]</code> if currentchoice is among the following (it's <code>enemydata[option]</code> otherwise):</p> <ul> <li><code>Attack</code></li> <li><code>Skill</code></li> <li><code>Strategy</code></li> <li><code>Item</code></li> </ul> <p>As for the offset vector, it's Vector3.up if the actor's position is <code>Underground</code>. If it's not, it's the actor's <code>cursoroffset</code> + Vector3.up * the actor's battleentity.<code>height</code>.</p>"},{"location":"Battle%20system/Visual%20rendering/FixedUpdate/#selectplayer","title":"<code>SelectPlayer</code>","text":"<p>The position is set to a lerp from the existing one to <code>playerdata[option].battleentity</code> position + <code>playerdata[option].cursoroffset</code> with a factor of 0.2 unless the <code>cursor</code> y position is above 20.0 where the factor is 1.0 (instant) instead</p>"},{"location":"Battle%20system/Visual%20rendering/FixedUpdate/#turncooldown","title":"<code>turncooldown</code>","text":"<p>If the field is above 0.0, it is decremented by 1.0.</p>"},{"location":"Battle%20system/Visual%20rendering/FixedUpdate/#actors-visual-updates","title":"Actor's visual updates","text":"<p>UpdateEntities is called only if <code>halfload</code> is true which means most of StartBattle is done as it guarantees all actors are fully loaded.</p>"},{"location":"Battle%20system/Visual%20rendering/LateUpdate/","title":"LateUpdate","text":"<p>The LateUpdate of BattleControl is very minor. Most of it involves updating some HUD visibility.</p> <p>The following HUD are updated if we aren't in a terminal flow:</p> <ul> <li>instance.<code>showmoney</code> (the berry counter HUD) is set to -1.0 (hidden) if <code>action</code> is false (meaning we are in a controlled flow, but this doesn't cover EventDialogue)</li> <li>instance.<code>hudcooldown</code> is set to 10.0 if the message lock is released</li> </ul> <p>Finally, if <code>superblockedthisframe</code> is above 0.0, it is decreased by framestep. This update the amount of frames a super block counts as it was originally determined by GetBlock and first processed by CalculateBaseDamage.</p>"},{"location":"Battle%20system/Visual%20rendering/RefreshEXP/","title":"RefreshEXP","text":"<p>This method refreshes the rendered EXP orbs visually involving the <code>expholder</code>. It is mostly called by Update.</p> <ul> <li>If the <code>expholder</code> doesn't exist, it is created as a new GameObject named <code>expholder</code> childed to the <code>GUICamera</code> with a tag of <code>DelAftBtl</code> (meaning it will get destroyed on ReturnToOverworld)</li> <li>All existing <code>bigexporbs</code> and <code>smallexporbs</code> are destroyed</li> <li><code>bigexporbs</code> is recreated with length <code>expreward</code> / 10 floored and each element is created as a <code>Prefabs/Objects/ExpOrbGUI</code> instance childed to the <code>expholder</code> with a scale of (0.35, 0.35, 0.35) and a local position of (8.5 - index * 0.65, -4.26, 10.0)</li> <li><code>smallexporbs</code> is recreated with length <code>expreward</code> - (<code>expreward</code> / 10 floored) * 10 and each element is created as a <code>Prefabs/Objects/ExpOrbGUI</code> instance childed to the <code>expholder</code> with a scale of (0.25, 0.25, 0.25) and a local position of (8.5 - index * 0.5, -4.9, 10.0)</li> <li><code>oldexp</code> is set to <code>expreward</code> which prevents the calling of this method by Update until <code>expreward</code> changes</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/RefreshEnemyHP/","title":"RefreshEnemyHP","text":"<p>This method goes over all the enemy party members and updates the eneablement / displayed text of their battleentity.<code>hpbar</code> and <code>defstat</code>. This document describes what happens for each <code>enemydata</code>.</p> <p>Nothing happens if the <code>hpbar</code> doesn't exist (meaning CreateHPBar had to be called on the battleentity beforehand).</p> <p>The <code>hpbar</code> is always hidden if the enemy has <code>hidehp</code> to true while the bar was enabled or if the message lock is grabbed while <code>chompyaction</code> is true.</p> <p>If it wasn't hidden from the above, the enablement will be updated by testing a series of conditions and it will only actually update if the conditions results in a different enablement than the existing one. Here are all the conditions that must be true for the <code>hpbar</code> to remain enabled (it is disabled otherwise):</p> <ul> <li><code>hideenemyhp</code> is false</li> <li><code>helpbox</code> doesn't exist (no description or help text is presented in the bottom left corner)</li> <li>Either the enemy was spied according to <code>librarystuff</code> or <code>scopeequipped</code> is true (The <code>HPScope</code> medal is equipped) or HPBarOnOther returns true (only applicable for a <code>PitcherFlytrap</code> enemy where it returns whether <code>Pitcher</code> was spied or not and for a <code>KeyR</code> / <code>KeyL</code> enemy where it returns whether <code>EverlastingKing</code> was spied or not)</li> <li>Either <code>chompyattack</code> is in progress or all of the following are true:<ul> <li>The message lock is released</li> <li><code>action</code> is false</li> <li><code>itemlist</code> is null (no Itemlist is rendered)</li> <li>The current battle's <code>inevent</code> is false</li> <li><code>enemy</code> is false</li> </ul> </li> </ul> <p>After updating the enablement, if it's still active, battleentity.<code>hpbarfont</code>.<code>text</code> is updated to the actualy enemy's <code>hp</code>. To update the red bar, the <code>hpbar</code>'s first child's first child gets its x scale update to be the enemy's <code>hp</code> / <code>maxhp</code> (the y/z scale are set to 1.0). To update the yellow bar, the <code>hpbar</code>'s first child's second child gets its x scale update to <code>hpoffset[X]</code> where X is the length of the <code>hpbarfont</code>.<code>text</code> - 1 which essentially means if it's one digit, it's 1.1, 1.275 for 2 digits and 1.45 for 3 digits (the y/z scale are set to 1.0).</p>"},{"location":"Battle%20system/Visual%20rendering/RefreshEnemyHP/#truedef","title":"TrueDef","text":"<p>The <code>defstat</code>'s displayed value is also updated based on the <code>def</code>. If the <code>def</code> is -1, the displayed value is <code>?</code>. NOTE: having the <code>def</code> be -1 only visually shows <code>?</code>, but it doesn't actually implies the feature of ? defense because this is handled separately by hacing <code>LimitX10</code> in the enemy party member's weakness.</p> <p>If it's not -1, it will be the return value of TrueDef which is a method that returns the total defense of the enemy party member. It is is calculated by doing the following:</p> <ol> <li>The base defense is determined. It is 0 if the enemy has the Flipped condition and if it doesn't have it, it is the <code>def</code> value</li> <li>1 is added if the enemy has the DefenseUp condition</li> <li>1 is subtracted if the enemy has the DefenseDown condition</li> <li>defenseonhit's value is added if the enemy <code>isdefending</code> is true</li> <li>1 is added if the enemy has the Numb condition</li> <li>The result is clamped from 0 to 9 and then returned</li> </ol> <p>What's important to note about TrueDef is it is ALWAYS accurate no matter the circumstances because it exhaustively covers all points of defense that can apply to any enemy party member. This is important because CalculateBaseDamage may incorrectly ignore some defense sources in various situations.</p>"},{"location":"Battle%20system/Visual%20rendering/SetDefaultCamera/","title":"SetDefaultCamera","text":"<p>This method resets the default camera's properties and loads the offset / position from the battle fields:</p> <pre><code>public static void SetDefaultCamera(bool reset)\n</code></pre>"},{"location":"Battle%20system/Visual%20rendering/SetDefaultCamera/#parameters","title":"Parameters","text":"<ul> <li><code>reset</code>: Tells if the battle fields should be reset to their default value too</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/SetDefaultCamera/#procedure","title":"Procedure","text":"<p>The method does the following assignement to the camera fields:</p> Name Value <code>camspeed</code> 0.1 <code>camoffset</code> battle.<code>camoffset</code> <code>camangleoffset</code> <code>battlecamangle</code> <code>camtarget</code> null <code>camtargetpos</code> battle.<code>campos</code> <p>It is also possible to send true as a parameter to do a more aggressive version which also resets the battle fields:</p> Name Value <code>camspeed</code> 0.1 <code>camoffset</code> <code>battlecampos</code> <code>camangleoffset</code> <code>battlecamangle</code> <code>camtarget</code> null <code>camtargetpos</code> Vector3.zero battle.<code>camoffset</code> <code>battlecampos</code> battle.<code>campos</code> Vector3.zero"},{"location":"Battle%20system/Visual%20rendering/ShowDamageCounter/","title":"ShowDamageCounter","text":"<p>This is a method that renders a visual counter of HP, TP or damage. This is only rendering the visual counter, it isn't mechanically involved in the damage pipeline, but it may be called as part of it.</p> <pre><code>private void ShowDamageCounter(int type, int ammount, Vector3 start, Vector3 end)\n</code></pre>"},{"location":"Battle%20system/Visual%20rendering/ShowDamageCounter/#parameters","title":"Parameters","text":"<ul> <li><code>type</code>: The type of counter to show. Here are all the valid values:<ul> <li>0: A damage counter</li> <li>1: An HP counter</li> <li>2: A TP counter</li> </ul> </li> <li><code>ammount</code>: The number to show inside the counter</li> <li><code>start</code>: The starting position of the counter's lerp</li> <li><code>end</code>: The end position of the counter's lerp</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/ShowDamageCounter/#procedure","title":"Procedure","text":"<ul> <li>A new GameObject is created named <code>X counter</code> where <code>X</code> is the ammount with a tag of <code>DelAftBtl</code> (meaning it will get destroyed on ReturnToOverworld) and a local scale of Vector3.zero</li> <li>Another GameObject is created named <code>sprite</code> childed to the counter just created with a SpriteRenderer on layer 15 (<code>3DUI</code>). The sprite is the <code>guisprites[counterspriteindex[X]]</code> where <code>X</code> is the type (4 for type 0, 40 for type 1 and 101 for type 2)</li> <li>For each <code>damcounters</code> whose position to the start is less than 1.5 away, start is increased by (1.25, 1.25, 1.25)</li> <li>The counter's position is set to start</li> <li>The sprite's local scale is set to Vector3.one / 1.5</li> </ul> <p>From there, 2 SetText calls occurs in non dialogue mode. The only distinguishing factors of the 2 calls is the input string and the position:</p> <ul> <li>The first has the input string be <code>|</code>triui<code>||</code>halfline<code>||</code>center<code>||</code>sort<code>,2||</code>color<code>,4|</code> followed by the ammount and it has a position of (0.0, 0.2, 0.0)</li> <li>The second has the input string be <code>|</code>triui<code>||</code>halfline<code>||</code>center<code>||</code>sort<code>,1|</code> followed by the ammount and it has a position of (0.08, 0.08, 0.08)</li> </ul> <p>Both calls shares these properties:</p> <ul> <li>fonttype of 1 (<code>D3Streetism</code>)</li> <li>linebreak of 9999.0</li> <li>No tridimensional</li> <li>No cameraoffset</li> <li>size of Vector3.one * 1.75</li> <li>parent of the counter object</li> <li>No caller</li> </ul> <p>These 2 calls gives a white on black effect to the text.</p> <p>The last step involves a CounterAnimation coroutine starting, but this coroutine now ends with this.</p>"},{"location":"Battle%20system/Visual%20rendering/ShowDamageCounter/#counteranimation","title":"CounterAnimation","text":"<p>This is a sub coroutine invoked as part of ShowDamageCounter. Here is its procedure (paraphrased a lot due to the presence of verbose rendering logic):</p> <ul> <li>The counter is added to <code>damcounters</code></li> <li>The counter and the SpriteRenderer in its child have their layers set to 15 (<code>3DUI</code>)</li> <li>end is decreased by Vector3.back * (the amount of <code>damcounters</code> - 1) * 0.025 (this is done to avoid Z fighting between the <code>damcounters</code>)</li> <li>start is set to a new Vector3 with the following components:<ul> <li>X: The counter's x position</li> <li>Y: The counter's y position clamped from -50.0 to 4.5</li> <li>Z: The counter's z position - (the amount of <code>damcounters</code> - 1) * 0.025 (this is to avoid Z fighting between the <code>damcounters</code>)</li> </ul> </li> </ul> <p>The animation here depends on the type (for any type, the coroutine ends after by yielding a frame followed by the counter's destruction).</p>"},{"location":"Battle%20system/Visual%20rendering/ShowDamageCounter/#0-damage-counter","title":"0 (Damage counter)","text":"<ul> <li>The SpriteRenderer Z angle is set to be a random angle between 0 and 360 exclusive (the X and Y angles are set to 0.0)</li> <li>Over the course of 10.0 frames:<ul> <li>The counter local scale is lerped from the existing one to (0.85, 1.15, 1.0) with a factor of 1/5 of the game's frametime</li> <li>The counter position is lerped from the existing one to start + end with a factor of 3/10 of the game's frametime</li> <li>The SpriteRenderer is rotated with  (0.0, 0.0, -0.7)</li> </ul> </li> <li>Over the course of 10.0 frames:<ul> <li>The counter local scale is lerped from the existing one to Vector3.one with a factor of 1/5 of the game's frametime</li> <li>The counter position is lerped from the existing one to start + end with a factor of 3/10 of the game's frametime</li> <li>The SpriteRenderer is rotated with  (0.0, 0.0, -0.5)</li> </ul> </li> <li>0.3 seconds are yielded</li> <li>The counter is removed from <code>damcounters</code></li> <li>Over the course of 20.0 frames:<ul> <li>The counter local scale is lerped from the existing one to Vector3.zero with a factor of 1/5 of the game's frametime</li> <li>The counter position is lerped from the existing one to start + end + Vector3.up with a factor of 3/10 of the game's frametime</li> <li>The SpriteRenderer is rotated with  (0.0, 0.0, -0.5)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Visual%20rendering/ShowDamageCounter/#1-hp-counter","title":"1 (HP counter)","text":"<ul> <li>end is overriden to Vector3.up</li> <li>Over the course of 10.0 frames:<ul> <li>The counter local scale is lerped from the existing one to (0.65, 1.5, 1.0) with a factor of 1/5 of the game's frametime</li> <li>The counter position is lerped from the existing one to start + end with a factor of 0.3</li> </ul> </li> <li>Over the course of 10.0 frames:<ul> <li>The counter local scale is lerped from the existing one to (1.2, 0.9, 1.0) with a factor of 1/5 of the game's frametime</li> <li>The counter position is lerped from the existing one to start + end with a factor of 0.3</li> </ul> </li> <li>Over the course of 10.0 frames:<ul> <li>The counter local scale is lerped from the existing one to (1.0, 1.0, 1.0) with a factor of 1/5 of the game's frametime</li> <li>The counter position is lerped from the existing one to start + end with a factor of 0.3</li> </ul> </li> <li>0.12 seconds are yielded</li> <li>The counter is removed from <code>damcounters</code></li> <li>Over the course of 20.0 frames:<ul> <li>The counter local scale is lerped from the existing one to Vector3.zero with a factor of 1/10 of the game's frametime</li> <li>The counter position is lerped from the existing one to start + end + Vector3.up * 2.0 with a factor of 1/5 of the game's frametime</li> <li>The SpriteRenderer is rotated with  (0.0, 10.0, 0.0)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Visual%20rendering/ShowDamageCounter/#2-tp-counter","title":"2 (TP counter)","text":"<p>The same than the HP counter, but with the following changes:</p> <ul> <li>Before the first 10.0 frames lerp, a new UI object is created called <code>insidewheel</code> on layer 15 (<code>3DUI</code>) with the SpriteRenderer as the parent, local position of (0.0, 0.0, 0.01), size of Vector3.one, sortingOrder of the SpriteRenderer's - 1 using the sprite <code>guisprites[102]</code> (the rainbow wheel part of the TP counter)</li> <li>On each of the 10.0 frames lerp, the <code>insidewheel</code>'s Z angle is increased by 15x the game's frametime (the X and Y angles are always set to 0.0)</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/ShowSuccessWord/","title":"ShowSuccessWord","text":"<p>This coroutine allows to visually display a battle message which are words informing the success of a block or action command. The progression of the coroutine is meant to be tracked by <code>wordroutine</code> as it is set to null after this coroutine is over.</p> <pre><code>private IEnumerator ShowSuccessWord(EntityControl t, bool block, bool super)\n</code></pre>"},{"location":"Battle%20system/Visual%20rendering/ShowSuccessWord/#parameters","title":"Parameters","text":"<ul> <li><code>t</code>: The entity the word should be rendered close to</li> <li><code>block</code>: Whether or not this word relates to blocking (takes priority over everything else)</li> <li><code>super</code>: Whether or not this word relates to using an attack targetting a weakness (ignored if <code>block</code> is true or the <code>LuckierDay</code> medal is equipped)</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/ShowSuccessWord/#procedure","title":"Procedure","text":"<ul> <li><code>commandword</code> is set to a new UI object named <code>word</code> childed to the <code>battlemap</code> with a local position of t's position + (1.0, 3.5, 0.0) + Vector3.up + (0.0, 0.0, 10.0) with a scale of Vector3.zero, a material renderQueue of 50000, a SpriteRenderer and a DialogueAnim</li> <li>The sprite of the <code>word</code> is set depending on different conditions (only the first one that applies in order is used):<ul> <li>block is true: MainManager.<code>battlemessage[4]</code> (BLOCK) (overriden to MainManager.<code>battlemessage[3]</code> (UNBEELIEVABLE) if the <code>LuckierDay</code> medal is equipped). This also sets <code>commandword</code>'s local position to t's position + (2.0, 2.0, 0.0) + (0.0, 0.0, 10.0)</li> <li>The <code>LuckierDay</code> medal is equipped: MainManager.<code>battlemessage[3]</code> (UNBEELIEVABLE)</li> <li>super is true: MainManager.<code>battlemessage[5]</code> (SUPER)</li> <li>None of the above applied: MainManager.<code>battlemessage</code> whose index is <code>combo</code> (clamped from 0 to 3). 0 is OKAY, 1 is GREAT, 2 is AWESOME and 3 is UNBEELIEVABLE</li> </ul> </li> <li>A second is yielded</li> <li>The targetscale of the <code>word</code>'s DialogueAnim is set to (1.0, 0.0, 1.0)</li> <li>The shrink of the <code>word</code>'s DialogueAnim is set to true (this means the word will collapse to nothing vertically)</li> <li><code>commandword</code> is destroyed in 1 second</li> <li><code>wordroutine</code> is set to null signaling it is no longer in progress</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/ShowSuccessWord/#showcombomessage","title":"ShowComboMessage","text":"<p>This is a wrapper around ShowSuccessWord (without super) where <code>wordroutine</code> is stopped if it was in progress (followed by the destruction of <code>commandword</code>) and then set to the new coroutine call:</p> <pre><code>private void ShowComboMessage(EntityControl entity, bool block)\n</code></pre> <p>The parameters are relayed as they are to ShowSuccessWord with false as super.</p> <p>NOTE: Since this destroys the <code>commandword</code>, it can lead to a situation where this can be missleading during DoDamage's block processing. Check the documentation to learn more.</p>"},{"location":"Battle%20system/Visual%20rendering/StatEffect/","title":"StatEffect","text":"<p>This coroutine will render a visual colored arrow to show some kind of effect done to the stats. This is purely for visual purposes and ephemeral: the arrow is destroyed shortly after.</p> <pre><code>private IEnumerator StatEffect(EntityControl target, int type)\n</code></pre>"},{"location":"Battle%20system/Visual%20rendering/StatEffect/#parameters","title":"Parameters","text":"<ul> <li><code>target</code>: The entity to render the arrow on</li> <li><code>type</code>: The type of effect to render which dictates the color, angles and local position to render the arrow</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/StatEffect/#procedure","title":"Procedure","text":"<p>For the sake of brevety, the procedure won't be documented as it involves very verbose rendering logic. It mostly involves a SpriteBounce with some scaling lerps to make the arrow move on its own using non uniform scaling.</p> <p>However, the type parameter is worth to document as it dictates how the arrow will be rendered:</p> <ul> <li>0: CC00007F (80% red, half transparent) rendered vertically at the entity's <code>height</code> (the arrow points up)</li> <li>1: 0000CC7F (80% blue, half transparent) rendered vertically at the entity's <code>height</code> (the arrow points up)</li> <li>2: CC00007F (80% red, half transparent) rendered vertically at the entity's <code>height</code> + 2.0 with a 180.0 degrees rotation in z (the arrow points down)</li> <li>3: 0000CC7F (80% blue, half transparent) rendered vertically at the entity's <code>height</code> + 2.0 with a 180.0 degrees rotation in z (the arrow points down)</li> <li>4: 00CC007F (80% green, half transparent) rendered vertically at the entity's <code>height</code> (the arrow points up)</li> <li>5: FFCC007F (mostly orange, half transparent) rendered vertically at the entity's <code>height</code> (the arrow points up)</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/TempCrosshair/","title":"TempCrossfair","text":"<p>A method that renders a crosshair's ring that periodically spins over an enemy party member's physical position + (0.0, 1.0, 0.0) or its world CenterPos and returns its transform.</p> <pre><code>private Transform TempCrosshair(MainManager.BattleData target, bool groundpos)\n</code></pre>"},{"location":"Battle%20system/Visual%20rendering/TempCrosshair/#parameters","title":"Parameters","text":"<ul> <li><code>target</code>: The enemy party member to render the crosshair on</li> <li><code>groundpos</code>: If it's false, it will use the world CenterPos to determine where to render the crosshair and if it's true, it will use its physical position + (0.0, 1.0, 0.0) instead</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/TempCrosshair/#procedure","title":"Procedure","text":"<ul> <li>A new sprite object is created with name <code>tempsprite</code> chiled to the <code>battlemap</code> at the position determined by <code>groundpos</code> using the sprite <code>guisprites[93]</code> (a crosshair's ring) on layer 15 (<code>3DUI</code>) with the <code>spritedefaultunity</code> material</li> <li>A SpinAround is added to the sprite object with an <code>itself</code> of (0.0, 0.0, 7.5)</li> <li>The transform of the sprite object is returned</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateAnim/","title":"UpdateAnim","text":"<p>This method updates the battle entities's animstate considering various conditions.</p> <pre><code>private void UpdateAnim(bool onlyplayer)\n</code></pre>"},{"location":"Battle%20system/Visual%20rendering/UpdateAnim/#parameters","title":"Parameters","text":"<ul> <li><code>onlyplayer</code>: Tells if only the player party members should be updated. There is an overload without this parameter that sends false</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateAnim/#procedure","title":"Procedure","text":"<p>There are 2 parts to this: the player party members one and the enemy party members one. The latter is only done if onlyplayer is false.</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateAnim/#players","title":"Players","text":"<p>This applies to each element of <code>playerdata</code>.</p> <p>The enablement of the corresponding <code>tiredpart</code> has its enablement changed to be enabled only when the corresponding <code>receivedrelay</code> is true, the player <code>hp</code> is above 0 and its <code>tired</code> is above 0. It is disabled otherwise. </p> <p>NOTE: This logic is incorrect because <code>receivedrelay</code> is only set to true when the player party member received a Relay or when the player party member was in front and StartBattle was called from an encounter with an Enemy NPCControl while it had a <code>dizzytime</code> (meaning the player had the advantage). This doesn't cover the cases involving the <code>StrongStart</code> medal and consuming multiple actor turns granted via <code>moreturnnextturn</code> meaning in those cases, <code>tiredpart</code> will not be rendered when it should have been.</p> <p>The rest of the logic isn't done if the player's battleentity.<code>overrideanim</code> is true.</p> <ul> <li>If the <code>hp</code> is 0 or below, battleentity.<code>animstate</code> is set to 18 (<code>KO</code>)</li> <li>Otherwise, if the player has the EventStop, Freeze or Numb condition, battleentity.<code>animstate</code> is set to 11 (<code>Hurt</code>)</li> <li>Otherwise, if the <code>currentturn</code> is the player index (it's the one being selected for taking action) and currentaction is <code>BaseAction</code> (the main vine action menu):<ul> <li>If the <code>hp</code> is above 4 and the player doesn't have the Poison or Fire condition, battleentity.<code>animstate</code> is set to 19 (<code>PickAction</code>)</li> <li>Otherwise, battleentity.<code>animstate</code> is set to 20 (<code>WeakPickAction</code>)</li> </ul> </li> <li>Otherwise, battleentity.<code>animstate</code> is only changed if <code>blockcooldown</code> expired:<ul> <li>If the player has the Sturdy condition, battleentity.<code>animstate</code> is set to 24 (<code>Block</code>)</li> <li>If the player has the Sleep condition, battleentity.<code>animstate</code> is set to 14 (<code>Sleep</code>)</li> <li>If the <code>hp</code> is above 4 and the player doesn't have the Poison or Fire condition (it also implies it's not the currently selected player as it was ruled out above):<ul> <li>If the player has the Taunted condition or it has the <code>Berserker</code> medal equipped, battleentity.<code>animstate</code> is set to the return of AngryAnim which is a value that depends on the player animid: 10 (<code>Flustered</code>) for <code>Bee</code>, 5 (<code>Angry</code>) for <code>Beetle</code> and 102 for <code>Moth</code></li> <li>Otherwise, battleentity.<code>animstate</code> is set to 13 (<code>BattleIdle</code>)</li> </ul> </li> <li>Otherwise, battleentity.<code>animstate</code> is set to 17 (<code>WeakBattleIdle</code>)</li> </ul> </li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateAnim/#enemies","title":"Enemies","text":"<p>This applies to each element of <code>enemydata</code> if onlyplayer is false.</p> <p>battleentity.<code>animstate</code> is only set if the <code>hp</code> is above 0 and the entity.<code>droproutine</code> is not in progress.</p> <ul> <li>If the enemy has the Flipped condition:<ul> <li>If the enemy also has the Sleep condition, battleentity.<code>animstate</code> is set to 25 (<code>SleepFallen</code>)</li> <li>If it doesn't have it, battleentity.<code>animstate</code> is set to 15 (<code>Fallen</code>)</li> </ul> </li> <li>Otherwise, if the enemy has the Freeze or Numb condition, battleentity.<code>animstate</code> is set to 11 (<code>Hurt</code>)</li> <li>Otherwise, if the enemy has the Sleep condition, battleentity.<code>animstate</code> is set to 14 (<code>Sleep</code>)</li> <li>Otherwise, if the enemy holditem isn't -1 (the enemy is holding an item), battleentity.<code>animstate</code> is set to 4 (<code>ItemGet</code>)</li> <li>Otherwise, if the enemy isdefending, battleentity.<code>animstate</code> is set to 24 (<code>Block</code>)</li> <li>Otherwise, battleentity.<code>animstate</code> is set to battleentity.<code>basestate</code></li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/","title":"UpdateEntities","text":"<p>This method goes through all actors in <code>alldata</code> and does the following on each in order:</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/#sprite-color-update","title":"Sprite color update","text":"<p>If battleentity.<code>cotunknown</code> is true, battleentity.<code>sprite</code> color is set to pure black if the <code>sprite</code> exists and if battleentity.<code>refreshedcotu</code> is false (RefreshCOT wasn't called yet), RefreshCOT is called on the battleentity</p> <p>Otherwise, an opacity number for the color is determined. It's 1.0 (fully opaque) unless battleentity.<code>hologram</code> is true or all of the following are true where the factor will be 0.55 instead (55% opaque):</p> <ul> <li>The actor is a player party member</li> <li><code>playertargetID</code> is above -1 and it isn't the actor (meaning this actor is not targetted by the current enemy party's action)</li> <li>We aren't in a terminal flow or EventDialogue</li> <li>The message lock is released</li> </ul> <p>From there, a bunch of mutually exclusive checks are performed in order and the first one that gets fufilled will have the battleentity.<code>sprite</code> color changed to a lerp from the existing one to some other colors with the opactity being the one determined above. The factor of the lerp varies depending on the check applied.</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/#player-party-member-not-being-targetted-by-the-enemy","title":"Player party member not being targetted by the enemy","text":"<p>This case will lerp to 0x595959 (35% of every color which is light grey) with a factor of 0.07 of the frametime. The conditions for that to happen is all of the following being true:</p> <ul> <li>The actor's <code>cantmove</code> is above 0 (it does not have any actions available)</li> <li>We are in the enemy phase</li> <li>The actor is a player party member</li> <li>We aren't in a terminal flow or EventDialogue</li> <li>The message lock is released</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/#charged-actor","title":"Charged actor","text":"<p>This case will set the color to RainbowColor using variant 0, colorspeed of 5.9 * (actor's <code>charge</code> / 3.0), min of 0.5, limit of 1.0 and alpha being the opacity factor determined earlier. </p> <p>This is only done if the actor's <code>charge</code> is above 0.</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/#poison-condition","title":"Poison Condition","text":"<p>This case will lerp to 0xD800D8 (bright magenta) with a factor of 1/5 of the frametime. The conditions for that to happen is the actor having the <code>Poison</code> condition.</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/#fire-condition","title":"Fire Condition","text":"<p>This case will lerp to 0xBF5919 (bright orange) with a factor of 1/5 of the frametime. The conditions for that to happen is the actor having the <code>Fire</code> condition.</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/#inked-condition","title":"Inked Condition","text":"<p>This case will lerp to 0x7200D8 (bright purple) with a factor of 1/5 of the frametime. The conditions for that to happen is the actor having the <code>Inked</code> condition.</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/#default-case","title":"Default case","text":"<p>This one happens if none of the above applied.</p> <p>The lerp is done to <code>spritebasecolor</code> with a factor of framestep * 0.2.</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateEntities/#battleentityfirepart-update","title":"battleentity.<code>firepart</code> update","text":"<p>This section updates the state of the <code>firepart</code> object which is some particles that plays as part of a condition.</p> <p>There are only 3 conditions where the <code>firepart</code> is involved alongside their corresponding particles prefab:</p> <ul> <li>Fire: <code>Prefabs/Particles/Flame</code></li> <li>Inked: <code>Prefabs/Particles/InkDrip</code></li> <li>Sticky: <code>Prefabs/Particles/StickyDrip</code></li> </ul> <p>If the actor doesn't have any of these conditions, <code>firepart</code> is destroyed here if it still exists.</p> <p>If it does, the corresponding prefab is instantiated and set to <code>firepart</code>. It also gets some initialisation:</p> <ul> <li>Childed to the <code>sprite</code></li> <li>The gameObject tag is set to <code>DelAftBtl</code> (detroyed on ReturnToOverworld)</li> <li>Local position set to Vector3.up</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/","title":"UpdateText","text":"<p>This methods updates various textual information via SetText in non dialogue mode.</p> <p>All SetText calls in this method have the following parameters on top of being in non dialogue mode:</p> <ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>linebreak of 9999.0</li> <li>No tridimensional</li> <li>position of (0.0, -0.1, 0.0)</li> <li>No cameraoffset</li> <li>size of (0.85, 0.7)</li> <li>parent of <code>actiontext</code></li> <li>No caller</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#chompy","title":"Chompy","text":"<p>This section applies only if the currentaction is <code>Chompy</code>:</p> <ul> <li><code>actiontext</code> local position is set to (-5.0, 4.0, 10.0)</li> <li>All SetText objects under <code>actiontext</code> are destroyed via MainManager.DestroyText</li> <li>A <code>menutext</code> id is determined depending on <code>coption[option]</code> (the selected chompy menu option):<ul> <li>0: 60 (<code>Attack</code>)</li> <li>1: 65 (<code>Do Nothing</code>)</li> <li>2: This depends on flagvar 56 (the item id if the item chompy has):<ul> <li><code>PoisonRibbon</code>: 234</li> <li><code>NumbRibbon</code>: 235</li> <li><code>SleepRibbon</code>: 236</li> </ul> </li> <li>3: 273 (<code>Change Ribbons</code>)</li> </ul> </li> <li>SetText is called in non dialogue mode using the <code>menutext</code> line selected earlier prepanded with <code>|</code>center<code>|</code></li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#during-the-player-phase-of-a-controlled-flow","title":"During the player phase of a controlled flow","text":"<p>This section applies if the chompy one didn't and <code>enemy</code>, <code>action</code> and <code>inevent</code> are false while the message lock is released:</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#cancelb","title":"<code>cancelb</code>","text":"<p>If <code>cancelb</code> doesn't exist, it is created as a new GameObject named <code>cancelhelp</code> with a ButtonSprite component added to it and its SetUp called on it. That SetUp call receives:</p> <ul> <li>buttonid 5 (cancel)</li> <li>description of <code>menutext[43]</code> (<code>Cancel</code>) (prepanded with <code>|</code>size<code>,1,1.5|</code> if the languageid is <code>Japanese</code>)</li> <li>position of Vector3.zero</li> <li>iconsize of (0.5, 0.5, 0.5)</li> <li>sortingOrder of 1 </li> <li>parentobj <code>GUICamera</code></li> </ul> <p>After the creation, a DelayCancelBox coroutine is started which yields a frame followed by creating a new UI object named <code>back</code> childed to <code>cancelb</code> with a position of (2.25, 0. 0, 0.0), a size of (1.1, 2.75, 1.0) using <code>guisprites[0]</code> (a rectangle) and with a sortingOrder of -10. The SpriteRenderer color of this object is set to pure white with half opacity.</p> <p>If the currentaction is <code>BaseAction</code> (the vine main action menu), <code>cancelb</code> position is set offscreen to (0.0, 999.0, 0.0). Otherwise, the local position is set to (2.1 or 2.5 if <code>longcancel</code> is true, 4.2, 10.0).</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#currentaction-logic","title":"currentaction logic","text":"<p>This section depends on the <code>currentaction</code></p>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#baseaction","title":"<code>BaseAction</code>","text":"<ul> <li><code>actiontext</code> local position is set to (-5.0, -4.0, 10.0)</li> <li>All SetText objects under <code>actiontext</code> are destroyed via MainManager.DestroyText</li> <li>A string is built staring with <code>|</code>center<code>|</code> followed by a <code>menutext</code> line that depends on <code>option</code>:<ul> <li>0: 60 (<code>Attack</code>)</li> <li>1: 61 (<code>Skills</code>)</li> <li>2: 62 (<code>Items</code>)</li> <li>3: 63 (<code>Strategies</code>)</li> <li>4: 64 (<code>Turn Relay</code>)</li> </ul> </li> <li>Further parts can be appended to the string if <code>currentturn</code> isn't negative (there is a player selected for an action):<ul> <li><code>option</code> is 0 and the <code>AntlionJaws</code> medal on the <code>playerdata[currentturn].trueid</code>: <code>|</code>size<code>,1,0.6||</code>icon<code>,183|</code> is appended</li> <li><code>option</code> is 1 and the <code>StatusBoost</code> medal on the <code>playerdata[currentturn].trueid</code>: <code>|</code>size<code>,1,0.6||</code>icon<code>,220|</code> is appended</li> <li><code>option</code> is 2 and the <code>HealPlus</code> medal on the <code>playerdata[currentturn].trueid</code>: <code>|</code>size<code>,1,0.6||</code>icon<code>,218|</code> is appended</li> <li><code>option</code> is 4 and the <code>RelayTransfer</code> medal on the <code>playerdata[currentturn].trueid</code>: <code>|</code>size<code>,1,0.6||</code>icon<code>,216|</code> is appended</li> </ul> </li> <li>A SetText call is done in non dialogue mode using the text obtained</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#selectenemy","title":"<code>SelectEnemy</code>","text":"<ul> <li><code>actiontext</code> local position is set to (-5.0, -2.5, 10.0)</li> <li>All SetText objects under <code>actiontext</code> are destroyed via MainManager.DestroyText</li> <li>A string is built depending on the itemarea, but it always starts with <code>|</code>center<code>|</code>:<ul> <li><code>SingleEnemy</code>:<ul> <li>If the languageid is <code>Japanese</code> or the <code>availabletargets[option].entityname</code> (the selected enemy's name) has a length of 5 or above, <code>|</code>size<code>,X,0.7|</code> is appended where <code>X</code> is 1.0 - 0.05 * <code>availabletargets[option].entityname.length</code> - 5 clamped from 0.5 to 0.8</li> <li><code>avaliabletargets[option].entityname</code> is appended</li> <li>If currentchoice is <code>Strategy</code> while the bestiary entry of the <code>avaliabletargets[option].animid</code> enemy id exists (the selected enemy id), <code>|</code>stars<code>,1|</code> is appended</li> </ul> </li> <li><code>All</code>: <code>menutext[77]</code> is appended</li> <li><code>AllEnemies</code>: <code>menutext[75]</code> is appended</li> <li><code>AllParty</code>: <code>menutext[76]</code> is appended</li> </ul> </li> <li>A SetText call is done in non dialogue mode using the text obtained</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#selectplayer","title":"<code>SelectPlayer</code>","text":"<ul> <li><code>actiontext</code> local position is set to (-5.0, -2.5, 10.0)</li> <li>All SetText objects under <code>actiontext</code> are destroyed via MainManager.DestroyText</li> <li>A string is built depending on the itemarea, but it always starts with <code>|</code>center<code>|</code>:<ul> <li><code>SingleAlly</code>:<ul> <li><code>playerdata[option].entityname</code> is appended</li> <li>If currentchoice is <code>Item</code> while the <code>WeakStomach</code> medal is equipped on <code>playerdata[option].trueid</code>, <code>|</code>size<code>,1,0.6||</code>icon<code>,184|</code> is appended</li> </ul> </li> <li><code>All</code>: <code>menutext[77]</code> is appended</li> <li><code>AllEnemies</code>: <code>menutext[75]</code> is appended</li> <li><code>AllParty</code>: <code>menutext[76]</code> is appended</li> </ul> </li> <li>A SetText call is done in non dialogue mode using the text obtained</li> </ul>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#skilllist-itemlist-strategylist","title":"<code>SkillList</code> / <code>ItemList</code> / <code>StrategyList</code>","text":"<p><code>actiontext</code> local position is set to offscreen at (0.0, 999.0. 0.0)</p>"},{"location":"Battle%20system/Visual%20rendering/UpdateText/#any-other-times","title":"Any other times","text":"<p>This section happens when neither of the other 2 did.</p> <p>The only things that happens is the <code>actiontext</code> and <code>cancelb</code> local position are moved offscreen at (0.0, 999.0, 0.0).</p>"},{"location":"Entities/Entity/","title":"Entity","text":"<p>An entity in Bug Fables is an object that could be seen as the building blocks of the game. It features common logic used throughout the game and allows to have complex runtime behaviors. In other words, it's what allows the game to have any kind of interactions whether it's movement, enemy encounters or loading zones to name a few. It is made of 2 components, one of them being optional:</p> <ul> <li>EntityControl: This defines what an entity can do and defines the most common aspects of all entities. It can be viewed as a component that gives utilities and modifiers for an object to have. </li> <li>NPCControl: This leverages the utilities and modifiers defined in EntityControl to implement more complex behaviors and logic for map entities specifically. Any other entities created manually outside of exceptional cases (such as a shop system) do not use an NPCControl. The component is stored in the <code>npcdata</code> field of EntityControl.</li> </ul>"},{"location":"Entities/Entity/#differences-between-an-entity-and-a-map-entity","title":"Differences between an entity and a map entity","text":"<p>Due to these components having a clear delimitation, it gives a new definition to a map entity for this game. A map entity is an entity that was predefined in a map and therefore, it will be created with an NPCControl. In other words, map entities are entities, but not all entities are map entities. It also means NPCControl is a missnomer: it doesn't just handles NPC, it handles all the logic of all map entities which may or may not be NPCs.</p> <p>A map entity has to be created using CreateEntities of MapControl through using the data provided by the map entity data while an entity can be created manually through the standard entity creation process. Additionally, an Item map entity can be created using CreatItem. While it is possible to make any entities an NPC by assigning the <code>npcdata</code> field to a new NPCControl, this isn't supported outside of very exceptional cases (such as a shop system) and isn't encouraged in practice.</p>"},{"location":"Entities/EntityControl/CreateEntities/","title":"MapControl's CreateEntities","text":"<p>MapControl's Start contains a call to a method called CreateEntities which will initialise many Entity defined in preset data that are defined in map entity data. This directory contains entity data that applies to each specific Maps hence why this creation process happens on MapControl. The EntityControl Creation process is exactly the same, but the different fields from map data augments this process right before the entity is fully created and Start occurs later on the start of the next frame. Exclusive to this scheme of creating entities is making them map entities with NPCControl as the fields loaded includes both EntityControl and NPCControl fields. All the data ends up in the <code>entities</code> array of the MapControl which can be used for tracking and the index of each is also assigned to the <code>mapid</code> field of the NPCControl. They are loaded in the order they are defined in TextAsset data which means the 0 indexed position can be used as an id. This is frequently done as part of many SetText commands or NPCControl operations that affects other NPCControl.</p> <p>This page only describe the behaviors outside of loading the data as there are some notes worth to talk about.</p>"},{"location":"Entities/EntityControl/CreateEntities/#debug-feature","title":"Debug feature","text":"<p>If the name of an entity contains the string <code>debug</code>, the entire creation process is skipped for this entity unless MainManager's <code>debugenalbed</code> is true. This particular field is never set explicitly: it must be set externally and outside of the game's control because it is not possible to enable it through normal means. It should be noted that no entities defined in the game uses this feature, but it still remains functional.</p>"},{"location":"Entities/EntityControl/CreateEntities/#position-start","title":"Position start","text":"<p>If the player is loaded by the time the entities are created, their default position is 2.0 above the player.</p>"},{"location":"Entities/EntityControl/CreateEntities/#the-rot-modifier","title":"The <code>ROT</code> modifier","text":"<p>This modifier also changes the way angles are loaded on the entity. Normally, this comes from the entity data, but if this modifier is present, it will instead start a LateAngle on the entity with the entity data's angles in 0.25 seconds of yield time.</p>"},{"location":"Entities/EntityControl/CreateEntities/#doorsamemap-logic","title":"DoorSameMap logic","text":"<p>There is some DoorSameMap specific logic here. More information can be found at the DoorSameMap documentation.</p>"},{"location":"Entities/EntityControl/CreateEntities/#shop-logic","title":"Shop logic","text":"<p>This is where the shop system structure is built. More information can be found at the shop system documentation.</p>"},{"location":"Entities/EntityControl/EntityControl%20Creation/","title":"EntityControl Creation","text":"<p>EntityControl is a components in the game that defines what an Entity is and what it can do. It can be considered the building blocks of the game as it represents anything that is created and behaves at runtime.</p>"},{"location":"Entities/EntityControl/EntityControl%20Creation/#createnewentity","title":"CreateNewEntity","text":"<p>While there are multiple ways to create an entity, all of them ends up at the same method:</p> <pre><code>public static EntityControl CreateNewEntity(string name)\n</code></pre> <p>The <code>name</code> here has 2 purposes:</p> <ul> <li>It will be the name of the root GameObject of the entity which can be useful for debugging purposes</li> <li>It can contain some special strings called modifiers that changes how the entity behaves.</li> </ul> <p>This method will create an object structure that is shared across every entities. While an entity can modify this structure later on, all of them starts the same way by default:</p> <ul> <li>The root GameObject is created with its name being the <code>name</code> parameter and an EntityControl component is added to it</li> <li>The transform of the root object is cached into the <code>transform</code> field</li> <li>Another GameObject is created and childed to the root one called <code>Rotater</code>. This won't be assigned to anything until the entity's Start runs on the next frame where it is assigned to the <code>rotater</code> field.</li> <li>Another GameObject is created and childed to the Rotater one called <code>Sprite</code> with a SpriteRender component. It is assigned to the <code>sprite</code> field and its transform into the <code>spritetransform</code> field.</li> <li>Another GameObject is created and childed to the root one called \"MoveRotater\". It is assigned to the <code>moverotater</code> field.</li> <li>A CapsuleCollider is added to the root object with radius 0.5, height of 2.0, center at (0.0. 1.0, 0.0) and assigned to the <code>ccol</code> field.</li> <li>The layer of the entity is set to 10 which is the Entity layer.</li> </ul> <p>This essentially gives us the following structure:</p> <pre><code>-&gt; root (named after the name parameter, on the Entity layer)\n    -&gt; Rotater\n        -&gt; Sprite (has a SpriteRender)\n    -&gt; MoveRotater  \n</code></pre> <p>And the following fields:</p> <ul> <li><code>transform</code>: the root's transform</li> <li><code>rotater</code> (on Start): the Rotater</li> <li><code>sprite</code>: the Sprite</li> <li><code>spritetransform</code>: the Sprite's transform</li> <li><code>moverotater</code>: the MoveRotater</li> <li><code>ccol</code>: the CapsuleCollider of the root</li> </ul> <p>However, this is only the most primitive way to create an entity. There are 2 overloads of this method that accepts different parameters, but one is a helper to the other whose signature is the following:</p> <pre><code>public static EntityControl CreateNewEntity(string name, int anim_id, Vector3 position, EntityControl follow)\n</code></pre> <p>The <code>name</code> ends up doing the exact same thing than the primitive version as this method is a wrapper around it. What changes is the ability to specify an AnimID, a position and a follower:</p> <ul> <li><code>anim_id</code>: This is the AnimID of the entity and it is set to the <code>animid</code> field.</li> <li><code>position</code>: This sets the starting position of the entity's root transform.</li> <li><code>follow</code>: This parameter is optional because there is an overload that doesn't have it and it sends null to this method. If it is present, a follower is setup on the entity.</li> </ul> <p>The follower is initialized like this when applicable:</p> <ul> <li>The game tries to find the last entity of the follow chain. This is done by checking the entity's <code>following</code> field to go up the chain until it is null.</li> <li>The entity found is set to the <code>following</code> field of the entity being created which puts it at the end of the chain.</li> <li>The <code>followeroffset</code> field is set to the position (starting at 1) of the entity in the follow chain multiplied by 0.1.</li> <li>The layer of the entity is overridden to 9 which the Follower layer</li> <li>The tag of the entity is set to <code>PFollower</code></li> </ul>"},{"location":"Entities/EntityControl/EntityControl%20Creation/#onenable","title":"OnEnable","text":"<p>The creation process doesn't stop there because EntityControl defines an OnEnable which is run immediately on creation OR whenever it gets enabled. This will do 2 things:</p> <ul> <li>Do a SetAnim call with empty <code>args</code> and <code>force</code> to true which will force the animation to start on \"Idle\" as it's the default value of animstate.</li> <li>If the emoticon object exists, it will be set to -1 (<code>None</code>) and its cooldown to 0 frames. Since an entity cannot have one on creation, this only applies when it gets enabled with one present later.</li> </ul>"},{"location":"Entities/EntityControl/EntityControl%20Creation/#map-entities-preset","title":"Map entities preset","text":"<p>On top of this, there is a system the game has that allows to define each entities's starting parameters for a map along with an NPCControl stored in <code>npcdata</code>. This data comes from the map entity data and is done by MapControl's CreateEntities which happens on its Start.</p>"},{"location":"Entities/EntityControl/EntityControl%20Fields/","title":"EntityControl Fields","text":"<p>This page aims to document the different fields available to EntityControl and their expected usage. Note: internal here means both EntityControl and NPCControl's concerns, not just EntityControl. A field being public doesn't necessarily mean it can safely be used externally. This document will clarify when a field can safely be set externally.</p>"},{"location":"Entities/EntityControl/EntityControl%20Fields/#object-hiearchy","title":"Object hiearchy","text":"<p>These fields are intended to ease the navigation and accesses of the different key components and objects of the Entity. They can be as simple as avoiding a GetComponent call or just a way to verify the presence of an optional structure like a model. They are not intended to be set externally unless otherwise stated, but their properties can be set.</p> Name Type Description transform Transform The transform of the root object of the entity, assigned on CreateNewEntity and Start npcdata NPCControl The optional NPCControl of the entity. This must be set externally or on CreateEntities ccol CapsuleCollider The capsule collider of the root object, assigned on CreateNewEntity and Start. The height and radius are loaded on CreateEntities rigid RigidBody The rigid body of the root object, assigned on Start rotater Transform The transform of the Rotater object which controls alignement, the first child of the root object, assigned on Start sprite SpriteRenderer The sprite renderer of the sprite object, assigned on CreateNewEntity spritetransform Transform The transform of the Sprite object, a child of the Rotater object, assigned on CreateNewEntity emoticon Animator The animator component of the Emoticon object which is an icon that appears at the top of the entity for interactions, a child of the Rotater object, assigned on Start emoticonsprite SpriteRender The sprite renderer component of the Emoticon object, a child of the Rotater object, assigned on Start moverotater Transform The transform of the MoveRotater object which is used for movement alignment, a child of the root object, assigned on CreateNewEntity and Start shadow SpriteRender The sprite renderer of the shadow object, a child of the root object. Assigned on Start during CreateShadow shadowtransform Transform The transform of the shadow object, a child of the root object. Assigned on Start during CreateShadow hpbar Transform The transform of the hp bar when applicable, a child of the root object. Assigned on CreateHPBar hpbarfont DynamicFont A DynamicFont of the hpbar that shows the HP, Assigned on CreateHPBar defstat DynamicFont A DynamicFont of the hpbar that shows the defense, Assigned on CreateHPBar icecube GameObject The object of an ice cube when the entity is frozen, a child of the root object. Assigned on Freeze movesmoke Transform The transform of an instance of <code>Prefabs/Particles/WalkDust</code> a child of the root object. Assigned when applicable on LateStart detect BoxCollider The BoxCollider of the Detector object with a RayDetector that is used to detect walls via hitwall, a child of the root object. Assigned by CreateDetector feet GroundDetector The GroundDetector of an instance of <code>Prefabs/GroundDetector</code> a child of the root object used to detect being on the ground via onground. Assigned on CreateFeet with this entity as the parent flowerbed GameObject An instance of <code>Prefabs/Particles/flowerbed</code>, a child of of the root object. Assigned during OnTriggerStay when the other collider has the <code>FlowerBed</code> tag sound AudioSource The audio source of the root object, assigned on Start, but can be reassigned externally"},{"location":"Entities/EntityControl/EntityControl%20Fields/#animations-and-animids","title":"Animations and AnimIDs","text":"<p>These fields manages the animations according to the animid.</p> Name Type External set? Description animid int Yes The AnimID of the entity, dictates the animation controller to use via the anim field. Can be set via CreateEntities. For an item entity, this is the item type originalid int No The AnimID at the start of CheckSpecialID which may not be the same then the effective value from the animid field animstate int Yes The animstate of the entity, dictates the animation clip to play on the controller of the anim field. For an item entity, this is the item id and set via CreateEntities basestate int Yes The animstate to consider as the <code>Idle</code> one which overrides the default of 0, assigned during CheckSpecialID when applicable walkstate int Yes The animstate to consider as the <code>Walk</code> one which overrides the default of 1, assigned during CheckSpecialID when applicable changedstate bool Yes Determines if the animstate was changed externally and thus should bypass the landing on ground logic of UpdateAirAnim for all entities with an npcdata. This is only used in the Anim SetText command. animspeed float Yes The time in second to transition between animations during SetAnim anim Animator No The animator the entity uses. This will use the controller of the animid field. This is first assigned on Start or AddModel , but it can be changed later via ForceAnimator (more details at Animator change) hasiceanim bool No Whether or not the entity has an ice animation clip present to play when the inice field is true. Assigned on CheckSpecialID from <code>endata</code> diganim bool No Determines if this entity has animations when digging, assigned on CheckSpecialID from <code>endata</code> flyinganim bool Yes Determines if the entity should be playing the flying version of the current animstate forcefire bool No Forces the fire variant of the entity's animid if it exist. This is only assigned to true during Enemies data loading for FireCape, FireWarden and FireKrawler. Enforced in CheckSpecialID when applicable talking bool Yes Determines if the entity is currently talking. This must be set externally to have an effect during UpdateSprite notalk bool No Determines if this entity should never have SetAnim called with a <code>t</code> (talking) argument assigned on CheckSpecialID when <code>endata</code>'s Object is true bounceanim Coroutine Yes Exposes a way to store the BounceAnim call to know if the entity is currently in a BounceAnim, set to null before a yield break or return specialanim Coroutine Yes Exposes a way to store a coroutine call to know if the entity is currently in a special animations requiring a coroutine, set to null before a yield break or return"},{"location":"Entities/EntityControl/EntityControl%20Fields/#force-move","title":"Force move","text":"<p>These fields manages both the process of ForceMove and MoveTowards which are considered force move as they are game controlled movement of the entity to a specific target.</p> Name Type External set? Description forcemoving Coroutine Yes Exposes a way to store a ForceMove call to know if the entity is currently in a ForceMove, set to null before a yield break or return forcemove bool Yes Determines if the entity is currently in a force move process via MoveTowards forcetarget Vector3 Yes The target position of a forcemove via MoveTowards forcemultiplier float No The multiplier to the speed when moving during a forcemove via MoveTowards if the caller specified one. This defaults to 1.0 forceanim int No The animstate to use during the forcemove via MoveTowards if the caller specified one. This defaults to walkstate forcestop int No The animstate to use when the forcemove via MoveTowards is completed if the caller specified one. This defaults to basestate forcetimer float No The time remaining in frames before triggering the forcemove failsafe via MoveTowards, decreased on LateUpdate when applicable unless disabletimer is true disabletimer bool Yes Determines if the forcetimer should decrease on LateUpdate if applicable looktowards Vector3 No The position the entity looks at during a forcemove via MoveTowards, null if not applicable extratimer bool No Determines if the forcetimer should be doubled when a forcemove is started which gives more time before triggering the failsafe. This can be assigned to true on Start with the <code>TIME</code> Modifiers forcejump bool Yes Determines if the entity should attempt to jump during a force move when hitwall and onground are true and jumpcooldown is expired. This must be set externally ignorey bool Yes Determines if the entity should ignore the y axis during the forcemove via MoveTowards if the caller specified one."},{"location":"Entities/EntityControl/EntityControl%20Fields/#height-management","title":"Height management","text":"<p>These fields operate with the concept of height which is a visual vertical offset between the root <code>transform</code> and the <code>spritetransform</code>. This is accomplished by setting the local position of the latter upwards which won't affect physics, but affects visual rendering.</p> Name Type External set? Description height float Yes The vertical offset of the spritetransform to the transform. Set to initialheight on CreateEntities, but overridden to minheight on Start when applicable minheight float Yes The minimum height which is enforced on Start and in CheckSpecialID where it is also assigned from <code>endata</code> initialheight float Yes The starting height, assigned to height on Start and on CreateEntities tempheightoverride bool No This is only used during Drop when the entity is frozen in the air and therefore should drop to 0.0 instead of minheight bobrange float Yes The range of the oscillation done during UpdateHeight when the height is higher than 0.1, assigned on CreateEntities or on CheckSpecialID from <code>endata</code> bobspeed float Yes The speed of the oscillation done during UpdateHeight when the height is higher than 0.1, assigned on CreateEntities or on CheckSpecialID from <code>endata</code> startbf float No The initial bobrange, assigned to bobrange on LateStart but also on CheckSpecialID and AnimSpecificQuirks when applicable. The bobrange is restored to this on Drop and BreakIce, but it is possible to do so externally startbs float No The initial bobspeed, assigned to bobspeed on LateStart but also on CheckSpecialID and AnimSpecificQuirks when applicable. The bobspeed is restored to this on Drop and BreakIce, but it is possible to do so externally"},{"location":"Entities/EntityControl/EntityControl%20Fields/#logic-overrides","title":"Logic overrides","text":"<p>These fields allows to bypass common logic of the entity during its lifecycle. They act as toggles and most of them can be operated externally which allows to gain more control over the entity from outside EntityControl.</p> Name Type External set? Description overrideanim bool Yes Determines if the entity should not have its animstate changed automatically which means only explicit writes to the animstate are allowed. This also prevents the sprite to be disabled and its sprite to be set to null when the animid becomes -1 (None). Assigned to true on CheckSpecialID if it's a <code>KeyL</code>, <code>KeyR</code> or <code>Tablet</code> overridemovesmoke bool Yes Determines if the movesmoke should never be positioned at the root object during UpdateMoveSmoke. Set to true on Start and CheckSpecialID when applicable overrideshadow bool Yes Forces the creation and updates of shadow as long as iskill is false, assigned in CheckSpecialID from <code>endata</code> or to true when applicable. This needs to be set as part of the startup process or shadow will never be created overrideanimfunc bool Yes Determines if the entity should not be affected by a call to AnimationFunctions.ExtraAnims, assigned to true on CheckSpecialID if it's a <code>KeyL</code>, <code>KeyR</code> or <code>Tablet</code> overrridejump bool Yes Determines if the entity should not have its animstate changed to <code>Jump</code> or <code>Fall</code> automatically during UpdateAirAnim, assigned at several places internally notably on CheckSpecialID from <code>endata</code> overrideflip bool Yes Determines if the entity should skip any UpdateFlip cycle overrideonlyflip bool Yes Determines if the entity should skip regular flip handling in the UpdateFlip cycle (this means any updates other than digging when spin is zero) overrideheight bool Yes Determines if the entity should skip any UpdateHeight cycle even if it isn't the player and not an npcdata of type Object overrideanimspeed bool Yes Determines if the standard animation speed logic should be bypassed on Update, must be set externally or by EntityControl Methods &gt; Overrides overridefollow bool Yes Determines if the entity should not be controlled by the Follow logic overrideshieldpos Vector3? Yes Overrides the default bubbleshield position if assigned. This must be set externally overridefly bool No Determines if the entity will never attempt to play a fly animation or receive UpdateAirAnim cycles, assigned on CheckSpecialID from <code>endata</code>"},{"location":"Entities/EntityControl/EntityControl%20Fields/#extras-and-optional-objects","title":"Extras and optional objects","text":"<p>These fields manages optional objects that the entity maintains. They are usually created and used on a per AnimID needs.</p> Name Type External set? Description extras GameObject No An array of extra objects to keep track of. Assigned with a variable length on CheckSpecialID and during the AnimSpecific updates spinextra Vector3[] No An array of extra angles to add to the extras and extralines assigned on CheckSpecialID and AnimSpecificQuirks when applicable extraanims Animator[] No An array of extra animator to use which is required for certain AnimIDs. Assigned if applicable on UpdateAnimSpecific extrasprites SprtiteRender[] No An array of extra sprite render to use which is required for certain AnimIDs. Assigned if applicable on AnimSpecificQuirks extralines LineRenderer[] No A set of extra lines the entity can use, only used for DeadLanderB during AnimSpecificQuirks line LineRenderer No The line renderer of the Line object, childed to the parent sent to AddLine or to the spritetransform if null. AddLine must be called to have this assigned which it is on CheckSpecialID for <code>RizGrandpa</code> subentity EntityControl[] No An array of sub entities that this entity has access to. This is specifically used for <code>SeedlingKing</code> firepart Transform Yes The particles object involved in a condition's visual effect when applicable. This is not used internally and is left to null. This must be set and used externally"},{"location":"Entities/EntityControl/EntityControl%20Fields/#ice","title":"Ice","text":"<p>These fields manages any ice related event, particularly during Freeze handling.</p> Name Type External set? Description inice bool Yes Determines if the entity is affected by an ice related event, set to true on Start if the current map's <code>icemap</code> is true icecubeprefab GameObject No An instance of <code>Prefabs/Objects/icecube</code>, assigned on Start nofallfrozen bool No Determines if the entity should stay in place when Drop occurs while the entity is frozen freezesize Vector3 No The size of the ice cube when the entity is frozen, assigned on CreateEntities, Enemies data loading or CheckSpecialID from <code>endata</code> freezeoffset Vector3 No The offset of the ice cube when the entity is frozen, assigned on CreateEntities, Enemies data loading or CheckSpecialID from <code>endata</code> initialfrezeoffset Vector3 No The initial offset of the ice cube when the entity is frozen, assigned on CheckSpecialID to freezeoffset shakeice bool Yes Determines if the icecube should shake when being rendered if applicable"},{"location":"Entities/EntityControl/EntityControl%20Fields/#rendering-and-alignment","title":"Rendering and alignment","text":"<p>These fields changes the way the entity is rendered or aligned horizontally.</p> Name Type External set? Description speed float Yes The movement speed of the entity, assigned on CreateEntities or during CheckSpecialID when applicable. This defaults to 5.0 flip bool Yes Whether the sprite should be rendered flipped by 180 degrees on the y axis, must be set externally, by CreateEntities or if needed internally alwaysflip bool No Determines if UpdateFlip should be called each LateUpdate even without an incamera update, assigned to true on Start with the <code>ALF</code> Modifiers spin Vector3 Yes The rotation in angles to apply on the next UpdateFlip when not digging and overrideflip is false, assigned on CheckSpecialID for a CrystalBerry lockrotater bool No Determines whether to lock the y angle of the rotater object instead of letting it rotate to the main camera y angle, assigned to true on Start with the <code>ROT</code> Modifiers spritebasecolor Color Yes The suggested color to render the sprite, assigned to fully opaque white on EntityControl Creation hologram bool Yes Determines if the entity should be rendered as a hologram. This can be assigned to true on Start with the <code>Holo</code> or <code>COT</code> Modifiers cotunknown bool Yes Determines if the entity should be rendered as a silhouette during the Cave of Trials. This can be assigned to true on Start with the <code>COT</code> Modifiers refreshedcotu bool No Indicates that the entity processed a RefreshCOT call stopspinonground bool Yes A fire and forget flag to stop the spin on the next LateUpdate startscale Vector3 Yes The base scale of the entity. truescale will be set to this during LateUpdate which will cause the spritetransform to be scaled by it during UpdateFlip. The default is Vector3.one, writing to it will change the scale on the next UpdateFlip truescale Vector3 No The Vector3 that will be used to scale spritetransform on the next LateUpdate using the startscale value. Initially set on LateStart to startscale modelscale Vector3 No The scale of the model if applicable, assigned on AddModel to the model's actual scale. This is never set once startup finishes. shrink bool Yes Determines if the entity should be progressively shrunk on UpdateVelocity by setting startscale towards zero nomodel bool No Determines if this entity should be considred to not have a model and to not attempt to load any, only set to true on CheckSpecialID if it's a <code>KeyL</code>, <code>KeyR</code> or <code>Tablet</code> trail bool Yes Determines if the entity has a trail which are rendered copies of the entity with half transparency as they move traildata TrailData No The data of the trails if applicable, managed by RefreshTrail"},{"location":"Entities/EntityControl/EntityControl%20Fields/#physics-and-movement-handling","title":"Physics and movement handling","text":"<p>These fields manages any physics related tasks, particularly movement, but also collisions.</p> Name Type External set? Description startvelocity Vector3 No The starting velocity of the rigid, assigned on Start deltavelocity Vector3 No The last velocity observed since the last Move startpos Vector3 Yes The last starting position of the entity. Initially set on CreateEntities or to the transform's position on Start or to the point a raycast will hit from the transform heading down with the <code>COG</code> Modifiers or on LateStart to the transform position if it still isn't set. This is also set on SetPosition and it is used to restore the transform position if needed, but it can be done externally onground bool Yes The result of the feet's GroundDetector which determines if the entity is on the ground. It it can be forced externally to force the result. The default value is true, but it is overridden to false on Start with the <code>NGS</code> Modifiers hitwall bool Yes The result of the detect's RayDetector which determines if the entity has hit a wall, but it can be set externally to force the result. walktype WalkType No The type of walking of this entity during Move jumpheight float Yes The height of a Jump for this entity. Also used to clamp the y velocity in UpdateVelocity, set to 10.0 by default jumpcooldown float No The time in frames to wait before the entity is allowed to jump again since the last Jump, decreased towards 0 by UpdateGround springcooldown bool No Determines if the entity is currently in ascension after touching a JumpSpring offgroundframes float Yes The amount of time in frames this entity observed onground being false, updated on LateUpdate, but reset to 0.0 if it reaches 1000.0 initialcenter Vector3 No The center of the ccol initially when Start occurs initialcolliderdata Vector2 No The height and radius (in x and y respectively) of the ccol when Start occurs fixedentity bool Yes Determines if this entity should be fixed in position, assigned to true on Start if the entity is a TestSign or with the <code>Fixed</code> or <code>FxdCol</code> Modifiers ignorewater bool No Determines whether this entity is not affected by water Hazards, assigned when applicable on CheckSpecialID leiffly bool No Determines if the entity is Moth and he is currently in his flying animation. Used during FixedUpdate to set his position as he flies"},{"location":"Entities/EntityControl/EntityControl%20Fields/#previous-values","title":"Previous values","text":"<p>These fields stores the previous values of other fields observed at particular points in the entity lifecycle. Most of them shouldn't be set externally, but some can be set to force some kind of update.</p> Name Type External set? Description oldid int No The last animid observed since the last animation updates of UpdateSprite laststate string No The last effective animstate played including the arguments of SetAnim. Set only when playing an animation from SetAnim lastvelocity Vector3 No The velocity last observed when pausing happened on Update and then used as the rigid's velocity on Update after unpause before going back to null lastgravity bool No The gravity's enabling that was last observed when pausing happened on Update and then used as the rigid's useGravity on Update after unpause lastvolume float No The sound's volume that was last observed when pausing happened on Update and then used as the sound's volume on Update after unpause pausepos Vector3 No The position last observed when pausing happened on Update and set to null when unpausing happened on Update. Used to lock the position when paused unless activeonpause is true, we are in an event, iskill is true or the entity is dead lastshadow Vector3 No The last position of the transform when RefreshShadow updated the shadow oldback bool No The last backsprite observed since the last animation updates of UpdateSprite oldttalk bool No The last talking observed since the last animation updates of UpdateSprite lastice bool No The last inice observed since the last animation updates of UpdateSprite oldstate int Yes The last animstate observed by the last animation update of UpdateSprite lastpos Vector3 Yes The last transform's position observed since the last LateUpdate assigned to startpos on CreateEntities or on Start oldfly bool Yes The last flyinganim observed since the last animation updates of UpdateSprite oldtalk bool Yes The last value of talking observed during the last UpdateSprite"},{"location":"Entities/EntityControl/EntityControl%20Fields/#digging","title":"Digging","text":"<p>These fields manages the process of digging underground.</p> Name Type External set? Description digging bool Yes Determines if the entity is digging underground which is used on several update methods. digtime float Yes The time in frames since the entity started digging underground digscale Vector3 Yes The scale to render digpart[1] which is the digging object when fully underground. The default is Vector3.one digpart GameObject[] No An array of 2 objects which are both children of the root object. The first is an instance of <code>Prefabs/Particles/DirtFlying</code> when starting a dig and the second is an instance of <code>Prefabs/Particles/Digging</code> when fully digging. Assigned to a length of 2 on Start nodigpart bool No Determines if digpart should be created and handled while digging during UpdateFlip. Set to true during Follow instdig bool No Determines if the entity should immediately start digging??? TODO: this might not be practically used because the only possible usage implies a throw during UpdateFlip"},{"location":"Entities/EntityControl/EntityControl%20Fields/#identification","title":"Identification","text":"<p>These fields provides more information about who this entity is.</p> Name Type External set? Description isplayer bool No Determine if this is the player entity with the PlayerControl, assigned to true on LateStart if the entity has the <code>Player</code> tag mainparty bool Yes Determines if the entity is part of the main party when created which means the party members that follow the player excluding the player itself. Must be set externally and is only used in CloseMove during a Follow playerentity bool No Determines if this entity is related or is the player, assigned to true on Start if the entity has the <code>Player</code> or <code>PFollower</code> tag isfollower bool No Determines if the entity is a follower, assigned on LateStart when the entity has the <code>PFollower</code> tag tempfollower bool No Determines if the entity is a temporary follower, set to true when the entity was created using AddFollower battle bool Yes Determines if this is a battle entity, must be set externally or during CheckSpecialID when applicable battleid int Yes The index of the entity in the current battle's enemydata, -1 when not applicable"},{"location":"Entities/EntityControl/EntityControl%20Fields/#emoticon-and-status-icons","title":"Emoticon and status icons","text":"<p>These fields manages both the emoticon to show in <code>emoticon</code> or the status condition / medal icon to show during battle.</p> Name Type External set? Description emoticonid int Yes The id of the emoticon to play on the next UpdateEmoticon when emoticoncooldown hasn't expired yet emoticonoffset Vector3 Yes The offset to render the emoticon from the height during UpdateEmoticon, assigned on CheckSpecialID from <code>endata</code>'s freezeflipoffset when applicable and on CreateEntities emoticoncooldown float Yes The period in frames to listen for emoticon changes and play the one in emoticonid during UpdateEmoticon statusid int No The id of the current status icon to show from statusicons until statuscooldown expires statusicons Transform[] Yes The status transforms of the status icons attached to the entity statuscooldown float No The time in frames left to display the statusid current status icon from statusicons nocondition bool Yes Determines if the entity shouldn't render any condition icons during UpdateStatusIcons. Set to true at the start of Death and to false in Revive"},{"location":"Entities/EntityControl/EntityControl%20Fields/#follow","title":"Follow","text":"<p>These fields configures the Follow system and allow access to the follow chain.</p> Name Type External set? Description following EntityControl Yes The Entity to follow which involves physically moving it such that it follows it during Follow followedby Transform Yes The entity that follows this one, null if not followed by anyone. This must be set externally which is typically by MainManager followoffset float Yes The distance to be away from the following entity tempfollowerid int Yes This is specific to Chompy to determine who she follows. This must be set externally"},{"location":"Entities/EntityControl/EntityControl%20Fields/#camera-active-range-info","title":"Camera active range info","text":"<p>These fields manages the concept of an entity being \"active\" which means they receive more attention during the update cycle. This is typically due to being in the range of the camera, but it can be forced on.</p> Name Type External set? Description incamera bool No Determines if the entity is in the main camera range, updated every 3 frames on LateUpdate, stays true when alwaysactive is true camdistance float No The distance from the entity to the main camera, updated every 3 frames on LateUpdate campos Vector3 No The viewport position of the entity from the main camera, updated every 3 frames on LateUpdate alwaysactive bool Yes Determines if this entity should always be considered active by overriding incamera to true during UpdateCamPos (called by LateUpdate). This also forces the forcetimer to decrease and UpdateHeight to be called from LateUpdate when they apply. Assigned to true on Start with the <code>ALW</code> Modifiers or during CheckSpecialID when applicable activeonpause bool Yes Determines if this entity should receive updates and late updates when paused, minipaused, message lock being active or dead, assigned to true on Start with the <code>PAU</code> Modifiers"},{"location":"Entities/EntityControl/EntityControl%20Fields/#shadow","title":"Shadow","text":"<p>These fields handles the <code>shadow</code> object.</p> Name Type External set? Description hasshadow bool Yes Determines if shadows should be rendered for this entity, assigned on CheckSpecialID to true or overridden from <code>endata</code> / false if applicable. If this was false by the end of CheckSpecialID, the shadow will never be created shadowsize float Yes The maximum base scale of the shadow object assigned on CheckSpecialID from <code>endata</code>"},{"location":"Entities/EntityControl/EntityControl%20Fields/#sound","title":"Sound","text":"<p>These fields configure the sounds to play using <code>sound</code>.</p> Name Type External set? Description soundonpause bool No Determines if the entity should be muted when it goes out of range or the game is paused, assigned by NPCControl's <code>SetUp</code> when it is a Geizer soundvolume float No The volume to play the next sounds clips from the sound AudioSource. PlaySound must be called to set this"},{"location":"Entities/EntityControl/EntityControl%20Fields/#death","title":"Death","text":"<p>These fields manages the concept of Death and also configures it when it occur.</p> Name Type External set? Description dead bool Yes Determines if the entity is currently dead which is assigned to true at the start of Death iskill bool Yes Determines if the entity is killed, similar to death, but is only optionally set during Death when requested. spitexp int Yes The amount of EXP orb to drop when Death occur. This must be set externally spitmoney int Yes The amount of berries to drop when Death occur. This must be set externally"},{"location":"Entities/EntityControl/EntityControl%20Fields/#item","title":"Item","text":"<p>These fields are specific to item entities.</p> Name Type External set? Description item bool Yes Determines if this entity is an item entity. This should be set before Start alongside <code>animstate</code>. If not, <code>itemstate</code> must also be set to the <code>animstate</code> showitem bool No Indicates that this entity must render an item sprite. This can be set to true on Start using the <code>shwKEY</code> Modifiers itemstate int Yes The item id, only applicable for item entity and should have the same value as the <code>animstate</code>"},{"location":"Entities/EntityControl/EntityControl%20Fields/#drop","title":"Drop","text":"<p>These fields are related to the Drop procedure.</p> Name Type External set? Description shakeondrop bool No Determines if the entity should cause a screen shake, a sound and smoke effects to happen when Drop has dropped the entity to the ground, Assigned on CheckSpecialID from <code>endata</code> droproutine Coroutine Yes Exposes a way to store the Drop call to know if the entity is dropping, set to null before a yield break or return"},{"location":"Entities/EntityControl/EntityControl%20Fields/#bubble-shield","title":"Bubble shield","text":"<p>These fields are related to the use of the bubble shield.</p> Name Type External set? Description shieldenabled bool Yes Determines if the entity has an active bubble shield which will grow bubbleshield to its scale. This must be set externally bubbleshield DialogueAnim No The DialogueAnim of an instance of <code>Prefabs/Objects/BubbleShield</code> childed to the Rotater object when battle and isplayer are both true on Start"},{"location":"Entities/EntityControl/EntityControl%20Fields/#dialogue-bleep","title":"Dialogue bleep","text":"<p>These fields dictate the default sound to use during SetText's bleep and its Bleep command.</p> Name Type External set? Description dialoguebleepid int Yes The bleep sound id to use in the Bleep SetText command, assigned from <code>endata</code> on Start during SetDialogueBleep bleeppitch int Yes The bleep pitch to use in the Bleep SetText command, assigned from <code>endata</code> on Start during SetDialogueBleep"},{"location":"Entities/EntityControl/EntityControl%20Fields/#late-transform","title":"Late transform","text":"<p>The late transform is a special transform the entity has available that lives completely separately to the regular update cycle. These fields manages that concept.</p> Name Type External set? Description latetrans Transform Yes A transform that gets positioned by latepos every LateUpdate latepos Vector3 Yes The position to set latetrans on LateUpdate"},{"location":"Entities/EntityControl/EntityControl%20Fields/#miscellaneous","title":"Miscellaneous","text":"Name Type External set? Description originalmap Transform No The transform of the current map observed on LateStart setup bool No Determines if LateStart has executed. Assigned to true at the end of it. icooldown float Yes The period in frames left to the invulnerability noclock bool Yes Related to PlatformNoClock ??? This must be set externally destroytype DeathType Yes The type of death process used for Death. This is normally loaded from map entity data"},{"location":"Entities/EntityControl/EntityControl%20Fields/#used-only-by-npccontrol","title":"Used only by NPCControl","text":"<p>These fields are declared in EntityControl Creation, but aren't actually used there outside of declaration with optional initialization.They are only useful in NPCControl, only what happens on EntityControl Creation is documented here.</p> Name Type Description hideinside bool Assigned to true on Start with the <code>HIDE</code> Modifiers alwaysemoticon bool Assigned to true on Start with the <code>ShwEm</code> Modifiers spawnpoint Vector3 Set to the transform's position on Start overrideminheight bool Determines if the entity should not have minheight affect its height. This is only used by NPCControl activeinevents bool Left to default (false) killonfall bool Left to default (false)"},{"location":"Entities/EntityControl/EntityControl%20Fields/#practically-unused-fields","title":"Practically unused fields","text":"<p>These fields are present, but they do not have any practical uses in the game. They can still impact logic if they are changed externally or they are used as constant value meaning they should never be changed.</p> Name Type Description noemoticon bool This can allow to opt out of having an emoticon object if set to true on Start. The field is functional, but never set preloadedobjects GameObject[] Contains the array of preloaded objects assigned on CheckSpecialID from <code>endata</code>. This field's sole purpose is to cache ressources loading for later preloadedsprites Sprite[] Contains the array of preloaded sprites assigned on CheckSpecialID from <code>endata</code>. This field's sole purpose is to cache ressources loading for later oldground bool The last onground value observed since the last LateUpdate mapentity bool Presumably, this would indicate that the entity is from a map, but this is covered by npcdata not being null flipspeed float The speed to flip the angles of the sprite during a regular flip handling of UpdateFlip. This is left to its default value which is 0.2 extraoffset Vector3 An additional offset to apply on UpdateHeight, UpdateEmoticon and the ShakeSprite Coroutine. This is left to its default value of Vector3.zero speedbuffer float[] This is only used for DeadLanderB during AnimSpecificQuirks with a value always being <code>{ 0.5, 0.34, 0.15, 0.3, 0.6 }</code> followlimit float The maximum square distance in units of a Follow followdistance float The minimum square distance in units of a Follow followjump float The minimum square distance in units of a Follow soundidstance float The maximum distance in units where the new volume of sound during UpdateSound will be 0 when reached or exceeded from the camdistance. This is left to the default value of 25.0 lockback bool Determines if the entity shouldn't change its backsprite on FaceTowards unless it is forced. This is functional, but never set to true usebuffer bool This is never set to true, but it has an unknown usage in DoFollow soundfix bool This is set to true during a ScrewSwitch update, but it is never read from"},{"location":"Entities/EntityControl/EntityControl%20Methods/","title":"EntityControl Methods","text":"<p>There are all the methods in EntityControl Creation.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#unity-events","title":"Unity Events","text":"<p>This component implements <code>Start</code>, <code>OnEable</code> <code>Update</code>, <code>LateUpdate</code>, <code>FixedUpdate</code>, <code>OnTriggerStay</code> and <code>OnTriggerExit</code>. You can lean more about them in Start, Update, LateUpdate, FixedUpdate, OnTriggerStay and OnTriggerExit. Notably, <code>Start</code>, <code>OnEnable</code> and the 3 updates ones are an integral part of the startup and update process of the entity.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#creation","title":"Creation","text":"<p>These methods are the gateway to initialise entities. As such, they are static and returns an EntityControl except for items which gives an NPCControl. No matter the context to create the entity, it has to go through one of these</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#createnewentity","title":"CreateNewEntity","text":"<p>These overloads are fully documented at EntityControl Creation &gt; Creating an entity</p> <pre><code>public static EntityControl CreateNewEntity(string name)\n</code></pre> <pre><code>public static EntityControl CreateNewEntity(string name, int anim_id, Vector3 position)\n</code></pre> <pre><code>public static EntityControl CreateNewEntity(string name, int anim_id, Vector3 position, EntityControl follow)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#createitem","title":"CreateItem","text":"<p>Items uses a different method which is more a helper to create an Item object as an map entity. This is the one of the few ways that creating an NPCControl dynamically is supported. For more information, check CreateItem.</p> <pre><code>public static NPCControl CreateItem(Vector3 startpos, int itemtype, int itemid, Vector3 direction, int timer)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#lifecycle-methods","title":"Lifecycle methods","text":"<p>These methods are called by Unity events during key moments in the entity lifecycle. Some of them can be called outside of them, but being part of the lifecycle is their main purpose.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#latestart","title":"LateStart","text":"<p>This method uses the <code>setup</code> field as a fire and forget which means it will only be called once during the first LateUpdate and then never called again. More details at LateStart.</p> <pre><code>private void LateStart()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#update-methods","title":"Update methods","text":"<p>These methods were eventually called by LateUpdate and they each manage different parts of the update process. Since they are essential, dedicated pages are made for them.</p> <p>UpdateAnimSpecific</p> <pre><code>public void UpdateAnimSpecific()\n</code></pre> <p>AnimSpecificQuirks</p> <pre><code>private void AnimSpecificQuirks()\n</code></pre> <p>UpdateItem</p> <pre><code>public void UpdateItem()\n</code></pre> <p>CheckSpecialID</p> <pre><code>public void CheckSpecialID()\n</code></pre> <p>RefreshTrail</p> <pre><code>private void RefreshTrail()\n</code></pre> <p>UpdateFlip</p> <pre><code>private void UpdateFlip()\n</code></pre> <p>UpdateStatusIcons</p> <pre><code>private void UpdateStatusIcons()\n</code></pre> <p>This method updates <code>incamera</code>  with whether the entity is in the main camera range (ranging from (-0.6, -1.25) to (1.6, 2.25) in viewport coordinate while also being higher than -1 on the z axis) or true if <code>alwaysactive</code> is true. It will also update <code>camdistance</code> to the distance of the entity to the main camera and <code>campos</code> to the viewport position of the entity using the main camera</p> <pre><code>private void UpdateCamPos()\n</code></pre> <p>UpdateSound</p> <pre><code>private void UpdateSound()\n</code></pre> <p>UpdateSprite</p> <pre><code>private void UpdateSprite()\n</code></pre> <p>UpdateHeight</p> <pre><code>private void UpdateHeight()\n</code></pre> <p>UpdateVelocity</p> <pre><code>private void UpdateVelocity()\n</code></pre> <p>This will ensure the <code>rotater</code>'s y angle matches the main camera one unless <code>lockrotater</code> is true</p> <pre><code>private void UpdateRotater()\n</code></pre> <p>UpdateGeneralAnim</p> <pre><code>private void UpdateGeneralAnim()\n</code></pre> <p>UpdateAirAnim</p> <pre><code>private void UpdateAirAnim()\n</code></pre> <p>UpdateCollider</p> <pre><code>private void UpdateCollider()\n</code></pre> <p>UpdateEmoticon</p> <pre><code>private void UpdateEmoticon()\n</code></pre> <p>UpdateMoveSmoke</p> <pre><code>private void UpdateMoveSmoke()\n</code></pre> <p>RefreshShadow</p> <pre><code>public void RefreshShadow()\n</code></pre> <p>UpdateGround</p> <pre><code>private void UpdateGround()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#movement","title":"Movement","text":"<p>These methods manages movement of the entity. Whether it is through <code>forcemove</code> or moving in general, they manage their movement taking into account animations and colliders.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#setposition","title":"SetPosition","text":"<p>Sets the <code>transform</code>'s position, <code>startpos</code> and <code>lastpos</code> to <code>pos</code>.</p> <pre><code>public void SetPosition(Vector3 pos)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#delayedposition","title":"DelayedPosition","text":"<p>Sets the entity's position to be <code>pos</code> after <code>time</code> seconds have passed.</p> <pre><code>public void DelayedPosition(Vector3 pos)\n</code></pre> <pre><code>public void DelayedPosition(Vector3 pos, float time)\n</code></pre> <p>The default value of <code>time</code> is -1.0 (one frame).</p> <p>Both of these overloads ends up starting a SetLatePos coroutine with the parameters sent:</p> <pre><code>private IEnumerator SetLatePos(Vector3 pos, float time)\n</code></pre> <p>The coroutine will yield for the amount of <code>time</code> in seconds (or a frame if it was 0 or below) before setting the <code>transform</code>'s position to <code>pos</code>. Unlike SetPosition, this does not set <code>startpos</code> and <code>lastpos</code>.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#jump","title":"Jump","text":"<p>Process a jump with velocity <code>h</code></p> <pre><code>public void Jump()\n</code></pre> <pre><code>public void Jump(float h)\n</code></pre> <p>The default value of <code>h</code> is <code>jumpheight</code> which itself defaults to 10.0</p> <p>This will first call Unfix if it's not an <code>item</code> and we aren't in a battle. After, <code>offgroundframes</code> is set to 20.0, <code>jumpcooldown</code> to 30.0  and the <code>rigid</code>'s velocity to have <code>h</code> in the y, but leave x and z unchanged.</p> <p>As a special case, if a <code>flowerbed</code> is present, the <code>FlowerJump</code> particle is played.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#forcemove","title":"ForceMove","text":"<p>Forces the entity to move to <code>target</code> after <code>frametime</code> amount of frames has passed maintaining the <code>movestate</code> animstate during the move and <code>stopstate</code> when it is completed</p> <pre><code>public void ForceMove(Vector3 target, float frametime, int movestate, int stopstate)\n</code></pre> <p>There's also an overload that changes the last 2 parameter into <code>changeanim</code> where either animstate is the current one unless true is passed to this parameter where <code>movestate</code> will be <code>walkstate</code> and <code>stopstate</code> will be <code>basestate</code>. Basically, this parameter controls if the animation should be left unchanged during the move or change to the defaults states.</p> <pre><code>public void ForceMove(Vector3 target, float frametime, bool changeanim)\n</code></pre> <p>Both of these overloads ends up calling the coroutine version storing the call into <code>forcemoving</code> (set to null on return):</p> <pre><code>private IEnumerator ForceMove(Vector3 target, float frametime, int[] an)\n</code></pre> <p>The way the force move works is the coroutine entirely manages the force move unlike the MoveTowards version which is managed via FixedUpdate and fields.</p> <p>The actual move is done by setting the <code>transform</code>'s position to a lerp between the position we started with to <code>target</code> with a factor of <code>a</code> / <code>frametime</code> where <code>a</code> is the amount of frames that elapsed since the start of the call. This lerp keeps being redone with a frame yield between iterations until <code>a</code> reached <code>frametime</code> + 1.0.</p> <p>Basically, this is a much more aggressive version than MoveTowards because this will always succeed in moving the entity even if it might not physically make sense. This is best used if the game can guarantee that moving to the desired position will make sense.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#stopforcemove","title":"StopForceMove","text":"<p>Completely halts any ongoing ForceMove or MoveTowards process of force moving either by completely stopping the velocity in x and z or by decelerating at half the current one if <code>smooth</code> is false. The animstate is set to <code>targetstate</code> if above -1 once this is done and the entity is at rest.</p> <pre><code>public void StopForceMove()\n</code></pre> <pre><code>public void StopForceMove(int targetstate, bool smooth)\n</code></pre> <p>The default value of <code>targetstate</code> is -1 (no animstate changes) and the default value of <code>smooth</code> is false (complete velocity stops).</p> <p>This will set <code>forcemove</code> to false and stop <code>forcemoving</code> if it was active before setting it to null. Then, either StopMoving is called sending <code>targetstate</code> in the case of <code>smooth</code> being false or if it's true, the <code>rigid</code>'s velocity is set to a lerp between the current one and the current y one with x and z zeroed out. This is done with a factor of 0.5 which will be the midpoint between the current x z velocity and a complete stop. From there, the animstate gets set to <code>targetstate</code> if above -1, <code>overrideanim</code> is false and the velocity's magnitude ended up \\&lt;= 0.1.</p> <p>Finally, If <code>looktowards</code> had a value, DelayedLook is called with it with a delay of 0.22 seconds before setting it to null</p> <pre><code>private IEnumerator DelayedLook(Vector3 target, float delay)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#move","title":"Move","text":"<p>More details available at Move, this manages the velocity and angles during an instant of a movement respecting <code>walktype</code> during the move.</p> <pre><code>public void Move(Vector3 pos, float multiplier, int state)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#stopmoving","title":"StopMoving","text":"<p>Stops the x and z velocity, stops any acceleration (<code>deltavelocity</code>) and set the animstate to <code>targetstate</code> if it is above -1 (otherwise, it is set to <code>basestate</code> if it was matching <code>walkstate</code>)</p> <pre><code>public void StopMoving(int targetstate)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#movetowards","title":"MoveTowards","text":"<p>Setup a <code>forcemove</code> through FixedUpdate to go to <code>pos</code> with a speed multiplier of <code>multiplier</code> setting the animstate to <code>state</code> during the move and <code>stopstate</code> once it is completed where the y axis is ignored if <code>ignore_y</code> is true.</p> <pre><code>public void MoveTowards(Vector3 pos)\n</code></pre> <pre><code>public void MoveTowards(Vector3 pos, float multiplier)\n</code></pre> <pre><code>public void MoveTowards(Vector3 pos, float multiplier, int state, int stopstate)\n</code></pre> <pre><code>public void MoveTowards(Vector3 pos, float multiplier, int state, int stopstate, bool ignore_y)\n</code></pre> <p>The defaults values are:</p> <ul> <li><code>multiplier</code>: 1.0</li> <li><code>state</code>: <code>walkstate</code></li> <li><code>stopstate</code>: <code>basestate</code></li> <li><code>ignore_y</code>: false</li> </ul> <p>There is also an overload available that calls the same one above, but also sets <code>looktowards</code> to <code>lookaftermove</code>.</p> <pre><code>public void MoveTowards(Vector3 pos, float multiplier, int state, int stopstate, bool ignore_y, Vector3 lookaftermove)\n</code></pre> <p>Finally, 2 overloads are available to only pass <code>pos</code> with the separate components</p> <pre><code>public void MoveTowards(float x, float y, float z)\n</code></pre> <pre><code>public void MoveTowards(float x, float z)\n</code></pre> <p>The default <code>y</code> is 0.0.</p> <p>This will assign the force move related fields to their proper value and return. This is done because the actual move is managed completely by FixedUpdate and the failsafe for it is handled in LateUpdate. </p> <p>It is not to be confused with the ForceMove coroutine which completely handles the move itself. Because the update process handles this move, it's a less aggressive one and it allows the entity to call Jump if needed. This gives the guarantee that the entity will try to move to <code>pos</code> in the most logical way. If it takes too long, the failsafe will trigger during LateUpdate and the entity will be instantly moved.</p> <p>Here are the actual values that will be set to the force move fields:</p> <ul> <li><code>forcemultiplier</code>: <code>multiplier</code></li> <li><code>forcetarget</code>: <code>pos</code> + the normalised direction towards <code>pos</code> * 0.4 which only slightly overshoots <code>pos</code></li> <li><code>forcestop</code>: <code>stopstate</code></li> <li><code>forceanim</code>: <code>state</code></li> <li><code>ignorey</code>: <code>ignore_y</code></li> <li><code>forcetimer</code>: It depends if it's the <code>playerentity</code>. If it is, the value is 375.0 if we're in an event or 250.0 if we're not. If it's not the <code>playerentity</code>, the value is 225.0 if it's a <code>battle</code> entity while a CheckDead is running or 500.0 otherwise.</li> </ul> <p>Finally, <code>forcemove</code> is set to true which activates it.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#flip-and-angles-adjustments","title":"Flip and angles adjustments","text":"<p>These methods adjusts the angles of the <code>rotater</code> which can either be due to the need to look somewhere or to spin or simple <code>flip</code> logic.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#facetowards","title":"FaceTowards","text":"<p>Changes the <code>flip</code> and <code>backsprite</code> accordingly to the entity facing towards <code>other</code>. <code>backsprite</code> will not be changed if <code>noback</code> is true unless <code>forceback</code> is true.</p> <pre><code>public void FaceTowards(Vector3 other)\n</code></pre> <pre><code>public void FaceTowards(Vector3 other, bool noback)\n</code></pre> <pre><code>public void FaceTowards(Vector3 other, bool noback, bool forceback)\n</code></pre> <p>The default value for <code>noback</code> and <code>forceback</code> are false. However, <code>noback</code> is not honored on the second overload and false is sent instead. The third overload must be used to sent <code>noback</code> to true. This means the second overload is practically useless.</p> <p>This will change <code>flip</code> by the value of the x viewpoint of the <code>transform</code> \\&lt; the x viewpoint of the <code>other</code>. Basically, true is if the entity is positioned strictly to the left of <code>other</code>, false otherwise.</p> <p>For <code>backsprite</code>, the assignment happens regardless if <code>forceback</code> is true, but if it's not then all of the following condition needs to be met to assign a new value:</p> <ul> <li><code>noback</code> is false</li> <li><code>lockback</code> is false (this field is unused so this is always the case normally)</li> <li>The entity is not <code>talking</code></li> <li>The message lock is released</li> </ul> <p>As for the new value of <code>backsprite</code>, it's the value of the z viewpoint of <code>other</code> + -0.5 &gt; the z viewpoint of the <code>transform</code>. Basically, it's true if after placing <code>other</code> 0.5 units towards the camera, it remains positioned more away from the camera than the entity, false otherwise.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#facetowards-helper-methods","title":"FaceTowards helper methods","text":"<p>These methods just calls FaceTowards with a specific <code>pos</code> as the only parameter.</p> <p>Faces towards the player if it is present</p> <pre><code>public void FacePlayer()\n</code></pre> <p>Faces towards the current position + (1.0, 0.0, 0.0)</p> <pre><code>public void FaceAhead()\n</code></pre> <p>Faces towards the current position + (-1.0, 0.0, 0.0)</p> <pre><code>public void FaceBehind()\n</code></pre> <p>Faces towards the current position + (0.0, 0.0, 1.0)</p> <pre><code>public void FaceUp()\n</code></pre> <p>Faces towards the current position + (0.0, 0.0, -1.0)</p> <pre><code>public void FaceDown()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#flipspriteangleat","title":"FlipSpriteAngleAt","text":"<p>Set the <code>spritetransform</code> to look at <code>target</code> and set its angle to (0.0, current y angles, 0.0) + <code>offset</code>. This also sets <code>overrideflip</code> to true.</p> <pre><code>public void FlipSpriteAngleAt(Vector3 target)\n</code></pre> <pre><code>public void FlipSpriteAngleAt(Vector3 target, Vector3 offset)\n</code></pre> <p>The default <code>offset</code> is zero.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#flipping-methods","title":"Flipping methods","text":"<p>These methods manages the <code>flip</code> field which controls which side the sprite is rendered.</p> <p>Toggles <code>flip</code></p> <pre><code>public void FlipSimple()\n</code></pre> <p>Returns a vector corresponding to the current <code>spritetransform</code> in x and z, but the y component is 180.0 if <code>flip</code> is true and 0.0 is it is false. This essentially is a way to know the actual angles of the entity considering its current <code>flip</code>.</p> <pre><code>public Vector3 FlipAngle()\n</code></pre> <p>This will call the other overload if <code>setangle</code> is false. If it is true, it will actually set the angles of <code>spritetransform</code> on top of returning them.</p> <pre><code>public Vector3 FlipAngle(bool setangle)\n</code></pre> <p>A helper to get the speed the flip should occur in UpdateFlip. The logic is unless there is an <code>npcdata</code> with a <code>startlife</code> of less than 50.0, this just returns <code>flipspeed</code>. If this is the case however, FlipAngle(true) is called and this returns 1.0.</p> <pre><code>private float GetFlipSpeed()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#spinning-methods","title":"Spinning methods","text":"<p>These methods manages the <code>spin</code> value which is an angle vector to spin the entity each UpdateFlip</p> <p>Set <code>spin</code> to zero which stops the entity from spinning</p> <pre><code>private void StopSpin()\n</code></pre> <p>Set <code>spin</code> to <code>s</code>, but invoke StopSpin in <code>time</code> seconds which means the spin is temporary until StopSpin gets called.</p> <pre><code>public void TempSpin(Vector3 s, float time)\n</code></pre> <p>Set <code>spin</code> to <code>spinamount</code>, then have its value decrease smoothly towards zero over the course of <code>frametime</code> frames before finally have its value set to zero upon completion.</p> <pre><code>public IEnumerator SlowSpinStop(Vector3 spinammount, float frametime)\n</code></pre> <p>Before all this happens, the <code>spritetransform</code> scale is set to <code>startscale</code>. If the <code>model</code> exist and its scale's magnitude is below 0.1, its scale gets set to Vector3.one.</p> <p>The actual value of <code>spin</code> during the deceleration is a lerp from the <code>spinamount</code> to zero with a factor of 1.0 - frames left / <code>frametime</code> with a yield of one frame between each iteration.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#sounds","title":"Sounds","text":"<p>Play a sound named <code>clipname</code> from the <code>Audio/Sounds</code> directory using the <code>sound</code> audio source if it can be heard at pitch <code>pitch</code> before calling UpdateSound and setting <code>soundvolume</code> to <code>volume</code> (which only sets the volume for the NEXT clip, not this one).</p> <pre><code>public void PlaySound(string clipname)\n</code></pre> <pre><code>public void PlaySound(string clipname, float volume)\n</code></pre> <pre><code>public void PlaySound(string clipname, float volume, float pitch)\n</code></pre> <p>The default value of <code>volume</code> and <code>pitch</code> are 1.0 which is normal volume and pitch.</p> <p>All the three overloads above ends up calling this one which just loads the clip before sending it to the <code>clip</code> parameter</p> <pre><code>public void PlaySound(AudioClip clip, float volume, float pitch)\n</code></pre> <p>The sound will only be played if all of the following conditions are met:</p> <ul> <li>The game settings doesn't have the SFX volume muted and if we are currently configuring it in the pause menu that the current setting isn't muted</li> <li><code>campos</code>.z is less than 25.0 which means the entity must not be 25.0 or more units away from the camera</li> <li>The game's globalcooldown expired</li> <li><code>campos</code> is in the camera's range</li> <li>Either this is the <code>beemerang</code>, there is no <code>npcdata</code> or there is one with a <code>startlife</code> of 15.0 or more</li> </ul> <p>This is an alias of the first overload.</p> <pre><code>public void PlaySoundSimple(string clipname)\n</code></pre> <p>Returns 1.0 - the clamp of <code>camdistance</code> from 0.0 to <code>soundistance</code> / <code>soundidstance</code> where <code>soundistance</code> is normally always 25.0. The return value is between 0.0 and 1.0 where 0.0 means the distance is too far for a sound to be heard and 1.0 means the sound could play at full volume as the entity is at the camera.</p> <pre><code>public float GetSoundDistance()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#animations","title":"Animations","text":"<p>These methods handles animstate and <code>animid</code> AnimIDs changes.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#setanim","title":"SetAnim","text":"<p>More details at SetAnim</p> <pre><code>public void SetAnim(string args)\n</code></pre> <pre><code>public void SetAnim(string args, bool force)\n</code></pre> <p>There is a helper method to call it with empty <code>args</code> and <code>force</code> to true</p> <pre><code>public void SetAnimForce()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#setstate","title":"SetState","text":"<p>Set the animstate to <code>state</code></p> <pre><code>public void SetState(int state)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#returntoidle","title":"ReturnToIdle","text":"<p>Set the animstate to <code>basestate</code></p> <pre><code>public void ReturnToIdle()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#extraanimplay","title":"ExtraAnimPlay","text":"<p>If <code>extraanims</code> is present and not empty, either play an animation named <code>arg</code> to all the <code>extraanims</code> or play a specific one for each by having <code>arg</code> contain all the animation clip names separated by <code>,</code>. If the later is done, <code>arg</code> split by <code>,</code> MUST contain at least the amount of <code>extraanims</code> or an exception will be thrown.</p> <pre><code>public void ExtraAnimPlay(string arg)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#specialanimation","title":"SpecialAnimation","text":"<p>Plays a specific animation routine named <code>animation</code> case insensitive with the call stored in <code>specialanim</code> (turns to null on return). This only supports one named <code>levelup</code> that will set specific routines for the <code>Bee</code>, <code>Beetle</code> and <code>Moth</code> AnimIDs. Before the animation plays, <code>overrideanim</code> is set to true and <code>overridejump</code> is set to true with the old value saved. Once the animation is done, a frame is yielded, <code>overrideanim</code> goes back to false and <code>overridejump</code> is restored to its old value.</p> <pre><code>public IEnumerator SpecialAnimation(string animation)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#animator-change","title":"Animator change","text":"<p>Sets the runtimeAnimatorController of <code>anim</code> depending on the AnimIDs with special handling for PUSHROCK and Hard Mode equipped on HARDEST. More details is at SetAnimator</p> <pre><code>public void SetAnimator()\n</code></pre> <p>Wraps SetAnimator by first ensuring <code>anim</code> is created if it wasn't and calls UpdateAnimSpecific after the call.</p> <pre><code>public void ForceAnimator()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#animation-event","title":"Animation event","text":"<p>These methods are never called directly, but rather by an animation event. </p> <p>This one only applies only to the <code>CordycepsAnt</code> AnimID where for <code>chance</code> % change when called, it will play the animation <code>Idle0</code> or <code>Idle1</code> with a 50/50 chance.</p> <pre><code>private void RandomAnimationEvent(int chance)\n</code></pre> <p>This only applies to <code>Bee</code> AnimID and the <code>BattleIdle</code> animstate. It will play the ParticleSystem on <code>animspecific</code> at index <code>index</code> if either are present after setting the angles of the <code>animspecific</code> object according to <code>flip</code></p> <pre><code>public void PlayAnimSpecific(int index)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#rigid-and-ccol-management","title":"Rigid and ccol management","text":"<p>These methods manages physics with the <code>rigid</code> and <code>ccol</code> fields.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#enablecol","title":"EnableCol","text":"<p>Enables the <code>ccol</code></p> <pre><code>public void EnableCol()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#setfixed","title":"SetFixed","text":"<p>Apply most of the <code>Fixed</code> Modifiers after <code>fixedentity</code> is set to true on Start</p> <pre><code>private void SetFixed()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#setfixedcollider","title":"SetFixedCollider","text":"<p>Apply most of the <code>FxdCol</code> Modifiers after <code>fixedentity</code> is set to true on Start</p> <pre><code>private void SetFixedCollider()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#lockrigid","title":"LockRigid","text":"<p>Either locks the <code>rigid</code> when <code>value</code> is true by making it kinematic without gravity or unlock it when <code>value</code> is false by enabling its gravity without kinematic. This also zeros out the velocity if <code>resetvelocity</code> is true for either operations.</p> <pre><code>public void LockRigid(bool value)\n</code></pre> <pre><code>public void LockRigid(bool value, bool resetvelocity)\n</code></pre> <p>The default value for <code>resetvelocity</code> is true.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#latevelocity","title":"LateVelocity","text":"<p>Yield until <code>rigid</code> isn't null anymore and then set its velocity to <code>ammount</code></p> <pre><code>public IEnumerator LateVelocity(Vector3 ammount)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#unfix","title":"Unfix","text":"<p>If the proper conditions are met or <code>force</code> is true, SetFixed and SetFixedCollider are undone by calling LockRigid(false, false), enabling the <code>ccol</code>, setting the  <code>rigid</code> constraint to <code>FreezeRotation</code> and setting <code>fixedentity</code> to false.</p> <pre><code>public void Unfix()\n</code></pre> <pre><code>public void Unfix(bool force)\n</code></pre> <p>The default value of <code>force</code> is false.</p> <p>If <code>force</code> is false, the method only act if there is no <code>npcdata</code> and if there is one, it must not be a type Object or SemiNPC and its <code>interacttype</code> must not be CaravanBadge or Shop.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#detector","title":"Detector","text":"<p>These methods involves the <code>detect</code> and <code>feet</code> object which are ways to detect walls and grounds around the entity.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#createdetector","title":"CreateDetector","text":"<p>Creates and add <code>detect</code>, a RayDetector on a trigger box collider with size <code>size</code> and center <code>center</code> that detects walls and other entities. The result is maintained in <code>hitwall</code>.</p> <pre><code>public void CreateDetector()\n</code></pre> <pre><code>public void CreateDetector(Vector3 size, Vector3 center)\n</code></pre> <p>The default <code>size</code> is (0.8, 0.7, 0.15) and the default <code>center</code> is (0.0, 0.5, 0.5)</p> <p>The detector only detects collisions with objects in the layers Ground, NoDigGround and Entity. Once a collision is detected, <code>hitwall</code> turns to true until the collision has been exited when it goes back to false.</p> <p>There is one exception to this rule. If the entity is the player, the animstate isn't 116 and there is a raycast hit from the detector forward with a max distance of 1.0 unit (using the same layers as filter), then the normal of the hitpoint must not have 95% or more of its direction be in any of the 3 axises. If this isn't the case, <code>hitwall</code> is set to false instead.</p> <p>It should be noted that because of the detector being slightly next to the <code>ccol</code> under normal gameplay, it is possible to miss detection of thin wall colliders due to the detector rendering past the wall.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#createfeet","title":"CreateFeet","text":"<p>Create the <code>feet</code>, a GroundDetector with an octogon shaped trigger collider loaded from the <code>Prefabs/GroundDetector</code> prefab from the root of the asset tree that will detect the presence of grounds and maintain the result in <code>onground</code>.</p> <pre><code>public void CreateFeet()\n</code></pre> <p>The collider is configured to be at a local position of zero and a 0.1 vertical scale (the x and z ones are each set to <code>ccol</code>.radius * 2 - 0.25). This makes the collider very thin and positioned under the entity.</p> <p>The collider detects any objects in layers Ground and NoDigGround. A collision causes <code>onground</code> to turn to true until its exit which makes it revert back to <code>false</code>. The detector also manages the ability to dig depending on which of the 2 layers collided. Additionally, the detector can handle special cases where the collider has the tag <code>PushPlatform</code>, <code>Platform</code> and <code>PlatformNoClock</code>. Finally, it also handles the smoke and sound effects being played when a PushRock lands.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#hasgroundahead","title":"HasGroundAhead","text":"<p>Perform a Raycast downward starting from <code>point</code> with max distance <code>checkdistance</code> with layers Ground and NoDigGround and return whether there was a hit</p> <pre><code>public bool HasGroundAhead()\n</code></pre> <pre><code>public bool HasGroundAhead(Vector3 point, float checkdistance)\n</code></pre> <p>The default value of <code>point</code> is <code>transform</code>.position + <code>detect</code>.transform.forward.normalized * 2.0 + Vector3.up / 2.0 and the default value of <code>checkdistance</code> is 5.0.</p> <p>This overload will additionally call CreateDetector if <code>detect</code> doesn't exist and have <code>detect</code> look at <code>target</code> before calling the parameterless overload.</p> <pre><code>public bool HasGroundAhead(Vector3 target)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#detectdirection","title":"DetectDirection","text":"<p>Call CreateDetector if <code>detect</code> doesn't exist, make <code>detect</code> look at <code>targetp</code> and zero out the x and z angles.</p> <pre><code>public void DetectDirection(Vector3 targetp)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#forcehitwall","title":"ForceHitWall","text":"<p>Set <code>hitwall</code> to true which forces <code>detect</code> to report a hit.</p> <pre><code>public void ForceHitWall()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#detectignoresphere","title":"DetectIgnoreSphere","text":"<p>Have <code>detect</code> ignore collisions every laoded NPCControl's <code>scol</code>.</p> <pre><code>public void DetectIgnoreSphere(bool ignore)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#structural-additions","title":"Structural additions","text":"<p>These methods manages diverse object hierarchy extensions.</p> <p>Create <code>bubbleshield</code> if it didn't exist as an instance of <code>Prefabs/Objects/BubbleShield</code> from the root of the asset tree with a DialogueAnim that starts out shrunk with a shrink speed of 0.075 and a targetscale of (1.8, 3.15, 1.0).</p> <pre><code>public void CreateShield()\n</code></pre> <p>The starting scale is zero with a local position of (0.0, 1.25, 0.0), The material's color is set to pure white with 55% alpha and a renderQueue of 2505.</p> <p>Create <code>line</code> which is a LineRenderer starting from <code>start</code> to <code>end</code> with width <code>width</code> on both ends with a color of <code>color</code> on both ends and a parent of <code>parent</code> (the object is not childed to anyone if <code>parent</code> is null).</p> <pre><code>public void CreateLine(Vector3 start, Vector3 end, float width, Color color, Transform parent)\n</code></pre> <p>The material of <code>line</code> is set to the spritemat</p> <p>Returns the element of <code>extra</code> at index <code>id</code> if <code>anim</code> is false or the element of <code>extraasnims</code> at index <code>id</code> if <code>anim</code> is true</p> <pre><code>public GameObject GetExtras(int id, bool anim)\n</code></pre> <p>Create the <code>shadow</code> object which is a SpriteRenderer and initialises <code>shadowtransform</code> to its transform. The object will initially be rendered offscreen with sprite set to shadowsprite with a color of pure white with 40% alpha and a renderQueue of 2900.</p> <pre><code>public void CreateShadow()\n</code></pre> <p>Create <code>model</code> from an instance of <code>path</code> from the root of the ressources tree at local position <code>offset</code>. This sets <code>anim</code> to the <code>model</code>'s animator if it is present and it also handles <code>hologram</code> and <code>cotunknown</code> by changing the materials and colors of all the children SpriteRenderer, SkinnedMeshRenderer and MeshRenderer recursively.</p> <pre><code>public void AddModel(string path, Vector3 offset)\n</code></pre> <p>Creates the <code>hpbar</code> and <code>defstat</code> which are UI objects positioned underneath the entity that reports HP and Defense numbers.</p> <pre><code>public void CreateHPBar()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#colliders-ignoring","title":"Colliders ignoring","text":"<p>These methods allows to ignore collisions with entities or other colliders.</p> <p>Have every collider under <code>a</code> recursive ignore every collider under <code>b</code> recursive if <code>ignore</code> is true or unignore them if it is false.</p> <pre><code>public static void IgnoreColliders(EntityControl a, EntityControl b, bool ignore)\n</code></pre> <p>Have every collider under <code>a</code> recursive ignore <code>b</code> if <code>ignore</code> is true or unignore if it is false.</p> <pre><code>public static void IgnoreColliders(EntityControl a, Collider b, bool ignore)\n</code></pre> <p>Have <code>ccol</code> and <code>detect</code> ignore collisions with <code>c</code> immediately until <code>sectime</code> seconds has passed at which point, all collisions that were ignored are unignored.</p> <pre><code>public IEnumerator TempIgnoreColision(Collider c, float sectime)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#emoticon","title":"Emoticon","text":"<p>These methods manages <code>emoticon</code> which is a UI object that renders on top of the entity to indicate possible interactions.</p> <p>Set <code>emoticonid</code> to <code>emote</code> - 1 and <code>emoticoncooldown</code> to <code>time</code> before calling UpdateEmoticon which will show <code>emote</code> for <code>time</code> frames.</p> <pre><code>public void Emoticon(MainManager.Emoticons emote)\n</code></pre> <pre><code>public void Emoticon(MainManager.Emoticons emote, int time)\n</code></pre> <pre><code>public void Emoticon(int type, int time)\n</code></pre> <p>The first 2 overloads calls the third one which does all the work.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#overrides","title":"Overrides","text":"<p>These methods manages the overrides fields which are fields to bypass normal behaviors in many places notably during the update cycle.</p> <p>Set <code>overrideanim</code> to <code>animation</code>, <code>overrridejump</code> to <code>jumpanimation</code>, <code>overrideflip</code> to <code>flipbehavior</code>, <code>overridefly</code> to <code>flyanimation</code>, <code>overrideonlyflip</code> to <code>onlyflip</code> and <code>overrideanimspeed</code> to <code>animationspeed</code>.</p> <pre><code>public void SetOverrides(bool animation, bool jumpanimation, bool flipbehavior, bool onlyflip, bool flyanimation, bool animationspeed)\n</code></pre> <p>Calls SetOverrides with every parameter being false</p> <pre><code>public void ResetOverrides()\n</code></pre> <p>Set <code>overreidejump</code> to true immediately before yielding for 0.5 seconds, then yield frames until <code>onground</code> is false, then yield 0.5 seconds before finally setting <code>overrridejump</code> back to false.</p> <pre><code>public IEnumerator OverrideJumpTemp()\n</code></pre> <p>Set <code>overrideanim</code> to false and animstate to <code>basestate</code>.</p> <pre><code>public void OverrideOver()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#death-and-revival","title":"Death and revival","text":"<p>These methods manages the concept of death and revival of an entity.</p> <p>Starts the parameterless Death coroutine and store its result into <code>deathcoroutine</code></p> <pre><code>public void StartDeath()\n</code></pre> <p>Starts Death with <code>activatekill</code> to true storing the result into <code>deathcoroutine</code>.</p> <pre><code>public IEnumerator Death()\n</code></pre> <p>Perform the death process of the entity setting <code>iskill</code> to <code>activatekill</code> at the end. More details at Death.</p> <pre><code>public IEnumerator Death(bool activatekill)\n</code></pre> <p>Revive an entity making it active again and undo its death.</p> <pre><code>public void Revive()\n</code></pre> <p>Specifically, this sets <code>iskill</code>, <code>dead</code> and <code>nocondition</code> to false as well as stop <code>deathcoroutine</code> if one was running. Then, LockRigid(false) is called with the <code>ccol</code> getting enabled with the center being set to <code>initialcenter</code> and its height/radius to the ones in <code>initialcolliderdata</code>. The world position of the entity is set to <code>startpos</code> + (0.0, 0.25, 0.0) with zero angles and <code>spin</code>. Finally, SetOverrides is called with all parameters to false which resets all overrides.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#height-adjustments","title":"Height adjustments","text":"<p>These method manages <code>height</code>, the visual offset of the entity's <code>sprite</code> from its <code>transform</code>'s origin.</p> <p>Set <code>height</code> to <code>h</code>, <code>bobrange</code> to <code>range</code> and <code>bobspeed</code> to <code>spd</code> which will make be taken into effect on the next UpdateHeight.</p> <pre><code>public void SetHeight(float h, float range, float spd)\n</code></pre> <p>Smoothly sets the <code>height</code> to <code>newhight</code> over the course of <code>frametime</code>.</p> <pre><code>public IEnumerator GradualHeight(float frametime)\n</code></pre> <pre><code>public IEnumerator GradualHeight(float newheight, float frametime)\n</code></pre> <p>The default value of <code>newheight</code> is <code>initialheight</code>.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#ice-cube-handling","title":"Ice cube handling","text":"<p>These 2 methods setups the entity to be frozen in an ice cube and allows it to break it when it is no longer frozen. More details at Freeze handling</p> <pre><code>public void Freeze()\n</code></pre> <pre><code>public void BreakIce()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#digging","title":"Digging","text":"<p>Have the entity instantly dig underground without the first <code>digpart</code> by setting <code>digging</code> and <code>instdig</code> to true and <code>digtime</code> to 31.0.</p> <pre><code>public void InstantDig()\n</code></pre> <p>While the <code>spritetransform</code> scale's magnitude isn't 0.9 or higher, call ReturnFromAction and yield for a frame.</p> <pre><code>public IEnumerator StopDig()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#follow","title":"Follow","text":"<p>More details at Follow</p> <pre><code>private void Follow()\n</code></pre> <p>More details at Follow</p> <pre><code>private void DoFollow()\n</code></pre> <p>Special logic to determine if the entity should follow <code>following</code> twice as close than usual.</p> <pre><code>private bool CloseMove()\n</code></pre> <p>Special movement logic for followers when the player is shielding.</p> <pre><code>private void ShieldMove(bool tempf)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#sprite-effects","title":"Sprite effects","text":"<p>These methods perform shaking and fading on the sprite.</p> <p>For each <code>frametimer</code> frames, set the <code>spritetransform</code> local position to a random position between -<code>intensity</code> and <code>intensity</code> and restoring the position it had beforehand when <code>frametimer</code> frames elapsed.</p> <pre><code>public IEnumerator ShakeSprite(Vector3 intensity, float frametimer)\n</code></pre> <p>Calls the above overload where <code>frametimer</code> is passed through and the Vector3 <code>intensity</code> is a vector where each component is the float <code>intensity</code></p> <pre><code>public IEnumerator ShakeSprite(float intensity, float frametimer)\n</code></pre> <p>Fade the <code>sprite</code> over <code>frametime</code> frames then yield a frame and if <code>destroy</code> is true, the entity is destroyed after this yield.</p> <pre><code>public IEnumerator FadeSprite(float frametime, bool destroy)\n</code></pre> <p>If <code>destroy</code> is true, this also calls LockRigid(true) and disables the <code>npcdata</code> if it was present after the fade is complete, but before the frame yield.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#condition-icons","title":"Condition icons","text":"<p>These methods manages the conditions icons which are UI elements that reports details and presence of battle conditions.</p> <p>Calls DestroyConditionIcons and then update <code>statusicons</code> and initialise <code>statusid</code> to 0 and the <code>statuscooldown</code> to 60.0 according to <code>data</code> positioned 0.5 units to the left of the <code>data.cursoroffset.x</code> if <code>right</code> is false or 0.5 units to the right if it is true.</p> <pre><code>public void UpdateConditionBubbles(bool right, MainManager.BattleData data)\n</code></pre> <p>This includes setting up the sprites of every conditions and medals icons during battle. The text inside these icons includes SetText calls. The method calls this one internally if <code>isplayer</code> with the player specific conditions and medals icons. TODO: Add more details</p> <pre><code>private Transform NewConditionIcon(Sprite csprite, Vector3 pos)\n</code></pre> <p>The icons are cycled by the help of UpdateStatusIcons.</p> <p>If <code>statusicons</code> is present and not empty, every non null element is destroyed. <code>statusicons</code> is set to null once done.</p> <pre><code>public void DestroyConditionIcons()\n</code></pre> <p>This is called by MainManager.RemoveCondition. It determines the player or enemy asleep and numb status using MainManager.HasCondition. This method is very specific to RemoveCondition.</p> <pre><code>public void RefreshCondition()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#late-transform","title":"Late transform","text":"<p>Set the <code>latetrans</code> to null</p> <pre><code>public void StopLate()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#cave-of-trials","title":"Cave of Trials","text":"<p>These methods manages materials and colors specific to the Cave of Trials when <code>cotunknown</code> is true</p> <p>If <code>cotunknown</code> is true, set <code>spritebasecolor</code> to pure black fully opaque and if <code>extras</code> is present and non empty, <code>refreshedcotu</code> is set to true and all renderer and sprite render of every <code>extras</code> has they color set to pure black (half transparent for a renderer and fully opaque for sprite renderer).</p> <pre><code>public void RefreshCOT()\n</code></pre> <p>Set <code>spritebasecolor</code>, <code>sprite</code>'s color and the <code>sprite</code>'s material color to pure black fully opaque befoe calling RefreshCOT</p> <pre><code>public void ForceCOT()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#dialogue-bleep","title":"Dialogue bleep","text":"<p>If an <code>endata</code> for the AnimID <code>animid</code> exists, set <code>dialoguebleepid</code> and <code>bleeppitch</code> from it unless <code>originalid</code> is -1 or below (None) in which case, they are set to 0 and 1.0 respectively.</p> <pre><code>public void SetDialogueBleep()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#drop","title":"Drop","text":"<p>More details at Drop, this is a coroutine needed during battle to drop an airborne enemy.</p> <pre><code>public IEnumerator Drop()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#scale-change","title":"Scale change","text":"<p>Scales the entity to <code>target</code> smoothly over <code>frametime</code> frames. If <code>force</code> is false, <code>startscale</code> is what changes and if it's true, it's the <code>rotater</code>'s scale which makes it scale immediately without needing the handling of UpdateFlip.</p> <pre><code>public IEnumerator ChangeScale(Vector3 target, float frametime, bool force)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#trail","title":"Trail","text":"<p>Reset the trail managed by RefreshTrail. More information can be found there.</p> <pre><code>public void ResetTrail()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#numb","title":"Numb","text":"<p>A part of LateUpdate that handles logic related to the numb animation. More details available there.</p> <pre><code>private void Numb()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#return-from-action","title":"Return from action","text":"<p>This is a special procedure performed during StopDig and Follow after an action was performed to restore the entity behavior.</p> <pre><code>private void ReturnFromAction()\n</code></pre> <p>This first enables <code>shadow</code> if it wasn't. The, the <code>ccol</code> is enabled, the <code>rigid</code>'s isKinematic is set to false with gravity enabled, the <code>spritetransform</code>'s scale is set to a lerp between the current one and Vector3.one with a factor of 0.1 and set <code>spin</code> to zero if the switchcooldown expired. Finally, the fields <code>overrridejump</code>, <code>overrideanim</code> and <code>leiffly</code> are set to false.</p>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#check-near","title":"Check NEAR","text":"<p>If the <code>NEAR</code> Modifiers is present, this will destroy the entity if it is further away than 30.0 units from the player.</p> <pre><code>public void CheckNear()\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#miscellaneous","title":"Miscellaneous","text":"<p>Returns true only if the entity has the <code>Follower</code>, <code>NPC</code>, <code>Enemy</code>, <code>PFollower</code> tag or <code>isplayer</code> or there is no <code>npcdata</code> or there is one being a PushRock or Item.</p> <pre><code>private bool CheckForCharacterEntity()\n</code></pre> <p>Sets the color of the Chompy's ribbon (stored in <code>extrasprites</code> 0) depending on flag 56 (the Items id equipped to Chompy)</p> <pre><code>public void ChompyRibbon()\n</code></pre> <p>This is the special animation routine for Zasp. He will disappear with <code>appear</code> being false and appear if it is true</p> <pre><code>public IEnumerator ZaspWarp(bool appear)\n</code></pre> <p>Sets the world position of the entity to <code>pos</code>, yield for a frame and call the other overload passing <code>appear</code> storing the call into <code>specialanim</code> and then yield for a frame.</p> <pre><code>public IEnumerator ZaspWarp(bool appear, Vector3 pos)\n</code></pre> <p>This is the special animation for a NPCControl of JumpSpring. The animation will mess with the <code>spritetransform</code> scale using the <code>squashammount</code> scale factor with the <code>squashspeed</code> multiplier over the course of <code>time</code> frames. If <code>gradual</code> is true, the <code>squashspeed</code> decreases over time.</p> <pre><code>public IEnumerator BounceAnim(float squashammount, float time, float squashspeed, bool gradual)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl%20Methods/#unused","title":"Unused","text":"<p>These methods aren't called by anyone, but they still exists.</p> <pre><code>public void ActivateDefenseTap(float ammount)\n</code></pre> <pre><code>private void LateGround()\n</code></pre> <pre><code>public void SetLate(Transform obj, Vector3 pos)\n</code></pre> <pre><code>public void FlipValue(float right)\n</code></pre> <pre><code>public void ChangeAnimIfNotBattle(float id)\n</code></pre> <pre><code>public IEnumerator LateVelocity(Vector3 ammount, float delay)\n</code></pre> <pre><code>public IEnumerator LateVelocity(Vector3 ammount, float delay, float onlyifmagnitude, bool ignorey)\n</code></pre> <p>This one is called by the one above which makes it unused too</p> <pre><code>public IEnumerator LateVelocity(Vector3 ammount, float delay, float onlyifmagnitude, bool ignorey, int continuous)\n</code></pre>"},{"location":"Entities/EntityControl/EntityControl/","title":"EntityControl","text":"<p>EntityControl is the base component that all Entity must have to be considered one. It mostly offers many capabilities and shared behaviors with a common lifecycle. Any NPCControl must also be an EntityControl which is accessed through the <code>entity</code> field.</p> <p>For consulting the creation process of this component, check EntityControl Creation.</p> <p>For consulting the fields of this component, check EntityControl Fields.</p> <p>For consulting the methods of this component, check EntityControl Methods.</p>"},{"location":"Entities/EntityControl/Item%20entity/","title":"Item entity","text":"<p>An item entity is an entity that has its <code>item</code> field set to true. It completely changes the rendering and updates of that entity.</p> <p>The summary as far as the fields are concerned:</p> <ul> <li><code>item</code> is true</li> <li><code>animid</code> is the item type, not an animid</li> <li><code>animstate</code> and <code>itemstate</code> are both the item id, the former is not an animstate and the latter is assigned on Start and is used in UpdateItem</li> </ul> <p>Additionally, UpdateItem is now part of the update process of this entity.</p>"},{"location":"Entities/EntityControl/Item%20entity/#item-types","title":"Item types","text":"<p>The following is the values <code>animid</code> can have when we are dealing with an <code>item</code> entity. The value also dictates what <code>animstate</code> and <code>itemstate</code> mean.</p> Value <code>itemstate</code> meaning Description 0 An item id Standard item 1 An item id Key item 2 A medal id Medal 3 A crystalbfflag id Cystal Berry"},{"location":"Entities/EntityControl/Item%20entity/#how-updateitem-works","title":"How UpdateItem works","text":"<p>In practice, both the <code>itemstate</code> should always have the same value than the <code>animstate</code> because on Start, this is enforced by setting <code>itemstate</code> to <code>animstate</code> when <code>item</code> is true. On several (but not all) occasions, the caller also sets the <code>basestate</code> to the same value. This is relatively safe because it prevents the entity <code>animstate</code> to revert to the to default <code>Idle</code> animstate.</p> <p>All of this allows a dedicated update method called UpdateItem to resolve the correct <code>sprite</code> or to disable it in the case of a Crystal Berry (since only a model is rendered).</p>"},{"location":"Entities/EntityControl/Item%20entity/#additional-effects","title":"Additional effects","text":"<p>Item entities have their own special logic outside of EntityControl. This section will detail them.</p>"},{"location":"Entities/EntityControl/Item%20entity/#mainmanagerrefreshentities","title":"MainManager.RefreshEntities","text":"<p>All item entities gets UpdateItem called on them.</p>"},{"location":"Entities/EntityControl/Item%20entity/#mainmanagerfixentities","title":"MainManager.FixEntities","text":"<p>Item entities are exempt from the logic of this method which mean they don't get fixed in place.</p>"},{"location":"Entities/EntityControl/Item%20entity/#hazardsontriggerenter","title":"Hazards.OnTriggerEnter","text":"<p>If the other entity has no <code>npcdata</code> or there's one, but its <code>beerang</code> is null (it's not caught in the player beemerang) while <code>animid</code> is above 0 (it's not a standard item) or <code>animstate</code> isn't 6 or 7 (<code>MoneySmall</code> or <code>MoneyMedium</code>), ReturnEntity is called. NOTE: this doesn't exclude <code>MoneyBig</code> which seems like a bug as it can cause the destruction of the item when it wasn't intended.</p>"},{"location":"Entities/EntityControl/Modifiers/","title":"Modifiers","text":"<p>Modifiers are special piece of text that when present in the name of an Entity, it will alter its behavior. While most will apply when the modifier is contained in the name, some expect them to prefix the actual name so it is recommended to prefix them rather than putting them in the middle. It is possible to combine them. All of them are case sensitive.</p> <p>Here are all the modifiers that are known:</p> Modifier Description Holo Sets <code>hologram</code> to true on Start which makes the entity rendered as a hologram TIME Sets <code>extratimer</code> to true on Start which doubles the time before the forcemove failsafe triggers COT Sets <code>hologram</code> and <code>cotunknown</code> to true which makes the entity rendered as a hologram in silhouette. This also calls RefreshCOT in 0.1 seconds which will set the materials of the extras accordingly to cot while setting <code>refreshedcotu</code> to true ShwKEY Sets <code>showitem</code> to true on Start if the entity has an <code>npcdata</code> which renders a key item on top of the entity (defined in npcdata's data) ICE Sets the npcdata's <code>extrafreeze</code> to true on Start if the entity has an npcdata Fixed Sets <code>fixedentity</code> to true on Start and calls SetFixed in 0.1 seconds which will completely lockup the rigid (including disabling gravity, making it kinematic and resetting the velocity to zero), disable the ccol and force the position to be startpos FxdCol A lighter version of Fixed which does everything it does except without disabling the ccol so it stays enabled ALW Sets <code>alwaysactive</code> to true on Start which forces <code>incamera</code> to true and the entity remains active even out of the camera's range ALF Sets <code>alwaysflip</code> to true on Start which calls UpdateFlip every LateUpdate PAU Sets <code>activeonpause</code> to true on Start which allows the entity to receive updates and late updates on pause, minipause, message lock and being dead HIDE Sets <code>hideinside</code> to true on Start ROT LateAngle is called on CreateEntities in 0.25 seconds to set the angle instead of setting it direction. It also sets <code>lockrotater</code> to true on Start which locks the y angle of the rotater. ShwEm Sets <code>alwaysemoticon</code> to true on Start COG Sets <code>startpos</code> to the point a raycast will hit from the transform heading down on Start NGS Sets <code>onground</code> to false which forces the GroundDetector to report the entity being in the air on Start NGF If this has an <code>npcdata</code> of type Enemy and it is cleared for being enabled on its Start, the GravityFix coroutine is called at the end of its Start (this does nothing otherwise) ITHD Calls npcdata's SetHitInteract with HornDash on Start if the entity has an npcdata ITAH Calls npcdata's SetHitInteract with AnyHorn on Start if the entity has an npcdata NEAR When CheckNear is called, the entity is destroyed if it is further away than 30.0 units from the player NDTCT HasHiddenItem always returns false making this entity never trigger the Detector medal if the player has it equipped DDIST HasHiddenItem always returns false if the distance between this entity and the player is 20.0 or above making this entity never trigger the Detector medal if the player has it equipped TOD Allows a Switch NPCControl object to be toggleable if its <code>data[0]</code> is 1 and <code>data[1]</code> is negative instead of only being able to be turned on"},{"location":"Entities/EntityControl/Start/","title":"Start","text":"<p>EntityControl defines a Start Unity event which performs several important steps. This will be run at the start of the next frame after the creation occurred, but also after being enabled if the entity started disabled:</p> <ul> <li>Ensure <code>transofrm</code> and <code>spritetransform</code> are set correctly</li> <li>Ensure <code>icecubeprefab</code> is set to the <code>Prefabs/Objects/icecube</code> object from the root of the asset tree and set the object's layer to 13 (<code>NoDigGround</code>)</li> <li>Add a RigidBody component assigned to <code>rigid</code> with the constraints set to freeze rotations</li> <li>Add an Animator component assigned to <code>anim</code></li> <li>Initialise <code>digpart</code> to an array of 2 new game objects</li> <li>Assign the <code>rotater</code> created earlier by getting the first child of the root</li> <li>Apply the <code>Holo</code>, <code>TIME</code> and <code>COT</code> Modifiers logic as well as <code>ShwKEY</code> and <code>ICE</code> if this entity has an <code>npcdata</code>'s NPCControl</li> <li>Set the sprite's material to the game's sprite material or the hologram one depending on the value of <code>hologram</code></li> <li>Set the sprite's object's layer to 14 (<code>Sprite</code>)</li> <li>Set the sprite to receive shadows</li> <li>Ensure there's a CapsuleCollider assigned to <code>ccol</code> and set it's material to the game's default physics material</li> <li>Set <code>initialcenter</code> to the <code>ccol</code>'s center and <code>initialcolliderdata</code> to (<code>ccol</code>'s height, <code>ccol</code>'s radius)</li> <li>If the current map is MetalLake, set <code>overridemovesmoke</code> to true. If the map's <code>icemap</code> is true, then <code>inice</code> is set to true</li> <li>Ensure <code>startpos</code> is set to the transform's position</li> <li>Set <code>spawnpoint</code> to the transform's position</li> <li>Unless <code>noemoticon</code> is set to true, setup the <code>emoticon</code> object which is a new object with an Animator named <code>Emoticon</code> childed to the <code>rotater</code>, a local position of <code>emoticonoffset</code>, and a layer of 15 (<code>3DUI</code>). Also set <code>emoticonsprite</code> to a new SpriteRenderer added to <code>emoticon</code> and set its material to Unity's default sprite material</li> <li>Ensure an AudioSource is added and assigned to <code>sound</code> without playOnAwake</li> <li>If <code>startvelocity</code> is set, set the <code>rigid</code>'s velocity to it</li> <li>Call CheckSpecialID which loads the EntityValues data</li> <li>Set the entity's bleep. For more information on the bleep system, check bleep. The bleep id and pitch are expected to be set beforehand in <code>dialoguebleepid</code> and <code>bleeppitch</code> respectively.</li> <li>If <code>hasshadow</code> is true, ensure a an object named <code>shadow</code> with a SpriteRenderer is created and assigned to the field of the same name and childed to the entity's transform at (0.0, -999.0, 0.0). The transform of the new object is assigned to <code>shadowtransform</code>. The sprite of the shadow is set to the game's shadow sprite with a color of pure white with 40% transparency. The angles of the object are set to (90.0, 0.0, 0.0) and the material's renderQueue is set to 2900</li> <li>If the entity is an item entity, assign <code>itemstate</code> to the <code>animstate</code></li> <li>Apply the following Modifiers: <code>Fixed</code>, <code>FxdCol</code>, <code>ALW</code>, <code>ALF</code>, <code>PAU</code>, <code>HIDE</code>, <code>ROT</code>, <code>ShwEm</code>, <code>COG</code>, <code>NGS</code> when applicable</li> <li>If the entity has an <code>npcdata</code>, also apply the Modifiers <code>ITHD</code> and <code>ITAH</code> when applicable</li> <li>If we are in a battle and this is the player's entity, ensure <code>bubbleshield</code> is created. This will instantiate the <code>Prefabs/Objects/BubbleShield</code> prefab from the root of the asset tree and add a DialogueAnim component to it which grants it the ability to hide using grow/shrink animations. The object is childed to the <code>rotater</code> and it starts shrunk with the shrink speed set to 0.075 and the targetscale when revealed to (1.0, 3.15, 1.0). The object is initially set to have a scale of 0 and a local position of (0.0, 1.25, 0.0). The Renderer of the new object has its color set to full white with 55% transparency and a renderQueue of 2505</li> <li><code>lastpos</code> is set to the <code>startpos</code> assigned earlier</li> <li><code>initialheight</code> is set to <code>height</code></li> <li>Unless <code>overrideminheight</code> is true, the <code>height</code> is set to <code>minheight</code> if the height was smaller than the minimum</li> <li>Set the sprite's tranform's angles accordingly to whether or not <code>flip</code> is set. If it is, it's rotated 180 degrees on the y axis and if it's not, 0 degrees</li> <li>Set <code>playerentity</code> to true only if the tag of the entity is <code>Player</code> or <code>PFollower</code>.</li> </ul>"},{"location":"Entities/EntityControl/Animations/AnimSpecific/","title":"AnimSpecific","text":"<p>AnimSpecific is a system that allows the game to go beyond its standard conventions of the animstate and to perform more complex animation setup. The system is made of multiple methods that are called at specific points:</p> <ul> <li>UpdateAnimSpecific</li> <li>AnimSpecificQuirks</li> </ul>"},{"location":"Entities/EntityControl/Animations/AnimSpecific/#updateanimspecific","title":"UpdateAnimSpecific","text":"<p>This is a void returning parameterless method on EntityControl that is ran at specific points involving the animstate updating. It can contain logic specific to the entity's AnimIDs which allows to use non standard animations and setup. This method doesn't apply to item entities.</p> <p>It's a more frequently called method because not only it gets called everytime the <code>animid</code>, the animstate changes or during a Freeze handling event, it can be called externally if needed.</p> <p>First, all objects in <code>animspecific</code> are destroyed if any were present. Then, the AnimIDs specific part occurs (only high level details are provided as most of these involve detailed rendering):</p> <ul> <li><code>EverlastingKing</code>: The <code>shadowsize</code> is set to 5.0 if the animstate is 115</li> <li><code>MimicSpider</code>: The <code>OutOfBattle</code> animation parameter is set depending on <code>battle</code>. The <code>shadowsize</code> is set to 3.0 unless the animstate is <code>Idle</code> and <code>Walk</code> in which case, the value is set to 1.75 instead</li> <li><code>Bee</code>: if the animstate is <code>BattleIdle</code>, <code>animspecific</code> is initialised with one element being a <code>Prefabs/AnimSpecific/BeeBIdle</code> from the root of the asset tree. This is her Beemerang animation when idling during battle.</li> <li><code>Watcher</code>: The same than Moth, but before, the second <code>extras</code> is destroyed if present (unless he was underground during the battle) with the <code>bobspeed</code> and <code>bobrange</code> set to their start field counterpart.</li> <li><code>Moth</code>: if the animstate is <code>BattleIdle</code> or <code>PickAction</code>, <code>animspecific</code> is initialised with one element being a <code>Prefabs/AnimSpecific/mothbattlesphere</code>. Either of the 2 animstate determines how it will be positioned (fixed if <code>BattleIdle</code> or with a SpinAround for <code>PickAction</code>)</li> <li><code>Eremi</code>: If the animstate is <code>Happy</code>, the <code>walkstate</code> becomes <code>Chase</code> and the <code>basestate</code> becomes <code>Happy</code></li> <li><code>Tanjerin</code>: The <code>walkstate</code> is overriden to 101 if the animstate was <code>Angry</code> or <code>Surprised</code> and to <code>Walk</code> if it was <code>Idle</code> or <code>Sad</code></li> <li><code>JumpingSpider</code>: Same than Spuder, but before, the bubble's sprite is enabled or disabled depending on the battle's <code>enemydata</code> in <code>battleid</code>'s <code>holditem</code> is higher than -1. This just manage if the item sprite of the bubble should be enabled or not.</li> <li><code>Ruffian</code>: This only applies if the <code>extras</code> have not been initialised. This initialises 4 of them which is his chains (the first 3) and ball (the 4th one). It will then setup them in a specific way such that the first 3 are linked together to the ball. The ball gets a FollowerLite and a ShadowLite. It also considers <code>hologram</code> for the materials.</li> <li><code>Strider</code>: Initialises the <code>extraanims</code> if they weren't already to 4 new elements and the <code>extras</code> to being the second child of the model and have all the children of that be the <code>extraanims</code>. This simply setups the legs and their animator. Finally the only <code>extras</code> gets its scale adjusted on the Z axis to 1.0 unless the animstate is <code>Walk</code> or <code>Chase</code> in which case, the value is 0.5. This creates a constricting effects on his legs when needed</li> <li><code>DeadLanderC</code>: <code>extraanims</code> is initialised to 4 new elements being the second, third, fourth and fifth child of the <code>model</code>. Then, specific animations are played on them depending of the animstate. This essentially manages the legs.</li> <li><code>Scorpion</code>: Same then Spuder, but before, the <code>basestate</code> and <code>walkstate</code> are overridden to 150 and 151 respectively if the current Area is Giant's Lair. This is what makes them look different in that area. </li> <li><code>Spuder</code>, DivingSpider and PeacockSpider: This is a very complex management of the legs. Notably, <code>overridejump</code> is set to false all the time and <code>extraanims</code> is initialised with the legs's animators. This also manages special animation clips to play on the legs.</li> <li><code>Venus</code>: Setup 6 <code>extraanims</code> being all the children of the second child of the <code>model</code> with their speed being set to 1 unless the animstate is 100 or 101 in which case, the value is 0. This simply manages her legs animations</li> <li><code>BeeBot</code>: Ensure its wings's StaticModelAnim are enabled when the <code>icecube</code> isn't present or disabled if it is with fixed angles.</li> <li><code>MotherChomper</code>: <code>extras</code> is initialised if it wasn't already to 1 element containing the second child of the second child of the <code>model</code> which is the ground sprite</li> <li><code>VenusGuardian</code>: This is where the arms information are initialised if <code>extraanims</code> wasn't initialised yet. The <code>extraanims</code> are both arm's animator. It also initializes 4 <code>extras</code> with the first 2 being her leaf wings, the third being the ground and the 4th being the flower canon on her left arm. The ground and flower canon will be enabled or disabled depending on her <code>height</code> and animstate. Finally, this also plays the proper animations on the <code>extraanims</code> depending on her <code>height</code>, animstate and other conditions.</li> <li><code>AngryPlant</code>: The only <code>spinextra</code> is initialised to zero or (0.0, -20.0, 0.0) if the <code>height</code> is higher than 0.1. This also sets the only <code>extras</code> scale depending on the <code>height</code>.</li> <li><code>Seedling</code>: If the animstate is <code>Hurt</code> when it had a copter with the <code>height</code> above 0.1, it will be deparented while the object will fly offscreen at the top using a LerpObject coroutine</li> </ul>"},{"location":"Entities/EntityControl/Animations/AnimSpecific/#animspecificquirks","title":"AnimSpecificQuirks","text":"<p>This is a void returning parameterless method on EntityControl that is ran on LateUpdate before UpdateSprite and on UpdateSprite itself if the animstate or the <code>inice</code> changed. This is more a way to adjust the animation for a specific AnimIDs so it can have custom logic to it. It can be seen as an update method because it handles the adjustements of the extra fields such as <code>extras</code>, <code>spinextra</code>, <code>extralines</code> and <code>extrasprites</code>, but it also allows specific AnimIDs to have their own update logic. Unlike the other anim specific update method, this is only called internally during the normal update cycle.</p> <p>Here are all the specific update logic defined (only described at a high level since most of it is rendering specific):</p> <ul> <li><code>ChompyChan</code>: <code>extrasprites</code> is ensured to have one SpriteRender and it is enabled depending on the value of flags 404 (Chompy has a ribbon on her). Then, <code>ChompyRibbon</code> is called which only sets the proper color of the sprite depending on which ribbon is in flagvar 56 (The Items id of the ribbon equipped on her).</li> <li><code>JumpingSpider</code>: If the animstate is <code>Chase</code>, the <code>walktype</code> is set to Jump and to Normal otherwise</li> <li><code>SeedlingKing</code>: Unless the <code>subentity</code> weren't inialised yet, override each's animstate to <code>Hurt</code> if the entity's animstate is <code>Hurt</code> or to <code>Chase</code> otherwise.</li> <li><code>Watcher</code>: <code>overrideshadow</code> is set to <code>digging</code> and the <code>shadow</code>'s enabled to the inverse of <code>digging</code>. Then, nothing happens if the <code>extras</code> (containing his book) weren't initialized yet, but if they are, the local position of the only one is updated on the y with a Lerp between the current y and a vector determined by the <code>spritetransform</code> local position, the animstate and if <code>digging</code> was true or not. This lerp is done with a factor of 0.1. The whole thing essentially just renders the book with a floating effect unless he is <code>digging</code>.</li> <li><code>BeeBot</code>: This only applies if the entity is <code>dead</code> or in the process of dying (<code>iskill</code> or <code>deatcoroutine</code> not being null). When it does, the animation <code>Idle2</code> or <code>Hurt2</code> is played depending on the current form of the entity which is determined either by the current battle data if it's a <code>battle</code> entity or the animstate if it's not.</li> <li><code>Krawler</code> and <code>CursedSkull</code>: Only applies when <code>inice</code> has changed (tracked by <code>lastice</code>) and the <code>npcdata</code> if present doesn't have an enabled <code>disguiseobj</code>. This will play the <code>IceShatter</code> particle and also control whether the first extras's ParticleSystem should play when <code>inice</code> is true or stop otherwise.</li> <li><code>MotherChomper</code>: the first <code>extras</code> if it exist has its angle set to zero which is the ground object</li> <li><code>VenusGuardian</code>: Only applies when <code>extras</code> has been initialised. If it was, the third <code>extras</code>'s angles (which is the ground object) is set to zero and the first 2 (her leaf wings) have their angles adjusted to a sin curve on the x axis if the <code>height</code> is higher than 0.1 and there's no <code>icecube</code>.</li> <li><code>Scarlet</code>: The <code>shadowsize</code> is set to 2.5 unless the animstate is among specific values which will cause the value to be set to 1.25 instead.</li> <li><code>Zasp</code>: The <code>shadowsize</code> is set to 1.0 unless the animstate is among specific values which will cause the value to be set to 1.5 or 1.75 instead depending on the animstate</li> <li><code>ShielderAnt</code>: The <code>shadowsize</code> is set to 1.0 unless the animstate is <code>KO</code> which causes the value to be set to 2.0 instead.</li> <li><code>Seedling</code>: This manages the <code>copter</code> sprite if applicable which is where the <code>height</code> is above 0.1 among other conditions. It initialises the <code>extras</code> if it wasn't already with one element being that sprite and it also initialises <code>spinextra</code> to 20.0 units on the z axis. This finally adjusts the <code>bobspeed</code> and <code>bobrange</code> to 2.0 and 4.0 respectively if they were lower than 0.1 (this also assign the start field counterpart to the new value)</li> <li><code>Flowering</code>: Same then Seedling, but before, the only <code>extras</code> is activated if <code>flyinganim</code> and the animstate is a animstate &gt; Extra animations, it is disabled otherwise</li> <li><code>UltimaxTank</code>: The <code>extras</code> initialised first if they weren't already. The first 3 extras are the wheels, the 4th is the body object (the one above the wheels) and the 5th is the missile launchers. Then, their position and angles are adjusted depending on the animstate</li> <li><code>MidgeBroodmother</code>: This only applies when <code>model</code> is not null. The <code>extras</code> (the wings) are initialised if they weren't already to the children of the first child of the <code>model</code>. From there, their angles are adjusted.</li> <li><code>DeadLanderB</code>: If the <code>extrasprites</code> weren't initialised, this method will initialise them, <code>extralines</code> and <code>spinextra</code>. This essentially manages the balloons and the lines connecting them by setting various properties about them (also considers <code>hologram</code> and <code>cotunknown</code>).</li> <li><code>KeyR</code> and <code>KeyL</code>: The angles are adjusted on the Z axis depending on the animstate and <code>inice</code>.</li> <li><code>Tablet</code>: In battle, the sprite is set depending on if the HP. If the HP is below 3, the <code>startscale</code> is set to Vector3.one * 0.75</li> <li><code>Pitcher</code> and <code>PitcherSummon</code>: This only applies if the <code>extras</code> were intialised. It adjusts the second <code>extras</code>'s position (the end of the next) to the first's position (the head) + the first <code>spinextra</code>.</li> <li><code>Midge</code>: Only applies if the <code>extras</code> were initialised. It manages the position and angles of the wings in <code>extras</code> depending on the specific animstate.</li> </ul> <p>For all entity except <code>DeadLanderB</code>, <code>Pitcher</code> or <code>PitcherSummon</code>, every <code>extras</code>'s angles gets incremented by the <code>spinextra</code> of the corresponding index if it exist.</p>"},{"location":"Entities/EntityControl/Animations/SetAnim/","title":"SetAnim","text":"<p>Animations on entity are setup like a state machine controlled by a single integer: the Entity's animstate. Setting the animstate is requesting the game to change the animation of an entity whenever SetAnim occurs, usually during the entity's LateUpdate. It being on LateUpdate allows coroutines such as SetText to change it and see the render immediately when yielding before the end of the frame.</p> <p>There are 2 overloads of SetAnim, but one only makes the second parameter optional which gives us the following method that end up being used:</p> <pre><code>public void SetAnim(string args, bool force)\n</code></pre> <p>The <code>args</code> parameter is explained in the animstate &gt; Animation arguments section and the <code>force</code> parameter allows to override prechecks that could have the animation not transition. Its default value is false (an override is defined without this parameter).</p> <p>The actual clip that will be played can change under specific conditions. They are (in order):</p> <ul> <li>if <code>inice</code> or <code>hasiceanim</code>, the <code>i</code> argument is appended to <code>args</code></li> <li>The <code>u</code> argument is removed from <code>args</code> if <code>force</code> is true (NOTE: this argument is not used in the game so this effectively does nothing)</li> <li>If the new animstate is 30 (<code>FakeHurt</code>), it is overriden to 11 (<code>Hurt</code>). <ul> <li>On top of this, if <code>flyinganim</code>, the <code>f</code> argument is prepanded to <code>args</code> if it didn't had it already.</li> </ul> </li> </ul> <p>This method is called at specific places (but notably in the entity's LateUpdate) whenever an animstate update is required. In which case, this set the entity's <code>laststate</code> and it will ask Unity to change the animation clips using CrossFadeInFixedTime at the new clip's name with the time being the entity's <code>animspeed</code>. After, UpdateAnimSpecific is called.</p> <p>However, unless <code>force</code> is true, it is possible to not have any of this happen. The conditions to have all of this happen are:</p> <ul> <li>The computed clip's name is the different than the last one in <code>laststate</code> OR</li> <li>The entity is the player (the one with a PlayerControl) OR</li> <li>The entity has the <code>PFollower</code> tag</li> </ul> <p>If none of these are true and <code>force</code> is false, then the method will effectively not do anything.</p>"},{"location":"Entities/EntityControl/Animations/animstate/","title":"Animstate","text":"<p>The animstate of an Entity represents the current animation the entity should be on. It is an integer that allows most animations to be identified by. The system dictates a standard way to operate with animation clips while offering the ability to extend this standard via the AnimSpecific system. This allows to operate in Unity in such a way that the animstate system can track.</p> <p>NOTE: this field means something completely different for an item entity.</p>"},{"location":"Entities/EntityControl/Animations/animstate/#standard-animations","title":"Standard animations","text":"<p>An animation is deemed to be within the standards of the animstate system if an animation clip of an entities's controller is named in a specific way. The name is either a predefined animation name or a number followed by optional letters. The name or number is referred to as the base name while the letters are optional arguments. Let's first explain the base name part.</p>"},{"location":"Entities/EntityControl/Animations/animstate/#standard-animation-clips-base-name","title":"Standard animation clips base name","text":"<p>The base name can be defined in 2 ways: either it is a predefined animation name or an extra animation.</p>"},{"location":"Entities/EntityControl/Animations/animstate/#predefined-animations-names","title":"Predefined animations names","text":"<p>A predefined animation is any animstate below 100 (exclusive). However, while this means 100 animations can in theory predefined, this amount is overprovisioned: only the states ranging from 0 to 32 are valid states. This is because predefined animations are defined in an enum called MainManager.Animations which is defined like the following:</p> Value Name 0 Idle 1 Walk 2 Jump 3 Fall 4 ItemGet 5 Angry 6 Sad 7 Upset 8 Happy 9 Surprised 10 Flustered 11 Hurt 12 Death 13 BattleIdle 14 Sleep 15 Fallen 16 HurtFallen 17 WeakBattleIdle 18 KO 19 PickAction 20 WeakPickAction 21 Woobly 22 HurtWooble 23 Chase 24 Block 25 SleepFallen 26 AirTackle 27 ItemWalk 28 TossItem 29 Sit 30 FakeHurt 31 Dig 32 DigMove <p>The enum name here is important: to define a predefined animations on a given controller, the clip MUST be named by the enum's name, NOT the value. The animstate will hold the value, but it won't load a clip named AS the value, it will load one named as the NAME of the enum value.</p> <p>Because this is enforced by anything that attempts to set the animation, it can be safely assumed that those CAN exists, but they don't all have to. It's more a guarantee by the game that any animstate of 0 corresponds to \"Idle\" for example.</p>"},{"location":"Entities/EntityControl/Animations/animstate/#extra-animations","title":"Extra animations","text":"<p>To define more animations, this must be done explicitly at the animation controller's level. This means the handling of those animations are not predefined at all and can be virtually anything. This corresponds to any animstate of 100 and above.</p> <p>The base name of an animation clip in this range is the animstate value directly.</p>"},{"location":"Entities/EntityControl/Animations/animstate/#animation-arguments","title":"Animation arguments","text":"<p>Any standard animations can contain optional arguments which is represented by letters appended at the end of a clip's base name. The arguments available are the following:</p> Letter Description b back, refers to an entity's back sprite if applicable for the animation t talking, refers to an entity's equivalent animation when they are talking (This can be controlled by SetText) f flying, refers to an entity's equivalent animation when they are in the air i ice, refers to an entity's equivalent animation when they have been inflicted by an ice attack u UNUSED, this is ignored if the animation is set by force, but no animations is defined with this argument <p>It is also possible to combine these arguments together by specifying them in a row, but the order much match the one used by the game from the order specified in Unity.</p> <p>It should be noted that naming a clip with these arguments does NOT necessarily mean it is standard: it could simply not apply. In practice, the game suffixes the letter <code>b</code> to clips that only follow up on one, but the clip isn't applicable to be the back version of its matching clip.</p>"},{"location":"Entities/EntityControl/Animations/animstate/#non-standard-animations","title":"Non standard animations","text":"<p>Any animation clips of an Entity's animation controller not named in a standard way cannot be played directly by the standard animation state system.</p> <p>However, it is still possible to play clips that have a non standard name through various ways. One is by simply letting Unity do it via a transition from a standard named clip to a non standard one. Another is via the AnimSpecific systems which allows to extend the standard animation state system to do anything beyond its capabilities including non standard animation names.</p>"},{"location":"Entities/EntityControl/Notable%20methods/AddModel/","title":"AddModel","text":"<p>AddModel is a method in EntityControl that is called whenever a need to have a custom object structure occurs for AnimIDs that needs it:</p> <pre><code>public void AddModel(string path, Vector3 offset)\n</code></pre> <p>The <code>path</code> is the path of a prefab in the asset tree and the <code>offset</code> is the desired local position. The actual object gets assigned to <code>model</code> with the parent being the <code>spritetransform</code>. The <code>modelscale</code> is set to the model's actual scale.</p> <p>The way the animator is setup is different than normal. Normally, the animator is present on the Entity's root object, but when a model is added, the prefab's root can have an animator already defined. In which case, this is the one that will be assigned to <code>anim</code> instead of the root's one. This allows the controller attached to target the AnimIDs specifically even if the structure isn't standard.</p> <p>Finally, this method also makes sure to setup all the child when <code>hologram</code> is true. Specifically:</p> <ul> <li>All child's SpriteRenderer have their material assigned to the holosprite one and if <code>cotunknown</code>, with a color of opaque pure black on the sprite and material</li> <li>All child's SkinnedMeshRender and MeshRenderer have their material assigned to the holosprite one and if <code>cotunknown</code>, with a color of opaque pure black on material or the same color with 50% transparent otherwise</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/CheckSpecialID/","title":"CheckSpecialID","text":"<p>This is a void returning parameterless method on EntityControl that is ran during Start. It can be considered as part of the Entity startup process because its name is underselling what the method does as its job is to initialise the fields and structure of any entity based on the AnimIDs. Because of this, it is the method that will assign most fields from EntityValues among other things.</p> <p>Since this method implies extremely specific handling of specific AnimIDs, their handling will only be documented on a surface level, not in detail.</p> <p>Here is what the method does:</p> <ul> <li>Unless <code>overrideshadow</code> is true, <code>hasshadow</code> becomes true if the AnimIDs is not None (which is -1)</li> <li><code>originalid</code> is set to the current animid</li> <li>From here, there are 2 special cases that can change what data is used depending on the animid:<ul> <li>If it's <code>KeyL</code>, <code>KeyR</code> or <code>Tablet</code>, then the following fields gets set and nothing else will get assigned from <code>endata</code>:<ul> <li><code>nomodel</code>, <code>overrideanim</code>, <code>overrideanimfunc</code>, <code>overridemovesmoke</code> and <code>overrridejump</code> are all true</li> <li><code>minheight</code> is pulled from <code>endata</code></li> <li><code>startbf</code> is set to <code>bobrange</code></li> <li><code>startbs</code> is set to <code>bobspeed</code></li> <li>The appropriate sprite from <code>Sprites/Objects/artifacts</code> from the root of the asset tree is set as the entity's sprite</li> </ul> </li> <li>If it's <code>Strider</code>, <code>overridemovesmoke</code> is set to true, but the rest goes as it normally would with the <code>endata</code> loading</li> </ul> </li> <li>If the AnimID is defined, the data from <code>endata</code> is assigned, otherwise only <code>overrridejump</code> is set to true</li> <li>Special AnimID startup</li> <li>The object is setup whenever <code>endata</code>'s <code>Object</code> is true or it's a <code>CoilyVine</code> and we aren't dealing with <code>KeyL</code>, <code>KeyR</code> or <code>Tablet</code>. This is done by setting <code>notalk</code> to true, <code>hasshadow</code> to false, <code>startscale</code> to <code>endata</code>'s <code>startscale</code> and adding the model of the corresponding AnimID via AddModel that's located in <code>Prefabs/Objects/</code> with the offset being <code>endata</code>'s <code>modeloffset</code>. The <code>animid</code> is overridden to -1 (None) unless it's a <code>SavePoint</code> or a <code>FlyTrapPlatform</code></li> <li>If we aren't dealing with <code>KeyL</code>, <code>KeyR</code> or <code>Tablet</code> and the original animid is not -1 (None), then further startup steps are performed:<ul> <li>If the <code>endata</code>'s <code>ismodel</code> is true and it's not an item<ul> <li>The model of the corresponding AnimID that's located in <code>Prefabs/Objects/</code> with the offset being <code>endata</code>'s <code>modeloffset</code> is added via AddModel. The offset is overriden to (0.0, 0.0 - <code>height</code>, 0.0) if it's a <code>TrappedMoth</code>. The <code>model</code>'s angles are set to the <code>endata</code>'s <code>modelscale</code> TODO: why?</li> <li>From there, there are 3 special cases:<ul> <li><code>JumpingSpider</code>: Set all child of the model to be rendered with the 3F3F3F color (light gray) fully opaque</li> <li><code>Pitcher</code> or <code>PictherSummon</code>: Setup 2 <code>extras</code>, one being the object with the tag <code>PitcherEnd</code> and the other being the second child of the <code>model</code>. The first <code>extras</code> gets the <code>Untagged</code> tag. For the second one all child's shadowCastingMode is set to TwoSided and the material set accordingly if <code>hologram</code> with half transparency. Finally, <code>spinextra</code> is set to to one vector being (0.0, 0.0, -0.2)</li> <li><code>Submarine</code>: If there's an <code>npcdata</code> and it's not the player's entity, the <code>ccol</code> is enabled and adjusted to have a radius of 2.5. The <code>npcdata</code>'s <code>colliderheight</code> is set to 20.0. NOTE: the enabling happens in 0.2 seconds in the future</li> </ul> </li> <li>UpdateAnimSpecific is called</li> </ul> </li> <li>More <code>endata</code> fields are loaded:<ul> <li><code>emoticonoffset</code> to <code>freezeflipoffset</code></li> <li><code>freezesize</code> (defaults to (2.0, 2.0, 1.0) if this and <code>freezeoffset</code> is 0)</li> <li><code>freezeoffset</code> (defaults to (0.0, 1.0, 0.0) if this and <code>freezesize</code> is 0)</li> </ul> </li> <li><code>initialfrezeoffset</code> is set to <code>freezeoffset</code></li> <li>If there's a <code>preloaddata</code> in <code>endata</code>, they are all loaded into <code>preloadedobjects</code> and <code>preloadedsprites</code> by loading the actual prefabs/sprites. They remain null otherwise</li> <li>If the current map is laoded and we aren't in a battle<ul> <li>if the current map is MetalLake, <code>startscale</code> is multiplied by 0.35 and the <code>emoticon</code>'s localscale is set to (0.65, 0.65, 0.65)</li> <li>If the current map's <code>waterfloat</code> is present and we are dealing with a <code>Strider</code>, <code>ignorewater</code> and <code>alwaysactive</code> are set to true on top of the ignoring the collider of the map's <code>waterfloat</code> with this entity. Finally,  the y position of the entity is set to the one of the <code>waterfloat</code></li> </ul> </li> </ul> </li> <li>If the <code>animid</code> is <code>Scorpion</code> and we are at Giant's Lair, the <code>basestate</code> is overridden to 150 and <code>walkstate</code> to 151 which makes them render differently.</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/","title":"Death","text":"<p>Death is a coroutine in EntityControl that handles the process of essentially rendering an entity effectively dead. For most cases, it leads to its destruction. It comes with a parameterless overload that has <code>activatekill</code> sent to true, that parameter tells if <code>iskill</code> should be set to true alongside <code>dead</code> (however, the game never calls it with false under normal gameplay). The coroutine is meant to be stored by the caller using <code>deathcoroutine</code> which is set to null when this coroutine ends.</p> <p>Essentially, <code>dead</code> means the Death process started while <code>iskill</code> means it is about to end (it's done just before the <code>spitexp</code> logic). It will also in most cases leads to the destruction of the entity, but these 2 fields can be set externally without calling Death which will reduce their updating logic throughout the game, but not cause destructions.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#destroy-prepations","title":"Destroy prepations","text":"<p>First, <code>nocondition</code> and <code>dead</code> are set to true. BreakIce is called and StopForceMove is too without smoothing and default state. This not only unfreezes the entity if it was, but also stops any coroutine force move that was running. After, the <code>rigid</code>'s velocity is zeroed out and the <code>digpart</code> destroyed if there were any left.</p> <p>From there, if the entity had an <code>npcdata</code>, it is handled in its own section:</p> <ul> <li>STOP is called on the npcdata, but this doesn't do anything because <code>dead</code> was just set to true</li> <li>If npcdata.<code>regionalflag</code> isn't negative, the corresponding regionaflag slot is set to true</li> <li>If npcdata.<code>disguiseobj</code> exists, it is destroyed</li> <li>If npcdata.<code>behaviorroutine</code> is running, it is stopped</li> <li>npcdata.<code>inrange</code> is set to false</li> <li>npcdata.<code>hit</code> is set to true</li> <li>If <code>originalid</code> is the <code>ToeBiter</code> animid and the first <code>internaltransform</code> (his rock) exists, it is destroyed</li> </ul> <p>After, <code>overrideflip</code> is set to false, the <code>sprite</code> gets enabled, the <code>rigid</code> gets locked with a LockRigid(true) and the <code>icooldown</code>, <code>bobrange</code> and <code>bobspeed</code> all get set to 0.0.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#the-destroy","title":"The destroy","text":"<p>This part depends on the <code>destroytype</code>.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#none","title":"None","text":"<p>LockRigid(true) is called which fixes the <code>rigid</code> in place with velocity being zeroed out.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#spinsmoke","title":"SpinSmoke","text":"<ul> <li>If the npcdata.<code>pusher</code> exists, it is disabled.</li> <li><code>overrideanim</code> is set to true</li> <li><code>overridefollow</code> is set to true</li> <li><code>overridejump</code> is set to true</li> <li><code>rigid</code> gets its gravity disabled and velocity zeroed out</li> <li><code>ccol</code> gets its height set to 0.0 and center placed offscreen at (0.0, 9999.0. 0.0)</li> <li>A frame is yielded</li> <li>If the animstate is <code>Fallen</code>, it is set to <code>HurtFallen</code>. It is set to <code>Hurt</code> otherwise.</li> <li><code>froceanim</code> is set to the <code>animstate</code></li> <li>If the <code>Death0</code> sound wasn't playing or it was, but the playback is past 0.25 seconds, it is played at 0.8 volume</li> <li><code>spin</code> is set to (0.0, 15.0, 0.0)</li> <li>0.75 seconds are yielded</li> <li>The <code>spritetransform</code> angles are set to the return of FlipAngle</li> <li><code>spin</code> is set to (-5.0, 0.0, 0.0)</li> <li>0.3 seconds are yielded</li> <li>The <code>sprite</code> is disabled</li> <li>DeathSmoke particles are played at the <code>spritetransform</code> position + (0.0, 0.0, -0.5)</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#spinnosmoke","title":"SpinNoSmoke","text":"<p>The same than SpinSmoke, but without the DeathSmoke particles at the end.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#spinko","title":"SpinKO","text":"<p>The same than SpinSmoke, but the horzontal <code>spin</code> logic (with its yield, <code>sprite</code> disablement and DeathSmoke particles) does not occur, only the vertical <code>spin</code> does. Also, the <code>animstate</code> at the very end is set to <code>KO</code>.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#ko","title":"KO","text":"<p>The same than SpinKO, but the vertical <code>spin</code> logic (with its yield and <code>Death0</code> sound) does not occur too.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#spinsmokenosprite","title":"SpinSmokeNoSprite","text":"<p>The same than KO, but at the start, animid is set to -1 (<code>None</code>) and the <code>sprite</code> is disabled. The <code>animstate</code> is also not changed to <code>KO</code> at the end.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#playerdeath","title":"PlayerDeath","text":"<p>This type is only used in BattleControl.StartBattle as it is set to all <code>playerentity</code> so it's specific to the death of the player.</p> <ul> <li><code>overrideanim</code> is set to true</li> <li>animstate is set to <code>Hurt</code></li> <li>The <code>Hurt</code> animation is played on the <code>anim</code></li> <li>If the <code>Death0</code> sound wasn't playing or it was, but the playback is past 0.2 seconds, it is played</li> <li><code>spin</code> is set to (0.0, 15.0, 0.0)</li> <li>While <code>spin</code> magnitude is above 2.5, it is lerped from the existing one to 0 with a factor of <code>framestep</code> * 0.1 (or 0.01 if <code>isplayer</code>). This is followed by a frame yield which repeats until the <code>spin</code> magnitude goes to 2.5 or below</li> <li><code>overridenanim</code> is set to false</li> <li>The <code>Drop</code> sound is played</li> <li><code>animstate</code> is set to <code>KO</code></li> <li><code>spin</code> is set to (0.0, 0.0001, 0.0)</li> <li>While the angular distance between <code>spritetransform</code> angles and the return of FlipAngle is above 0.5, <code>spriteransform</code> angles is lerped from the existing one to the FlipAngle one with a factor of <code>framestep</code> * 0.2 (or 0.1 if <code>isplayer</code>). This is followed by a frame yield which repeats until the angular distance goes to 0.5 or below</li> <li><code>spin</code> is zeroed out</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#dropsprites","title":"DropSprites","text":"<ul> <li><code>overrideanim</code> is set to true</li> <li>The <code>anim</code> is disabled</li> <li>A frame is yielded</li> <li>For each Transform descendant to the <code>sprite</code> (or the <code>model</code> if it exists) except the first one:<ul> <li>A RigidBody is added to the transform</li> <li>The transform gets rooted to the scene</li> <li>The RigidBody gets its gravity disabled with a velocity of RandomItemBounce(2.5, 12.0)</li> <li>The object gets destroyed in a second</li> </ul> </li> <li>A second is yielded</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#shrink","title":"Shrink","text":"<ul> <li>LockRigid(true) is called which fixes the <code>rigid</code> in place with velocity being zeroed out</li> <li>If <code>originalid</code> is the <code>icepillar</code> animid, the <code>IceMelt</code> sound is played</li> <li>If <code>originalid</code> is the <code>Pitcher</code> or <code>PitcherSummon</code> animid, the animstate is set to <code>Hurt</code> followed by the <code>IceMelt</code> sound being played</li> <li>For 81.0 frames (counted by incrementing <code>framestep</code> from 0.0), the <code>startscale</code> is set to a lerp from the existing one to Vector3.zero with a factor of the ratio of the 81.0 frames that have passed (so the <code>startscale</code> goes to zero over the course of 81.0 frames smoothly)</li> <li>DeathSmoke particles are played at the entity position</li> <li>If <code>originalid</code> is the <code>Pitcher</code> or <code>PitcherSummon</code> animid, the <code>ChargeDown2</code> is played</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#shrinknosmoke","title":"ShrinkNoSmoke","text":"<p>The same than Shrink, but no DeathSmoke particles are played.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#ninjalog","title":"NinjaLog","text":"<ul> <li>LockRigid(true) is called which fixes the <code>rigid</code> in place with velocity being zeroed out</li> <li>DeathSmoke particles are played at the entity position with a size of (2.0, 3.0, 2.0)</li> <li>The <code>LeafDeathPoof</code> sound is played</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#sink","title":"Sink","text":"<ul> <li><code>overridefly</code> is set to true</li> <li><code>overrideflip</code> is set to true</li> <li><code>overrideheight</code> is set to true</li> <li>As long as the <code>sprite</code> exists, <code>spritetransform</code> position is lerped smoothly over the course of 91.0 frames (counted using <code>framestep</code> from 0.0) from the existing one to the same - 10.0 in y using the ratio of the time as the factor (this basically lowers the entity by 10.0 smoothly over the ourse of 91.0 frames)</li> <li>If the <code>sprite</code> still exists, the gameObject is disabled</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#explodeanim","title":"ExplodeAnim","text":"<ul> <li><code>explosionsmall</code> particles are played at the entity position</li> <li><code>Explosion</code> sound is played at 1.1 pitch and 0.75 volume</li> <li>The <code>sprite</code> is disabled</li> <li>ShakeScreen is called with ammount of 0.1 for 0.5 seconds without reset</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#after-the-destroytype-specific-logic-doesnt-occur-for-playedeath","title":"After the <code>destroytype</code> specific logic (doesn't occur for <code>PlayeDeath</code>)","text":"<ul> <li>All frames are yielded while in a <code>pause</code> or it's not a <code>battle</code> entity while we are in a battle</li> <li>For anything except an <code>npcdata</code> of type Enemy with an <code>eventid</code> of 0 or below (meaning no <code>respawntimer</code> feature):<ul> <li>If <code>spitmoney</code> is above 0, the berries drop logic is performed (see the section below for details)</li> <li>If <code>npcdata</code> has a non empty <code>vectordata</code> without a SetPath or SetPathJump behaviors, the item drop logic is performed (see the section below for details)</li> </ul> </li> <li>A frame is yielded</li> <li>If this GameObject is null (which shouldn't happen), the coroutine is exited early with a yield break</li> <li>If the <code>destroytype</code> isn't <code>KO</code>, <code>SpinKO</code> or <code>None</code>, the entity position is set offscreen at (0.0, 9999.0, 0.0) followed by the destruction of the object (only if we aren't in a battle)</li> <li>The <code>ccol</code> is disabled</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#berries-drop-logic","title":"Berries drop logic","text":"<p>The following is performed until <code>spitmoney</code> amount of berries worth total have been dropped:</p> <ul> <li>CreateItem is called which creates an Item NPCControl object at <code>spritetansform</code> position + (0.0, 0.5, 0.0) with the item type being 0 (standard item), the direction being RandomItemBounce(4.0, 10.0) for 600 frames. The item id is <code>MoneyBig</code> if there's strictly more than 20 berries left to drop, <code>MoneyMedum</code> if there's 5 or less left and <code>MoneySmall</code> otherwise (this means the last 20 berries if exactly 20 are left will be dropped by 4 <code>MoneyMedum</code> instead of one <code>MoneyBig</code>)</li> <li>The collisions between the item's entity.<code>ccol</code> and the item's entity.<code>detect</code> or itself are ignored for 5.0 seconds</li> <li>The same RandomBounce vector obtined earlier is set to the item's entity.<code>rigid</code> vecity on the next frame</li> <li>The amount of money dropped is increased by 20 if there was more than 20 left to drop. Otherwise, if there's more than 5 left, it's increased by 5 (this means the last 5 berries if exactly 5 are left drops 5 <code>MoneySmall</code> instead of one <code>MoneyMedum</code>)</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#item-drop-logic","title":"Item drop logic","text":"<p>The <code>specialenemy</code> cases are handled. These are hardcoded enemy ids with hardcoded odds to drop an item from an hardcoded list of ids with uniform probability each. The way it works is the first occurence of a special enemy in <code>lastdefeated</code> (if one exists) will test for a potential drop. If multiple exists, only the first is tested once so if it fails, others will not be attempted to drop. Here are the the hardcoded ids in question as well as their odds:</p> Enemy % to drop Possible item drops <code>GoldenSeedling</code> 100 <code>TangyBerry</code> <code>ChomperBrute</code> 50 <code>Abomihoney</code>, <code>ShockCandy</code>, <code>DrowsyCake</code>, <code>FrostPie</code>, <code>PoisonCake</code>, <code>MushroomCandy</code>, <code>NutCake</code> <code>ToeBiter</code> 40 <code>HoneydLeaf</code>, <code>GlazedHoney</code>, <code>HeartyBreakfast</code>, <code>YamBread</code>, <code>BakedYam</code>, <code>Pudding</code>, <code>RoastBerry</code>, <code>ClearBomb</code>, <code>SleepBomb</code>, <code>LeafSalad</code>, <code>FrozenSalad</code>, <code>MushroomStick</code>, <code>ShavedIce</code>, <code>BurlyChips</code> <p>If a drop occurs:</p> <ul> <li>CreateItem is called which creates an Item NPCControl object at <code>spritetansform</code> position + (0.0, 0.5, 0.0) with the item type being 0 (standard item), the item id being a randomly chosen (uniform odds) element from the applicable possible drop list, the direction being RandomItemBounce(4.0, 10.0) for 600 frames.</li> <li>The collisions between the item's entity.<code>ccol</code> and the item's entity.<code>detect</code> or itself are ignored for 5.0 seconds</li> <li>The same RandomBounce vector obtined earlier is set to the item's entity.<code>rigid</code> vecity on the next frame</li> </ul> <p>Whether or not the drop failed or succeeded, the enemy is removed from the <code>lastdefeated</code> array. From there, <code>lastdefeated</code> is reset to a new list (making the last deletion useless).</p> <p>An random number is generated where the upper (exclusive) bound is the length of npcdata.<code>vectordata</code>, but the lower (inclusive) bound is determined based on some factors:</p> <ul> <li>Having the Bug Me Not! medal equipped makes it -7 (this takes priority over the ones below)</li> <li>Having the Hard Mode medal unequipped while flag 614 (HARDEST) is false makes it -3</li> <li>If neither of the cases above applies (meaning Hard Mode is equipped or HARDEST is active while Bug Me Not! is unequipped), it's -1</li> </ul> <p>However, that index gets overriden if <code>vectordata</code> contains at least one element whose y component after truncating the decimal part is -2. In such case, it will be become the index of the last occurence where this condition is true.</p> <p>This index is used for a potential item drop. If the index is negative, no drops happen. If it's positive, but the y component of the corresponding npcdata.<code>vectordata</code> isn't negative, then the drop only happens if that y component floored corresponds to a flag slot whose value is true. If it's false, the drop doesn't happen.</p> <p>If the drop happens:</p> <ul> <li>CreateItem is called which creates an Item NPCControl object at <code>spritetansform</code> position + (0.0, 0.5, 0.0) with the item type being 0 (standard item), the item id being the chosen npcdata.<code>vectordata</code> x component using the index generated earlier, the direction being RandomItemBounce(4.0, 10.0) for 600 frames.</li> <li>The collisions between the item's entity.<code>ccol</code> and the item's entity.<code>detect</code> or itself are ignored for 5.0 seconds</li> <li>The same RandomBounce vector obtined earlier is set to the item's entity.<code>rigid</code> vecity on the next frame</li> </ul> <p>However, if the corresponding npcdata.<code>vectordata</code> y component is -2 (meaning its index was overriden earlier), then it means this is a special key item drop that will always be dropped. The procedure to drop it is the same, but with a few changes:</p> <ul> <li>The item type is 1 (key item) instead of 0 (standard item)</li> <li>-1 is the timer value which means the Item never expires even after 600 frames</li> <li>After the CreateItem call, the item's <code>activationflag</code> is set to npcdata.<code>limit[0]</code></li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Death/#common-end-logic","title":"Common end logic","text":"<p>The following happens no matter the <code>destroytype</code>.</p> <p>A frame is yielded.</p> <p>After, there is a specific case for the Ruffian AnimIDs where if it is one, it will destroy all <code>extras</code> and destroy the MidPos of the <code>sprite</code> that was attached prior before setting <code>extras</code> to null.</p> <p>After, this is where <code>iskill</code> is set to true if the <code>activatekill</code> parameter was true. This field is more an extended <code>dead</code> and while it only affects UpdateCollider in EntityControl Creation, it can be used externally to distinguish the 2.</p> <p>Then, if <code>spitexp</code> is above 0, this is where the orbs gets dropped. The way it works is the game calculates the amount of big orbs this implies where a big orb is 10 EXP. Then, <code>spitexp</code> is essentially decreased by this amount * 10 which is equivalent to do a modulo 10 on it. From there, the game will set to drop <code>spitexp</code> amount of orbs where any big orbs will take priority if any are remaining to be dropped. (NOTE: this is a bug, it means not all orbs will be dropped, see below for why). An orb drop consists of instantiating <code>Prefabs/Objects/ExpOrb</code> from the root of the ressources tree, set its scale to (0.25, 0.25, 0.25) or (0.5, 0.5, 0.5) if it's a big orb, adding a rigid body to it with velocity being 15.0 in y and the x/z being random between -4.0 and 4.0. The orb is then destroyed in 0.75 seconds, but the coroutine yields only 0.05 seconds after so it gives some time to see the orb drop.</p> <p>The reason the orb drop is wrong is because it will only drop <code>spitexp</code> % 10 amount of orbs no matter how many big orbs are meant to be dropped. This means that a value of 10 will actually drop nothing while 11 will drop one big orb.</p> <p>Finally, <code>deathcoroutine</code> is set to null informing the caller that it has completed.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Drop/","title":"Drop","text":"<p>This coroutine handles dropping an airborne enemy in the air during battle. It only applies when the entity isn't <code>dead</code>, <code>iskill</code>, <code>deathcoroutine</code> isn't running and it has a valid <code>battleid</code>. If not all these conditions are met, <code>droproutine</code> is set to null before a yield break. Note that <code>droproutine</code> must be stored externally by the caller.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Drop/#drop-preparation","title":"Drop preparation","text":"<p>First, <code>overrideanim</code> is temporarily set to false (the old value is saved). Then, the animstate is constantly set to Hurt with a frame yield until the current battle's startdrop goes to true.</p> <p>From there, there is an early exit path if the enemy's hp reached 0 while not in a battle event. If this happen, <code>droproutine</code> is set to null followed by a yield break.</p> <p>After, <code>temphgeightoverride</code> is set to true if the entity was frozen. This is going to come into play later because being frozen implicates different levels of ground.</p> <p>There is a special case that follows if the <code>originalid</code> is the <code>VenusGuardian</code> AnimID where both of her extra (her leaf wings) will have the <code>leafexplode</code> particle play at their position before being disabled. This will also reset the battle camera to default.</p> <p>For all cases, the <code>Fall</code> sound plays if it wasn't playing already. Then, the <code>rigid</code> velocity is zeroed out followed by <code>overrideanim</code> being set to true (this is still temporary).</p> <p>There is a special case for the <code>Spuder</code> AnimID where his <code>line</code> is destroyed if it was present followed by his <code>basestate</code> going back to Idle.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Drop/#the-actual-drop","title":"The actual drop","text":"<p><code>bobrange</code> and <code>bobspeed</code> are both zeroed out to avoid any bobbing in the air as the entity needs to look frozen in place. From there, unless <code>nofallfrozen</code> is true (which bypass the actual drop), the <code>height</code> is smoothly decreased such that the <code>spritetransform</code>'s y position goes below <code>minheight</code> unless <code>tempheightoverride</code> is true which changes the target y to 0.0. This is because when an entity is frozen, the cube cannot be offset from the ground so it must go to 0.0 and not <code>minheight</code>. BreakIce will undo this override when appropriate. Additionally, the rate of descent increases over time. It starts at framestep * 0.1, but each frame, this goes up by 10% making the <code>height</code> decrease faster each frames by 10%. This keeps going until the y position reached a low enough value (this will be changed periodically due to UpdateHeight).</p> <p>After, if <code>shakeondrop</code> is true, 4 things happens in a row:</p> <ul> <li>The particle <code>impactsmoke</code> is played at the transform</li> <li>The screen is shook by (0.5, 0.5, 0.5) over 0.45 seconds</li> <li>The sound <code>Thud3</code> is played</li> <li>0.25 seconds are yielded</li> </ul> <p>Finally, the battle position of the entity with its corresponding <code>battleid</code> is set to Ground before yielding 0.4 seconds.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Drop/#post-drop-cleanup","title":"Post drop cleanup","text":"<p><code>bobspeed</code> and <code>bobrange</code> are restored to their start field counterpart if the final <code>height</code> is still above 0.1. Then, <code>overrideanim</code> is restored to its original value before the drop.</p> <p>If the battle data at <code>battleid</code> has the Topple condition, it is removed and the <code>basestate</code> is reset to Idle. Them, the animstate is reset to <code>basestate</code> except for the <code>CursedSkull</code> AnimIDs which has it set to 101.</p> <p>Finally, <code>droproutine</code> is set to null and the Drop call is over.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/","title":"Follow","text":"<p>Follow is a private method called during LateUpdate that manages following the <code>following</code> entity if it exist, we aren't overriding followers, the entity <code>overridefollow</code> isn't active and the entity isn't <code>dead</code> or <code>iskill</code>.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#follow-logic","title":"Follow logic","text":"<p>There are 3 ways to follow: player and their followers, <code>tempfollower</code> and everything not in the first 2 categories. The default follow logic is actually contained in DoFollow described later, but the player and their followers may not call it under some conditions.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#player-and-their-followers","title":"Player and their followers","text":"<p>This branch is applicable if it's not a <code>tempfollower</code> and the <code>following</code> has the tag <code>Player</code> or <code>PFollower</code> with the player being present.</p> <p>The default logic is to set <code>leiffly</code> to false, call Return from action and then call DoFollow. However, there are 3 special cases where this logic isn't performed.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#digging","title":"Digging","text":"<p>This only applies if the player is digging or started digging. <code>backsprite</code> is set to false with a <code>spin</code> of 30.0 on the y and the <code>spritetransform</code>'s scale is set to be lerped towards 0 with a factor of 0.075. The <code>transform</code>'s position is changed directly towards <code>following</code> + the forward direction of the camera / 2.0. This is done because it bypasses the physics engine. The <code>rigid</code> is actually set to kinematic without gravity and the <code>ccol</code> is disabled so the physics engine no longer can control the follower when digging. The <code>shadow</code> is disabled if it wasn't and finally, StopMoving is called with the default <code>basestate</code> (-1) which completely stops any velocity.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#flying","title":"Flying","text":"<p>This only applies if the player is flying. First, <code>backsprite</code> is set to false, same with <code>overrridejump</code> and <code>overrideanim</code> to get back control on the flying animations. StopForceMove is called with no animstate and no smoothing which halts any current coroutine force move if one existed.</p> <p>From there, if the AnimIDs was <code>Beetle</code>, his animstate is changed to 102, his position changed directly to be the player's + the forward direction of the camera * 0.2 and his <code>flip</code> changed to the player's. This forces Kabbu to face the same direction and to be positioned where the player is. On the other hand, if it's not <code>Beetle</code>, then it is assumed to be <code>Moth</code> and as such, his <code>rigid</code> gets its gravity disabled, <code>overrideanim</code> becomes true, his animstate becomes 101, his <code>flip</code> becomes the player's and <code>leiffly</code> becomes true. This is needed during FixedUpdate to update his position smoothly towards the player.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#shielding","title":"Shielding","text":"<p>During bubble shield, the follow logic is managed differently by ShieldMove (tempf to false since this is a player follower). It forces the entity to face towards the player, StopForceMove is called with <code>walkstate</code> and no smoothing before the position is set directly via a lerp to the player's + an offset with a factor of framestep * 0.25. This offset is calculated by using the AnimID number as an offset in 0.5 units in x and 0.2 units in z which makes the entity go very close to the player, but with enough spacing to prevent z fighting.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#default","title":"Default","text":"<p>If none of the above applies, then the default logic mentioned earlier applies which ends with a DoFollow call.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#temp-followers","title":"Temp followers","text":"<p>There are 3 starting logic branches for a <code>tempfollower</code>:</p> <ul> <li>The player is shielding: then ShieldMove with tempf to true is called. The only change with the player follower version is that the offset is now the player's <code>spritetransform</code> right direction * 0.75 + the camera foward direction * 0.5.</li> <li>The player is flying: the animstate is set to <code>basestate</code>, the <code>rigid</code> gravity is disabled, <code>flip</code> is set to to the last player in playerdata's <code>flip</code> (basically the last party member in the follow chain) and the position is set directly to be the last party member's position + (+-0.35, 0.75, 0.1) * <code>tempfollowerid</code> + 1 which will offset the position to be up forward and left/right. The x sign is determined by the player's <code>flip</code>.</li> <li>Everything else: DoFollow is called</li> </ul> <p>After this is done, the <code>rigid</code> gravity is enabled, <code>nodigpart</code> is set to true and <code>digging</code> is set to whether the player is digging or has started digging. If we are indeed <code>digging</code>, the position is set directly to the player's + the forward direction of the camera * 0.1.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#default-logic","title":"Default logic","text":"<p>If none of the other 2 branches applies, DoFollow is called as the only execution for this follow.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#dofollow","title":"DoFollow","text":"<p>DoFollow is a private method that houses the default logic of a typical follow that entities will use most of the time. It applies unless the game's <code>overridefollower</code> is enabled, <code>overridefollow</code> is true, the entity is <code>dead</code> or <code>iskill</code>.</p> <p>From there, unless there's a <code>springcooldown</code> and <code>jumpcooldown</code> is above 15.0, the <code>rigid</code> velocity is set to to the current one in x/z and in y to the clamp of the current one from -20.0 to <code>jumpheight</code>. After, FaceTowards is called with the <code>following</code> position. The rest of the method only happens every 2 frames so if we're in an odd frame, this is done.</p> <p>If we aren't however, this is where the actual follow management is handled. </p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#movement-logic","title":"Movement logic","text":"<p>We first gather the horizontal square distance between the <code>transform</code> and the <code>following</code> which will be used to decide what to do for this follow. </p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#too-far-handling","title":"Too far handling","text":"<p>The first thing that is checked is if the entity is too far from <code>following</code> which it is if the square distance in x/z is higher than <code>followlimit</code> (20.0 by default) OR we aren't in a minipause and the y actual distance is higher than the map's followerylimit. In that case, the position is changed directly to the <code>following</code>'s + the forward direction of the camera * 0.1 and the velocity is zeroed out.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#decide-whether-to-move","title":"Decide whether to move","text":"<p>From there, we can now check the if entity should not move or move towards <code>following</code>. The entity will attempt to move towards it only if the square distance is higher than <code>followdistance</code> (by default 2.0). However, this check changes to half of the <code>followdistance</code> if CloseMove returns true. This method only returns true under the following conditions:</p> <ul> <li>The player is present and not dashing</li> <li>One or more of the following is true:<ul> <li>We are currently in a stealth section (flags 401), the map's closemove is true and this entity is part of the <code>mainparty</code></li> <li>This entity is part of the <code>mainparty</code> and the player has a parent</li> <li>The player has forceclosemove to true</li> </ul> </li> </ul> <p>The result is that the entity will attempt to be twice as close than normal under these conditions.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#follow-movement","title":"Follow movement","text":"<p>If we decided to move towards following, MoveTowards is called which starts a <code>forcemove</code> to <code>following</code> + the forward direction of the camera * <code>followoffset</code>. This is however halved if CloseMove returned true earlier. The <code>forcemove</code> is done with a multiplier of 1.25 unless CloseMove returned true which makes it (the square distance - 1) / 2.0. The rest are left default with <code>ignore_y</code> to true.</p> <p>From there we go into determining if we should Jump, but only if <code>detect</code> is present. If it is, DetectDirection is called which aligns the wall detector. From there, there are 2 potential scenario that will make the entity jump (only one of them needs to be true):</p> <ul> <li>The entity is <code>onground</code> and a raycast hit occurs from <code>transform</code>.position + <code>detect</code>.transform.forward.normalized + Vector3.up * 0.3 directed down with a max distance of 2.5 only hitting layers Ground and NoDigGround. This raycast basically ensures that there is a wall that can be jumped over by the entity, but it doesn't make use of <code>hitwall</code> to check this and rather by raycasting manually using the <code>detect</code> direction.</li> <li>The entity is <code>onground</code>, it has <code>hitwall</code> and the actual distance between the <code>transform</code> and <code>following</code> is higher than 0.5 and the horizontal square distance between the 2 is higher than <code>followjump</code> (0.3 normally). This basically means both detector reports ground and wall while the horizontal and vertical distance are high enough to warrant jumping.</li> </ul> <p>Jump is not called if neither applies or <code>detect</code> isn't present.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Follow/#follow-stop-movement","title":"Follow stop movement","text":"<p>If we decided to not move towards <code>following</code>, StopForceMove is called with the <code>basestate</code> with smoothing. After, the <code>deltavelocity</code> is zeroed out if the animstate isn't <code>Walk</code>.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Freeze%20handling/","title":"FreezeHandling","text":"<p>Entities can get frozen which involves the entity being put in the <code>icecube</code> and unfrozen which involves breaking the cube and restoring the entity's functions. This is done by 2 methods called Freeze and BreakIce respectively.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Freeze%20handling/#freeze","title":"Freeze","text":"<p>First, <code>freezeoffset</code> is set to <code>initialoffset</code>, but the x component is multiplied by -1 if <code>flip</code> is true. Unless it is a <code>battle</code> entity, the <code>Freeze</code> sound will play unless it was already playing.</p> <p>From there, this is where the <code>icecube</code> is prepared to be frozen. The <code>icecube</code> is instantiated from <code>icecubeprefab</code> childed to the root <code>transform</code> with a local scale of zero. The scale is left handled by LateUpdate which will grow it to <code>freezesize</code>.</p> <p>For the entity, its <code>onground</code> is forced to true, StopForceMove is called with <code>spin</code>, <code>extraoffset</code> and the <code>anim</code>'s speed all zeroed out with the animstate set to <code>Hurt</code>. Since the ice cube has a collider, collisions with the <code>ccol</code> are ignored to avoid problems. If it's not a <code>battle</code> entity and there is an <code>npcdata</code>, STOP is called on it. Finally, the SpriteBounce is disabled from the <code>rotater</code> if one was present.</p> <p>Before returning, UpdateAnimSpecific is called since some AnimIDs have special handling when the entity is frozen.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Freeze%20handling/#breakice","title":"BreakIce","text":"<p>This undo everything that happened on Freeze with some more logic related to it.</p> <p>First, the destruction of <code>icecube</code> if it was still present. This occurs by first playing the <code>Prefabs/Particles/IceShatter</code> particles from the root of the resources tree at the <code>icecube</code>'s position along with the <code>IceBreak</code> sound with 0.65 of pitch. The cube is now destroyed with the entity's animstate set to <code>basestate</code>, the <code>anim</code>'s speed to 1.0 and <code>onground</code> being set back to false with a Jump.</p> <p>Them, the <code>height</code> logic follows. <code>tempheightoverride</code> is set to false which is needed in the case a Drop occured. From there, unless <code>overrideminheight</code> is true, the <code>minheight</code> is enforced if the <code>height</code> is less than it which also comes with the <code>bobrange</code> and <code>bobspeed</code> being set to their start counterparts.</p> <p>If it's a <code>battle</code> entity that isn't the <code>player</code>, its size in the battle data is set to the initialsize of the battle data.</p> <p>Finally, <code>shakeice</code> is set to false and the SpriteBounce is enabled back if one existed on the <code>rotater</code>. Before return, UpdateAnimSpecific is invoked in 0.1 seconds.</p>"},{"location":"Entities/EntityControl/Notable%20methods/LateStart/","title":"LateStart","text":"<p>LateStart is a method that is only called on the first LateUpdate cycle of the entity. This is tracked using the <code>setup</code> field which is only set to true at the end of this method.</p> <ul> <li>Check the tag of the entity<ul> <li>For <code>Follower</code>, <code>PFollower</code>, <code>Player</code>, <code>NPC</code> and <code>Enemy</code>, <code>movesmoke</code> is initialised unless it is an item. Either way, the <code>anim</code>'s cullingMode is set to CullCompletely which disabled animations when not visible</li> <li>For <code>Follower</code> and <code>PFollower</code>, CreateDetector is called with a size of (0.0, 0.7, 0.3) and a center of (0.0, 0.5, 0.65). Collisions between <code>detect</code> and the <code>following</code> entity are ignored before setting <code>isfollower</code> to true.</li> <li>For <code>Player</code>, <code>isplayer</code> is set to true and CreateShield called if it is the battle entity version of the player which initializes <code>bubbleshield</code> if it hasn't been already</li> </ul> </li> <li>If it's an item entity, set <code>overrideanim</code> and <code>overrridejump</code> as well as <code>oldstate</code> to -1 (<code>None</code>) and call <code>CreateFeet</code> which will initialise <code>feet</code> and set this entity as its parent</li> <li>Set <code>originalmap</code> to the current map</li> <li>If there is an <code>npcdata</code><ul> <li>Set <code>npcdata</code>'s <code>currentdialogueindex</code> to NPCControl.GetDialogueIndex which is a very cut down version of GetDialogue that only supports <code>npcdata.overridediag</code> and will only return the first applicable dialogue line id or -1 if none applied</li> <li>If the map entity is a PushRock with <code>internalcollider</code> present, ensure <code>feet</code> is initialised and call <code>CreateFeet</code> if not while also ignoring all collisions between <code>feet</code> and each <code>internalcollider</code></li> </ul> </li> <li>If by this point, <code>feet</code> hasn't been initialised and the entity is a <code>Follower</code>, <code>PFollower</code>, <code>isplayer</code>, <code>NPC</code>, <code>Enemy</code> or an <code>npcdata</code> of type PushRock or Item, <code>CreateFeet</code> is called</li> <li>Set the <code>transform</code>'s position to <code>startpos</code> if it was assigned before or set <code>startpos</code> to the <code>transform</code>'s position if it wasn't</li> <li>Set <code>startbf</code>, <code>startbs</code> and <code>truescale</code> to <code>bobrange</code>, <code>bobspeed</code> and <code>startscale</code> respectively</li> <li>Call UpdateMoveSmoke</li> <li>Set <code>oldstate</code> to -1 (None)</li> <li>Set <code>setup</code> to true which will prevent the game from calling this method again for this entity</li> </ul>"},{"location":"Entities/EntityControl/Notable%20methods/Move/","title":"Move","text":"<p>This method is called by FixedUpdate during a <code>forcemove</code>, but it can be called externally. It will set the velocity of the movement and handle other logic for this instant. It receives the target position, a multiplier to the velocity and the animstate to use during the movement.</p> <p>First, the entity is unifixed if <code>fixedentity</code> is true with the <code>rigid</code> constraints being set to freeze only rotations. Unless <code>overrideanim</code> is true, the animstate is set to the state sent in.</p> <p>This is where the facing logic occurs which involves having <code>moverotater</code> look at the target position sent in and call FaceTowards with the same position (this sets <code>flip</code> and <code>backsprite</code> accordingly).</p> <p>From there, the <code>rigid</code>'s velocity is set to a vector where each component is towards the target (uses <code>moverotater.forward.normalized</code> which was aligned earlier) * <code>speed</code> * the multiplier sent in. However, the y component is exempted from this if <code>ignorey</code> or the <code>rigid</code> has its gravity enabled. In such case, the y component is the existing one.</p> <p>Then, the special case where the <code>walktype</code> is Jump is handled here. What happens is if the entity is <code>onground</code> and the <code>jumpcooldown</code> expired, it will also jump on top of that. This is further enhanced by playing the sound <code>AhoneynationHopJump</code> for a <code>Ahoneynation</code> AnimID and by playing <code>Jump</code> at 0.85 pitch for a <code>JumpingSpider</code>.</p> <p>Finally, the <code>deltavelocity</code> is updated to the horizontal direction towards the target * <code>speed</code> * the multiplier sent in.</p>"},{"location":"Entities/EntityControl/Notable%20methods/Special%20AnimID%20startup/","title":"Special animid startup","text":"<p>This is the part of CheckSpecialID that deals with specific AnimIDs:</p> <ul> <li><code>GoldenSeedling</code>: setups the <code>Prefabs/Particles/GoldStars</code></li> <li><code>RizGrandpa</code>: creates a line to render as a fishing rod's line</li> <li><code>SeedlingKing</code>: Adjusts the <code>height</code> and <code>initialheight</code> in battle and setups 4 <code>subentity</code> which will be seedling rendered under him</li> <li><code>Midge</code>: Setups 2 wings in the <code>extra</code> array with their sprite set to <code>Sprites/Entities/Midge</code></li> <li><code>Cape</code>: setups the <code>Prefabs/Particles/Snowflakes</code> if it's an ice variant or <code>Prefabs/Particles/Flame</code> if it's a fire one to the only <code>extra</code>. The fire variant is in effect only if <code>forefire</code> is true OR that the current map is in Giant's Lair except for GiantLairFridgeInside. Finally, the fire variant has its <code>animid</code> overriden to FireCape</li> <li><code>Watcher</code>: setup the <code>extra</code> to be 2 elements and setup the first one to be <code>Prefabs/Objects/WatcherBook</code>. The materials of the pages of the models is adjusted to the holosprite one if <code>hologram</code> is true. Finally, <code>nodigpart</code> is overridden to true</li> <li><code>Krawler</code>: Very similar to <code>Cape</code>, except the <code>animid</code> to override on the fire variant is <code>FireKrawler</code> and if it's the ice variant AND it is not <code>inice</code>, then the particle are stopped with playOnAwake turned off</li> <li><code>CursedSkull</code>: Same than <code>Krawler</code> except the <code>animid</code> overridden on the fire variant is FireWarden</li> <li><code>Ahoneynation</code>: The <code>rotater</code> gets a SpriteBounce setup with 0.03 as the frequency and 9.0 as the speed</li> <li><code>WaspTwinA</code>: <code>basestate</code> is set to Sad if they are following an entity</li> <li><code>None</code>: the <code>rigid</code>'s gravity is disabled on top of its constraint being set to freeze all. Additionally, the <code>ccol</code> is disabled</li> <li><code>CoilyVine</code>: the same thing than <code>None</code> on top of overriding the check to load a prefab model for later</li> <li><code>BeeBoss</code>: the <code>Prefabs/Particles/BeeBossBottomSmoke</code> from the root of the asset tree is setup as a child to <code>shadowtransform</code>. <code>shadowtransform</code>'s local position is then set to 0</li> <li><code>BeeBot</code>: ensures that the enemydata[battleid].data has one element which contains a random number being either 0 or 1. From there UpdateAnimSpecific is called</li> <li><code>CrystalBerry</code>: <code>Prefabs/Objects/CrystalBerry</code> from the root of the asset tree is added as model via AddModel with the offset coming from <code>endata</code>'s <code>modeloffset</code>. The <code>animid</code> is overriden to 3 with a <code>spin</code> set on the y axis and <code>item</code> set to true</li> <li><code>Seedling</code>: the speed is set to 2.5 if it was 0.0 or below on top of the <code>npcdata</code>'s <code>speedmultiplier</code> being set to 1.0 if it is present</li> <li><code>AngryPlant</code>: <code>Prefabs/Objects/LeafSkirt</code> from the root of the asset tree is setup as the only <code>extras</code>. This includes setting all child's shadowCastingMode to off and to set the correct materials if <code>hologram</code> and <code>cotunknown</code> (the later being changing the color to pure black with 50% transparency)</li> <li><code>Turret</code>: <code>Prefabs/Objects/turretbase</code> from the root of the asset tree is setup as the only <code>extras</code>. <code>cotunknown</code> changes its material color to pure black with 50% transparency</li> <li><code>WaspDriller</code>: if npcdata.vectordata[0].y is -2.0, setup an item sprite as the only <code>extra</code> where the Items id is npcdata.vectordata[0].x and its flipX is true</li> <li><code>Zombeetle</code>: Same as WaspDriller, but also setup the <code>extras</code>'s angles and localscale on top</li> </ul>"},{"location":"Entities/EntityControl/Update%20process/RefreshShadow/","title":"RefreshShadow","text":"<p>RefreshShadow is a method on EntityControl called by LateUpdate when applicable to refresh the rendering of the <code>shadow</code> object which is a gradient black circle. Since all of this is rendering, only a high level explanation is needed.</p> <p>The method will skip the update if the <code>shadow</code> isn't present, but also under a specific set of conditions that have to be true:</p> <ul> <li>The entity has an <code>npcdata</code> and its <code>freezecooldown</code> and <code>timer</code> expired</li> <li>The entity is not an item entity</li> <li>The entity is <code>onground</code></li> <li>It is not a <code>battle</code> entity</li> <li>The squared distance with <code>lastshadow</code> is extremely small (\\&lt;= 0.005)</li> </ul> <p>If all those conditions are true, updates are skipped every other frames. This is on top of LateUpdate precondition checks before this method is even called.</p> <p>On an update cycle, shadows remain enabled as long as <code>iskill</code> is false and that either the <code>sprite</code> / <code>model</code> is present or that <code>overrideshadow</code> is true. If none of those conditions are true, <code>shadow</code> gets disabled instead of getting updates. </p> <p>On an actual update, a raycast is done from slighly above the entity down. If it gets a hit withing 10.0 units, <code>shadow</code> remains enabled as long as the entity isn't <code>digging</code> with the position, scale and color updated to match the hit point, <code>ccol</code>, <code>height</code>, <code>shadowsize</code> and the <code>sprite</code>'s alpha. More specifically</p> <ul> <li>Position is slightly above the hit point (this prevents z fighting)</li> <li>the scale is <code>shadowsize</code> </li> <li>the result of <code>ccol</code>.radius * (1.0 - Mathf.Abs(<code>hitInfo</code>.point.y - (<code>transform</code>.position.y + <code>height</code>))) / 10.0 clamped from 0.0 to infinite all normalised for the x and y (the z is locked to 1.0) This essentially means the <code>shadow</code> scale is caped at <code>shadowsize</code> * <code>ccol</code>'s radius and gets scaled down the further away the hit point is from the <code>height</code> up to 10.0 units away at which points, it gets scaled to zero.</li> <li>The angles are set to look at the normal of the hit point which will make the shadow angle match the point it hit on the ground</li> <li>The color is the sprite's alpha clamped to 0.4</li> </ul> <p>If the raycast didn't hit, <code>shadow</code> is disabled. If the raycast is hit, but the entity was <code>digging</code>, then it still gets updated, but disabled.</p>"},{"location":"Entities/EntityControl/Update%20process/RefreshTrail/","title":"RefreshTrail","text":"<p>RefreshTrail is a method called by LateUpdate that manages the <code>trail</code> feature. Since this feature only implicates rendering, a high level explanation is provided rather than a series of steps.</p> <p>When <code>trail</code> is turned on, the method will create the internal <code>traildata</code> if they weren't created beforehand. A TrailData is a very simple struct containing 3 arrays (one for the sprite renderers of the copies, one for their time left to render  in frames and another for their position) and 2 fields (one setting the delay in frames between the copies and another saying the last trails id to use in the arrays).</p> <p>The trails object are created as child of the root object of the entity with the name \"trailX\" where X is the array index. The game sets the array size to a fixed 5 so this will create trail0 through trail4. They are set to render the same sprite as the entity, but half transparent and a little bit backward. with a delay of 5 frames. The delay and copies's time fields are decreased by framestep each time this method is called so they act as proper cooldowns.</p> <p>The way the trail rendering works is these objects are enabled, until their time expires. They will not get reenabled again until the delay expires for the entire thing, The key thing that makes this effect works is once the <code>traildata</code> is initialised the first time, RefreshTrail will only deal with the rendering of a single copy at the time, the one in the id field.</p> <p>This means that at the start when everything is initialised already, only the first copy at index 0 is enabled and positioned to where the entity is, only slightly forward before incrementing the id. It is only when the amount of frames in the delay field expires that the copy at index 1 has the same happen and so on. This means that as the entity would move, the copies progressively gets enabled, but the first ones will \"lag behind\" because they render at position the entity reached frames ago. Each copy will render for the amount of frames in the time field, but they won't get repositioned and enabled until the amount of frames in the delay field has expired.</p> <p>The game fixes both of these cooldowns to be a delay of 5 frames and a time for each copies of 20 frames. This gives a trail effect of 5 copies of the sprite rendered 5 frames apart each for 20 frames. It does mean an overprision of the amount, but this covers framestep misshaps.</p> <p>The trail can be reset to its starting state manually by calling <code>ResetTrail</code> which will expire all the hang times and reset the current copy index to 0. It only works if the <code>traildata</code> has already been initialised.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateAirAnim/","title":"UpdateAirAnim","text":"<p>This is an update method called by LateUpdate when applicable. All update cycles are skipped if <code>overridefly</code> or <code>overrideanim</code> is true.</p> <p>The method first sees if the animstate should be updated to <code>Jump</code> or <code>Fall</code> depending on the vertical velocity. Determining this involve verifying that the entity is in the air with <code>overridejump</code> being false. More specifically:</p> <ul> <li><code>offgroundframes</code> is higher than 3.0</li> <li>If <code>isplayer</code>, it isn't dashing</li> <li>Not <code>onground</code></li> <li><code>height</code> is 0.0</li> </ul> <p>After, the method prechecks if we proceed to check if the entity has landed which simply checks if it's <code>onground</code>. If it is, then there are 2 possible ways to update the animstate: from the <code>basestate</code> or the <code>npcdata</code>'s <code>dialogues</code> at <code>currentdialogueindex</code>'s z. </p> <p>The <code>dialogues</code> one is done when it applies while not in an event, the current animstate is <code>Idle</code> and <code>changedstate</code> was not enabled externally. The only way to enable it is through SetText's anim command.</p> <p>The <code>bassestate</code> one applies when either the above applies, but there is no <code>currentdialoguesindex</code> or that the animstate was at <code>Fall</code>.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateCollider/","title":"UpdateCollider","text":"<p>This update methods is called by LateUpdate. It only applies for <code>npcdata</code> being present and every 2 frames, but because LateUpdate only calls it every 3 frames when applicable, it's actually only going to process every 6 frames when <code>npcdata</code> is present.</p> <p>First, if the entity <code>iskill</code> is false and the <code>npcdata</code>'s <code>colliderheight</code> is 0.0, the height and radius of the <code>ccol</code> goes back to their <code>initialcolliderdata</code> and <code>colliderheight</code> is initialised to the <code>initialcolliderdata</code>.x which is the initial height of the <code>ccol</code>.</p> <p>From there, the method only proceeds if the player is free or that the <code>npcdata</code>'s <code>insideid</code> matches the current one while the entity isn't <code>dead</code>, <code>iskill</code> or in the process of dying (<code>deathcoroutine</code> not being null). The cycle is done if it isn't. NOTE: technically, <code>lastpos</code> is set to the <code>transform</code>'s position if the player was free, but the condition failed one way or another, it's just that this doesn't change anything in practice because no one will read from it until the end of LateUpdate.</p> <p>Finally, the <code>transform</code>'s position is set to <code>lastpos</code> and if there was a <code>forcemove</code>, it is stopped.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateEmoticon/","title":"UpdateEmoticon","text":"<p>This is an update method called by LateUpdate, but it is able to be called externally via the <code>Emoticon</code> method. This updates the <code>emoticon</code> object.</p> <p>Every 10 frames (which means every 5 update cycle as LateUpdate only calls this method every 2 frames), the angles, position and <code>emoticonsprite</code>'s enabled are updated. The angles are set at 0.0 except for the y being the camera's y angle, the position is set to <code>emoticonoffset</code> + Vector3.up * <code>height</code> + <code>extraoffset</code> and the sprite's enabled is set to <code>incamera</code>.</p> <p>Then, the method ensures the <code>emoticon</code> has a runtimeAnimatorController and if it doesn't, it's loaded from <code>AnimationControllers/_Misc/Emoticon/emoticon</code> from the root of the asset tree.</p> <p>Finally, the <code>emoticoncooldown</code> expiration logic ensures. If the cooldown hasn't expired yet, it is decreased by framestep and the <code>emoticonid</code> is played immediately on the <code>emoticon</code>.</p> <p>It should be noted that if the cooldown has expired, there is an unused feature where if it was set to higher than -100.0 (which is not possible normally without externally doing so), the -1 (blank) animation will play on the <code>emoticon</code> while setting <code>emoticoncooldown</code> to -101.0 to prevent from reaching this code path again. </p>"},{"location":"Entities/EntityControl/Update%20process/UpdateFlip/","title":"UpdateFlip","text":"<p>This update method is called by LateUpdate. It will update the digging states as well as the <code>spritetransform</code> angles as long as <code>overrideflip</code> is false.</p> <p>The method can either perform a <code>digging</code> update or a regular flip update, but it will only do the latter when the former doesn't apply.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateFlip/#digging-update","title":"Digging update","text":"<p>The <code>digging</code> one happens whenever <code>digging</code> is true and the entity isn't <code>dead</code>, <code>iskill</code> and <code>deathcoroutine</code> isn't in progress. In that case, a regular digging update happens when <code>diganim</code> is false (otherwise, <code>instdig</code> is set to false and the method ends). In such an update, the angles and scale of the <code>spritetransform</code> are adjusted such that the scale is the lerp between Vector3.zero and <code>startscale</code> with a factor of <code>digtime</code> / 30.0, and the angle is incremented by 15.0 on the y axis. </p> <p>Next is the <code>digpart</code> update which happens unless <code>nodigpart</code> is true which will just have the <code>digtime</code> be increased by the framestep and <code>instdig</code> being set to false. </p> <p>In that segment, if the <code>digtime</code> hasn't reached 30 frames yet, then the <code>digpart</code> 0 is initialised if it wasn't present so long as <code>insdig</code> is false and <code>digpart</code> 1 is moved offscreen if it exists followed by increasing <code>digtime</code> by framestep. The way <code>digpart</code> 0 is created involves instantiating <code>Prefabs/Particles/DirtFlying</code> rotated by -90.0 degrees on the x axis and childed to the <code>transform</code> with a position of zero. On top of this, if it has an Enemy <code>npcdata</code>, the material's renderqueue of that object is set to 3000.</p> <p>Otherwise, if the <code>digtime</code> had reached 30 frames, then <code>digpart</code> 0 is put offscreen while <code>digpart</code> 1 is ensured to be initialised. The creation process is very similar than <code>digpart</code> 0 on the other <code>digtime</code> branch, but the 2 differences is that the object instantiated is at <code>Prefabs/Particles/Digging</code> and the scale is <code>digscale</code>. Finally, <code>instdig</code> is set to false.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateFlip/#regular-flip-update","title":"Regular flip update","text":"<p>In this update, since it's established the entity isn't digging, <code>digtime</code> is set to 0.0 and both <code>digpart</code>s are moved offscreen if they were present.</p> <p>Next either <code>spritetransform</code> is rotated by <code>spin</code> if it has a non zero vector or regular flipping occurs as long as <code>overrideonlyflip</code> is false.</p> <p>If we are updating, this will adjust the scale and possibly angles of the <code>spritetransform</code>. The angles are adjusted except if it's <code>isplayer</code> and we are dashing, but the scaling is always adjusted to <code>truescale</code> except in the z axis if <code>flip</code> is true where that part is 0.0 - <code>truescale</code>.z. If the angles gets adjusted, only the y axis get adjusted. It will be changed to the lerp of the current y angle to 180.0 degrees when <code>flip</code> is true or 0.0 degree when it is false using the GetFlipSpeed method to get the value. This method normally returns the <code>flipspeed</code> (which is 0.2 normally), but it can be overridden to 1.0 with an instant flip if it has an <code>npcdata</code> with a <code>startlife</code> less then 50.0. Essentially, this progressively rotates the <code>spritetransform</code> towards the desired angle creating the flip effect.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateGeneralAnim/","title":"UpdateGeneralAnim","text":"<p>This update method is called by LateUpdate. It handles updates to the <code>sprite</code>'s sortingorder, the <code>line</code> if applicable and <code>extrasnims</code>.</p> <p>The sorting order of the <code>sprite</code> is set to the viewport point of the <code>transform</code>'s z * 1000.0 which ensures the order respects the actual depths as seen by the camera.</p> <p>If there is a <code>line</code>, the positions of it are set to be from the own <code>line</code>'s transform to the second position in the LineRenderer's position array.</p> <p>Finally, if there are <code>extraanims</code>, all their speed are set to the <code>anim</code>'s speed if they didn't match already.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateGround/","title":"UpdateGround","text":"<p>This update method is called by LateUpdate. It updates the <code>ccol</code>'s physics material frictions and the <code>jumpcooldown</code>.</p> <p>The <code>ccol</code> physics material update applies except if it's a <code>npcdata</code> of <code>Pushrock</code>. The staticFriction and dynamicFriction of the material are either set to 1.0 or 0.0 depending on specific conditions:</p> <ul> <li>If <code>onground</code>, the <code>deltavelocity</code>'s magnitude is lower than 0.2 and <code>jumpcooldown</code> is expired<ul> <li>Then 1.0 is set to the friction unless the <code>transform</code> is the player's and the animstate isn't <code>Walk</code> and <code>hitwall</code> is false in which case, 0.0 is set to the friction values</li> </ul> </li> <li>0.0 is set to the friction values otherwise.</li> </ul> <p>Finally, if the <code>jumpcooldown</code> is still active, it is decreased by framestep.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateHeight/","title":"UpdateHeight","text":"<p>This update method is called by LateUpdate. It will adjust the <code>spritetransform</code>'s local position unless <code>overrideheight</code> is true.</p> <p>First, prechecks are done if the adjustment is needed which only happens if the entity is not the player AND that it's not an <code>npcdata</code> of type Object.</p> <p>From there, 3 outcomes are possible (only one happens, they are checked in order):</p> <ul> <li><code>height</code> is higher than 0.1: the position is adjusted by taking the existing position in x and z, but having the y be <code>height</code> + Sin(Time.time * <code>bobrange</code>) * <code>bobspeed</code> and the resulting vector has <code>extraoffset</code> (by default zero) added to it. This will oscillate the entity up and down.</li> <li>It is not an <code>item</code>: the position is set to the existing one, but with a y of 0.0 and the resulting vector gets <code>extraoffset</code> (by default zero) added to it</li> <li>Since it's an item with the <code>height</code> being too small, nothing happens on this cycle.</li> </ul>"},{"location":"Entities/EntityControl/Update%20process/UpdateItem/","title":"UpdateItem","text":"<p>This is an update method that only applies to item entities. It only does anything if the <code>sprite</code> exists.</p> <ul> <li>The <code>sprite</code> is disabled if the <code>animid</code> is 3 (this is a Crystal Berry)</li> <li>If the <code>animid</code> is 0 or 1 (this is a standard or key item), the <code>sprite</code> is assigned to the corresponding <code>itemsprite[0, x]</code> where x is the <code>itemstate</code> which is the item id.</li> <li>If the <code>animid</code> is 2 (this is a medal), the <code>sprite</code> is assigned to the corresponding <code>itemsprite[1, x]</code> where x is the <code>itemstate</code> which is the medal id. There is an exception to this: if flag slot 681 is true (MYSTERY? is active), <code>overridemovesmake</code> is false and <code>itemstate</code> isn't 59 (Extra Freeze), the <code>sprite</code> is assigned to <code>guisprites[190]</code> instead (the ? medal sprite)</li> </ul> <p>After everything, if the <code>sprite</code> is enabled with a backing sprite, the local position of <code>spritetransform</code> is set to (0.0, the y extend of the <code>sprite</code>'s sprite, 0.0).</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateMoveSmoke/","title":"UpdateMoveSmoke","text":"<p>This update method is called both on LateStart and LateUpdate. It handles the enabling of <code>movesmoke</code> and adjusting its local position. This method only applies if <code>movesmoke</code> is present.</p> <p>First, we ensure the object is active if it wasn't already. Then, its local position is either set to zero or offscreen. The former happens if <code>overridemovesmoke</code> is false, the <code>height</code> is 0.0, the entity isn't <code>dead</code>, the animstate is <code>Walk</code> or <code>Chase</code>, we are unpaused, the <code>npcdata</code> is either not present or its <code>freezecooldown</code> has expired, the <code>sprite</code>'s alpha is higher than 0.9 and we aren't <code>digging</code>.</p> <p>Otherwise, it is moved offscreen.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSound/","title":"UpdateSound","text":"<p>This update method is called on LateUpdate, but also on PlaySound. It handles adjusting the <code>sound</code>'s volume and panStereo. This method only applies when <code>sound</code> is present and for anything except <code>npcdata</code> of <code>MusicRange</code>.</p> <p>First, the panStero is adjusted if the <code>sound</code> is playing to the <code>campos</code>'s x mapped lerped from -1.0 to 1.0 and then clamped to the proper side depending on the <code>transform</code>'s actual x position. For example, if the entity is positioned relatively to the left of the camera, the clamp will be from -1 to 0, but from 0 to 1 if it was positioned more to the right and from -1 to 1 if both x exactly match. This essentially helps to account both the viewport position and the actual position to determine where to pan the <code>sound</code>.</p> <p>Finally, the volume is adjusted. When unpaused, the new <code>sound</code>'s volume is adjusted to <code>soundvolume</code> * the game's soundvolume or the pausemenu's svolume if the game is paused at the Settings or Key Bindings window.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/","title":"UpdateSprite","text":"<p>This update method is called by LateUpdate. It handles <code>sprite</code> related adjustments as well as complex animation related updates.</p> <p>Since this is a complex update method, a more detailed series of steps will be described, but basically, this method has 3 segments.</p> <p>The first one involves updating the sprite and its animation under most conditions. The second segment involves disabling the sprites and animations if those conditions weren't met earlier and the <code>animid</code> was -1 (None). Finally, the third sets the <code>sprite</code>'s material renderQueue under specific conditions.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/#sprites-and-animation-updates","title":"Sprites and animation updates","text":"<p>This is the main update segment of the method where <code>animid</code>, <code>animstate</code> and sprites related matters are updated. It is done for any <code>animid</code> above -1 (meaning it's not None) and also whenever any of the following changes:</p> <ul> <li><code>inice</code> (only counts as long as the entity <code>hasiceanim</code> otherwise, this is ignored)</li> <li><code>animid</code></li> <li>animstate</li> <li><code>backsprite</code></li> <li><code>talking</code></li> <li><code>flyinganim</code></li> </ul> <p>The way the game tracks changes to these is with internal fields that stores the previous value of each of these. They are only assigned at the end of this update segment no matter the entity. They are (in the same order):</p> <ul> <li><code>lastice</code></li> <li><code>oldid</code></li> <li><code>oldstate</code></li> <li><code>oldback</code></li> <li><code>oldtalk</code></li> <li><code>oldfly</code></li> </ul> <p>It means essentially that this segment only applies if any of these fields changed and that the <code>animid</code> is defined.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/#item-animation-updates","title":"Item animation updates","text":"<p>If it's an item entity, the update is mostly simplified to UpdateItem which sets the sprite of the item to <code>itemstate</code> as the Items or Medal id and using the <code>animid</code> as the type of item (0 is standard item, 1 is key items, 2 is medals and 3 is Crystal Berry which disables the sprite). This method also makes sure that the MYSTERY? icon is rendered when applicable. Finally, if the sprite is kept enabled by the end of that method, its local position's y is set to the sprite's extents.y.</p> <p>If it's not an item, several updates are done.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/#non-item-animation-updates","title":"Non item animation updates","text":"<p>First, if the animid changed and there is no <code>model</code>, then this is handled by first calling <code>SetDialogueBleep</code> which updates the bleeps for the new <code>animid</code>. Then, <code>anim</code> is ensured to be initialised by either called <code>ForceAnimator</code> if it wasn't or <code>SetAnimator</code> + UpdateAnimSpecific if it was. The only difference is that <code>ForceAnimator</code> will create the <code>anim</code> if needed, but the rest ends up being the same because <code>ForceAnimator</code> also calls UpdateAnimSpecific after a <code>SetAnimator</code> call.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/#setanimator","title":"SetAnimator","text":"<p>What <code>SetAnimator</code> does is to ensure the <code>anim</code>'s controller is correctly set. This is also where PUSHROCK overrides and where the Hard Mode medal on HARDEST overrides the controller when applicable. Essentially, the logic works like this:</p> <ul> <li>If the <code>original</code> id is 132 (<code>Tanjerin</code>) under PUSHROCK, it is overriden to the <code>Beetle</code> one with the <code>animid</code> being 1</li> <li>If HARDEST is active on the <code>playerentity</code> with Hard Mode equipped, the controller is overriden to the <code>Pillbug</code> one</li> <li>Under PUSHROCK, for any entity that doesn't have a <code>model</code>, the controller is overriden to <code>Tanjerin</code> except for <code>Cerise</code> and <code>TangySeller</code> as well as <code>overridefly</code> and <code>overridejump</code> being set to true</li> <li>If none of the above applies, the controller is set to be the AnimID's normal one</li> </ul> <p>Next comes the digging handling. If the entity is <code>digging</code> and it has a <code>diganim</code>, its animstate is overridden to <code>Dig</code> if it was <code>Idle</code> or <code>DigMove</code> if it was <code>Walk</code>.</p> <p>Finally, this is where the SetAnim call happens. The logic goes like this (checked in order, only the first branch that applies executes):</p> <ul> <li>The <code>f</code> argument is sent if <code>overridefly</code> is false, the <code>height</code> is higher than 0.1 and the animstate is among the following: <code>Idle</code>, <code>Walk</code>, <code>ItemGet</code>, <code>Chase</code>, <code>ItemWalk</code>, <code>Sleep</code>, <code>Hurt</code>, <code>BattleIdle</code> or <code>Woobly</code>. The <code>ft</code> argument is sent if on top of this if <code>notalk</code> is false and the entity is <code>talking</code>.</li> <li>Only the <code>t</code> argument is sent if the animstate is a Predefined animations names, the entity is <code>talking</code> while <code>notalk</code> is false. This also set <code>backsprite</code> to false.</li> <li>Only the <code>b</code> argument is sent under the following conditions:<ul> <li>We aren't in PUSHROCK</li> <li>We either aren't in a battle or we are in a battle event</li> <li><code>backsprite</code> is true</li> <li>The animstate is <code>Idle</code>, <code>Walk</code> or <code>Jump</code></li> <li>The <code>originalid</code> is <code>Bee</code>, <code>Beetle</code>, <code>Moth</code>, <code>Madeleine</code> or <code>BLANK</code></li> </ul> </li> <li>If none of the above applies, no arguments are sent</li> </ul> <p>After the SetAnim call, <code>backsprite</code> is set to false for any animstate that isn't <code>Idle</code>, <code>Walk</code>, <code>Jump</code> or <code>Fall</code>.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/#sprite-enabled-adjustment-according-to-the-model","title":"Sprite enabled adjustment according to the model","text":"<p>This part is done regardless if the entity is an <code>item</code> or not.</p> <p>Whether or not the <code>sprite</code> can get enabled depends on the values of <code>nomodel</code> and whether there is a <code>model</code> present. <code>nomodel</code> being true forces the <code>sprite</code> to be enabled, but if it's not, it is enabled if <code>model</code> isn't present and disabled otherwise.</p> <p>However, this adjustment won't happen if <code>overrideanim</code> is true or that there is an <code>npcdata</code> of the <code>Enemy</code> with a <code>disguideobj</code> present.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/#final-adjustements","title":"Final adjustements","text":"<p>This part is done regardless if the entity is an <code>item</code> or not.</p> <p>AnimSpecificQuirks is called if <code>inince</code> or the animstate has changed. If this happens, this is the second call of LateUpdate because this method was called before.</p> <p>Finally, this is where the old fields are set to their current one and it ends this segment.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/#disabling-sprites-and-animations","title":"Disabling sprites and animations","text":"<p>This happens if the regular update segment didn't occured as long as the <code>animdid</code> is -1 (none). First, the <code>anim</code>'s runtimeAnimatorController is set to null if we didn't had an <code>npcdata</code> or the <code>originalid</code> was -1 (None) to start with.</p> <p>Lastly, unless <code>overrideanim</code> is true, both the actual sprite of the <code>sprite</code> is set to null and <code>sprite</code> is disabled if it wasn't.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateSprite/#renderqueue-adjustment","title":"renderQueue adjustment","text":"<p>This segment happens for any entity where <code>hologram</code> is false and that either it's a <code>battle</code> entity or that it has no <code>npcdata</code> or it has one, but it's either not an NPC type or if it is one, its <code>startlife</code> is less than 50.0.</p> <p>When it gets executed, the <code>sprite</code>'s material renderQueue is set to 2450 if the alpha was higher than 0.9 or it is set to 3000 otherwise.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateStatusIcons/","title":"UpdateStatusIcons","text":"<p>This update method is called on LateUpdate. It handles the management of <code>statusicons</code>, <code>statuscooldown</code> and <code>statusid</code> for cycling the status icons display. This method is only applicable when <code>statusicons</code> is present and not empty.</p> <p>This method may do one of 3 possible things (checked in order):</p> <ul> <li>If we are currently in a battle and we are selecting Chompy's action or it's currently the enemy's phase or we are in a battle event, then all the <code>statusicons</code> are disabled if any weren't with the <code>statuscooldown</code> reset to 0.0</li> <li>If <code>statuscooldown</code> hasn't expired yet, it is decreased by framestep and nothing happens after</li> <li>On the other hand, if it has expired, then <code>statusid</code> is incremented (with wrap around to 0 if needed). From there, all <code>statusicons</code> are disabled except for the one with the index <code>statusid</code> which basically cycles the icon shown each time the <code>statuscooldown</code> expires. After, <code>statuscooldown</code> is set to 60.0</li> </ul> <p>Basically, this method will cycle every <code>statusicon</code> each second unless specific battle conditions mandates to not show any of them.</p>"},{"location":"Entities/EntityControl/Update%20process/UpdateVelocity/","title":"UpdateVelocity","text":"<p>This update method is called by LateUpdate. It handles adjustements of the <code>rigid</code>'s velocity and the <code>startscale</code>.</p> <p>First, we check if the velocity should be clamped. The condition to check is very similar to the one in LateUpdate which means most calls will end up performing this part, but there is one exception. While the method checks for the <code>npcdata</code>'s <code>istrapped</code> to be false which LateUpdate doesn't do, it only has any effect if none of the other prerequisite are true, but they are all present on LateUpdate except the check for a <code>battle</code> entity. This means if it's a <code>battle</code> entity, it may not execute if the <code>npcdata</code> has a <code>trapped</code> of false and has the type <code>NPC</code> on odd frame count. In practice, this doesn't happen because a <code>battle</code> entity wouldn't have an <code>npcdata</code> which always satisfy both checks. The frame count for both LateUpdate and this method are based on parity so regardless of what happens, this will execute every 2 frames.</p> <p>The actual clamping can be done in 3 ways depending on the conditions (checked in order):</p> <ul> <li>It's an item entity: The <code>rigidi</code>'s velocity is clamped from (-10.0, -20.0, -10.0) to (10.0, 10.0, 10.0)</li> <li>It's the player and they are dashing: Only the y velocity is clamped from -20.0 to <code>jumpheight</code> * 1.5</li> <li>If neither of the above are true, then the x and z are clamped from -10.0 to 10.0 and the y is clamped from -20.0 to infinity</li> </ul> <p>Next, if <code>shrink</code> is true, then the <code>startscale</code> is lerped from itself to zero with a factor of framestep * 0.09</p> <p>Finally, the y velocity is zeroed if <code>onground</code>, the existing y velocity is under -5.0 and either the <code>npcdata</code> is not present or it is with a <code>dizzytime</code> \\&lt;= 0.0</p>"},{"location":"Entities/EntityControl/Update%20process/Unity%20events/FixedUpdate/","title":"FixedUpdate","text":"<p>This is the FixedUpdate of EntityControl. It only applies when the game isn't paused. Only 2 updates happens here: <code>forcemove</code> updates and Leif's position when <code>leiffly</code> is true.</p>"},{"location":"Entities/EntityControl/Update%20process/Unity%20events/FixedUpdate/#force-move-updates","title":"Force move updates","text":"<p>This only applies if <code>forcemove</code> is true.</p> <p>The game first checks the square distance left before its <code>forcetarget</code> using <code>ignorey</code> as whether or not to consider the y axis. The <code>forcemove</code> is considered incomplete unless that square distance is 0.3 or lower.</p> <p>If it has yet to complete, Move is called towards the <code>forcetarget</code> with a multiplier of <code>forcemultiplier</code> * the same square distance clamped from 0.0 to 1.0 and an animstate of <code>forceanim</code> during the move. </p> <p>After, if <code>forcejump</code> is true, the entity will check to see if it should call <code>Jump</code>. To do so, <code>detect</code> is created via <code>CreateDetector</code> if it wasn't already and it is set to look at <code>forcetarget</code> with the x and z angles zeroed out and then verify that <code>hitwall</code> is true, the entity is <code>onground</code> and <code>jumpcooldown</code> has already expired. Only if all these conditions are met that Jump is called.</p> <p>If the whole <code>forcemove</code> was instead completed, <code>forcemove</code>, <code>forcejump</code> and <code>ignorey</code> are set to false before calling StopMoving with the <code>forcestop</code> as the target state.</p>"},{"location":"Entities/EntityControl/Update%20process/Unity%20events/FixedUpdate/#leif-fly-update","title":"Leif fly update","text":"<p>This segment only applies when <code>leiffly</code> is true, the player is present and we aren't in an event.</p> <p>The only thing this segment does is change the local position to a lerp between the current position and the player's position + the player's entity.<code>spritetransform</code>.right.normalized * 1.5 + the forward direction of the camera * 0.2 all done with a factor of framestep * 0.05. This basically moves Leif towards the direction he was facing and slightly forward.</p>"},{"location":"Entities/EntityControl/Update%20process/Unity%20events/LateUpdate/","title":"LateUpdate","text":"<p>This is the LateUpdate of EntityControl. This is the main update loop of the component and it is done on late due to the guarantee that coroutines have all ran by then so anything that could have edited the fields like the animstate have done so already.</p> <ul> <li>Every 3 frames<ul> <li>If paused, ensure the <code>transform</code>'s position is <code>pausepos</code> unless <code>activeonpause</code> is true, we are in an event, <code>iskill</code> is true or <code>dead</code> is true</li> <li>Calls <code>UpdateCamPos</code> which updates <code>incamera</code>  with whether the entity is in the main camera range (ranging from (-0.6, -1.25) to (1.6, 2.25) in viewport coordinate while also being higher than -1 on the z axis) or true if <code>alwaysactive</code> is true, <code>camdistance</code> to the distance of the entity to the main camera and <code>campos</code> being the viewport position of the entity using the main camera</li> </ul> </li> <li>Ensure <code>latetrans</code>'s position is set to <code>latepos</code> when applicable</li> <li>If we aren't paused and there's a <code>forcemove</code> in progress, handle the failsafe logic<ul> <li>Decrease the <code>forcetimer</code> by framestep if <code>playerentity</code> is true or that either <code>alwaysactive</code> is true or the entity is <code>incamera</code> and is within 30.0 units on the z axis unless <code>disabletimer</code> is true which will bypass this decrease for any entity except <code>playerentity</code></li> <li>If the <code>forcetimer</code> expired, the entity isn't <code>digging</code> and the player isn't free or it's not a <code>playerentity</code> then the failsafe will take effect by setting the <code>transform</code>'s position to <code>forcetarget</code>. Smokes will appear at the entity position before the failsafe and at <code>forcetarget</code> after the failsafe if it isn't <code>shrink</code> and its scale's magnitude is higher than 0.2.</li> </ul> </li> <li>Handle the numb animation update logic if it is a battle entity while we are in a battle, the entity isn't <code>dead</code> or <code>iskill</code>, the battledata of the entity at <code>battleid</code> indicates <code>isnumb</code> and the battle hasn't <code>cancelupdate</code> by calling Numb. This method handles setting the animstate accordingly as well as randomly displacing the entity every once in a while with a yellow color</li> <li>Handles the <code>bubbleshield</code> position update if it is present<ul> <li>If the scale's magnitude is higher than 0.15, the default is to set the local position of the <code>bubbleshield</code> to (0.0, <code>height</code> + 1.25, 0.0), but <code>overrideshieldpos</code> being true can change this to be (<code>overrideshieldpos</code>.x, <code>height</code> + <code>overrideshieldpos</code>.y, <code>overrideshieldpos</code>.z)</li> <li>Otherwise, the local position is set offscreen to (0.0, -999.0, 0.0)</li> </ul> </li> <li>If the <code>hpbar</code> is present and active, ensure its local position is at (0.0, -0.5 + camoffset.y - battlecampos.y, 0.0) unless it's a <code>KeyR</code> which changes the x to 0.5 or a <code>Pitcher</code> which changes the x to -0.5</li> <li>If the <code>sprite</code> is present and the <code>animid</code> isn't <code>None</code> (-1), RefreshTrail is called which will update the <code>traildata</code> according to <code>trail</code></li> <li>Ensure the <code>transform</code> is childed to the map if it's a <code>tempfollower</code> and the <code>transform</code> doesn't have a parent already</li> <li>If <code>setup</code> is false, call LateStart</li> <li>As long as the game isn't paused, call Follow which updates the following procedure</li> <li>If <code>alwaysflip</code> is true, call UpdateFlip</li> <li>If the game is unpaused and <code>incamera</code>, the <code>incamera</code> update will happen if we are in an event OR that the <code>campos</code> z is less than 25.0 OR less than 30.0 only if the <code>npcdata</code>'s <code>startlife</code> is smaller than 50.0 / not present<ul> <li>Assign <code>truescale</code> to <code>startscale</code></li> <li>If the <code>icecube</code> is present, set its scale by a lerp of its current scale to <code>freezesize</code> with a factor of framestep * 0.25 and set its position by <code>freezeoffset</code> + Vector3.up * <code>height</code> or by (<code>freezeoffset</code>.x + Random.Range(-0.1, 0.1), <code>freezeoffset</code>.y + <code>height</code>, <code>freezeoffset</code>.z + Random.Range(-0.1, 0.1)) if <code>shakeice</code></li> <li>If <code>springcooldown</code> is active while the <code>rigid</code>'s velocity is descending on the y axis or <code>onground</code> is true, deactivate the cooldown</li> <li>General update methods are called under conditions:<ul> <li>UpdateGround, UpdateAirAnim and UpdateVelocity are called every 2 frames except for <code>battle</code> entity or the <code>npcdata</code> is not NPC / not present where they will be called regardless of the current frame</li> <li>UpdateGeneralAnim is called every 2 frames</li> <li>UpdateEmoticon is called when in an event or it is a <code>battle</code> entity or every 2 frames</li> <li>UpdateMoveSmoke is called every 3 frames</li> <li>RefreshShadow is called when <code>isfollower</code> is true and the player is flying OR that there is no <code>npcdata</code> OR that it has one but it's also an Enemy, a SemiNPC for every 10 frames or it's an NPC/Object every 2 frames in addition that the <code>insideid</code> matches the current one</li> <li>UpdateStatusIcons and UpdateSound are always called</li> <li>UpdateFlip is called either when we are not in a battle or the entity itself is a <code>battle</code> entity (if <code>alwaysflip</code> was true, this is means this can be called a second time)</li> </ul> </li> </ul> </li> <li>Otherwise, the inactive update will happen<ul> <li>The entity is muted when applicable when <code>soundonpause</code> is true OR that it's not a battle battle and it either has no <code>npcdata</code> or it has one, but it's a <code>MusticRange</code> Object, otherwise, UpdateSound is called instead</li> <li>Reset the <code>emoticon</code> to none and the <code>emoticoncooldown</code> to 0.0 when applicable</li> <li>Deactivate the <code>movesmoke</code> if it is present and enabled</li> </ul> </li> <li>This is the general update handling when unpaused that applies to all entities<ul> <li>Every 3 frames, <code>UpdateRotater</code> is called which will make sure the <code>rotater</code>'s y angle matches the main camera one unless <code>lockrotater</code> is true. If we were not in an event UpdateCollider is called before it, but because this one only process every 2 frames, it will actually only process every 6 frames effectively.</li> <li>Rendering updates happen if the entity is <code>incamera</code>, it is a <code>battle</code> entity or that we are in an event<ul> <li>UpdateHeight is called when it's a battle entity or we are in an event or <code>alwaysactive</code> is true or it has no <code>npcdata</code> or it has one, but it's not an NPC or it is an NPC, but the <code>startlife</code> is below 50.0</li> <li>AnimSpecificQuirks and UpdateSprite are called</li> <li><code>flyinganim</code> is set to true if the <code>height</code> is higher than 0.1 unless <code>overridefly</code> is true which forces it to false</li> </ul> </li> <li>If we aren't in an event, then <code>offgroundframes</code> is increased by framestep if it hasn't reached 1000.0 and that <code>onground</code> is false, otherwise, it is set to 0.0. If we are in an event, that it is decreased by framestep if <code>onground</code> is true and it hasn't gone below 0.0</li> <li>If the <code>jumpcooldown</code> has expired and <code>stopspinonground</code> is true, it is set to false on top of zeroing out <code>spin</code></li> </ul> </li> <li><code>lastpos</code> is set to the <code>transform</code>'s position</li> <li><code>oldground</code> is set to <code>onground</code></li> </ul>"},{"location":"Entities/EntityControl/Update%20process/Unity%20events/OnTriggerExit/","title":"OnTriggerExit","text":"<p>This acts as the counterpart to OnTriggerStay. If the other collider has the <code>FlowerBed</code> tag, <code>flowerbed</code> is destroyed if it was present. Same for the <code>IceRadius</code> tag which causes <code>inice</code> to be set back to false.</p>"},{"location":"Entities/EntityControl/Update%20process/Unity%20events/OnTriggerStay/","title":"OnTriggerStay","text":"<p>This event only does anything every 2 frames.</p> <p>First, <code>flowerbed</code> is set if it's not an item entity and the other collider has the <code>FlowerBed</code> tag. Its position will be (0.0, 0.65, 0.0).</p> <p>Finally, if the other collider has the <code>IceRadius</code> tag, <code>inice</code> is set to true.</p>"},{"location":"Entities/EntityControl/Update%20process/Unity%20events/Update/","title":"Update","text":"<p>This is the Update of EntityControl. It doesn't do as much as LateUpdate</p> <ul> <li>Check if the entity should receive updates which only happens when unpaused, minipause isn't active, the message lock is released and the entity isn't dead. This can be overriden with <code>activeonpause</code><ul> <li>Follow the standard animation speed update logic unless <code>overrideanimspeed</code> is true which will set the animation speed to 1.0 if there's no <code>icecube</code> and to 0.0 if there is one on top of forcing the animstate to <code>Hurt</code></li> <li>Make sure the <code>sprite</code> is disabled if this is the player entity and is a submarine, otherwise<ul> <li>Toggle the sprite being enabled if the <code>icooldown</code> hasn't expired yet and the player is free (meaning it is present, no minipause or pause, not in an event, the message lock is released, and the player isn't digging)</li> <li>Ensure the sprite is enabled if it's not an item and it has no <code>npcdata</code> or it has one and it doesn't have a <code>disguiseobj</code></li> <li>Ensure the child of the sprite are enabled or disabled according to the main sprite's enabled unless the <code>npcdata</code> is present and its <code>trapped</code> is true</li> </ul> </li> <li>Decrease the <code>icooldown</code> with the framestep</li> <li>Handle the restore of the entity when unpausing happend:<ul> <li>The <code>rigid</code>'s useGravity is set to <code>lastgravity</code></li> <li>The <code>sound</code>'s volume is set to <code>lastvolume</code></li> <li>The <code>rigid</code>'s velocity is set to <code>lastvelocity</code></li> <li><code>lastvelocity</code> and <code>pausepos</code> are put back to null</li> </ul> </li> </ul> </li> <li>Handle pausing updates, if we are paused<ul> <li>Unless <code>lastvelocity</code> already had a value (which means this is the first frame of being paused) the pause states are saved<ul> <li><code>pausepos</code> is set to the <code>transform</code>'s position</li> <li><code>lastgravity</code> is set to the <code>rigid</code>'s useGravity</li> <li><code>lastvolume</code> is set to <code>sound</code>'s volume</li> <li><code>lastvelocity</code> is set to the <code>rigid</code>'s velocity</li> <li>gravity is disabled on the <code>rigid</code></li> <li>The <code>sound</code> is muted</li> <li>The <code>rigid</code>'s velocity is zeroed</li> </ul> </li> <li>If not in a battle, ensure the animation speed is set to 0.0 and then call StopMoving with the current animstate which will zero the <code>rigid</code>'s velocity and the <code>deltavelocity</code>. Otherwise, ensure the animation speed is 1.0</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/","title":"ActionBehaviors","text":"<p>An <code>ActionBehaviors</code> is an enum type that represents a behavior which has some logic to perform on the active main section of Update. It only applies to all NPCType except Object.</p> <p>There are 2 <code>ActionBehaviors</code> defined in NPCControl data with the first one being the default one and the second one being only used when <code>inrange</code> is true. Each comes with an <code>actionfrequency</code> field that has a different meaning depending on the behavior.</p> <p>The actual execution of the behavior is done by DoBehavior called by Update which receives the appropriate frequency, but only on the main active section. This means that it is only called when the NPCControl is considered active and a main update occurs (which excludes the special cases of an Enemy when it is dizzy, about to be unfrozen or frozen).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/#enum-table","title":"Enum table","text":"<p>The following is a table of the different enum values (NOT REFERENCED means the game never reference the value meaning it has not logic backing it, UNUSED means the behavior has logic, but it is either dead or not practically used under normal gameplay):</p> Value Name Summary 0 None Stops any force move on the entity. 1 FacePlayer Stops any force move on the entity and causes the entity to face towards the player if it is present. 2 ChasePlayer Approach the player as close as possible within the <code>radiuslimit</code> or until there is no more ground to move in the direction of the player. 3 FleeFromPlayer Stops any force move on the entity and have it move towards the opposide direction from the player. 4 TurnRandomly Stops any force move on the entity and periodically causes the entity.<code>flip</code> to toggle which turns the entity using a somewhat random time interval. 5 Wander Periodically performs a MoveTowards call after a random amount of time passed on the entity to a random position or the closest possible before unable to move further towards it. The range of movement, maximum time period to wait between wanders and the max distance to move to between wanders are all configurable. 6 FaceAwayFromPlayer Stops any force move on the entity and causes the entity.<code>flip</code> to be set such that the sprite faces the opposite direction of the player horizontally. 7 TurnFixedInterval Stops any force move on the entity and periodically causes the entity.<code>flip</code> to toggle which turns the entity using a fixed time interval. 8 Disguise A behavior where the map entity has a special <code>disguiseobj</code> that will replace its normal entity.<code>sprite</code> appearence until the behavior is switched away from which reveals the entity.<code>sprite</code> (usually by going into the <code>inrange</code> one). After coming back to this behavior (usually by going out of <code>inrange</code>), the entity will move back to its <code>startpos</code> and put its disguise on again. 9 DisguiseOnce The same than <code>Disguise</code>, but if it's the default behavior, it becomes <code>Wander</code> whenever the player gets <code>inrange</code> and the <code>disguiseobj</code> is destroyed. 10 FollowPlayer NOT REFERENCED 11 WalkAwayFromPlayer UNUSED, This is an alias of <code>FleeFromPlayer</code> 12 FaceAhead Stops any force move on the entity and causes the entity to face towards the right vector of this entity (towards their x axis facing direction). 13 FaceBehind Stops any force move on the entity and causes the entity to face towards the left vector of this entity (the opposite direction of their x axis direction) 14 FaceUp Stops any force move on the entity and causes the entity to face towards the forward vector of this entity (usually away from the camera). 15 FaceDown Stops any force move on the entity and causes the entity to face towards the backward vector of this entity (usually towards the camera). 16 SetPath Periodically performs MoveTowards calls on the entity using a fixed configurable interval between moves and the path being made of position nodes defined in <code>vectordata</code>. 17 ChargeAtPlayer Charges at the player with <code>attacking</code> set to true during the movement towards the player (this will allow an Enemy to initiate a battle with the advantage if it collides with the player and all conditions are met to start a battle with the advantage). 18 ChargeAtPlayerFlipSprite The same then <code>ChargeAtPlayer</code>, but right after the MoveTowards call on the entity, the entity.<code>sprite</code> has its angles set to (0.0, the y angles facing the player + 90.0, 0.0) with an <code>overrideonlyflip</code> which locks the entity.<code>sprite</code> facing direction until the charge part of the coroutine is over. 19 ShootProjectile Attacks the player by shooting an OverworldProjectile which can, under the right conditions, start a battle with advantage. The specifics of the projectile logic is dependant on the animid and only a few have a logic defined for this behavior. 20 ShootProjectilePredict UNUSED, An alias of <code>ShootProjectile</code>. 21 ChargeAndAttack The same than <code>ChasePlayer</code>, but also attacks the player (with <code>attacking</code> set to true during the attack) where the actions depends on the AnimID when getting closer than a configurable threshold. Only a few animIds have an attack logic defined for this behavior. 22 AlwaysWander UNUSED, A very cut down version of <code>wander</code> where the entity will always, when it can, move somewhere on the next DoBehavior cycle even if it is in the process of moving already. 23 Unmoveable Prevents an Enemy with this behavior (either default or <code>inrange</code>) to not move during the Dizzy process. This doesn't have any logic, its presence is what affects the NPCControl. 24 ChargeAttackUnderground The same than <code>ChargeAndAttack</code>, but the behavior always makes the entity <code>digging</code> when not attacking and it can only attack after 30.0 frames of <code>digtime</code>. 25 WanderUnderground The same than <code>Wander</code>, but the entity immediately starts digging underground before actually wandering. 26 StealthAI Gives the ability of the NPCControl to spot the player if it enters its field of vision (represented by 2 trigger colliders) which has the effect of triggering an event. The event id and the wideness of the field of vision are configurable as well as an option to set the entity.animstate to <code>Sleep</code> at the start of the DoBehavior cycle. 27 SetPathJump Similar than <code>SetPath</code>, but after the MoveTowards call, the entity <code>forcejump</code> is set to true which makes it jump during its FixedUpdate when moving to the next node if possible. 28 DisguiseOnceJumpForward UNUSED, A semi functional and likely unfinished behavior similar to <code>Disguise</code> that is recognised as a disguise behavior alongside <code>Disguise</code> and <code>DisguiseOnce</code>, but it doesn't have any DoBehavior logic. 29 ChangeSpriteInRandius When the player is present, the entity.animstate is set to <code>actionfrequency[0]</code> when the distance between this and the player is less than the <code>wanderradius</code>, it is set to <code>actionfrequency[1]</code> otherwise. 30 ChaseWhenAnim Perform the same logic than <code>ChasePlayer</code> when the entity.animstate is <code>Chase</code>. Otherwise, if the entity.<code>animstate</code> isn't the frequency, entity.<code>animstate</code> is set to it with a 20.0 frames <code>behaviorcooldown</code> (prevents a <code>WalkWhenAnim</code> doing a <code>Wander</code> DoBehavior cycle to process for 20.0 frames when entity.<code>animstate</code> is <code>Idle</code>) and a StopForceMove call on the entity. 31 WalkWhenAnim Perform <code>Wander</code> when the entity animstate is <code>Walk</code> (or <code>Idle</code> if the <code>behaviorcooldown</code> expired) or change it to the frequency when it's not with a <code>behaviorcooldown</code> of 20.0 frames (prevents another <code>Wander</code> cycle to process for 20.0 frames when entity.<code>animstate</code> is <code>Idle</code>). 32 WanderOffscreen The same than <code>Wander</code>, but movements are allowed when inactive or paused. 33 WanderNoWarp The same than <code>Wander</code>, but the warp branch logic is disabled. This means even if <code>maxtries</code> reaches 20 or that the distance between this position and the entity.<code>startpos</code> gets higher than <code>radiuslimit</code>, the entity will not warp and continue as normal. 34 WanderOnWater The same than <code>WanderNoWarp</code>, but the y position is adjusted according to the map.<code>waterfloat</code> if one exists. 35 ChaseOnWater The same than <code>ChasePlayer</code>, but the y position is adjusted according to the map.<code>waterfloat</code> if one exists."},{"location":"Entities/NPCControl/Enemy/","title":"Enemy","text":"<p>An enemy is a non interactable entity that supports ActionBehaviors with the ability to initiate a battle encounter with the player consisting of up to 4 enemies. It also features special logic to handle all of this including cases where it's frozen or dizzy. It is the NPCType with the most exclusive logic available.</p>"},{"location":"Entities/NPCControl/Enemy/#data-arrays","title":"Data arrays","text":"<ul> <li><code>vectordata</code>: The list of random standard item the enemy can potentially drop in the x components of each element when EntityControl.Death is called on the entity. For the drop to happen on a given element, its y component (if it's not negative) must correspond to a flag slot whose value is true. If any element's y component is -2 however, the first occurence where this is the case will override the drop as it means this will dropped as a key item and it will also bypass the random check performed by EntityControl.Death</li> <li><code>battleids</code>: The array of enemy ids this battle encounter consist of</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#additional-data","title":"Additional data","text":"<ul> <li><code>limit[0]</code>: The <code>activationflag</code> of the key item drop Item object if the y component of any elements of <code>vectordata</code> is -2. This also serves as the first limit like regular NPCControl</li> <li><code>eventid</code>: If it's not 0, the <code>respawntimer</code> value whenever the enemy entity.<code>iskill</code> goes to true</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#start-setup","title":"Start / SetUp","text":"<p>The <code>arrow</code> is initialised to a new HelpArrow parented to the NPCControl of color cyan with offset (0.75, 0.75, 0.75) with a distance of the entity.<code>freezesize.x</code> * 2.0 clamped from 2.5 to the entity.<code>freezesize.x</code> * 3.5. This prepares the help arrow to render should the enemy gets frozen. Its <code>lockcooldown</code> is set to true on Update as long as <code>freezecooldown</code> is above 0 (the enemy is frozen).</p> <p>If the <code>eventid</code> is above 0 (we have a <code>respawntimer</code> feature), the entity.<code>alwaysactive</code> is set to true.</p>"},{"location":"Entities/NPCControl/Enemy/#update-non-dummy","title":"Update (Non <code>dummy</code>)","text":"<p>The <code>lockcooldown</code> of the <code>arrow</code> is set to true only if <code>freezecooldown</code> is above 0.</p>"},{"location":"Entities/NPCControl/Enemy/#update-active-main-logic-overrides","title":"Update (Active, main logic, overrides)","text":"<p>Only 1 of 3 cases happens here (checked in order):</p> <ul> <li>This is a frozen enemy (the <code>freezecooldown</code> hasn't expired yet)</li> <li>This is a frozen entity of any kind (it has an <code>icecube</code>, but in practice, this can only happen if an enemy is frozen because it's only on them that Freeze is called)</li> <li>This is a dizzy enemy (the <code>dizzytime</code> is above 0.0)</li> </ul> <p>Additionally, there's logic that happens as part of a standard active update exclusive to an enemy if none of the cases above applied and we aren't <code>trapped</code>.</p>"},{"location":"Entities/NPCControl/Enemy/#frozen-enemy","title":"Frozen enemy","text":"<p>If the entity.<code>rigid</code> y velocity is not between -0.1 and 0.1 inclusive, its x and z components are set to the <code>icevel</code> ones. Otherwise, <code>icevel</code> is set to Vector3.zero.</p> <p>The absolute position is clamped to be within a radius of <code>radiuslimit</code> where the center is at the entity.<code>startpos</code> ignoring the y component.</p> <p>The following occurs:</p> <ul> <li>The <code>pusher</code> is disabled if it was present</li> <li>The <code>dizzytime</code> is set to -1000.0</li> <li>The entity.<code>spin</code> is zeroed out</li> <li>The <code>disguisecooldown</code> is set to 120.0 and if a <code>disguiseobj</code> is present, it is disabled and the entity.<code>sprite</code> is disabled</li> <li>The entity.<code>emotioncooldown</code> is set to -1.0</li> <li><code>templayer</code> is set to the current layer if it was negative. This is done because this also causes the current layer to be set to 8 (Ground)</li> <li>If the entity doesn't have an <code>icecube</code>, Freeze is called on the entity. Otherwise, all collisions between the <code>scol</code> and the entity.<code>icecube</code> are ignored.</li> <li>If the <code>boxcol</code> isn't present, it is created non trigger with a size of the entity's <code>freezesize</code></li> <li>The center of the <code>boxcol</code> is set to the entity's <code>freezeoffset</code></li> <li>The <code>ccol</code> gets disabled</li> <li>The <code>boxcol</code> gets enabled</li> <li>The entity.<code>height</code> gets decreased by the game's frametime * 0.075 then clamped from 0.0 to 999.0</li> <li>If the <code>icecooldown</code> is below 100.0, the entity.<code>shakeice</code> is set to the invert of the entity.<code>inice</code>. Otherwise, the entity.<code>shakeice</code> is set to false</li> <li>If the entity is <code>onground</code> and not <code>inice</code> and we aren't in an <code>icemap</code>, the <code>freezecooldown</code> gets decreased by framestep</li> <li>If the entity is <code>onground</code>, the <code>freezeaircooldown</code> is set to 0.0. Otherwise, it is decreased by framestep on top of the <code>freezecooldown</code> being set to 0.0 if the <code>freezeaircooldown</code> was over 300.0</li> <li>entity.<code>animspeed</code> is seto to 0.0 and entity.<code>overrideanim</code> set to true</li> <li>If entity.<code>hasshadow</code> is true, the entity.<code>shadow</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#frozen-entity-about-to-be-unfrozen","title":"Frozen entity about to be unfrozen","text":"<p>It is assumed here that it's an enemy ready to be unfrozen, but this actually checks if entity.<code>icecube</code> exists to detect this.</p> <p>If the player is present and it is <code>standingon</code> this <code>boxcol</code>, then the player.entity.<code>onground</code> is set to false and its <code>standingon</code> to null. This means if the player was standing on the ice block, the game forces the ground detector and its <code>standingon</code> field to not report to be on it.</p> <p>BreakIce is called on the entity.</p> <p>The layer is set to <code>templayer</code> if it wasn't -1 before it is set to -1. This restores the value it had when the entity was frozen previously.</p> <p>The following occurs:</p> <ul> <li>entity.<code>shadow</code> is enabled if <code>hasshadow</code> was true</li> <li>entity.<code>ccol</code> is enabled</li> <li>entity.<code>boxcol</code> is disabled if it was present</li> <li>entity.<code>overrideanim</code> is set to false</li> <li>entity.<code>oldstate</code> is set to -1</li> <li>entity.<code>oldfly</code> is set from the opposite of <code>flyinganim</code></li> <li>entity.<code>behaviorroutine</code> is in progress, then SetAnim is called with force to true without arguments or <code>f</code> if the NPCControl <code>returntoheight</code> is true</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#dizzy-enemy","title":"Dizzy enemy","text":"<p>The <code>disguiseobj</code> is disabled if present.</p> <p>StartBattle is called if all of the following are true:</p> <ul> <li>It's been more than 20 frames since the <code>startlife</code></li> <li>We aren't in a <code>pause</code>, <code>minipause</code> or message</li> <li>The player is present and the distance between it and this enemey is &lt;= the entity.<code>ccol</code> radius + 1.1</li> </ul> <p>The following occurs:</p> <ul> <li>entity.<code>height</code> is decreased by - 0.075 clamped from 0.0 to 999.0</li> <li>entity.<code>spin</code> is set to (0, <code>dizzytime</code> / 5 clamped from 0.0 to 15.0, 0.0)</li> <li>entity.<code>overrideanim</code> is set to true</li> <li>The entity.animstate is set to 11 (Hurt)</li> <li>The entity.<code>emoticonid</code> is set to 1 (? emoticon) with an <code>emoticoncooldown</code> set to 10.0</li> <li>StopForceMove is called on the entity if the entity is <code>onground</code> and the <code>touchcooldown</code> had expired</li> <li><code>dizzytime</code> is decreased according to the game's frametime.</li> <li>The position is clamped to be within the radius <code>radiuslimit</code> where the center is the entity.<code>startpos</code> without consideration for the y component</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#update-active-main-logic-no-overrides","title":"Update (Active, main logic, no overrides)","text":"<p>These logic can happen as part of a standard active Update if none of the above cases applied and we aren't <code>trapped</code>.</p> <p>If the <code>dizzytime</code> is above -999.0, it is set to -1000.0 with the following adjustements being done on the entity which essentially ends the dizzyness:</p> <ul> <li>enity.<code>spin</code> gets zeroed out</li> <li>enity.animstate gets set back to entity.<code>basestate</code></li> <li>enity.<code>overrideanim</code> is set to false</li> </ul> <p>StartBattle is called if all of the following are true:</p> <ul> <li>It's been more than 20 frames since the <code>startlife</code></li> <li>We aren't in a <code>pause</code>, <code>minipause</code> or message</li> <li>The player is present and the distance between it and this enemey is \\&lt;= the entity.<code>ccol</code> radius + 1.1</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#update-inactive","title":"Update (Inactive)","text":"<p>For every 3 frames, if the entity is in a forcemove, StopForceMove is called on the entity except if it has a SetPath or StealhAI behavior</p>"},{"location":"Entities/NPCControl/Enemy/#lateupdate-non-dummy-and-entity-is-incamera","title":"LateUpdate (Non <code>dummy</code> and entity is <code>incamera</code>)","text":"<p>If the <code>eventid</code> is 0 and the entity <code>iskill</code> while we aren't in <code>pause</code>, <code>minipause</code> and <code>inevent</code>, some logic occurs depending on the <code>respawntimer</code>:</p> <ul> <li>If it is -100.0 or less, it is set to <code>eventid</code>,</li> <li>If it is above 0.0, it is decreased by the game's frametime</li> <li>If it's negative, but above -100.0, RespawnEnemy is called using the entity <code>spawnpoint</code>, the entity <code>iskill</code> is set to false and <code>respawntimer</code> is set to -110.0</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#lateupdate-every-3-frames-during-refreshplayer","title":"LateUpdate (Every 3 frames during RefreshPlayer)","text":"<p>When the <code>inrange</code> value changes:</p> <ul> <li>If the new <code>inrange</code> is true, the change is only accepted if both the <code>freezecooldown</code> and the <code>dizzytime</code> expired. If they have, the <code>Find</code> sound is played if the player wasn't <code>digging</code></li> <li>If the new <code>inrange</code> is false and both <code>freezecooldown</code> and <code>dizzytime</code> expired while <code>behaviorroutine</code> isn't in progress:<ul> <li>entity.<code>emoticonid</code> is set to 1 (?)</li> <li>entity.<code>emoticoncooldown</code> is set to 70.0</li> <li>StopForceMove is called with the <code>Idle</code> target state</li> <li>The <code>Lost</code> sound is played</li> <li>entity.<code>overrideonlyflip</code> is set to false</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/Enemy/#ontriggerenter","title":"OnTriggerEnter","text":"<p>What happens here depends on the other collider, only one branches is ran and if it doesn't apply, nothing happens.</p>"},{"location":"Entities/NPCControl/Enemy/#the-other-tag-is-icecle","title":"The other tag is <code>Icecle</code>","text":"<p>This does nothing if the entity is <code>digging</code> or its animid is <code>FireKrawler</code>, <code>FireCape</code>, <code>FireWarden</code> or <code>Strider</code>.</p> <ul> <li>The other gameObject is destroyed if it had a RigidBody</li> <li>The <code>freezecooldown</code> is set to 300.0 with some exceptions:<ul> <li>It is set to 30.0 if the current map is <code>GiantLairDeadLands1</code> or <code>GiantLairDeadLands2</code></li> <li>It is set to <code>freezetime</code> clamped from 600.0 to infinity if the Extra Freeze medal is equipped or <code>extrafreeze</code> is true</li> </ul> </li> <li>If it's a <code>ToeBiter</code> and <code>internaltransform[0]</code> (his boulder) is present, it is destroyed</li> <li>entity.<code>rigid</code> x and z velocity are zeroed out</li> <li>entity.<code>onground</code> is set to true</li> <li>StopForceBehavior is called</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#the-other-tag-is-beetledash-or-beetlehorn","title":"The other tag is <code>BeetleDash</code> or <code>BeetleHorn</code>","text":"<p>The <code>BeetleHorn</code> tag only counts here if the player isn't <code>dashing</code>. This does nothing if <code>collisionammount</code> is 0, the entity is <code>dead</code> or <code>digging</code> or the <code>touchcooldown</code> hasn't expired yet.</p> <ul> <li>TempIgnoreColision is called on the entity with the other collider which ignores all collision between the entity.<code>ccol</code> / entity.<code>detect</code> and the other collider for 0.5 seconds</li> <li>The <code>Damage0</code> sound is played</li> <li>If the other collider tag was <code>BeetleDash</code>, the <code>freezecooldown</code> is set to 0.0</li> <li>A Dizzy coroutine is started for 120.0 frames with force launch with the direction being the normalized direction from this enemy to the player * 5.0</li> <li><code>collisionammount</code> is incremented</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#the-other-tag-is-beerang","title":"The other tag is <code>BeeRang</code>","text":"<p>This does nothing if <code>collisionammount</code> is 0, the entity is <code>dead</code> or <code>digging</code> or the <code>touchcooldown</code> hasn't expired yet.</p> <ul> <li>The <code>WoodHit</code> sound is played on the entity</li> <li>A Dizzy coroutine is started for 80.0 frames with no pushforce or force launch</li> <li><code>collisionammount</code> is incremented</li> </ul>"},{"location":"Entities/NPCControl/Enemy/#the-other-collider-is-owned-by-the-player","title":"The other collider is owned by the player","text":"<p>If we aren't in a <code>minipause</code>, <code>pause</code> or <code>inevent</code>, StartBattle is called TODO: this seems contradictory with the Update logic ???.</p>"},{"location":"Entities/NPCControl/Interaction/","title":"Interaction","text":"<p>An <code>Interaction</code> is an enum that specify an interaction usually with the player (but it can be caused manually). The interaction of an NPCControl is given by the <code>interacttype</code> field. It only applies to NPC and SemiNPC.</p> <p>The actual execution of the interaction is done by Interact which is one of the only method in NPCControl intended to be called externally. It takes in one string parameter calld <code>args</code> which can change the logic of the interaction if applicable, but most do not make use of it. Some interactions have influences outside of this method however, some even outside NPCControl.</p> <p>Most of the calls to that method comes from PlayerControl's GetInput when it detects the player attempts to interact and it will happen with the first NPCControl in the player.<code>npc</code> list if it is present under certain conditions. If PlayerControl calls it like that, null is sent as <code>args</code>. It is however possible to call it externally to provoke an interaction in the desired moment.</p>"},{"location":"Entities/NPCControl/Interaction/#enum-table","title":"Enum table","text":"<p>The following is a table of the different <code>Interaction</code> values (NOT REFERENCED means the game never reference the value meaning it has not logic backing it, UNUSED means the behavior has logic, but it is either dead or not practically used under normal gameplay):</p> Value Name Description 0 None NOT REFERENCED, No operations 1 Talk Calls SetText in Dialogue mode using the text from the return of GetDialogue. It also gives the NPC a chatting emoticon when the NPC is in the <code>npc</code> interact list of the player. 2 Check An alias of <code>Talk</code>, but the emoticon the NPC gets is the blue ? one when it is in the <code>npc</code> list of the player. 3 SavePoint The same than <code>Talk</code>, but the SetText input string is hardcoded. The string contains a prompt command where the confirm option leads to a line with a save command which will actually saves the game. 4 Event Start the event whose id is <code>eventid</code> with this NPC as the caller. 5 TalkReturnToOriginalFlip UNUSED, An alias of <code>Talk</code>, but only the Interact logic remains. 6 Shop At loading time, this interaction is only for indicative purposes to build a shop system. At runtime after the shop system has been built, this is the interaction of a shelved item which is a <code>SemiNPC</code> item entity and the interaction calls SetText with the shop keeper's buying dialogue. 7 ShopKeeper Similar to <code>Talk</code>, but with a shop keeper buying or selling dialogue line. 8 QuestBoard The interaction for a quest board which allows to consult the 3 quest boards and take any open quests by having a dialogue with the caretaker of the quest board which is another NPCControl. 9 StorageAnt The same than <code>Talk</code>, but the SetText input string is hardcoded. It is the Ant Storage Service text unless flag 180 (received the Ant Storage Service tutorial) is false where it's the tutorial. This also sets flag 180 and 349 (using the Ant Storage Service, allows multiselect) to true. 10 CaravanBadge Similar than <code>Shop</code>, but for interacting with a shelved Caravan prize medal which only involve some parts of the shop system because it is handled entirely on its own with its own set of data. 11 VenusHeal The same than <code>Talk</code>, but the SetText input string is hardcoded to <code>commondialogue[60]</code> (the Venus bud healing text). 12 LockedDoor Start event 59 (Interacting with an object that requires a key item)."},{"location":"Entities/NPCControl/LateUpdate/","title":"LateUpdate","text":"<p>The logic depends on the NPCType, ObjectTypes, ActionBehaviors and Interaction. Consult each's documentation to learn more.</p> <p>There are mainly 2 sections to this LateUpdate:</p> <ul> <li>A handler to a NaN position</li> <li>The main logic when it's not a <code>dummy</code></li> </ul>"},{"location":"Entities/NPCControl/LateUpdate/#nan-position-handling","title":"NaN position handling","text":"<p>This section applies if any of the component of the position is a NaN and the entity.<code>startpos</code> is not null.</p> <p>If we got here, it means that the entity somehow got so far out of bounds that the components no longer reports valid floating point numbers. This is handled by setting the position to the entity.<code>startpos</code> and setting the entity.<code>onground</code> to false.</p> <p>Some specific logic happens if we are <code>trapped</code> related to the CoiledObject object type.</p>"},{"location":"Entities/NPCControl/LateUpdate/#non-dummy-logic","title":"Non Dummy logic","text":"<p>This section starts with the NPC NPCType exclusive logic involving the <code>insideid</code> and whether or not the entity.<code>rigid</code> should be locked or unlocked. Consult the corresponding NPCType section to learn more.</p> <p>After this whole logic, the rest of this section only happens if the entity is <code>incamera</code>. From there, there are several logic that occurs conditionally:</p> <ul> <li>The <code>pusher</code> enablement and center are updated when applicable, see the NPCType enum table to learn more.</li> <li>If <code>startlife</code> is less than 300.0, it is incremented by framestep.</li> <li>Some WanderOffscreen exclusive logic occurs here when applicable</li> <li>If <code>dirtcd</code> hasn't expired yet, it is decreased by framestep</li> <li>Unles it's an Object, the far fading logic occurs. Check the NPCType enum table to learn more.</li> <li>If <code>interactcd</code> hasn't expired yet, it is decreased by framestep</li> <li>Some StorageAnt exclusive logic occurs here when applicable</li> <li>Some CoiledObject exclusive logic occurs here when applicable</li> <li>Some Enemy exclusive logic occurs here when applicable</li> <li>Some <code>disguiseobj</code> related ActionBehaviors occurs here when applicable</li> <li>Every 3 frames, some logic is performed, see the section below</li> <li>If the <code>behaviorcooldown</code> hasn't expired yet, it is decreased by the game's frametime</li> <li>The <code>tattleid</code> is set to a value if there's a specific Interaction.</li> <li>Some Shop and CaravanBadge exclusive logic occurs here when applicable</li> <li>Some Geizer exclusive logic occurs here when applicable</li> <li>If the entity <code>iskill</code> is false:<ul> <li>If the y position is less than the map.<code>ylimit</code>, then the position is set to the entity.<code>startpos</code>. On top of this, DeathSmoke particles are played at the entity.<code>sprite</code> position if the entity is <code>incamera</code>, it isn't <code>dead</code> and the animid isn't negative (it isn't <code>None</code>). An exception to this logic is if it's a Dropplet object</li> <li>Some WanderOnWater and ChaseOnWater exclusive logic occurs here when applicable</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/LateUpdate/#every-3-frames","title":"Every 3 frames","text":"<p>RefreshPlayer (see the section below for details) is called if the entity is <code>incamera</code> or the map.<code>limitbehavior</code> is false and all of the following are true:</p> <ul> <li>We aren't <code>inevent</code></li> <li>We aren't in a <code>minipause</code></li> <li>The <code>insideid</code> matches the current one</li> <li>The entity isn't <code>dead</code>, <code>iskill</code> and <code>deathcoroutine</code> isn't in progress</li> </ul> <p>This also manages the player <code>npc</code> list if this isn't the player beemerang. This NPCControl is added to the list if <code>inrange</code> is true and it wasn't in it and it is removed from the list if <code>inrange</code> is false and it was in it.</p> <p>If this is an NPC, the emotes system updates occurs here, check the NPCType enum table to learn more.</p> <p>The entity.<code>ccol</code> height is set to <code>colliderheight</code> and its center is set to (0.0, half of <code>colliderheight</code>, 0.0) if this isn't the player's beemerang and the entity.<code>ccol</code> height isn't exactly the <code>colliderheight</code>.</p> <p>If the entity <code>iskill</code> and the y position is above -999.0:</p> <ul> <li>The entity.<code>rigid</code> has its gravity disabled</li> <li>The entity.<code>ccol</code> is disabled</li> <li>The <code>boxcol</code> is disabled if it is present</li> <li>The position is set to (0.0, -1000.0, 0.0) which is offscreen</li> </ul>"},{"location":"Entities/NPCControl/LateUpdate/#refreshplayer","title":"RefreshPlayer","text":"<p>This is a private method only used in LateUpdate.</p> <p>Its job is to update the <code>inrange</code> value and it receives it in parameter. The new value is true if the distance between the player and this is less than the radius and the <code>insideid</code> matches the current one, false otherwise. The new value is computed, but not yet changed because if it's an Enemy, there's some override cases where the change will be denied. Enemies also have specific logic exclusive to them in this method, consult the corresponding NPCType section to learn more.</p> <p>If the value change is allowed, it is performed followed by some StealthAI exclusive logic when applicable.</p>"},{"location":"Entities/NPCControl/LateUpdate/#end","title":"End","text":"<p>No matter which sections applied, the <code>collisionamount</code> is set to 0 and <code>ignoreconstraint</code> to false.</p>"},{"location":"Entities/NPCControl/NPC/","title":"NPC","text":"<p>An NPC is an entity that supports interactions and ActionBehaviors with a dialogue system via GetDialogue and emotes via CheckEmoteFlag.</p>"},{"location":"Entities/NPCControl/NPC/#data-arrays","title":"Data arrays","text":"<ul> <li><code>dialogues</code>: Check the GetDialogue documentation to learn more</li> <li><code>emoticonflag</code>: Check the CheckEmoteFlag documentation to learn more</li> </ul>"},{"location":"Entities/NPCControl/NPC/#start-setup","title":"Start / SetUp","text":"<p>The <code>radius</code> is incremented by 0.35 if it was less than 1.75.</p>"},{"location":"Entities/NPCControl/NPC/#update-inactive","title":"Update (Inactive)","text":"<p>For every 3 frames, if the entity is in a forcemove without any SetPath or StealhAI behavior, StopForceMove is called on the entity.</p>"},{"location":"Entities/NPCControl/NPC/#lateupdate-non-dummy","title":"LateUpdate (Non <code>dummy</code>)","text":"<p>We decides if we should lock/unlock the entity <code>rigid</code> and call StopForceMove only when the entity isn't <code>dead</code>, <code>iskill</code>, <code>deathcoroutine</code> isn't in progress and <code>activeonpause</code> is false. </p> <p>It depends on <code>inevent</code> and whether or not the <code>insideid</code> matches the current one:</p> <ul> <li>If we aren't <code>inevent</code>: <ul> <li>If the <code>originalid</code> isn't -1 (the animid isn't <code>None</code>), we ensure the entity <code>rigid</code> is locked via LockRigid if the <code>insideid</code> doesn't match the current one and unlocked if it does match. This is only performed when the current value of the entity <code>rigid.isKinematic</code> doesn't match the reality of the <code>insideid</code> matches or not.</li> <li>If entity is in a <code>forcemove</code> and the <code>insideid</code> doesn't match the current one, StopForceMove is called</li> </ul> </li> <li>If we are:<ul> <li>If the entity isn't a <code>fixedentity</code>, the <code>originalid</code> isn't -1 (the animid isn't <code>None</code>) and it's not in a <code>forcemove</code>, LockRigid(false, false) is called if the <code>insideid</code> matches the current one</li> <li>Otherwise, StopForceMove is called instead</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/NPC/#ontriggerenter","title":"OnTriggerEnter","text":"<p>Only 2 things are handled here: the <code>specialinteract</code> if it's not <code>None</code> and some handling for the StealthAI behavior.</p> <p>The <code>specialinteract</code> part does the following if the other collider tag is <code>BeetleDash</code> (or <code>BeetleHorn</code> if the <code>specialinteract</code> is <code>AnyHorn</code>):</p> <ul> <li>Set <code>interactedwithhit</code> to true</li> <li>Calls Interact with null arguments</li> <li>Set <code>interactedwithhit</code> to false in 1 second</li> </ul> <p>As for the <code>StealthAI</code> part, check its documentation to learn more.</p>"},{"location":"Entities/NPCControl/NPCControl/","title":"NPCControl","text":"<p>NPCControl is a component that defines the behaviors of any map Entities. This only includes entities loaded from map entity data and all entities created for the purpose of a shop system. Its name is a missnomer because it doesn't just manage NPCs, but also objects and enemies so it should be viewed as \"MapEntityControl\".</p> <p>Unlike EntityControl, this component exposes very little to be accessed externally with some exceptions, but most of these exceptions covers very narrow cases such as simply loading the field when map loading happens. One notable exception is Interact which offers the ability to provoke an interaction with the NPCControl.</p> <p>Most of this component's logic is into its startup, update and colliders handling lifecycle. It is mainly dictated by 4 elements:</p> <ul> <li>The NPCType</li> <li>The ObjectTypes (when the NPCType is Object)</li> <li>The default and <code>inrange</code> ActionBehaviors</li> <li>The Interaction</li> </ul>"},{"location":"Entities/NPCControl/NPCType/","title":"NPCType","text":"<p>This is an enum that dictates the main capabilities of an NPCControl using the <code>entitytype</code> field of that type. Each value offers wildly different behaviors with one being reserved specifically for the shop system. It is the most impactful field on the lifecycle of an NPCControl.</p>"},{"location":"Entities/NPCControl/NPCType/#enum-table","title":"Enum table","text":"<p>The following tables includes different columns to better illustrate the main properties differences between the different enum value:</p> <ul> <li>Tag: The gameObject tag assigned on Start</li> <li>Behaviors?: Whether or not ActionBehaviors are enabled</li> <li>Dialogues?: Whether or not GetDialogue gets called which initialises a standard system to have the NPCControl call SetText conditionally with the lines coming from the <code>dialogues</code> field.</li> <li>Interactions?: Whether or not Interactions are supported which allows the player (or the game via a methoid call) to interact with the NPCControl in various ways.</li> <li>Emotes?: Whether or not CheckEmoteFlag gets called during LateUpdate every 3 frames when <code>canpause</code> is true and the first NPCControl in the player.<code>npc</code> list isn't this one (or the list is empty). This method initialises a standard emoticon system (this doesn't include manual changes the game does in specific situations)</li> <li><code>ccol</code>: The state of entity.<code>ccol</code> which is the EntityControl standard non trigger CapsuleCollider.</li> <li><code>scol</code>: The state of the <code>scol</code> which is a trigger SphereCollider NPCControl manages.</li> <li><code>pusher</code>: The state of the <code>pusher</code> which is a trigger CapsuleCollider with a height twice the <code>ccol</code> and a raidus of twice as narrow. This is specifically present to have the player be pushed away if they collide with it. Its enablement is updated in LateUpdate while <code>dummy</code> is false and entity.<code>incamera</code> is true which keeps it enabled as long as we aren't <code>inevent</code>, message is released and we aren't in a <code>minipause</code>, it is disabled otherwise. LateUpdate also ensures its center is set to (0.0, <code>colliderheight</code> + the entity <code>height</code>, 0.0).</li> <li><code>rigid</code> mass: The mass of the entity.<code>rigid</code>.</li> <li>Far fading?: This is some logic in LateUpdate when <code>dummy</code> is false and entity.<code>incamera</code> is true where it will slightly fade out NPCControl too far away from the camera and fade them back in when getting close enough again. The logic adjusts the alpha of the <code>sprite</code> so that it is a lerp from the existing one to either 1.0 (opaque) or 0.3 (30% visible) with a factor of a 1/10 of the game's frametime. This fades in the entity or fades it out and what determines this is the entity <code>compos.z</code>: if it's 2.5 or above, we are fading in and fading out otherwise ( TODO: unsure if it works because EntityControl also seems to manage this). The specific logic happens if all of the following are true:<ul> <li><code>startlife</code> is above 20.0</li> <li>The entity animid isn't <code>None</code></li> <li>There is no <code>model</code></li> <li>The <code>sprite</code> is present</li> <li>It's not a <code>hologram</code></li> <li>The current <code>insideid</code> matches this entity</li> </ul> </li> </ul> Value Name Tag Behaviors? Dialogues? Interaction? Emotes? entity.<code>ccol</code> <code>scol</code> <code>pusher</code> entity.<code>rigid</code>.mass<sup>1</sup> Far fading? 0 NPC NPC Yes<sup>5</sup> Yes Yes Yes Enabled Disabled Yes<sup>5</sup> 10000.0 Yes 1 Enemy Enemy Yes No No No Enabled<sup>2</sup> Disabled<sup>2</sup> No 100.0 Yes 2 Object Object No No No No disabled<sup>4</sup> Enabled<sup>3</sup> No 10000.0 No 3 SemiNPC NPC Yes<sup>5</sup> No Yes No Enabled<sup>6</sup> Enabled<sup>3</sup> No 10000.0 Yes <p>1: The mass is 1.0 if it's an item entity regardless of the type.</p> <p>2: The <code>secondcoll</code> replaces it with the same attributes than the <code>ccol</code> and the player <code>ccol</code> and <code>detect</code> (its wall detector) ignores any enemy <code>ccol</code> meaning the player can only collide with the <code>secondcoll</code>, but other RigidBody can collide with both. Additionally, the player <code>detect</code> ignores the <code>secondcoll</code>.</p> <p>3: The <code>scol</code> is disabled if it's an item entity  (which is always the case in practice for a <code>SemiNPC</code>). Also, it is left to null (not even added as a component) if it's The player Beemerang.</p> <p>4: Exceptions applies where the <code>ccol</code> remains enabled depending on <code>objecttype</code>:</p> <ul> <li>SavePoint</li> <li>RollingRock</li> <li>FixedAnim (managed by a data field)</li> <li>Item</li> <li>The player Beemerang (only remains enabled if the entity <code>fixedentity</code> is false)</li> </ul> <p>5: These features are excluded for any of the following cases (Behaviors are always enabled, but SetInitialBehavior is not called under these cases):</p> <ul> <li>This is an item entity. This is always the case in practice for a <code>SemiNPC</code> meaning behaviors don't actually do anything useful on them</li> <li>entity.animid is negative</li> <li><code>interacttype</code> is Shop or CaravanBadge</li> </ul> <p>6: While the general initialisation process don't leave them disabled, the only cases where <code>SemiNPC</code> are used comes with a disabling of the entity.<code>ccol</code> making it disabled in practice.</p> <p>While a lot of the logic of an NPCControl is shared regardless of its <code>entitytype</code>, the vast majority is dictated to a specific one that the others only partially have or do not have at all.</p> <p>For more informations on each NPCType, check each of their documentations:</p> <ul> <li>NPC</li> <li>Enemy</li> <li>SemiNPC (this type is specifically used for the shop system)</li> </ul>"},{"location":"Entities/NPCControl/Object/","title":"Object","text":"<p>Most of the logic depends entirely on the <code>objecttype</code> field.</p> <p>There are a couple of special logic to mention that applies by default to all objects:</p> <ul> <li>In OnTriggerEnter, if the other collider isn't the player, <code>collisionammount</code> is incremented.</li> <li>This is the only type with logic in OnTriggerStay and OnTriggerExit for specific <code>objecttype</code></li> </ul>"},{"location":"Entities/NPCControl/Object/#objecttypes","title":"ObjectTypes","text":"<p>An <code>ObjectTypes</code> is an enum that determines the type of object an NPCControl with an <code>entitytype</code> of <code>Object</code> or <code>SemiNPC</code> has. This information is stored on the <code>objecttype</code> field.</p> <p>A type dictates most of the logic of an <code>Object</code> in various situation notably Unity events, but also outside of NPCControl. Most prebaked logic in NPCControl is disabled by default, but any <code>ObjectTypes</code> can override this. It also greatly changes the meaning of several fields of NPCControl notably the general purpose <code>data</code> and <code>vectordata</code> array.</p>"},{"location":"Entities/NPCControl/Object/#objecttypes-enum-table","title":"ObjectTypes enum table","text":"<p>The following are all the possible <code>ObjectTypes</code> (NOT REFERENCED means the game never references the value and it has no logic, UNUSED means the logic is present, but it is either dead or not used under normal gameplay):</p> Value Name Summary 0 None No operations or this NPCControl isn't an <code>Object</code> 1 BeetleGrass A grass that can be cut by Kabbu's Horn Slash. Can either be bound to a crystalbfflags slot which will be dropped, or a list of items that can be dropped alongside the activation of a flag and regionalflag slots. 2 PushRock A rock or a pushable ice cube that can be moved using Kabbu's Horn Slash with configurable movement force. See the simplified explanation section for an intuitive description of how this object functions. 3 PressurePlate A plate that can be pushed down in its receptacle using a <code>PushRock</code> or optionally, the player or an NPCControl entity.<code>icecube</code>. This can optionally start an event when actuated for the first time. 4 ANDGate A multipurpose condition checker that can be operated in 4 distinct modes involving either flag or other map entities's <code>hit</code> value which results in either a new <code>hit</code> value or an event being started. 5 CameraChange A trigger zone to change the camera's properties. 6 Item A collectable item, medal or crystal berry bound to a crystalbfflags slot whose item id is the entity.<code>animid</code> field. This extends the logic of an item entity. 7 DoorOtherMap A loading zone to another map with customisable movement before and after the load. 8 SetPlayerRespawn A trigger zone that sets the player.<code>lastpos</code> which is the player last spawn point. It can either be managed by this NPCControl or be a completely independant collider that PlayerControl can collider with. 9 DoorSameMap A transition zone to and away from an inside of the current map. 10 Beemerang Vi's Beemerang when thrown. This object type is only created dynamically. 11 EventTrigger An event trigger zone. It can either unconditionally trigger as a one shot event on the first Update cycle or trigger via OnTriggerStay that starts the event when the player collides with it with the option to destroy the NPCControl after. 12 DialogueTrigger A zone where a SetText call starts in dialogue mode using a map dialogue line id. It can either unconditionally trigger as a one shot call on the first Update cycle or trigger via OnTriggerStay that starts the call when the player collides with it with the option to destroy the NPCControl after. 13 ANDBlock A multipurpose condition checker that can be operated in 3 distinct modes involving either flags or other NPCControl's <code>hit</code> value which results in a new <code>hit</code> value that can contol the entity.<code>sprite</code> local position. 14 SavePoint A save crystal that can be hit using field abilities. It can be blue which only prompts to save the game, yellow which also heals the party and red which alerts a DeadLanderOmega, but doesn't prompt for saving and can optionally heal the party. 15 JumpSpring A spring that makes an entity jump up high via Jump when touched or makes the entity jump straight to a specific point via JumpTo with the option to trigger an inside transition via a <code>DoorSameMap</code> present on the map without physically moving the player. 16 DigSpot A spot where an item, medal or Crystal Berry can be dug out or have an event be triggered when doing so using Kabbu's Dig ability. 17 Switch A switch that can be turned on or off offering a wide variety of actuation flow such as starting an event, changing other <code>hit</code> values, offer a toggling feature and be only actuable using Kabbu's horn. Consult the switch actuation section for more details. 18 MusicChange NOT REFERENCED 19 CoiledObject A coil that can trap another map entity within using a configurable local position and requires to be hit by a player ability to untrap the object. It can optionally set a flag slot to true when hit. 20 FixedAnim An object where the entity is left in a fixed animstate with the option to also disables the entity.<code>ccol</code> and gravity on it. 21 DigWall NOT REFERENCED 22 ItemSpawner NOT REFERENCED 23 EnemySpawner An enemy spawner attached to another Enemy entity that will continuously respawn in a given circle range whenever it dies after a certain amount of time. The map entity id of the enemy, the time interval to wait before respawn and the range at which the enemy will spawn is configurable with the option to spawn the enemy immediately on the first Update cycle. 24 Dropplet A water dropplet that can be frozen by Leif's Freeze which then turns it into an ice cube that can be moved by launching it using Kabbu's Horn Slash. The push velocity vector when launched is configurable and the object also supports many optional features, see the data array definition for details. 25 PathPlatform A platform that moves on a set path defined by multiple absolute position vectors called nodes and can conditionally be stopped depending on the <code>hit</code> value of other NPCControl present on the map. Can be operated in loop mode using only 2 nodes or with multiple nodes in path mode with more options. 26 BreakableRock A rock that can be broken using Kabbu's Horn Dash or shook by Kabbu's Horn Slash. 27 RotatingPlatform The same than <code>PathPlatform</code>, but path mode will have the nodes be euler angles vectors instead and the platform will rotate through these angles instead of moving. Loop mode is left unchanged, but is considered invalid. 28 Geizer A water or honey geizer that can be frozen using Leif's Freeze and it can elevate a <code>Dropplet</code> ice cube. The oscillation and time to stay frozen are configurable with the option to conditionally activate it when another NPCControl <code>hit</code> is true. 29 MusicRange A spherical radius that when the player enters it, changes the current music playing. The music, amount of frames to wait between distance checks, radius, rate of volume change and max volume are configurable. 30 TempPlatform A platform that can only be stood on by the player for a limited amount of time before respawning the player. The amount of frames the player can stay on it and some animation timings are configurable. 31 ScrewSwitch A crank switch actuated by Vi's Beemerang Toss with an analog actuation that needs to be held for a certain period before being fully actuated. The angles of rotation when actuated, the rate of actuation / deactuation and the maximum value to reach before fully actuating the crank are all configurable. 32 ResetCamera A zone where the camera is reset to default via MainManager.ResetCamera when the player enters it. 33 StencilSwitch A switch that, when activated, causes a frozen area range to appear or to disappear when deactivated. 34 RollingRock A rolling rock that either appears and rolls on its own or is shot from a canon. The target direction, velocity, radius, rotation, spawn timing and minimum y position limit are all configurable with the option to only have the rock roll once it hits the ground and an option to only activate the rock when another NPCControl <code>hit</code> value is true. 35 TriggerSwitch A trigger zone that controls either its own <code>hit</code> value when the player enters or exits the zone or it controls the <code>hit</code> value of another NPCControl when the player enters the zone, but not when they exit it. 36 WindPusher A zone that renders wind particles moving towards a point. If the player enters that zone, they will be pushed towards the same direction then the wind. The wind force, wind target position, wind sizes and the visual lifetime / speed are all congurable. There is also the option to only have this object in effect when another map entity <code>hit</code> value is true. 37 WaterSwitch A switch with 2 states to control the vertical position of a child of the map's main mesh GameObject between 2 points (the lower one when not actuated and the upper one when actuated). The child index, the bounds of the y position to set and the amount of frames to spread the movement are configurable. 38 BattleMapChange UNUSED, A zone that causes a change of the map.<code>battlemap</code>."},{"location":"Entities/NPCControl/SetUp/","title":"Setup","text":"<p>This method is only called during Start and it contains most of the logic of the startup process. The logic depends on the NPCType, ObjectTypes, ActionBehaviors and Interaction. Consult each's documentation to learn more as only the end part of the method is shared.</p>"},{"location":"Entities/NPCControl/SetUp/#common-startup","title":"Common startup","text":"<p>At the end of the method, this phase happens regardless of the logic performed prior.</p> <p>CheckHidden is invoked in 1 second which setups the logic to check if the NPCControl should be considered a hidden item. This happens if HasHiddenItem returns true and CheckIfCanExist returns false according to the <code>requires</code>, <code>limit</code> and <code>regional</code>. This will cause the Detector medal to beep and the correct emoticon (id 4) to be set on the player entity for 100.0 frames, but this part is done by MapControl's LateUpdate.</p> <p>After, the entity.<code>rigid</code> gets frozen on all constraints if the entity.<code>fixedentity</code> or <code>freezeconstraints</code> is true.</p> <p>Finally, the entity.<code>initialcolliderdata</code> is set back to (entity.<code>ccol.height</code>, entity.<code>ccol.radius</code>).</p>"},{"location":"Entities/NPCControl/Shop%20system/","title":"Shop system","text":"<p>The way the game defines a shop is complex and it involves a unique way to load its data and to create the actual shop at loading time. This results in multiple NPCControl being involved at runtime that forms the logic of the shop.</p> <p>There are 2 types of shops:</p> <ul> <li>A standard items shop (key items aren't supported, see how <code>dialogues[10].x</code> works below for details)</li> <li>A medals shop</li> </ul> <p>Both are similar with only some logic differences. Notably, they both behave differently at loading time vs runtime. This means that the data defined in map entities data gets converted to different entities set at runtime. It involves both MapControl.CreateEntities and NPCControl.Setup.</p> <p>There is technically a third type of shop involving the caravan prize medals, but this one only has one shelved item and its behavior is very different from the shop system this page will talk about even if some logic are shared. For more details on how caravan prize medals work, check the CaravanBadge interaction page.</p> <p>This page will describe the loading time behaviors as the runtime will be described in the different Interactions involved.</p>"},{"location":"Entities/NPCControl/Shop%20system/#seminpc","title":"SemiNPC","text":"<p>This NPCType is very special in the shop system because it is the game's only usage of them (there is no map entity data that loads it as it is considered invalid since the shop system created them when needed). Its functioning is essential for the shop system, enough to document it in this page.</p> <p>The basic idea of a SemiNPC is it behaves mostly like an Object, but it allows interactions. This is ideal for a shelved item because it's possible to leave the objecttype to <code>None</code> which means that by default, there is no logic that will exist on the entity (objects are normally entirely driven by their type so leaving to <code>None</code> means the least amount of logic occurs). This is what differentiate an Item NPCControl which is a collectable item entity to an item SemiNPC which has no logic other than being a simple item entity that just happens to support interactions thanks to <code>SemiNPC</code> allowing it. Everything other than being interactable is either excluded from the NPCControl logic or is left practicaly useless. Effectively, it's a \"dumb\" item: it can only be interacted with when the player gets close enough, but nothing more.</p> <p>Additionall, this type has no OnTriggerEnter logic. This type shouldn't ever be loaded from map entity data because the shop system will create them when needed.</p>"},{"location":"Entities/NPCControl/Shop%20system/#map-entity-data","title":"Map entity data","text":"<p>A shop is declared in the map entity data as a single entity with the Shop interaction. That entity data will be transformed to the entire shop structure at loading time. This means that this interaction is only used for loading purposes here: it will not actually involve the entity having a shop interaction as that will be delegated to each shelved items.</p> <p>The entity itself becomes the ShopKeeper of the shop which happens by changing the <code>interacttype</code> on it. There will also be shelved items that gets created as <code>SemiNPC</code> with the Shop interactions using the properties contained in the various data arrays of the shop keeper entity. The shelved items gets linked to their new shop keeper via the <code>shopkeeper</code> field.</p> <p>For an item shop, most of this happens during MapControl.CreateEntities while for a medal shop, it's mostly done in NPCControl.SetUp.</p> <p>One additional thing to point out about <code>dialogues</code>: this array for a shop ends up either empty or of length 20. If the length of the array in the shop entity isn't 0, then the actual value is ignored and it will always be of length 20. This forces the game to load all the <code>dialogues</code> data elements that can exists. If the length is 0 however, none are loaded and the array remains empty. This however will cause unexpected behaviors and it is therefore not recommended to do so.</p> <p>Here is how the data of the shop is defined on the main shop entity:</p> <ul> <li><code>dialogues[0].y</code>: The dialogue line id of the shop keeper when interacting with them (managed by the ShopKeeper interaction)</li> <li><code>dialogues[1].y</code>: If it's 1, the shop accepts Crystal Berries instead of regular berries. NOTE: this won't behave as expected for a standard items shop, but it is technically supported by the game's data</li> <li><code>dialogues[2].y</code>: For a standard items shop, if it's higher than 0.1, the <code>mmulti</code> field (the buying price multiplier) of each shelved item will be this value / 10.0 (the result of the multiplication will be ceiled). This is read, but not used for a medals shop</li> <li><code>dialogues[6].y</code>: The dialogue line id of the shop keeper when interacting with a shelved item</li> <li><code>dialogues[8].x</code>: The <code>radius</code> of each shelved item will this value / 10.0 (defaults to 1.5625  if it's lower than 0.1)</li> <li><code>dialogues[9].x</code>: For a medals shop, the medal shop id (only 0 and 1 exists under normal gameplay). This isn't used for a standard items shop</li> <li><code>dialogues[10].x</code>: This is 0 for all standard item shops and 1 for a medals shop (it is not possible to specify anything else which prevents key items from being supported)</li> <li><code>data.length</code>: The amount of shelved items</li> <li><code>data</code>: For a standard items shop, the list of item ids that the shop sells. This isn't used for a medals shop because the game manages them using the shop available and pools arrays (the length is still used for the amount though)</li> <li><code>vectordata</code>: The list of the shelved items position where each index matches the corresponding <code>data</code> element</li> </ul>"},{"location":"Entities/NPCControl/Shop%20system/#standard-items-shop-specifics","title":"Standard items shop specifics","text":"<p>Here is how a shelved shop item gets created for each of them in MapControl.CreateEntities (all data pulled are from the shop keeper entity data):</p> <ul> <li>A new entity is created via CreateNewEntity named <code>FixedshopX</code> where X is the <code>data</code> index</li> <li>The <code>startpos</code> gets set to the corresonding <code>vectordata</code> element</li> <li>The <code>animid</code> gets set to <code>dialogues[10].x</code> (in practice however, this can only work with 0 as 1 will make it treat like a medals shop while 2 is invalid as it's a standard items shop, not a medals one)</li> <li>If <code>animid</code> is 0 (which it should always be), the <code>animstate</code> is set to the corresponding <code>data</code> element</li> <li><code>item</code> is set to true making this an item entity</li> <li><code>hasshadow</code> is set to false</li> <li>The NPCControl is added and set to <code>npcdata</code></li> <li>npcdata.entitytype is set to <code>SemiNPC</code></li> <li>npcdata.interacttype is set to Shop</li> <li><code>emoticonoffset</code> is set to (0.0, -1000.0, 0.0)</li> <li>npcdata.<code>shopkeeper</code> is set to the shop keeper's <code>npcdata</code></li> <li>npcdata.<code>radius</code> is set to a 1/10 of <code>dialogues[8].x</code>, but if it ends up lower than 0.1, it defaults to 1.5625</li> <li>npcdata.<code>insideid</code> is set to the shop keeper's <code>insideid</code></li> <li><code>colliderheight</code> is set to 0.5</li> </ul> <p>On SetUp, there's 3 logic that will inevitably follow thanks to the <code>Shop</code> interaction and the <code>shopkeeper</code> being set for each shelved items:</p> <ul> <li><code>mmulti</code> is set to a 1/10 of <code>shopkeeper.dialogues[2].y</code>, but if it's less than 0.1, it defaults to 1.0. This will later get used to multiply the item's price and the result will be ceiled.</li> <li>CaravanMedalSet(false) is called which does the following:<ul> <li>entity.<code>rigid</code> gets its gravity disabled with all constraints frozen</li> <li>The position is set to entity.<code>startpos</code></li> <li>entity.<code>ccol</code> is disabled</li> <li><code>descwindow</code> is destroyed if it existed</li> <li>The <code>scol</code> is disabled</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/Shop%20system/#medals-shop-specifics","title":"Medals shop specifics","text":"<p>For this shop type, the only logic MapControl.CreateEntities does is set the the interacttype of the original shop entity to ShopKeeper. All initialisation occurs in SeUp in 2 phases, one of the shop keeper and then one for each shelved items. The shelved items are initialised in the first phase then configured further on the second phase.</p>"},{"location":"Entities/NPCControl/Shop%20system/#shop-initialisation-from-the-shop-keepers-setup","title":"Shop initialisation from the shop keeper's SetUp","text":"<p>For the first phase, thanks to <code>dialogues[10].x</code> being 1 and the ShopKeeper interactions, SetBadgeShop(false) is called.</p> <p>The first thing it does is initialises <code>shopitems</code> to a new list of EntityControl of length <code>data.length</code>. This is used to keep references of the shelved items entities in case the method is called with refresh which causes the destructions of the shelved items before recreating them</p> <p>From there, a loop is done from 0 to <code>data.length</code> exclusive to actually create the shelved items (the <code>data</code> array is never indexed directly):</p> <ul> <li>A new entity is created with name <code>badgeshopX</code> where X is the current index</li> <li><code>startpos</code> is set to the corresponding <code>vectordata</code></li> <li><code>animid</code> is set to 2 (medal)</li> <li>If the current index doesn't exist in <code>avaliablebadgepool</code> of the store id contained in <code>dialogues[9].x</code> or if it does exist, but it's -1, <code>iskill</code> is set to true. Otherwise, <code>animstate</code> is set to the corresponding medal id found in <code>avaliablebadgepool</code></li> <li><code>item</code> is set to true making it an item entity</li> <li><code>hasshadow</code> is set to false</li> <li>The NPCControl is added and set to <code>npcdata</code></li> <li>npcdata.entitytype is set to <code>SemiNPC</code></li> <li>npcdata.interacttype is set to Shop</li> <li><code>emoticonoffset</code> is set to (0.0, -1000.0, 0.0)</li> <li>npcdata.<code>shopkeeper</code> is set to the current NPCControl (which is the shop keeper)</li> <li>npcdata.<code>radius</code> is set to a 1/10 of <code>dialogues[8].x</code>, but if it ends up lower than 0.1, it defaults to 1.5625</li> <li>npcdata.<code>insideid</code> is set to the shop keeper's <code>insideid</code></li> <li><code>colliderheight</code> is set to 0.5</li> <li>The new entity gets added to the map.<code>entities</code> and childed to the map</li> <li>The corresponding <code>shopitems</code> gets set to the new entity</li> </ul>"},{"location":"Entities/NPCControl/Shop%20system/#initialising-the-shelved-shop-items","title":"Initialising the shelved shop items","text":"<p>The second phase involves each shelved items on SetUp:</p> <ul> <li><code>mmulti</code> is set to a 1/10 of <code>shopkeeper.dialogues[2].y</code>, but if it's less than 0.1, it defaults to 1.0. NOTE: this doesn't end up doing anything for a medals shop</li> <li>CaravanMedalSet(false) is called which does the following:<ul> <li>entity.<code>rigid</code> gets its gravity disabled with all constraints frozen</li> <li>The position is set to entity.<code>startpos</code></li> <li>entity.<code>ccol</code> is disabled</li> <li><code>descwindow</code> is destroyed if it existed</li> <li>The <code>scol</code> is disabled</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/Shop%20system/#refresh-process","title":"Refresh process","text":"<p>Medals shop have a unique capability: it's possible for the game to recreate the entire shop by passing true instead of false to SetBadgeShop. This is notably used during a kill or rerollshops SetText commands.</p> <p>Doing so will destroy all <code>shopitems</code> and their <code>descwindow</code> if it existed followed by a MainManager.UpdateShops call before recreating the shelved items. The UpdateShops will randomly sort all <code>availablebadgepool</code> arrays, not just the one the game wanted to refresh (this changes the items on the shelf because only the first ones are going to be present and the overflow ones discarded due to <code>iskill</code> being true).</p> <p>From there, the shelved items are initialised as normal with one extra step: if the entity isn't <code>iskill</code> by the end, DeathSmoke particles will play on the entity's <code>startpos</code></p> <p>Finally, instance.<code>showmoney</code> is set to 10.0 which reveals the berry count HUD element.</p>"},{"location":"Entities/NPCControl/Start/","title":"Start","text":"<p>The event does nothing if it's a <code>dummy</code>.</p> <p>The entity.<code>ccol</code> and <code>scol</code> are initialised according to their NPCType.</p> <p>From there, SetUp is called which contains most of the startup logic.</p> <p>After, a couple of specific logic occurs:</p> <ul> <li>The tag is set according to the NPCType</li> <li>The entity.<code>rigid</code> mass is changed according to the NPCType except if it's an item entity where it remains 1.0</li> <li>If applicable, the <code>disguiseobj</code> is initialised according to the ActionBehaviors</li> <li>The entire gameObject gets disabled if the <code>requires</code> and <code>limit</code> contain a violation. It also gets disabled when the entity.<code>hideinside</code> is true while the <code>insideid</code> does not match the current one</li> <li>If the <code>NGF</code> Modifier applies, GravityFix is started</li> </ul>"},{"location":"Entities/NPCControl/Update/","title":"Update","text":"<p>Most of this event only happens if it's not a <code>dummy</code>, but some logic happens regardless at the end of it. The logic depends on the NPCType, ObjectTypes and ActionBehaviors. Consult each's documentation to learn more.</p>"},{"location":"Entities/NPCControl/Update/#non-dummy-logic","title":"Non Dummy logic","text":"<p>From there, the update logic depends whether the NPCControl is considered active or not. In order to be active, entity.<code>alwaysactive</code> needs to be true or all of the following needs to be true:</p> <ul> <li>The entity is <code>incamera</code></li> <li>The <code>insideid</code> matches the current one</li> <li>From there, there are 3 cases:<ul> <li><code>startlife</code> is less than 50 frames which makes the NPCControl active</li> <li>The entity.<code>campos.z</code> is less than 25 when the map <code>limitbehavior</code> is false which makes the NPCControl active</li> <li>The entity.<code>campos.z</code> is less than 15 when the map <code>limitbehavior</code> is true. In this case, the NPCControl is active only if any of the following are true:<ul> <li>The entity is currently in a forcemove</li> <li>The entity.<code>campos.x</code> is between 0.25 and 0.75 exclusive (it means it's centered enough to be within half the viewport horixontally)</li> </ul> </li> </ul> </li> </ul> <p>If any of the above is violated, the NPCControl is considered inactive and implicates a different logic entirely.</p>"},{"location":"Entities/NPCControl/Update/#active-updates","title":"Active updates","text":"<p>There are 2 subsections to this. Up to one of them will apply with the main one taking priority, but it is possible that neither applies. No matter which subsection of the active update that applied (if any), the <code>touchcooldown</code> is updated according to the frame time if it hasn't expired yet at the end of the active update section.</p>"},{"location":"Entities/NPCControl/Update/#main-active-update-logic","title":"Main active update logic","text":"<p>This Section only applies if any of the following are true:</p> <ul> <li>The entity is <code>activeinevents</code> while we are in a <code>minipause</code> or <code>inevent</code> and we aren't <code>trapped</code></li> <li>The entity is <code>activeonpause</code></li> <li>We aren't in a <code>pause</code>, <code>minipause</code>, message, the entity isn't an item entity and isn't <code>dead</code>, <code>iskill</code> and we aren't <code>trapped</code></li> </ul> <p>If this is an Enemy, there are 3 special cases that can override the rest of this section (dizzy, frozen or about to be unfrozen). For more information, check the Enemy NPCType documentation.</p> <p>We only continue from here if we aren't <code>trapped</code>.</p> <p>Further Enemy exclusive logic happens here when applicable.</p> <p>If <code>returntoheight</code> is true, the entity.<code>initialheight</code> is above 0.1, the entity.<code>height</code> is less than entity.<code>initialheight</code> - 0.05 and the <code>disguisecooldown</code> hasn't expired yet, entity.<code>height</code> is set to a lerp from entity.<code>height</code> to entity.<code>initialheight</code> with a factor of the frametime / 10. This also sets the entity.<code>oldfly</code> to false if its entity.<code>height</code> is less then entity.<code>initialheight</code> - 0.2 which forces a sprite update. All of this essentially makes the entity progressively comes back to its original height if applicable smoothly.</p> <p>If this this is an Object, then perform the Update specific section of the ObjectTypes which also replaces the rest of this section. Otherwise, the non object logic follows.</p> <p>Further Enemy exclusive logic happens here when applicable.</p> <p>Some logic specific to the DisguiseOnce behavior occurs here.</p> <p>Finally, <code>hasenteredrange</code> is set to true and DoBehavior is called if all of the following conditions are true:</p> <ul> <li><code>overridebehavior</code> is false</li> <li>No <code>behaviorroutine</code> is in progress</li> <li>There is at least a default behavior set in <code>behaviors</code></li> <li>The entity isn't <code>dead</code> or <code>iskill</code> and doesn't have a <code>deathcoroutine</code> in progress</li> <li>One of the following is true:<ul> <li>This is an Enemy</li> <li>The entity is <code>alwaysactive</code></li> <li>The entity.<code>campos.z</code> is less than 20.0 (it isn't too far forward the camera)</li> </ul> </li> </ul> <p>As for which behaviors is chosen at which frequency, it depends on 2 conditions:</p> <ul> <li>Whether or not <code>forcebehavior</code> is defined. This forces the behavior to use, but not the frequency (see the second condition for how that is selected)</li> <li>Whether the player is present and its entity is <code>digging</code> or its entity.<code>icooldown</code> hasn't expired yet. If this is true, it forces the behavior AND the frequency to be the default one. Otherwise, the frequency depends on <code>inrange</code> and the behavior (assuming <code>forcebehavior</code> isn't defined) is also based on it.</li> </ul>"},{"location":"Entities/NPCControl/Update/#non-trapped-active-item-update-logic","title":"Non trapped active item update logic","text":"<p>This subsection applies if the main one didn't and it's an item entity while not being <code>trapped</code>. Most cases involves logic specific to the Item object, but an item entity used as a shelved shop item is also affected, but not in a meaninful way (only calls StopForceMove on the 3rd cycle onward effectively making it fixed in place).</p>"},{"location":"Entities/NPCControl/Update/#inative-updates","title":"Inative updates","text":"<p>This segment only applies if the entity is considered inactive which means the active update segmenets didn't apply.</p> <p>If we aren't <code>trapped</code>, the absolute position is set to the entity.<code>lastpos</code>.</p> <p>If applicable according to the ActionBehaviors, some adjustements happens related to the <code>disguiseobj</code> when it is present as well as the NPCControl and its entity.</p> <p>For every 3 frames, if the entity is in a forcemove is called on the entity except if it has a SetPath or StealhAI behavior.</p>"},{"location":"Entities/NPCControl/Update/#common-logic","title":"Common logic","text":"<p>This segment applies regardless if it's a <code>dummy</code> or not.</p> <p>In there, some specific ActionBehaviors logic occurs if applicable.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/AlwaysWander/","title":"AlwaysWander","text":"<p>A very cut down version of wander where the entity will always, when it can, move somewhere on the next DoBehavior cycle even if it is in the process of moving already.</p> <p>NOTE: this is unused under normal gameplay and is likely not fully functional despite having unique logic backing this behavior.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/AlwaysWander/#frequency-meaning","title":"Frequency meaning","text":"<p>The same as wander, but it's not useful in practice because this behavior ignores the <code>actioncooldown</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/AlwaysWander/#setup-only-if-its-the-default-behavior","title":"SetUp (Only if it's the default behavior)","text":"<p>There is no logic here unlike wander because this behavior ignores <code>actioncooldown</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/AlwaysWander/#dobehavior","title":"DoBehavior","text":"<p>It starts off the same than wander until when it comes time to decide the main logic branch to take.</p> <p>This behavior will always take the main one and it will always be seen as if the <code>actioncooldown</code> expired. There is a twist however: when entering the branch, there is now an early exit if the player is <code>tattling</code> or we are in a <code>pause</code> where StopForceMove is called on the entity and this DoBehavior cycle ends early.</p> <p>The rest is the same as the main logic of wander. </p>"},{"location":"Entities/NPCControl/ActionBehaviors/AlwaysWander/#explanations-of-the-changes","title":"Explanations of the changes","text":"<p>This has the implications that the NPCControl will always wander if all of the conditions are met. These conditions depends if the entity is in a <code>forcemove</code> or not.</p> <p>If they aren't in a <code>movemove</code>, the player needs to not be <code>tattling</code> while we aren't in a <code>pause</code> to wander on this cycle.</p> <p>If they are in a <code>forcemove</code>, the above applies on top of all of the following needing to be true:</p> <ul> <li>entity.<code>hitwall</code> is false</li> <li>entity.<code>onground</code> is true</li> <li>entity.<code>detect</code> is absent or HasGroundAhead from the entity.<code>forcetarget</code> returns true</li> </ul> <p>If the conditions aren't met in either case, the DoBehavior cycle ends early with a StopForceMove call on the entity.</p> <p>Because the entity will always try to wander and it will in most practical cases, it essentially makes the NPCControl move nonstop, even during its movement. It means it's very possible for it to try to move to different points every frame which is rather erratic. It is likely why this behavior was left unused as it doesn't seem to be fully functional in this state and its usage isn't recommended.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChangeSpriteInRandius/","title":"ChangeSpriteInRandius","text":"<p>When the player is present, the entity.animstate is set to <code>actionfrequency[0]</code> when the distance between this and the player is less than the <code>wanderradius</code>, it is set to <code>actionfrequency[1]</code> otherwise.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChangeSpriteInRandius/#frequency-meaning","title":"Frequency meaning","text":"<p>Each of the 2 frequencies corresponds to an animstate to set the entity depending on the distance between it and the player in regards to the <code>wanderradius</code>. The first one applies when the distance is strictly lower than the <code>wanderradius</code> and the second one applies otherwise.</p> <p>NOTE: this behavior does NOT read the frequency passed in DoBehavior</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChangeSpriteInRandius/#dobehavior","title":"DoBehavior","text":"<p>If the player isn't present, this does nothing.</p> <p>Otherwise, if the distance between this entity and the player is less than the <code>wanderradius</code>, the entity animstate is set to <code>actionfrequency[0]</code>. it is set to <code>actionfrequency[1]</code> otherwise.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/","title":"ChargeAndAttack","text":"<p>The same than ChasePlayer, but also attacks the player (with <code>attacking</code> set to true during the attack) where the actions depends on the AnimID when getting closer than a configurable threshold. Only a few animIds have an attack logic defined for this behavior.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/#frequency-meaning","title":"Frequency meaning","text":"<p>The minimum distance to the player at which no attacks will occur. If the distance falls below this number, a ChargeAndAttack coroutine will be started. NOTE: if it is above 10.0 or negative, the value is overriden to 2.0.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/#dobehavior","title":"DoBehavior","text":"<p>The logic starts with the same than ChasePlayer.</p> <p>After, if the distance between the NPCControl and the player is less than the frequency (after overriding it as described above), <code>behaviorroutine</code> is set to a ChargeAndAttack coroutine that is started.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/#chargeandattack_1","title":"ChargeAndAttack","text":"<p>This is a private coroutine specific to this behavior. The call is assigned to <code>behaviorroutine</code> which allows the NPCControl to stop it if needed.</p> <ul> <li>StopForceMove is called on the entity</li> <li>entity.<code>overrideanim</code> is set to true</li> <li>From there, the charge and attack is done depending on entity.animid. See the section below for more details (it is possible we exit the coroutine early due to a battle being started).</li> <li>If we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a battle and the battle is <code>inevent</code>, all frames are yielded until that is no longer the case</li> <li>If we aren't <code>inrange</code>, Emoticon is called on the entity with id 1 (? mark) for 60 frames</li> <li>entity.<code>overrideanim</code> is set to false</li> <li><code>attacking</code> is set to false</li> <li>StopForceBehavior is called</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/#charge-and-attack-logic","title":"Charge and attack logic","text":"<p>These are the different attacks an NPCControl can do with this behavior, but only 4 animid are supported.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/#leafbugclubber","title":"<code>LeafbugClubber</code>","text":"<ul> <li>The entity.animstate is set to 100 (preparing to attack with his club)</li> <li>The <code>Toss3</code> sound is played on the entity with normal volume and 1.1 pitch</li> <li>0.2 seconds are yielded</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code></li> <li>entity.<code>animstate</code> is set to 102 (lowering his club suddenly)</li> <li><code>attacking</code> is set to true</li> <li>The <code>Toss7</code> sound is played on the entity</li> <li>0.1 seconds are yielded</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code></li> <li>If the distance between the NPCControl and the player is less than 2.0:<ul> <li>NPCControl.StartBattle is called</li> <li>entity.<code>overrideanim</code> is set to false</li> <li>StopForceBehavior is called</li> <li>The coroutine ends early with a yield break</li> </ul> </li> <li>Otherwise, 0.5 seconds are yielded</li> <li>entity.<code>animstate</code> is set to 0 (<code>Idle</code>)</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/#flytrap","title":"<code>FlyTrap</code>","text":"<p>The same than <code>LeafbugClubber</code>, but with the difference that instead of the <code>Toss3</code> and <code>Toss7</code> sounds being used, they are <code>Chew</code> and <code>Bite</code> respectively at normal volume and pitch. The 100 animstate for this animid is opening his mouth and the 102 one is closing it.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/#sandworm","title":"<code>Sandworm</code>","text":"<ul> <li>entity.<code>digging</code> is set to false</li> <li>entity.<code>digtime</code> is set to 0.0</li> <li>entity.<code>overridejump</code> is set to false</li> <li>entity.<code>animstate</code> is set to 100 (opening his jaw)</li> <li>A frame is yielded</li> <li>entity.<code>sprite</code> scale is set to entity.<code>startscale</code></li> <li>If entity.<code>digpart[1]</code> exists (the digging particles), they are moved offscreen at (0.0, -9999.0, 0.0)</li> <li>entity.<code>overrideflip</code> is set to true</li> <li>If <code>dirtcd</code> expired, <code>DirtExplodeLight</code> are played at the NPCControl position for 1 seconds with 0.75 uniform scaling</li> <li><code>dirtcd</code> is set to 30.0</li> <li>FlipSpriteAngleAt is called on the entity with the player at the position and (0.0, 90.0, 0.0) as the offset</li> <li>From there, there is a loop that goes on for up to 40.0 frames, but counted by a local variable which only gets incremented towards the end of the loop by the game's frametime (meaning there may be more frames yielded during the loop, but it will stop after 40.0 frames are counted using the local variable):<ul> <li>The position is set to be on a quadratic Bezier curve with the following:<ul> <li>The start is the NPCControl position before this attack started</li> <li>The end is where the player is, but undershot by 1.5 from the direction of the NPCControl. This point is limited to be in a radius where the center is entity.<code>startpos</code> and the radius being <code>radiuslimit</code></li> <li>The y of the midpoint is 4.0</li> <li>The t factor is the ratio of the current amount of frames ellpsed since the start of the loop over 40.0. This essentially means the curve will last for a total of 40.0 counted frames and each position is interpolated over the course of those 40.0 frames</li> </ul> </li> <li><code>attacking</code> is set to true</li> <li>If the distance between the player and this NPCControl is less than 1.5 and we aren't in a <code>minipause</code>:<ul> <li>NPCControl.StartBattle is called</li> <li>entity.<code>overrideanim</code> is set to false</li> <li>StopForceBehavior is called</li> <li>entity.<code>overrideflip</code> is set to false</li> <li>This coroutines ends early with a yield break</li> </ul> </li> <li>DetectDirection is called with the NPCControl position - the normalised direction from the player to this NPCControl</li> <li>If entity.<code>hitwall</code> the loop is exited early (but the coroutine still continues). Essentially, it prevents movement when the entity.<code>detect</code> goes off</li> <li>Otherwise, a frame is yielded</li> <li>This is where the local variable controling this loop is incremented by the game's frametime. Only this increment counts (no other yields counts)</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code></li> </ul> </li> <li>When the loop is done, if <code>dirtcd</code> expired, <code>DirtExplodeLight</code> are played at the NPCControl position for 1 seconds with 0.75 uniform scaling</li> <li><code>dirtcd</code> is set to 30.0</li> <li>entity.<code>overrideflip</code> is set to false</li> <li>If we are <code>inrange</code>, entity.<code>digging</code> is set to true and entity.<code>digtime</code> is set to 100.0</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAndAttack/#underling","title":"<code>Underling</code>","text":"<p>The same than <code>Sandworm</code>, but just before <code>attacking</code> is set to true in the movement loop, entity.<code>sprite</code> z angle is set to a lerp between 0.0 and 180.0 where the factor is the ratio of the amount of frames the loop counter over 40.0. This makes it rotate with a roll along the movement. Animstate 100 is instead its head pointing upward.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAtPlayer/","title":"ChargeAtPlayer","text":"<p>Charges at the player with <code>attacking</code> set to true during the movement towards the player (this will allow an Enemy to initiate a battle with the advantage if it collides with the player and all conditions are met to start a battle with the advantage).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAtPlayer/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAtPlayer/#dobehavior","title":"DoBehavior","text":"<p>If <code>returntoheight</code> is true, the entity.<code>height</code> is set to a lerp from the existing one to entity.<code>initialheight</code> with a factor of 0.1.</p> <p>Finally, a ChargeAtPlayer coroutine is started and set to <code>behaviorroutine</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAtPlayer/#chargeatplayer_1","title":"ChargeAtPlayer","text":"<p>This is a private coroutine specific to this behavior. It receives the behavior type and a cooldown time (the <code>actioncooldown</code>) in frames that would have been used to smoothly return the entity.<code>height</code> to entity.<code>initialheight</code>, but in practice, it's always 0.0 which disables this feature. The coroutine call is assigned to <code>behaviorroutine</code> which allows the NPCControl to stop it if needed.</p> <ul> <li>entity.<code>rigid</code> is unlocked with LockRigid(false)</li> <li>The <code>Find</code> sound is played on the entity</li> <li>StopForceMove is called on the entity</li> <li>entity.animstate is set to <code>Chase</code> unless entity.<code>height</code> is higher than 0.1 where the value is set to <code>AirTackle</code></li> <li>If the entity is <code>onground</code>, Jump is called on it</li> <li>entity.<code>emoticonid</code> is set to 2 (the red !)</li> <li>entity.<code>emoticoncolldown</code> is set to 300.0</li> <li>0.25 seconds are yielded</li> <li>entity.<code>overrideonlyflip</code> is set to false</li> <li><code>attacking</code> is set to true</li> <li>MoveTowards is called on the entity with its <code>speedmultiplier</code>, new animstate set earlier for the walkstate, <code>Idle</code> for the stopstate ignoring the y component. The position is the player's + the direction from the player to this NPCControl normalised * 1.5. That position is however limited to a radius whose center is the entity. <code>startpos</code> and the radius being <code>radiuslimit</code>. Essentially, this moves the NPCControl to slightly undeshoot the player when going towards it</li> <li>entity.<code>detect</code> is ensured to be created</li> <li>DetectDirection is called on the entity using the player position</li> <li>As long as the entity.<code>forcemove</code> is ongoing and the entity.<code>hitwall</code> is false:<ul> <li>entity.<code>emoticonid</code> is set to 2 (the red !)</li> <li>entity.<code>emoticoncolldown</code> is set to 5.0</li> <li>If entity.<code>initialheight</code> is above 0.1, entity.<code>height</code> is set to a lerp from entity.<code>initialheight</code> to 0.25 with a factor of (the x/z square distance between this NPCControl and entity.<code>forcetarget</code>) / (the x/z square distance between entity.<code>startpos</code> and entity.<code>forcetarget</code>). NOTE: the math is likely incorrect, but the main point here is the NPCControl lowers faster as the player is further away from it and slows down as it gets closer</li> <li>A frame is yieled</li> </ul> </li> <li>A frame is yieled</li> <li>entity.<code>sprite</code> angles are set to the return of a FlipAngle call on the entity</li> <li><code>attacking</code> is set to false</li> <li>entity.<code>overrideonlyflip</code> is set to false</li> <li>StopForceMove is called on the entity with the <code>Idle</code> targetstate</li> <li>If the entity is <code>onground</code>, Jump is called on it</li> <li>0.2 seconds are yieled</li> <li>All frames are yieled until entity.<code>onground</code> goes to true</li> <li>A frame is yielded</li> <li>Some dead code is present here where the entity.<code>height</code> would be lerped towards entity.<code>initialheight</code>, but this is never applicable in practice because the passed cooldown is <code>actioncooldown</code> which is always 0.0 here</li> <li>A frame is yielded</li> <li>entity.<code>height</code> is set to entity.<code>initialheight</code></li> <li>StopForceBehavior is called</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAtPlayerFlipSprite/","title":"ChargeAtPlayerFlipSprite","text":"<p>The same then ChargeAtPlayer, but right after the MoveTowards call on the entity, the entity.<code>sprite</code> has its angles set to (0.0, the y angles facing the player + 90.0, 0.0) with an <code>overrideonlyflip</code> which locks the entity.<code>sprite</code> facing direction until the charge part of the coroutine is over.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAtPlayerFlipSprite/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAtPlayerFlipSprite/#dobehavior","title":"DoBehavior","text":"<p>The same then ChargeAtPlayer, but with the change mentioned above.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAttackUnderground/","title":"ChargeAttackUnderground","text":"<p>The same than ChargeAndAttack, but the behavior always makes the entity <code>digging</code> when not attacking and it can only attack after 30.0 frames of <code>digtime</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAttackUnderground/#frequency-meaning","title":"Frequency meaning","text":"<p>The same than ChargeAndAttack.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChargeAttackUnderground/#dobehavior","title":"DoBehavior","text":"<p>The entity.<code>digging</code> is set to true (which makes it dig underground) if the <code>behaviorroutine</code> isn't in progress (meaning it's not attacking already). It is set to false otherwise.</p> <p>The same logic than ChargeAndAttack follows, but with the added logic that in order for the ChargeAndAttack to occur, not only the distance check has to be fufilled, but the entity <code>digtime</code> must also be above 30.0 or the coroutine won't be called.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseOnWater/","title":"ChaseOnWater","text":"<p>The same than ChasePlayer, but the y position is adjusted according to the map.<code>waterfloat</code> if one exists.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseOnWater/#frequency-meaning","title":"Frequency meaning","text":"<p>The same than ChasePlayer.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseOnWater/#additionaldata","title":"Additionaldata","text":"<p>The same than ChasePlayer.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseOnWater/#dobehavior","title":"DoBehavior","text":"<p>The same than ChasePlayer.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseOnWater/#update-common-end-logic","title":"Update (Common end logic)","text":"<p>There is no logic here unlike ChasePlayer.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseOnWater/#lateupdate-non-dummy-and-the-entity-is-incamera-but-not-iskill","title":"LateUpdate (Non <code>dummy</code>, and the entity is <code>incamera</code>, but not <code>iskill</code>)","text":"<p>If this behavior exists on the NPCControl (either default or <code>inrange</code>) and the map.<code>waterfloat</code> is present, the y component of the position and the entity.<code>starpos</code> are set to the map.<code>waterfloat</code> one clamped from the map.<code>waterfloat.minwaterfloat</code> - 0.5 to infinity. This forces the NPCControl to be positioned on the same level than the map.<code>waterfloat</code> object which is the object that defines where the water's surface is located.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChasePlayer/","title":"ChasePlayer","text":"<p>Approach the player as close as possible within the <code>radiuslimit</code> or until there is no more ground to move in the direction of the player.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChasePlayer/#frequency-meaning","title":"Frequency meaning","text":"<p>None, overriden to 2.0 if it's not between 0.0 and 10.0 inclusive.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChasePlayer/#additionaldata","title":"Additionaldata","text":"<ul> <li><code>radiuslimit</code>: The max radius in which the entity is allowed to move in.</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ChasePlayer/#dobehavior","title":"DoBehavior","text":"<ul> <li>If <code>returntoheight</code> is true, entity.<code>height</code> is set to a lerp from the existing one to entity.<code>initialheight</code> with a factor of 0.1</li> <li>entity.<code>sprite</code> is enabled</li> <li>entity.<code>forcemove</code> is set to false</li> <li>FaceTowards is called on the entity with the player position as the facing point</li> <li>entity.<code>emoticonid</code> is set to 2 (!) and entity.<code>emoticoncooldown</code> is set to 2.0</li> <li>If HasGroundAhead returns true on the entity, Move is called on the entity to move it to the player position with the <code>speedmultiplier</code> speed and the <code>Chase</code> animstate. Otherwise, StopForceMove is called</li> <li>entity.<code>oldstate</code> and entity.<code>oldfly</code> is set to -1 (this forces a sprite update)</li> <li>The animstate is set to <code>Chase</code></li> <li>The position is limited to a radius of <code>radiuslimit</code> where the center is <code>startpos</code> ignoring the y component</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ChasePlayer/#update-common-end-logic","title":"Update (Common end logic)","text":"<p>If this is the current behavior (according to <code>inrange</code>) and we are in <code>minipause</code> or <code>inevent</code>, then StopForceMove is called on the entity.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseWhenAnim/","title":"ChaseWhenAnim","text":"<p>Perform the same logic than ChasePlayer when the entity.animstate is <code>Chase</code>. Otherwise, if the entity.<code>animstate</code> isn't the frequency, entity.<code>animstate</code> is set to it with a 20.0 frames <code>behaviorcooldown</code> (prevents a WalkWhenAnim doing a Wander DoBehavior cycle to process for 20.0 frames when entity.<code>animstate</code> is <code>Idle</code>) and a StopForceMove call on the entity.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseWhenAnim/#frequency-meaning","title":"Frequency meaning","text":"<p>An animstate to set the entity.<code>animstate</code> when the current one is different and it's not <code>Chase</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseWhenAnim/#about-this-behavior-and-animation-events","title":"About this behavior and animation events","text":"<p>This behavior is intended to be used with an animstate as the frequency whose clip contains an animation event that sets the entity.<code>animstate</code> to <code>Chase</code>. This is because under normal circumstances, there is no logic to change the entity.<code>animstate</code> to <code>Chase</code> offered by this behavior. It is intended to be used whenever the timing of the ChasePlayer needs to be carefully determined by the animation clip instead of immediately triggering when the player gets <code>inrange</code>.</p> <p>It can be used as the <code>inrange</code> behavior while WalkWhenAnim is the default one. This allows <code>behaviorcooldown</code> to take effect and not change the entity.<code>animstate</code> too frequently.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ChaseWhenAnim/#dobehavior","title":"DoBehavior","text":"<p>If the entity.<code>animstate</code> is <code>Chase</code>, this acts as an alias to ChasePlayer.</p> <p>Otherwise, if the current entity.<code>animstate</code> isn't the <code>frequency</code>:</p> <ul> <li>The <code>behaviorcooldown</code> is set to 20.0 (prevents a WalkWhenAnim doing a Wander DoBehavior cycle to process for 20.0 frames when entity.<code>animstate</code> is <code>Idle</code>)</li> <li>StopForceMove is called on the entity</li> <li>The entity.<code>animstate</code> is set to frequency</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/","title":"Disguise","text":"<p>A behavior where the map entity has a special <code>disguiseobj</code> that will replace its normal entity.<code>sprite</code> appearence until the behavior is switched away from which reveals the entity.<code>sprite</code> (usually by going into the <code>inrange</code> one). After coming back to this behavior (usually by going out of <code>inrange</code>), the entity will move back to its <code>startpos</code> and put its disguise on again.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#a-general-explanation-of-how-disguising-works","title":"A general explanation of how disguising works","text":"<p>This behaviors hinges on a special object called the <code>disguiseobj</code> which is childed to entity.<code>sprite</code> on SetUp.</p> <p>Due to this structure, it's positioned similarly to how entity.<code>model</code> would, but this behavior is made to not involve a model entity and instead flip flops the enablement of the <code>disguiseobj</code> and the entity.<code>sprite</code> such that only one of the 2 is enabled at a given time.</p> <p>However, EntityControl.Update will think this structure is like a model entity and it will try to sync the enablement of the entity.<code>sprite</code>'s child to the entity.<code>sprite</code>.enabled. This contradicts the goal of this behavior so what the behavior will do when it is active is to keep enforcing the rule that only one of the 2 can remain enabled by essentially fighting against EntityControl's Update.</p> <p>Since this behavior is what keeps the <code>disguiseobj</code> from being disabled by EntityControl, whenever the player gets <code>inrange</code> and this behavior is switched away, it will no longer fight against EntityControl causing the entity.<code>sprite</code> to be enabled with the <code>disguiseobj</code> disabled. This is how an NPCControl with this behavior can reveal itself.</p> <p>If the player gets out of <code>inrange</code> after this and we come back to this behavior, it now manages a cooldown (the <code>disguisecooldown</code>) of 120 frames that will have the entity move to its <code>startpos</code> when it gets to 20 frames left. From there, either the 20 frames expires or it reached the entity.<code>startpos</code> within 2.0 units which will cause this behavior to flip flop again such that entity.<code>sprite</code> is disabled and <code>disguiseobj</code> enabled. This puts back the disguise and the cycle continues.</p> <p>Due to this complex management of the <code>disguiseobj</code>, this behavior's logic is very spread out throughout the game because it needs to fight against EntityControl.Update as there is very little logic there to support the disguise feature.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#start-setup","title":"Start / SetUp","text":"<p>On SetUp:</p> <ul> <li>entity.<code>alwaysactive</code> is set to true</li> <li><code>disguiseobj</code> is initialised to the transform of <code>prefabs/Disguises/x</code> prefab where x is the entity.AnimID. It gets childed to the entity.<code>sprite</code> which also gets disabled making only the disguise visible instead of the sprite. The local position is ensured to be Vector3.zero, but the angles and the scales depends on the AnimID (anything not mentioned is left default):<ul> <li><code>Cactus</code>: scale of (70.0, 25.0, 70.0)</li> <li><code>Mushroom</code>: scale of (20.0, 15.0, 25.0)</li> <li><code>CursedSkull</code>: scale of 0.5 uniform, local position of (0.0, 0.0, -0.5) and angles of (-90.0, 0.0, 0.0)</li> <li><code>Plumpling</code>: scale of 0.2 uniform and angles of (-90.0, 0.0, 180.0)</li> </ul> </li> </ul> <p>After SetUp returned on Start:</p> <ul> <li><code>disguiseobj</code> is enabled</li> <li><code>disguisecooldown</code> is set to -1 (meaning it simulates an already expired disguise cooldown)</li> <li>entity.<code>sprite</code> is disabled </li> <li>enity.<code>height</code> is set to 0.0 </li> </ul> <p>All of this hides the actual sprite of the entity with no visual offset and it leaves the disguise object visible.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#dobehavior-main-logic","title":"DoBehavior (Main logic)","text":"<p>Nothing happens if <code>disguisecooldown</code> is below 0 (meaning it expired more than a cycle ago).</p> <p>The main logic depends on the <code>disguisecooldown</code> which is an int countdown of the number of update cycles left before the <code>disguiseobj</code> gets enabled and the entity.<code>sprite</code> disabled. This occurs if by the end of this cycle, it reaches 0 or below and the opposite happens if it not. No matter what specific branch of the logic applies, these enablement changes always happen after the branch is done.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#disguisecooldown-is-0-it-just-expired-last-cycle","title":"<code>disguisecooldown</code> is 0 (it just expired last cycle)","text":"<ul> <li>TempSpin will be called on the entity which sets its <code>spin</code> to (0.0, 20.0, 0.0) and then zerored out in 0.2 seconds</li> <li><code>disguisecooldown</code> is set to -1</li> <li>StopForceMove is called on the entity</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#disguisecooldown-hasnt-expired-yet-and-either-its-20-or-above-or-the-npccontrol-is-20-or-less-away-from-entitystartpos","title":"<code>disguisecooldown</code> hasn't expired yet and either it's 20 or above or the NPCControl is 2.0 or less away from entity.<code>startpos</code>","text":"<ul> <li>StopForceMove is called on the entity</li> <li><code>disguisecooldown</code> is decremented</li> <li>If <code>disguisecooldown</code> is 40 or 80, entity.<code>flip</code> is toggled (this is by default the 2/3 and 1/3 point of the cooldown)</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#disguisecooldown-hasnt-expired-yet-and-its-below-20-while-the-npccontrol-is-more-than-20-away-from-entitystartpos","title":"<code>disguisecooldown</code> hasn't expired yet and it's below 20 while the NPCControl is more than 2.0 away from entity.<code>startpos</code>","text":"<ul> <li>DetectDirection is called on the entity with the entity.<code>startpos</code></li> <li>Align the entity.<code>moverotater</code> to the entity.<code>startpos</code> via a LookAt call</li> <li>If a HasGroundAhead call returns true, MoveTowards is called on the entity to move the entity to its <code>startpos</code> ignoring the y component at normal speed with the state being <code>Walk</code> and the stopstate being <code>Idle</code>. Otherwise, StopForceMove is called on the entity setting the animstate to its existing one at the end</li> <li>The entity.animstate is set to the entity.<code>walkstate</code></li> <li>The entity.<code>oldstate</code> is set to -1 (which forces a sprite update)</li> <li>If entity.<code>hitwall</code> is true:</li> <li>The NPCControl position is set to entity.<code>startpos</code></li> <li>entity.<code>rigid</code> velocity is zeroed out</li> <li>DeathSmoke particles are played at the NPCControl position if the entity is <code>incamera</code></li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#update-inactive","title":"Update (Inactive)","text":"<p>If the <code>disguisecooldown</code> is fully expired (it's -1):</p> <ul> <li><code>disguiseobj</code> is enabled</li> <li>The entity.<code>sprite</code> gets disabled if entity.<code>campos</code> z is above 5.0 (meaning it's too far forward from the camera), it remains enabled otherwise</li> <li><code>overrideminheight</code> is set to true</li> <li>The entity.<code>height</code> is set to 0.0</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#lateupdate-not-a-dummy-and-the-entity-is-incamera","title":"LateUpdate (Not a <code>dummy</code> and the entity is <code>incamera</code>)","text":"<p>If the <code>freezecooldown</code> and <code>dizzytime</code> expired while we aren't <code>minipause</code>, the enity.<code>height</code> is set to a lerp from the existing one to <code>initialheight</code> or 0.0 with a factor of 1/10 of the game's frametime. What determines the destination height is if the <code>disguisecooldown</code> is 0 or above where it's <code>initialheight</code>, 0.0 otherwise.</p> <p>Otherwise, if we are in a <code>minipause</code>, then the <code>disguiseobj</code> is enabled if <code>disguisecooldown</code> is -1 (fully expired), disabled otherwise while the opposite is done on the entity.<code>sprite</code>. The enablement values only changes when needed instead of every cycle by checking if the <code>disguiseobj</code> is enabled or not in comparison to <code>disguisecooldown</code> being -1 or not.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#update-frozen-enemy-override","title":"Update (Frozen <code>Enemy</code> override)","text":"<ul> <li><code>disguisecooldown</code> is set to 120</li> <li><code>disguiseobj</code> is disabled</li> <li>entity.<code>sprite</code> being enabled.</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#update-dizzy-enemy-override","title":"Update (dizzy <code>Enemy</code> override)","text":"<p>The <code>disguiseobj</code> is disabled.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#dizzy","title":"Dizzy","text":"<p>The <code>disguiseobj</code> is disabled with the entity.<code>sprite</code> being enabled.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#entitycontrolupdate-active","title":"EntityControl.Update (active)","text":"<p>This behavior prevents the entity.<code>sprite</code> from being enabled there. It also goes against this behavior at least as far as the <code>disguiseobj</code> is concerned, but this behavior doesn't change this logic in particular, only overrides it.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#entitycontrolupdatesprite","title":"EntityControl.UpdateSprite","text":"<p>This update method is disallowed to change the <code>sprite</code> enablement on an Enemy with this behavior.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#mainmanagerrefreshentities","title":"MainManager.RefreshEntities","text":"<p>This logic only matters if the method was called as a result of MapControl.Start, MapControl.RefreshInsides and BattleControl.ReturnToOverworld:</p> <ul> <li><code>disguisecooldown</code> is set to -1 (fully expired)</li> <li><code>disguiseobj</code> is disabled</li> <li>entity.<code>sprite</code> being enabled.</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#mapcontrolpreloadsprites","title":"MapControl.PreloadSprites","text":"<p>This behavior prevents the preloading of the entity.<code>sprite</code> texture into the map.<code>entitysprite</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#respawnenemy-only-if-its-the-default-behavior","title":"RespawnEnemy (Only if it's the default behavior)","text":"<ul> <li>The <code>disguiseobj</code> is destroyed if it was present</li> <li>The entity.<code>speed</code> is set to 2.0</li> <li>The <code>disguisecooldown</code> is set to -1</li> <li>The default behavior is set to Wander</li> <li>The entity.<code>onground</code> is set to true in 0.5 seconds</li> </ul> <p>This will get further handled by DoBehavior, see the section below for details</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Disguise/#dobehavior-behavior-no-longer-exists","title":"DoBehavior (behavior no longer exists)","text":"<p>A special case is handled where this behavior no longer exists, but the <code>disguiseobj</code> still does. The only way for this case to happen is if a destroy of the <code>disguiseobj</code> was requested by RespawnEnemy because not only it destroys it, but it also changes the default behavior to Wander. If this was the previous one and it wasn't the <code>inrange</code> one, then it no longer exists after the respawn which makes it fall into this special case. The handling goes as follow:</p> <ul> <li>TempSpin is called on the entity which sets its <code>spin</code> to (0.0, 20.0, 0.0) and then zerored out in 0.2 seconds</li> <li>The <code>disguisecooldown</code> is set to 120.0</li> <li>The entity.<code>overridehright</code> is set to false</li> <li>The <code>disguiseobj</code> is disabled</li> </ul> <p>Because the behavior was also changed, the main logic won't occur.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnce/","title":"DisguiseOnce","text":"<p>The same than Disguise, but if it's the default behavior, it becomes Wander whenever the player gets <code>inrange</code> and the <code>disguiseobj</code> is destroyed.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnce/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnce/#update-active-only-if-it-is-the-default-behavior","title":"Update (active, only if it is the default behavior)","text":"<p>If we aren't <code>trapped</code>, we are <code>inrange</code>, and none of the override cases applied if this is an Enemy (dizzy, frozen and about to be unfrozen), the default behavior is set to Wander and the <code>disguiseobj</code> is destroyed if it was present which ends this behavior.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/","title":"DisguiseOnceJumpForward","text":"<p>A semi functional and likely unfinished behavior similar to Disguise that is recognised as a disguise behavior alongside Disguise and DisguiseOnce, but it doesn't have any DoBehavior logic.</p> <p>NOTE: this is unused under normal gameplay and is likely not fully functional despite having unique logic backing this behavior (in this case, not doing anything in DoBehavior).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#start-setup","title":"Start / SetUp","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#dobehavior","title":"DoBehavior","text":"<p>No logic occurs here.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#update-inactive","title":"Update (Inactive)","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#lateupdate-not-a-dummy-and-the-entity-is-incamera","title":"LateUpdate (Not a <code>dummy</code> and the entity is <code>incamera</code>)","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#update-frozen-enemy-override","title":"Update (Frozen <code>Enemy</code> override)","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#update-dizzy-enemy-override","title":"Update (dizzy <code>Enemy</code> override)","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#dizzy","title":"Dizzy","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#entitycontrolupdate-active","title":"EntityControl.Update (active)","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#entitycontrolupdatesprite","title":"EntityControl.UpdateSprite","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#mainmanagerrefreshentities","title":"MainManager.RefreshEntities","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/DisguiseOnceJumpForward/#mapcontrolpreloadsprites","title":"MapControl.PreloadSprites","text":"<p>The same than Disguise</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceAhead/","title":"FaceAhead","text":"<p>Stops any force move on the entity and causes the entity to face towards the right vector of this entity (towards their x axis facing direction).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceAhead/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceAhead/#setinitialbehavior-only-if-its-the-default-behavior","title":"SetInitialBehavior (Only if it's the default behavior)","text":"<p>FaceAhead is called on the entity and it is also invoked in 0.5 seconds and another time in 1 second.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceAhead/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p> <p>Then, FaceTowards is called on the entity with the facing point being this entity position + its right vector.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceAwayFromPlayer/","title":"FaceAwayFromPlayer","text":"<p>Stops any force move on the entity and causes the entity.<code>flip</code> to be set such that the sprite faces the opposite direction of the player horizontally.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceAwayFromPlayer/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceAwayFromPlayer/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p> <p>If the player is not present, no changes occur on the entity.<code>flip</code> value.</p> <p>The entity.<code>flip</code> is set to false when the entity x position is strictly higher than the player. It is set to true otherwise.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceBehind/","title":"FaceBehind","text":"<p>Stops any force move on the entity and causes the entity to face towards the left vector of this entity (the opposite direction of their x axis direction)</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceBehind/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceBehind/#setinitialbehavior-only-if-its-the-default-behavior","title":"SetInitialBehavior (Only if it's the default behavior)","text":"<p>FaceBehind is called on the entity and it is also invoked in 0.5 seconds and another time in 1 second.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceBehind/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p> <p>Then, FaceTowards is called on the entity with the facing point being this entity position - its right vector.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceDown/","title":"FaceDown","text":"<p>Stops any force move on the entity and causes the entity to face towards the backward vector of this entity (usually towards the camera).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceDown/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceDown/#setinitialbehavior-only-if-its-the-default-behavior","title":"SetInitialBehavior (Only if it's the default behavior)","text":"<p>FaceDown is called on the entity and it is also invoked in 0.5 seconds and another time in 1 second.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceDown/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p> <p>Then, FaceTowards is called on the entity with the facing point being this entity position - its forward vector.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FacePlayer/","title":"FacePlayer","text":"<p>Stops any force move on the entity and causes the entity to face towards the player if it is present.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FacePlayer/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FacePlayer/#setinitialbehavior-only-if-its-the-default-behavior","title":"SetInitialBehavior (Only if it's the default behavior)","text":"<p>FacePlayer is called on the entity and is is also invoked in 0.5 seconds and another time in 1 second.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FacePlayer/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p> <p>Then, if the player is present, FaceTowards is called on the entity with the facing point being the player position.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FacePlayer/#interact","title":"Interact","text":"<p>If this behavior is the second one in the <code>behaviors</code> array (the <code>inrange</code> one), FaceTowards is called on the entity with the facing point being the player position.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceUp/","title":"FaceUp","text":"<p>Stops any force move on the entity and causes the entity to face towards the forward vector of this entity (usually away from the camera).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceUp/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceUp/#setinitialbehavior-only-if-its-the-default-behavior","title":"SetInitialBehavior (Only if it's the default behavior)","text":"<p>FaceUp is called on the entity and it is also invoked in 0.5 seconds and another time in 1 second.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FaceUp/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p> <p>Then, FaceTowards is called on the entity with the facing point being this entity position + its forward vector.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FleeFromPlayer/","title":"FleeFromPlayer","text":"<p>Stops any force move on the entity and have it move towards the opposide direction from the player.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FleeFromPlayer/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/FleeFromPlayer/#dobehavior","title":"DoBehavior","text":"<p>If the entity is in a <code>forcemove</code>, StopForceMove is called on the entity.</p> <p>Then, if we aren't <code>tattling</code> or we are in <code>pause</code> (NOTE: this is likely a bug as it allows movement when paused), Move is called on the entity at the direction opposite of the player position with normal speed multiplier and with the <code>Idle</code> animstate.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/None/","title":"None","text":"<p>Stops any force move on the entity.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/None/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/None/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/","title":"SetPath","text":"<p>Periodically performs MoveTowards calls on the entity using a fixed configurable interval between moves and the path being made of position nodes defined in <code>vectordata</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#frequency-meaning","title":"Frequency meaning","text":"<p>The time in frames to wait between movement to the next node.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#additional-data","title":"Additional data","text":"<ul> <li><code>vectordata</code>: The list of position nodes forming the path the AI will attempt to follow.</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#setup","title":"SetUp","text":"<p>The entity.<code>alwaysactive</code> is set to true.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#dobehavior","title":"DoBehavior","text":"<p>If <code>returntoheight</code> is true entity.<code>height</code> is set to a lerp from the existing one to entity.<code>initialheight</code> with a factor of 0.1.</p> <p>What happens next depends if all of the following are true:</p> <ul> <li>The entity isn't in a <code>forcemove</code></li> <li>The entity <code>hitwall</code> is false</li> <li><code>vectordata</code> exists and isn't empty</li> </ul> <p>If all of them are true, then the entity will decide on the next destination to move to. Otherwise, it means the either is in a <code>forcemove</code>, its <code>detect</code> detects a wall or no nodes are defined in general.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#entityforcemove-entityhitwall-no-nodes","title":"entity.<code>forcemove</code> / entity.<code>hitwall</code> / no nodes","text":"<ul> <li>If the entity.<code>detect</code> is present, DetectDirection is called using the <code>forcetarget</code> as the direction.</li> <li>If the entity.<code>hitwall</code> is true, StopForceMove is called.</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#moving-to-next-destination","title":"Moving to next destination","text":"<p>If the <code>actioncooldown</code> hasn't expired yet, it is decremented by framestep and this cycle ends.</p> <p>If it has expired, then MoveTowards is called on the entity. <code>currentmode</code> is used to determine the next node index to use as the position from <code>vectordata</code>. It gets incremented on this cycle when the distance squared between this position and the current node is less than 0.375 (meaning it's essentially at the current one which means it has reached it) and it gets reset to 0 when it reaches the length of <code>vectordata</code> so it loops around. The actual call is done with default speed multiplier, a <code>Walk</code> walkstate and an <code>Idle</code> stopstate.</p> <p>Finally, <code>actioncooldown</code> is set to the frequency and the cycle continues.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#update-inactive-every-3-frames","title":"Update (Inactive, every 3 frames)","text":"<p>Normally, when the entity is in a <code>forcemove</code>, StopForceMove is called on it, but this behavior is an exception to this where it will not be called here.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#entitycontroldeath","title":"EntityControl.Death","text":"<p>This behavior forbids an Enemy with it to drop an item because the behavior uses <code>vectordata</code> for its own purposes which interferes with the enemy item drop system.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPath/#respawnenemy","title":"RespawnEnemy","text":"<p>If the behavior is present on the NPCControl, the <code>actioncooldown</code> is set to 0.0 and the <code>currentnode</code> to 0</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPathJump/","title":"SetPathJump","text":"<p>Similar than SetPath, but after the MoveTowards call, the entity <code>forcejump</code> is set to true which makes it jump during its FixedUpdate when moving to the next node if possible.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPathJump/#frequency-meaning","title":"Frequency meaning","text":"<p>The same than SetPath.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPathJump/#additional-data","title":"Additional data","text":"<p>The same than SetPath.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPathJump/#setup","title":"SetUp","text":"<p>This has no logic unlike SetPath.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPathJump/#dobehavior","title":"DoBehavior","text":"<p>The same than SetPath, but when the MoveTowards call occurs, it will set the entity <code>forcejump</code> to true which makes it jump when possible during the move to the next node.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPathJump/#update-inactive-every-3-frames","title":"Update (Inactive, every 3 frames)","text":"<p>This has no logic unlike SetPath.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPathJump/#entitycontroldeath","title":"EntityControl.Death","text":"<p>The same than SetPath.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/SetPathJump/#respawnenemy","title":"RespawnEnemy","text":"<p>This has no logic unlike SetPath.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/","title":"ShootProjectile","text":"<p>Attacks the player by shooting an OverworldProjectile which can, under the right conditions, start a battle with advantage. The specifics of the projectile logic is dependant on the animid and only a few have a logic defined for this behavior.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#an-overview-of-overworldprojectile","title":"An overview of OverworldProjectile","text":"<p>This component is only involved over the course of this behavior. It is meant to be created externally via a static method called NewProjectile defined in that component's MonoBehavior. It takes a lot of parameters to setup the projectile notably a <code>parent</code> which will be this NPCControl.</p> <p>At a basic level, an OverworldProjectile is a sprite with a default trigger BoxCollider that has the ability to call NPCControl.StartBattle with advantage on its OnTriggerStay when all of the following conditions are fufilled:</p> <ul> <li>The other collider is the player</li> <li>We aren't in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or <code>inbattle</code></li> <li>The player isn't on <code>shield</code></li> <li>This NPCControl entity isn't <code>iskill</code></li> <li>This NPCControl <code>dizzytime</code> expired (this prevents encounters where the projectile hit the player, but the player stunned them before)</li> </ul> <p>The projectile has a limited amount of screen time in frames, but if it touches the player (without encounter) or a <code>Ground</code> / <code>NoDigGround</code> layer, it gets destroyed with optional special effects.</p> <p>As for the movement of the OverworldProjectile, it moves along a beizer curve with start / end points alongside the y position of the mid point. However, it is possible to send 0.1 or less for that last parameter to have it lerp in a straight line instead according to its screen time.</p> <p>As for the rendering of of the projectile, it's a sprite index of the <code>Sprites/Misc/projectiles</code> sprites, but it's possible to send a negative number to specify an item id (the absolute value) to use as the sprite.</p> <p>Notable traits of an OverworldProjectile GameObject:</p> <ul> <li>Its name is <code>proj</code></li> <li>It is childed to the map</li> <li>A GameObject is childed to it with a SpriteRenderer called <code>tempproj</code></li> <li>Its layer is 14 (<code>Sprite</code>)</li> <li>Its tag is <code>Projectile</code></li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#dobehavior","title":"DoBehavior","text":"<p>If <code>returntoheight</code> is true, the entity.<code>height</code> is set to a lerp from the existing one to its <code>initialheight</code> with a factor of 0.1.</p> <p>If the entity is in a <code>forcemove</code>, StopForceMove is called on the entity without smoothing and without changing the animstate.</p> <p>Finally, a ShootProjectile coroutine is started and set to <code>behaviorroutine</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#shootprojectile_1","title":"ShootProjectile","text":"<p>This is a private coroutine specific to this behavior. It receives the behavior type and the coroutine call is assigned to <code>behaviorroutine</code> which allows the NPCControl to stop it if needed.</p> <ul> <li>Emoticon is called on the entity with id 2 (a red ! mark) for 60 frames</li> <li>If <code>projectiles</code> is null, it is initalised to a new List of OverworldProjectile</li> <li>All null elements in <code>projectiles</code> are removed</li> <li>FaceTowards is called on the entity to face the player</li> <li>From there, the projectile is fired depending on the entity.animid. See the section below for more details. If this is not an animid with a projectile logic, the following is done:<ul> <li>entity.animstate is set to entity.<code>basestate</code></li> <li>If we aren't <code>inrange</code>, entity.<code>overrideonlyflip</code> is set to false</li> <li>A frame is yielded</li> <li>StopForceBehavior is called</li> <li>The coroutine is exited early with a yield break</li> </ul> </li> <li>entity.animstate is set to entity.<code>basestate</code></li> <li>If we aren't <code>inrange</code>, entity.<code>overrideonlyflip</code> is set to false</li> <li>A frame is yielded</li> <li>StopForceBehavior is called</li> <li>If we still aren't <code>inrange</code>, Emoticon is called on the entity with id 1 (? mark) for 60 frames</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#projectile-logic","title":"Projectile logic","text":"<p>Here are the different logic available for each animid.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#deadlandera","title":"<code>DeadLanderA</code>","text":"<p>If there's no <code>projectiles</code>:</p> <ul> <li>entity.animstate is set to 103 (shooting)</li> <li>A second is yielded</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code></li> <li>If either <code>dizzytime</code> or <code>freezecooldown</code> haven't expired, this projectile logic ends early (but the coroutine continues)</li> <li>FaceTowards is called on the entity to face the player</li> <li>entity.<code>animstate</code> is set to 104 (going back to idle from shooting)</li> <li>A projectile gets added with this NPCControl as the parent:<ul> <li>sprite index 10 (honey projectile)</li> <li>starting position at this NPCControl position - its right vector + (0.0, 1.25, 0.0)</li> <li>target position being the player position undershot by 1.5 towards the direction of the player</li> <li>No spin</li> <li>y angles of the entity.<code>sprite</code> angle, but no x or z</li> <li>size of uniform 0.75</li> <li><code>HoneyExplode</code> particles on the projectle destruction</li> <li>y midpoint of the bezier curve of 2.0</li> <li>time of 50.0 frames</li> <li>shadow size multiplier of 0.25</li> </ul> </li> <li>0.5 seconds are yielded</li> </ul> <p>No matter if there was projectiles or not, all frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield which ends this projectile.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#waspbomber","title":"<code>WaspBomber</code>","text":"<p>If there's no <code>projectiles</code>:</p> <ul> <li>entity.<code>animstate</code> is set to 101 (throwing)</li> <li>A projectile gets added with this NPCControl as the parent:<ul> <li>sprite index -30 (<code>SpicyBomb</code> item sprite)</li> <li>starting position at this NPCControl position - its right vector + (0.25, 1.25, -0.1)</li> <li>target position being the player position undershot by 1.5 towards the direction of the player</li> <li>Spin of 20.0 in z (no x or y)</li> <li>y angles of the entity.<code>sprite</code> angle, but no x or z</li> <li>size of uniform 1.0</li> <li><code>explosionsmall</code> particles on the projectle destruction (also, if the player is less than 15.0 away on destruction, <code>Explosion</code> sound is played at 0.75 pitch followed by a ShakeScreen of 0.1 for 0.5 seconds without reset)</li> <li>y midpoint of the bezier curve of 5.0</li> <li>time of 80.0 frames</li> <li>shadow size multiplier of 0.5</li> </ul> </li> <li>a second is yielded</li> <li>entity.<code>animstate</code> is set to 0 (<code>Idle</code>)</li> </ul> <p>No matter if there was projectiles or not, all frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield which ends this projectile.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#toebiter","title":"<code>ToeBiter</code>","text":"<p>If there was at least 1 <code>projectiles</code>, all frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield which ends this projectile logic.</p> <p>If there's no <code>projectiles</code>:</p> <ul> <li>entity.<code>animstate</code> is set to 100 (lowering upper limbs to the ground)</li> <li>0.5 seconds are yielded</li> <li>entity.<code>animstate</code> is set to 101 (putting upper limbs in the air)</li> <li>If <code>dizzytime</code> or <code>freezecooldown</code> aren't expired, this projectile logic ends early, but the coroutine still continues</li> <li>All frames are yielded as long as the player isn't free (ignoring flying) or they are <code>digging</code></li> <li>If <code>internaltransform[0]</code> doesn't exist, it is initialised to a <code>Prefabs/Objects/CrackedRock</code> prefab without its MeshCollider and Fader with a position of this NPCControl + (0.0, -2.0, 0.0), and a scale of 0.5 uniform</li> <li><code>internaltransform[0]</code> is childed to the map</li> <li>If <code>dizzytime</code> or <code>freezecooldown</code> aren't expired, this projectile logic ends early, but the coroutine still continues</li> <li>From there, there is a loop that goes on for up to 11.0 frames, but counted by a local variable which only gets incremented towards the end of the loop by the game's frametime (meaning there may be more frames yielded during the loop, but it will stop after 11.0 frames are counted using the local variable):<ul> <li><code>internaltransform[0]</code> position is set to a lerp from the existing one to (entity.<code>sprite</code> position + the normalised right vector of the entity + 0.3 in y) with a factor of the ratio of the amount of frames counted in this loop over 11.0. This basically moves the rock on a straight line to a position above the entity, but slightly towards them</li> <li>If <code>dizzytime</code> or <code>freezecooldown</code> aren't expired, this projectile logic ends early, but before it is ends, all frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield</li> <li>This is where the local frame counter is incremented by the game's frametime, but only if we aren't in a <code>pause</code></li> <li>A frame is yielded</li> </ul> </li> <li>0.25 seconds are yielded</li> <li>All frames are yielded as long as the player isn't free (ignoring flying)</li> <li>entity.<code>animstate</code> is set to 28 (TossItem)</li> <li>All frames are yielded as long as the player isn't free (ignoring flying)</li> <li>If <code>dizzytime</code> or <code>freezecooldown</code> aren't expired, this projectile logic ends early, but the coroutine still continues</li> <li>The <code>Toss3</code> sound is played at 0.9 volume</li> <li>A projectile gets added with this NPCControl as the parent:<ul> <li>sprite index 17 (A brown missile)</li> <li>starting position at this <code>internaltransform[0]</code> position</li> <li>target position being the player position undershot by 1.5 towards the direction of the player</li> <li>No spin</li> <li>y angles of the entity.<code>sprite</code> angle and z angle of 90.0, no x</li> <li>size of uniform 0.5</li> <li><code>Rock</code> particles on the projectle destruction (will also lead to the rooting of the rock if it still exists followed by CrackRock being called on it. Additionally, if the player is 15.0 away, <code>RockBreak</code> sound is played at 0.75 pitch followed by a ShakeScreen of 0.1 for 0.5 seconds without reset)</li> <li>y midpoint of the bezier curve of 3.0</li> <li>time of 40.0 frames</li> <li>shadow size multiplier of 0.25</li> </ul> </li> <li>The projectile gets childed to <code>internaltransform[0]</code>. This is done so because the game hides the fact the rock isn't the projectile, but rather a brown missile is and its sprite gets disabled on the OverworldProjectile's Start because of the <code>Rock</code> particle on death parameter sent</li> <li><code>internaltransform[0]</code> is set to null (OverworldProjectile takes control of it from now on)</li> <li>0.5 seconds are yielded</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield which ends this projectile</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#sneilenemy","title":"<code>SneilEnemy</code>","text":"<p>If there's no <code>projectiles</code>:</p> <ul> <li>entity.<code>animstate</code> is set to 100 (preparing to shoot)</li> <li>FlipSpriteAngleAt is called on the entity towards the player with offset (0.0, 90.0, 0.0)</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code></li> <li>If <code>dizzytime</code> or <code>freezecooldown</code> aren't expired, this projectile logic ends early, but the coroutine still continues</li> <li>The <code>Lazer</code> sound is played on the entity</li> <li>FlipSpriteAngleAt is called on the entity towards the player with offset (0.0, 90.0, 0.0)</li> <li>A projectile gets added with this NPCControl as the parent:<ul> <li>sprite index 4 (A white lightning bolt)</li> <li>starting position at this NPCControl position - its  right vector + 0.1 in y</li> <li>target position being the player position undershot by 1.5 towards the direction of the player + 2.0 in y</li> <li>No spin</li> <li>y angles of the entity.<code>sprite</code> angle and z angle of 90.0, no x</li> <li>size of uniform 0.75</li> <li>No particles on destruction</li> <li>y midpoint of the bezier curve of 0.0</li> <li>time of 60.0 frames</li> <li>shadow size multiplier of 0.25</li> </ul> </li> <li>0.75 seconds are yielded</li> <li>all frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield which ends this projectile.</li> </ul> <p>Otherwise, if there was a projectile:</p> <ul> <li>entity.<code>animstate</code> is set to entity.<code>basestate</code></li> <li>entity.<code>overrideflip</code> is set to false</li> <li>A frame is yielded</li> <li>StopForceBehavior is called</li> <li>The coroutine is ended early with a yield break</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#beebot","title":"<code>BeeBot</code>","text":"<p>If there's less than 2 <code>projectiles</code>:</p> <ul> <li>entity.<code>animstate</code> is set to 100 (preparing to shoot)</li> <li>FlipSpriteAngleAt is called on the entity towards the player with offset (0.0, 90.0, 0.0)</li> <li>0.5 seconds are yielded</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code></li> <li>If <code>dizzytime</code> or <code>freezecooldown</code> aren't expired, this projectile logic ends early, but the coroutine still continues</li> <li>FlipSpriteAngleAt is called on the entity towards the player with offset (0.0, 90.0, 0.0)</li> <li>A projectile gets added with this NPCControl as the parent:<ul> <li>sprite index 10 (honey projectile)</li> <li>starting position at this NPCControl position - its right vector + 1.25 in y</li> <li>target position being the player position undershot by 1.5 towards the direction of the player</li> <li>No spin</li> <li>y angles of the entity.<code>sprite</code> angle, no x or z</li> <li>size of uniform 0.75</li> <li><code>HoneyExplode</code> particles on destruction</li> <li>y midpoint of the bezier curve of 2.0</li> <li>time of 60.0 frames</li> <li>shadow size multiplier of 0.25</li> </ul> </li> <li>0.3 seconds are yielded</li> </ul> <p>No matter if there was less than 2 projectiles or not, all frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield which ends this projectile.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#turret","title":"<code>Turret</code>","text":"<p>The same than <code>BeeBot</code> with a few changes:</p> <ul> <li>The first yield is 0.7 seconds instead of 0.5</li> <li>Right before the second FlipSpriteAngleAt, entity.<code>animstate</code> is set to 102 (shooting)</li> <li>The last yield is 0.4 seconds instead of 0.3</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#waspscout","title":"<code>WaspScout</code>","text":"<p>If there's no <code>projectiles</code>:</p> <ul> <li>entity.<code>animstate</code> is set to 100 (preparing to throw)</li> <li>FaceTowards is called on the entity to face the player</li> <li>0.25 seconds are yielded</li> <li>entity.<code>animstate</code> is set to 102 (throwing)</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code></li> <li>If <code>dizzytime</code> or <code>freezecooldown</code> aren't expired, this projectile logic ends early, but the coroutine still continues</li> <li>The <code>Toss</code> sound is played on the entity</li> <li>FlipSpriteAngleAt is called on the entity towards the player with offset (0.0, 90.0, 0.0)</li> <li>A projectile gets added with this NPCControl as the parent:<ul> <li>sprite index 2 (a brown kunai)</li> <li>starting position at this NPCControl position - its right vector + 1.75 in y</li> <li>target position being the player position undershot by 1.5 towards the direction of the player</li> <li>No spin</li> <li>y angles of the entity.<code>sprite</code> angle and -60.0 in z, no x</li> <li>size of uniform 0.75</li> <li>No particles on destruction</li> <li>y midpoint of the bezier curve of 0.0</li> <li>time of 45.0 frames</li> <li>shadow size multiplier of 0.25</li> </ul> </li> <li>0.75 seconds are yielded</li> </ul> <p>No matter if there was projectiles or not, all frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield which ends this projectile.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#leafbugarcher","title":"<code>LeafbugArcher</code>","text":"<p>The same than <code>WaspScout</code>, but with a few changes:</p> <ul> <li>Before facing towards the entity, the <code>Rope1</code> sound is played on the entity</li> <li>The first yield is 0.5 seconds instead of 0.25</li> <li>The projectile sprite index is 12 (a purple blunt projectile) instead of 2 (a brown kunai)</li> <li>The offset to the projectile starting position is (1.0, 1.0, -0.1) instead of just 1.75 in y</li> <li>The z angle of the projectile is -90.0 instead of -60.0</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#bandit","title":"<code>Bandit</code>","text":"<p>If there's no <code>projectiles</code>:</p> <ul> <li>entity.<code>animstate</code> is set to 100 (preparing to throw)</li> <li>FaceTowards is called on the entity to face the player</li> <li>0.5 seconds are yielded</li> <li>All frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code></li> <li>If <code>dizzytime</code> or <code>freezecooldown</code> aren't expired, this projectile logic ends early, but the coroutine still continues</li> <li>The <code>Spin3</code> sound is played on the entity</li> <li>FlipSpriteAngleAt is called on the entity towards the player with offset (0.0, 90.0, 0.0)</li> <li>A projectile gets added with this NPCControl as the parent:<ul> <li>sprite index 3 (a shuriken shaped object)</li> <li>starting position at this NPCControl position - its right vector + 1.0 in y</li> <li>target position being the player position undershot by 2.0 towards the direction of the player + 1.25 in y</li> <li>z spin of 20.0</li> <li>y angles of the entity.<code>sprite</code> angle and 90.0 in z, no x</li> <li>size of uniform 0.75</li> <li>No particles on destruction</li> <li>y midpoint of the bezier curve of 1.25</li> <li>time of 60.0 frames</li> <li>shadow size multiplier of 0.25</li> </ul> </li> <li>0.75 seconds are yielded</li> </ul> <p>No matter if there was projectiles or not, all frames are yielded as long as we are in a <code>pause</code>, <code>minipause</code>, <code>inevent</code> or we are in a <code>battle</code> that is <code>inevent</code> followed by an additional yield which ends this projectile.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#chomperbrute","title":"<code>ChomperBrute</code>","text":"<p>The same than <code>Bandit</code>, but with a few changes:</p> <ul> <li>Before the entity.<code>animstate</code> is set to 100 (which is opening their mouth), the <code>Clomp</code> sound is played on the entity</li> <li>After the first yields when in many kinds of pause, entity.<code>animstate</code> is set to 102 (biting) followed by a yield of 0.2 seconds</li> <li>Before the FlipSpriteAngleAt, the sound played on the entity is <code>PingShot</code> instead of <code>Toss</code></li> <li>The projectile sprite index is -38 (<code>ChomperSeed</code> item)</li> <li>The offset to apply to the projectile starting position is 0.2 in y instead of 0.1</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectile/#wildchomper","title":"<code>WildChomper</code>","text":"<p>The exact same logic than <code>ChomperBrute</code> (animstate 100 is preparing to shoot while animstate 102 is shooting).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectilePredict/","title":"ShootProjectilePredict","text":"<p>An alias of ShootProjectile.</p> <p>NOTE: This is unused under normal gameplay.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/ShootProjectilePredict/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/","title":"StealthAI","text":"<p>Gives the ability of the NPCControl to spot the player if it enters its field of vision (represented by 2 trigger colliders) which has the effect of triggering an event. The event id and the wideness of the field of vision are configurable as well as an option to set the entity.animstate to <code>Sleep</code> at the start of the DoBehavior cycle.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#frequency-meaning","title":"Frequency meaning","text":"<p>The same than SetPath, but with the addition that if it's 5555, the entity.animstate is set to <code>Sleep</code> at the start of the DoBehavior cycle (right after the <code>returntoheight</code> logic).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#additional-data","title":"Additional data","text":"<ul> <li><code>vectordata</code>: The same than SetPath</li> <li><code>battleids[0]</code>: An event id that will be started when the player is spotted</li> <li><code>battleids[1]</code>: A value that represents how wide the NPCControl's vision is. It's the z size of the trigger BoxCollider of the StealthCheck, a component attached to the entity.<code>detect</code> that can spot the player if it collides with it and its SphereCollider. It also influences the z center of the BoxCollider with the value being half of this one floored.</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#setup","title":"SetUp","text":"<ul> <li>entity.<code>detect</code> is ensured to be created which makes sure the entity has a wall detector</li> <li>A new StealthCheck component gets childed to the entity.<code>detect</code> with a local position of Vector3.zero and a <code>parent</code> field of this NPCControl. </li> <li>entity.<code>alwaysactive</code> is set to true</li> <li>entity.<code>extratimer</code> is set to true</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#dobehavior","title":"DoBehavior","text":"<p>The same than SetPath, but with the addition that if the frequency is 5555, the entity.animstate is set to <code>Sleep</code> at the start of the DoBehavior cycle (right after the <code>returntoheight</code> logic).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#update-inactive-every-3-frames","title":"Update (Inactive, every 3 frames)","text":"<p>Normally, when an entity is in a <code>forcemove</code>, StopForceMove is called on it, but this behavior is an exception to this where it will not be called here.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#update-common-end","title":"Update (Common, end)","text":"<p>As long as the behavior exist on the NPCControl, <code>actioncooldown</code> is set to 1.0 if the player is present and not <code>digging</code> while the message lock is active. This has the overall effect to have the underlying SetPath logic operate as if it has a frequency of 1.0 meaning 1.0 frames of cooldown between movement.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#lateupdate-refreshplayer","title":"LateUpdate (RefreshPlayer)","text":"<p>After the new <code>inrange</code> value is set and the new value is true a StealthSpot coroutine is called. There is an exception where this doesn't happen if this is an Enemy when the <code>freezecooldown</code> or <code>dizzytime</code> hasn't expired yet.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#ontriggerenter-if-this-is-an-npc","title":"OnTriggerEnter (If this is an NPC)","text":"<p>A StealthSpot coroutine starts if the other collider is the player.<code>beemerang</code> and the square distance between this NPCControl and the player is less than 30.0</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#oncollisionenter-if-this-is-an-npc","title":"OnCollisionEnter (If this is an NPC)","text":"<p>If the other gameObject tag is <code>Hornable</code> and the other's Hornable type is <code>IceCube</code> (meaning it's a Dropplet ice cube), ShatterDroppletIce is called on the other's Hornable <code>parent</code> (the <code>Dropplet</code> NPCControl). This basically shatters the cube whenever an NPCControl with this behavior present (<code>inrange</code> or not) collides with it.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#stealthspot","title":"StealthSpot","text":"<p>This is a public coroutine specific to this behavior (the only reason it's public is for StealthCheck to be able to start it). Its job is to verify that the NPCControl has indeed spotted the player and to process it if it has.</p> <p>A Linecast will be performed from this NPCControl position + Vector3.up to the player position + Vector3.up for only layers <code>Ground</code>, <code>NoDigGround</code> and <code>Player</code>.</p> <p>For the spotting to register, all of the following conditions must be true:</p> <ul> <li><code>startlife</code> is above 20.0</li> <li>The Linecast hit any <code>playerdata</code> entity</li> <li>The player is free (ignoring flying)</li> <li>The player isn't <code>digging</code></li> <li><code>battleids[0]</code> isn't negative</li> </ul> <p>If the above are met, StopForceMove is called on the entity followed by the event whose id is <code>battleids[0]</code> starting with this NPCControl as the caller.</p> <p>No matter if the spotting was processed or not, a frame is yielded.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/StealthAI/#stealthcheck","title":"StealthCheck","text":"<p>This is a component specifically involved with this behavior as it is attached to the entity.<code>detect</code> on SetUp. Its job is to be the way the NPCControl can spot the player with 2 trigger colliders.</p> <p>These colliders are added on the component's Start:</p> <ul> <li>A trigger SphereCollider with radius 1.5 and default position (meaning at the entity.<code>detect</code>'s position)</li> <li>A trigger BoxCollider with size (2.5, 2.0, NPCControl's <code>battleids[1]</code>) and center (0.0, 1.5, half of NPCControl's <code>battleids[1]</code> floored)</li> </ul> <p>The Start also puts the entity.<code>detect</code> GameObject in layer 2, the built in layer of Unity to ignore raycasts.</p> <p>From there, the only interesting logic this component has is an OnTriggerEnter where the method will call StealthSpot under the following conditions:</p> <ul> <li>The player must be present and free (flying counts as not free)</li> <li>If the other collider is the player.<code>beemerang</code>, it must be less than 30.0 away from the entity.<code>detect</code></li> <li>If it's the player, the internal cooldown of the component must be expired</li> </ul> <p>If the above is met, SteatlhStop is called which will verify that it is actually a spot. It also will set the internal cooldown to 3.0.</p> <p>What this cooldown does is it prevents the player collider from doing anything for a certain time in frames. This cooldown is decremented on LateUpdate if it hasn't expired yet. The overall effect is no player collider spotting can happen if StealthSpot was called up to 3 frames ago by this component.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/TurnFixedInterval/","title":"TurnFixedInterval","text":"<p>Stops any force move on the entity and periodically causes the entity.<code>flip</code> to toggle which turns the entity using a fixed time interval.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/TurnFixedInterval/#frequency-meaning","title":"Frequency meaning","text":"<p>The time interval between turns.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/TurnFixedInterval/#setinitialbehavior-only-if-its-the-default-behavior","title":"SetInitialBehavior (Only if it's the default behavior)","text":"<p>Sets the <code>actioncooldown</code> to the frequency.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/TurnFixedInterval/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p> <p>Then, this behavior only takes effect when the <code>actioncooldown</code> expired and if it hasn't yet, it is decreased by the game's frametime.</p> <p>When it does take effect, the entity.<code>flip</code> is toggled and the <code>actioncooldown</code> is set to the frequency.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/TurnRandomly/","title":"TurnRandomly","text":"<p>Stops any force move on the entity and periodically causes the entity.<code>flip</code> to toggle which turns the entity using a somewhat random time interval.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/TurnRandomly/#frequency-meaning","title":"Frequency meaning","text":"<p>The middle of the time interval range between turns. The time interval is random between half of the frequency value to the double of the frequency value.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/TurnRandomly/#setinitialbehavior-only-if-its-the-default-behavior","title":"SetInitialBehavior (Only if it's the default behavior)","text":"<p>Sets the <code>actioncooldown</code> to the frequency.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/TurnRandomly/#dobehavior","title":"DoBehavior","text":"<p>StopForceMove is called on the entity.</p> <p>This behavior only takes effect when the <code>actioncooldown</code> expires and if it hasn't yet, it is decreased by the game's frametime.</p> <p>When it does take effect, the entity.<code>flip</code> is toggled and the <code>actioncooldown</code> is set to a random value between half of the frequency and the double of the frequency.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Unmoveable/","title":"Unmoveable","text":"<p>Prevents an Enemy with this behavior (either default or <code>inrange</code>) to not move during the Dizzy process. This doesn't have any logic, its presence is what affects the NPCControl.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Unmoveable/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Unmoveable/#dobehavior","title":"DoBehavior","text":"<p>No logic occurs here.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Unmoveable/#explanation-of-the-behavior-and-how-it-affects-dizzy","title":"Explanation of the behavior and how it affects Dizzy","text":"<p>This behavior has no logic, but its presence (either the default or the <code>inrange</code> one) affects the Dizzy method.</p> <p>Normally, between the 2 yield return null (each being a frame yield), and after the second one, there's several logic there to essentially launch and move the dazed Enemy. This behavior prevents all this logic to occur with the exception of the HitPart particles which will still play. Besides this, no logic occurs between the 2 frame yields and none after the second one.</p> <p>The overall effect is while it allows the Enemy to be dizzy, it will not allow any movement when it happens.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WalkAwayFromPlayer/","title":"WalkAwayFromPlayer","text":"<p>This is an alias of FleeFromPlayer.</p> <p>NOTE: this is unused under normal gameplay.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WalkAwayFromPlayer/#frequency-meaning","title":"Frequency meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WalkAwayFromPlayer/#dobehavior","title":"DoBehavior","text":"<p>The same than FleeFromPlayer.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WalkWhenAnim/","title":"WalkWhenAnim","text":"<p>Perform Wander when the entity animstate is <code>Walk</code> (or <code>Idle</code> if the <code>behaviorcooldown</code> expired) or change it to the frequency when it's not with a <code>behaviorcooldown</code> of 20.0 frames (prevents another Wander cycle to process for 20.0 frames when entity.<code>animstate</code> is <code>Idle</code>).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WalkWhenAnim/#frequency-meaning","title":"Frequency meaning","text":"<p>An animstate to set the entity one when the current one is different and it's not <code>Walk</code> (or <code>Idle</code> when the <code>behaviorcooldown</code> expired).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WalkWhenAnim/#about-this-behavior-and-animation-events","title":"About this behavior and animation events","text":"<p>This behavior is intended to be used with an animstate as the frequency whose clip contains an animation event that sets the entity.<code>animstate</code> to <code>Walk</code> (or after, but only applicable when <code>behaviorcooldown</code> expires). This is because under normal circumstances, there is no logic to change the entity.<code>animstate</code> to these 2 that is offered by this behavior. It is intended to be used whenever the timing of the Wander needs to be carefully determined by the animation clip instead of immediately triggering when the behavior gets switched to.</p> <p>It can be used as the default behavior while ChaseWhenAnim is the <code>inrange</code> one. This allows <code>behaviorcooldown</code> to take effect and not change the entity.<code>animstate</code> too frequently.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WalkWhenAnim/#dobehavior","title":"DoBehavior","text":"<p>If the entity.<code>animstate</code> is <code>Walk</code> (or <code>Idle</code> if the <code>behaviorcooldown</code> expired), this acts as an alias to Wander.</p> <p>Otherwise, if the current entity.<code>animstate</code> isn't the frequency:</p> <ul> <li>The <code>behaviorcooldown</code> is set to 20.0 (prevents another Wander cycle to process for 20.0 frames when entity.<code>animstate</code> is <code>Idle</code>)</li> <li>StopForceMove is called on the entity</li> <li>The entity.<code>animstate</code> is set to frequency</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/","title":"Wander","text":"<p>Periodically performs a MoveTowards call after a random amount of time passed on the entity to a random position or the closest possible before unable to move further towards it. The range of movement, maximum time period to wait between wanders and the max distance to move to between wanders are all configurable.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/#frequency-meaning","title":"Frequency meaning","text":"<p>The maximum time in frames to wait before moving again. The minimum is always the 1/3 of the maximum.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/#additional-data","title":"Additional data","text":"<ul> <li><code>radiuslimit</code>: The max distance in which the entity is allowed to wander from its current position</li> <li><code>wanderradius</code>: The x/z radius from entity.<code>startpos</code> in which the entity can wander to</li> <li><code>teleportradius</code>: The max distance the entity can be away from its <code>startpos</code> before being teleported to its <code>startpos</code></li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/#setup-only-if-its-the-default-behavior","title":"SetUp (Only if it's the default behavior)","text":"<p>The <code>actioncooldown</code> is set to 120 frames.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/#dobehavior","title":"DoBehavior","text":"<p>The entity.<code>rigid</code> is unlocked with LockRigid(false) if it was in kinematic or it didn't had gravity.</p> <p>If <code>returntoheight</code> is true, entity.<code>height</code> is set to a lerp from the existing one to entity.<code>initialheight</code> with a factor of 0.1</p> <p>From there, there is an early exit path if the entity is in a <code>forcemove</code> and any of the following is true:</p> <ul> <li>entity.<code>hitwall</code> is true</li> <li>entity.<code>onground</code> is false</li> <li>entity.<code>detect</code> is present and HasGroundAhead from the entity.<code>forcetarget</code> returns false</li> </ul> <p>When the above is fufilled, StopForceMove is called with the <code>basestate</code> and this DoBehavior cycle is ended early. This is because the game concluded it is no longer possible to move further towards this position.</p> <p>If we are cleared to continue, there are 4 possible branches this DoBehavior can takes (only the first one that applies is taken checked in this order):</p> <ul> <li><code>actioncooldown</code> expired (the main wandering logic)</li> <li><code>maxtries</code> is exactly 10</li> <li>The distance between entity.<code>startpos</code> and this position is higher than the <code>teleportradius</code> or <code>maxtries</code> is 20 or above (meaning it went too far away or there's too much failed wander attempts)</li> <li>The entity is in a <code>forcemove</code></li> </ul> <p>If none of the branches above are taken, it means to wait before the next wander:</p> <ul> <li><code>walkcooldown</code> is set to 0.0</li> <li><code>trycount</code> is set to 0</li> <li><code>actioncooldown</code> is decremented by the game's frametime</li> <li>StopForceMove is called on the entity</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/#actioncooldown-expired-main-wandering-logic","title":"<code>actioncooldown</code> expired (main wandering logic)","text":"<p>This branch is essentially the main logic that manages the movement to the next point. It works by attempting to generate a random vector that satifies the <code>wanderradius</code> and <code>radiuslimit</code> constraints. The former dictates the range of where the entity can move and the latter dictates the maximum distance the next point can be.</p> <p>The attempted next vector is 1/3 of a random one between (-<code>wanderradius</code>, 0.5, -<code>wanderradius</code>) and (<code>wanderradius</code>, 0.5, <code>wanderradius</code>) which is then added to the entity.<code>startpos</code> as the <code>wanderradius</code> is relative to it. When generated, the entity.<code>moverotater</code> is set to look at it regardless if it's accepted or not.</p> <p>If the vector is less than <code>radiuslimit</code> away from the current position (meaning it's not too far to move to), then it is accepted which makes the following happen:</p> <ul> <li>MoveTowards is called on the entity to move to the vector at default everything with the exception that the y component is ignored</li> <li>The entity.<code>detect</code> is set to LookAt the vector</li> <li><code>actioncooldown</code> is set to be random between 1/3 of the frequency and the frequency itself</li> <li><code>maxtries</code> is set to 0</li> </ul> <p>If the vector is denied, this is where <code>trycount</code> comes into play as it is incremented here. </p> <p>The purpose of this field and <code>maxtries</code> is to regulate the timeout logic. If it reaches 50 or above, <code>actioncooldown</code> is set to be random between 1/3 of the frequency and the frequency itself once again, <code>trycount</code> is reset to 0 and <code>maxtries</code> is incremented. It's <code>maxtries</code> that can start to be more aggressive if it gets too high (this is outlined in 2 other branches).</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/#maxtries-is-exactly-10","title":"<code>maxtries</code> is exactly 10","text":"<p>MoveTowards is called on the entity to move to its <code>startpos</code> ignoring the y component with a 0.3 multiplier using the default entity.<code>walkstate</code> and entity.<code>basestate</code>. Finally, <code>maxtries</code> is set to 11. This times out the main logic such that if too much failed wander attempts happened, the entity moves back to its <code>startpos</code>.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/#too-far-or-too-much-failed-wander-attempts","title":"Too far or too much failed wander attempts","text":"<p>This is basically a warp to force the entity to teleport to its <code>startpos</code>:</p> <ul> <li>DeathSmoke particles are played at this position if the entity is <code>incamera</code></li> <li>The position is set to the entity.<code>startpos</code></li> <li>The entity.<code>rigid</code> velocity is zeroed out</li> <li>DeathSmoke particles are played at this position if the entity is <code>incamera</code> again</li> <li><code>maxtries</code> is set to 0</li> <li><code>actioncooldown</code> is set to 100.0</li> </ul>"},{"location":"Entities/NPCControl/ActionBehaviors/Wander/#the-entity-is-in-a-forcemove","title":"The entity is in a <code>forcemove</code>","text":"<p>StopForceMove is called on the entity if <code>walkcooldown</code> is higher than 60.0 and the entity.<code>rigid</code> x and z components have a magnitude less than half its <code>speed</code>. </p> <p>Whether or not this happens, <code>walkcooldown</code> is incremented by the game's frametime. This basically forces the entity to at least wander for 60 frames and to stop whenever the entity slows down its movement enough.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderNoWarp/","title":"WanderNoWarp","text":"<p>The same than Wander, but the warp branch logic is disabled. This means even if <code>maxtries</code> reaches 20 or that the distance between this position and the entity.<code>startpos</code> gets higher than <code>radiuslimit</code>, the entity will not warp and continue as normal.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderNoWarp/#frequency-meaning","title":"Frequency meaning","text":"<p>The same than Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderNoWarp/#additional-data","title":"Additional data","text":"<p>The same than Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderNoWarp/#setup-only-if-its-the-default-behavior","title":"SetUp (Only if it's the default behavior)","text":"<p>There is no logic here unlike Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderNoWarp/#dobehavior","title":"DoBehavior","text":"<p>The same than Wander, but the warp branch in the logic is disabled.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOffscreen/","title":"WanderOffscreen","text":"<p>The same than Wander, but movements are allowed when inactive or paused.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOffscreen/#frequency-meaning","title":"Frequency meaning","text":"<p>The same than Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOffscreen/#additional-data","title":"Additional data","text":"<p>The same than Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOffscreen/#setup-only-if-its-the-default-behavior","title":"SetUp (Only if it's the default behavior)","text":"<p>There is no logic here unlike Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOffscreen/#dobehavior","title":"DoBehavior","text":"<p>The same than Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOffscreen/#lateupdate-not-a-dummy-and-entity-is-incamera","title":"LateUpdate (Not a <code>dummy</code> and entity is <code>incamera</code>)","text":"<p>If this behavior exists (as default or <code>inrange</code>), <code>startlife</code> is less than 300.0 frames and the entity.<code>activeonpause</code> is false, the entity.<code>activeonpause</code> and entity.<code>alwaysactive</code> are set to true. This allows to have the Wander be in effect even during inactive updates.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOnWater/","title":"WanderOnWater","text":"<p>The same than WanderNoWarp, but the y position is adjusted according to the map.<code>waterfloat</code> if one exists.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOnWater/#frequency-meaning","title":"Frequency meaning","text":"<p>The same than Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOnWater/#additional-data","title":"Additional data","text":"<p>The same than Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOnWater/#setup-only-if-its-the-default-behavior","title":"SetUp (Only if it's the default behavior)","text":"<p>There is no logic here like WanderNoWarp, but unlike Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOnWater/#dobehavior","title":"DoBehavior","text":"<p>The same than WanderNoWarp.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderOnWater/#lateupdate-non-dummy-and-the-entity-is-incamera-but-not-iskill","title":"LateUpdate (Non <code>dummy</code>, and the entity is <code>incamera</code>, but not <code>iskill</code>)","text":"<p>If this behavior exists on the NPCControl (either default or <code>inrange</code>) and the map.<code>waterfloat</code> is present, the y component of the position and the entity.<code>starpos</code> are set to the map.<code>waterfloat</code> one clamped from the map.<code>waterfloat.minwaterfloat</code> - 0.5 to infinity. This forces the NPCControl to be positioned on the same level than the map.<code>waterfloat</code> object which is the object that defines where the water's surface is located.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderUnderground/","title":"WaterUnderground","text":"<p>The same than Wander, but the entity immediately starts digging underground before actually wandering.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderUnderground/#frequency-meaning","title":"Frequency meaning","text":"<p>The same than Wander.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderUnderground/#setup-only-if-its-the-default-behavior","title":"SetUp (Only if it's the default behavior)","text":"<p>There is no logic here unlike Wander meaning the NPCControl starts with an expired <code>actioncooldown</code> and will try to wander on the first admissible DoBehavior cycle.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderUnderground/#setinitialbehavior-only-if-its-the-default-behavior","title":"SetInitialBehavior (Only if it's the default behavior)","text":"<p>Calls InstantDig on the entity which immediately causes it to dig underground.</p>"},{"location":"Entities/NPCControl/ActionBehaviors/WanderUnderground/#dobehavior","title":"DoBehavior","text":"<p>The entity.<code>digging</code> is set to true while the <code>behaviorroutine</code> isn't in progress. It is set to false otherwise. This makes sure the NPCControl is <code>digging</code> even if behavior switches have happened unless there is <code>bheaviorroutine</code> in progress.</p> <p>After, the same logic than Wander follows.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/","title":"CaravanBadge","text":"<p>Similar than Shop, but for interacting with a shelved Caravan prize medal which only involve some parts of the shop system because it is handled entirely on its own with its own set of data.</p> <p>NOTE: This interaction will cause the entitytype to be overriden to SemiNPC which features the same logic than the ones used for the shop system.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: An entity id corresponding to the shop keeper the interaction will target when Interact is called</li> <li><code>data[1]</code>: The dialogue line id of the shop keeper (whose entity id is <code>data[0]</code>) to call SetText with when Interact is called</li> </ul>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#setup","title":"SetUp","text":"<p>The same than Shop, but CaravanMedalSet features extended logic.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#caravanmedalset","title":"CaravanMedalSet","text":"<p>The logic for this interaction changes as it doesn't follow the usual Shop system workflow:</p> <ul> <li><code>shopkeeper</code> is set to the entity resolved using <code>data[0]</code> as the entity id</li> <li>The array of the currently available prize medals at the caravan is obtained via PrizeBadges(true)</li> <li>If the array is empty, this object gets destroyed as there's no need to have it</li> <li>Otherwise:<ul> <li>The prize medals array is shuffled</li> <li>MainManager.<code>caravanorder</code> is set to the shuffled array</li> <li>entity.<code>item</code> is set to true making it an item entity</li> <li>entity.<code>animid</code> is set to 2 (medal)</li> <li>entity.<code>animstate</code> is set to the first element of the shuffled array (this is the first prize medal id of the array)</li> <li>entity.<code>itemstate</code> is set to entity.<code>animstate</code></li> <li>entitytype is set to SemiNPC which behaves the same than the ones used in the shop system</li> <li>If we are rerolling (which only happens if we are calling from a kill or rerollshops commands), DeathSmoke particles are played at this NPCControl position</li> <li>The first element of MainManager.<code>caravanorder</code> is removed</li> </ul> </li> <li>entity.<code>rigid</code> gets its gravity disabled with all constraints frozen</li> <li>The position is set to entity.<code>startpos</code></li> <li>entity.<code>ccol</code> is disabled</li> <li><code>descwindow</code> is destroyed if it existed</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#hashiddenitem","title":"HasHiddenItem","text":"<p>The same than Shop.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#interact","title":"Interact","text":"<ul> <li>If this is an <code>item</code> entity, the entity <code>animstate</code> is set to its <code>itemstate</code></li> <li>flagvar 0 is set to the entity <code>animstate</code></li> <li>flagvar 1 is set to the buying price of the medal whose id is the entity <code>animstate</code> unless flag 681 (MYSTERY? is active) which forces it to 35</li> <li>flagstring 0 to be the name of the medal whose id is the entity <code>animstate</code> unless flag 681 (MYSTERY? is active) which forces it to <code>menutext[59]</code> (?????)</li> <li>Call SetText in dialogue mode using <code>data[1]</code> as the dialogue line id for the input string (the shop keeper's caravan medal dialogue line) with the following:<ul> <li>fonttype of <code>BubblegumSans</code></li> <li><code>messagebreak</code> as the linebreak</li> <li>No tridimensional</li> <li>No position offset</li> <li>No camera offset</li> <li>size of Vector3.one</li> <li>The parent is the entity resolved using <code>data[0]</code> (the shop keeper map entity id) as the entity id</li> <li>This NPCControl as the caller</li> </ul> </li> <li>All <code>playerdata</code> entities have FaceTowards call on them to face the entity resolved using <code>data[0]</code>(the shop keeper map entity id) as the entity id</li> </ul>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#setbadgeshop","title":"SetBadgeShop","text":"<p>The logic changes drastically from Shop as the initialisation of the shelved item is delegated to CaravanMedalSet entirely which will be called instead of the logic of creating shelved items. If we are refreshing however, instance.<code>showmoney</code> is still set to 10.0 after which shows the berry count HUD element.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#lateupdate-every-3-frames-non-dummy-and-the-entity-is-incamera","title":"LateUpdate (Every 3 frames, non <code>dummy</code> and the entity is <code>incamera</code>)","text":"<p>The same than Shop, but this interaction always causes the instance.<code>showmoney</code> to be set to 1.0 before calling CreateDescWindow if we are calling it.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>The same than Shop.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#entitycontrolunfix","title":"EntityControl.Unfix","text":"<p>The same than Shop.</p>"},{"location":"Entities/NPCControl/Interaction/CaravanBadge/#settext","title":"SetText","text":"<p>This interactions affects SetText in several ways, but all of them are the same than Shop except fot kill which will cause SetBadgeShop with refresh to be called on the entity to kill (not its <code>shopkeeper</code>) if the caller has this interaction and the entity to kill's <code>animid</code> is 2 (meaning it's a medal as it's assumed that this is an <code>item</code> entity). Additionally, this interaction also causes this command to skip calling Death on the entity to kill.</p>"},{"location":"Entities/NPCControl/Interaction/Check/","title":"Check","text":"<p>An alias of Talk, but the emoticon the NPC gets is the blue ? one when it is in the <code>npc</code> list of the player.</p>"},{"location":"Entities/NPCControl/Interaction/Check/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/Check/#interact","title":"Interact","text":"<p>The same then Talk</p>"},{"location":"Entities/NPCControl/Interaction/Check/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>The same then Talk, but the entity.<code>emoticonid</code> is 1 (a blue ?) instead of 0.</p>"},{"location":"Entities/NPCControl/Interaction/Event/","title":"Event","text":"<p>Start the event whose id is <code>eventid</code> with this NPC as the caller.</p>"},{"location":"Entities/NPCControl/Interaction/Event/#additional-data","title":"Additional data","text":"<ul> <li><code>eventid</code>: The event id to start</li> </ul>"},{"location":"Entities/NPCControl/Interaction/Event/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/Event/#interact","title":"Interact","text":"<p>Start the event whose id is <code>eventid</code> with this NPC as the caller.</p>"},{"location":"Entities/NPCControl/Interaction/Event/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>entity.<code>emoticonid</code> gets set to 1 (a blue ?) and entity.<code>emoticoncooldown</code> gets set to 2.0 if all of the following conditions are met:</p> <ul> <li>We aren't in a <code>pause</code> or <code>minipause</code></li> <li>The message lock is released</li> <li>The player isn't <code>digging</code>, <code>flying</code>, <code>startdig</code> or in <code>shield</code></li> <li>This is the closest NPC in the <code>npc</code> list as of the last 3 frames</li> </ul>"},{"location":"Entities/NPCControl/Interaction/LockedDoor/","title":"LockedDoor","text":"<p>Start event 59 (Interacting with an object that requires a key item).</p>"},{"location":"Entities/NPCControl/Interaction/LockedDoor/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/LockedDoor/#interact","title":"Interact","text":"<p>Start event 59 with this as the caller.</p>"},{"location":"Entities/NPCControl/Interaction/LockedDoor/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>entity.<code>emoticonid</code> gets set to 1 (a blue ?) and entity.<code>emoticoncooldown</code> gets set to 2.0 if all of the following conditions are met:</p> <ul> <li>We aren't in a <code>pause</code> or <code>minipause</code></li> <li>The message lock is released</li> <li>The player isn't <code>digging</code>, <code>flying</code>, <code>startdig</code> or in <code>shield</code></li> <li>This is the closest NPC in the <code>npc</code> list as of the last 3 frames</li> </ul>"},{"location":"Entities/NPCControl/Interaction/QuestBoard/","title":"QuestBoard","text":"<p>The interaction for a quest board which allows to consult the 3 quest boards and take any open quests by having a dialogue with the caretaker of the quest board which is another NPCControl.</p>"},{"location":"Entities/NPCControl/Interaction/QuestBoard/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/QuestBoard/#data-meaning","title":"Data meaning","text":"<ul> <li><code>data[0]</code>: An entity id that corresponds to the caretaker of the quest board</li> <li><code>data[1]</code>: A dialogue line id of what the caretaker of the quest board will say when accepting to take a quest. The line must contain a prompt for the system to work because this line will get prepended with a questprompt when confirming the quest. Check the documentation of that command to learn more about how this all work</li> <li><code>data[2]</code>: If it's not negative, this is a flag slot that if it's false, Interact will be called on the <code>npcdata</code> of the map entity whose id is <code>data[0]</code>.</li> <li><code>vectordata[0]</code>: The camera position to move before showing the quest board UI, set to instance.<code>camoffset</code></li> <li><code>vectordata[1]</code>: The camera angles to move before showing the quest board UI, set to instance.<code>camangleoffset</code></li> <li><code>vectordata[2].x</code>: The camera speed to usd while moving the camera before showing the quest board UI, set to instance.<code>camspeed</code></li> <li><code>vectordata[2].y</code>: The time in seconds to let the camera move before showing the quest board UI</li> </ul>"},{"location":"Entities/NPCControl/Interaction/QuestBoard/#lateupdate-specialtattles","title":"LateUpdate (SpecialTattles)","text":"<p>The <code>tattleid</code> is set to -1 (\"L.\", this isn't supposed to be tattled as this text is an internal error message).</p>"},{"location":"Entities/NPCControl/Interaction/QuestBoard/#interact","title":"Interact","text":"<p>If <code>data[2]</code> isn't negative and its corresponding flag slot is false, Interact is called on the <code>npcdata</code> of the map entity whose id is <code>data[0]</code> without any arguments.</p> <p>Otherwise, an OpenQuestBoard coroutine is started with the map entity whose id is <code>data[0]</code> as the caretaker and this as the caller.</p>"},{"location":"Entities/NPCControl/Interaction/QuestBoard/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>entity.<code>emoticonid</code> gets set to 1 (a blue ?) and entity.<code>emoticoncooldown</code> gets set to 2.0 if all of the following conditions are met:</p> <ul> <li>We aren't in a <code>pause</code> or <code>minipause</code></li> <li>The message lock is released</li> <li>The player isn't <code>digging</code>, <code>flying</code>, <code>startdig</code> or in <code>shield</code></li> <li>This is the closest NPC in the <code>npc</code> list as of the last 3 frames</li> </ul>"},{"location":"Entities/NPCControl/Interaction/QuestBoard/#mainmanageropenquestboard","title":"MainManager.OpenQuestBoard","text":"<p>This is a public static coroutine that is exclusive to this interaction. It receives an EntityControl as the caretaker (the entity whose id is <code>data[0]</code>) and an NPCControl as the caller (which is this NPCControl).</p> <p>Its job is to setup the opening of the quest board UI and also setups the ItemList that shows the quests. Since this coroutine involves a lot of verbose rendering, its documentation is going to paraphrase a lot:</p> <ul> <li>All huds elements are hidden (including the berry count and discovery ones) by setting <code>discoveryhud</code>, <code>showmoney</code> and <code>hudcooldown</code> to 0.0</li> <li>The camera position is saved to the temporary files via SaveCameraPosition(true)</li> <li>flag 2 (unchecked new quests) is set to true</li> <li><code>option</code> is set to 0</li> <li><code>minipause</code> is set to true</li> <li>The <code>No Quests</code> BoardQuest is removed from the <code>boardquests</code></li> <li>A frame is yielded</li> <li>FaceTowards is called on the caretaker to face the player</li> <li>Every <code>playerdata</code> entity has FaceTowards called on them to face the caller</li> <li>instance.<code>boardcaller</code> is set to the caller</li> <li>instance.<code>camoffset</code> is set to the caller.<code>vectordata[0]</code></li> <li>instance.<code>camangleoffset</code> is set to the caller.<code>vectordata[1]</code></li> <li>instance.<code>camspeed</code> is set to the caller.<code>vectordata[2].x</code></li> <li>caller.<code>vectordata[2].y</code> seconds are yielded</li> <li>Every <code>playerdata</code> entity has FaceTowards called on them to face the caller</li> <li>FaceTowards is called on the caretaker to face the player</li> </ul> <p>From there, there is a lot of rendering logic that won't be detailed for brevity. The main things to keep in mind is the quest board root UI object is set to instance.<code>questboardobj</code> with the name <code>QuestBoard</code>. Every UI elements ends up being a descendant to it. This UI rendering involves SetText calls in non dialgue mode. The only thing worth mentioning about these calls is if the languageid is <code>Japanese</code>, it affects the presence or parameters of size commands and it doesn't offset the text of the tabs in x. If it's <code>Spanish</code>, the tab's text are offset by -0.75 in x. The tabs's text are offset by -0.05 in other languages.</p> <p>From there, <code>listammount</code> is set to 10 and ShowItemList is called with the open quests list type, a position of (-8.5, 2.55) with show description and without listsell.</p> <p>All in all, this adds some functionality in MainManager.Update where the player is also able to use the left and right inputs to change the listtype being shown from open quests -&gt; taken quests -&gt; completed quests. This support wrap around. This functionality is possible thanks to the presence of the <code>questboardobj</code>.</p> <p>Finally, UpdateQuestBoard is called and it will be called everytime the <code>listtype</code> changes.</p>"},{"location":"Entities/NPCControl/Interaction/QuestBoard/#mainmanagerupdatequestboard","title":"MainManager.UpdateQuestBoard","text":"<p>This is a private static method exclusive to this interaction. It is called by OpenQuestBoard and and also once everytime the player changes the board's listtype.</p> <p>All this really does is it manages the tabs's <code>sortingOrder</code> and whether or not the <code>Take Quest</code> UI element should be enabled (it only is on the open quests list type). The details on how this happens won't be documented for brevety.</p>"},{"location":"Entities/NPCControl/Interaction/SavePoint/","title":"SavePoint","text":"<p>The same than Talk, but the SetText input string is hardcoded. The string contains a prompt command where the confirm option leads to a line with a save command which will actually saves the game.</p>"},{"location":"Entities/NPCControl/Interaction/SavePoint/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/SavePoint/#setup","title":"SetUp","text":"<p>The SavePoint object is the only object where an interaction is possible and it is this interaction which is set to its <code>interacttype</code>. Check the <code>SavePoint</code> object documention to learn more about how it can triggers this interaction.</p>"},{"location":"Entities/NPCControl/Interaction/SavePoint/#interact","title":"Interact","text":"<p>Calls SetText in dialogue mode with the input string being <code>|</code>boxstyle<code>,4||</code>bleep<code>,2,1,1|</code> + <code>menutext[4]</code> (the save prompt text) + <code>|</code>prompt<code>,menu,0.7,2,7,78,5,6|</code>:</p> <ul> <li>The fonttype is <code>BubblegumSans</code></li> <li>The default <code>messagebreak</code> is used as the linebreak</li> <li>No tridimensional</li> <li>No render or camera offsets</li> <li>This transform as the parent (or the <code>shopkeeper</code> one if <code>args</code> is <code>buy</code>) and this NPCControl as the caller</li> </ul> <p>Once the call is started right after the first yield, all <code>playerdata</code> entities have FaceTowards called on them with the position being this position and with forceback.</p>"},{"location":"Entities/NPCControl/Interaction/SavePoint/#getdialogue","title":"GetDialogue","text":"<p>This method should never be called on an <code>NPC</code> with this interaction because doing so will cause the error message to appear with the exception of <code>overridediag</code> not being negative, but this never happens under normal gameplay because it relates to an unused feature.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/","title":"Shop","text":"<p>At loading time, this interaction is only for indicative purposes to build a shop system. At runtime after the shop system has been built, this is the interaction of a shelved item which is a <code>SemiNPC</code> item entity and the interaction calls SetText with the shop keeper's buying dialogue.</p> <p>NOTE: The Shop system is very complex. Check the shop system documentation to learn more about how this interaction is involved and how a shop structure works.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/#data-arrays","title":"Data arrays","text":"<p>See the shop system documentation.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/#setup","title":"SetUp","text":"<ul> <li>If this is an <code>NPC</code>, the <code>pusher</code>, GetDialogue call and SetInitialBehavior call does not happen.</li> </ul> <p>The rest of the logic is the standard initialisation procedure described in the shop system documentation.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/#hashiddenitem","title":"HasHiddenItem","text":"<p>Any <code>Object</code> with this interaction will always return false, but this never happens under normal gameplay.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/#interact","title":"Interact","text":"<p>If this is an <code>item</code> entity, the entity <code>animstate</code> is set to its <code>itemstate</code>.</p> <p>The flagvar 0 is set to the entity <code>animstate</code></p> <p>If the entity <code>animid</code> is 2 (it's a medal):</p> <ul> <li>flagvar 1 is set to the buying price of the medal whose id is the entity <code>animstate</code> unless flag 681 (MYSTERY? is active) which forces it to 35.</li> <li>flagstring 0 to be the name of the medal whose id is the entity <code>animstate</code> unless flag 681 (MYSTERY? is active) which forces it to <code>menutext[59]</code> (?????).</li> </ul> <p>Otherwise:</p> <ul> <li>flagvar 1 is set to the buying price of the item * <code>mmulti</code> then ceiled whose id is the entity <code>animstate</code> and type being its <code>animid</code>. <code>mmulti</code> was set during SetUp using a value from the shop entity data.</li> <li>flagstring 0 to be the name of the item whose id is the entity <code>animstate</code> and type being its <code>animid</code>.</li> </ul> <p>From there, the rest acts as if we interacted with the same logic than ShopKeeper with the <code>args</code> being <code>buy</code> which will call SetText in dialogue mode using <code>shopkeeper.dialogues[6].y</code> as the dialogue line id for the input string (the buying SetText line) with the following:</p> <ul> <li>fonttype of <code>BubblegumSans</code></li> <li><code>messagebreak</code> as the linebreak</li> <li>No tridimensional</li> <li>No position offset</li> <li>No camera offset</li> <li>size of Vector3.one</li> <li>The <code>shopkeeper</code> as the parent</li> <li>This NPCControl as the caller</li> </ul> <p>Finally, all <code>playerdata</code> entities have FaceTowards called on them to face the <code>shopkeeper</code> with force back.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/#lateupdate-every-3-frames-non-dummy-and-the-entity-is-incamera","title":"LateUpdate (Every 3 frames, non <code>dummy</code> and the entity is <code>incamera</code>)","text":"<p>This logic mainly determines if we should create or destroy the <code>descwindow</code>. It is created with CreateDescWindow(true) if all of the following are true:</p> <ul> <li>message is released</li> <li>We aren't in a <code>pause</code></li> <li>We are <code>inrange</code></li> <li>The first NPCControl (if it exists) in the interact list of the player is this one</li> <li><code>descwindow</code> is null</li> <li>The <code>insideid</code> matches the current one</li> </ul> <p>On top of this before the creation, if the <code>shopkeeper</code>'s <code>dialogues[1].y</code> is 1 (it's a medal shop), the <code>showmoney</code> is set to 1.0 and 0.0 otherwise (this shows and hides the berry count HUD element accordingly).</p> <p>If we didn't created the description window, it is destroyed via DestroyDescWindow if <code>descwindow</code> isn't null, message is released and at least one of the following is true:</p> <ul> <li>The <code>insideid</code> doesn't match the current one</li> <li>We are in a <code>pause</code></li> <li>There are no NPCControl in the player interact list or the first one is not this NPCControl</li> <li>instance.<code>itempicked</code> is true</li> </ul>"},{"location":"Entities/NPCControl/Interaction/Shop/#destroydescwindow","title":"DestroyDescWindow","text":"<p>This is a public method that will undo what CreateDescWindow did. It is heavily involved in this interaction, but destroydescwindow and additemtoss SetText commands may call it (check their documentations to learn more). It only does anything if the <code>descwindow</code> exists.</p> <ul> <li><code>descwindow</code>.shrink is set to true which will progressively shrink the window until it disappears</li> <li>The position of the <code>descwindow</code> is incremented by a 1/10 of the normalised direction of the camera</li> <li>The <code>descwindow</code> is destroyed in half a second</li> <li><code>descwindow</code> is set to null which ensures the game sees it as not existing</li> <li>If we were <code>inrange</code> with this interaction, <code>inrange</code> is set to false and the player.<code>npc</code> is reset to a new list</li> </ul>"},{"location":"Entities/NPCControl/Interaction/Shop/#getdialogue","title":"GetDialogue","text":"<p>This method should never be called on an NPCControl with this interaction because doing so will cause the error message to appear no matter the circumstances.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/#entitycontrolunfix","title":"EntityControl.Unfix","text":"<p>Any NPCControl with this interaction will block the unifixing unless force is true.</p>"},{"location":"Entities/NPCControl/Interaction/Shop/#settext","title":"SetText","text":"<p>This interactions affects SetText in several ways:</p> <ul> <li>shopline commands are only processed by OrganizeLines if the first NPCControl in the player.<code>npc</code> list has this interaction</li> <li>In dialogue setup, if the caller has this interaction while its <code>shopkeeper.dialogues[1].y</code> isn't 1 (the shop accepts regular berries as currency), the berry count HUD will be shown at the start of the call</li> <li>In dialogue setup, if the caller has this interaction while we aren't <code>inevent</code>, FaceTowards will be called on player.entity to face towards the caller.<code>shopkeeper</code> instead of the caller itself</li> <li>destroydescbox won't call DestroyDescWindow if the caller has this interaction unless the command is used in syntax (2)</li> <li>giveitem will not call CreateDescWindow if the caller has this interaction</li> <li>kill will cause SetBadgeShop with refresh to be called on the <code>shopkeeper</code> of the entity to kill if the caller has this interaction and the entity to kill's <code>animid</code> is 2 (meaning it's a medal as it's assumed that this is an <code>item</code> entity)</li> </ul>"},{"location":"Entities/NPCControl/Interaction/Shop/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>entity.<code>emoticonid</code> gets set to 1 (a blue ?) and entity.<code>emoticoncooldown</code> gets set to 2.0 if all of the following conditions are met:</p> <ul> <li>We aren't in a <code>pause</code> or <code>minipause</code></li> <li>The message lock is released</li> <li>The player isn't <code>digging</code>, <code>flying</code>, <code>startdig</code> or in <code>shield</code></li> <li>This is the closest NPC in the <code>npc</code> list as of the last 3 frames</li> </ul> <p>Additionally, if all of the above are met, the berry count HUD is shown if <code>shopkeeper.dialogues[1].y</code> isn't 1 (meaning this shop uses regular berry currency). It's hidden if it is 1 (meaning the shop uses Crystal Berries instead of berries).</p>"},{"location":"Entities/NPCControl/Interaction/ShopKeeper/","title":"ShopKeeper","text":"<p>Similar to talk, but with a shop keeper buying or selling dialogue line.</p> <p>NOTE: This interaction is heavily involved in the shop system which are complex. It is only assigned at loading time from a Shop interaction and it should never be set in map entities game data. Read the shop system documentation to learn more.</p>"},{"location":"Entities/NPCControl/Interaction/ShopKeeper/#mapcontrolcreateentities","title":"MapControl.CreateEntities","text":"<p>This interaction is heavily involved in the building of the shop structure. See the shop system documentation to learn more.</p>"},{"location":"Entities/NPCControl/Interaction/ShopKeeper/#args-meaning","title":"args meaning","text":"<ul> <li><code>buy</code>: The input string will be overriden to <code>dialogues[6].y</code> (the shop keeper's buying dialogue line id) and the parent becomes the <code>shopkeeper</code> transform. This only happens during the course of a Shop interaction, but not in this interaction.</li> </ul>"},{"location":"Entities/NPCControl/Interaction/ShopKeeper/#setup","title":"SetUp","text":"<p>If <code>dialogues[10].x</code> floored is 1 (this is a medal shop), SetBadgeShop(false) is called. For more information, check the shop system documentation</p>"},{"location":"Entities/NPCControl/Interaction/ShopKeeper/#interact","title":"Interact","text":"<p>The same as talk, but the input string of the SetText call is the one resolved from <code>dialogues[0].y</code> as the dialogue line id which is shop keeper's selling line (or <code>dialogues[6].y</code> which is the buying one if <code>args</code> is <code>buy</code>). </p> <p>Also if <code>args</code> is <code>buy</code>, the parent of the SetText call is the <code>shopkeeper</code> and the <code>playerdata</code> entities will face it instead of this position.</p>"},{"location":"Entities/NPCControl/Interaction/ShopKeeper/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>The same as Talk.</p>"},{"location":"Entities/NPCControl/Interaction/StorageAnt/","title":"StorageAnt","text":"<p>The same than Talk, but the SetText input string is hardcoded. It is the Ant Storage Service text unless flag 180 (received the Ant Storage Service tutorial) is false where it's the tutorial. This also sets flag 180 and 349 (using the Ant Storage Service, allows multiselect) to true.</p>"},{"location":"Entities/NPCControl/Interaction/StorageAnt/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/StorageAnt/#lateupdate-not-a-dummy-and-the-entity-is-incamera","title":"LateUpdate (Not a <code>dummy</code> and the entity is <code>incamera</code>)","text":"<p>If the message lock is released, we aren't <code>inevent</code> and it's not an item entity, the entity.animstate is set to entity.<code>basestate</code>.</p>"},{"location":"Entities/NPCControl/Interaction/StorageAnt/#interact","title":"Interact","text":"<p>The same than Talk, but with a few changes:</p> <ul> <li>flag slot 349 is set to true (using the storage service, allows multiselect)</li> <li>The text used to call SetText is <code>commondialogue[1]</code> (the Ant Storage Service text) unless flag 180 (received the Ant Storage Service tutorial) is false. If it is false, the text is <code>|</code>anim<code>,caller,Happy|</code> followed by <code>commondialogue[97]</code> (the Ant Storage Service tutorial).</li> <li>flag 180 (received the Ant Storage Service tutorial) is set to true. This ensures the tutorial isn't given again if it was.</li> </ul>"},{"location":"Entities/NPCControl/Interaction/StorageAnt/#mapcontrollateupdate","title":"MapControl.LateUpdate","text":"<p>There is no logic here unlike Talk.</p>"},{"location":"Entities/NPCControl/Interaction/StorageAnt/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>The same than Talk.</p>"},{"location":"Entities/NPCControl/Interaction/Talk/","title":"Talk","text":"<p>Calls SetText in Dialogue mode using the text from the return of GetDialogue. It also gives the NPC a chatting emoticon when the NPC is in the <code>npc</code> interact list of the player.</p>"},{"location":"Entities/NPCControl/Interaction/Talk/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/Talk/#interact","title":"Interact","text":"<p>Calls SetText in dialogue mode with the input string being the current one obtained with GetDialogue:</p> <ul> <li>The fonttype is <code>BubblegumSans</code></li> <li>The default <code>messagebreak</code> is used as the linebreak</li> <li>No tridimensional</li> <li>No render or camera offsets</li> <li>size is Vector3.one</li> <li>This transform as the parent and this NPCControl as the caller</li> </ul> <p>Once the call is started right after the first yield, all <code>playerdata</code> entities have FaceTowards called on them with the position being this position and with forceback.</p>"},{"location":"Entities/NPCControl/Interaction/Talk/#mapcontrollateupdate","title":"MapControl.LateUpdate","text":"<p>With the exception of the <code>Kabbu</code> animid and the <code>keepobjectsalive</code> being true on the map, all NPC gets their entity.<code>emoticon</code> disabled whenever their gameObject enablement needs to be changed (which it does if the x/z distance between the NPC and the player is less than double the <code>radius</code> or not).</p> <p>This behavior prevents this from happening meaning.</p> <p>TODO: Need to revisit this when MapControl docs is done</p>"},{"location":"Entities/NPCControl/Interaction/Talk/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>entity.<code>emoticonid</code> gets set to 0 (the chatting icon) and entity.<code>emoticoncooldown</code> gets set to 2.0 if all of the following conditions are met:</p> <ul> <li>We aren't in a <code>pause</code> or <code>minipause</code></li> <li>The message lock is released</li> <li>The player isn't <code>digging</code>, <code>flying</code>, <code>startdig</code> or in <code>shield</code></li> <li>This is the closest NPC in the <code>npc</code> list as of the last 3 frames</li> </ul>"},{"location":"Entities/NPCControl/Interaction/TalkReturnToOriginalFlip/","title":"TalkReturnToOriginalFlip","text":"<p>An alias of Talk, but only the Interact logic remains.</p> <p>NOTE: This interaction is unused under normal gameplay. While it features unique logic to it (in this case, the lack of), it is likely left unused due to not being functional in practice.</p>"},{"location":"Entities/NPCControl/Interaction/TalkReturnToOriginalFlip/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/TalkReturnToOriginalFlip/#interact","title":"Interact","text":"<p>The same then Talk.</p>"},{"location":"Entities/NPCControl/Interaction/TalkReturnToOriginalFlip/#mapcontrollateupdate","title":"MapControl.LateUpdate","text":"<p>There is no logic here unlike Talk.</p>"},{"location":"Entities/NPCControl/Interaction/TalkReturnToOriginalFlip/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>There is no logic here unlike Talk.</p>"},{"location":"Entities/NPCControl/Interaction/VenusHeal/","title":"VenusHeal","text":"<p>The same than Talk, but the SetText input string is hardcoded to <code>commondialogue[60]</code> (the Venus bud healing text).</p>"},{"location":"Entities/NPCControl/Interaction/VenusHeal/#args-meaning","title":"args meaning","text":"<p>None.</p>"},{"location":"Entities/NPCControl/Interaction/VenusHeal/#lateupdate-specialtattles","title":"LateUpdate (SpecialTattles)","text":"<p>The <code>tattleid</code> is set to -117 (Venus tattle line).</p>"},{"location":"Entities/NPCControl/Interaction/VenusHeal/#interact","title":"Interact","text":"<p>The same than Talk, but the SetText input string is hardcoded to <code>commondialogue[60]</code> (the Venus bud healing text).</p>"},{"location":"Entities/NPCControl/Interaction/VenusHeal/#mapcontrollateupdate","title":"MapControl.LateUpdate","text":"<p>There is no logic here unlike Talk.</p>"},{"location":"Entities/NPCControl/Interaction/VenusHeal/#playercontrollateupdate","title":"PlayerControl.LateUpdate","text":"<p>The same than Talk.</p>"},{"location":"Entities/NPCControl/Notable%20methods/AddPusher/","title":"AddPusher","text":"<p>This initialises <code>pusher</code> which is a trigger capsule collider that's twice as narrow as the entity's <code>ccol</code>, but also twice as long vertically with a tag of <code>Pusher</code>. This is primarily used to push the PlayerControl away should it collide with it and helps mitigate the possibility to remain on top of the NPC. It should be noted however that even were it not for it, it is hard to remain on top because of the uneven surfaces of the capsule's top and bottom.</p>"},{"location":"Entities/NPCControl/Notable%20methods/CheckEmoteFlag/","title":"CheckEmoteFlag","text":"<p>This is a private method only used in LateUpdate. It is called only under the following conditions:</p> <ul> <li>This isn't s <code>dummy</code></li> <li>The entity is <code>incamera</code></li> <li>Every 3 frames</li> <li>We aren't <code>inevent</code></li> <li>We aren't in a <code>minipause</code></li> <li>The entity isn't <code>dead</code> or <code>iskill</code> and <code>deathcoroutine</code> isn't in prgress</li> <li>The player <code>canpause</code></li> <li>This NPCControl is an NPC</li> <li>The player npc list is empty or the first element isn't this NPCControl</li> </ul> <p>The method does nothing if <code>alwaysemoticon</code> is false and at least one of the following is true:</p> <ul> <li>The y distance between this NPCControl and the player is 2.0 or above</li> <li>The z distance between this NPCControl and the player is 15.0 or above</li> </ul> <p>If we are doing something, we try to find the first <code>emoticonflag</code> that is applicable.</p> <p>The way it works is NPCControl has a general purpose Vector2 array field called <code>emoticonflag</code> which contains for each element data an emoticon id and a flag slot required to have it applied. The flag slot checks are performed in reverse order from the list, but one is always picked meaning the first one in the array serves as a falback. Here is how the components are defined (NOTE: despite all components being float, each gets cast to int for this which truncates the fractional part):</p> <ul> <li>x: A required flag slot to be true in order for the line to be set as the current one. This is always violated if it's negative.</li> <li>y: The emoticon id related to this element</li> </ul> <p>When the method finds the first element whose x's condition is satisfied in reverse order (or the first one if it got to it), it sets the entity <code>emoticonid</code> to the y component and <code>emoticoncooldown</code> to 5.0.</p>"},{"location":"Entities/NPCControl/Notable%20methods/CreateDescWindow/","title":"CreateDescWindow","text":"<p>This is a public method that initialises <code>descwindow</code>. It is called both by the Shop interaction and the Item object during CheckItem. It receives a bool that is false during CheckItem and true during the shop interaction.</p> <ul> <li>instance.<code>discoveryhub</code> is set to 0.0 which hides the discovery HUD element</li> <li>If this is an item entity (which should always be the case), entity.<code>animstate</code> is set to entity.<code>itemstate</code></li> <li><code>deswindow</code> is set to the DialogueAnim of a new white 9Box using <code>Sprites/GUI/9Box/box0</code> of position (-3.5.0, -3.9.0, 10.0) with size (11.0, 3.0) with sortingOrder of -3 and with growing</li> <li>If it was called from CheckItem, instance.<code>showmoney</code> is set to 0.0 which hides the berry count HUD element followed by the <code>descwindow</code> local position being set to (0.0, the existing y local position - 0.5, the existing z local position)</li> <li>If the <code>shopkeeper</code> exists and its <code>dialgues[1].y</code> is 1 (the shop accepts Crystal Berries instead of regular berries):<ul> <li>A new SpriteRenderer UI object named <code>CBerryBar</code> is created childed to the <code>descwindow</code> of color cyan with position (10.65, -0.45, 0.0) with size (0.55, 0.6, 1.0) with <code>guisprites[4]</code> (the HUD element background) and a sortingOrder of 0</li> <li>SetText is called using <code>|sort,10||color,4||single||dropshadow,0.75,-0.75|</code> followed by flagvar 14 padded by 3 <code>0</code> as the input string in non dialogue mode with the following:<ul> <li>fonttype of 2 (gets overriden to <code>D3Streetism</code> as 2 is UNUSED)</li> <li>No linebreak</li> <li>No tridimensional</li> <li>Position offset of (-0.65, -0.5, 0.0)</li> <li>No camera offset</li> <li>size of 1.75 uniform</li> <li>Parent is the SpriteRenderer created earlier</li> <li>No caller</li> </ul> </li> <li>A new UI object called <code>BerryIcon</code> is created using the sprite of the Crystal Berry icon childed to the <code>descwindow</code> with a position of (9.45, -0.45, 0.0) with a size of Vector3.one and a sortingOrder of 1</li> </ul> </li> <li>If entity.<code>animid</code> is 2 (it's a medal), flagvar 10 is set to the price of the medal (entity.<code>animstate</code> used as the id, berries or Crystal Berries depending on <code>shopkeeper.dialogues[1].y</code> being 1 or not), but it's overriden to 35 berries (or 4 Crystal Berries unless flagvar 66 (amount of medals bought at shades) is less than 2 where it's 3 Crystal Berries) if the <code>shopkeeper</code>  exists and flag 681 is true (MYSTERY? is active)</li> <li>Otherwise, flagvar 10 is set to the buying price of the item * <code>mmulti</code> (the price multiplier loaded from the shop keeper entity data) all ceiled</li> <li>From there, a SetText string is constructed with the following appended together in order:<ul> <li><code>|single||singlebreak,</code> followed by <code>itemdescbreak</code> followed by <code>|</code></li> <li>If entity.<code>animid</code> is 2 (it's a medal) and the call came from the Shop interaction, the name of the medal is appended (overriden to <code>menutext[59]</code> or <code>?????</code> if MYSTERY? is active) followed by <code></code> followed by a <code>-</code> (or a <code>\u2014</code> if the languageid is <code>German</code>) followed by <code></code> followed by <code>menutext[49]</code> (<code>Worth |currency,var,10|</code>) if <code>shopkeeper.dialogues[1].y</code> isn't 1 (the shop accepts regular berries) and if it's 1, it's followed by <code>flagvar</code> 10 followed by a space followed by <code>menutext[169]</code> (Crystal Berries, it's <code>menutext[112]</code> if <code>flagvar</code> 10 is 1 for the singular form) followed by <code>|line|</code></li> <li>If entity.<code>animid</code> is 2 (it's a medal), the description of the medal is appened (entity.<code>animstate</code> is used as the medal id), but it's overriden to <code>menutext[59]</code> (<code>?????</code>) if the <code>shopkeeper</code> exists and MYSTERY? is active</li> <li>If entity.<code>animid</code> isn't 2 (it's not a medal) and the call came from the Shop interaction, the name of the item is appended (entity.<code>animstate</code> is used as the item id) followed by <code></code> followed by <code></code> followed by a <code>-</code> (or a <code>\u2014</code> if the languageid is <code>German</code>) followed by <code></code> followed by <code>menutext[49]</code> (<code>Worth |currency,var,10|</code>) followed by <code>|line|</code></li> <li>If entity.<code>animid</code> isn't 2 (it's not a medal), the description of the item is appended (entity.<code>animstate</code> is used as the item id)</li> </ul> </li> <li>A SetText call occurs in non dialogue mode with the string generated above with these properties:<ul> <li>fonttype of <code>BubblegumSans</code></li> <li>No linebreak</li> <li>No tridimensional</li> <li>Position offset of (-5.2, 0.65, 0.0)</li> <li>No camera offset</li> <li>size of 0.675 uniform</li> <li>Parent is the <code>descwindow</code></li> <li>No caller</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/Notable%20methods/Dizzy/","title":"Dizzy","text":"<p>Dizzy is a coroutine that performs the procedure done whenever an Enemy gets stunned in the overworld. It receives the amount of frames to stun it (set to <code>dizzytime</code>), a push force Vector3 (only the x and z components are considered) and whether or not we want to induce a vertical launch upward.</p> <p>A yield break is performed immediately if the entity is <code>dead</code>, <code>iskill</code> or it has a <code>deathcoroutine</code> in progress.</p> <p>First, LockRigid(false) is called on the entity which unlocks its <code>rigid</code>. </p> <p>The <code>disguiseobj</code> is disabled if it exists with the entity.<code>sprite</code> getting enabled.</p> <p>From there, there's a special case if the entity's <code>originalid</code> is the <code>ToeBiter</code> animid where if the <code>internaltransform[0]</code> is present (the boulder he throws), it needs to be setup for its destruction. This is first done by adding a RigidBody to it, make it go in a random direction of 3.0 magnitude at a height of 12.0 and destroying it in 3.0 seconds. The entire <code>internaltransform</code> array is then set to null.</p> <p>From there, a couple of adjustements happens:</p> <ul> <li>The <code>touchcooldown</code> is set to 30.0 frames</li> <li>The <code>dizzytime</code> is to the sent time parameter</li> <li>The entity.<code>sprite</code> has its angles reset to Vector3.zero</li> <li>The entity.<code>onground</code> is set to false</li> <li>STOP is called which does the following:<ul> <li>Stop <code>behaviorroutine</code> if it was in progress and set it to null</li> <li>Set <code>forcebehavior</code> to null and call StopForceBehavior</li> <li>Call StopForceMove on the entity</li> <li>Set the entity.<code>overrideflip</code> and entity.<code>overrideonlyflip</code> to false</li> <li>Set <code>attacking</code> to false</li> </ul> </li> </ul> <p>After, a frame is yielded.</p> <p>If the enemy has an Unmoveable behavior, it cuts off most of the rest of the coroutine only limiting itself to play the <code>hitpart</code> particle at the <code>sprite</code> position + (0.0, 0.5, 0.0) and yielding for a frame.</p>"},{"location":"Entities/NPCControl/Notable%20methods/Dizzy/#not-unmovable","title":"Not Unmovable","text":"<p>If it doesn't have this behavior however, the rest of the logic is performed:</p> <ul> <li>Set <code>ignoreconstraint</code> to true</li> <li>Enable gravity on the entity.<code>rigid</code> without kinematic</li> <li>If the entity didn't had a <code>detect</code>, CreateDetector is called to create it</li> <li>The entity.<code>detect</code> is set to look at the player and its y angle is multiplied by -1</li> <li>The entity.<code>hitwal</code> is set to false</li> <li>All rotation on the entity.<code>rigid</code> are frozen</li> <li>The actual pushforce vector is comnputed from the the x and z components of the one sent in, but the y one is 0.0 unless we asked for a vertical launch which means the y is 13.5 instead</li> <li>The entity.<code>rigid</code> velocity is set to the push force computed above</li> <li>If the magnitude of that push force vector is above 0.1, TempIgnoreColision is called on the entity ignoring all collisions between the entity.<code>ccol</code> and entity.<code>detect</code> with the player's corresponding colliders for 0.5 seconds</li> </ul> <p>After, the <code>hitpart</code> particle is played at the entity.<code>sprite</code> position + (0.0, 0.5, 0.0) and a frame is yield.</p> <p>Finally, if the entity.<code>rigid</code> y velocity is less than 5.0, Jump is called on the entity with a velocity of 13.5 for every frame as until the entity.<code>rigid</code> y velocity reaches 5.0 or above.</p>"},{"location":"Entities/NPCControl/Notable%20methods/DoBehaviour/","title":"DoBehaviour","text":"<p>This is a method that takes in an ActionBehaviors (as ref which allows to override it) and the corresponding frequency which despite its name serve as a general float argument. It is only called as part of the Update event and it is responsible for setting up and executing the applicable behavior.</p>"},{"location":"Entities/NPCControl/Notable%20methods/DoBehaviour/#before-behavior-execution","title":"Before behavior execution","text":"<p>Some disguise behavior specific logic occurs here. See Disguise section for more information.</p>"},{"location":"Entities/NPCControl/Notable%20methods/DoBehaviour/#behavior-execution","title":"Behavior execution","text":"<p>From there, the appropriate ActionBehavior occurs, check the logic of them to learn more.</p>"},{"location":"Entities/NPCControl/Notable%20methods/DoBehaviour/#after-behavior-execution","title":"After behavior execution","text":"<p>After the behavior logic, entity.<code>ccol</code> center is set to (0.0, entity.<code>ccol</code> height / 2.0, 0.0).</p> <p>If the entity has a defined animid, it isn't an item entity and it's not a <code>fixedentity</code>, the entity.<code>rigid</code> rotation gets frozen and on top of this, if it had zero velocity, all movement except the y ones are frozen too.</p>"},{"location":"Entities/NPCControl/Notable%20methods/GetDialogue/","title":"GetDialogue","text":"<p>This method not only returns the SetText line the NPC has at the current moment, it also configures some fields that this line needs.</p>"},{"location":"Entities/NPCControl/Notable%20methods/GetDialogue/#normal-process","title":"Normal process","text":"<p>The way it works is NPCControl has a general purpose Vector3 field called <code>dialogues</code> which contains for each element data about a SetText line assigned to the entity. The order of the elements is important: the method will search for the first suitable one to set as current in reverse order (from last to first).</p> <p>Here is how the components of an element are defined (NOTE: despite all components being float, each gets cast to int for this which truncates the fractional part):</p> <ul> <li>x: A required flag slot to be true in order for the line to be set as the current one. If it's &lt;= -1, it means no flag is required and the line will be set as the current one when encountered. If the condition is violated, the method will ignore this element and check the next one.</li> <li>y: The dialogue line id related to this element. Because it uses the same scheme SetText commands uses, it supports both map specific line id or common dialogue line id.</li> <li>z: The <code>basestate</code> and <code>animstate</code> to set the entity when this line is set as the current one. The <code>basestate</code> is the default animstate the entity has instead of the default which is <code>Idle</code> or 0. This allows to force the entity into a different animation when the line is selected as current.</li> </ul> <p>When the method finds the first element whose x's condition is satisfied in reverse order, it sets <code>currentdialogueindex</code> to the element's index, the entity's <code>basestate</code> to the z component and it returns the actual SetText line corresponding to the y component.</p>"},{"location":"Entities/NPCControl/Notable%20methods/GetDialogue/#override-dialogue-feature","title":"Override dialogue feature","text":"<p>There is however an exception to this: it's possible to override this logic by setting <code>overridediag</code> to a non negative value which will be used as the dialogue line id instead. This feature is never used under normal gameplay and this field's default value remains -1. It should be noted that this feature specifically supports the incomplete global commands system and it supports SavePoint interactions unlike the normal process.</p>"},{"location":"Entities/NPCControl/Notable%20methods/GetDialogue/#error-handling-and-exceptional-cases","title":"Error handling and exceptional cases","text":"<p>If the <code>interacttype</code> is Shop or SavePoint or none of the elements in <code>dialogues</code> field is suitable to set as current, no fields are touched and the return value is hardcoded to <code>|</code>color<code>,1|Invalid message.</code>. This should never happen under normal gameplay because this is supposed to be a debug message that isn't supposed to be seen if every entities are correctly configured. This is only for diagnosis purposes.</p>"},{"location":"Entities/NPCControl/Notable%20methods/GravityFix/","title":"GravityFix","text":"<p>This coroutine was made to workaround an issue where enemies could fall under the map. It messes with the entity.<code>rigid</code> and its position several times in rather intrusive ways. It always gets started at the end of Start unless the <code>NGF</code> Modifier is enabled.</p> <p>Here are the steps performed in order:</p> <ul> <li>A frame is yeilded</li> <li>The entity.<code>rigid</code>'s useGravity and isKinematic are saved temporarilly</li> <li>A raycast from the current position + Vector3.up is done downwards of any layer of Ground and NoDigGround. If hit with a transform, this enemy's absolute y position is set to the y of that hit point</li> <li>The current position is saved into a temporary variable</li> <li>For a minimum of 1 second, the following is done every frame so long as <code>minipause</code> is true or that <code>hasenteredrange</code> is false:<ul> <li>The entity.<code>rigid</code> gravity is disabled and placed in kinematic mode without velocity</li> <li>This enemies's position is set to the variable saved earlier</li> </ul> </li> <li>For an additional 5 frames, the following is performed each frame:<ul> <li>The position is again set to the variable saved earlier</li> <li>LatePos is called on this transform with the variable saved earlier using a 0.02 delay only trying once</li> <li>The entity.<code>rigid</code> velocity is zeroed out</li> </ul> </li> <li>Finally, the original values of the entity.<code>rigid</code>'s useGravity and useKinematic are restored</li> </ul>"},{"location":"Entities/NPCControl/Notable%20methods/HasHiddenItem/","title":"HasHiddenItem","text":"<p>This method tells if the NPCControl pertains to an item that is discoverable by the Detector Medal. It only returns true if all of the following are true (it returns false otherwise):</p> <ul> <li>The <code>entitytype</code> is Object</li> <li>The player has the Detector equipped</li> <li>The <code>interacttype</code> isn't CaravanBadge or Shop</li> <li>The <code>NDTCT</code> Modifier isn't enabled</li> <li>Either the <code>DDIST</code> Modifier isn't enabled or it is, but the player's z position is less than 20.0 away from this transform z position</li> <li>The <code>objecttype</code> must belong to a specific set on top of an additional condition for the method to return true. Consult each's documentation to learn more:<ul> <li>BeetleGrass</li> <li>DigSpot</li> <li>Item</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/Notable%20methods/Interact/","title":"Interact","text":"<p>This public method is one of the few that is fully intended to be called externally. It allows to have an NPCControl perform an interaction and most of its logic is defined by its <code>interacttype</code> which is of type Interaction. More commonly, this is used by PlayerControl whenever the player interacts with the NPCControl, but it can be called externally to simulate the same effects then the interaction.</p> <p>The method takes a string argument named <code>args</code>, but only a few <code>Interaction</code> uses it.</p> <p>There is some common logic that precedes any <code>Interaction</code> specific logic and it goes as follows:</p> <ul> <li>StopForceMove is called on the entity</li> <li>StopMoving is called on the player entity</li> <li>CancelAction is called on the player</li> </ul> <p>After, the logic is specific to each <code>Interaction</code>. Consult each's documentation to learn more.</p>"},{"location":"Entities/NPCControl/Notable%20methods/RespawnEnemy/","title":"RespawnEnemy","text":"<p>This is a helper method to respawn an Enemy at a certain position. It takes in the NPCControl and the Vector3 position. The position will get incremented by Vector3.up * 0.5.</p> <ul> <li>entity.<code>destroytype</code> is set to <code>SpinSmoke</code></li> <li><code>attacking</code> is set to false</li> <li><code>behaviorroutine</code> is stopped and set to null</li> <li>All coroutines on the entity are stopped with entity.<code>deathcoroutine</code> set to null</li> <li>entity.<code>dead</code> and entity.<code>iskill</code> are set to false</li> <li>entity.<code>spin</code> is zeroed out</li> <li>entity.<code>rigid</code> gravity is enabled without kinematic and with the velocity zeroed out</li> <li>entity.<code>sprite</code> is enabled and its angles set to zero</li> <li>entity.animstate is set to the <code>basestate</code></li> <li>entity.<code>overrideanim</code> is set to false</li> <li>entity.<code>onground</code> is set to false</li> <li>entity.<code>bobspeed</code> and entity.<code>bobrange</code> are reset to their start fields counterparts</li> <li>entity.<code>lastpos</code> is set to the position passed as parameter</li> <li>entity.<code>pausepos</code> is set to null unless we are <code>paused</code> in which case, it is also set to the passed position</li> <li>StopForceMove is called</li> <li><code>dizzytime</code> is set to 0.0</li> <li><code>respawntimer</code> is set to -100.0</li> <li><code>freezecooldown</code> is set to 0.0</li> <li>Some SetPath exclusive logic occurs here</li> <li>entity.<code>ccol</code> is enabled in without trigger</li> <li><code>hit</code> is set to false</li> <li>The position and the entity's <code>startpos</code> are set to the passed parameter</li> <li>Some logic happens if the default behavior is a disguise one</li> <li>LockRigid(false) is called on the entity which unlocks its <code>rigid</code></li> <li>The <code>pusher</code> is enabled if it exist. NOTE: normally, enemies do not have one</li> <li>DeathSmoke is called on the entity.<code>sprite</code>'s position</li> </ul>"},{"location":"Entities/NPCControl/Notable%20methods/SetInitialBehavior/","title":"SetInitialBehavior","text":"<p>This method first applies a special case where for any <code>BeeGuard</code> AnimId, it overrides the <code>tattleid</code> to -97 (common dialogue line id 96) if it had -1 already.</p> <p>Some specific logic are performoned depending on the default ActionBehavior, check their documentation to learn more.</p>"},{"location":"Entities/NPCControl/Notable%20methods/StartBattle/","title":"NPCControl.StartBattle","text":"<p>This is a void and parameterless method in NPCControl (not to be confused with the coroutine in BattleControl) that aims to handle when a player engages with an Enemy which happens for example when getting too close to it. </p> <p>The name is a bit missleading here: while it does take part in the start of an actual battle, it is not the method that starts it. That would be the coroutine of the same name in BattleControl which this does start one if all conditions are met. This method doesn't just setup the start of the battle, it also performas any logic needed the moment an enemy is engaged which may include not doing anything or even do something else instead of starting a battle.</p>"},{"location":"Entities/NPCControl/Notable%20methods/StartBattle/#bubble-shield-logic","title":"Bubble Shield logic","text":"<p>If the player's <code>shield</code> is on and the entity's <code>originalid</code> isn't the <code>DeadLanderC</code> animid (it cannot be stunned using Bubble Shield) then this logic applies. It will only do anything if the <code>touchcooldown</code> expired, otherwise, nothing happens.</p> <p>If the <code>ShieldHit</code> audio clip isn't playing on any of the <code>sounds</code> audio sources, it is played on the first free one with 75% volume and a random pitch between 0.95 and 1.05. This is followed by a Dizzy call for 100.0 frames with a pushforce being the direction vector from this enemy to the player * 5.0 without vertical launch.</p>"},{"location":"Entities/NPCControl/Notable%20methods/StartBattle/#main-logic","title":"Main logic","text":"<p>This section happens only if the Bubble Shield one didn't.</p> <p>2 special early exits cases are handled:</p> <ul> <li>If we are already in a <code>battle</code> or we are in a <code>minipause</code>, this causes this method to return early</li> <li>If <code>entitytouchevent</code> is 0 or above, the event whose id is this field is started before returning early. This is essentially a global feature of the game that allows to override most engagement with an enemy to be an event start instead of a potential battle.</li> </ul> <p>If we haven't returned from this, the entity.<code>lastpost</code> is set to this enemy position and the entity.<code>rigid</code> velocity is zeroed out.</p> <p>From there, 2 other early returns special cases are checked:</p> <ul> <li>If the <code>icooldown</code> of the player.entity hasn't expired yet or the enemy's <code>freezecooldown</code> hasn't expired yet or its entity is <code>dead</code> or its <code>touchcooldown</code> hasn't expired yet, this method will return early.</li> <li>If the the Bug Me Not! medal applies, the entity is put in kinematic mode without velocity and a Death(true) coroutine is started on it. The logic to determine if the medal applies is as follows:<ul> <li>The played must have it equipped or it will not apply</li> <li>If the flag slot 555 (post game) is true, the <code>partylevel</code> is exactly 27 and the current map isn't <code>GiantLairDeadLands1</code> or <code>GiantLairDeadLands2</code>, then it applies no matter what (NOTE: it implies the medal never works on these 2 maps because the case below excludes the area that includes them too)</li> <li>Otherwise, it will only apply if the area isn't Giant's Lair, the map isn't <code>BugariaPlazaAttack</code>, <code>BugariaBridgeAttack</code> or <code>BugariaCastleAttack</code> and either the <code>partylevel</code> is exactly 27 or the ExpEstimate of this encounter is equal or less than the amount of enemies in this encounter</li> </ul> </li> </ul> <p>If we still haven't returned, then a battle will occur and the rest is just to setup the StartBattle call.</p> <p>All EntityControl will have their <code>lastpos</code> set to their current positions. Then, CancelAction is called on the player and the enemy's entity.<code>spin</code> is zeroed out. <code>attacking</code> is set to false and finally, StopForceBehavior is called.</p> <p>The last step is the actual StartBattle call:</p> <ul> <li>The enemies list is <code>battleids</code></li> <li>Automatically determine the battle map</li> <li>No specific advantage except if <code>attacking</code> was true when this was called and the <code>dizzytime</code> expired while the player doesn't have the Crazy Prepared medal equipped. In that case, it will be set to 3 with the <code>Damage0</code> sound playing</li> <li>The music is automatically determined unless the enemies list contains a <code>WaspTrooper</code>, <code>WaspBomber</code>, <code>WaspDriller</code> or <code>WaspHealer</code> which causes the music to be overriden to <code>Battle3</code></li> <li>Caller is this enemy</li> <li>With the ability to run</li> </ul>"},{"location":"Entities/NPCControl/Notable%20methods/StopForceBehavior/","title":"StopForceBehavior","text":"<p>This is a public method that aims to cleanly stop all forced behaviors or a behavior that uses a coroutine. Nothing happens if it's a <code>dummy</code>.</p> <ul> <li><code>forcebehavior</code> is set to null</li> <li><code>behaviorroutine</code> is stopped then set to null</li> <li>If we aren't <code>inevent</code>, StopForceMove is called on the entity</li> <li>entity.<code>overrideonlyflip</code> is set to false if it was true</li> <li><code>attacking</code> is set to false</li> <li>If it's an Enemy and we aren't <code>inevent</code>, the entity.<code>sprite</code> angles are set to (0.0, the y FlipAngle of the entity,  0.0)</li> </ul>"},{"location":"Entities/NPCControl/Notable%20methods/SwitchSound/","title":"SwitchSound","text":"<p>This is a private method in NPCControl that aims to play the sound of turning on or off a wide variety of switch like objects. It receives a bool to indicate if the object is being actuated or deactuated.</p> <p>Nothing happens if the <code>startlife</code> hasn't reached at least 15.0 frames.</p> <p>In all cases, the <code>Button</code> sound is played on the entity with 1.0 volume, but the pitch depends on the actuation. If we are actuating, it's 1.0 pitch and 0.5 if we are deactuating.</p> <p>There's a special case if the entity.<code>originalid</code> is the <code>AncientPressurePlate</code>, <code>SwitchCrystal</code> or <code>BigCrystalSwitch</code> animid. In that case another sound is played being a <code>Glow</code> sound using the same pitch variation as the other one, but the volume is the entity sound distance.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ANDBlock/","title":"ANDBlock","text":"<p>A multipurpose condition checker that can be operated in 3 distinct modes involving either flags or other NPCControl's <code>hit</code> value which results in a new <code>hit</code> value that can contol the entity.<code>sprite</code> local position.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ANDBlock/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data</code>: Control the mode of operations and data to check. See the table below for details. </li> <li><code>vectordata[0]</code>: The local position to set the entity.<code>sprite</code> when <code>hit</code> goes to true.</li> <li><code>vectordata[1].x</code>: The factor of the lerp to use after setting this object's <code>hit</code> during Update</li> <li><code>vectordata[2]</code>: The entity.<code>startscale</code> and the local scale of the entity.<code>sprite</code>. This is optional, neither are changed if the magnitude is &lt;= 0.1 or does not exist.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ANDBlock/#additional-data","title":"Additional data","text":"<ul> <li><code>activationflag</code>: When configured as such, the <code>hit</code> value is set to the value of this flag slot. See the table below for details.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ANDBlock/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>entity.<code>activeonpause</code> is set to true</li> <li>entity.<code>lockroater</code> is set to true</li> <li>The angles of the entity are set to Vector3.zero</li> <li>The entity.<code>rigid</code> gets all its constraints frozen</li> <li>entity.<code>startscale</code> and the entity.<code>sprite</code> local scale is set to <code>vectordata[2]</code> when applicable</li> <li>The object's layer is set to 8 (Ground)</li> <li>The <code>boxcol</code> meterial is set to <code>defaultpmat</code> if it exists</li> <li>The <code>scol</code> is disabled</li> </ul> <p>If the entity.<code>originalid</code> is the <code>PrisonGate</code> or the <code>PrisonGateLocal</code>'s AnimID, <code>internaltransform</code> is initialised to a single element being the second child of the <code>model</code> and it gets childed to the map (this is the base of the gate at the bottom). The reason this is done is because when the local position changes, only the grate part of the model needs to move, but the base still needs to render while being unaffected by the grate movement.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ANDBlock/#update","title":"Update","text":"<p>This is where the logic depending on the mode of operation occurs. There are 3 modes in which this object can operate in and it decides a new value for <code>hit</code>:</p> <ol> <li>Set <code>hit</code> based on the <code>activationflag</code> flag slot</li> <li>Set <code>hit</code> to <code>true</code> if other flags slots have a desired value (set to false otherwise)</li> <li>Set <code>hit</code> to <code>true</code> if other <code>hit</code> value of other NPCControl have a desired value (set to false otherwise)</li> </ol> <p>When checking a data value, it is possible to invert its checked value by sepcifying its negative version, but this means the value 0 cannot be checked for its inverted version. This means for example that if the value is a flag slot, it will check that it is false instead of checking for being true, but it is not possible to do this for flag slot 0.</p> <p>Consult the following table for clarity on each mode (one must apply and it will be the first where the required condition is fufilled):</p> Mode Condition Value(s) checked Result 1 <code>data[1]</code> is -1 and it is the last element <code>activationflag</code> <code>hit</code> is set to the flag slot of the value. 2 <code>data[0]</code> is -2 <code>data[1]</code> through the last one If all flags slots of each of the values are true, <code>hit</code> is set to true. It is set to false otherwise. 3 Neither of the other 2 modes applies <code>data[1]</code> through the last one If all the <code>hit</code> values of each NPCControl at the index of each of the values are true, <code>hit</code> is set to true. It is set to false otherwise. <p>After the <code>hit</code> value is changed to its new one, the local position of the entity.<code>sprite</code> is changed to be a lerp from its existing local position to <code>vectordata[0]</code> with <code>vectordata[1].x</code> as the factor if <code>hit</code> is true. If it is false, it's changed to be a lerp from its existing local position to Vector3.zero with <code>vectordata[1].x</code> as the factor.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ANDGate/","title":"ANDGate","text":"<p>A multipurpose condition checker that can be operated in 4 distinct modes involving either flag or other map entities's <code>hit</code> value which results in either a new <code>hit</code> value or an event being started.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ANDGate/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data</code>: Control the mode of operations and data to check. See the table below for details.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ANDGate/#additional-data","title":"Additional data","text":"<ul> <li><code>activationflag</code>: When configured as such, the <code>hit</code> value is set to the value of this flag slot. See the table below for details.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ANDGate/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ANDGate/#update","title":"Update","text":"<p>This is where the logic depending on the mode of operation occurs. There are 4 modes in which this object can operate in:</p> <ol> <li>Set <code>hit</code> based on the <code>activationflag</code> flag slot</li> <li>Set <code>hit</code> to <code>true</code> if other flags slots have a desired value (set to false otherwise)</li> <li>Set <code>hit</code> to <code>true</code> if other <code>hit</code> value of other NPCControl have a desired value (set to false otherwise)</li> <li>The same then mode 3, but if all conditions satisfies, <code>hit</code> isn't set and instead, an event whose id is <code>data[0]</code> is started and this object destroyed.</li> </ol> <p>When checking a data value, it is possible to invert its checked value by sepcifying its negative version, but this means the value 0 cannot be checked for its inverted version. This means for example that if the value is a flag slot, it will check that it is false instead of checking for being true, but it is not possible to do this for flag slot 0.</p> <p>Consult the following table for clarity on each mode (one must apply and it will be the first where the required condition is fufilled):</p> Mode Condition Value(s) checked Result 1 <code>data[1]</code> is -1 and it is the last element <code>activationflag</code> <code>hit</code> is set to the flag slot of the value. 2 <code>data[0]</code> is -2 <code>data[1]</code> through the last one If all flags slots of each of the values are true, <code>hit</code> is set to true. It is set to false otherwise. 3 <code>data[0]</code> is -1 <code>data[1]</code> through the last one If all the <code>hit</code> values of each map entities at the index of each of the values are true, <code>hit</code> is set to true. It is set to false otherwise. 4 <code>data[0]</code> is &gt;= 0 <code>data[1]</code> through the last one If all the <code>hit</code> values of each NPCControl at the index of each of the values are true, an event whose id is <code>data[0]</code> is started and this object gets destroyed. Otherwise, <code>hit</code> is set to false."},{"location":"Entities/NPCControl/ObjectTypes/BattleMapChange/","title":"BattleMapChange","text":"<p>A zone that causes a change of the map.<code>battlemap</code>.</p> <p>NOTE: While the logic for this object type is technically present, it is dead code because it's impossible to reach it. This means this can be considered as UNUSED even if it technically functions. Its usage isn't recommended.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BattleMapChange/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The battle map id to change to</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BattleMapChange/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BattleMapChange/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BattleMapChange/#ontriggerstay","title":"OnTriggerStay","text":"<p>There is dead code here where it would have changed the map's <code>battlemap</code> to the one whose id is <code>data[0]</code>, but it's impossible to reach this logic because it always lacks the proper conditions.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/","title":"Beemerang","text":"<p>Vi's Beemerang when thrown. This object type is only created dynamically.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>vectordata[0]</code>: The desired position that the Beemerang should end up befor going to the opposite direction. This is set by PlayerControl.DoActionTap under normal gameplay.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#remarks","title":"Remarks","text":"<p>The only entity that exists of this type is the one that exists under the <code>Ressources/prefabs/objects/Beerang</code> prefab as it comes with its own NPCControl of this <code>objecttype</code>. There is no way under normal gameplay other than PlayerControl requesting it to have it instantiated meaning effectively, if an entity has this <code>objecttype</code>, it is the same than if it was the player <code>beemerang</code> because it cannot be of any other type and no other NPCControl of this type can exist.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#special-behaviors","title":"Special behaviors","text":"<ul> <li>This type features an enabled entity.<code>ccol</code> unlike other objects</li> <li>This type doesn't doesn't feature an <code>scol</code> and the field remains null (The SphereCollider isn't added)</li> <li>This type cannot be added to the player.<code>npc</code> list on LateUpdate</li> <li>This type doesn't have its entity.<code>ccol</code> height and center adjusted in LateUpdate according to <code>colliderheight</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#setup","title":"Setup","text":"<p>The entity.<code>sound</code> is set to loop and the <code>RangeHold</code> sound is eet to play at half volume.</p> <p>All collisions between any collider whose GameObject's tag is <code>Respawn</code> and the <code>scol</code> or the entity.<code>ccol</code> are ignored. This is to avoid collisions with independant SetPlayerRespawn.</p> <p>All collisions between the colliders in the map.<code>entityonly</code> and the <code>scol</code> or the entity.<code>ccol</code> are ignored. Nothing happens if this array was null or empty.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#update","title":"Update","text":"<p>The tag is set to <code>BeeRang</code>.</p> <p>if the entity.<code>sound</code> isn't playing, call PlaySound on it with the <code>RangHold</code> clip set to loop,</p> <p>The <code>hit</code> value tracks on which half of the path the beemerang is on. If it's false, it's on the first half and if it's true, it's on the way back. Either gives a different branch of logic.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#hit-false-logic","title":"<code>hit</code> false logic","text":"<p>If the distance between this object and <code>vectordata[0]</code> is higher than 0.2, this object's position is set to a lerp from the existing one to <code>vectordata[0]</code> with a factor of the game's frametime * the entity's <code>speed</code>. This basically moves the beemerang to its destination.</p> <p>Otherwise (meaning the Beemerang reached its destination), if the ability key is held, flag 21 is true (got Beemerang Halt), <code>heldonce</code> is false and <code>WackaWorm.disablehold</code> is false:</p> <ul> <li>The entity.<code>sound</code> pitch is set to 1.25</li> <li>The entity.<code>spin</code> is set to (0.0, 0.0, 30.0)</li> <li><code>timer</code> is set to 99.0 (which gives it access to a new destination on the first Update cycle when the ability button is released)</li> <li>If <code>particles</code> is null, it's initialised to an instance of <code>Prefabs/Particles/ContinuousSmokeCloud</code> childed to this object at this object's position + Vector3.up * 0.2 with angles (-90.0, 0.0, 0.0)</li> </ul> <p>Otherwise, if the <code>timer</code> is exactly 99.0 (meaning we were using Beemerang Halt, but released the ability input):</p> <ul> <li><code>particles</code> is put offscreen at (0.0, -9999.0, 0.0) then destroyed in one second and set to null</li> <li>The entity.<code>sound</code> pitch is set to 1.25</li> <li><code>heldonce</code> is set to true</li> <li>The entity.<code>speed</code> is set to 0.15</li> <li><code>vectordata[0]</code> is set to the entity.<code>startpos</code> + the normalised direction from the entity.<code>startpos</code> to this object * 5.0. This essentially sets the destination to this object 5.0 away from the entity.<code>startpos</code> in the same direction it was already away from it (so it overshoots entity.<code>startpos</code> by 5.0). The way back will not be performed until it has also reached this second destination</li> <li><code>timer</code> is set to -1.0 (the default value in preparation of doing the back path)</li> </ul> <p>Otherwise, <code>hit</code> is set to true.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#hit-is-true-logic","title":"<code>hit</code> is true logic","text":"<p>If the <code>timer</code> is higher than -2.0, it is decremented by framestep.</p> <p>If the distance between this object position and the player is higher than 0.45 the following section occurs (otherwise, this object is destroyed because it means the Beemerang completed its full travel).</p> <p>If the <code>timer</code> is less than -2.0 (meaning the Beemerang collided with a wall), the ability key is held, flag 21 is true (got Beemerang Halt), <code>heldonce</code> is false and <code>WackaWorm.disablehold</code> is false, the following happens (this whole logic allows the beemerang to stall in place even if its path got cut short by a collider):</p> <ul> <li>The entity.<code>sound</code> pitch is set to 1.25</li> <li>The entity.<code>spin</code> is set to (0.0, 0.0, 30.0)</li> <li><code>timer</code> is set to -50.0</li> <li>If <code>particles</code> is null, it's initialised to an instance of <code>Prefabs/Particles/ContinuousSmokeCloud</code> childed to this object at this object's position + Vector3.up * 0.2 with angles (-90.0, 0.0, 0.0)</li> </ul> <p>Otherwise, if the ability key isn't held or the <code>timer</code> is exactly -50.0 (meaning the beemerang is ready to go back to the player):</p> <ul> <li><code>particles</code> is put offscreen at (0.0, -9999.0, 0.0) then destroyed in one second and set to null</li> <li><code>heldonce</code> is set to true</li> <li><code>timer</code> is set to -100.0</li> <li>This object's position is set to a lerp from the existing one to the player position with a factor of the game's frametime * 0.3</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#ontriggerenter-if-the-other-gameobject-layer-is-ground-nodigground-or-beerangonly","title":"OnTriggerEnter if the other gameObject layer is <code>Ground</code>, <code>NoDigGround</code> or <code>BeerangOnly</code>","text":"<p>If <code>hit</code> is false, the <code>WoodHit</code> sound is played at 1.2 pitch and 0.5 volume and the HitPart particles are played at this object position + Vector3.Up.</p> <p><code>hit</code> is then set to true and <code>timer</code> to -3.0. This forces the beemerang to stop its path and to be on the way back. The only way to stall it before actually coming back is by using Beemerang Halt because the <code>timer</code> value allows it to stall until the ability button is released.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Beemerang/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>If the NPCControl passed has this type, it returns true which allows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/","title":"BeetleGrass","text":"<p>A grass that can be cut by Kabbu's Horn Slash. Can either be bound to a crystalbfflags slot which will be dropped, or a list of items that can be dropped alongside the activation of a flag and regionalflag slots. </p>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The id of the grass sprite to use (NOTE: any other value than the ones below when <code>data[1]</code> doesn't apply will cause an exception to be thrown):<ul> <li>0: a standard green grass</li> <li>1: a branch looking grass</li> <li>2: an orange grass</li> <li>3: a brown grass</li> <li>4: a dense dark green grass</li> <li>5: a purple grass</li> <li>6: a beige and gray grass</li> </ul> </li> <li><code>data[1]</code>: If it's not negative, the crystalbfflags id that will be dropped when the bush is cut. This is optional: no Crystal Berry is dropped if it doesn't exist</li> <li><code>vectordata</code>: The list of items ids (in the x component after flooring) to potentially drop. Only applicable if <code>data[1]</code> doesn't apply</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#additional-data","title":"Additional data","text":"<ul> <li><code>boxcol</code>: Required to be present with valid data</li> <li><code>regaionalflag</code>: The regionalflag slot turned to true when the bush is cut while <code>data[1]</code> isn't present or is negative (if an item is dropped, it's attached to the item created).</li> <li><code>activationflag</code>: The flag slot turned to true when the bush is cut while <code>data[1]</code> isn't present or is negative (if an item is dropped, it's attached to the item created).</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#hashiddenitem-conditions","title":"HasHiddenItem conditions","text":"<p>If <code>data[1]</code> is present and not negative, the crystalbflags whose id is that value must not have been obtained yet.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul> <p>If <code>data[1]</code> is present and not negative and the crystal berry corresponding to its id has been obtained, the entity.<code>iskill</code> is set to true which ends this object setup as the grass will not appear.</p> <p>Otherwise:</p> <ul> <li>The layer is set to 8 (Ground) </li> <li>The <code>boxcol</code>'s material is set to the defaultpmat. </li> <li>The entity.<code>rotater</code> tag is set to <code>Hornable</code> which allows PlayerControl to get a green ! emoticon when getting 2.5 or lower distance from the grass for 5 frames</li> <li>The entity.<code>rigid</code> has all constraints frozen</li> <li>entity.<code>overrideanim</code> is set to true</li> <li>entity.<code>sprite</code> is enabled and set to the corresponding sprite from grasssprite mentioned above and its shadowCastingMode is set to TwoSided</li> <li>Unless nowindeffect is true (meaning Wind Effects in the settings is Off), the entity.<code>sprite</code> material is set to the windShader and RefreshWind is called on the entity.<code>sprite</code> which sets the shader property to be:<ul> <li><code>_ShakeDisplacement</code>: random betweent half the map.<code>windspeed</code> and it's actual value</li> <li><code>_ShakeBending</code>: random betweent half the map.<code>windintensity</code> and it's actual value</li> <li><code>_ShakeTime</code>: random betweent 0.075 and 0.25</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#ontriggerenter","title":"OnTriggerEnter","text":"<p>If the other gameObject tag is <code>BeetleHorn</code> or <code>BeetleDash</code> while <code>hit</code> is false and the distance between this and the other transform is less than 3.5, CutGrass is called (See the section below for details) followed by a RefreshPlayer call which forces the player.<code>ceiling</code> the player.entity.<code>hitwall</code> (when not <code>inevent</code> and not in <code>battle</code>) and all <code>playerdata</code> entity.<code>onground</code> to false as well as childing the player to the root. NOTE: it is unknwon why RefreshPlayer is called.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#cutgrass","title":"CutGrass","text":"<p>A number of steps occurs:</p> <ul> <li>The <code>rustling1</code> is played on entity</li> <li>The entity.<code>rotater</code> tag is set to <code>Object</code> (this removes its Hornable property).</li> <li><code>hit</code> gets set to true (which prevents OnTriggerEnter to act again)</li> <li>The <code>boxcol</code> gets disabled</li> <li>The actual sprite of entity.<code>sprite</code> gets changed to the small base version of the grass according to <code>data[0]</code> and its material gets set to <code>spritemat</code></li> </ul> <p>From there, this is where the potential item drop and flag slots edits occurs.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#crystal-berry-drop","title":"Crystal Berry drop","text":"<p>If <code>data[1]</code> is present and not negative, CreateItem is called with the following:</p> <ul> <li>starpos of this transform + (0.0, 0.5, 0.0)</li> <li>itemtype of 3 (Crystal Berry)</li> <li>itemid of <code>data[1]</code></li> <li>direction of RandomItemBounce(4.0, 12.0)</li> <li>No timer</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#potential-item-drop","title":"Potential Item Drop","text":"<p>If <code>data[1]</code> isn't present or is negative, <code>vectordata</code> is checked to see if we are going to drop an item. The way this is done is selecting a uniform random valid index of a <code>vectordata</code> element. It is valid if it's not negative. If it is valid, CreateItem is called which creates an Item object with the following:</p> <ul> <li>starpos of this transform + (0.0, 0.5, 0.0)</li> <li>itemtype of 0 (Standard item)</li> <li>itemid of <code>vectordata[i].x</code> floored where <code>i</code> is the random index generated earlier</li> <li>direction of RandomItemBounce(4.0, 12.0)</li> <li>timer of 600 frames</li> </ul> <p>Once the creation is done, the <code>regionalflag</code> and <code>activationflag</code> of the new item are set to this object's corresponding values. This binds them to the item instead of the BeetleGrass object itself.</p> <p>In the case where <code>vectordata</code> is empty or the generated index leads to a negative value of the element x component, the logic is limited to set the flag and regionalflag slots of this object's <code>regionalflag</code> and <code>activationflag</code> to true.</p> <p>No matter which cases we land into, there is always a 13% chance to call CreateItem a second time with the following:</p> <ul> <li>starpos of this transform + (0.0, 0.5, 0.0)</li> <li>itemtype of 0 (Standard item)</li> <li>itemid of 6 (<code>MoneySmall</code>)</li> <li>direction of RandomItemBounce(4.0, 12.0)</li> <li>timer of 600 frames</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#common-ending-logic","title":"Common ending logic","text":"<p>For any cases at the end of the method, if we dropped any item or Crystal Berry, all collisions between the item and this object's entity are ignored.</p> <p>Finally, a GrassFade coroutine is started. The purpose of that coroutine is only for rendering the cut part of the grass which is done by creating a new gameObject named <code>grass</code> with a SpriteRenderer, SphereCollider, BoxCollider and RigidBody where the sprite is the cut grass version according to <code>data[0]</code>. For brevety, the full details of this effect won't be detailed, but a couple of things is worth to mention:</p> <ul> <li>The grass layer is set to 9 (Follower)</li> <li>A torque is applied on the grass of RandomItemBounce(5.0, 0.0)</li> <li>The starting velocity is (0.0, 10.0, 0.0)</li> <li>If an item or Crystal Berry was dropped earlier, all collisions between the item and the grass's colliders are ignored</li> <li>For each frames until 3 seconds passed, the <code>rustling2</code> sound is played if the y velocity is negative while it was positive before</li> <li>The fade is done by setting the material to <code>spritematlit</code>, its renderQueue to 3000 and to progressively fade the alpha of the grass until it reaches 0.1 or below by subtracting 1/20 of the game's frametime each frame</li> <li>The grass object is destroyed once the fading is completed</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#pausemenunearsomething","title":"PauseMenu.NearSomething","text":"<p>If the method finds out that an NPCControl of this object type exists less than 4.0 distance from the player, the return will be an array of 3 booleans with the first one being true. This will prevent usage of the Bed Bug item.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#hashiddenitem","title":"HasHiddenItem","text":"<p>This object type is allowed to return true here if <code>data[1]</code> is positive and the corresponding crystalbfflag slot has not been obtained yet.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BeetleGrass/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>If the NPCControl passed has this type, it returns true which allows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/","title":"BreakableRock","text":"<p>A rock that can be broken using Kabbu's Horn Dash or shook by Kabbu's Horn Slash.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The color of the rock material selectable among 6 different ones:<ul> <li>0: FFFFFF (pure white)</li> <li>1: ED9121 (mostly orange)</li> <li>2: EDD872 (light yellow)</li> <li>3: BCD1ED (light gray)</li> <li>4: 84BF6B (light green)</li> <li>5: A03F70 (light magenta)</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/#additional-data","title":"Additional data","text":"<ul> <li><code>boxcol</code>: Required to be present with valid data, but the center and size are overriden to (0.0, 2.5, 0.0) and (5.0, 5.0, 5.0) respectively</li> <li><code>regaionalflag</code>: If positive, the regionalflag slot turned to true when the rock is broken</li> <li><code>activationflag</code>: If above 0, the flag slot turned to true when the rock is broken</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul> <p>AddModel is called on the entity with the path <code>Prefabs/Objects/CrackedRock</code> with offset (-1.0, 0.0, 1.5). The material's color depends on <code>data[0]</code> (any other value has it unchanged):</p> <ul> <li>0: FFFFFF (pure white)</li> <li>1: ED9121 (mostly orange)</li> <li>2: EDD872 (light yellow)</li> <li>3: BCD1ED (light gray)</li> <li>4: 84BF6B (light green)</li> <li>5: A03F70 (light magenta)</li> </ul> <p>The tag of this object is set to <code>DroppletPass</code> with a layer of 13 (NoDigGround) This was supposed to allow a Dropplet to pass through the rock instead of colliding with it, but the tag is overriden to <code>Object</code> later making this not work.</p> <p>The following occurs:</p> <ul> <li>entity.<code>rotater</code> tag is set to <code>Hornable</code> which allows PlayerControl to get a green ! emoticon when getting 2.5 or lower distance from the grass for 5 frames</li> <li>entity.<code>rigid</code> has all its constaints frozen</li> <li><code>boxcol</code>.center is overriden to (0.0, 2.5, 0.0) and the size is overriden to Vector3.one * 5.0</li> <li>AddPusher is called and the height of the <code>pusher</code> is overriden to 0.0 and the radius to 3.5. The local position of the <code>pusher</code> is set to (0.0, 3.0, 0.0).</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/#ontriggerenter","title":"OnTriggerEnter","text":"<p>This only has logic if the <code>collisionammount</code> is 1 or below (this is a debounce logic).</p> <p>If the other gameObject tag is <code>BeetleDash</code>, BreakRock is called.</p> <p>Otherewise, if the other gameObject tag is <code>BeetleHorn</code>, ShakeSprite is called on the entity for 10.0 frames using the intensity (0.1, 0.05, 10.0). This will also cause the <code>Rock2</code> sound to be played on the entity with a random pitch between 0.9 and 1.1.</p> <p><code>collisionammount</code> is then set to 2.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/#pausemenunearsomething","title":"PauseMenu.NearSomething","text":"<p>If the method finds out that an NPCControl of this object type exists less than 4.0 distance from the player, the return will be an array of 3 booleans with the first one being true. This will prevent usage of the Bed Bug item.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/#oncollisionenter-when-this-object-type-is-the-other-collider-of-a-rollingrock","title":"OnCollisionEnter (When this object type is the other collider of a RollingRock)","text":"<p>When a RollingRock receives a collision from a BreakableRock, BreakRock is called on the breakbale one.</p>"},{"location":"Entities/NPCControl/ObjectTypes/BreakableRock/#breakrock","title":"BreakRock","text":"<p>This is a public method that has logic specific to this object type.</p> <p>If the player is less than 15.0 away from this object and the <code>RockBreak</code> sound wasn't playing, it is played at 0.5 volume.</p> <p>Nothing happens if <code>hit</code> is true (prevents to call this when the rock is already broken). If it's false:</p> <ul> <li>A <code>Prefabs/Objects/CrackRockBreak</code> prefab is instantiated at the rock's position and its CrackedRockBreak's initialcolore is set to the rock's material color</li> <li><code>regionalflag</code> and <code>activationflag</code> flags array slots are set to true when applicable</li> <li><code>hit</code> is set to true</li> <li>The <code>boxcol</code> is disabled</li> <li>ShakeScreen is called with the vector being (0.3, 0.3, 0.3) for 0.5 seconds</li> <li>Death is called on the entity with kill</li> <li>player.<code>bounderbreak</code> is set to 5.0</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/CameraChange/","title":"CameraChange","text":"<p>A trigger zone to change the camera's properties.</p>"},{"location":"Entities/NPCControl/ObjectTypes/CameraChange/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: If 1, the <code>camoffset</code> is changed by this object when triggered</li> <li><code>data[1]</code>: If 1, the map camera limits are changed by this object when triggered</li> <li><code>data[2]</code>: If 1, the <code>camspeed</code> is changed by this object when triggered</li> <li><code>data[3]</code>: If 1, the <code>camangleoffset</code> is changed by this object when triggered</li> <li><code>data[4]</code>: If 1, the <code>camtarget</code> is changed by this object when triggered</li> <li><code>data[5]</code>: The entity id whose entity's transform is the value the <code>camtarget</code> will be set to when <code>data[4]</code> is 1</li> <li><code>data[6]</code>: If 1, the <code>camtargetpos</code> is changed by this object when triggered</li> <li><code>data[7]</code>: If 1, the <code>camanglespeed</code> is changed by this object when triggered. This is optional</li> <li><code>vectordata[0]</code>: The <code>camoffset</code> to set if <code>data[0]</code> is 1</li> <li><code>vectordata[1]</code>: The map <code>camlimitpos</code> (upper limit bound) to set if <code>data[1]</code> is true. NOTE: if the magnitude isn't above 0.1, <code>camlimitpos</code> and <code>camlimitneg</code> are reset to default when this is triggered and <code>data[1]</code> is true</li> <li><code>vectordata[2]</code>: The map <code>camlimitneg</code> (lower limit bound) to set if <code>data[1]</code> is true. NOTE: if the magnitude isn't above 0.1, <code>camlimitpos</code> and <code>camlimitneg</code> are reset to default when this is triggered and <code>data[1]</code> is true</li> <li><code>vectordata[3].x</code>: The <code>camspeed</code> to set if <code>data[2]</code> is 1 which will also set <code>changecamspeed</code> to true</li> <li><code>vectordata[3].y</code>: The <code>camanglespeed</code> to set if <code>data[7]</code> is 1 which will also set <code>camanglechange</code> to true</li> <li><code>vectordata[4]</code>: The <code>camangleoffset</code> to set to if <code>data[3]</code> is 1</li> <li><code>vectordata[5]</code>: The <code>camtargetpos</code> to set to if <code>data[6]</code> is 1</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/CameraChange/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/CameraChange/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/CameraChange/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of the following is true:</p> <ul> <li>The other gameObject isn't the player</li> <li>The player isn't free (ignoring flying) and its entity is not <code>digging</code></li> </ul> <p>If the above conditions are fufilled, the camera data is changed accoriding to the data logic described above.</p>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/","title":"CoiledObject","text":"<p>A coil that can trap another map entity within using a configurable local position and requires to be hit by a player ability to untrap the object. It can optionally set a flag slot to true when hit.</p>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The map entity id of the object being trapped</li> <li><code>data[1]</code>: A flag slot that is set to true whenever the object gets hit by a player ability. This is optional, it is not specified if the value is negative</li> <li><code>vectordata[0]</code>: The local position of the trapped object</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/#additional-data","title":"Additional data","text":"<ul> <li><code>boxcol</code>: Required to be present with valid data</li> <li><code>regaionalflag</code>: If not negative, the corresponding regionalflag slot is set to true when the coil gets hit</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>entity.<code>alwaysactive</code> is set to true</li> <li>gameObject's isStatic is set to true</li> <li>entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/#update","title":"Update","text":"<p>Updates are disabled as long as <code>hit</code> is false.</p> <p>There's 2 cases. Either the <code>boxcol</code> is enabled or disabled.</p> <p>If it is enabled, then the entity.<code>model</code> local scale is set to a lerp from the existing one to (100.0, 100.0, 120.0) with a factor of the 1/5 of the game's frametime. This only increases the z scaling because the base scale of the <code>CoilyVine</code> prefab is 100.0 uniform, but the pivot point is also rotated such that the z axis is vertical so the overall effect is this grows it vertically. If the z component of the entity.<code>model</code> local scale reached higher than 115.0, the <code>boxcol</code> gets disabled which ends this update cycle.</p> <p>If the <code>boxcol</code> was disabled (happens when the vine grew enough vertically), then the entity.<code>model</code> local scale is set to a lerp from the existing one to (100.0, 100.0, 0.0) with a factor of the 1/5 of the game's frametime. This makes it scales down vertically to become effectively flat upwards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/#lateupdate-nan-in-position-component","title":"LateUpdate (NaN in position component)","text":"<p>This is logic that applies only to the <code>trapped</code> <code>Object</code> reffered by this <code>CoiledObject</code> and not the <code>CoiledObject</code> itself.</p> <p>If the NPCControl is <code>trapped</code>, there is a special case where the game will find the first <code>Object</code> NPCControl that is also a <code>CoiledObject</code> with a <code>data[0]</code> matching the <code>mapid</code> (this is checked by entity id order). When found, the local position of the <code>Object</code> is set to the <code>vectordata[0]</code> of the map entity found and its entity.<code>rigid</code> is locked via LockRigid(true). Nothing happens if none of them are found.</p> <p>NOTE: it is unknown why the game seems to specifically care about a NaN positive with a <code>trapped</code> object. This doesn't seem to happen under normal gameplay.</p>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/#lateupdate-not-a-dummy-and-the-entity-is-incamera","title":"LateUpdate (Not a <code>dummy</code> and the entity is <code>incamera</code>)","text":"<ul> <li>If <code>moveobj</code> isn't initialised yet, <code>hit</code> is false and the entity isn't <code>iskill</code>, then <code>moveobj</code> is initialised to the NPCControl at <code>data[0]</code> as <code>mapid</code> with some adjustements:<ul> <li>Its <code>trapped</code> is set to true</li> <li>Its entity.<code>rigid</code> is locked via LockRigid(true)</li> <li>It gets childed to this entity.<code>sprite</code></li> <li>Its scale is set to Vector3.one</li> <li>Its local position is set to <code>vectordata[0]</code></li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/#ontriggerenter","title":"OnTriggerEnter","text":"<p>Nothing happens if all of the following are true:</p> <ul> <li>We are in a <code>pause</code> or <code>minipause</code></li> <li>message is grabbed</li> <li>The other gameObject tag isn't <code>BeetleHorn</code>, <code>BeetleDash</code> and <code>Icecle</code> while it's not the player <code>beemerang</code></li> <li><code>moveobj</code> is not present (meaning this coil doesn't contain its object)</li> <li><code>hit</code> is true</li> </ul> <p>The <code>Coiled</code> sound is played on this entity and HitPart particles are played at this position + (0.0, 0.5, 0.0).</p> <p>The following occurs on the entity of the <code>moveobj</code> (the trapped object):</p> <ul> <li>The <code>rigid</code> is unlocked via LockRigid(false), but its velocity gets zeroed out</li> <li>The <code>npcdata.trapped</code> is set to false</li> <li>The <code>onground</code> is set to false</li> <li>It gets childed to the current map</li> <li>The local scale is set to Vector3.one</li> </ul> <p>If <code>data[1]</code> isn't negative, the corresponding flag slot is set to true.</p> <p>If the <code>regaionalflag</code> isn't negative, the corresponding regionalflag slot is set to true.</p> <p>If the other collider was the player <code>beemerang</code>, its <code>hit</code> is set to true followed by the <code>WoodHit</code> sound being played.</p> <p>Finally, <code>hit</code> is set to true.</p>"},{"location":"Entities/NPCControl/ObjectTypes/CoiledObject/#effects-of-being-trapped","title":"Effects of being <code>trapped</code>","text":"<p>This field is specific to this object and the object being <code>trapped</code> receives some specific effects:</p> <ul> <li>If it's a PushRock, OnTriggerEnter becomes disabled preventing the rock to be moved by Kabbu's Horn Slash</li> <li>CheckItem prevents any <code>trapped</code> Item from being obtained by the player.</li> <li>It won't receive active NPCControl updates unless entity.<code>activeonpause</code> is true (and even if it is, it can only receive updates if it's an Enemy with one of the 3 active update override cases)</li> <li>Any inactive updates will skip setting the position to entity.<code>startpos</code></li> <li>The entity's UpdateVelocity effects are only active every 2 frames when the npcdata.<code>entitytype</code> isn't NPC</li> <li>For all active EntityControl update on the entity, the first child of the <code>spritetransform</code>'s enablement is not updated</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DialogueTrigger/","title":"DialogueTrigger","text":"<p>A zone where a SetText call starts in dialogue mode using a map dialogue line id. It can either unconditionally trigger as a one shot call on the first Update cycle or trigger via OnTriggerStay that starts the call when the player collides with it with the option to destroy the NPCControl after.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DialogueTrigger/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The map dialogue line id to call SetText in dialogue mode when triggered</li> <li><code>data[1]</code>: If not 0 or doesn't exist, the object is destroyed after triggering it, only applicable if <code>data[2]</code> doesn't exist or isn't 1</li> <li><code>data[2]</code>: If 1, the SetText call is unconditionally started on the first Update cycle before destroying this NPCControl making it a one shot call. This is optional, if it doesn't exist, this feature is disabled.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DialogueTrigger/#additional-data","title":"Additional data","text":"<ul> <li><code>regionalflag</code>: If it's positive, it's the regionalflag slot that is set to true when the player collides with this object.</li> <li><code>activationflag</code>: If it's above 0, the flag slot that is set to true when the player collides with this object. It is not possible to specify 0 and will be treated the same as not providing a value.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DialogueTrigger/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DialogueTrigger/#update","title":"Update","text":"<p>Updates are disabled if <code>data[2]</code> doesn't exist or isn't -1 or we are in <code>pause</code>, <code>minipause</code> or <code>inevent</code>. All Update does is manage the unconditional one shot trigger feature.</p> <p>If the above is fufilled:</p> <ul> <li>CancelAction is called on the player </li> <li>SetText is called in dialogue mode using the map dialogue line id <code>data[0]</code>:<ul> <li>fonttype of 0 (<code>BubblegumSans</code>)</li> <li>Standard messagebreak as <code>linebreak</code></li> <li>No <code>tridimensional</code></li> <li>No local <code>position</code> change, no <code>camoffset</code> change or <code>size</code> change</li> <li>This transform as the <code>parent</code></li> <li>No <code>caller</code></li> </ul> </li> </ul> <p>If the current map supports the global commands system, the map's <code>currentline</code> is set to <code>data[0]</code>.</p> <p>Finally, this object gets destroyed.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DialogueTrigger/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of the following is true:</p> <ul> <li>The other gameObject isn't the player</li> <li>We are <code>inevent</code></li> <li>We are in a <code>pause</code></li> <li><code>hit</code> is true </li> </ul> <p>The regionalflag slot at <code>regionalflags</code> and the flag slot at <code>activationflag</code> are set to true.</p> <p>If we aren't in a <code>minipause</code>, a WaitForEvent coroutine starts which does the following:</p> <ul> <li><code>hit</code> is set to true (this prevents a second trigger)</li> <li>We enter a <code>minipause</code></li> <li>Yield frames until <code>switchcooldown</code> expires</li> <li>Yield another additional frame</li> <li>Call CancelAction on the player</li> <li>Yield a frame</li> <li>Calls SetText in dialogue mode with the input string being the one resolved by the dialogue line id contained in <code>data[0]</code>:<ul> <li><code>BubblegumSans</code> as the fonttype</li> <li>The default <code>messagebreak</code> as the linebreak</li> <li>No tridimensional</li> <li>No position and camera offsets</li> <li>Size of Vector3.one</li> <li>This as the parent</li> <li>No caller</li> </ul> </li> <li><code>hit</code> is set to false</li> <li>If <code>data[1]</code> isn't 0 or doesn't exist, the object is destroyed</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DigSpot/","title":"DigSpot","text":"<p>A spot where an item, medal or Crystal Berry can be dug out or have an event be triggered when doing so using Kabbu's Dig ability.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DigSpot/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: This has 3 possible meanings:<ul> <li>If it's 1, it indicates that there is a crystal berry hidden in this spot</li> <li>If it's 2 or above, it indicates that an event will start when the dig spot is dug up </li> <li>If it's 0 or less, it indicates that there is an item or medal hidden in this spot</li> </ul> </li> <li><code>data[1]</code>: The meaning depends on <code>data[0]</code>:<ul> <li>If <code>data[0]</code> is 2 or above, the event id that will start when the dig spot is dug up</li> <li>If <code>data[0]</code> is 1, the crystalbfflags slot hidden in this spot</li> <li>If <code>data[0]</code> is 0 or less, the item type hidden in this spot</li> </ul> </li> <li><code>data[2]</code>: If <code>data[0]</code> is 0 or less, the item or medal id hidden inside this spot. This can be considered mandatory if <code>data[0]</code> isn't 1 because it is still expected to be present even if <code>data[0]</code> is 2 which doesn't make use of this field. It is optional if <code>data[0]</code> is 1 as the value is ignored</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DigSpot/#additional-data","title":"Additional data","text":"<ul> <li><code>regionalflag</code>: If it's positive and <code>data[0]</code> is 0 or less, it's the regionalflag slot that is bound to the created item when the dig spot is dug up.</li> <li><code>activationflag</code>: If it's above 0 and <code>data[0]</code> is 0 or less, the flag slot that is bound to the created item when the dig spot is dug up</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DigSpot/#hashiddenitem-conditions","title":"HasHiddenItem conditions","text":"<p>The condition depends on <code>data[0]</code>.</p> <p>If <code>data[0]</code> is 1, the crystalbflags whose id is <code>data[1]</code> must not have been obtained yet. </p> <p>If <code>data[0]</code> isn't 1, then <code>data[1]</code> must be 1 (key item) and <code>data[2]</code> must be 52 (Lore Book).</p>"},{"location":"Entities/NPCControl/ObjectTypes/DigSpot/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul> <p>Then, if <code>data[0]</code> is 1 and the corresponding crystalbfflags slot in <code>data[1]</code> has already been obtained, the entity's <code>iskill</code> is set to true which ends this object setup as the dig spot will not appear.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DigSpot/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DigSpot/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of the following are true:</p> <ul> <li>The entity.<code>iskill</code> is true</li> <li>The other gameObject isn't the player</li> <li>The player <code>uproot</code> is false (meaning the player wasn't preparing to go back to the surface after stopping to dig)</li> </ul> <p>The <code>DigPop2</code> sound is played following by <code>DigPop</code>, but with 0.7 volume.</p> <p>If <code>data[0]</code> is 2 or above, a WaitForEvent coroutine starts which does the following:</p> <ul> <li><code>hit</code> is set to true</li> <li>We enter a <code>minipause</code></li> <li>Yield frames until <code>switchcooldown</code> expires</li> <li>Yield another additional frame</li> <li>Call CancelAction on the player</li> <li>Yield a frame</li> <li>The event whose id is <code>data[1]</code> is started with this object as the caller</li> <li><code>hit</code> is set to false</li> </ul> <p>Otherwise (meaning there is an item or a Crystal Berry hidden in this spot):</p> <ul> <li>CreateItem is called with:<ul> <li>This object's position as the startpos, </li> <li>If <code>data[0]</code> is 1, 3 (Crystal Berry) is the itemtype, it's <code>data[1]</code> otherwise</li> <li>If <code>data[0]</code> is 1, <code>data[1]</code> is the itemid (which is a crystalbfflags slot), it's <code>data[2]</code> otherwise</li> <li>RandomItemBounce(4.0, 15.0) as the direction</li> <li>If <code>data[0]</code> is 0 or less (there is an item or medal hidden in this spot), the timer is 300.0 if <code>data[1]</code> is 0 (standard item). It is -1 (no timer) otherwise</li> </ul> </li> <li>If <code>data[0]</code> is 0 or less, the <code>activationflag</code> and <code>regionalflag</code> of the created item are set to the corresponding ones from this object</li> <li>All collisions between the entity and the created item's entity are ignored</li> </ul> <p>Finally, the entity <code>iskill</code> is set to true which prevents to undig the spot again.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/","title":"DoorOtherMap","text":"<p>A loading zone to another map with customisable movement before and after the load.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The map id this leads to</li> <li><code>data[1]</code>: If 1, the <code>camoffset</code> is set to <code>vectordata[3]</code> when fading in after the map load. This is optional, if it doesn't exist, no changes to the camera is done</li> <li><code>data[2]</code>: If 1, the <code>camangleoffset</code> is set to <code>vectordata[4]</code> when fading in after the map load. This is optional only if <code>data[1]</code> doesn't exist too</li> <li><code>data[3]</code>: If 1, the map.<code>camlimitpos</code> and map.<code>camlimitneg</code> are set to <code>vectordata[5]</code> and <code>vectordata[6]</code> respectively when fading in after the map load. This is optional only if <code>data[1]</code> doesn't exist too</li> <li><code>data[4]</code>: If 1, there will be no movement before the map load and instead, all <code>playerdata</code> entity.<code>rigid</code> will have their gravity disabled in kinematic mode. This is optional, if it doesn't exist, movement happens as normal</li> <li><code>vectordata[0]</code>: The position the party will move to before fading out before the map load if <code>data[4]</code> isn't 1</li> <li><code>vectordata[1]</code>: The position the party will spawn after the map load</li> <li><code>vectordata[2]</code>: The position the party will move to when fading in after the map load</li> <li><code>vectordata[3]</code>: The <code>camoffset</code> is set when fading in after the map load if <code>data[1]</code> is 1. This is optional only if <code>data[1]</code> doesn't exist</li> <li><code>vectordata[4]</code>: The <code>camangleoffset</code> is set when fading in after the map load if <code>data[2]</code> is 1. This is optional only if <code>data[1]</code> doesn't exist</li> <li><code>vectordata[5]</code>: The <code>camlimitpos</code> is set when fading in after the map load if <code>data[3]</code> is 1. This is optional only if <code>data[1]</code> doesn't exist</li> <li><code>vectordata[6]</code>: The <code>camlimitneg</code> is set when fading in after the map load if <code>data[3]</code> is 1. This is optional only if <code>data[1]</code> doesn't exist</li> <li><code>emoticonoffset.x</code>: If it's higher than 0.1, the movement after the map load is done with a JumpTo call on the player with this value as the height. If it's lower, a standard MoveTowards is used on the player entity instead</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/#additional-data","title":"Additional data","text":"<ul> <li><code>regionalflag</code>: If it's positive, it's the regionalflag slot that is set to true when the player collides with this object.</li> <li><code>activationflag</code>: If it's above 0, the flag slot that is set to true when the player collides with this object. It is not possible to specify 0 and will be treated the same as not providing a value.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/#createentities","title":"CreateEntities","text":"<p>The <code>insideid</code> is set to -2 which excludes it from the MapControl.RefreshInsides logic where it could toggle the gameObject enablement if the current <code>insideid</code> didn't match (or entity.<code>hideinside</code> is true while being in the same <code>insideid</code>).</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/#mapcontrolrefreshinsides","title":"MapControl.RefreshInsides","text":"<p>If we are getting outside while <code>hideinsides</code> is true (which is only the case to hide the break room part of the <code>AntTunnels</code> map), normally, this method would go through all map entities that are inside (or their entity.<code>hideinside</code> is true) and disable them and keep the others enabled. </p> <p>This object type is excluded from this logic meaning it will never get deactivated from this.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/#mapcontrollateupdate","title":"MapControl.LateUpdate","text":"<p>After 20 frames has passed since the load of the map and every 2 frames, this object type has some special logic where the gameObject and its entity.<code>emoticon</code>'s gameObject gets disabled if the player gets 15.0 (ignoring y) or more away from the object and enabled if it gets back within 15.0.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorOtherMap/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of the following is true:</p> <ul> <li>The other gameObject isn't the player</li> <li>We are <code>inevent</code></li> <li>We are in a <code>pause</code></li> <li><code>hit</code> is true (never happens under normal gameplay)</li> </ul> <p>The regionalflag slot at <code>regionalflags</code> and the flag slot at <code>activationflag</code> are set to true.</p> <p>If we aren't in a <code>minipause</code>, a TransferMap coroutine is started with <code>data[0]</code> as the map id, <code>vectordata[0]</code> as the position to move to before the load, <code>vectordata[1]</code> as the position to spawn after the load, <code>vectordata[2]</code> as the position to move to after the load and this object as the caller.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorSameMap/","title":"DoorSameMap","text":"<p>A transition zone to and away from an inside of the current map.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorSameMap/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The id of the map.<code>insides</code> this transitions to</li> <li><code>data[1]</code>: A music id to change the current one when entering the inside (the music is changed back to map.<code>music[0]</code> when exiting it). This is optional, no change happens if it doesn't exist or it's -1</li> <li><code>vectordata[0]</code>: The position to move the player when entering the inside</li> <li><code>vectordata[1]</code>: The position to move the player when exiting the inside</li> <li><code>vectordata[2]</code>: The <code>camoffset</code> to set when entering the inside. This is optional: if the magnitude is below 0.1, no changes happen.</li> <li><code>vectordata[3]</code>: The <code>camangleoffset</code> to set when entering the inside. This is optional: if the magnitude is below 0.1, no changes happen.</li> <li><code>vectordata[4]</code>: OVERRIDEN (stores the original <code>camoffset</code> when entering the inside for restoring when exiting it)</li> <li><code>vectordata[5]</code>: OVERRIDEN (stores the original <code>camangleoffset</code> when entering the inside for restoring when exiting it)</li> <li><code>vectordata[6]</code>: The <code>camlimitpos</code> to set when entering the inside. This is optional: if the magnitude is below 0.1, no changes happen.</li> <li><code>vectordata[7]</code>: The <code>camlimitneg</code> to set when entering the inside. This is optional: if the magnitude is below 0.1, no changes happen.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DoorSameMap/#additional-data","title":"Additional data","text":"<ul> <li><code>regionalflag</code>: If it's positive, it's the regionalflag slot that is set to true when the player collides with this object.</li> <li><code>activationflag</code>: If it's above 0, the flag slot that is set to true when the player collides with this object. It is not possible to specify 0 and will be treated the same as not providing a value.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DoorSameMap/#createentities","title":"CreateEntities","text":"<p>The <code>insideid</code> is set to -2 which excludes it from the MapControl.RefreshInsides logic where it could toggle the gameObject enablement if the current <code>insideid</code> didn't match (or entity.<code>hideinside</code> is true while being in the same <code>insideid</code>).</p> <p>This is also where if <code>data[1]</code> exists with a music id, the corresponding music is loaded and added to the <code>musicpreload</code> list. This list isn't read by anyone, it's just to preload the asset for Unity to load it faster after the map load.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorSameMap/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/DoorSameMap/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorSameMap/#mapcontrolrefreshinsides","title":"MapControl.RefreshInsides","text":"<p>If we are getting outside while <code>hideinsides</code> is true (which is only the case to hide the break room part of the <code>AntTunnels</code> map), normally, this method would go through all map entities that are inside (or their entity.<code>hideinside</code> is true) and disable them and keep the others enabled. </p> <p>This object type is excluded from this logic meaning it will never get deactivated from this.</p>"},{"location":"Entities/NPCControl/ObjectTypes/DoorSameMap/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of the following is true:</p> <ul> <li>The other gameObject isn't the player</li> <li>We are <code>inevent</code></li> <li>We are in a <code>pause</code></li> <li><code>hit</code> is true </li> </ul> <p>The regionalflag slot at <code>regionalflags</code> and the flag slot at <code>activationflag</code> are set to true.</p> <p>If we aren't in a <code>minipause</code>, a MoveInside coroutine is started on the current map with this object as the caller.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/","title":"Dropplet","text":"<p>A water dropplet that can be frozen by Leif's Freeze which then turns it into an ice cube that can be moved by launching it using Kabbu's Horn Slash. The push velocity vector when launched is configurable and the object also supports many optional features, see the data array definition for details.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The time interval in frames between main Updates where the ice cube and dropplet are managed. This allows to throttle those updates</li> <li><code>data[1]</code>: If above 0, the max distance in units the cube can away of entity.<code>startpos</code> + <code>vectordata[0]</code>. If the ice cube goes further, it will be shattered via ShatterDroppletIce. This isn't enforced if the value is 0 or below</li> <li><code>data[2]</code>: There are 3 possible meanings:<ul> <li>If 0, entity.<code>shadow</code> is always kept enabled and when the dropplet is frozen, its position is set to be offscreen immediately</li> <li>If 1, entity.<code>shadow</code> is only enabled when <code>hit</code> is false (no ice cube exists) and when the dropplet is frozen, the entity.<code>rigid</code> is put in kinematic mode and the dropplet position is set to be offscreen in 0.1 seconds. This also allows <code>data[3]</code> to take effect if applicable</li> <li>Any other value: If 1, entity.<code>shadow</code> is only enabled when <code>hit</code> is false (no ice cube exists) and when the dropplet is frozen, its position is set to be offscreen immediately</li> </ul> </li> <li><code>data[3]</code>: If <code>data[2]</code> is 1 and this value is above 0, the time period in frames that the ice cube is allowed to exist before shattering via ShatterDroppletIce on its own. This is optional, this feature is disabled if it doesn't exist or is 0 or below. NOTE: specifying a value above 0 while <code>data[2]</code> isn't 1 is considered invalid and will cause the ice cube to shatter on the first throttled update</li> <li><code>data[4]</code>: If 1, the ice cube can only be launched in the 8 cardinal directions relative to the camera instead of having free movement in x and z</li> <li><code>vectordata[0]</code>: If <code>data[1]</code> is above 0, this is an offset position where its value + <code>startpos</code> is the center of the range where the ice cube is allowed to stay with a max distance of <code>data[1]</code>. If the ice cube goes out of this range, it is shattered via ShatterDroppletIce</li> <li><code>vectordata[1].x</code>: The x and z velocity of the ice cube when launched</li> <li><code>vectordata[1].y</code>: The y velocity of the ice cube when launched</li> <li><code>vectordata[1].z</code>: If not 0.0, the volume multiplier of the <code>WaterSplash</code> sound when a dropplet collides with a GameObject with layer <code>Ground</code> or <code>NoDigGround</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#setup","title":"Setup","text":"<ul> <li><code>actionfrequency</code> is initialised to 3 elements left at 0.0 each</li> <li>entity.<code>hasshadow</code> is set to true</li> <li>entity.<code>overrideshadow</code> is set to true</li> <li>entity.<code>alwaysactive</code> is set to true</li> <li>entity.<code>activeonpause</code> is set to true</li> <li>entity.<code>shadow</code> is ensured to be created if it wasn't</li> </ul> <p>From there, <code>internaltransform</code> is initialised to one element which is an instance of the <code>Prefabs/Objects/icecube</code> prefab which is then childed to the map. Some adjustements are performed on it:</p> <ul> <li>The layer is set to 13 (NoDigGround)</li> <li>The local scale is set to Vector3.one * 1.5</li> <li>A RigidBody is added on it with kinematic and rotation frozen with a mass of 100000.0</li> <li>The BoxCollider present at the root of it gets enabled without trigger at size Vector3.one</li> <li>A DialogueAnim is added with a startsize and targetpos of Vector3 * 1.5, a targetpos of Vector3.zero and a speed of 0.01</li> <li>A Hornable is added with a push of (<code>vectordata[1].x</code>, <code>vectordata[1].y</code>) created from this NPCControl with breakondash and without pusher.</li> <li>The first child's tag is set to <code>DroppletCube</code> (this is the actual cube inside the outer BoxCollider)</li> <li>A trigger BoxCollider is added to the <code>DroppletCube</code> with a size of Vector3.one * 0.01. All collisions with it and the player.entity.<code>ccol</code> or the outer BoxCollider are ignored</li> </ul> <p>After:</p> <ul> <li><code>vectordata[0]</code> is incremented by the entity.<code>startpos</code></li> <li><code>internalparticle</code> is initialised to a single element which is the SpriteBounce of a instance of <code>Prefabs/Objects/WaterBubble</code> which is then childed to the entity.<code>sprite</code> and has a local position of Vector3.up / 2</li> <li>entity.<code>rigid</code> gets its gravity enabled with rotation frozen and entity.<code>onground</code> set to false</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#update","title":"Update","text":"<p>If the entity.<code>rigid</code> isn't in kinematic mode, its y velocity will be set to -10.0 and RefreshShadow is called on the entity. This forces the dropplet to drop down at a constant speed.</p> <p>If the <code>actioncooldown</code> hasn't expired yet, it is decremented by the game's frametime. Otherwise LockRigid(false, false) is called on the entity. This allows to unlock the entity.<code>rigid</code> once a dropplet is ready to be dropped.</p> <p>If the entity.<code>shadow</code> is present, it will get enabled if <code>data[2]</code> is 0 or <code>hit</code> is false and it will get disabled otherwise.</p> <p>What follows is logic that depends on the <code>actionfrequency</code> 3 different cooldowns.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#actionfrequency-cooldowns","title":"<code>actionfrequency</code> cooldowns","text":"<p>Here is what the different array elements mean:</p> <ul> <li><code>actionfrequency[0]</code>: UNUSED (It always stays to -1100 and never changes)</li> <li><code>actionfrequency[1]</code>: The max cooldown before the dropplet is moved to entity.<code>startpos</code> which is hardcoded to 600.0</li> <li><code>actionfrequency[2]</code>: The cooldown before doing any of this logic which means it serve as a throttle. Defaults to <code>data[2]</code></li> </ul> <p>Nothing in this section happens if <code>actionfrequency</code> hasn't expired yet besides the value being decremented by framestep. This effectively throttles main updates to only happen every <code>data[0]</code> frames.</p> <p>If we aren't being throttled, this is where <code>actionfrequency[1]</code> comes into play. If it hasn't expired yet and the entity y position is -25.0 or above, then <code>actionfrequency[1]</code> is decremented by framestep. Otherwise, it means the cooldown expired, the dropplet dropped to \\&lt; -25 or it was placed offscreen by OnTriggerEnter as a result of touching the ground or being frozen. In that case, the dropplet is reset back to its starting position by doing the following:</p> <ul> <li>The position is set to entity.<code>startpos</code></li> <li><code>actionfrequency[1]</code> is reset to 600.0 which allows the cycle to restart</li> <li>entity.<code>rigid</code> velocity gets zeroed out without kinematic mode</li> </ul> <p>From there the following always happen:</p> <ul> <li>LockRgid(false) is called on the entity</li> <li>entity.<code>rigid</code> gets its rotation frozen</li> </ul> <p>If <code>hit</code> is false or we are in a <code>pause</code> or <code>minipause</code>, this section is done as the rest only concerns the ice cube when unpaused.</p> <p>If <code>data[1]</code> is above 0 and <code>internaltransform[0]</code> (the actual ice cube) is more than <code>data[1]</code> away from entity.<code>startpos</code> + <code>vectordata[0]</code>, it is shattered via ShatterDroppletIce.</p> <p>We only proceed if <code>data[3]</code> exists and is above 0.</p> <p>This is where the new <code>actioncooldown</code> value is managed. It was already decremented earlier so the only logic here is when it goes below 100.0 every 3 frames and when it expires.</p> <p>If it's below 100.0 every 3 frames:</p> <ul> <li>The <code>IceMelt</code> sound effect is played at <code>internaltransform[0]</code> (the actual ice cube) with the volume being that transform's sound distance * 2.0 adjusted by the game's volume settings.</li> <li>The DialogueAnim of the ice cube targetscale is set to Vector3.zero to make it shrink to nothing at a speed of 0.01</li> </ul> <p>If it's expired, the ice cube is shattered via ShatterDroppletIce and ServerGeizer is called on the ice cube's Hornable.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#lateupdate-non-dummy-the-entity-is-incamera-and-not-iskill","title":"LateUpdate (Non <code>dummy</code>, the entity is <code>incamera</code> and not <code>iskill</code>)","text":"<p>Normally under these circumstances, If the y position is less than the map.<code>ylimit</code>, the the position is set to the entity.<code>startpos</code> and DeathSmoke particles are played at the entity.<code>sprite</code> position if it isn't <code>dead</code> and the animid isn't negative (it is defined).</p> <p>However, <code>Dropplet</code> are exempt from the logic above so they aren't bound by the map.<code>ylimit</code>.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#ontriggerenter-main-logic","title":"OnTriggerEnter main logic","text":"<p>This does nothing if the other gameObject tag isn't <code>Icecle</code> or <code>IceRadius</code>.</p> <p>If <code>hit</code> is true, the <code>IceShatter</code> particle is played at the <code>internaltransform[0]</code> position and the <code>IceBreak</code> sound is played at the same position with the volume being the sound distance of the position adjusted for the game's volume * 1.5. Finally, it also causes ServerGeizer to be called on the <code>internaltransform[0]</code>'s Hornable.</p> <p>The following occurs:</p> <ul> <li><code>hit</code> is set to true</li> <li><code>actionfrequency[0]</code> is set to -1100.0</li> <li><code>actionfrequency[1]</code> is set to 600.0</li> <li><code>internaltransform[0]</code> gets some adjustements:<ul> <li>Its position gets set to the other position + (0.0, 0.25, 0.0)</li> <li>It gets childed to the map</li> <li>Its local scale gets set to Vector3.zero</li> <li>Its Hornable <code>ingeizer</code> gets set to null</li> <li>Its DialogueAnim is enabled with a <code>shrinkspeed</code> of 0.1 and a <code>targetscale</code> of (1.5, 1.5, 1.5)</li> <li>Its RigidBody gets its velocity zeroed out and put out of kinematic mode</li> </ul> </li> <li>If the <code>collisionammount</code> is less than 2, the <code>Freeze</code> sound is played at 0.6 volume</li> <li><code>collisionammount</code> is incremented</li> <li>If <code>data[2]</code> is 1 (otherwise, the position is set to offscreen at (0.0, -2000.0, 0.0)):<ul> <li>If <code>data[3]</code> exists and is above 0, <code>actioncooldown</code> is set to <code>data[3]</code></li> <li>The entity.<code>rigid</code> is put in kinematic mode</li> <li>The position is set to offscreen at (0.0, -2000.0, 0.0) in 0.1 seconds</li> </ul> </li> <li><code>actionfrequency[2]</code> is set to <code>data[0]</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#ontriggerenter-if-the-other-gameobject-layer-is-ground-or-nodigground","title":"OnTriggerEnter if the other gameObject layer is <code>Ground</code> or <code>NoDigGround</code>","text":"<p>This does nothing if the other gameObject tag is <code>DroppletPass</code> (This would have happened with a BreakableRock, but the tag gets overriden to <code>Object</code> later so in practice, this can't happen under normal gameplay).</p> <ul> <li><code>actionfrequency[1]</code> is set to 600.0</li> <li>If the entity.<code>rigid</code> is not in kinematic mode, the following depends on <code>internalparticle[0]</code>:<ul> <li>If it is null, it is initialised to a <code>WaterSplash</code> ParticleSystem being played at this object position with angles of (-90.0, 0.0, 0.0) and it is then parented to the map.</li> <li>If it wasn't null, its position is set to this object position and Play is called on it</li> </ul> </li> <li>If we aren't in a <code>pause</code> and the <code>startlife</code> is over 60.0 frames, the <code>WaterSplash</code> sound is played at this object position with a volume of the entity sound distance adjusted for the volume settings and multipled by <code>vectordata[1].z</code> if it wasn't 0.0.</li> <li>The entity.<code>rigid</code> is put in kinematic mode</li> <li>The position is set to be offscreen at (0.0, -2000.0, 0.0)</li> <li><code>actionfrequency[0]</code> is set to -1110.0</li> <li><code>actionfrequency[2]</code> is set to <code>data[0]</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#mainmanagerrefreshentities","title":"MainManager.RefreshEntities","text":"<p>This logic only matters if the method was called as a result of MapControl.Start, MapControl.RefreshInsides and BattleControl.ReturnToOverworld.</p> <p>If <code>data[2]</code> is 0 or <code>hit</code> is false:</p> <ul> <li>entity.<code>rigid</code> gets its velocity zeroed without kinematic and with gravity</li> <li>entity.<code>onground</code> is set to false</li> <li>If entity.<code>originalmap</code> is the current one, the dropplet is childed to the map</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#shatterdroppletice","title":"ShatterDroppletIce","text":"<p>This is a public method that is practically called in a wide variety of places, but it only contains logic pertinent to this object type. It shatters the ice cube by doing the following:</p> <ul> <li><code>hit</code> is set to false which makes the game no longer recognise the ice cube exists</li> <li><code>IceShatter</code> particle is played at the ice cube's position + (0.0, 1.0, 0.0) with angles (-90.0, 0.0, 0.0) for 1.0 second</li> <li>The <code>IceBreak</code> sound effect is played at the ice cube's position with the volume being the ice cube sound distance adjusted by the game volume settings</li> <li>The position of the ice cube is set to be offscreen (0.0, -1000.0, 0.0) the next frame</li> <li>The RigidBody of the ice cube is put into kinematic mode</li> <li>The ice cube is childed to the map</li> <li>The DialogueAnim of the ice cube is enabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#hornable","title":"Hornable","text":"<p>This component is only used for this object type on <code>internaltransform[0]</code> (the actual ice cube) making all its logic exclusive to a dropplet. Its job is to manage the actual movement of the ice cube when using Kabbu's Horn Slash or when it is on a Geizer.</p> <p>For the sake of brevety, the component won't be fully documented, but a summary of the methods is provided here.</p> <p>To properly add the Hornable, SetUp must be called and in practice, it's always called with the same parameters on this NPCContol's SetUp:</p> <ul> <li>pushammount is (<code>vectordata[1].x</code>, <code>vectordata[1].y</code>)</li> <li>pusherenabled is false, but then overriden to true on the component's Start (prevents it to be affected by a <code>pusher</code> collider on an NPC)</li> <li>dashbreak is true (this is unused so it does nothing)</li> <li>parent is this NPCControl</li> </ul> <p>On its Start, the main thing that happens is the tag is set to <code>Hornable</code> (allows PlayerControl to get a green ! emoticon when getting 2.5 or lower distance from the grass for 5 frames), a HelpArrow is setup with a cyan color and a rotater object is created childed to the ice cube (this is used later when <code>data[4]</code> gets involved).</p> <p>On its LateUpdate, the main things that happens are:</p> <ul> <li>Some logic where the ice cube is visually displaced when the ice cube is in a Geizer</li> <li>The frictions are managed here (basically full friction when at rest, no frictions otherwise)</li> <li>Enforcing that the cube cannot be more than 150.0 frames in the air or its x and z velocity will be zeroed out and forced to be on the ground</li> </ul> <p>On its OnTriggerEnter, there are multiple possible interactions depending on the other collider tag:</p> <ul> <li><code>BeetleHorn</code>: This means the cube will be launched. The launch is done by using pushammount.x for the x and z axises and pushammount.y for the y axis as the new velocity adjusted by the actual direction the player is at so it launches away from it. However, this can be skewed if <code>data[4]</code> exists and is 1 where the actual direction is snapped to the closest 8 cardinal directions relative to the camera (this is done using the rotater object as it's set to look at the player)</li> <li><code>IceBreak</code>: the player.entity.<code>hitwall</code> is set to true and ShatterDroppletIce is called on the NPCControl</li> <li><code>Platform</code> or <code>PlatformNoClock</code>: The ice cube can get childed to the platform (or Geizer) so it moves with it. This is also done in OnCollisionEnter. This is undone in OnTriggerExit when applicable</li> </ul> <p>On its OnTriggerStay, any <code>Pusher</code> collider is enforced here and the ground state is reset when the other collider is layer 8 or 13 (<code>Ground</code> or <code>NoDigGround</code>). This is also done in OnCollisionEnter and OnCollisionStay</p>"},{"location":"Entities/NPCControl/ObjectTypes/Dropplet/#servergeizer","title":"ServerGeizer","text":"<p>This public method of the component is important because it setup some changes when the ice cube gets on a Geizer. It does nothing however if <code>ingeizer</code> is null.</p> <ul> <li>The collisions between the root collider or the actual ice cube collider and the ingeizer.<code>boxcol</code> are temporarilly ignored for 5.0 seconds</li> <li>The ice cube is childed to the map</li> <li>The root RigidBody velocity is zeroed out with gravity and without kinematic mode</li> <li>ingeizer.<code>moveobj</code> is set to null</li> <li>ingeizer is set to null</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/EnemySpawner/","title":"EnemySpawner","text":"<p>An enemy spawner attached to another Enemy entity that will continuously respawn in a given circle range whenever it dies after a certain amount of time. The map entity id of the enemy, the time interval to wait before respawn and the range at which the enemy will spawn is configurable with the option to spawn the enemy immediately on the first Update cycle.</p>"},{"location":"Entities/NPCControl/ObjectTypes/EnemySpawner/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The map entity id of the NPCControl that refers to the Enemy to spawn</li> <li><code>data[1]</code>: If it's 1, the spawner spawns the enemy on the first active Update cycle instead of having to wait the <code>data[4]</code> cooldown expires</li> <li><code>data[4]</code>: The time in frames to wait before the spawner spawns the enemy</li> <li><code>data[5]</code>: OVERRIDEN (the original entity.animid)</li> <li><code>vectordata[0]</code>: The center position of the spawning range</li> <li><code>vectordata[1]</code>: The range of the spawning. This says the random offset to apply to <code>vectordata[0]</code> to apply as the spawn position which is from -<code>vectordata[1]</code> to <code>vectordata[1]</code> with + (0.0, 0.5, 0.0) being added to it</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/EnemySpawner/#setup","title":"Setup","text":"<ul> <li>The entity.<code>rigid</code> is put in kinematic mode</li> <li>The gameObject's isStatic is set to true</li> <li><code>actioncooldown</code> is set to <code>data[4]</code> unless <code>data[1]</code> is 1 where it's set to 0.0 instead</li> <li>After saving the old value in <code>data[5]</code>, the entity's <code>animid</code> is set to -1 (none)</li> <li>entity.<code>sprite</code> is disabled</li> <li>entity.<code>ccol</code> is disabled</li> <li><code>alwaysactive</code> is set to true</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/EnemySpawner/#update","title":"Update","text":"<p>There are 2 cases here. If the <code>actioncooldown</code> isn't expired and the <code>spawned</code> enemey doesn't exist or its entity <code>iskill</code>, the <code>actioncooldown</code> is decremented by the game's frametime which ends this update.</p> <p>If the cooldown has expired, then this update will only occur if the <code>spawned</code> doesn't exist or its entity <code>iskill</code>. This means that we should attempt to spawn the enemy. Otherwise, all update cycles are ignored until this becomes true.</p> <p>If the <code>spawned</code> enemy still doesn't exist, it is set to the NPCControl of the Enemy whose NPCControl <code>mapid</code> is <code>data[0]</code>.</p> <p>Here, as long as the <code>spawned</code>'s entity exists, RespawnEnemy is called with the <code>spawned</code> enemy at the position <code>vectordata[0]</code> + RandomVector(<code>vectodata[1]</code>) + (0.0, 0.5, 0.0). The random vector portion is from -<code>vectordata[1]</code> to <code>vectordata[1]</code>.</p> <p>Finally, the <code>actioncooldown</code> is reset to <code>data[4]</code>.</p>"},{"location":"Entities/NPCControl/ObjectTypes/EventTrigger/","title":"EventTrigger","text":"<p>An event trigger zone. It can either unconditionally trigger as a one shot event on the first Update cycle or trigger via OnTriggerStay that starts the event when the player collides with it with the option to destroy the NPCControl after.</p>"},{"location":"Entities/NPCControl/ObjectTypes/EventTrigger/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The event id this will start when triggered</li> <li><code>data[1]</code>: If not 0 or doesn't exist, the object is destroyed after triggering it, only applicable if <code>data[2]</code> doesn't exist or isn't 1</li> <li><code>data[2]</code>: If 1, the event is unconditionally started on the first Update cycle before destroying this NPCControl making it a one shot event. This is optional, if it doesn't exist, this feature is disabled.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/EventTrigger/#additional-data","title":"Additional data","text":"<ul> <li><code>regionalflag</code>: If it's positive, it's the regionalflag slot that is set to true when the player collides with this object.</li> <li><code>activationflag</code>: If it's above 0, the flag slot that is set to true when the player collides with this object. It is not possible to specify 0 and will be treated the same as not providing a value.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/EventTrigger/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/EventTrigger/#update","title":"Update","text":"<p>Updates are disabled if <code>data[2]</code> doesn't exist or isn't -1 or we are in <code>pause</code>, <code>minipause</code> or <code>inevent</code>. All Update does is manage the unconditional one shot trigger feature.</p> <p>If the above is fufilled, the event id <code>data[0]</code> is started with no caller immediately.</p> <p>Finally, this object gets destroyed.</p>"},{"location":"Entities/NPCControl/ObjectTypes/EventTrigger/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of the following is true:</p> <ul> <li>The other gameObject isn't the player</li> <li>We are <code>inevent</code></li> <li>We are in a <code>pause</code></li> <li><code>hit</code> is true </li> </ul> <p>The regionalflag slot at <code>regionalflags</code> and the flag slot at <code>activationflag</code> are set to true.</p> <p>If we aren't in a <code>minipause</code>, a WaitForEvent coroutine starts which does the following:</p> <ul> <li><code>hit</code> is set to true (this prevents a second trigger)</li> <li>We enter a <code>minipause</code></li> <li>Yield frames until <code>switchcooldown</code> expires</li> <li>Yield another additional frame</li> <li>Call CancelAction on the player</li> <li>Yield a frame</li> <li>The event whose id is <code>data[0]</code> is started with this object as the caller</li> <li><code>hit</code> is set to false</li> <li>If <code>data[1]</code> isn't 0 or doesn't exist, the object is destroyed</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/FixedAnim/","title":"FixedAnim","text":"<p>An object where the entity is left in a fixed animstate with the option to also disables the entity.<code>ccol</code> and gravity on it.</p>"},{"location":"Entities/NPCControl/ObjectTypes/FixedAnim/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: If it's 1, the entity.<code>ccol</code> and the entity.<code>rigid</code>'s gravity are disabled</li> <li><code>data[1]</code>: the entity's animstate to set</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/FixedAnim/#setup","title":"Setup","text":"<ul> <li>The entity.<code>ccol</code> gets disabled or enabled depending on <code>data[0]</code></li> <li>The entity.<code>rigid</code>'s gravity gets disabled if <code>data[0]</code> is 1</li> <li>entity.<code>overridejump</code> is set to true</li> <li>entity.<code>overrideanim</code> is set to true</li> <li>entity.animstate is set to <code>data[1]</code></li> <li>The <code>scol</code> gets disabled.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/FixedAnim/#update","title":"Update","text":"<p>The animstate is set to <code>data[1]</code>. Then, if the Sin of the Time.DeltaTime is 0.8 or above (Requires it to at least 0.9273), the entity's <code>oldstate</code> is set to which forces UpdateSprite to run its main logic. NOTE: it is unknown why the Sin is there, but it doesn't seem to have an impact under normal gameplay.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/","title":"Geizer","text":"<p>A water or honey geizer that can be frozen using Leif's Freeze and it can elevate a Dropplet ice cube. The oscillation and time to stay frozen are configurable with the option to conditionally activate it when another NPCControl <code>hit</code> is true.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The optional suffix to append to the path when loading the Geizer prefab after converting the number to string, defaults to empty string if not present or if it's &lt;= 0 which is the normal water looking one. NOTE: only a value of 1 is allowed under normal gameplay because it's the only one that gives a valid path (the honey looking geizer), an exception will be thrown if the path is invalid</li> <li><code>data[1]</code>: The map entity id whose NPCControl's <code>hit</code> should be true for the geizer to be active. This is optional, it can be ommitted or be -1 to have the geizer always be active.</li> <li><code>data[2]</code>: If 1 and the map.<code>lastwater</code>  exists (the water Hazards), the spout of the main geizer object will continually be set to the map.<code>lastwater</code> y position every updates where the geizer isn't frozen</li> <li><code>data[3]</code>: If it's not 0, the MeshRenderer of the frozen geizer spout doesn't get enabled when frozen. If it's 1, the geizer position will be set to be entity.<code>startpos</code> + the geizer up vector * 10.0 on the first LateUpdate where it is <code>incamera</code> and <code>startlife</code> is below 20.0 (this means the geizer will start under the floor or inside its wall instead of slowly retracting when the map is done loading). This is optional, it remains enabled if it doesn't exists and nothing special will happen on LateUpdate.</li> <li><code>data[4]</code>: If it's not 0, the geizer won't be frozen when it collides with an <code>IceRadius</code>. This is optional, it will be frozen if it doesn't exist</li> <li><code>vectordata[0].x</code>: 1/6 of the geizer's oscillation's curve frequency in htz</li> <li><code>vectordata[0].y</code>: The geizer's oscillation's curve magnitude</li> <li><code>vectordata[0].z</code>: The amount of time in frames to keep the geizer frozen when it collides with an ice collider (this is trippled if the Extra Freeze medal is equipped)</li> <li><code>dialogues[2].x</code>: The local scale of the entity.<code>model</code> will be multiplied by the 1/10 of this, but this is optional and the scale will not change if it is 0.1 or below</li> <li><code>dialogues[2].y</code>: If not 0, the <code>electime</code> of the GlowTrigger when the entity.<code>originalid</code> is the  <code>ElectroPlatform</code> AnimID. This is optional and the value defaults is 260.0</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#setup","title":"Setup","text":"<ul> <li>entity.<code>rigid</code> gets effectively locked by disabling gravity, making it kinematic and freezing all constraints</li> <li>isStatic on the gameObject is set to false</li> <li><code>nointeract</code> is set to true</li> <li>entity.<code>soundonpause</code> is set to true</li> <li>The gameObject layer to 0 (Default).</li> <li>The <code>scol</code> is disabled</li> <li><code>actionfrequency</code>: is initialised to 2 elemenst :<ul> <li>0: Random.Range(1.0, 10.0) (this is a random phase shift to the geizer oscillation)</li> <li>1: 0.0 (this is a DeltaTime accumulator for use in the geizer oscillation)</li> </ul> </li> <li><code>actioncooldown</code>: set to -1100.0 (meaning the first update cycle will be treated as if we had an expired cooldown since more than 1 update cycle)</li> <li>A geizer prefab is instantiated from the path <code>Prefabs/Objects/Geizer</code> followed by <code>data[0]</code> if applicable. The geizer is childed to the entity's <code>sprite</code> and has its local position set to Vector3.zero.</li> <li><code>internaltransform</code> is initialised to 5 elements:<ul> <li>0: The first child of the geizer's root (The root of the main geizer object)</li> <li>1: The second child of the geizer's root (the root of the frozen geizer object)</li> <li>2: The first child of the geizer's first child (the top of the main geizer object)</li> <li>3: The second child of the geizer's first child (the spout at the bottom of the main geizer's object)</li> <li>4: The first child of the geizer's second child (the frozen spout at the bottom of the frozen geizer object)</li> </ul> </li> <li>entity.<code>model</code> scale is multiplied by a 1/10 of <code>dialogues[2].x</code></li> <li>entity.<code>alwaysactive</code> is set to true</li> <li>entity.<code>model</code> tag is set to <code>PlatformNoClock</code></li> <li>If entity.<code>originalid</code> is the <code>ElectroPlatform</code> AnimID, a GlowTrigger is added on the first child of the <code>model</code>:<ul> <li><code>getactivecolorfromstart</code> is set to true</li> <li><code>parent</code> is set to this NPCControl</li> <li><code>glowparts</code> is initialised to a single element corresponding to the MeshRenderer of the first child of the <code>model</code></li> <li><code>electime</code> is initialised to 260.0 unless <code>dialogues[2].y</code> exists and isn't 0 where it will take that value instead</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#update","title":"Update","text":"<p>The <code>internaltransform[3]</code> (the bottom spout of the main geizer object) gets its local scale set to Vector3.one. If this is the first Update, <code>initialrender</code> is initialised to a single element being the MeshRenderer of the spout of the geizer object. This MeshRenderer is then disabled.</p> <p>From there, the geizer can be active or inactive. It's active if <code>data[1]</code> doesn't exist, is -1 or the map entity with the id being <code>data[1]</code> exists with a <code>hit</code> value of true. It is inactive otherwise. This changes the rest of the update cycle.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#inactive-updates","title":"Inactive updates","text":"<p>In the case where the geizer shouldn't be active, GeizerBreak is called if the <code>actioncooldown</code> hasn't expired yet (it is also set to 0.0 in this case). This is followed by the position being set to a lerp from the existing one to the entity's <code>startpos</code> - the transform's up vector * 10.0 with a factor of 0.025 * the game's frametime. This basically makes the geizer slowly retract itself such that it's not visible because it would be under the floor or inside a wall.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#active-update","title":"Active update","text":"<p>If the <code>startlife</code> is above 20.0 frames and <code>hit</code> is false, <code>hit</code> is set to true and the ParticleSystem of <code>internaltransform[3]</code> (the spout of the main geizer) is set to play which is some water splashing.</p> <p>The position is set to lerp from the existing one to the entity.<code>startpos</code> with a factor of framestep * 0.025. This makes the geizer slowly show itself if it wasn't active earlier.</p> <p>From there, there are 3 cases: the <code>actioncooldown</code> hasn't expired, it expired last cycle or it has been expired since more than 1 update cycle. This cooldown controls the time left for the geizer to remain frozen before thawing via GeizerBreak. If it expired, it means the geizer isn't frozen.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#actioncooldown-hasnt-expired-yet","title":"ActionCooldown hasn't expired yet","text":"<ul> <li>If <code>data[3]</code> is 0 or doesn't exist, <code>internalrender[0]</code> (the MeshRenderer of the spout of the frozen geizer object) gets enabled</li> <li>The entity.<code>sound</code> is set to not loop anymore</li> <li>The <code>actioncooldown</code> is decremented by framestep</li> <li>The <code>internaltransform[1]</code> (the frozen geizer object) local position is set to Vector3.zero unless there's less than 100.0 frames left on the <code>actioncooldown</code> in which case, it's set to (Random.Range(-0.05, 0.05), 0.0, 0.0). This applies a somewhat random offset to the frozen geizer every update cycle when there's 100.0 frames left.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#actioncooldown-expired-since-the-last-update-cycle","title":"<code>actioncooldown</code> expired since the last Update cycle","text":"<p>If the <code>actioncooldown</code> expired since the last cycle (tested by checking it is 0.0 or below, but above -1000.0):</p> <ul> <li><code>internaltransform[0]</code> is activated (the main geizer object)</li> <li><code>internaltransform[1]</code> is deactivated (the frozen geizer object)</li> <li><code>internaltransform[3]</code> is activated (the spout at the bottom of main geizer object)</li> <li>The <code>boxcol</code> is enabled if it is present</li> <li>If <code>startlife</code> is 15.0 or above, GeizerBreak is called</li> <li>The ParticleSystem of <code>internaltransform[3]</code> (the spout at the bottom of the water object) is set to play which is some water splashing.</li> <li>The entity.<code>sound</code> is set to no longer loop</li> <li><code>actioncooldown</code> is set to -1100.0 which changes further update cycles to have the cooldown expired since more than 1 cycle.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#actioncooldown-expired-more-than-1-update-cycle-ago","title":"<code>actioncooldown</code> expired more than 1 Update cycle ago","text":"<p>If the <code>actioncooldown</code> expired more than 1 cycle ago (checked by being below -1000.0):</p> <ul> <li><code>internaltransform[2]</code> (the top of the main geizer object) is set to rotate by 5.0 degrees in the z axis (this is the vertical one due to the pivot point being rotated)</li> <li><code>internaltransform[3]</code> (the spout at the bottom of the water object) is set to rotate by -5.0 degrees in the y axis</li> <li>The <code>boxcol</code> center is set to (0.0, 3.0 + the root geizer main object y position, 0.0) which elevates it slightly above its position</li> <li>The geizer's root position (the parent of <code>internaltransform[0]</code>) is set to a lerp from the existing one to the entity. <code>startpos</code> + the normalized up vector of the transform * Mathf.Sin(<code>actionfrequency[1]</code> * <code>vectordata[0].x</code> + <code>actionfrequency[0]</code>) * <code>vectordata[0].y</code> with a factor of the 1/10 of the game's frametime. This oscillates the geizer's:<ul> <li><code>vectordata[0].y</code> is the magnitude of the sine wave, it tells half of the full range between the lowest point the geizer will go and the higest</li> <li><code>actionfrequency[1]</code> is the time in seconds accumulated since SetUp so this scales the Sin through time</li> <li><code>actionfrequency[2]</code> is a phase shift that's been determined randomly on SetUp</li> <li><code>vectordata[0].x</code> is 1/6 of the frequency</li> </ul> </li> <li><code>actionfrequency[1]</code> is incremented by Time.deltaTime</li> <li>If the entity's <code>sound</code> wasn't playing, PlaySound is called with the <code>Waterfall1</code> clip at 0.075 volume and the entity.<code>sound</code> is set to loop</li> <li>If <code>data[2]</code> is present and 1 and there is a map.lastwater, the y component of the <code>internaltransform[3]</code> position (the spout at the bottom of the main geizer object) is set to map.<code>lastwater</code> y position. This basically means the spout will be positioned on the map's water Hazards level.</li> <li>The <code>internalrender[0]</code> (the MeshRenderer of the spout of the frozen geizer object) gets disabled and its position set to the <code>internaltransform[3]</code> one (the spout at the bottom of the main geizer object)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#lateupdate-not-a-dummy-incamera-is-true-and-hit-is-false","title":"LateUpdate (Not a <code>dummy</code>, <code>incamera</code> is true and <code>hit</code> is false)","text":"<ul> <li><code>internaltransform[3]</code> (the spout of the main geizer object) has its scale set to Vector3.One</li> <li>A Raycast is performed from the geizer position + (0.0, 10.0, 0.0) headed down with max 10.0 distance only accepting layers of <code>Ground</code> or <code>NoDigGround</code>.</li> <li>If <code>attacking</code> is false (this is the first applicable LateUpdate cycle), it is set to true after a Fader component is added to the gameObject with:<ul> <li>forcestayonpause to true</li> <li>childtied to true</li> <li>fadedistance to 0.0</li> <li>pivotoffset to (0.0, the point.y of the collision done earlier or 0.0 if there wasn't a collision - entity.<code>startpos</code>, 0.0)</li> </ul> </li> <li>If <code>data[3]</code> is 1 and <code>startlife</code> is less than 20.0, the position is set to the entity.<code>startpos</code> - the up vector of the geizer * 10.0. This places the geizer such that it will be under the floor / inside its wall very soon after map load</li> <li>If there was a collision with the raycast earlier, the position of <code>internaltransform[3]</code> (the spout of the main geizer object) is set to the hit point of the raycast and it also gets childed to the entity.<code>sprite</code>. This basically ensures the spout is placed where the ground actually is and to ensure it doesn't move with the geizer, it's childed in such a way that it is a sibling of the geizer so it stays there independently of the geizer movements</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#ontriggerenter","title":"OnTriggerEnter","text":"<p>There are 4 branches here:</p> <ul> <li>The other gameObject tag is <code>Icecle</code>, <code>Icefall</code> or <code>IceRadius</code> and <code>data[4]</code> doesn't exist or is 0</li> <li>The other gameObject tag is <code>BeetleHorn</code> or <code>BeetleDash</code> and the <code>actioncooldown</code> hasn't expired yet (meaning the geizer is frozen)</li> <li>The other gameObject tag is <code>DroppletCube</code> and the <code>actioncooldown</code>  expired (meaning the geizer isn't frozen)</li> <li>The other gameObject tag is <code>PFollower</code> or it's the player</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#ice-collider-logic","title":"Ice collider logic","text":"<ul> <li>If the <code>moveobj</code> is present (meaning a Dropplet ice cube is on the geizer):<ul> <li>LaunchObject is called with it using a random vector between (0.0, -15.0, 0.0) and (0.0, 15.0, 0.0)</li> <li>The parent of the ice cube is set to the current map</li> <li>ServerGeizer is called onm the <code>moveobj</code> Hornable which setups the cube to be on the geizer snapped to it</li> </ul> </li> <li>If the <code>actioncooldown</code> expired (meaning the geizer isn't frozen):<ul> <li>The <code>boxcol</code> is disabled if present</li> <li><code>internaltransform[0]</code> (the main geizer object) gets disabled</li> <li><code>internaltransform[3]</code> (the spout of the main geizer object) gets disabled</li> <li><code>internaltransform[1]</code> (the frozen geizer object) gets enabled</li> <li><code>internaltransform[4]</code> (the spout of the frozen geizer object) gets enabled except if the current map is <code>UpperSnekGeizerRoom</code> where it is disabled</li> <li>The entity.<code>sound</code> is stopped and placed at the begining of the playback</li> <li>The <code>Freeze</code> sound is played at 0.5 volume</li> </ul> </li> <li>The <code>actioncooldown</code> gets set to <code>vectordata[0].z</code>, but if the Extra Freeze medal is equipped, the value is multiplied by 3 before assigning it</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#kabbu-collider-logic-while-the-geizer-is-frozen","title":"Kabbu collider logic while the geizer is frozen","text":"<ul> <li>The player entity <code>hitwall</code> is set to true</li> <li>The <code>actioncooldown</code> is set to 0.0</li> <li>GeizerBreak is called</li> <li>The <code>boxcol</code> is disabled if it is present</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#dropplet-cube-collider-logic-while-the-geizer-isnt-frozen","title":"Dropplet cube collider logic while the geizer isn't frozen","text":"<ul> <li>If the <code>moveobj</code> is present (there was already a dropplet ice cube on the geizer):<ul> <li>LaunchObject is called with it using a random vector between (-5.0, -10.0, 0.0) and (5.0, 10.0, 0.0) </li> <li>ServerGeizer is called onm the <code>moveobj</code> Hornable which setups the cube to be on the geizer snapped to it</li> </ul> </li> <li>The RigidBody of the other's parent gets its velocity zeroed out without gravity in kinematic mode</li> <li>The parent of the other dropplet is set to <code>internaltransform[0]</code> (The main geizer object)</li> <li><code>moveobj</code> is assigned to the other dropplet</li> <li>The <code>ingeizer</code> of the <code>moveobj</code>'s Hornable gets set to this <code>Geizer</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#player-or-player-follower-collider-logic","title":"Player or player follower collider logic","text":"<p>The other gameObject gets rooted to the scene.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>If the NPCControl passed has this type, it returns true which allows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#mainmanagerrefreshentities","title":"MainManager.RefreshEntities","text":"<p>This logic only matters if the method was called as a result of MapControl.Start, MapControl.RefreshInsides and BattleControl.ReturnToOverworld.</p> <p>If <code>hit</code> is true and <code>internaltransform</code> is not empty, all ParticleSystem under <code>internaltransform[3]</code> (the spout at the bottom of the main geizer's object) are played.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#geizerbreak","title":"GeizerBreak","text":"<p>This is a private method that only applies to this object type and its job is to shatter a frozen geizer.</p> <ul> <li>The <code>IceBreak</code> sound clip is played at the geizer position + Vector3.Up at 0.75 volume</li> <li><code>IceShatter</code> particles are played at (the geizer x position, 0.0 - entity.<code>startpos</code> - 0.45, the geizer z position - 0.5) and the scale of those particles is set to (2.0, 3.0, 1.0)</li> <li>For all playerdata entities, if any was childed to any transform under this geizer, the entity gets rooted to the scene</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Geizer/#effects-of-the-platformnoclock-tag","title":"Effects of the <code>PlatformNoClock</code> tag","text":"<p>The same than PathPlatform except of course, the player entities <code>noclock</code> is always false so mostly the childing logic remains. In additiona however, it's what allows Dropplet ice cube to be childed to the geizer via their Hornable component when the ice cube collides with the geizer.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/","title":"Item","text":"<p>A collectable item, medal or crystal berry bound to a crystalbfflags slot whose item id is the entity.<code>animid</code> field. This extends the logic of an item entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The item type. NOTE: if the <code>animid</code> is a money item id (<code>MoneySmall</code>, <code>MoneyMedium</code> or <code>MoneyBig</code>), this should always be 0 or 1 (standard or key item) because if it's not, the collection logic won't work as expected</li> <li><code>data[1]</code>: If it's not negative, an event id that will be processed in an event command at the end of the input string when collecting the item. This is optional, nothing happens if it doesn't exist</li> <li><code>data[2]</code>: If it's not 0, the item cannot be caught using the player <code>beemerang</code>. This is optional, the item can be caught if it doesn't exist.</li> <li><code>data[3]</code>: The crystalbfflags slot if applicable (the <code>animid</code> is 3)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#additional-data","title":"Additional data","text":"<ul> <li><code>activationflag</code>: If <code>data[0]</code> isn't 3 (it's not a Crystal Berry) and the value is above 0, the flag whose slot is the value will be set to true when collecting the item</li> <li><code>regaionalflag</code>: If <code>data[0]</code> isn't 3 (it's not a Crystal Berry) and the value isn't negative, the regionalflag whose slot is the value will be set to true when collecting the item</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#hashiddenitem","title":"HasHiddenItem","text":"<p>For an entity.<code>animid</code> of 1 or 2 (key item or medal), the return value is the <code>activationflag</code> being positive and the coresponding flag slot being false.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#mapcontrolcreateentities","title":"MapControl.CreateEntities","text":"<ul> <li>entity.<code>animstate</code> is set to the entity.<code>animid</code></li> <li>entity.<code>animid</code> is set to <code>data[0]</code></li> <li>entity.<code>item</code> is set to true (this makes it an item entity)</li> <li>entity.<code>sprite</code> local position is set to (0.0, 0.5, 0.0)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#entitycontrolcreateitem","title":"EntityControl.CreateItem","text":"<p>This is a special way to create an EntityControl that will also give it this object type and set it as an item entity. It's a public static method on EntityControl meaning it can be called by anyone to create an item object out of thin air. It returns the newly created NPCControl and it takes in the starting position, the item type, the item id, the starting velocity and the amount of time in frames this should be collectable.</p> <p>The very first thing this does is call CreateNewEntity with the name <code>tempitem</code> and add an NPCControl to it.</p> <p>The rest is logic specific to CreateItem:</p> <ul> <li><code>objecttype</code> is set to <code>Item</code></li> <li><code>entitytype</code> is set to <code>Object</code></li> <li>entity.<code>item</code> is set to true making it an item entity</li> <li>entity.<code>animid</code> is set to the item type</li> <li>entity.<code>animstate</code>, entity.<code>itemstate</code> and entity.<code>basestate</code> are all set to the item id</li> <li><code>touchcooldown</code> is set to 30.0 (prevents to pickup the item in the first 30.0 frames)</li> <li>All collisions between entity.<code>ccol</code> and player.entity.<code>ccol</code> are ignored (the item will rely on the <code>secondcoll</code> created later)</li> <li>The position and entity.<code>startpos</code> are set to the starting position</li> <li>The NPCControl gets childed to the map</li> <li><code>insideid</code> is set to the current one</li> <li><code>timer</code> is set to the timer sent</li> <li><code>tempobject</code> is set to true (prevents the Crystal Berry SetUp logic from applying as this method already does it partially and EntityControl's startup will do the rest via CheckSpecialID) </li> <li><code>data[0]</code> is set to the item type</li> <li><code>bounces</code> is set to 0</li> <li>entity.<code>onground</code> is set to true</li> <li>entity.<code>startvelocity</code> is set to the starting velocity</li> <li>If the item type is 3 (Crystal Berry), <code>data[0]</code> is overriden to be the item id instead (which simulates how this happens normally with <code>data[3]</code>) and entity.<code>animid</code> is set to 43 (<code>CrystalBerry</code>)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#start","title":"Start","text":"<p>Normally, any objects has their entity.<code>ccol</code> disabled on Start, but this one is an exception: it remains enabled.</p> <p>Also, just like <code>SemiNPC</code> items, no changes to the entity.<code>rigid</code> mass happens so it is left to 1.0.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#setup","title":"SetUp","text":"<ul> <li>entity.<code>onground</code> is set to false</li> <li>entity.<code>alwaysactive</code> is set to true</li> <li>entity.<code>ccol</code> bounciness is set to 0.75</li> <li>The layer is set to 0 (default)</li> <li>All collisions between entity.<code>ccol</code> and these entity's <code>ccol</code> are ignored:<ul> <li>Objects with tag <code>PFollower</code></li> <li>Any other Item objects (excludes <code>SemiNPC</code>)</li> <li>Any playerdata except the first one</li> </ul> </li> </ul> <p>If the entity.<code>animid</code> is 3 (which means it's a crystal berry) and <code>tempobject</code> is false, then this is setup as a crystal berry which starts by setting <code>data[0]</code> to <code>data[3]</code> (meaning <code>data[0]</code> is now the Crystal Berry id which is fine because entity.<code>animid</code> already tells it's a Crystal Berry). If it was obtained (the id is contained in <code>data[3]</code>), then the entity.<code>iskill</code> is set to true. Otherwise, adjustements on the entity are performed:</p> <ul> <li>entity.<code>animstate</code> is set to the <code>regionaflag</code> NOTE: this is likely an error, but it doesn't matter because the crystalbfflags slot is already saved in <code>data[0]</code> and it is that value that will be used</li> <li>entity.<code>sprite</code> local position is set to Vector3.zero</li> <li>AddModel is called with path <code>Prefabs/Objects/CrystalBerry</code> without offset</li> <li>entity.<code>spin</code> is set to (0.0, 2.0, 0.0)</li> <li>entity.<code>item</code> is set to true which makes it an item entity</li> <li>entity.<code>rigid</code> gravity is enabled</li> </ul> <p>AddPlayerTrigger is called which will initialise <code>secondcoll</code> to a new trigger CapsuleCollider with the same properties than the entity.<code>ccol</code> and ignores all collisions between the player.entity.<code>ccol</code> and the entity.<code>ccol</code>.</p> <p>Just like <code>SemiNPC</code> items, the <code>colliderheight</code> is set to 1.0 and the entity.<code>ccol</code> center to (0.0, 0.5, 0.0). This reduces the height of the collider to more snuggly fit the item shape.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#update-active-and-not-trapped","title":"Update (active and not <code>trapped</code>)","text":"<p>This section applies for any item entity, but it effectively apply to this object type. Unlike <code>SemiNPC</code> items however, this gets the full version of the logic.</p> <p>If the <code>beerang</code> isn't null (meaning the beemerang caught this item), the following occurs:</p> <ul> <li>The <code>timer</code> is set to 300.0 if it was -1</li> <li>The absolute position is set to the <code>beerang</code> one + Vector3.Up</li> <li>The entity's Unifx gets called if it was a <code>fixedentity</code></li> </ul> <p>All collisions gets ignored between the <code>secondcoll</code> and the player.entity.<code>ccol</code> if the player is present and the <code>touchcooldown</code> hasn't expired yet. Otherwise, if the <code>touchcooldown</code> isn't exactly -9999.0, the collisions gets unignored and <code>toochcooldown</code> gets set to -9999.0 (so it doesn't unignore again). If neither happened, the entity.<code>ccol</code> is enabled.</p> <p>If the entity.<code>onground</code> is true, Jump is called on it with the absolute value of its current <code>rigid</code> y velocity. It will also increment <code>bounces</code> if it hasn't reached 3 yet on top of playing the <code>ItemBounce0</code> sound effect (or <code>ItemBounce1</code> if it's a Crystal Berry) if the <code>startlife</code> is above 15 frames.</p> <p>If by then, <code>bounces</code> has reached 3, StopForceMove is called on the entity.</p> <p>If the entity.<code>sprite</code> is present, then the <code>timer</code> logic proceeds:</p> <ul> <li>If the <code>timer</code> has yet to expire and we aren't in a <code>minipause</code> or <code>pause</code>, the timer is decremented according to the frametime, but it is clamped from 0.0 to infinity. Otherwise, if the <code>timer</code> expired, this GameObject gets destroyed</li> <li>If the <code>timer</code> is between -1.0 and 100.0 exclusive and we aren't in a <code>minipause</code> or <code>inevent</code>, the entity.<code>sprite</code> enablement gets toggled. Otherwise, the entity.<code>sprite</code> is enabled. This logic blinks the sprite when less than 100 frames are left on the <code>timer</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#ontriggerenter-if-the-other-collider-is-the-player","title":"OnTriggerEnter if the other collider is the player","text":"<p>If we aren't in a <code>pause</code> or <code>minipause</code>, the <code>insideid</code> matches the current one and the <code>timer</code> is exactly -1.0 or above 1.0, a CheckItem coroutine is started and <code>collisionammount</code> is incremented.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#ontriggerenter-main-segment","title":"OnTriggerEnter main segment","text":"<p>The <code>beerang</code> is set to the other transform if all of the following are true (this makes the <code>Beemerang</code> catch the item):</p> <ul> <li>The other gameObject tag is <code>BeeRang</code> (meaning the other collider is the Beemerang)</li> <li><code>data[2]</code> is either not present or it is and it's value is 0 (meaning it's a standard item)</li> <li><code>beerang</code> was null (the <code>Beemerang</code> didn't already caught an item)</li> <li>We aren't in a <code>pause</code>, or <code>minipause</code> and message is released</li> <li>The player <code>beemerang</code> is present and its <code>hit</code> is false (it's on the first half of its path)</li> <li><code>insideid</code> matches the current one</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#ontriggerstay-when-the-npccontrol-is-a-jumpspring","title":"OnTriggerStay (when the NPCControl is a JumpSpring)","text":"<p>If the other collider is an item entity and is an Object (which can only happen with this object type under normal gameplay), the item is allowed to move upward using the spring if its <code>data[0]</code> is 0 or its <code>data[1]</code> is 1 and the additional check it provides is fufilled.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#checkitem","title":"CheckItem","text":"<p>This is a private coroutine that is only involved with this object type. Its job is to setup and confirm that the item can be collected followed by a bunch of logic performing the actual collection of the item.</p> <ul> <li>The game determines if this is a special currency item. This is the case if entity.<code>animstate</code> (the item id) is 6 (<code>MoneySmall</code>), 7 (<code>MoneyMedium</code>) or 186 (<code>MoneyBig</code>). This will be used for many checks later</li> <li>All frames are yielded while we are in a <code>pause</code> or <code>minipause</code> and <code>hit</code> is false (the item isn't collected). This never happens under normal gameplay because the caller (OnTriggerEnter) already makes sure that we aren't in a <code>pause</code> or <code>minipause</code></li> <li>CancelAction is called on the player for anything other than standard money items</li> <li>instance.<code>itempicked</code> is set to true (controls some logic related to JumpSpring objects and Shop / CaravanBadge interactions)</li> <li>If it's not a money item, player.entity.<code>icooldown</code> is set to 0.0 (removes any invicibily frames)</li> <li><code>hit</code> is set to true (indicating the item is being collected)</li> <li><code>tossed</code> is set to false</li> <li>The current player.entity.<code>flip</code> is saved locally as it may be restored later</li> <li>All collisions between the item entity and the player.entity are ignored for any colliders</li> <li>The item collection occurs if the <code>touchcooldown</code> expired, the item isn't <code>trapped</code> and we aren't in a <code>minipause</code>. NOTE: this seems like a bug because if we don't collect here, the colliders aren't unignored, but in practice, MainManager.IgnoreColliders doesn't work correctly meaning this isn't an issue in practice. See the sections below for more details. The collection logic depends on if the item is a standard or key money item.</li> <li>instance.<code>itempicked</code> is set to false</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#standard-or-key-money-items-collection","title":"Standard or key money items collection","text":"<ul> <li>The regionaflag whose slot is <code>regionalflag</code> is set to true if it wasn't negative</li> <li>The flag whose slot is <code>activationflag</code> is set to true if it was above 0</li> <li><code>touchcooldown</code> is set to 999999.0</li> <li>instance.<code>money</code> is incremented by the amount the item is worth in currency (1 for <code>MoneySmall</code>, 5 for <code>MoneyMedium</code> and 20 for <code>MoneyBig</code>)</li> <li>instance.<code>showmoney</code> is set to 150.0 frames which shows the berry count HUD temporarily</li> <li>The <code>Money</code> sound is played</li> <li>entity.<code>spin</code> is set to (0.0, 30.0, 0.0)</li> <li>A BerryBounce coroutine is started. This just renders the visual effect of collecting the berry by making its sprite go up and scale down</li> <li><code>dummy</code> is set to true (disables most update cycles logic as BerryBounce needs some time before destroying the item so most updates needs to not run while this happens)</li> <li>instance.<code>money</code> is clamped from 0 to 999</li> <li>entity.<code>iskill</code> is set to true</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#any-non-money-items-collection","title":"Any non money items collection","text":"<p>This logic is quite complex and has different behaviors depending on the entity.<code>animid</code> and entity.<code>animsate</code>.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#hold-the-player-until-they-get-onground","title":"Hold the player until they get <code>onground</code>","text":"<p>The logic first starts to handle the case where the player is still in the air:</p> <ul> <li>player.<code>lockkeys</code> is set to true (disable most input processing on PlayerControl)</li> <li>As long as player.entity.<code>onground</code> is false:<ul> <li>player.entity.<code>rigid</code> x/z velocity is zeroed out</li> <li>instance.<code>minipause</code> is set to true</li> <li>The position of the item is set to offscreen at (0.0, 999.0, 0.0)</li> <li>If we have been on this yield loop for 300.0 frames or more, we force exit it by setting the player position to its <code>lastpos</code> with DeathSmoke particle playing at the player position</li> <li>A local framecounter is incremented by <code>framestep</code> which only takes effect once it reaches 300.0 as outlined in the step above</li> <li>A frame is yielded</li> </ul> </li> <li>player.<code>lockkeys</code> is set to false (unlocks most input processing of PlayerControl)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#item-collection-perparation","title":"Item collection perparation","text":"<p>From there, the actual item collection can now take place:</p> <ul> <li><code>beerang</code> is set to null (detaches the item off the Beemerang if it was attached)</li> <li>entity.<code>spin</code> gets zeroed out</li> <li>entity.<code>sprite</code> angles gets set to Vector3.zero</li> <li>CancelAction is called on the player</li> <li>entity.<code>ccol</code> gets disabled</li> <li>entity.<code>rigid</code> gets its gravity disabled with all constraints frozen</li> <li>The item gets childed to the player.entity.<code>sprite</code> with a local position of (0.0, 2.25, -0.1)</li> <li>flagvar 0 gets set to entity.<code>animstate</code> (the item id)</li> <li>A <code>guisprites[85]</code> (star shaped back icon) gets created with name <code>back</code> childed to entity.<code>sprite</code> with the same material as entity.<code>sprite</code> without angles with local position (0.0, 0.0, 0.2) with scale of Vector3.zero with a DialogueAnim and layer 14 (<code>Sprite</code>)</li> <li>flagstring 1 gets set to <code>menutext[125]</code> (<code>a</code>).</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#item-type-specifics","title":"Item type specifics","text":"<p>What happens next depends on entity.<code>animid</code> (the item type) and it mainly sets the <code>back</code> material color, sets <code>flagstring</code> 0, <code>flagstring</code> 1 and other exclusive logic to an item type:</p> <ul> <li>0 or 1 (standard or key item): <ul> <li><code>flagstring</code> 0 is set to the name and <code>flagstring</code> 1 to the prepender of the corresponding item defined in items data using the entity.<code>animstate</code> as the item id. </li> <li>It also sets the <code>back</code>'s material color to 00B2B2 (cyan) if it's a standard item, FF4C66 (bright red) if it's a key item</li> </ul> </li> <li>2 (medal):<ul> <li>If <code>flags</code> 681 (MYSTERY? is enabled) and entity.<code>animstate</code> isn't 59 (it's not <code>Extra Freeze</code>) or it is, but <code>flags</code> 696 (MYSTERY? file started on 1.1.x) is false:<ul> <li>The next mystery medal id is obtained and the value is set to entity.<code>basestate</code>, entity.<code>itemstate</code>, entity.<code>animstate</code> and <code>flagvar</code> 0</li> <li>entity.<code>overridemovesmoke</code> is set to true and UpdateItem is called on the entity (to ensure the actual sprite gets updated)</li> </ul> </li> <li>The <code>back</code> material color gets set to FF7F00 (bright orange)</li> <li><code>flagstring</code> 0 is set to a string obtained from taking <code>menutext[268]</code> and replacing <code>i</code> by the corresponding medal name from medal data using entity.<code>animstate</code> as the medal id and by replacing <code>m</code> by <code>menutext[159]</code> (<code>Medal</code>)</li> <li><code>flagstring</code> 1 is set to the corresponding prepander from medal data using entity.<code>animstate</code> as the medal id</li> </ul> </li> <li>3 (Crystal Berry):<ul> <li>The <code>back</code> local position is set to (0.0, 0.5, 0.0) and its material color to cyan</li> <li>entity.<code>model</code> y scale is set to 0.1</li> <li>crystalbfflags whose slot is <code>data[0]</code> (used to be <code>data[3]</code> which is the slot number) is set to true</li> <li><code>flagstring</code> 0 is set to <code>menutext[112]</code> (<code>Crystal Berry</code>)</li> <li><code>flagvar</code> 14 (amount of Crystal Berries obtained) gets incremented</li> </ul> </li> </ul> <p>After this, for any type other than Crystal Berry, CreateDescWindow without shop is called.</p> <p>For any type, the <code>ItemGetX</code> sound is played where X is the entity.<code>animid</code> (the item type).</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#settext-call","title":"SetText call","text":"<p>The next portion setups a SetText call to actually receive the item. The SetText string is built with the following concatenated in order:</p> <ul> <li><code>|lockmovement||boxstyle,4||halfline||spd,0||anim,-1,4||center|</code></li> <li><code>menutext[2]</code> (<code>You found |string,1| |color,1||string,0||color,1|!</code>)</li> <li><code>|stopskip||fwait,0.45||break|</code></li> <li>If it's not a Crystal Berry and <code>activationflag</code> is above 0, <code>|flag,activationflag,true|</code> is appended</li> <li>If it's not a Crystal Berry and <code>regionalflag</code> is not negative, <code>|regionalflag,regionalflag,true|</code> is appended</li> <li><code>|additemtoss,</code></li> <li>entity.<code>animid</code> (the item type)</li> <li><code>,var,0|</code></li> <li>If <code>flags</code> 31 is false and it's a medal (haven't received the medal tutorial while getting one), <code>|flag,31,true||tail,null||center,true||destroydescbox||goto,-32,break,end|</code> is appended</li> <li>If <code>flags</code> 108 is false and it's a Crystal Berry (haven't received the Crystal Berry tutorial while getting one), <code>|flag,108,true||tail,null||center,true||destroydescbox||goto,-88,break,end|</code> is appended</li> <li>If <code>data[1]</code> exists and isn't negative, <code>|event,</code> + <code>data[1]</code> + <code>|</code> is appended (a break command appears before the event one if any of the tutorial strings were appended)</li> </ul> <p>SetText is called with the generated string in dialogue mode:</p> <ul> <li>fonttype of <code>BubblegumSans</code></li> <li>linebreak of instance.<code>messagebreak</code></li> <li>No tridimensional</li> <li>No position offset</li> <li>No camera offset</li> <li>Size of Vector2.one</li> <li>No parent</li> <li>This NPCControl as the caller</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#settext-yield","title":"SetText yield","text":"<p>This is the final part part of the collection phase:</p> <ul> <li><code>timer</code> is set to -1 (so it never times out)</li> <li>entity.<code>overrideflip</code> is set to true</li> <li>As long as the message lock is active:<ul> <li>player.entity.<code>flip</code> is set to the value it had before this entire collection phase at the start of CheckItem</li> <li>player.entity.animsate is set to 4 (<code>ItemGet</code>)</li> <li>A frame is yielded</li> </ul> </li> <li>If the item isn't <code>tossed</code> (it is only when additemtoss concluded the player wanted to toss the item), this gameObject is destroyed</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#entitycontrollatestart","title":"EntityControl.LateStart","text":"<p>Any object of this type will have CreateFeet called which gives the entity a ground detector in the <code>feet</code> field.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>If the NPCControl passed has this type, it returns true which allows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Item/#settext","title":"SetText","text":"<p>This object type affects SetText if it's the caller:</p> <ul> <li>In an end command, if the caller is an <code>Item</code>, Death is called on the entity</li> <li>In the cleanup phase, if the caller is an object of this type and its <code>hit</code> is true (meaning it's been collected), its gameObject is destroyed.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/","title":"JumpSpring","text":"<p>A spring that makes an entity jump up high via Jump when touched or makes the entity jump straight to a specific point via JumpTo with the option to trigger an inside transition via a DoorSameMap present on the map without physically moving the player.</p>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: If 1, the spring will make an entity jump to <code>vectordata[1]</code> via JumpTo when an entity touches the spring. Otherwise, the spring will make the entity jump up high when touched via Jump </li> <li><code>data[1]</code>: If 1, jumps are only performed when the entity touching the spring isn't <code>onground</code> and its <code>rigid</code> y velocity is negative (meaning, the entity must be falling onto the spring from the air above). If 0, this check is disabled, any other value is considered invalid and will prevent any jumps to be performed when touching the spring</li> <li><code>data[2]</code>: If not negative and <code>data[0]</code> is 1, this is a map entity id corresponding to a DoorSameMap that will be triggered when the spring jump occurs</li> <li><code>vectordata[0].x</code>: The height of the jump. If <code>data[0]</code> is 0, this must be above 1.0 or it will be overriden to the default <code>jumpheight</code> of the entity that collides with this object</li> <li><code>vectordata[1]</code>: The position to jump to when touched if <code>data[0]</code> is 1</li> <li><code>vectordata[2].x</code>: If <code>data[0]</code> is 1, the jump multiplier clamped from 1.0 to 99.0. This is optional, if it doesn't exist, the default is 1.0.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#additional-data","title":"Additional data","text":"<ul> <li><code>boxcol</code>: Required to be present with valid data</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>activeonpause</code> is set to true</li> <li><code>internalvector</code> is initialised to 2 elements with the first being <code>boxcol</code>.center and the second being (0.0, 555.0, 999.0) which is an offscreen position.</li> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity and with all constraints frozen</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#update","title":"Update","text":"<p>The <code>boxcol</code>.center is set to the first <code>internalvector</code> (the original <code>boxcol</code>.center) if the instance's <code>itempicked</code> is false or to the second one (the offscreen position) if it's true. This just places the <code>boxcol</code>.center at an hardcoded offscreen position if we are in the process of a CheckItem.</p>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of the following are true:</p> <ul> <li>We are in a <code>pause</code></li> <li>The current map is <code>RubberPrisonGym</code> while the other gameObject y position is not higher than this object y position</li> <li>The other gameObject is the player and it is not free (ignoring fly)</li> </ul> <p>The entity.<code>overrideflip</code> is set to true and the other gameObject's entity is obtained.</p> <p>For an actual jump to be registered on the spring, the following must all be true:</p> <ul> <li>The other entity exists </li> <li>The other entity is not <code>iskill</code></li> <li><code>data[1]</code> is 0 or <code>data[1]</code> is 1 and the other entity isn't <code>onground</code> and its <code>rigid</code> has a negative y velocity</li> <li>The other entity <code>npcdata</code> doesn't exist or it does, but it's not an <code>Object</code> or the entity is an item entity</li> </ul> <p>Otherwise, if the other gameObject tag is <code>BeetleHorn</code>, <code>BeetleDash</code> or <code>Icecle</code> the logic is limited to redoing a call to <code>BounceAnim</code> (stopping entity.<code>bounceanim</code> if it was in progress, but reassigning it to a new call). The call happens on the entity with a push amount of 1.2, a time of 50.0 frames and a squash speed of 0.2 all done gradually. This visually renders a bouncy spring, but it won't move the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#spring-jump-logic","title":"Spring jump logic","text":"<p>If the other gameObject is the player and the distance between it and this object is less than 10.0, the <code>Boing0</code> sound is played at 0.75 volume.</p> <p>From there, the logic differs depending on <code>data[0]</code>. At the end of either branch, <code>BounceAnim</code> is called on the entity (stopping entity.<code>bounceanim</code> if it was in progress, but reassigning it to a new call). The call is done with a push amount of 1.2, a time of 50.0 frames and a squash speed of 0.2 all done gradually. It only makes the spring visually jump.</p>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#data0-is-1-jumpto-logic","title":"<code>data[0]</code> is 1 (JumpTo logic)","text":"<p>If the other gameObject is the player, nothing happens here if the <code>collisionammount</code> is 100 or above (meaning we already entered this since the last LateUpdate). If it's less than 100 however:</p> <ul> <li>The player position is set to this object position + (0.0, 0.75, 0.0)</li> <li>JumpTo is called on the player with the position being <code>vectordata[1]</code>, the height being <code>vectordata[0].x</code> and the multiplier being 1.0 unless <code>vectordata[2].x</code> exists which will make it be the multiplier instead clamped from 1.0 to 99.0.</li> <li>If <code>data[2]</code> isn't negative, MoveInside will be called on the map with the NPCControl that resolves to the map entity id of <code>data[2]</code> as the caller without move (this implies that NPCControl is a DoorSameMap)</li> <li><code>collisionammount</code> is set to 110.0 (which prevents to reenter this branch until the end of the next LateUpdate)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#data0-isnt-1-jump-logic","title":"<code>data[0]</code> isn't 1 (Jump logic)","text":"<ul> <li>The other entity.<code>springcooldown</code> is set to true</li> <li>The other entity.<code>jumpcooldown</code> is set to 30.0</li> <li>If the other gameObject is the player, CancelAction is called on the player keeping the beemerang. On top of this, if <code>itempicked</code> is true (we are in a CheckItem process), the player entity.<code>onground</code> is set to true</li> <li>Unless we set.<code>onground</code> to true earlier, the following occurs:<ul> <li>The entity.<code>springcooldown</code> is set to true</li> <li>Jump is called on the other entity with the height being its <code>jumpheight</code> unless <code>vectordata[0].x</code> is above 1.0 and the other doesn't have an <code>npcdata</code> that is a RollingRock where <code>vectordata[0].x</code> is used as the height instead</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/JumpSpring/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>If the NPCControl passed has this type, it returns true which allows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/MusicRange/","title":"MusicRange","text":"<p>A spherical radius that when the player enters it, changes the current music playing. The music, amount of frames to wait between distance checks, radius, rate of volume change and max volume are configurable.</p>"},{"location":"Entities/NPCControl/ObjectTypes/MusicRange/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: OVERRIDEN (to the value of <code>data[1]</code>, serves as an internal cooldown to throttle distance checks with <code>vectordata[0]</code>.x)</li> <li><code>data[1]</code>: The amount of frames to wait between distance changes of the player and <code>vectrodata[0].x</code></li> <li><code>data[2]</code>: The Music id this is changing to</li> <li><code>data[3]</code>: If it's not -1, the music range Updates are disabled which disables any effects</li> <li><code>vectordata[0].x</code>: The max radius of this range relative to its position that will change the music if the player goes within it and change it back it goes outside of it</li> <li><code>vectordata[0].y</code>: The rate of the music fading in or out, between 0.0 and 1.0 (it's a volume lerp factor)</li> <li><code>vectordata[0].z</code>: The max volume multiplier when fading in the music</li> <li><code>vectordata[1]</code>: OVERRIDEN. The x to 0.0 and the y / z to the end and begin loop points respectively of the music whose id is <code>data[2]</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/MusicRange/#createentities","title":"CreateEntities","text":"<p>The <code>musicrangeanim</code> of the map is set to the map entity id being created here. This means the last music range defined in the map will be allowed control the volume of the main music playing in that music range's Update.</p>"},{"location":"Entities/NPCControl/ObjectTypes/MusicRange/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> <li>entity.<code>activeonpause</code> is set to true</li> <li><code>data[0]</code> is overriden to <code>data[1]</code></li> <li>entity.<code>sound</code> properties are initialised:<ul> <li>The clip is set to one loaded using the Music's name at id <code>data[2]</code></li> <li>The volume to 0.0</li> <li>The loop to true</li> <li>Play is called on it</li> </ul> </li> <li><code>vectordata[1]</code> is overriden to have its x be 0.0 and its y / z be the end and begin loop points respectively of the corresponding music data whose music id is <code>data[2]</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/MusicRange/#update","title":"Update","text":"<p>Updates are disabled if <code>data[3]</code> exists and isn't -1.</p> <p>The temporary field <code>data[0]</code> serves as a frame countdown initialised from <code>data[1]</code>. It decrements each update with the <code>hit</code> (whether or not the player is in the music range) staying at false until it goes to 0. When that happens, a distance check is peformed with this music range's position and the player's. If the distance is less than <code>vectordata[0].x</code>, then <code>hit</code> is set to true, false otherwise. </p> <p>When <code>hit</code> is true, <code>inmusicrange</code> is set to the <code>mapid</code> and a CheckSamira is perfomed to add the song to her list when applicable. </p> <p>When <code>hit</code> is false, <code>inmusicrange</code> is set to -1 if it was the <code>mapid</code>. In either case, the <code>data[0]</code> countdown is reset to <code>data[1]</code> and this cycle repeats for each update.</p> <p>No matter what, some more logic follows. If the <code>inmusicrange</code> is <code>mapid</code> by then (we need to play the music) and the entity's <code>sound</code> isn't playing, Play is called on it.</p> <p>The volume is set to be a lerp from the existing entity.<code>sound</code> volume to either 0.0 if we aren't playing or to the appropriate game volume settings * <code>vectordata[0].z</code> with a factor of <code>vectordata[0].y</code>.</p> <p>If the current map's <code>musicrangeinanim</code> is the <code>mapid</code> (meaning this is the music range that is allowed to control the main music volume), the first <code>music</code>'s volume is set using a lerp from its exiting volume to either the musicvolume if we aren't playing the song or to 0.0 if we are with a factor of <code>vectordata[0].y</code>. This does the opposite of what we would have done to the song volume by fading out the main music if it's playing or to fade it in if the music is to stop playing.</p>"},{"location":"Entities/NPCControl/ObjectTypes/MusicRange/#fixedupdate","title":"FixedUpdate","text":"<p>This is the only object type with logic in FixedUpdate.</p> <p>If the entity.<code>sound</code> is playing and the playback time reached <code>vectordata[1].y</code> (the music end loop point) or further, the playback time will be set to <code>vectordata[1].z</code> (the music begin loop point).</p>"},{"location":"Entities/NPCControl/ObjectTypes/MusicRange/#entitycontrollateupdate","title":"EntityControl.LateUpdate","text":"<p>For any inactive LateUpdates, objects of this type aren't allowed to have their <code>sound</code> volume set to 0.0</p>"},{"location":"Entities/NPCControl/ObjectTypes/MusicRange/#entitycontrolupdatesound","title":"EntityControl.UpdateSound","text":"<p>The entire logic from this update method is excluded for any objects of this type. Combined with the LateUpdate exclusion mentioned above, it means this object cannot perform any entity LateUpdate sounds logic.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/","title":"PathPlatform","text":"<p>A platform that moves on a set path defined by multiple absolute position vectors called nodes and can conditionally be stopped depending on the <code>hit</code> value of other NPCControl present on the map. Can be operated in loop mode using only 2 nodes or with multiple nodes in path mode with more options.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data</code>: The map entities ids to check for their <code>hit</code> being true and if any are, it will tell the platform to set its <code>hit</code> to true and to start moving along its path in path mode. This is optional, the platform is considered as continually moving as normal without any elements</li> <li><code>vectordata</code>: The nodes the platform will travel in absolute positioning</li> <li><code>dialogues[0].x</code>:The meaning depends on the mode:<ul> <li>In path mode, this is the starting node after truncating to int</li> <li>In loop mode, this is the starting <code>speedmultiplier</code> (the starting node index) after truncating to int. This means only [0.0, 2.0[ are valid values</li> </ul> </li> <li><code>dialogues[0].y</code>: The speed multiplier at which the platform moves.</li> <li><code>dialogues[1].x</code>: if it's 1, it means to place the platform in loop mode by only using the first 2 <code>vectordata</code> and disregard the <code>currentnode</code> logic</li> <li><code>dialogues[1].y</code>: The <code>actioncooldown</code> to apply when the platform has reached the end of its path and it should go inactive.</li> <li><code>dialogues[2].x</code>: The local scale of the entity.<code>model</code> will be multiplied by the 1/10 of this, but this is optional and the scale will not change if it is 0.1 or below</li> <li><code>dialogues[2].y</code>: If not 0, the <code>electime</code> of the GlowTrigger when the entity.<code>originalid</code> is the  <code>ElectroPlatform</code> AnimID. This is optional and the value defaults is 260.0</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#additional-data","title":"Additional data","text":"<ul> <li><code>speedmultiplier</code>: OVERRIDEN (this is used as a value between 0.0 and 1.0 that represents the lerp factor of the platform position between 2 nodes as it moves)</li> <li><code>boxcol</code>: If entity.<code>originalid</code> is the <code>Lilypad</code> AnimID, the <code>boxcol</code> is created manually, but it doesn't remove the existing one meaning under these circumstances, the entity shouldn't be specified that it has one since it would make it so there's 2 <code>boxcol</code> with the loaded version not being accessible by the game</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#setup","title":"Setup","text":"<ul> <li>entity.<code>rigid</code> gets effectively locked by disabling gravity, making it kinematic and freezing all constraints</li> <li>isStatic on the gameObject is set to false</li> <li><code>nointeract</code> is set to true</li> <li>entity.<code>soundonpause</code> is set to true</li> <li>entity.<code>model</code> scale is multiplied by a 1/10 of <code>dialogues[2].x</code></li> <li>If <code>dialogues[1].x</code> is 1 (loop mode) and <code>dialogues[0].x</code> is 1 (the starting node is the second one), the <code>speedmultiplier</code> is set to 1.0</li> <li>If <code>dialogues[1].x</code> is 0 (path mode):<ul> <li><code>currentnode</code> is set to <code>dialogues[0].x</code></li> <li>The position is set to the <code>vectordata</code> at the <code>currentnode</code></li> <li>entity.<code>startpos</code> is set to the new position</li> </ul> </li> <li>If the entity.<code>originalid</code> is the <code>Lilypad</code> AnimID:<ul> <li>The <code>scol</code> is disabled</li> <li>the <code>boxcol</code> is recreated with trigger and a size of (5.0, 1.0, 5.0) which overrides all the <code>boxcol</code> fields obtained when loading the data.</li> </ul> </li> <li>entity.<code>alwaysactive</code> is set to true</li> <li>entity.<code>model</code> tag is set to <code>PlatformNoClock</code></li> <li>If entity.<code>originalid</code> is the <code>ElectroPlatform</code> AnimID, a GlowTrigger is added on the first child of the <code>model</code>:<ul> <li><code>getactivecolorfromstart</code> is set to true</li> <li><code>parent</code> is set to this NPCControl</li> <li><code>glowparts</code> is initialised to a single element corresponding to the MeshRenderer of the first child of the <code>model</code></li> <li><code>electime</code> is initialised to 260.0 unless <code>dialogues[2].y</code> exists and isn't 0 where it will take that value instead</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#update","title":"Update","text":"<p>If entity.<code>originalid</code> is the <code>Lilypad</code> AnimId, the <code>boxcol</code> if present is kept enabled, otherwise, its enabled will bet set to the <code>hit</code> value.</p> <p>From there, the platform can operate in 2 distinct modes: forever loop between the first 2 <code>vectordata</code> where the current one is tracked by <code>speedmultiplier</code> or follow a series of nodes defined in <code>vectordata</code> where the current one is tracked by <code>currentnode</code>. The former is done if <code>dialogues[1].x</code> is 1, the latter is done otherwise.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#loop-mode","title":"Loop mode","text":"<p>This is a much simpler mode where only the first 2 <code>vectordata</code> are used as nodes.</p> <p>In this mode, <code>hit</code> is set to true and it is never toggled back. This means the platform will continually move according to the <code>speedmultiplier</code> field which serves as the factor of the position lerp to perform between <code>vectordata[0]</code> and <code>vectordata[1]</code>.</p> <p>On the first update, if <code>dialogues[0].x</code> isn't negative (which it shouldn't be on the first Update), it will be the starting value of <code>speedmultiplier</code>. This is a one off: after setting the field, it is reset to -1. It should be noted that the value set is a cast to int meaning it can only be [0.0, 2.0[ which coresponds to the starting node chosen among the 2.</p> <p>The platform is considered active when either <code>data</code> is empty or any of its elements refers to a map NPCControl whose <code>hit</code> is true. If it is active, <code>speedmultiplier</code> gets incremented by the game's frametime * <code>dialogues[0].y</code> / 1000.0. If it's inactive, it gets decremented instead. Basically, the platform moves forward when active and backward when inactive.</p> <p>The position set portion starts by clamping <code>speedmultiplier</code> from 0.0 to 1.0 and then setting the position using a Vector3.Lerp from <code>vectordata[0]</code> to <code>vectordata[1]</code> with a factor of <code>speedmultiplier</code>.</p> <p>Unless entity.<code>originalid</code> is the <code>Lilypad</code> AnimId, <code>speedmultiplier</code> is below 1.0 and the entity.<code>sound</code> is playing, then PlaySound is called on the entity with the <code>PlatformMove</code> clip set to loop.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#path-mode","title":"Path mode","text":"<p>What happens each updates depends on the value of <code>hit</code> which gets toggled on and off in a very systematic manner. The details involves many different fields that interacts with each other:</p> <ul> <li><code>actioncooldown</code>: The cooldown used to stop movement whenever the platform reaches its last node AND it is considered deactivated. This is refreshed to be <code>dialogues[1].y</code> each time the platform goes to a new node with <code>hit</code> being set to true.</li> <li><code>speedmultiplier</code>: The factor to use when lerping the platform positions between nodes. It's set to 0.0 when going to a new node until it reaches 1.0+. It progressively increases by the frametime of the game * <code>dialogues[0].y</code> / 1000.0.</li> <li><code>bounces</code>: The previous node index visited which will be used as the <code>from</code> vector when lerping.</li> <li><code>currentnode</code>: The next node index to visit which will be used as the <code>to</code> vector when lerping.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#when-hit-is-false","title":"When <code>hit</code> is false","text":"<p>Before anything happens, the entity's <code>sound</code> is set to not loop and its <code>model</code> tag is set to <code>Platform</code>.</p> <p>The platform is considered active when either <code>data</code> is empty or any of its elements refers to a map NPCControl whose <code>hit</code> is true. When a platform is active, it will have its <code>hit</code> set to true on the first update in which it was false. This will cause the fields to be set in such a way that <code>bounces</code> will always lag behind by 1 from <code>currentnode</code> when going forward. When the platform reaches the end and it's still active, it will set <code>currentnode</code> to 0 which will make the platform go back to its starting point, but ignoring all the nodes, it simply moves straight towards the start and continues from there.</p> <p>But it is possible for the platform to go inactive during its forward path. When this happens, this is where the <code>actioncooldown</code> comes into play. It will be exhausted which will make the platform stationnary until it expires. When it does expire, if the platform's <code>currentnode</code> is higher than 0 (it's further than the starting node), it will decrement it, but have <code>bounces</code> be one node above. This essentially makes the platform go backwards from the nodes list, but following its movement path until the start (with cooldown applied) and it also sets <code>hit</code> to true.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#when-hit-is-true","title":"When <code>hit</code> is true","text":"<p>There is a special case before anything happens: whenever <code>hit</code> goes to true, it is possible that <code>currentnode</code> and <code>bounces</code> points to the same node. It can happen if there's only one node defined in <code>vectordata</code>. If this occurs, the update logic just ends abrutply because there is no need to move the platform and it will remain stationnary forever.</p> <p>The entity.<code>model</code> tag is set to <code>PlatformNoClock</code>. Unless entity.<code>originalid</code> is the <code>Lilypad</code> AnimId and the entity's <code>sound</code> is playing, then PlaySound is called on the entity with the <code>PlatformMove</code> clip set to loop.</p> <p>From there, this is where the movement is done until <code>speedmultipiler</code> reaches 1.0 or above in which case, it's reset to 0.0 and <code>hit</code> is set to false again.</p> <p>When moving the platform, the lerping using will be the standard Vector3.Lerp, but there is a special case if there's only 2 nodes in <code>vectordata</code>. When this happens, the game's SmoothLerp is used instead which is a much slower and spread out lerping procedure.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#ontriggerenter-if-the-other-collider-is-the-player","title":"OnTriggerEnter if the other collider is the player","text":"<p>There is some dead logic here where nothing happens, but the conditions are all of these being true:</p> <ul> <li>The current area is <code>WildGrasslands</code></li> <li>The entity <code>originalid</code> is the <code>Lilypad</code> animid</li> <li>The player entity is <code>onground</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>If the NPCControl passed has this type, it returns true which allows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PathPlatform/#effects-of-the-platform-and-platformnoclock","title":"Effects of the <code>Platform</code> and <code>PlatformNoClock</code>","text":"<p>There are some special logic implicated by the platform having these tags. Mainly, the game will often child GameObjects of interests to the platform when they are getting on it and child them back to where they were when no longer being on it.</p> <p>Specififcally, the GroundDetector's OnTriggerStay will check if the other collider has either of these tags and do the childing of the entity if it does. Additionally, the entity.<code>noclock</code> is set to true if the tag is <code>PlatformNoClock</code> and to false if it's <code>Platform</code>. On the component's OnTriggerExit, this is all undone, but there's a special case for the player or <code>PFolower</code> where it's parented to the root instead of the map.</p> <p>The Hornable component also does this which is related to the ice cube of a Dropplet. If the other collider has either tag, OnTriggerEnter / OnCollisionEnter will child the other transform to the platform. This is undone on the component's OnTriggerExit if the other collider has either of the tags.</p> <p>As for what the entity.<code>noclock</code> does, normally, on MainManager.DoClock, the method RefreshPlayer is called when the player is free and it would normally set the <code>onground</code> to false and root all playerdata entities (this incidentally has a known issue where the frictions gets toggled off for one frame every second). <code>noclock</code> is a field that will prevent this logic from happening so it prevents the rooting of the player to the scene. In the case of the PathPlatform, it means that this logic doesn't happen as long as the player is on the platform AND it is active (the logic is free to do its thing when the platform goes inactive).</p>"},{"location":"Entities/NPCControl/ObjectTypes/PressurePlate/","title":"PressurePlate","text":"<p>A plate that can be pushed down in its receptacle using a PushRock or optionally, the player or an NPCControl entity.<code>icecube</code>. This can optionally start an event when actuated for the first time.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PressurePlate/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: If 1, the player is allowed to actuate the plate</li> <li><code>data[1]</code>: If 1, an NPCControl entity.<code>icecube</code> can actuate the plate</li> <li><code>data[2]</code>: An event id whose event will start when the plate is actuated for the first time</li> <li><code>vectordata[0]</code>: the offset to displace the plate when it is pressed relative to its receptacle</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PressurePlate/#additional-data","title":"Additional Data","text":"<ul> <li><code>activationflag</code>: If it's not -1, it's the flag slot that if true, will set <code>hit</code> to true and not allow any deactuation. Anything lower than -1 is considered invalid and will result with the plate being stuck as deactuated even when pressing on it.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PressurePlate/#setup","title":"Setup","text":"<p><code>moveobj</code> is set to the first child of the entity.<code>model</code> which is the actual plate of the model inside its receptacle unless the entity.<code>originalid</code> is the <code>TestButton</code> AnimID where the <code>moveobj</code> is set to the entity.<code>sprite</code>. </p> <p>If the entity.<code>originalid</code> is <code>AncientPressurePlate</code>, a GlowTrigger is added on that plate object setting this NPCControl as the <code>parent</code> and the <code>glowparts</code> to one element being the plate's MeshRenderer.</p> <p>If the <code>activationflag</code> flags slot is true, the <code>hit</code> is set to true and the <code>moveobj</code>'s local position to <code>vectordata[0]</code> which sets the plate as pressed and visually renders it so.</p> <p>Finally, a few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PressurePlate/#update","title":"Update","text":"<p>We first needs to determine if <code>hit</code> should be set to true or false.</p> <p>If the <code>activationflag</code> is not negative and its flag slot is true, then <code>hit</code> is set to true. Otherwise, it is set to true until the <code>actioncooldown</code> expires at which point it is set to false. The <code>actioncooldown</code> is decremented by the game's framestep whenever it is set to true in this case.</p> <p>From there, if <code>hit</code> is true, the <code>moveobj</code> local position is set to a lerp from the existing one to <code>vectordata[0]</code> with a factor of a 1/5 of the game's frametime. If <code>hit</code> is false, it's the same lerp, but the to vector is Vector3.zero instead. This basically smoothly displaces the plate when <code>hit</code> is true and pulls it back to its starting position when <code>hit</code> is false.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PressurePlate/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of these are true:</p> <ul> <li>The other gameObject is the player <code>beemerang</code></li> <li>The <code>activationflag</code> (if it's not -1) refers to a flag slot whose value is true</li> <li> <p>All of the following are false:</p> <ul> <li>The other gameObject's Hornable doesn't exist (meaning this isn't an entity.<code>icecube</code>)</li> <li>The other gameObject tag is <code>PushRock</code></li> <li><code>data[0]</code> is 1 and the other gameObject is the player</li> <li><code>data[1]</code> is 1 and the other gameObject is an NPCControl with its <code>icecube</code> not null</li> </ul> </li> <li> <p>If <code>hit</code> is false, SwitchSound(true) is called</p> </li> <li>The other gameObject's Hornable <code>onground</code> is set to true (the entity.<code>icecube</code>)</li> <li>If <code>data[2]</code> exists and isn't negative, the event whose id is <code>data[2]</code> is started with this object as the caller and the value is set to -1 after the start which prevents the event to be started again</li> <li><code>hit</code> is set to true</li> <li><code>actioncooldown</code> is set to 10.0</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PressurePlate/#ontriggerexit","title":"OnTriggerExit","text":"<p>This does nothing if the other gameObject is the player <code>beemerang</code>, or if none of the following are true:</p> <ul> <li>The other gameObject has a Hornable (it's an entity.<code>icecube</code>)</li> <li>The other gameObject tag is <code>PushRock</code></li> <li><code>data[1]</code> is 1 and the other gameObject has an NPCControl</li> <li><code>data[0]</code> is 1 and the other gameObject is the player</li> </ul> <p>The following occurs if the conditions above are met:</p> <ul> <li><code>hit</code> is set to false</li> <li><code>actioncooldown</code> is set to 0.0</li> <li>SwitchSound(false) is called</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/","title":"PushRock","text":"<p>A rock or a pushable ice cube that can be moved using Kabbu's Horn Slash with configurable movement force. See the simplified explanation section for an intuitive description of how this object functions.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: UNUSED (was used to enable a limited radius via a special collider)</li> <li><code>data[1]</code>: If it's 1, the entity.<code>rigid</code> constraint are set to none on SetUp, no changes otherwise (This feature is unused under normal gameplay)</li> <li><code>data[2]</code>: Determines the mode of operation of the object (This is optional, if it doesn't exist, 0 is assumed):<ul> <li>0: this is a rock that can be moved in any direction by using Kabbu's Horn Slash which launches it in the air before landing</li> <li>1: An ice cube that can be moved via sliding only in the x and y axises (This is unused under normal gameplay)</li> <li>2: An ice cube that can be moved via sliding only in the z and y axises (This is unused under normal gameplay)</li> <li>3: An ice cube that can be moved via sliding only in the x and z axises and that can shatter and respawn if it ever collides with a gameObject having the tag <code>RockLimit</code></li> </ul> </li> <li><code>data[3]</code>: If it's 1, it is assumed to be a pushable ice cube, but allows all movement axises</li> <li><code>vectordata[0].x</code>: UNUSED (was used to specify the scale of the special collider mentioned in <code>data[0]</code>)</li> <li><code>vectordata[0].y</code>: The y velocity when Horn Slash is used for the launch when this is a rock</li> <li><code>vectordata[0].z</code>: The x and z velocity multiplier when Horn Slash is used</li> <li><code>vectordata[1]</code>: UNUSED (was used to specify the local position of the special collider mentioned in <code>data[0]</code>)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#additional-data","title":"Additional data","text":"<ul> <li><code>boxcol</code>: Required to be present with valid data as a non trigger collider.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#a-simplified-explanation-of-how-this-object-functions","title":"A simplified explanation of how this object functions","text":"<p>This object is very complex and even includes unused logic under normal gameplay. The underlying system is simpler to explain in its own section which is what this section will attempt to do. If more details are needed, check the other sections.</p> <p>There are 2 modes to this object which is determined by <code>data[2]</code>:</p> <ul> <li>A rock that can be launched in any directions</li> <li>A pushable ice cube that can only be pushed using restricted axises (under normal gameplay, only the y axis is disallowed for movement which is what will be assumed here)</li> </ul> <p>In either cases, <code>internalcollider[0]</code> is set to the collider of the entity.<code>model</code></p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#rock","title":"Rock","text":"<p>When a <code>BeetleHorn</code> collides with this while it's not <code>trapped</code>, a launch occurs by setting the entity.<code>rigid</code> velocity in x/z to match the opposite relative direction of the player with the y being from <code>vectordata[0].y</code>. The force of the launch is controlled by a multiplier which is the value of <code>vectordata[0].z</code>. As part of the setup, <code>icevel</code> is set to the new entity.<code>rigid</code>.</p> <p>During Update, the velocity is managed:</p> <ul> <li>If the absolute value of the entity.<code>rigid</code> y velocity is 0.1 or below (or <code>onground</code> became true when absolute y velocity is below 0.15), <code>icevel</code> is zeroed out</li> <li>The entity.<code>rigid</code> x and z velocity are set to the <code>icevel</code> ones, but the y is kept</li> </ul> <p>What this means is that while the y velocity is managed by Unity's physics, the x and z ones will zero out whenever the rock has reached low y velocity (which happens at halfway point of the launch) or it has touched the ground. This will eventually cause the rock to remain at rest on the ground.</p> <p>Worth to note however: this mode has special logic:</p> <ul> <li>The frictions (static and dynamic) are set to 1.0 or 0.0 depending on if the y velocity is too small in either directions while entity.<code>onground</code> is true</li> <li>A <code>Thud</code> sound occurs when the GroundDetector of the entity sees that the object collided with the ground while it was in the air before, but this can only happen if it's been more than 5.0 frames since the launch</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#pushable-ice-cube","title":"Pushable ice cube","text":"<p>To keep track of this one, some internal fields are used:</p> <ul> <li><code>internaldata[0]</code>: The number of frames since the last push</li> <li><code>internalvector[0]</code>: The direction the cube should be going (Computed by using CardinalSnap)</li> <li><code>internalvector[1]</code>: The last position of the ice cube since the last update cycle</li> </ul> <p>When a <code>BeetleHorn</code> collides with this while it's not <code>trapped</code>, a push is setup:</p> <ul> <li><code>internalvector[0]</code> is set to the CardinalSnap of the angle the relative to the player</li> <li><code>internaldata[0]</code> is set to 0.0 frames</li> <li><code>internaldata[1]</code> to a very high vector (999.0, 999.0, 999.0).</li> </ul> <p>This means the cube will only try to move in x OR z and to the opposite direction of the player's position. The push is registered by setting <code>hit</code> to true which changes the Update cycle.</p> <p>The actual movement happens during Update where it will move by incremented the position by <code>internalvector[0]</code> * <code>vectordata[0].z</code> * framestep. Everytime this happens, <code>internaldata[0]</code> is incremented by framestep.</p> <p>This keeps going until the ice cube cam't move in the current direction because it's being blocked by a collider or all of the following are true:</p> <ul> <li>The velocity ramped up for longer than 10.0 frames</li> <li>MainManager.FrameDifference returns true (normally returns true, but can skip frames on vsync if the the refresh rate is higher than 60 htz)</li> <li>The object moved less than half the x/z multiplier since the last update cycle</li> </ul> <p>When we get there, the entity.<code>rigid</code> velocity is zeroed out with <code>hit</code> set to false which stops movement and allows another push to happen.</p> <p>A special case can happen if <code>data[3]</code> is 1: it allows the ice cube to move in the y axis too.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#setup","title":"Setup","text":"<ul> <li>The layer is set to 13 (NoDigGround) </li> <li>The <code>scol</code> gets disabled</li> <li>The <code>boxcol</code> gets disabled</li> <li>The entity.<code>alwaysactive</code> is set to true </li> <li>The <code>rotater</code>'s tag is set to <code>Hornable</code> which allows PlayerControl to get a green ! emoticon when getting 2.5 or lower distance from the grass for 5 frames</li> <li><code>internalvector</code> is initialised to have 2 elements (kept at default values)</li> <li><code>internaldata</code> is initialised to have 1 element (kept at default value)</li> <li><code>internalcollider</code> is initialised to have 1 element with the value being the entity.<code>model</code>'s Collider</li> <li>The tags of the gameObject (which gets overriden later to <code>Object</code>), the entity.<code>model</code> and its child with a Collider are set to <code>PushRock</code> which allows this object to actuate a PressurePlate and it also allows a DeadLanderOmega to ForceLook if the object collides with a DeadLanderZones whose <code>onlyrock</code> is set to true</li> <li>The NPCControl's <code>rotater</code> is initialised to a new GameObject named <code>rotater</code> childed to this object with a local position of Vector3.zero.</li> <li>If <code>data[1]</code> is 1, the entity.<code>rigid</code> have all its constraints removed (this never happens under normal gameplay).</li> <li>If <code>data[2]</code> is present and above 0, the following happens:<ul> <li>The entity's <code>onground</code> is set to false</li> <li>The <code>actioncooldown</code> is set to 300.0</li> <li>If the <code>boxcol</code>.size has a magnitude above 0.1, the first child of the entity's <code>model</code> has its scale set to the <code>boxcol</code>.size and its local position to (0.0, <code>boxcol.size.y</code> / 2, 0.0). The <code>boxcol</code> size then gets zeroed out</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#update","title":"Update","text":"<p>If <code>data[2]</code> isn't defined or it's 0, PushRockStuff is called (see the section below for details).</p> <p>Otherwise, the following section occurs.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#data2-is-above-0","title":"<code>data[2]</code> is above 0","text":"<p>Some steps occurs depending on the value of <code>data[2]</code> (neither happens under normal gameplay):</p> <ul> <li>1: The z position is set to the entity.<code>startpos.z</code></li> <li>2: The x position is set to the entity.<code>startpos.x</code></li> </ul> <p>There are 2 subsections, they happen in order if applicable and they aren't mutually exclusive.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#ice-hit-logic","title":"Ice <code>hit</code> logic","text":"<p>This sub section only happens when <code>hit</code> is true which can only happen if it was a slidable ice cube. It decides if the cube should be moving or be at rest if it has been moving.</p> <p><code>hit</code> is set to false and the entity.<code>rigid</code> velocity is set to Vector3.zero (which stops its movement and allows to pushed again) if any of the following conditions is true:</p> <ul> <li>No colliders are detected in a sphere of radius 1.5 with the center being this position + (0.0, 1.0, 0.0) + <code>internalvector[0]</code> * 2.0 other than the <code>ccol</code>, <code>boxcol</code>, <code>scol</code>, <code>pusher</code> and any colliders in <code>internalcollider</code> (Meaning the ice cube cam't move in the current direction because it's being blocked by a collider)</li> <li><code>data[2]</code> is between 1 and 2 (never happens under normal gameplay)</li> <li>The entity is not <code>inice</code> and the map isn't an <code>icemap</code></li> <li>All of the following are true<ul> <li><code>internaldata[0]</code> is above 10.0 (meaning the velocity ramped up for longer than 10.0 frames)</li> <li>MainManager.FrameDifference returns true (normally returns true, but can skip frames on vsync if the the refresh rate is higher than 60 htz)</li> <li>The distance between this object position and <code>internalvector[1]</code> is less than <code>vectordata[0].z</code> / 2.0 (meaning the object moved less than half the x/z multiplier since the last update cycle)</li> </ul> </li> </ul> <p>Otherwise, the following occurs (meaning the cube should be moving):</p> <ul> <li><code>internalvector[1]</code> is set to this object's position</li> <li>The entity.<code>rigid</code> have its rotation frozen, but it is possible to get an additional axis movement constraint frozen if the entity is <code>onground</code> or <code>data[3]</code> is present and is 1 in addition to:<ul> <li><code>data[2]</code> being 1: z movement are frozen (never happens under normal gameplay)</li> <li><code>data[2]</code> being 2, x movement are frozen (never happens under normal gameplay)</li> <li><code>data[2]</code> being 3 and <code>data[3]</code> is present and is 1, y movement are frozen</li> </ul> </li> <li>This object position is incremented by <code>internalvector[0]</code> * <code>vectordata[0].z</code> * framestep</li> </ul> <p>Finally, <code>internaldata[0]</code> is incremented by framestep and the <code>actioncooldown</code> is set to 300.0.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#no-ice-logic","title":"No ice logic","text":"<p>This sub section only happens when the entity isn't <code>inice</code> and the map.<code>icemap</code> is false.</p> <p>The entity.<code>model</code> local position is set to Vector3.zero unless there's less than 100.0 frames left to the <code>actioncooldown</code> in which case, it's a random vector between (-0.1, 0.0, 0.0) to (0.1, 0.0, 0.0). This slightly shakes the model horizontally.</p> <p>If the <code>actioncooldown</code> hasn't expired, it is decremented by framestep. Otherwise, BreakIceRock is called which does the following (Basically, this respawns the ice cube):</p> <ul> <li>The <code>IceShatter</code> particle is played at this object position + vector3.up with the angles (-90.0, 0.0, 0.0) for 1 second</li> <li>The <code>Audio/Sounds/IceBreak</code> audio clip is played at this object position with the volume being proportional to the sound distance of the object to the camera scaled by the soundvolume</li> <li>The <code>actioncooldown</code> is set to 300.0</li> <li>The position is set to the entity.<code>startpos</code></li> <li>The entity.<code>onground</code> is set to false</li> <li>The entity.<code>rigid</code> gets its rotation frozen</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#common-logic","title":"Common logic","text":"<p>This section happens at the end of the update cycle no matter what.</p> <p>If the <code>icevel</code> magnitude is above 0.1 and the entity.<code>rigid</code> velocity is not between -0.1 and 0.1 inclusive, the entity.<code>rigid</code> velocity is set to (<code>icevel</code>.x, entity.<code>rigid</code>.velocity.y, <code>icevel</code>.z). Otherwise, the <code>icevel</code> is set to Vector3.zero.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#pushrockstuff","title":"PushRockStuff","text":"<ul> <li>The entity.<code>activeinevents</code> is set to true</li> <li>The <code>arrow</code> is initialised if it was null using HelpArrow.NewArrow with this object as the parent, (0.0, 0.75. 0.0) as the offset, pure green as the color, 2.5 as the distance and 1.5 as the size</li> <li>If the <code>freezecooldown</code> hasn't expired yet, it is decreased by framestep. Otherwise, the entity.<code>rigid</code> x and z velocity are zeroed out.</li> <li>If the <code>actioncooldown</code> hasn't expired yet, it is decreased by framestep</li> <li>If the entity.<code>rigid</code> y velocity is between -0.15 and 0.15 while entity.<code>onground</code> is true, <code>icevel</code> is set to Vector3.zero and both the static and dynamic friction of the <code>internalcollider[0]</code> material are set to 1.0. Otherwise, the frictions are set to 0.0 and the entity.<code>rigid</code> velocity is overriden to (<code>icevel</code>.x, entity.<code>rigid</code>.velocity.y, <code>icevel</code>.z).</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#entitycontrollatestart","title":"EntityControl.LateStart","text":"<p>Any object of this type will have CreateFeet called which gives the entity a ground detector in the <code>feet</code> field. Additionally, all collisions between <code>feet</code>'s Collider and <code>internalcollider</code> are ignored.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#entitycontrolupdateground","title":"EntityControl.UpdateGround","text":"<p>No friction change of the entity.<code>ccol</code> can occur with an object of this type because this object's Update can manage it instead.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#ontriggerenter","title":"OnTriggerEnter","text":"<p>There are 2 branches in this:</p> <ul> <li>Where the other gameObject tag is <code>RockLimit</code> and <code>data[2]</code> is 3</li> <li>Where the other gameObject tag is <code>BeetleHorn</code> and we aren't <code>trapped</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#rocklimit","title":"<code>RockLimit</code>","text":"<p>BreakIceRock is called which does the following:</p> <ul> <li>The <code>IceShatter</code> particle is played at this object position + vector3.up with the angles (-90.0, 0.0, 0.0) for 1 second</li> <li>The <code>Audio/Sounds/IceBreak</code> audio clip is played at this object position with the volume being proportional to the sound distance of the object to the camera scaled by the soundvolume</li> <li>The <code>actioncooldown</code> is set to 300.0</li> <li>The position is set to the entity's <code>startpos</code></li> <li>The entity's <code>onground</code> is set to false</li> <li>The entity's <code>rigid</code> gets its rotation frozen</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#beetlehorn","title":"<code>BeetleHorn</code>","text":"<p>The <code>Damage0</code> sound is played on the entity at 0.6 volume and 0.5 pitch if the entity <code>sound</code> wasn't played anything or it was playing, but the clip wasn't <code>Damage0</code> or the playback of the existing sound is more than halfway done.</p> <p>Then, HitPart particles are played at this position + (0.0, 0.5, 0.0) and the <code>rotater</code> is set to LookAt the player.</p> <p>After, there are 2 kinds of logic there and it depends on <code>data[2]</code> existing and either the entity.<code>onground</code> is true or <code>data[3]</code> exists and is 1. Either starts a movement on the rock or ice cube</p> <p>If the above is violated (This is a rock):</p> <ul> <li>The entity.<code>rigid</code> x and z velocity are set to be 0.0 - <code>rotater.forward.x</code> and 0.0 - <code>rotater.forward.z</code> respectively, each scaled by <code>vectordata[0].z</code>. The y velocity is set to <code>vectordata[0].y</code></li> <li><code>icevel</code> is set to the entity.<code>rigid</code> velocity</li> <li>The entity <code>onground</code> is set to false</li> <li>The <code>actioncooldown</code> is set to 5.0</li> <li>The <code>freezecooldown</code> is set to 150.0</li> <li>The entity <code>feet.overridecd</code> is set to 5.0</li> </ul> <p>If it was fufilled (This is an ice cube):</p> <ul> <li><code>internaldata[0]</code> is set to 0.0</li> <li><code>internalvector[1]</code> is set to (999.0, 999.0, 999.0)</li> <li>What happens next depends on <code>data[2]</code>:<ul> <li>If it's 0, the same logic occurs than if <code>data[2]</code> didn't existed in the first place</li> <li>If it's 1 or 2, <code>hit</code> is set to true (Never happens under normal gameplay)</li> <li>If it's 3, <code>internalvector[0]</code> is set to the CardinalSnap of the <code>rotater</code> and <code>hit</code> is set to true </li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#grounddetectorontriggerstay","title":"GroundDetector.OnTriggerStay","text":"<p>If the object reached the ground while it was in the air before and <code>actioncooldown</code> expired, DeathSmoke particles are played at the object position + the forward vector of the camera * -0.35 followed by a <code>Thud</code> sound played on the entity at 0.4 volume and 1.5 pitch.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#pausemenunearsomething","title":"PauseMenu.NearSomething","text":"<p>If the method finds out that a map entity of this object type exists less than 4.0 distance from the player, the return will be an array of 3 booleans with the first one being true. This will prevent usage of the Bed Bug item.</p>"},{"location":"Entities/NPCControl/ObjectTypes/PushRock/#mainmanagerrefreshentities","title":"MainManager.RefreshEntities","text":"<p>Strangely, the logic there doesn't end up doing anything useful because it ensures the entity.<code>rigid</code> has its gravity enabled without kinematic, but there is no situation in which this won't be true because it's the default of the RigidBody and it's also never changed.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ResetCamera/","title":"ResetCamera","text":"<p>A zone where the camera is reset to default via MainManager.ResetCamera when the player enters it.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ResetCamera/#data-arrays","title":"Data Arrays","text":"<p>None.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ResetCamera/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ResetCamera/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ResetCamera/#ontriggerenter-if-the-other-collider-is-the-player","title":"OnTriggerEnter if the other collider is the player","text":"<p>The camera values are reset to their defaults via MainManager's ResetCamera.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/","title":"RollingRock","text":"<p>A rolling rock that either appears and rolls on its own or is shot from a canon. The target direction, velocity, radius, rotation, spawn timing and minimum y position limit are all configurable with the option to only have the rock roll once it hits the ground and an option to only activate the rock when another NPCControl <code>hit</code> value is true.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: If 1, the rock starts rolling when it hits the ground with some particles, sound effect and a shake screen. If 0, the rock always rolls when the <code>actioncooldown</code> expires. Any other value is considered invalid and will cause illogical behaviors</li> <li><code>data[2]</code>: 1 if a canon should shoot the rock, no canon is setup otherwise</li> <li><code>data[3]</code><sup>1</sup>: The NPCControl at the map entity id whose <code>hit</code> value determines if the rock is considered active. A positive number means to test for it being true while a negative one test for it being false using the absolute value as the map entity id. This is optional, the rolling rocks remains active if it doesn't exist or is -1</li> <li><code>vectordata[0]</code>: The target vector of the rock which determines towards where it will start rolling and its x/z velocity</li> <li><code>vectordata[1].x</code>: The minimum y position allowed of the rock before respawning it</li> <li><code>vectordata[1].y</code>: The radius of the rock. Defaults to 3.0 if it was less than 0.1</li> <li><code>vectordata[1].z</code>: The <code>actioncooldown</code> of the canon which is the time before shooting if applicable or the time it takes to respawn it if we aren't shooting from a canon</li> <li><code>vectordata[2]</code>: The rotation angles to apply each update where the rock rolls</li> </ul> <p>1: NOTE: a caveat with this value is it is only possible to test for the value being false on the id 0, it is NOT possible to test it being true. Also, it is NOT possible to test for id 1 being false because -1 is a special value to opt out of this feature and that meaning takes priority</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#setup","title":"Setup","text":"<ul> <li>entity.<code>onground</code> is set to false</li> <li>entity.<code>alwaysactive</code> is set to true</li> <li>The entity.<code>ccol</code> is enabled overriding the default Start logic for objects</li> <li>If <code>vectordata[1].y</code> is less than 0.1, it is set to 3.0</li> <li>The <code>scol</code> center is set to (0.0, <code>vectordata[1].y</code>, 0.0)</li> <li>The entity.<code>model</code>'s local scale is set to Vector3.one * <code>vectordata[1].y</code></li> <li>The entity.<code>model</code>'s local position is set to (0.0, <code>vectordata[1].y</code>, 0.0)</li> <li>The <code>scol</code> radius is set to <code>vectordata[1].y</code></li> <li>The <code>jumpheight</code> is halved</li> <li><code>internaldata</code> is initialised to a new array with 2 elements being 0.0 and 100.0</li> <li>If <code>data[2]</code> is 1, see the section below about setting up shooting from a canon</li> <li>All collision between the entity.<code>ccol</code> and the player.entity.<code>ccol</code> are ignored</li> <li>The ground detector is recreated completely via CreateFeet</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#when-we-are-shooting-from-a-canon-data2-is-1","title":"When we are shooting from a canon (<code>data[2]</code> is 1)","text":"<ul> <li><code>actioncooldown</code> is set to <code>vectordata[1].z</code></li> <li><code>internaltransform</code> is initialised to have 2 transforms:<ul> <li>The first is an instance of the <code>Prefabs/Objects/Cannon</code> prefab childed to the current map with a scale of Vector3.one * (<code>vectordata[1].y</code> / 2.0), a position of the entity.<code>startpos</code> and with angles incremented by (0f, 0f, -90f).</li> <li>The second is the first child from the root of the canon instance (the cylinder nozzle)</li> </ul> </li> <li>The canon is set to rotate its y angle (not its x and z) to face the canon's current position + <code>vectordata[0]</code>. This aligns it horizontally to its target</li> <li>The entity.<code>rigid</code> is locked via LockRigid(true)</li> <li>The position of the the rolling rock is set to (0.0, 999.0, 0.0) which is offscreen in the air</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#update","title":"Update","text":"<p>If <code>data[2]</code> is present and 1 (we are shooting from a canon), a complete logic is performed to scale <code>internaltransform[1]</code> (the nozzle of the canon) at different points in the shooting and to update the <code>actioncooldown</code>. No matter if this applies or not, the main logic section can apply after.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#canon-nozzle-scaling","title":"Canon nozzle scaling","text":"<p>This section involves 2 countdown timer: <code>internaldata[0]</code> and <code>actioncooldown</code>. The former is reset to <code>internaldata[1]</code> (100.0) after shooting and represents the interval before preparing to shoot again while the latter represents the interval before respawning the rock. They both interact with each other, but this section still remains independant of what happens after when applicable.</p> <p>On the first update, <code>internaldata[0]</code> is expired, but not <code>actioncooldown</code> which will cause this object to be continuously positioned offscreen (0.0, 999.0, 0.0). If this happens while the <code>data[3]</code> <code>hit</code> check condition is fufilled or not applicable, this is where the <code>actioncooldown</code> is decremented by the game's frametime. On top of this, if less than 60.0 frames is left on the <code>actioncooldown</code>, the local scale of the nozzle is set to a lerp from the existing one to (0.5, 1.25, 1.25) with a factor of the 1/20 of the game's frametime. This scale signals that the canon is about to shoot by warping it mostly from the side for a brief moment.</p> <p>Eventually, the <code>actioncooldown</code> expires and this is detected by going below 0.0, but remaining above -1000.0. When this happens:</p> <ul> <li>The entity.<code>rigid</code> gets its velocity zeroed out</li> <li>This object's position is set to the entity.<code>startpos</code> + the normalized version of <code>vectordata[0]</code> * <code>vectordata[1].y</code> + Vector3.up * 0.25 (this places the rock back to its original position)</li> <li>LockRigid(false) is called on the entity to unlock its <code>rigid</code></li> <li>The <code>actioncooldown</code> is set to -1100.0 which prevents it from entering this code block until the next shooting</li> <li><code>internaldata[0]</code> is set to <code>internaldata[1]</code> (100.0)</li> <li>The nozzle of the canon has its local scale set to (1.25, 0.75, 0.75) which warps the canon on the opposite direction than when set earlier the instant the shooting happens</li> </ul> <p>As a result of this, <code>actioncooldown</code> is frozen below -1000.0, but this causes on each further updates to have the local scale of the canon nozzle to be set to a lerp between the existing one and Vector3.one with a factor of a 1/20 of the game's frametime.</p> <p>From there <code>internaldata[0]</code> hasn't expired which causes further updates to decrement it by the game's frametime. Eventually, it will expire which means we are back to where we started on the first update and the cycle repeats itself.</p> <p>Overall, it means that:</p> <ul> <li>Every time <code>actioncooldown</code> has 60.0 or less left, the scale of the nozzle is warped to be a bit smaller horizontally</li> <li>When <code>actioncooldown</code> expires, the shooting logic happens with a position set and a scale of the nozzle set to be larger horizontally</li> <li>The nozzle scale slowly gets back to normal</li> <li>After 100.0 frames passed, the logic resets back to where it started with a fresh <code>actioncooldown</code></li> </ul> <p>This repeates over and over until the <code>data[3]</code> check is violated which freezes the <code>actioncooldown</code> and prevents this section from doing any logic until the check is fufilled again.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#main-logic","title":"Main logic","text":"<p>After the section above if applicable, a check is done if the rock should have its <code>hit</code> set to true. It is set to true if any of the following conditions is true:</p> <ul> <li>We aren't shooting from a canon and <code>data[0]</code> is 0 or the entity is <code>onground</code></li> <li>We are shooting from a canon and <code>actioncooldown</code> expired.</li> </ul> <p>If we are setting <code>hit</code> to true, a special case happens when if it was false before and <code>data[0]</code> is 1. In that case, the <code>impactsmoke</code> particle is played at this object position and if the distance between the player and this object is less than 15.0, the <code>Thud</code> sound is played followed by a ShakeScreen using the vector (0.1, 0.35) without reset.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#hit-value-handling","title":"<code>hit</code> value handling","text":"<p>From there, what happens depends on the value of <code>hit</code>.</p> <p>If it is true:</p> <ul> <li>The x and z components of the entity.<code>rigid</code> velocity are set to <code>vectordata[0].x</code> and <code>vectordata[0].z</code> respectively</li> <li>The entity.<code>model</code> angles are incremented by <code>vectordata[2]</code> * framestep</li> <li>If <code>data[3]</code> is present and the NPCControl at the map entity id of its value has its <code>hit</code> set to true, then PlaySound is called with the <code>RollingRock</code> clip looped. If <code>data[3]</code> is present, but the <code>hit</code> check is violated, the entity.<code>sound</code> is stopped. NOTE: see the note on the data arrays section above for a caveat with this</li> </ul> <p>If <code>hit</code> is false, the entity.<code>sound</code> is stopped as long as it is playing, it exists and the clip is still <code>RollingRock</code>. The entity.<code>sound</code> is then set to no longer loop.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#common-steps","title":"Common steps","text":"<p>Regardless of everything, if this object's y position is below <code>vectordata[1].x</code> WarpRock is called (see the section below for details).</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if we are in a <code>pause</code>, <code>minipause</code> or <code>inevent</code> and that if a battle is in progress that it's not <code>inevent</code>.</p> <p>If the other gameObject is the player and it's not <code>digging</code>, the event 116 (Getting crushed by a <code>RollingRock</code>) is called with this as the caller.</p> <p>Otherwise, if the other gameObject tag is <code>RockLimit</code>, BreakRock is called.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#oncollisionenter","title":"OnCollisionEnter","text":"<p>If the other gameObject is an Object NPCControl of type BreakableRock, BreakRock is called on the other's NPCControl.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#breakrock","title":"BreakRock","text":"<p>This is a public method that has logic specific to this object type.</p> <ul> <li>If the player is less than 15.0 away from this object and the <code>RockBreak</code> sound wasn't playing, it is played at 0.5 volume</li> <li>entity.<code>sound</code> is stopped</li> <li>If the player is less than 15.0 away from the rolling rock, a ShakeScreen happen with 0.1 as the amount for 0.35 seconds without reset</li> <li>A <code>Prefabs/Objects/CrackRockBreak</code> prefab instantiated at the rolling rock position with its CrackRockBreak's initialcolor set to the rolling rock material color and a scale of Vector3.one * half of <code>vectordata[1].y</code></li> <li>entity.<code>rigid</code> has its velocity zeroed out</li> <li>entity.<code>onground</code> is set to false</li> <li>If <code>data[2]</code> is 1 (we are shooting from a canon) the following occurs (if not, WarpRock is called instead, see the section below for details):<ul> <li>The rolling rock position is offscreen in the air at (0.0, 999.0, 0.0)</li> <li>The entity.<code>rigid</code> is locked via LockRigid(true)</li> <li><code>actioncooldown</code> is reset to <code>vectordata[1].z</code></li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#warprock","title":"WarpRock","text":"<p>This is a private method specific to this object type that prepares to respawn the rock.</p> <p>If we are shooting from a canon (<code>data[2]</code> is 1), LockRigid(true) is called on the entity and the <code>actioncooldown</code> is reset to <code>vectordata[1].z</code>.</p> <p>If we aren't shooting from a canon:</p> <ul> <li>This object's transform is set to (0.0, 999.0, 0.0) which is offscreen in the air</li> <li>LatePos is called which sets the position of the entity to its <code>startpos</code> in <code>vectordata[1].z</code> seconds.</li> <li><code>hit</code> is set to false</li> <li>The entity.<code>rigid</code> velocity is zeroed out</li> <li>The entity.<code>onground</code> is set to false</li> </ul> <p>All of this prepares the next rock to spawn.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RollingRock/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>If the NPCControl passed has this type, it returns true which allows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RotatingPlatform/","title":"RotatingPlatform","text":"<p>The same than PathPlatform, but path mode will have the nodes be euler angles vectors instead and the platform will rotate through these angles instead of moving. Loop mode is left unchanged, but is considered invalid.</p> <p>NOTE: While it is possible to use loop mode on an object of this type, this isn't considered valid because on SetUp, the angles of the platform are set to the first node so they can't be position vectors in loop mode. It also excludes the <code>Lilypad</code> exclusive logic on SetUp. Use PathPlatform in loop mode for this instead and only use this type in path mode when rotating is desired instead of movement.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RotatingPlatform/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data</code>: The same than PathPlatform</li> <li><code>vectordata</code>: The nodes the platform will rotate in euler angles</li> <li><code>dialogues[0].x</code>: In path mode, this isn't used because the starting node is always the first one (0). In loop mode, the same than PathPlatform</li> <li><code>dialogues[0].y</code>: The same than PathPlatform</li> <li><code>dialogues[1].x</code>: The same than PathPlatform</li> <li><code>dialogues[1].y</code>: The same than PathPlatform</li> <li><code>dialogues[2].x</code>: The same than PathPlatform</li> <li><code>dialogues[2].y</code>: The same than PathPlatform</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/RotatingPlatform/#setup","title":"Setup","text":"<ul> <li>entity.<code>rigid</code> gets effectively locked by disabling gravity, making it kinematic and freezing all constraints</li> <li>isStatic on the gameObject is set to false</li> <li><code>nointeract</code> is set to true</li> <li>entity.<code>soundonpause</code> is set to true</li> <li>entity.<code>model</code> angles are set to <code>vectordata[0]</code> (It is assumed to be in path mode)</li> <li>entity.<code>model</code> scale is multiplied by a 1/10 of <code>dialogues[2].x</code></li> <li>entity.<code>alwaysactive</code> is set to true</li> <li>entity.<code>model</code> tag is set to <code>PlatformNoClock</code></li> <li>If entity.<code>originalid</code> is the <code>ElectroPlatform</code> AnimID, a GlowTrigger is added on the first child of the <code>model</code>:<ul> <li><code>getactivecolorfromstart</code> is set to true</li> <li><code>parent</code> is set to this NPCControl</li> <li><code>glowparts</code> is initialised to a single element corresponding to the MeshRenderer of the first child of the <code>model</code></li> <li><code>electime</code> is initialised to 260.0 unless <code>dialogues[2].y</code> exists and isn't 0 where it will take that value instead</li> </ul> </li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/RotatingPlatform/#update","title":"Update","text":"<p>If the AnimId is a <code>Lilypad</code>, the <code>boxcol</code> if present is kept enabled, otherwise, its enabled will bet set to the <code>hit</code> value.</p> <p>From there, the platform can operate in 2 distinct modes: forever move in a loop between the first 2 <code>vectordata</code> or rotate by following a series of nodes defined in <code>vectordata</code> which are angles vectors. The former is done if <code>dialogues[1].x</code> is 1, the latter is done otherwise.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RotatingPlatform/#loop-mode","title":"Loop mode","text":"<p>The same logic than PathPlatform occurs here with no changes.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RotatingPlatform/#path-mode","title":"Path mode","text":"<p>The same logic than PathPlatform occurs here, but with one change. If <code>hit</code> is true and <code>bounces</code> isn't <code>currennode</code> then the angles of the platform are lerped instead of its position with a regular lerp (SmoothLerp isn't called even with only 2 nodes). The same parameters are sent to Lerp so the only changes is <code>vectordata</code> are euler angles vector instead of positions.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RotatingPlatform/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>Unlike PathPlatform, this object will return false which disallows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/RotatingPlatform/#effects-of-the-platform-and-platformnoclock","title":"Effects of the <code>Platform</code> and <code>PlatformNoClock</code>","text":"<p>The same then PathPlatform.</p>"},{"location":"Entities/NPCControl/ObjectTypes/SavePoint/","title":"SavePoint","text":"<p>A save crystal that can be hit using field abilities. It can be blue which only prompts to save the game, yellow which also heals the party and red which alerts a DeadLanderOmega, but doesn't prompt for saving and can optionally heal the party.</p>"},{"location":"Entities/NPCControl/ObjectTypes/SavePoint/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: If 1, a <code>Prefabs/Objects/PolySphere</code> will be rendered as illumination, it won't otherwise</li> <li><code>data[1]</code>: If it's 10 or above, this is a red save crystal that will force a DeadLanderOmega to look somewhere whose <code>thisid</code> is this value -10.</li> <li><code>data[2]</code>: If 0, this is a yellow save crystal (unless <code>data[1]</code> is 10 or above making it render red) which will also heal the party, this a blue save crystal otherwise unless.</li> <li><code>vectordata[0]</code>: if <code>data[1]</code> is 10 or above, this is the position the DeadLanderOmega will be forced to look at</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/SavePoint/#additional-data","title":"Additional data","text":"<ul> <li><code>interacttype</code>: OVERRIDEN (to SavePoint)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/SavePoint/#setup","title":"Setup","text":"<ul> <li>The object's isStatic is set to true   </li> <li>The <code>scol</code> is disabled. </li> <li>The <code>colliderheight</code> is set to 3.0.</li> <li>The entity.<code>ccol</code> is enabled with a radius set to 1.0</li> <li><code>overrideanim</code> is set to true</li> <li>The entity.<code>rigid</code> is effectively fixed by putting it in kinematic mode without gravity and with all constraints frozen</li> <li>The <code>interacttype</code> is overriden to SavePoint.</li> </ul> <p><code>internaltransform</code> is initialised to be 2 elements and the first one is set as the entity.<code>model</code>'s second child (the crystal GameObject) and the second is left default for now.</p> <p>If <code>data[0]</code> is 1, the PolySphere is setup from a <code>Prefabs/Objects/PolySphere</code> prefab:</p> <ul> <li>childed to to <code>internaltransform[0]</code></li> <li>local position of (0.0, 0.0, 0.01)</li> <li>Local scale of (8.0, 8.0, 5.0)</li> <li><code>internaltransform[1]</code> is set to it</li> <li><code>internalrender</code> is set as all child MeshRenderer of the Polysphere and for each of them, the renderQueue is set to 3000 + the absolute z position of the PolySphere * 100.0. Additionally, if <code>data[2]</code> is 0, each of their color is set to pure yellow without changing the existing transparency.</li> </ul> <p>If <code>data[1]</code> is 10 or above, the crystal's color and the <code>_Emission</code> color property of the shader is set to pure red.</p> <p>Otherwise, if <code>data[2]</code> is 0, the crystal's color and the <code>_Emission</code> color property of the shader is set to pure yellow (this overrides <code>data[1]</code> if it was red already).</p>"},{"location":"Entities/NPCControl/ObjectTypes/SavePoint/#update","title":"Update","text":"<p>The only thing that occurs here is the <code>internaltransform[0]</code> (the crystal game object) is rotated 0.3 degrees in the z axis. This actually rotates it on the world's y axis because the pivot point of the crystal is rotated.</p>"},{"location":"Entities/NPCControl/ObjectTypes/SavePoint/#ontriggerenter","title":"OnTriggerEnter","text":"<p>This does nothing when any of the following are true:</p> <ul> <li>We are in a <code>pause</code> or <code>minipause</code></li> <li>The message lock is grabbed</li> <li>The other gameObject tag isn't <code>BeetleHorn</code>, <code>BeetleDash</code> or <code>Icecle</code> while it's also not the player <code>beemerang</code></li> </ul> <p>If the other gameObject tag was <code>Icecle</code> and it has a DestroyOnLayer Kill is called on it. This component normally destroys the object attached when another trigger collider of a specific layer collides to it, but Kill allows it to do it manually.</p> <p>The <code>BounceUp</code> animation is played on the entity.<code>anim</code> followed by playing the <code>Save</code> sound on the entity at 0.5 volume.</p> <p>If <code>data[2]</code> is 0, Heal is called.</p> <p>From there, a HitPart particle is played at this position + (0.5, 0.5, 0.5).</p> <p>If the other gameObject is the player.<code>beemerang</code>, its <code>hit</code> is set to true.</p> <p>If <code>data[1]</code> is 10 or above and <code>hit</code> is false, the game will find a DeadLanderOmega whose <code>thisid</code> is <code>data[1]</code> - 10 and call ForceLook on it using <code>vectordata[0]</code> as the vector. After, <code>hit</code> is set to true making it a one time event.</p> <p>Otherwise, if we aren't in a <code>timeddemo</code> (we never are under normal gameplay) and the square distance between this and the player is 30.0 or less, Interact(\"save\") is called.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ScrewSwitch/","title":"ScrewSwitch","text":"<p>A crank switch actuated by Vi's Beemerang Toss with an analog actuation that needs to be held for a certain period before being fully actuated. The angles of rotation when actuated, the rate of actuation / deactuation and the maximum value to reach before fully actuating the crank are all configurable.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ScrewSwitch/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>vectordata[0].x</code>: The rate at which <code>actioncooldown</code> increments per update cycle when the crank is actuated</li> <li><code>vectordata[0].y</code>: The rate at which <code>actioncooldown</code> decrements per update cycle when the crank is not actuated</li> <li><code>vectordata[0].z</code>: The maximum value of <code>actioncooldown</code> allowed where the crank is considered fully actuated when reached</li> <li><code>vectordata[1]</code>: The base angle vector to rotate the crank every update cycles that it is actuated</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ScrewSwitch/#additional-data","title":"Additional data","text":"<ul> <li><code>activationflag</code>: If above 0, a flag slot that if was already true on SetUp, the crank will start with its <code>hit</code> set to true</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ScrewSwitch/#setup","title":"Setup","text":"<ul> <li>entity.<code>rigid</code> gets effectively fixed by placing it in kinematic mode without gravity and all constraints frozen </li> <li>entity.<code>alwaysactive</code> is set to true</li> <li><code>nointeract</code> is set to true</li> <li>if the <code>activationflag</code> flags slot is true, <code>hit</code> is also set to true.</li> <li>From there some adjustements happens based on the <code>originalid</code>'s AnimID(nothing happens if it doesn't match any of them):<ul> <li><code>SwitchCrystal</code> and <code>BigCrystalSwitch</code>: A GlowTrigger is added to the entity.<code>model</code>'s first child with its <code>parent</code> set to this object and the <code>glowparts</code> set to a single element corresponding to the MeshRender already attached to the first entity.<code>model</code> child.</li> <li><code>WoodenSwitch</code> and <code>SteelSwitch</code>: <code>internaldata</code> is initialised to a single element being -60 if it's a <code>WoodenSwitch</code> or -100 if it's a <code>SteelSwitch</code>, Then, the <code>moveobj</code> is set to the entity.<code>model</code> first child and if <code>hit</code> was set to true earlier, its angles are set to (0.0, <code>internaldata[0]</code>, 0.0)</li> </ul> </li> <li>If the player is present, all collision between the <code>boxcol</code> and the player's wall detector are ignored.</li> <li>If the <code>originalid</code> is not among <code>BigCrystalSwitch</code>, <code>WoodenSwitch</code> or <code>SteelSwitch</code>, AddPushder is called.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/ScrewSwitch/#update","title":"Update","text":"<p>Updates are disabled if the player doesn't exist.</p> <p><code>hit</code> is set to true if the player.<code>beemerang</code> is present and the distance between it and this object is less than 1.75. Otherwise, it is set to false.</p> <p>If <code>hit</code> is true then <code>actioncooldown</code> is incremented by the game's frametime * <code>vectordata[0].x</code>, but only if the <code>actioncooldown</code> is less than <code>vectordata[0].z</code> (meaning the crank isn't fully actuated) otherwise, nothing happens.</p> <p>If <code>hit</code> is false and the <code>actioncooldown</code> is above 0.0, it is decremented by the game's frametime * <code>vectordata[0].y</code></p> <p>From there, the ratio of the switch actuation is calculated by multiplying the game's frametime with (<code>actioncooldown</code> / <code>vectordata[0].z</code>) which is then clamped from 0.0 to 1.0. (0.0 being no actuation and 1.0 being fully actuated).</p> <p>The entity.<code>model</code> angles are set to the actuation ratio * <code>vectordata[1]</code> which rotates it proportionally to the crank actuation.</p> <p>If the ratio is 0 or lower, the entity.<code>sound</code> is set to stop looping. Otherwise, PlaySound is called with the <code>SpinSwitch0</code> clip at half volume if the entity.<code>sound</code> wasn't playing already. It also sets the clip to loop at 0.5 + the actuation ratio as the pitch.</p>"},{"location":"Entities/NPCControl/ObjectTypes/ScrewSwitch/#ontriggerenter","title":"OnTriggerEnter","text":"<p>If the other gameObject tag is <code>BeetleHorn</code>, <code>hit</code> is set to true and <code>actioncooldown</code> is incremented by <code>vectordata[0].x</code> * 10.0 then clamped from 0.0 to <code>vectordata[0].z</code>. This slightly actuate the crank the moment Kabbu's Horn Slash collides with it.</p>"},{"location":"Entities/NPCControl/ObjectTypes/SetPlayerRespawn/","title":"SetPlayerRespawn","text":"<p>A trigger zone that sets the player.<code>lastpos</code> which is the player last spawn point. It can either be managed by this NPCControl or be a completely independant collider that PlayerControl can collider with.</p>"},{"location":"Entities/NPCControl/ObjectTypes/SetPlayerRespawn/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>vectordata[0]</code>: The position to set the player <code>lastpos</code> when entered. If the magnitude is less than 0.1, the whole collider is managed indepedently from any NPCControl</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/SetPlayerRespawn/#setup","title":"Setup","text":"<p>There are 2 modes this object can operate on:</p> <ul> <li><code>vectordata[0]</code>.magnitude is 0.1 or higher: this NPCControl manages the <code>lastpos</code> and the colliders to it via its OnTriggerStay</li> <li><code>vectordata[0]</code>.magnitude is less than 0.1: this object is destroyed after creating an independant GameObject with a BoxCollider that PlayerControl's OnTriggerStay interacts with</li> </ul> <p>In the case of NPCControl management, the <code>boxcol</code>'s layer is set to 0 (default) which ends this object's setup.</p> <p>In the case of independant management by recreating <code>boxcol</code> a new GameObject named <code>Respawner</code> with a new trigger BoxCollider that is childed to the map with the following properties: </p> <ul> <li>position is set to the entity.<code>startpos</code></li> <li>angles is set to this transform's angles</li> <li>tag is set to <code>Respawn</code> (which allows it to be detected by PlayerControl and others) </li> <li>isStatic is set to true</li> </ul> <p>Finally, the gameObject gets destroyed. From now on, this NPCControl cease to exist because the entire logic is managed by an independant GameObject. The tag gives it special behaviors:</p> <ul> <li>The Beemerang entity.<code>ccol</code> and <code>scol</code> have their collisions ignored with the collider</li> <li>OnTriggerStay of PlayerControl: if the other collider has the tag with a <code>vectordata[0]</code> above 0.1, <code>lastpos</code> is set to it.</li> <li>OnTriggerExit of PlayerControl: <code>respawncount</code> is set to 0.0 which resets a failsafe to prevent too much infinite respawns.</li> <li>OnTriggerStay of RayDetector: prevents entity.<code>hitwall</code> to change when colliding with an object with this tag.</li> </ul> <p>This means the Update and OnTriggerStay of this document only applies when the collider is managed by this NPCControl.</p>"},{"location":"Entities/NPCControl/ObjectTypes/SetPlayerRespawn/#update-when-managed-by-this-npccontrol","title":"Update (When managed by this NPCControl)","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/SetPlayerRespawn/#ontriggerstay-when-managed-by-this-npccontrol","title":"OnTriggerStay (When managed by this NPCControl)","text":"<p>If the magnitude of <code>vectordata[0]</code> is above 0.1 and the other gameObject is the player, the player <code>lastpos</code> is set to <code>vectordata[0]</code>.</p>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/","title":"SencilSwitch","text":"<p>A switch that, when activated, causes a frozen area range to appear or to disappear when deactivated.</p>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[1]</code>: If this isn't negative, it is a map entity id whose entity is set as this stencil switch's parent. No parent changes occurs otherwise</li> <li><code>data[2]</code>: If this is 1, <code>hit</code> is set to true on SetUp regardless of the <code>activationflag</code></li> <li><code>data[3]</code>: If this is 1, all colliders including the entity.<code>model</code> ones are disabled shortly after setup if the model is present, nothing happens otherwise</li> <li><code>vectordata[0].x</code>: The the rate at which the radius grows and shrinks when <code>hit</code> is toggled (1.0 being the game's frametime)</li> <li><code>vectordata[0].y</code>: The radius of the range</li> <li><code>vectordata[1]</code>: The local position of the stencil switch if <code>data[1]</code> isn't negative</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/#additional-data","title":"Additional data","text":"<ul> <li><code>activationflag</code>: If 0 or above, a flag slot that determines the starting <code>hit</code> value and also the slot whose value will be set to this switch <code>hit</code> value when toggled.</li> <li><code>regaionalflag</code>: If not negative, the regionalflag slot turned to true when the stencil switch is actuated for the first time</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/#setup","title":"Setup","text":"<ul> <li>entity.<code>rigid</code> gets effectively fixed by placing it in kinematic mode without gravity and all constraints frozen </li> <li>entity.<code>alwaysactive</code> is set to true</li> <li><code>nointeract</code> is set to true</li> <li>if the <code>activationflag</code> flags slot is true, <code>hit</code> is also set to true.</li> <li>From there some adjustements happens based on the <code>originalid</code>'s AnimID(nothing happens if it doesn't match any of them):<ul> <li><code>SwitchCrystal</code> and <code>BigCrystalSwitch</code>: A GlowTrigger is added to the entity's <code>model</code>'s first child with its <code>parent</code> set to this object and the <code>glowparts</code> set to a single element corresponding to the MeshRender already attached to the first <code>model</code> child.</li> <li><code>WoodenSwitch</code> and <code>SteelSwitch</code>: <code>internaldata</code> is initialised to a single element being -60 if it's a <code>WoodenSwitch</code> or -100 if it's a <code>SteelSwitch</code>, Then, the <code>moveobj</code> is set to the entity's <code>model</code> first child and if <code>hit</code> was set to true earlier, its angles are set to (0.0, <code>internaldata[0]</code>, 0.0)</li> </ul> </li> <li>If the player is present, all collision between the <code>boxcol</code> and the player's wall detector are ignored.</li> <li>If the <code>originalid</code> is not among <code>BigCrystalSwitch</code>, <code>WoodenSwitch</code> or <code>SteelSwitch</code>, AddPushder is called.</li> </ul> <p>If the entity is allowed to exist according to its <code>limit</code>, <code>requires</code> and <code>regionalflag</code>, then some further setup happens, nothing happens otherwise.</p>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/#enabled-stencilswitch-setup","title":"Enabled StencilSwitch SetUp","text":"<ul> <li>entity.<code>alwaysactive</code> is set to true</li> <li>entity.<code>activeonpause</code> is set to true</li> <li><code>internaltransform</code> is initialised to a single element being a new GameObject named <code>ice radius from</code> followed by this entity name with a tag of <code>IceRadius</code>. It gets a child added as a new instance of the <code>Prefabs/Particles/IceRadius</code> prefab. After that, a trigger SphereCollider is added to it with a radius of 0.8.</li> <li><code>hit</code> is set to true if <code>data[1]</code> is 1.</li> <li>All collisions between the <code>boxcol</code> and the SphereCollider addeed on the <code>internaltransform[0]</code> are ignored.</li> <li>If <code>data[1]</code> isn't negative, the map entity whose id is this value is resolved and the following occurs:<ul> <li>This stencil switch gets childed to the resolved entity.<code>model</code> if it's present or the entity itself if it's not</li> <li>This stencil switch position is set to the resolved entity position + <code>vectordata[1]</code></li> <li>This stencil switch entity.<code>startpos</code> is set to its position</li> </ul> </li> <li>If <code>data[3]</code> is 1 and the entity has a <code>model</code>, the collider on that <code>model</code> if it exist gets disabled and DisableAllColliders is invoked in 0.1 seconds which disables the entity.<code>ccol</code>, the <code>scol</code>, the <code>boxcol</code> and the <code>pusher</code> if any were present</li> <li><code>internaltransform[0]</code> gets childed to the map and its position is set to this stencil switch position</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/#update","title":"Update","text":"<p>The scale of <code>internaltransform[0]</code> (the ice radius) is set to a lerp from the existing one to a value that depends on the <code>hit</code> value of this stencil switch. If it's false, it's Vector3.zero and if it's true, it's Vector3.one * <code>vectordata[0].y</code> * 2.0 instead. The factor is the game's frametime * <code>vectordata[0].x</code>. This grows and shrinks the the radius depending on the <code>hit</code> value smmoothly.</p> <p>The position of <code>internaltransform[0]</code> (the ice radius) is set to be offscreen at (0.0, -999.0, 0.0) unless <code>hit</code> is true which will make the position be set to this object's position instead.</p> <p>If <code>data[1]</code> isn't negative (another map entity is the parent of this stencil switch), the local position of this object is set to <code>vectordata[1]</code>.</p>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/#mapcontrolcheckstencilswitch","title":"MapControl.CheckStencilSwitch","text":"<p>This method specifically targets any NPCControl of this object type. It is called for any MapControl LateUpdate after the first one.</p> <p>If any exists in the map where their entity isn't <code>iskill</code> and their <code>hit</code> value is true, it will select the first one. With it, 2 shaders global properties are set:</p> <ul> <li><code>GlobalIceRadius</code>: Half of the magnitude of the <code>internfaltransform[0]</code> (the ice radius object) scale</li> <li><code>CentralIcePoint</code>: the sencil switch position</li> </ul> <p>It also sets the map's <code>stencilid</code> to the map entity id of the selected stencil switch which has the effect of freezing any IcePlatform in range of the stencil switch which is defined as being less than <code>vectordata[0].y</code> * 1.85 away from the stencil switch.</p> <p>If no actuated stencil switches are found, the <code>stencilid</code> remains at -1 and the <code>GlobalIceRadius</code> shader property is set to lerp from the existing one to 0.0 with a factor of 1/20 of the game's frametime.</p>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/#ontriggerenter","title":"OnTriggerEnter","text":"<p>Nothing happens if any of the following is true:</p> <ul> <li>We are in a <code>pause</code> or <code>minipause</code></li> <li>message is grabbed</li> <li><code>collisionammount</code> is higher than 1 (this is a debounce protection)</li> <li>The other gameObject tag isn't <code>BeetleHorn</code>, <code>BeetleDash</code>, <code>Icefall</code> and <code>Icecle</code> while it's not the player <code>beemerang</code></li> </ul> <p>The following occurs if we the above is fufilled:</p> <ul> <li><code>collisionammount</code> is incremented</li> <li>A HitPart particle is played at this position + (0.0, 0.5, 0.0)</li> <li>All collisions between the entity.<code>ccol</code> and the SphereCollider of <code>internaltransform[0]</code> (the ice radius) are ignored</li> <li>The <code>Freeze</code> sound is played at this position if <code>hit</code> is false, the <code>IceMelt</code> one is played if it is true</li> <li><code>hit</code> gets toggled</li> <li><code>actioncooldown</code> is set to 30.0 (doesn't do anything)</li> <li>If <code>hit</code> is true, the corresponding regionalflag slot of <code>regionalflag</code> when it isn't negative is set to true the corresponding flag slot of <code>activationflag</code> when it isn't negative is set to true</li> <li>DeactivateOtherStencil is called which deactivates all other <code>StencilSwitch</code> in the current map whose entity aren't <code>iskill</code> by having their <code>hit</code> set to false</li> <li>If the other gameObject was the player <code>beemerang</code>, its <code>hit</code> is set to true and the <code>WoodHit</code> sound is played on the entity</li> <li>If the entity <code>originalid</code> isn't -1 (<code>None</code>), SwitchSound is called indicating a press</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/StencilSwitch/#entitycontrolontriggerstay","title":"EntityControl.OnTriggerStay","text":"<p>Due to the <code>IceRadius</code> tag of the ice radius object, any entities that collides with it has their <code>inice</code> set to true which update thier sprites and animation accordingly.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/","title":"Switch","text":"<p>A switch that can be turned on or off offering a wide variety of actuation flow such as starting an event, changing other <code>hit</code> values, offer a toggling feature and be only actuable using Kabbu's horn. Consult the switch actuation section for more details.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: Controls the actuation flow, see the section below for details</li> <li><code>data[1]</code>: Controls the actuation flow, see the section below for details</li> <li><code>data[2]</code>: If <code>data[1]</code> is 0, this the the amount of frames that must pass after an actuation for the switch to automatically turn itself off. This is optional, this feature isn't used when it doesn't exist or is negative. As a side effect of enabling this feature, the <code>hit</code> value is continuously set to true if the <code>activationflag</code> flag slot is true</li> <li><code>data[3]</code>: UNUSED (The value is used in an if statement in Update, but the if leads to no code)</li> <li><code>data[4]</code>: If it's 1, the entity's <code>rotater</code> tag is set to <code>Hornable</code> (allows PlayerControl to get a green ! emoticon when getting 2.5 or lower distance from the switch for 5 frames) and disallows the switch to be actuated using Leif's Icicle or Vi's beemerang. This is optional, no change happens if it's 0 or not present. NOTE: anything other than 0 or 1 is considered invalid and will prevent the switch from being actuated under any circumstances</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#additional-data","title":"Additional data","text":"<ul> <li><code>boxcol</code>: Required to be present with valid data</li> <li><code>regaionalflag</code>: If positive, a regionalflag slot, see the table below for details</li> <li><code>activationflag</code>: If above 0, a flag slot, see the table below for details</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#about-switch-actuation","title":"About switch actuation","text":"<p>The meaning of <code>data[0]</code> and <code>data[1]</code> these 2 data elements have very complex semantics. They together control the flow of the actuation of the switch which is stored in the <code>hit</code> value as well as how the <code>activationflag</code> and <code>regionalflag</code> slots are used. </p> <p><code>data[1]</code> being 0 allows <code>data[2]</code> to function if it exists and is positive which the table will mention when it is applicable. The implications of this when applicable are outlined in the table below.</p> <p>To note, <code>data[4]</code> acts completely independently of <code>data[0]</code> and <code>data[1]</code>. It only permits actuation from Kabbu's horn and makes the switch <code>Hornable</code> which allows PlayerControl to get a green ! emoticon when getting 2.5 or lower distance from the switch for 5 frames.</p> <p>Unless stated otheriwse, <code>activationflag</code> and <code>regionalflag</code> only applies when the former is above 0 and when the latter is positive. Here is a breakdown of all actuation flow:</p> <code>data[0]</code> <code>data[1]</code> Starting <code>hit</code> value Actuation flow Effects on actuation 0 0 If the <code>activationflag</code> flag slot (with the 0 value being allowed) is true, the switch will continuously set its <code>hit</code> to true during Update if <code>data[2]</code> exists and isn't negative. This switch can only be toggled on. If <code>data[2]</code> exists and is positive, the switch automatically turns itself off after the amount of frames contained in <code>data[2]</code> passed. Otherwise, the switch cannot be turned off When <code>hit</code> turns true, both <code>activationflag</code> and <code>regionalflag</code> respective slots are set to true 0 1 <code>activationflag</code> (with the 0 value allowed) tells the starting value of <code>hit</code> by its flag slot. The switch can be toggled on and off. Once toggled, there is a 30 frames cooldown before being able to toggle it again, but <code>data[2]</code> can override the cooldown time if it exist and isn't negative When actuated, the <code>activationflag</code> flag slot is set to the new <code>hit</code> value. Additionally, all other switch NPCControl present with the same <code>data[0]</code>, <code>data[1]</code> and <code>activationflag</code> values will have their <code>hit</code> values set to the new one after the toggle.<sup>1</sup> 1 Negative false The switch can only be turned on once unless the <code>TOG</code> modifier is active which allows the switch to be toggled on and off. When the switch is actuated, both <code>activationflag</code> and <code>regionalflag</code> respective slots are set to true. Additionally, if entity.<code>originalid</code> has an undefined (-1) animid, entity.<code>iskill</code> is set to true and if it's <code>WoodenSwitch</code>, the <code>moveobj</code> angles are set to (0.0, -60.0, 0.0) (This moves the lever stick) 1 0 or above false<sup>2</sup> The same actuation flow than if <code>data[1]</code> was negative<sup>3</sup> That same effects occurs than if <code>data[1]</code> was negative with the addition that <code>data[1]</code> is an event id that will trigger with this switch as the caller each time the switch is actuated <p>1: This combination is practically unused under normal gameplay as it is likely an older implementation of event 169</p> <p>2: If <code>data[1]</code> is 1, the starting value of <code>hit</code> is the value of the <code>activationflag</code> (0 included) flag slot</p> <p>3: If <code>data[1]</code> is 0, it allows <code>data[2]</code> if it exists and isn't negative to make the switch automatically turns itself off after the amount of frames contained in <code>data[2]</code> passed after each actuation. It also sets the <code>hit</code> value to true continuously during Update if <code>activationflag</code> (0 included) flag slot is true</p>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#setup","title":"Setup","text":"<ul> <li>entity.<code>rigid</code> gets effectively fixed by placing it in kinematic mode without gravity and all constraints frozen </li> <li>entity.<code>alwaysactive</code> is set to true</li> <li><code>nointeract</code> is set to true</li> <li>if the <code>activationflag</code> flags slot is true, <code>hit</code> is also set to true.</li> <li>From there some adjustements happens based on the <code>originalid</code>'s AnimID(nothing happens if it doesn't match any of them):<ul> <li><code>SwitchCrystal</code> and <code>BigCrystalSwitch</code>: A GlowTrigger is added to the entity.<code>model</code>'s first child with its <code>parent</code> set to this object and the <code>glowparts</code> set to a single element corresponding to the MeshRender already attached to the first <code>model</code> child.</li> <li><code>WoodenSwitch</code> and <code>SteelSwitch</code>: <code>internaldata</code> is initialised to a single element being -60 if it's a <code>WoodenSwitch</code> or -100 if it's a <code>SteelSwitch</code>, Then, the <code>moveobj</code> is set to the entity's <code>model</code> first child and if <code>hit</code> was set to true earlier, its angles are set to (0.0, <code>internaldata[0]</code>, 0.0)</li> </ul> </li> <li>If the player is present, all collision between the <code>boxcol</code> and the player's wall detector are ignored.</li> <li>If the <code>originalid</code> is not among <code>BigCrystalSwitch</code>, <code>WoodenSwitch</code> or <code>SteelSwitch</code>, AddPushder is called.</li> <li>If <code>data[4]</code> is 1 the entity's <code>rotater</code> tag gets set to <code>Hornable</code> (allows PlayerControl to get a green ! emoticon when getting 2.5 or lower distance from the switch for 5 frames).</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#update","title":"Update","text":"<p>What happens at the start depends on <code>data[1]</code> and <code>data[2]</code>.</p> <p>If <code>data[1]</code> is 0 and <code>data[2]</code> is present and not negative:</p> <ul> <li>If the <code>actioncooldown</code> hasn't expired, it is decremented by the game's frametime. Otherwise, if the <code>actioncooldown</code> expired on the last update cycle (checked by being above -1000.0), <code>hit</code> is set to false and <code>actioncooldown</code> is set to -1100.0 so it doesn't perform this logic on further updates (this is the autooff feature taking effect)</li> <li>If the <code>activationflag</code> isn't negative and the flag slot of it is true, <code>hit</code> is set to true.</li> </ul> <p>Otherwise, if <code>data[1]</code> is 1 and the <code>actioncooldown</code> hasn't expired yet, it is decremented by the game's frametime.</p> <p>In all cases, if the entity.<code>originalid</code> is the <code>WoodenSwitch</code> or <code>SteelSwitch</code> AnimID, the <code>moveobj</code>'s y angle is set to a LerpAngle from the existing one to 0.0 if <code>hit</code> is false or <code>internaldata[0]</code> (-60.0 for a <code>WoodenSwitch</code> or -100.0 for a <code>SteelSwitch</code>) if it's true with a factor of a 1/10 of the game's frametime.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#ontriggerenter","title":"OnTriggerEnter","text":"<p>Nothing happens if any of the following is true:</p> <ul> <li>We are in a <code>pause</code> or <code>minipause</code></li> <li>message is grabbed</li> <li><code>collisionammount</code> is higher than 1 (this is a debounce protection)</li> <li>The other gameObject tag isn't <code>BeetleHorn</code>, <code>BeetleDash</code>, <code>Icefall</code> and <code>Icecle</code> while it's not the player <code>beemerang</code></li> <li><code>data[4]</code> is not present or it is and its value is 1 while the other gameObject tag is <code>BeetleHorn</code> or <code>BeetleDash</code> (This basically enforces that <code>data[4]</code> being 1 means that only Kabbu's horn can actuate the switch)</li> </ul> <p>The following occurs:</p> <ul> <li><code>collisionammount</code> is incremented</li> <li>A HitPart particle is played at this position + (0.0, 0.5, 0.0)</li> <li>The main logic section occurs, see below for details</li> <li>If the other gameObject was the player <code>beemerang</code>, its <code>hit</code> is set to true and the <code>WoodHit</code> sound is played on the entity</li> <li>If the entity <code>originalid</code> isn't -1 (<code>None</code>), SwitchSound is called indicating a press</li> </ul> <p>What happens in the main logic depends on <code>data[0]</code>. </p>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#data0-is-1","title":"<code>data[0]</code> is 1","text":"<p>This does nothing if <code>hit</code> is true and the <code>TOG</code> modifier is not active:</p> <ul> <li>If <code>data[1]</code> isn't negative, the event at its id is started which this being the caller. Otherwise, the regionalflag slot at <code>regionalflags</code> and the flag slot at <code>activationflag</code> are set to true</li> <li><code>hit</code> is set to true unless the <code>TOG</code> modifier is active in which case, the value is toggled instead</li> <li>If the entity <code>originalid</code> is -1 (<code>None</code>), its <code>iskill</code> is set to true</li> <li>If the entity <code>originalid</code> is the <code>WoodenSwitch</code> animid, the <code>moveobj</code> angles are set to (0.0, -60.0, 0.0)</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#data0-is-0","title":"<code>data[0]</code> is 0","text":"<p>This depends on <code>data[1]</code>. If it's not 1, then <code>hit</code> is set to true and the regionalflag slot at <code>regionalflags</code> and the flag slot at <code>activationflag</code> are set to true. If it's 1 and the <code>actioncooldown</code> expired:</p> <ul> <li><code>hit</code> is toggled</li> <li><code>actioncooldown</code> is set to 30.0</li> <li>If the <code>activationflag</code> isn't negative, the corresponding flag slot is set to <code>hit</code></li> <li>For each <code>Switch</code> in the map excluding this object, if its <code>data[0]</code> is 0, its <code>data[1]</code> is 1 and its <code>activationflag</code> isn't negative and matches this object's, its <code>hit</code> is set to this object <code>hit</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#common-end","title":"Common end","text":"<p>Finally, no matter which branch applied, if <code>data[2]</code> exists and it's negative, <code>actioncooldown</code> is set to it.</p>"},{"location":"Entities/NPCControl/ObjectTypes/Switch/#hazardsonobjectstay","title":"Hazards.OnObjectStay","text":"<p>If the NPCControl passed has this type, it returns true which allows it to stay in collision with the Hazards.</p>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/","title":"TempPlatform","text":"<p>A platform that can only be stood on by the player for a limited amount of time before respawning the player. The amount of frames the player can stay on it and some animation timings are configurable.</p>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: The amount of time in frames that the player can be on the platform</li> <li><code>data[1]</code>: This needs to be 1 in order for the respawn functionality to work</li> <li><code>data[2]</code>: This needs to be 1 in order for the respawn functionality to work</li> <li><code>data[3]</code>: If 0, when the player is on the platform, the x local position of the entity.<code>model</code> will change to be random between -0.05 and 0.05 which makes it shakes horizontally. If it is 1 instead, the <code>Shaking</code> animation clip will play on the entity.<code>anim</code> when the player.entity.<code>feet</code> (its ground detector) collides with the platform</li> <li><code>vectordata[0].x</code>: The time in frames to wait from the moment a <code>FlyTrapPlatform</code> (if it is one) is done with its closing animation with the player being teleported in the air to the moment the fade out occurs</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> <li>entity.<code>model</code> tag is set to <code>Platform</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/#update","title":"Update","text":"<p>The player.entity.<code>forceclosemove</code> is set to <code>hit</code> (whether or not the player is on the platform). This means that when the player gets on the platform the Follow logic will use the CloseMove version which makes the followers of the player follow them much more closely.</p> <p>What happens after depends on the <code>hit</code> value</p> <p>If it is true:</p> <ul> <li>If the <code>actioncooldown</code> hasn't expired yet, it is decremented by the game's frametime and if <code>data[3]</code> is 0, the entity.<code>model</code> local position is set to (Random.Range(-0.05, 0.05), 0.0, 0.0) (this makes it shake horizontally)</li> <li>If the <code>actioncooldown</code> expired on the last update cycle (checked by being above -99999.0), it is set to -100000.0 and if <code>data[1]</code> and <code>data[2]</code> are both 1, the RespawnPlayer coroutine is started (see its section section for details).</li> </ul> <p>If it is false:</p> <ul> <li><code>actioncooldown</code> is set to <code>data[0]</code></li> <li>The entity.<code>model</code> local position is set to Vector3.zero</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/#respawnplayer","title":"RespawnPlayer","text":"<p>This is a coroutine only used by this object that aims to respawn the player with fade out/fade in.</p> <p>First, <code>minipause</code> is set to true.</p> <p>If the player.<code>beemerang</code> is present, it is destroyed.</p> <p>From there, there is a guard clause where most of the logic of this method is performed if this is indeed a TempPlatform with the entity.<code>originalid</code> being the <code>FlyTrapPlatform</code> animid. It should be noted that under normal gameplay, this clause is always fufilled because there is no <code>TempPlatform</code> in the game that has another animid and this method is only called by the <code>TempPlatform</code>'s Update. That being said, no matter if it is fulliled or not, after most of the logic, <code>minipause</code> is set back to false and a frame is yieled.</p>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/#respawnplayer-main-logic","title":"RespawnPlayer main logic","text":"<p>As for the main logic, all Hornable objects (Dropplet ice cubes) are gathered and for any of object type <code>IceCube</code> that is less than 4.5 away from this object's position + Vector3.up * 10.0, ShatterDroppletIce is called on their <code>parent</code> dropplet.</p> <p>The camera is then frozen by placing the <code>camtarget</code> and <code>camtargetpos</code> to null followed by the <code>Bite</code> sound being played and the <code>Close</code> animation clip being played on the entity. This animation clip name corresponds to a non standard animation. All followers are teleported very close to the player using TeleportFollowers and a yield of 0.07 seconds occurs.</p> <p>After the yield, all the playerdata entities's <code>rigid</code> gets placed in kinematic mode. The player is then placed at this object's position, but very high in the air offscreen by having the y component be 1000.0 before the followers are teleported again using TeleportFollowers. From there, <code>vectordata[0].x</code> frames are yielded using a while loop and a temporary timer that decrements by the game's frametime before a frame is yielded until the timer is exhausted.</p> <p>From there, a fadeout to black is played with a speed of 0.1 and then, a second is yielded.</p> <p>Once this is over, the player's position is set to its <code>lastpos</code> field, the followers are teleported once again using TeleportFollowers and the entity of this object has its <code>Open</code> animation clip played. This is again a non standard animation. The camera is reset to default instantaneously and a frame is yieled.</p> <p>Finally, a fade in from black is done with a speed of 0.1 and all playerdata entities's <code>rigid</code> are taken out of kinematic mode.</p>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/#ontriggerenter","title":"OnTriggerEnter","text":"<p>If the other collider is the player.entity.<code>feet</code> (its ground detector) then 2 things occurs:</p> <ul> <li>If <code>data[3]</code> is 1, the <code>Shaking</code> animation clip will play on the entity.<code>anim</code> when the player.entity.<code>feet</code> (the ground detector) collides with the platform. This is a non standard animation</li> <li><code>hit</code> is set to true</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/#ontriggerexit","title":"OnTriggerExit","text":"<p>This does nothing if the other gameObject isn't the player or the player.entity.<code>feet</code>.</p> <p><code>hit</code> is set to false and if we aren't in a <code>minipause</code>, the <code>StayOpen</code> animation clip is played on the entity.<code>anim</code>. This is a non standard animation</p>"},{"location":"Entities/NPCControl/ObjectTypes/TempPlatform/#effects-of-the-platform-and-platformnoclock","title":"Effects of the <code>Platform</code> and <code>PlatformNoClock</code>","text":"<p>The same than PathPlatform with <code>noclock</code> staying false. This mainly allows the player to be childed to the platform.</p>"},{"location":"Entities/NPCControl/ObjectTypes/TriggerSwitch/","title":"TriggerSwitch","text":"<p>A trigger zone that controls either its own <code>hit</code> value when the player enters or exits the zone or it controls the <code>hit</code> value of another NPCControl when the player enters the zone, but not when they exit it.</p>"},{"location":"Entities/NPCControl/ObjectTypes/TriggerSwitch/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: If it's -1, the trigger manages its own <code>hit</code> value when the player enters or exits the zone. If it's 0 or above, it manages the <code>hit</code> value of the map entity whose id is that value when the player enters the zone (not when they exit it). NOTE: any values below -1 are considered invalid because while this trigger <code>hit</code> will be set when the player enters the zone, it will not be set when the player exits the zone</li> <li><code>data[1]</code>: This has 3 possible valid values (any other values is invalid and causes illogical behaviors):<ul> <li>-1: the <code>hit</code> value of the refered entity will be toggled when entered. If <code>data[0]</code> is -1 on top of this, the <code>hit</code> value will always be set to false when the player exits the zone</li> <li>0: the <code>hit</code> value of the refered entity will be set to false when the player enters the zone. If <code>data[0]</code> is -1, it will be set to true when the player exits the zone</li> <li>1: the <code>hit</code> value of the refered entity will be set to true when the player enters the zone. If <code>data[0]</code> is -1, it will be set to false when the player exits the zone</li> </ul> </li> <li><code>data[2]</code>: If it's 1, the player.<code>beemerang</code> is destroyed when entering the zone</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/TriggerSwitch/#additional-data","title":"Additional data","text":"<ul> <li><code>regionalflag</code>: If it's positive, it's the regionalflag slot that is set to true when the player collides with this object.</li> <li><code>activationflag</code>: If it's above 0, the flag slot that is set to true when the player collides with this object. It is not possible to specify 0 and will be treated the same as not providing a value.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/TriggerSwitch/#setup","title":"Setup","text":"<p>A few adjustements occurs:</p> <ul> <li>The entity.<code>alwaysactive</code> is set to true</li> <li>The gameObject's isStatic is set to true</li> <li>The entity.<code>rigid</code> is placed in kinematic mode without gravity</li> <li><code>nointeract</code> is set to true</li> <li>The layer is set to 0 (default)</li> <li>The <code>scol</code> is disabled</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/TriggerSwitch/#update","title":"Update","text":"<p>If the <code>timer</code> hasn't expired yet, it is decremented by the game's frametime clamped from 0.0 to infinity. Otherwise, if it is 0.0 and the entity isn't <code>dead</code>, a Death coroutine is started with the entity.</p>"},{"location":"Entities/NPCControl/ObjectTypes/TriggerSwitch/#ontriggerstay","title":"OnTriggerStay","text":"<p>This does nothing if any of the following is true:</p> <ul> <li>The player isn't present</li> <li>The other gameObject isn't the player</li> <li>We are <code>inevent</code></li> <li>We are in a <code>pause</code></li> <li><code>hit</code> is true </li> </ul> <p>The regionalflag slot at <code>regionalflags</code> and the flag slot at <code>activationflag</code> are set to true when applicable.</p> <p>We resolve the entity.<code>npcdata</code> this refers to by using <code>data[0]</code> as the map entity id, but if it's negative, it defaults to this NPCControl.</p> <p>The <code>hit</code> field of that entity is toggled if <code>data[1]</code> is -1 or set to true if <code>data[1]</code> is 1 or set to false otherwise.</p> <p>If the player <code>beemerang</code> is present and <code>data[2]</code> is 1, the player <code>beemerang</code> is destroyed.</p>"},{"location":"Entities/NPCControl/ObjectTypes/TriggerSwitch/#ontriggerexit","title":"OnTriggerExit","text":"<p>This does nothing if <code>data[0]</code> isn't -1 and the other gameObject isn't the player.</p> <p>The only logic here is <code>hit</code> is set to false unless <code>data[1]</code> is 0 where it is set to true.</p>"},{"location":"Entities/NPCControl/ObjectTypes/WaterSwitch/","title":"WaterSwitch","text":"<p>A switch with 2 states to control the vertical position of a child of the map's main mesh GameObject between 2 points (the lower one when not actuated and the upper one when actuated). The child index, the bounds of the y position to set and the amount of frames to spread the movement are configurable.</p>"},{"location":"Entities/NPCControl/ObjectTypes/WaterSwitch/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: A child index of the map's main mesh object that will be moved vertically</li> <li><code>data[4]</code>: If it's 1, the switch isn't allowed to be actuated using Kabbu's abilities</li> <li><code>vectordata[0].x</code>: The amount of frames to wait between full y position change</li> <li><code>vectordata[0].y</code>: The upper bound of the y position of the child pointed by <code>data[0]</code></li> <li><code>vectordata[0].z</code>: The lower bound of the y position of the child pointed by <code>data[0]</code></li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/WaterSwitch/#additional-data","title":"Additional data","text":"<ul> <li><code>activationflag</code>: If 0 or above, a flag slot that determines the starting <code>hit</code> value and also the slot whose value will be set to this switch <code>hit</code> value when toggled.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/WaterSwitch/#setup","title":"Setup","text":"<ul> <li>entity.<code>rigid</code> gets effectively fixed by placing it in kinematic mode without gravity and all constraints frozen </li> <li>entity.<code>alwaysactive</code> is set to true</li> <li><code>nointeract</code> is set to true</li> <li>if the <code>activationflag</code> flags slot is true, <code>hit</code> is also set to true.</li> <li>From there some adjustements happens based on the <code>originalid</code>'s AnimID(nothing happens if it doesn't match any of them):<ul> <li><code>SwitchCrystal</code> and <code>BigCrystalSwitch</code>: A GlowTrigger is added to the entity's <code>model</code>'s first child with its <code>parent</code> set to this object and the <code>glowparts</code> set to a single element corresponding to the MeshRender already attached to the first <code>model</code> child.</li> <li><code>WoodenSwitch</code> and <code>SteelSwitch</code>: <code>internaldata</code> is initialised to a single element being -60 if it's a <code>WoodenSwitch</code> or -100 if it's a <code>SteelSwitch</code>, Then, the <code>moveobj</code> is set to the entity's <code>model</code> first child and if <code>hit</code> was set to true earlier, its angles are set to (0.0, <code>internaldata[0]</code>, 0.0)</li> </ul> </li> <li>If the player is present, all collision between the <code>boxcol</code> and the player's wall detector are ignored.</li> <li>If the <code>originalid</code> is not among <code>BigCrystalSwitch</code>, <code>WoodenSwitch</code> or <code>SteelSwitch</code>, AddPushder is called.</li> <li><code>internaltransform</code> is initialised to a single element being the child of the map's main object at index <code>data[0]</code> which is the object that will be moved vertically.</li> <li><code>data[0]</code> is then overriden to <code>vectordata[0].x</code> (the amount of frames to wait between full y position changes)</li> <li><code>vectordata</code> is completely overriden to a new array of 4 elements:<ul> <li>0: The loaded <code>vectordata[0]</code> before this override</li> <li>1: The absolute position of <code>internaltransform[0]</code>, but the y component is the loaded <code>vectordata[0].z</code> (the lower position to have the object move towards)</li> <li>2: The absolute position of <code>internaltransform[0]</code>, but the y component is the loaded <code>vectordata[0].y</code> (the higher position to have the object move towards)</li> <li>3: (The loaded <code>vectordata[0].x</code> before this override, 0.0, 0.0)</li> </ul> </li> <li><code>internaltransform[0]</code>'s isStatic is set to false</li> <li>If <code>hit</code> is true, <code>vectordata[0].x</code> is set to the loaded value (which will have the object move to its upper bound position). Otherwise, <code>vectordata[0]</code> is set to Vector3.zero (which will have the object move to its lower bound position).</li> <li>The y component of the position of <code>internaltransform[0]</code> is set to the loaded <code>vectordata[0].y</code> if <code>hit</code> is true or to the loaded <code>vectordata[0].z</code> if it's false. This sets the starting y position according to the switch <code>hit</code> value.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/WaterSwitch/#update","title":"Update","text":"<p>The y position of <code>internaltransform[0]</code> (the object to vertically move) is set via a SmoothLerp from <code>vectordata[1]</code> (the lower bound position) to <code>vectordata[2]</code> (the higher bound position) with a factor of <code>vectordata[0].x / vectordata[3].x</code>. There is a special case where if the <code>startlife</code> is less than 20.0 frames, the factor is 1.0 which makes the upper bound be the position to set.</p> <p>After, this is where <code>vectordata[0].x</code> is incremented or decremented by the game's frametime. It is incremented when <code>hit</code> is true and when <code>vectordata[0].x</code> hasn't reached <code>vectordata[3].x</code> yet (meaning it hasn't yet completed its upward travel). It is decremented if <code>hit</code> is false and <code>vectordata[0].x</code> is above 0.0 (meaning it hasn't yet completed its downward traval). This essentially adjusts the SmoothLerp factor up if <code>hit</code> is true and down if <code>hit</code> is false as long as it respects the range boundaries from 0.0 to <code>vectordata[3].x</code>.</p>"},{"location":"Entities/NPCControl/ObjectTypes/WaterSwitch/#ontriggerenter","title":"OnTriggerEnter","text":"<p>Nothing happens if any of the following is true:</p> <ul> <li>We are in a <code>pause</code> or <code>minipause</code></li> <li>message is grabbed</li> <li><code>collisionammount</code> is higher than 1 (this is a debounce protection)</li> <li>The other gameObject tag isn't <code>BeetleHorn</code>, <code>BeetleDash</code>, <code>Icefall</code> and <code>Icecle</code> while it's not the player <code>beemerang</code></li> <li><code>data[4]</code> is not present or it is and its value is 1 while the other gameObject tag is <code>BeetleHorn</code> or <code>BeetleDash</code> (This basically enforces that <code>data[4]</code> being 1 means that only Kabbu's horn can actuate the switch)</li> </ul> <p>The following occurs if we the above is fufilled:</p> <ul> <li><code>collisionammount</code> is incremented</li> <li>A HitPart particle is played at this position + (0.0, 0.5, 0.0)</li> <li><code>hit</code> gets toggled</li> <li>The <code>WaterFill</code> sound is played if <code>hit</code> is now true or the <code>WaterFill2</code> is played if it is now false. </li> <li>If <code>activationflag</code> isn't negative, the corresponding flag slot is set to <code>hit</code></li> <li><code>actioncooldown</code> is then set to 30.0</li> <li>If the other gameObject was the player <code>beemerang</code>, its <code>hit</code> is set to true and the <code>WoodHit</code> sound is played on the entity</li> <li>If the entity <code>originalid</code> isn't -1 (<code>None</code>), SwitchSound is called indicating a press</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/WindPusher/","title":"WindPusher","text":"<p>A zone that renders wind particles moving towards a point. If the player enters that zone, they will be pushed towards the same direction then the wind. The wind force, wind target position, wind sizes and the visual lifetime / speed are all congurable. There is also the option to only have this object in effect when another map entity <code>hit</code> value is true.</p>"},{"location":"Entities/NPCControl/ObjectTypes/WindPusher/#data-arrays","title":"Data Arrays","text":"<ul> <li><code>data[0]</code>: If 0 or above, the map entity id of the entity whose <code>hit</code> value determines if the wind particle should be playing or not on Update. If it's negative, the wind particles always play</li> <li><code>vectordata[0]</code>: The end position of the wind from the wind pusher position</li> <li><code>vectordata[1].x</code>: The base push force of the wind in units per second when the player is inside the wind zone</li> <li><code>vectordata[1].y</code>: The <code>boxcol</code>.size.x</li> <li><code>vectordata[1].z</code>: The <code>boxcol</code>.size.y when operated horizontally or <code>boxcol</code>.size.z when operated vertically</li> <li><code>vectordata[2].x</code>: If 0.1 or above, the startLifetime of the wind particles. This is optional, if it doesn't exist or it's below 0.1, the startLifetime will be 1/5 of the distance between the root transform and <code>vectordata[0]</code></li> <li><code>vectordata[2].y</code>: If 0.1 or above, the startSpeed of the wind particles. This is optional, if it doesn't exist or it's below 0.1, the startSpeed will be to the default constant speed defined in the prefab (5.0) * <code>vectordata[1].x</code> * 20.0.</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/WindPusher/#additional-data","title":"Additional data","text":"<ul> <li><code>boxcol</code>: OVERRIDEN. The <code>boxcol</code> is created on SetUp manually, but it doesn't remove the existing one meaning under these circumstances, the entity data shouldn't specify that it has one since it would make it so there's 2 <code>boxcol</code> with the loaded version not being accessible by the game</li> </ul>"},{"location":"Entities/NPCControl/ObjectTypes/WindPusher/#setup","title":"Setup","text":"<p>The entity.<code>alwaysactive</code> is set to true.</p> <p>The method then determines if we should operate the windpusher vertically or horizontally. It's vertically if the y distance between the wind pusher and <code>vectordata[0]</code> is greater than 3.0 and it's horizontally otherwise.</p> <p>The wind pusher y angle (not the x and z ones) is then set to face <code>vectordata[0]</code> which alignes the wind pusher horizontally with its wind end position (no vertical alignement is needed because the <code>boxcol</code> will be adjusted accordinginly and the wind particles gets their own rotation when operating vertically).</p> <p>The <code>boxcol</code> is created by adding a fresh trigger one. This implies that all fields pertaining to the <code>boxcol</code> when loading the entity data are overriden and they are not honored. The <code>boxcol</code> size and center depends on whether we operate horizontall or vertically:</p> <ul> <li>horizontally:<ul> <li>size of (<code>vectordata[1].y</code>, <code>vectordata[1].z</code>, distance between the root transform and <code>vectordata[0]</code>) </li> <li>center of (0.0, 0.0, hald of the distance between the root transform and <code>vectordata[0]</code>)</li> </ul> </li> <li>vertically: <ul> <li>size of (<code>vectordata[1].y</code>, distance between the root transform and <code>vectordata[0]</code>, <code>vectordata[1].z</code>) </li> <li>center of (0.0, hald of the distance between the root transform and <code>vectordata[0]</code>, 0.0)</li> </ul> </li> </ul> <p><code>internalvector</code> is initialised to a single element containing the up vector of the transform if operated vertically or the forward one if operated horizontally. This is supposed to indicate the normalised wind flow direction.</p> <p><code>internalparticle</code> is initialised to a single element that corresponds to the particle system of an instance of the <code>Prefabs/Particles/WindFunnel</code> prefab childed to the wind pusher with a position of (0.5, 0.5, 0.5). The angles are set to Vector3.zero when operating horizontally or (-90.0, 0.0, 0.0) when operating vertically (which makes it point up due to the prefab itself already having a 89.855 degrees rotation in y). From there, the data arrays loading as described in the section above occurs to adjust the particle system.</p>"},{"location":"Entities/NPCControl/ObjectTypes/WindPusher/#update","title":"Update","text":"<p>This update's sole purpose is to determine if we should keep the <code>internalparticle[0]</code> playing by calling Play on it or stop it by calling Stop on it. This only applies if <code>data[0]</code> isn't negative.</p> <p>If the <code>hit</code> field of the NPCControl at id <code>data[0]</code> is true or this object is itself <code>hit</code>, then we are playing the particle if it wasn't already playing. Otheriwse, if it was playing, we stop it.</p>"},{"location":"Entities/NPCControl/ObjectTypes/WindPusher/#ontriggerenter-if-the-other-collider-is-the-player","title":"OnTriggerEnter if the other collider is the player","text":"<p>All collisions between the player.entity.<code>detect</code> and the <code>boxcol</code> are ignored and the player.entity.<code>hitwall</code> is set to false.</p>"},{"location":"Entities/NPCControl/ObjectTypes/WindPusher/#ontriggerstay","title":"OnTriggerStay","text":"<p>If the player is free (with flying ignored), the other gameObject is the player and either <code>data[0]</code> is -1 or the <code>hit</code> field of the entity <code>npcdata</code> whose map entity id is <code>data[0]</code> is true, the player position is incremented by <code>internalvector[0]</code> (the direction of the wind normalized) * (the game's frametime * <code>vectordata[1].x</code>) * (0.25 if the player entity is <code>onground</code>, 1.05 if it's not).</p>"},{"location":"Enums%20and%20IDs/AnimIDs/","title":"AnimIDs","text":"<p>An <code>AnimIDs</code> is an int or enum value that represents the ID used to identify the animation controller of a certain Entity. They are used mostly for identification purposes because it turns out that the controller's name is a very good way to know what entity we are dealing with.</p>"},{"location":"Enums%20and%20IDs/AnimIDs/#about-the-int-format-vs-the-enum-format","title":"About the int format vs the enum format","text":"<p>There are 2 formats to AnimIDs: the int format and the enum format. The later is an enum defined in the game while the former is mostly defined by convention: it is assumed this format is respected throughout the codebase. The only difference is the enum format has everything shifted up by 1 because the value 0 represents <code>None</code> in the enum format while it represents the first AnimIDs <code>Bee</code> in the int format. The int format does not have a concept of a <code>None</code> value.</p> <p>The table below shows the int format as it is the most common, but it is important to mention not everything uses this format and there are often conversions done in game to work with either.</p>"},{"location":"Enums%20and%20IDs/AnimIDs/#animids-table","title":"AnimIDs table","text":"<p>The following table shows all the <code>AnimIDs</code> enum values:</p> ID Name 0 Bee 1 Beetle 2 Moth 3 LadybugKnight 4 ButterflyGirl 5 MessengerAnt 6 MinerAnt1 7 SleepyMinerAnt 8 OverseerMinerAnt 9 BeeMinerAnt 10 Mothiva 11 FuzzyMoth 12 MaskedMoth 13 CordycepsAnt 14 Mushroom 15 TestCube 16 TestButton 17 OldBoringBeetle 18 FlyChef 19 Jaune 20 Zasp 21 DrNeolith 22 Cactus 23 TestSign 24 SavePoint 25 DigMound 26 AntInnkeeper 27 AntKid 28 MothKid 29 Pillbug 30 OGBeetle 31 GenericAnt 32 AntSoldier1 33 Samira 34 BadgeBeetle 35 BounceShroom 36 SwitchCrystal 37 SodaCap 38 Armorpillar 39 AncientPressurePlate 40 PushRock 41 CoilyVine 42 Spuder 43 CrystalBerry 44 Seedling 45 Kina 46 Maki 47 Gen 48 Eri 49 ShielderAnt 50 TrappedMoth 51 MantisAccountant 52 AncientPlatform 53 LongAncientPlatform 54 BigCrystalSwitch 55 SmallAncientPlatform 56 Chubee 57 Thief 58 Bandit 59 SneilEnemy 60 Crickerly 61 CaravanSmolBug 62 LadybugGirl 63 LadybugBoy 64 Mar 65 Genow 66 Trist 67 OrangeBeetle 68 Acornling 69 Weevil 70 FlyTrapPlatform 71 CommonSticcBug 72 KungFuMantis 73 MrTester 74 AngryPlant 75 OmaBug 76 Madeleine 77 FlyTrap 78 MantisAcolyte 79 CurledVineGround 80 Venus 81 Bae 82 Barkeeper 83 EdgeBeetle 84 OrangeBarBug 85 Shades 86 RoyalGuard 87 MosquitoGal 88 StickShopkeeper 89 BeetleInnkeeper 90 ShyBee 91 ArrogantBee 92 BeeKid 93 ContestBee 94 AntSoldier2 95 AntCapitain 96 AntQueen 97 Libraryant1 98 Libraryant2 99 WaspTrooper 100 ScrewSwitch 101 Aphid 102 WoolyAphid 103 Cochinael 104 FatMinerAnt 105 WoodenSwitch 106 WoodenPlatform 107 MantisBarkeeper 108 SticcGirl 109 LadybugGHRed 110 LadybugGHOrange 111 SleepyStickBug 112 MantisChef 113 FarmerAnt1 114 FarmerAnt2 115 FarmerAnt3 116 BeeGuard 117 ProfHoneycomb 118 Hawk 119 Mayor 120 Midge 121 VenusGuardian 122 OldAnt 123 GenericAnt2 124 ButterflyGuy 125 FortuneTeller 126 Stratos 127 Delilah 128 BlackStickBug 129 OfferingAltar 130 Underling 131 Scarlet 132 Tanjerin 133 TanjerinHorn 134 GoldenSeedling 135 Pseudoscorp 136 Sandworm 137 Carmina 138 Burglar 139 MotherChomper 140 Sirfy 141 Isau 142 CricketShopkeeper 143 FakeLegStickBug 144 DragonflyGuy 145 CricketGuy1 146 CricketGuy2 147 FortuneSister 148 BeetleMerchantBag 149 MothMerchantBag 150 ButterflyGuyDR 151 StickBugDR 152 TermiteGirl 153 WaspInnkeeper 154 MuseumMoth 155 BumbleBarkeeper 156 CoolMosquito 157 RoachShaman 158 QueenBee 159 DocHB 160 HBAssistant 161 FashionBee 162 ToughBee 163 SmugBeeKid 164 TolBee 165 EdgeArtBee 166 FashionMoth 167 GuideBee 168 GiftShopBee 169 ChompyChan 170 BeeOverseer 171 WorkerBee1 172 WorkerBee2 173 Maldibee 174 GlassesMantis 175 BeeBot 176 SmallMothGuy 177 Abomihoney 178 Turret 179 Denmuki 180 BeeBoss 181 WaspScout 182 BigSailorGuy 183 SmallSailorGuy 184 SailorGirl 185 PierMantisCook 186 FatScubaAnt 187 ThinScubaAnt 188 Ahoneynation 189 Menderbot 190 ElectroPlatform 191 HoneyGrate 192 MadeleineButler 193 BLANK 194 NerdyCicada 195 Astotheles 196 Eophi 197 SmallMinerAnt 198 FarmerMinerAnt 199 ButterflyCMaster 200 ArcadeTermite 201 Scorpion 202 BankerAnt 203 Bulkbee 204 MantisMerchant 205 Krawler 206 Cape 207 CursedSkull 208 IcePillarObj 209 OldMoth 210 PinkMoth 211 Watcher 212 icepillar 213 SandPillar 214 WaspKing 215 Eremi 216 RollingRock 217 Abombhoney 218 WormBeetle 219 SnailBeetle 220 Kali 221 Bomby 222 DragonflyLady 223 CardGuard 224 HotelRecep 225 MIMosquito 226 Alex 227 Butomo 228 HaughtyAnt 229 SeedlingKing 230 Yin 231 Flowering 232 Plumpling 233 JumpingSpider 234 LeafbugNinja 235 LeafbugArcher 236 LeafbugClubber 237 Patton 238 MimicSpider 239 SkullCaterpillar 240 LongLegs 241 Centipede 242 Lilypad 243 ChomperBrute 244 WoodenPPlate 245 RopePlatform 246 Mantidfly 247 WaspDriller 248 WaspBomber 249 Jayde 250 WaspGeneral 251 WaspQueen 252 Futes 253 HungryAnt 254 TraitorWasp 255 WildChomper 256 Submarine 257 TermiteScientist 258 GazingTermite 259 EdgeTermite 260 SwordTermite 261 TermiteInnkeeper 262 TermiteSoldier 263 TermiteNasute 264 Zombee 265 Zombeetle 266 Bloatshroom 267 TermiteShopkeeper 268 TermiteBarkeeper 269 TermiteQuestgiver 270 TermiteKing 271 TermiteQueen 272 ButterflyGirl2 273 TiredLadybug 274 StickBug2 275 WeirdTermite 276 ShortTermite 277 ShortTermite2 278 TermiteGirl2 279 BandanaTermite 280 CherryMerchant 281 WorkingTermite 282 PierTermite 283 PoorTermite 284 PoorTermiteSister 285 ScarfTermite 286 TermiteCashier 287 TrialRoach 288 ScientistRoach 289 PrimalWeevil 290 TangySeller 291 ToyMerchant 292 Wizard 293 ColiseumTermite 294 RoyalTermiteWorker 295 SittingAnt 296 TermiteOwner 297 TermiteScientist2 298 Gachapon 299 MaskedMF1 300 MaskedMF2 301 MaskedMF3 302 MaskedMF4 303 FalseMonarch 304 Mothfly 305 MothflyCluster 306 Ironclad 307 ToeBiter 308 MidgeBroodmother 309 FLMinerAnt 310 FGMinerAnt 311 RPMinerAnt 312 CloakAnt 313 CicadaGuy2 314 StickbugGuy2 315 VeilBee 316 BumblebeeGirl 317 SmallBeetleGuy 318 LeafAnt 319 BookAnt 320 SmugWeakGuy 321 Layna 322 LaynaPet 323 BrotherTermite 324 SeedlingTermite 325 JojoTermite 326 WrappedTermite 327 Strider 328 DivingSpider 329 Cenn 330 Pisci 331 Ruffian 332 SandWyrm 333 SandWyrmTail 334 StagBeetle 335 PisciWall 336 Riz 337 RizSister 338 RizGrandpa 339 BackerStickBug 340 Zommoth 341 FitTermite 342 TermiteNasuteSmol 343 PeacockSpider 344 PrisonGate 345 PrisonGateLocal 346 SteelSwitch 347 MoleCricketGuy 348 MoleCricketGirl 349 UltimaxTank 350 Kenny 351 DeadLanderA 352 DeadLanderB 353 DeadLanderC 354 RoachElder 355 BuffRoachGuy 356 WalkingRoachGuy 357 BeeButler 358 BigBeetle 359 CowboyStickbug 360 RichAnt 361 RichKid 362 ShadyLadybug 363 RichMoth 364 TeaMoth 365 MaskStickbug 366 WindUp 367 PierGirl 368 KeyR 369 KeyL 370 Tablet 371 EverlastingKing 372 YinMoth 373 Pitcher 374 PitcherSummon 375 Poppy 376 BookWaspGuy 377 CardBumblebee 378 Effo 379 DragonflyBlacksmith 380 WaspTwinA 381 WaspTwinB 382 WaspBoyfriend 383 BombMaster 384 BombFanatic 385 OldSailorMantis 386 CardWasp 387 CardBumble 388 CardBee 389 CardJudge 390 Comfy 391 Soto 392 RoachGirl 393 RichMantis 394 RichStagBeetle 395 RichRhinoBeetle 396 CardStickbug 397 MasterSlice 398 BounceShroom2 399 FireKrawler 400 FireCape 401 FireWarden 402 TermiteGirl3 403 Cerise 404 WoodenPPlate2 405 RecipeGuy 406 Roy"},{"location":"Enums%20and%20IDs/BattleMaps/","title":"BattleMaps","text":"<p>A <code>BattleMaps</code> is an enum value that represent a map (aka room) in the game used exclusively for a battle. Each enum value is named after its corresponding prefab which contains the actual map.</p> <p>The battle maps prefabs are located at <code>Resources/prefabs/battlemaps</code> from the game's assets tree. </p>"},{"location":"Enums%20and%20IDs/BattleMaps/#battlemaps-table","title":"BattleMaps table","text":"<p>The following table shows all the <code>BattleMaps</code> enum values:</p> ID Name 0 Grasslands1 1 Desert1 2 Snakemouth1 3 AssociationHQ 4 Snakemouth2 5 Snakemouth3 6 Snakemouth4 7 Theater 8 GoldenBattle1 9 OutskirtsLow 10 Cave0 11 GoldenSettlementArena 12 GoldenBattle2 13 GoldenHillsBoss 14 GoldenBattle4 15 GoldenBattle5 16 HBsLab 17 Bakery 18 FactoryP 19 FactoryS 20 FactoryC 21 FactoryS2 22 SandCastle 23 SandCastleIce 24 HideoutBattle 25 HideoutAstotheles 26 SandCastleDark 27 SandCastleDarkIce 28 SandCastleRoof 29 SandCastleBoss 30 AntPalace 31 PlazaAttack 32 BridgeAttack 33 CastleAttack 34 Grasslands2 35 FarGrasslands 36 Swamplands 37 BarrenLands 38 ChomperCaves 39 ChomperCavesBoss 40 WaspPrison 41 WaspThrone 42 TermiteColiseum 43 AbandonedTent 44 Broodmother 45 KaliShop 46 MetalLake 47 StreamMountain 48 StreamMountainBoss 49 BugariaCommercial 50 CaveOfTrials 51 UpperSnek 52 UpperSnekBoss 53 RubberPrisonInside 54 RubberPrisonOutside 55 WaspKingdomPrison 56 CarminaRoom 57 RubberPrisonBoss 58 MysteryIslandInside 59 GiantLair1 60 GiantLair2 61 GiantLairFridge 62 FinalBoss1 63 FinalBoss2 64 PitcherPlant 65 AntBridge 66 CardTourney 67 UndergroundBar 68 GiantLair3 69 GiantLair4 70 DefiantRootBattle 71 HBsLab2"},{"location":"Enums%20and%20IDs/BoardQuests/","title":"BoardQuests","text":"<p>A <code>BoardQuests</code> is a task to be done in the game. While most of them are optional, each chapters have one quest reserved to them which are mandatory. The quests are managed by the quests board system which tells which quests are accessible, open, taken or completed. The state of the quest board are saved on the Save File. They are directly mapped to the quest data entry.</p>"},{"location":"Enums%20and%20IDs/BoardQuests/#boardquests-table","title":"BoardQuests table","text":"<p>The following table shows all the <code>BoardQuest</code> enum value and their English names for convenience.</p> ID Name English Name 0 None No Quests 1 InnQuest Inn Review Required 2 ChuckQuest I Want a New Taste 3 TheaterQuest Theater Help Wanted! 4 ToyQuest Lost Toy 5 LadybugQuest My Brother is Gone! 6 UndergroundBar Requesting Assistance 7 CableCar Cable Car Bodyguard 8 SeedlingKing Bounty: Seedling King 9 FalseMonarch Bounty: False Monarch 10 MotherChomper Bounty: Devourer 11 Prologue Ch. 1: A Dysfunctional Trio 12 Chapter1 Ch. 2: Sacred Golden Hills! 13 Chapter2 Ch. 3: Factory Inspection 14 Chapter3 Ch. 4: Mysterious Lost Sands 15 Chapter4 Ch. 5: The Far Wildlands 16 Chapter5 Ch. 6: Assault at Rubber Prison 17 Chapter6 Ch. 7: The Everlasting Sapling 18 Crisbee I Wanna Get Better! 19 Kut My Specialty 20 Fry A Smiling Dish 21 Sandwyrm Bounty: Tidal Wyrm 22 Butomo Ore Wanted 23 PeacockSpider Bounty: Peacock Spider 24 Tanjerin Huuuuuuuuuu...!!! 25 ZaspDoll Lost Item 26 Leif Leif's Request 27 LibraryantRed Lost Books 28 Madeleine1 Butler Missing! 29 Venus Team Snakemouth... 30 Bee Vi's Request 31 PowerPlant Power Plant Investigation 32 CardGame Card Masters of Bugaria 33 CicadaBook Book Return! 34 Vivi I Want a Souvenir... 35 MenderQuest Helpers Needed At Once! 36 Kali Stolen Item 37 Isau Rare Item Wanted! 38 Bomby Dropped my Hat! 39 Madeleine2 Butler Missing Again! 40 GenEri Explorer Check! 41 Mun Help Me Get it Back! 42 BanditHunt Bandit Hunt 43 ArtBee In Search of Paint... 44 TermiteLunch Lunch Delivery! 45 Alex It's Time...! 46 Mayor Want to Relive Memories... 47 SeedlingHunt Seedling Hunt 48 Layna Best Friend In The Fog! 49 Eetl Parts Delivery 50 Farmer Hydration Crisis! 51 RizSis Sweets from Outside! 52 Wizard Find The Ingredients! 53 Eremi It's Too Hot! 54 MoleCricket In Search of Something 55 Maki Confidential 56 BadBook Awful's Beauty 57 WaspTwins They Took Her...! 58 BlacksmithGuy My Mecha Claw! 59 WorkerTermite Can't Sleep...! 60 Beetle Kabbu's Request 61 Rebecca Loose Ends 62 Roach A New Hope 63 StratosDelilah Getting Bored"},{"location":"Enums%20and%20IDs/Enemies/","title":"Enemies","text":"<p>An <code>Enemies</code> enum value represents a unique identifier to an enemy in battle. They are directly mapped to each entry in the enemy data of the game.</p> <p>They are note to be confused with Bestiary entry.</p>"},{"location":"Enums%20and%20IDs/Enemies/#enemies-table","title":"Enemies table","text":"<p>The following table shows all the <code>Enemies</code> enum value and their English names for convenience.</p> ID Name English Name 0 CordycepsAnt Zombiant 1 Mushroom Jellyshroom 2 Spuder Spider 3 Zasp Zasp 4 Cactus Cactiling 5 Pseudoscorpion Psicorp 6 Thief Thief 7 Bandit Bandit 8 ArmoredPoly Inichas 9 Seedling Seedling 10 FlyingSeedling Flying Seedling 11 MakiTutorial Maki 12 MothWeb Web 13 SpuderReal Spider 14 Sneil Numbnail 15 Mothiva1 Mothiva 16 Acornling Acornling 17 Weevil Weevil 18 MrTester Mr. Tester 19 AngryPlant Venus' Bud 20 FlyTrap Chomper 21 Acolyte Acolyte Aria 22 AcolyteVine Vine 23 Beetle Kabbu 24 VenusBoss Venus' Guardian 25 WaspTrooper Wasp Trooper 26 WaspBomber Wasp Bomber 27 WaspDriller Wasp Driller 28 WaspHealer Wasp Scout 29 Midge Midge 30 Underling Underling 31 Scarlet Monsieur Scarlet 32 GoldenSeedling Golden Seedling 33 Sandworm Arrow Worm 34 Carmina Carmina 35 SeedlingKing Seedling King 36 MidgeBroodmother Broodmother 37 Plumpling Plumpling 38 Flowering Flowerling 39 Burglar Burglar 40 BanditLeader Astotheles 41 MotherChomper Mother Chomper 42 Ahoneynation Ahoneynation 43 BeeBot Bee-Boop 44 BeeTurret Security Turret 45 ShockWorm Denmuki 46 BeeBoss Heavy Drone B-33 47 MenderBot Mender 48 Abomihoney Abomihoney 49 Scorpion Dune Scorpion 50 SandWyrm Tidal Wyrm 51 Kali Kali 52 Zombee Zombee 53 Zombeetle Zombeetle 54 ZombieRoach The Watcher 55 PeacockSpider Peacock Spider 56 Bloatshroom Bloatshroom 57 Krawler Krawler 58 Cape Haunted Cloth 59 SandWall Sand Wall 60 IceWall Ice Wall 61 CursedSkull Warden 62 WaspKingIntermission Wasp King 63 JumpingSpider Jumping Spider 64 MimicSpider Mimic Spider 65 LeafbugNinja Leafbug Ninja 66 LeafbugArcher Leafbug Archer 67 LeafbugClubber Leafbug Clubber 68 SkullCaterpillar Madesphy 69 Centipede The Beast 70 ChomperBrute Chomper Brute 71 Mantidfly Mantidfly 72 WaspGeneral General Ultimax 73 WildChomper Wild Chomper 74 TermiteSoldier Cross 75 TermiteNasute Poi 76 PrimalWeevil Primal Weevil 77 FalseMonarch False Monarch 78 Mothfly Mothfly 79 MothflyCluster Mothfly Cluster 80 Ironclad Ironnail 81 ToeBiter Belostoss 82 Ruffian Ruffian 83 Strider Water Strider 84 DivingSpider Diving Spider 85 Cenn Cenn 86 Pisci Pisci 87 DeadLanderA Dead Lander \u03b1 88 DeadLanderB Dead Lander \u03b2 89 DeadLanderG Dead Lander \u03b3 90 WaspKing Wasp King 91 EverlastingKing The Everlasting King 92 Maki Maki 93 Kina Kina 94 Yin Yin 95 UltimaxTank ULTIMAX Tank 96 Zommoth Zommoth 97 Fisherman Riz 98 Pitcher Devourer 99 SandWyrmTail Tail 100 PisciWall Rock Wall 101 KeyR Ancient Key 102 KeyL Ancient Key 103 Tablet Ancient Tablet 104 PitcherFlytrap Flytrap 105 FireKrawler FireKrawler 106 FireWarden FireWarden 107 FireCape FireCape 108 IceKrawler IceKrawler 109 IceWarden IceWarden 110 TANGYBUG |glitchy,1|TANGYBUG|glitchy| 111 Stratos Stratos 112 Delilah Delilah"},{"location":"Enums%20and%20IDs/Events/","title":"Events","text":"<p>An event is a coroutine the game can use to execute scripted code that applies specifically to this moment. They are typically used for cutscenes, but they may be used for any general purposes so long as the code is compatible at the moment it is being executed.</p> <p>Each event's code is located in the <code>EventControl</code> component and it must follow this convention for its signature:</p> <pre><code>IEnumerator EventX()\n</code></pre> <p>Where X is a unique int value specific to this event. They are usually private because they should not be called directly. <code>EventControl</code> has all the utilities the game needs to manage the events.</p> <p>There are many known way to trigger an event. Here is a list of the currently known ones:</p> <ul> <li>Manually via the <code>EventControl.StartEvent</code> method</li> <li>SetText's Event command</li> <li><code>MapControl</code>'s <code>autoevent</code> system</li> <li>A wide variety of Entity can have a way to trigger a configurable event</li> </ul> <p>Since they are coroutines, they have the ability to wait for specific amounts of time or until certain tasks are done. This makes it perfect for any kinds of specific scripts the game may want to run if the content only applies to a specific situation. While SetText is very powerful, events are way more powerful since it gives direct control of the game.</p>"},{"location":"Enums%20and%20IDs/Events/#events-table","title":"Events table","text":"ID Description 0 Chapter 1 approaching the hanged bridge in upper Snakemouth Den 1 Chapter 1 cutscene after hitting the bridge switch in Snakemouth Den 2 Chapter 1 getting in the first map of Snakemouth Den (tattle tutorial) 3 Asking a chef to cook. Also used for each of the special recipes quest 4 Chapter 1 pushing the 2 pressure plates in front of the large door in Snakemouth Den 5 Chapter 1 cutscene of falling into the trap in front of the big door in Snakemouth Den 6 Chapter 1 approaching the spider web with Leif in it 7 Talking to the enemy tester (Zombiant) in the Test Room 8 Selecting new file 9 Talking to the party changer (Eetl) in the Test Room 10 Chapter 1 getting near Chuck (before getting Kabbu\u2019s horn field skill) 11 Chapter 1 arriving on the map with the Snakemouth Den entrance 12 Trying to go the wrong way and have the team turn back immediately (used at multiple places) 13 Examining the explorer\u2019s note at Snakemouth Den. Also used when examining Elizant I portrait at the Ant Palace Library 14 Chapter 1 approaching the back exit of the map before the door in Snakemout Depths 15 Retrying a battle 16 Prologue approaching Eetl and Vi 17 Chapter 1 handing over the permit to the gatekeeper of the Outskirt 18 Chapter 1 hitting the switch in Snakemouth Depths 19 Chapter 1 approaching the first yellow crystal 20 Chapter 1 request to hit the first yellow crystal again 21 Chapter 1 Arriving to the map with the door in Snakemouth Depths (water drops explanation cutscene) 22 Loading a save file 23 Chapter 1 hitting either big switch in Snakemouth Depths (for the door) 24 Chapter 1 unlocking the door in Snakemouth Depths 25 UNUSED, likely was an event played before event 26 in the Sanakemouth Den Treasure room 26 Chapter 1 approaching the Ancient Mask in Snakemouth Depths 27 Examining the roach statue in Snakemouth Depths 28 Talking to Samira 29 Using the Ant Compass 30 UNUSED, was used in the demo by talking to the Zombiant at the room behind the large door at Snakemouth Den 31 Talking to Leby\u2019s brother after killing the monsters near after taking the My Brother is Gone! quest 32 UNUSED, Tod's quest event in the demo 33 Talking to Artis to check for hard mode bosses beaten 34 Giving the Hearty Breakfast to Chuck after taking the I Want a New Taste quest 35 Talking to the merchant guy in the Theater for the first time (Green Bug Ranger cutscene) 36 Buying the Green Bug Ranger Plushie at the Theater 37 Examining the Inn\u2019s founders portrait 38 Examining the Ant City Plaza statue 39 Practicing a play at the Theater for the Theater Help Wanted! quest 40 Starting a play at the Theater 41 UNUSED, asking Tristan to play a song in the demo 42 Taling to Mr Tester in the Test Room 43 Getting healed by Venus or saying Let\u2019s Talk to her 44 Say We\u2019ll help you train to Crisbee after taking the I Wanna Get Better! quest 45 Approaching the exit through the throne room at the Ant Palace after the end of Chapter 1 46 Chapter 2 &amp; 3 getting out of the throne room at the Ant Palace after the start of either Chapter 47 Chapter 2 approaching the tunnel entrance to the Golden Path 48 Talking to Diana 49 Getting into a mine tunnel (both from the mines or to the mines) 50 Chapter 2 opening the windmill doors at the Golden Settlement. Also used when pulling the level at the top of the Golden Hills. Also used when pulling the lever to the door at the Golden Settlement that leads to the Lost Sands 51 Chapter 2 approaching Aria at the center of Golden Settlement 52 Chapter 2 waiting for nightfall at Golden Settlement 53 Examining the Venus statue from the balcony at the Inn at Golden Settlement 54 Starting to play Whack-A-Worm 55 Finishing to play Whack-A-Worm 56 Chapter 2 arriving to the West map of the Golden Settlement during the festival 57 Chapter 2 starting the eating competition at the Golden Settlement 58 Chapter 2 starting the ceremony during the festival at the Golden Settlement 59 Interacting with an object that requires a key item 60 Leaving the map with the Explorer Association through the North after the end of Chapter 1 61 Entering the Underground Bar at Ant City commercial area 62 Approaching Venus\u2019s bud when arriving at the Golden Hills 63 Approaching Eetl at the association after the end of Chapter 1 64 Chapter 2 approaching the center of the Ant city plaza (hungry cutscene) 65 Talking to spy data selling guy at the Underground Bar 66 Chapter 2 getting a Big Crank piece 67 Chapter 2 placing the Big Crank at the Golden Hills 68 Riding a wooden platform elevator (Golden Hills and Defiant Root/Bee Kingdom Hive entrance. Also used for the train at the Honey Factory) 69 Chapter 2 talking to Zasp about the eating competition in the main room of Golden Settlement at night 70 Chapter 2 approaching the backside of the map with the Big Crank Bottom Half at the Golden Hills 71 Talking to the Fortune Teller at the Golden Settlement 72 Chapter 2 prompt for the offerings at the top of the Golden Hills 73 Chapter 2 approaching Venus at the top of the Golden Hills 74 Approaching Elizant II at the throne room of the Ant Palace after the end of Chapter 2 75 Talking to Team Slacker for the first time 76 Arriving at the Golden Settlement after the end of Chapter 2 77 Talking to Levi after taking the Requesting Assistance quest (both at Ant City and at the Golden Path tunnel) 78 Chapter 3 spinning the crank at the Outskirt 79 Approaching the Underground Bar entrance after completing the Requesting Assistance quest 80 Getting in the Professor Honeycomb\u2019s room for the first time at the Bee Kingdom Hive. Also used when talking to the Honey Factory shopkeeper for the first time. Also used when approaching Shades for the first time at the Underground Bar 81 Buying a charm at Defiant Root 82 Using the Bed Bug 83 Talking to Doppel at the Underground Bar 84 Chapter 3 getting scanned at the Bee Kingdom Hive entrance. Also used when exiting the room through the north) 85 Using the B.O.S.S system in H.B\u2019s room at Bee Kingdom Hive 86 Chapter 3 talking to Zasp or Mothiva or Gen &amp; Eri at the Bee Kingdom Hive to tell them to go to the meeting point 87 Chapter 3 approaching the Bee Queen\u2019s room entrance at the Bee Kingdom Hive after gathering everyone to the meeting point 88 Chapter 3 entering the Honey Factory for the first time 89 Chapter 3 using the Factory Pass on the terminal at the Honey Factory. Chapter 6 also used when using the Explorer Permit on the terminal or unlocking a door at Rubber Prison 90 Talking to Carmina at the Underground Bar 91 Talking to the cable car technician at the Golden Path (Cable Car Bodyguard quest). Also used for examining the cable car 92 Say We\u2019ll help you train to Crisbee after taking the I Wanna Get Better! Quest. Also used similarly with Fry after taking the A Smiling Dish quest 93 Chapter 3 approaching the area where the merchants gets ambushed by bandits and wasps 94 Hitting a tree with Kabbu\u2019s Horn to make a bridge 95 Chapter 3 hitting the switch on the first room of the factory of the Honey Factory 96 Chapter 3 unlocking the door with the 3 Factory Pass at the Honey Factory. Also used when unlocking the one in the storage room 97 Chapter 3 approaching Gen &amp; Eri getting harassed by a Bee-Boop at the Honey Factory 98 Chapter 3 approaching Malbee getting harassed by Abomihoneys at the Honey Factory 99 Chapter 3 talking to the Overseer in the core room entrance at the Honey Factory 100 Chapter 3 using the Elevator at the Honey Factory in the west room from the entrance 101 Chapter 3 approaching the spot where Ahoneynation is at the Honey Factory 102 Chapter 3 talking to the Overseer in the back storage room at the Honey Factory. Also used when touching an enemy while she is following as well as reaching the other side of the room 103 Talking to the Seb for the first time after taking the Butler Missing! quest. Also used when talking to Madeleine afterwards 104 Getting out of the Honey Factory after the end of Chapter 3 (at the bridge) 105 Approaching Elizant II at the throne room of the Ant Palace after the end of Chapter 3 106 Beating a Card Master at Spy Cards (before getting their suit card). Also used when talking to Crow about Spy Cards 107 Going to Metal Island after paying the travel fee. Also used for riding the boat back 108 Getting spotted while in a stealth situation 109 Chapter 4 talking to Hawk at the ruins of a Roach Village at the Lost Sands. Also used when examining the Key at the Bandit Hideout. Also used when examining the dungeon\u2019s bar at the Bandit Hideout after getting captured. Also used when arriving at the room south to the dungeon at the Bandit Hideout for the first time. Also used when approaching the large item chest at the Bandit Hideout. Also used when opening the large item chest at Bandit Hideout. Also used when approaching Astotheles at the Bandit Hideout 110 Tanjerin breaking the rock 111 Chapter 4 approaching the Dune Scorpion at the Lost Sands 112 Chapter 4 placing the Sand Castle Key into its receptacle at the Lost Sands 113 Chapter 4 opening the upper left door in the west room on the first floor of the Ancient Castle. Chapter 4 also used when solving the puzzle for opening the door in the 4 pressure plates room at the Ancient Castle 114 Approaching Leif\u2019s family\u2019s house at the Ant City residential area after the start of Chapter 3 115 Getting ambushed after getting the Big Ancient Key at the Ancient Castle 116 Getting crushed by a rolling rock 117 Chapter 4 approaching the Watcher at the Ancient Castle 118 Chapter 4 getting the ANCIENT HALF at the Ancient Castle 119 Exiting the Ancient Castle after the end of Chapter 4 120 Arriving at the throne room of the Ant Palace after the end of Chapter 4 121 Trying to buy something at the Termacade 122 Showing the Full Suit Card to the knight at the entrance of the Spy Cards tournament at Metal Island 123 TO CHECK, Hitting a water crystal switch in Stream Mountain? 124 Approaching any bounty boss 125 Chapter 5 Approaching Make near the Far Grasslands entrance at the Lost Sands. Also used when approaching Maki at the Far Grasslands entrance 126 Talking to a broken Mender at the Honey Factory after taking the Helpers Needed At Once! quest 127 Using the Eliascope at the Bee Kingdom Hive residential area 128 Chapter 5 approaching the Leafbug tribes at the north exit of the second map at the Wild Swamplands 129 Chapter 5 using Kabbu\u2019s horn on a rock at the Wild Swamplands 130 Chapter 5 getting ambushed by the Leafbug tribes at the wooden bridge at the Wild Swamplands 131 Chapter 5 interacting with a breakable rock after getting ambushed by the Leafbug tribes at the Wild Swamplands 132 Approaching the Mother Chomper at the Chomper Caves 133 Hitting the donut shaped stone with Kabbu\u2019s horn at the Sand Desert. Also used after getting the Tardigrade Shield medal 134 Examining Chompy at Bee Kingdom Hive or at the red house at Ant City Plaza 135 Showing the Chomper Seed to Professor Honeycomb 136 Hitting the west lever at the Power Plant / Far Grasslands passage. Also used when hitting a lever to lower a wooden cage at the Wild Swamplands 137 Chapter 5 approaching The Beast at the Wild swamplands 138 Chapter 5 getting spotted by Wasps at the Wasp Kingdom Hive or its entrance at the Far Grasslands 139 Chapter 5 arriving at Jayde\u2019s room for the first time at the Wasp Kingdom Hive 140 Chapter 5 approaching the back of the throne room for the first time at the Wasp Kingdom Hive. Also used when approaching Vanessa II for the first time at the Wasp Kingdom Hive 141 Chapter 5 exiting Vanessa II\u2019s room after meeting her for the first time 142 Chapter 5 arriving at the throne room at the Ant Palace after leaving the Wasp Kingdom Hive 143 Chapter 6 exiting the throne room at the Ant Palace after the start of Chapter 6 144 Chapter 6 approaching Elizant II at the Golden Path tunnel 145 Using an elevator at the Termite Capital 146 Hitting the red thing with Kabbu\u2019s horn at the Forsaken Lands 147 Chapter 5 arriving at a certain map before seeing the silhouette of the Beast at the Wild Swamplands 148 Chapter 5 exiting the Wild Swamplands and meeting Maki at the Far Grasslands 149 Chapter 6 approaching the Termite Capital entrance for the first time at the Forsaken Lands. Also used when leaving or entering the Termite Capital 150 Chapter 6 approaching the broken bridge at the Forsaken Lands (before getting Vi\u2019s fly ability) 151 Chapter 6 approaching the Primal Weevil at the Forsaken Lands 152 Chapter 6 approaching Elizant II at the Termite Capital throne room 153 Examining the Subaquatic Maritime Neotransport. Also used when trying to disembark from it 154 Talking to Venus after giving the Queen\u2019s Dinner to Aria for the Team Snakemouth\u2026 quest 155 Talking to the permanent upgrade berry guy at Defiant Root 156 Using the Mysterious Piece in the receptacle of the Cave of Trials room. Also used when talking to the Holo Assistant 157 Hitting for the first time an ice crystal switch at the Ancient Castle 158 UNUSED (Opening the book object at Lost Sands, remnants of a cut quest involving Neolith) 159 Chapter 6 arriving at the Forsaken Lands for the first time 160 Talking to Ven after taking the Bandit Hunt quest. Also used when talking to Takkun after taking the Seedling Hunt quest. Also used when talking to Alex after taking the It\u2019s Time\u2026! quest 161 Approaching Mun getting attacked by bandits at the Outskirt 162 Talking to Jaune for the first time at the Bee Kingdom Hive. Also used for anyone involved in the trade chain. Also used when giving Jaune the Red Paint as well as after giving her 163 Entering the Colosseum at the Termite Capital 164 Chapter 6 approaching the end of the throne room after winning the Colosseum at the Termite Capital 165 Chapter 6 talking to the scientist near the Subaquatic Maritime Neotransport at the Termite Capital piers 166 Falling into the pit near Wizard\u2019s Tower at the Far Grasslands. Also used when using the capsule machine in the Wizard Tower at the Far Grasslands. Also used when talking to The Wizard 167 Talking to the pink spider at the Forsaken Lands 168 Getting kicked out of the Forsaken Lands 169 Hitting a switch at the Power Plant. Also used for hitting the level or any switches near the switch puzzle at Snakemouth Lab 170 DOES NOT EXIST 171 Arriving at the Broadmother map after taking the Power Plant Investigation quest 172 Arriving at the firefly room after taking the Best Friend In The Fog! quest. Also used when getting past said room for the first time 173 Giving the Stolen Silk to Kali 174 Using the mircowave at Termite Capitol 175 Approaching Ant City commercial area after taking the Explorer Check! Quest. Also used when approaching Cenn and Pisci at the Explorer Association area after taking the Explorer Check! quest 176 Approaching Riz at the Far Grasslands (before beating him) 177 Approaching the bandits at the Bandits Hideout after taking the Help Me Get it Back! quest. Also used when talking to Mun after retrieving her mask after taking the Help Me Get it Back! quest 178 Placing the Peculiar Gem in its Receptacle at Snakemouth Den 179 Hitting the switch to open the door in the first room at Snakemouth Lab. Also used when using a Lab Card on a terminal at Snakemouth Lab 180 Arriving at the first room of Snakemouth Lab for the first time 181 Placing a gear in the room located west from the main room at Snakemouth Lab 182 Approaching the large tank in the last room at Snakemouth Lab. Also used when trying to exit the room after the first event 183 Approaching Leif\u2019s family\u2019s house at the Ant City residential area for the second time and onward before beating Zommoth 184 Examining an hologram at Snakemouth Lab 185 186 Chapter 6 hitting the east wooden lever in the room with the save point on the second floor at Rubber Prison 187 UNUSED, triggers after 15 minutes of playtime if the demo timer feature is on 188 Arriving at the Wacka Farms after taking the Want to Relive Memories\u2026 quest 189 Talking to Librem in the Ant castle library 190 Chapter 6 examining or dashing into the computer at the Rubber Prison. Chapter 6 also used when turning on the backup power 191 Chapter 6 examining the bookshelf with missing books at the Rubber Prison 192 Getting into the crack at the Spy Card tournament room at Metal Island. Also used when getting out of Carmina\u2019s room at Metal Island 193 Chapter 6 spinning the crank after placing it at Rubber Prison. Chapter 6 also used when approaching Ultimax at the Rubber Prison 194 Chapter 6 approaching the exit to Giant\u2019s Lair at the Rubber Prison. Chapter 7 also used when approaching Venus at Giant\u2019s Lair 195 Talking to the Elom in the west cave at the Outskirt. Also used when leaving that cave 196 Talking to the secret tunnels guy at the mines. Also used when talking to Diana in the back room of the mines 197 Talking to Patton after getting lectured on how his services work 198 Chapter 7 approaching the refrigerator entrance for the first time at Giant\u2019s Lair 199 Chapter 7 approaching the Roach Village for the first time at Giant\u2019s Lair 200 Chapter 7 approaching the Wasp King at Giant\u2019s Lair 201 Using the lift that connects the refrigerator to the Roach Village at Giant\u2019s Lair. Also used when using the lift that connects the Roach Village to the first room at Giant\u2019s Lair 202 Chapter 7  talking to the roach elder about the Everlasting Sapling at Giant\u2019s Lair 203 Chapter 7 arriving at the roach village after beating Everlasting King (when the fade out is done) 204 Credits 205 Chapter 7 entering the Ant Palace after beating Everlasting King 206 Getting the Bad Book in the Wizard Tower at the Far Grasslands 207 Talking to Maki after taking the Confidential quest. Also used when accepting the explanation from Maki at the Far Grasslands. Also used when accepting to fight Maki 208 Talking to Eetl under RUIGEE for levelling 209 Talking to Bumble\u2019s sister after taking the They Took Her\u2026! quest 210 Participating in the Spy Cards tournament at Metal Island 211 DOES NOT EXIST 212 Talking to Vanessa II in post game for the first time 213 Examining the spot where The Beast was beaten for the first time in post game 214 Talking to the merchant on the leftmost part of Metal Island 215 Giving an item to the ant in the Wasp prison 216 Chapter 7 approaching the oven for the first time at Giant\u2019s Lair. Chapter 7 also used when turning a stove dial. Chapter 7 also used when destroying breakable rocks above the wind blower in the oven room at Giant\u2019s Lair 217 Digging Cerise out of the soft soil at the Bandit Hideout. Also used when talked to her for the first time at the Bandit Hideout 218 Checking a badge in H.B\u2019s room at the Bee Kingdom Hive 219 Interacting with the bed in the red house at Ant City Plaza 220 Talking to Yel 221 Chapter 3 Approaching the Lost Sands entrance for the first time 222 Loose Ends quest event 223 A New Hope quest event 224 Getting Bored quest event 225 Interacting with the sign near the north exit of the Explorers's Association"},{"location":"Enums%20and%20IDs/Items/","title":"Items","text":"<p>An <code>Items</code> enum value represents an item in the game which can be collected in the overworld. The items in possessions are saved in the Save File in 3 arrays corresponding to regular inventory, key items and stored items respectively. They are mapped directly to each item data entry.</p>"},{"location":"Enums%20and%20IDs/Items/#items-table","title":"Items table","text":"<p>The following table shows all the <code>Items</code> enum value and their English names for convenience.</p> ID Name English Name 0 CrunchyLeaf Crunchy Leaf 1 HoneyDrop Honey Drop 2 VitalitySeed Spicy Berry 3 GenerousSeed Burly Berry 4 VigorousSeed Super Pepper 5 BurlySeed Iron Seed 6 MoneySmall RESERVED 7 MoneyMedium RESERVED 8 Mistake Mistake 9 CookedLeaf Leaf Omelet 10 HoneydLeaf Honey'd Leaf 11 MagicDrops Magic Seed 12 ClearWater Clear Water 13 Mushroom Mushroom 14 CookedShroom Cooked Shroom 15 GlazedShroom Mushroom Salad 16 LeafSalad Leaf Salad 17 AphidEgg Aphid Egg 18 Omelet Fried Egg 19 HeartyBreakfast Hearty Breakfast 20 GlazedHoney Glazed Honey 21 HoneyShroom Sweet Shroom 22 HoneyDanger Sweet Danger 23 HardSeed Hard Seed 24 DotBall Dotted Ball 25 GBugRangerPlushie Bug Ranger Plushie 26 DangerShroom Danger Shroom 27 ExplorerPermit Explorer Permit 28 CookedDanger Cooked Danger 29 SweetCrystal Coal Crystal 30 SpicyBomb Spicy Bomb 31 PoisonBomb Poison Bomb 32 KingDinner Queen's Dinner 33 MushroomStick Mushroom Skewer 34 RoastBerry Roasted Berries 35 Abomihoney Abomihoney 36 ClearBomb Clear Bomb 37 AntCompass Ant Compass 38 ChomperSeed Chomper Seed 39 BerryJuice Berry Juice 40 NumbDart Numbnail Dart 41 Map Map of Bugaria 42 Ice Magic Ice 43 Battery Shock Berry 44 FrostBomb Frost Bomb 45 NumbBomb Numb Bomb 46 SleepBomb Sleep Bomb 47 ShavedIce Shaved Ice 48 AphidMilk Aphid Dew 49 HoneyIceCream Honey Ice Cream 50 HoneyMilk Sweet Dew 51 IceCream Ice Cream 52 LoreBook Lore Book 53 FrozenSalad Cold Salad 54 FlowerKey Flower Key 55 OfferingA Sun Offering 56 OfferingB Moon Offering 57 MothivaDoll Mothiva Doll 58 GHCrank Wooden Crank 59 CrankHalfA Big Crank Top Half 60 MainCrank Big Crank 61 CrankHalfB Big Crank Bottom Half 62 Abombhoney Abombination 63 SpyData Spy Data 64 PoisonSpud Danger Spud 65 BakedYam Baked Yam 66 FrenchFries Spicy Fries 67 BurlyChips Burly Chips 68 FlourBag Bag of Flour 69 YamBread Yam Bread 70 SpicyCandy Spicy Candy 71 BurlyCandy Burly Candy 72 DryBread Dry Bread 73 NutCake Nutty Cake 74 PoisonCake Poison Cake 75 ShockCandy Shock Candy 76 PlainTea Plain Tea 77 TangyBerry Tangy Berry 78 TangyJam Tangy Jam 79 TangyJuice Tangy Juice 80 SpicyTea Spicy Tea 81 BurlyTea Burly Tea 82 FrostPie Frost Pie 83 HeartBerry Heart Berry 84 BellBerry Bond Berry 85 TangyPie Tangy Pie 86 Donut Crisbee Donut 87 TangyCarpaccio Tangy Carpaccio 88 PoisonDart Poison Dart 89 BedBug Bed Bug 90 JellyBean Succulent Berry 91 CookedJellyBean Succulent Platter 92 DesertKey Desert Key 93 QuestBook Overdue Book 94 ChomperRibbon Pretty Ribbon 95 BeeCard Factory Pass 96 ShockShroom Agaric Shroom 97 ShellOil Shell Ointment 98 CrimsonOre Crimson Ore 99 BeeHat Bee Hat 100 BlankCard Blank Card 101 SpadeCard 1-Suit Card 102 DualCard 2-Suit Card 103 TriadCard 3-Suit Card 104 FullCard Full Suit Card 105 YinKey Heaven Key 106 YangKey Earth Key 107 LonglegSummoner Longleg Summoner 108 StolenSilk Stolen Silk 109 TrialKey Mysterious Piece 110 GameToken Game Tokens 111 HideoutKey Rusty Key 112 TanjerinHorn Orange Horn 113 SandCastleKey Sand Castle Key 114 SandCastleSmallKey Ancient Key 115 SandCastleBossKey Big Ancient Key 116 SnakemouthKey Peculiar Gem 117 BombyHat Top Hat 118 SeedlingCrystal Crystal Fruit 119 WaspKey Wasp Key 120 JaydeStew Jayde's Stew 121 BlackCherry Dark Cherries 122 CherryPie Cherry Pie 123 MiracleShake Miracle Shake 124 BerrySmoothie Berry Smoothie 125 Squash Squash 126 SquashCandy Squash Candy 127 SophiePetal Sophie Petal 128 SucculentCookie Succulent Cookies 129 Pudding Sweet Pudding 130 SquashSoda Mega-Rush\u2122 131 HPPotion HP Potion 132 ATKPotion ATK Potion 133 DEFPotion DEF Potion 134 TPPotion TP Potion 135 SuperHPPotion Super HP Potion 136 SuperTPPotion Super TP Potion 137 MPPotion MP Potion 138 ShadyNote Shady Note 139 BlackPaint Blackest Paint 140 RedPaint Red Paint 141 DefRootCloak Root Cloth 142 AntToy Ant Doll 143 MIToy Eastern Doll 144 MushroomCandy Mushroom Gummies 145 TermiteLunch Wrapped Lunch 146 CrownCrystal Crystal Crown 147 DrowsyCake Drowsy Cake 148 LeafCroisant Leaf Croissant 149 Package Package 150 RainbowCrystal Crystal Feather 151 FangCrystal Crystal Fang 152 CherryBomb Cherry Bombs 153 SquashPuree Squash Puree 154 MiteBurg Mite Burger 155 ProteinShake Aphid Shake 156 Guarana Mystery Berry 157 SmallGear Small Gear 158 MedGear Medium Gear 159 BigGear Big Gear 160 LabCard Lab Card 161 PrisonKey Prison Key 162 HustleSeed Hustle Berry 163 PrisonBookA History Book 164 PrisonBookB History Book 165 PrisonBookC History Book 166 PrisonBookD History Book 167 LeafUmbrella Leaf Umbrella 168 PoisonRibbon Venom Ribbon 169 NumbRibbon Shocking Ribbon 170 SleepRibbon Drowsy Ribbon 171 BigMistake Big Mistake 172 BurlyBomb Burly Bomb 173 BerryShake Berry Jam 174 BadBook Bad Book 175 MechArm Mechanical Claw 176 PlatinumCard Platinum Card 177 Coffee Hot Drink 178 CoffeeCandy Hustle Candy 179 SquashPie Squash Tart 180 PlumplingPie Plumpling Pie 181 DangerDish Danger Dish 182 HoneyPancake Honey Pancakes 183 FlameRock Flame Rock 184 CardTrophy Card Trophy 185 RedRibbon Team Ribbon 186 MoneyBig RESERVED"},{"location":"Enums%20and%20IDs/Maps/","title":"Maps","text":"<p>A <code>Maps</code> is an enum value that represent a map (aka room) in the game. Each enum value is named after its corresponding prefab which contains the actual map. </p> <p>The maps prefabs are located at <code>Ressources/prefabs/maps</code> from the game's assets tree. </p> <p>The current map is saved on the Save File.</p>"},{"location":"Enums%20and%20IDs/Maps/#maps-table","title":"Maps table","text":"<p>The following table shows all the <code>Maps</code> enum values:</p> ID Name 0 TestRoom 1 NearSnakemouth 2 OutsideSnakemouth 3 AntTunnels 4 DesertEntrance 5 DesertBadlands 6 DesertBookArea 7 DesertRockFormation 8 DesertTrenchSouth 9 BugariaMainPlaza 10 BugariaCommercial 11 SnakemouthBridgeRoom 12 SnakemouthDoorRoom 13 SnakemouthFallRoom 14 SnakemouthLake 15 SnakemouthEmpty 16 BugariaOutskirtsOutsideCity 17 BugariaOutskitsSnakemouthCorridor1 18 BugariaOutskirtsSnakemouthCorridor2 19 SnakemouthUndergrondDoor 20 SnakemouthMushroomPit 21 SnakemouthTreasureRoom 22 SnakemouthUndergroundRightA 23 SnakemouthUndergroundRightB 24 SnakemouthUndergroundLeftA 25 SnakemouthUndergroundLeftB 26 BugariaTheater 27 ChucksAbode 28 BugariaResidential 29 GoldenHillsCableCar 30 UndergroundBar 31 AntPalace1 32 AntPalace2 33 AntBridge 34 AntPalaceLibrary 35 GoldenPathTunnel 36 BOGoldenPath 37 AntPalaceWarRoom 38 GoldenHillsPath2 39 GoldenSettlementEntrance 40 GoldenSettlement1 41 GoldenSettlement1Night 42 GoldenSettlement2 43 GoldenSettlement2Night 44 GoldenHillsPath3 45 GoldenHillsDungeonEntrance 46 GoldenHillsDungeonLeftMain 47 GoldenHillsDungeonCrankLeft 48 GoldenHillsDungeonRightCrank 49 GoldenHillsLowerRightCrank 50 GoldenHillsDungeonLeftCrankHalf 51 GoldenHillsDungeonUpperMain 52 GoldenHillsDungeonUpperSide 53 GoldenHillsDungeonBoss 54 BugariaPier 55 BugariaOutskirtsEast1 56 BugariaOutskirtsEast2 57 BOLostSandsEntrance 58 DefiantRoot1 59 DefiantRootWell 60 DefiantRoot2 61 DefiantRoot3 62 BeehiveOutside 63 BeehiveThroneRoom 64 BeehiveScannerRoom 65 GoldenSettlement3 66 GoldenSettlement3Night 67 BeehiveMainArea 68 HBsLab 69 BeehiveBalcony 70 HoneycombsLab 71 JaunesGallery 72 HoneyFactoryEntrance 73 AntMinesBreakRoom 74 HoneyFactoryWorkerRooms 75 HoneyFactoryCore 76 DesertDREastEntrance 77 DesertFGBorder 78 DesertDRSouthEntrance 79 DesertBadgeAlcove 80 DesertCaravanMap 81 DesertSandPitArea 82 DesertBeforeGH 83 FactoryProcessingFirstRoom 84 FactoryProcessing2 85 FactoryProcessingPump 86 FactoryProcessingPuzzle1 87 FactoryProcessingPuzzle2 88 FactoryProcessingPuzzle3 89 FactoryProcessingMalbee 90 FactoryStorageMaze 91 FactoryStorageElevator 92 FactoryStorageMiniboss 93 FactoryStorageOverseer 94 MetalIsland1 95 DesertRoachVillage 96 DesertOasis 97 DesertOasisEntrance 98 DesertWestDunes 99 HideoutEntrance 100 HideoutCell 101 HideoutCentralRoom 102 HideoutLeftA 103 HideoutStairsRoom 104 HideoutGarden 105 HideoutWestStorage 106 HideoutRightA 107 DesertSandCastle 108 DesertMountain 109 DesertTrenchMiddle 110 DesertJumpPuzzle 111 DesertSouthern 112 DesertScorpion 113 DesertEastmost 114 GoldenSMinigame 115 Blank 116 SandCastleEntrance 117 SandCastleSlidePuzzle 118 SandCastleStatueRoom 119 SandCastleBasement 120 SandCastleRoof 121 SandCastleMainRoom 122 SandCastleBossKeyRoom 123 BugariaPlazaAttack 124 BugariaBridgeAttack 125 BugariaCastleAttack 126 SandCastlePressurePuzzle 127 SandCastleRockRoom 128 SandCastleBossRoom 129 SandCastleTreasureRoom 130 BugariaAssociationAttack 131 MetalIsland2 132 StreamMountain1 133 StreamMountain2 134 StreamMountain3 135 FGCave 136 SeedlingHaven 137 FarGrasslands1 138 FarGrasslandsOutsideCave 139 FarGrasslandsWizard 140 FarGrasslands2 141 FarGrasslandsLake 142 FarGrasslandsOutsideVillage 143 FarGrasslands3 144 FishingVillage 145 SwamplandsEntrance 146 FGOutsideSwamplands 147 WaspKingdomOutside 148 Swamplands2 149 BarrenLandsEntrance 150 BarrenLandsCD 151 Swamplands3 152 SwamplandsBridge 153 FarGrasslands4 154 SwamplandsBoss 155 ChomperCave1 156 ChomperCaves2 157 ChomperCaves3 158 Swamplands4 159 Swamplands5 160 Swamplands6 161 Swamplands7 162 Swamplands8 163 WaspKingdom1 164 WaspKingdom2 165 WaspKingdom3 166 WaspKingdom4 167 WaspKingdom5 168 WaspKingdomPrison 169 WaspKingdomJayde 170 WaspKingdomMainHall 171 WaspKingdomThrone 172 WaspKingdomQueen 173 TermiteOutside 174 TermiteMainPlaza 175 TermiteRoyalChamber 176 TermiteIndustrial 177 TermitePier 178 TermiteColiseum1 179 TermiteColiseum2 180 BarrenLandsBeefly 181 BarrenLandsAntTunnel 182 BarrenLandsMiniboss 183 MetalLake 184 SnakemouthTop 185 CaveOfTrials 186 WizardTowerBasement 187 WizardTowerStairs 188 WizardTowerAttic 189 BarrenLandsPinkSpider 190 BarrenLandsTanks 191 BarrenLandsMushrooms 192 AbandonedCity 193 BarrenLandsPumpkins 194 BarrenLandsCloud 195 BarrenLandsRock 196 AbandonedCityTent 197 PowerPlant 198 BroodmotherLair 199 BarrenLandsSideGPT 200 GoldenPathTunnel2 201 FGClearing 202 StreamMountain4 203 GoldenPitcher1 204 StreamMountain5 205 GoldenPitcher2 206 MysteryIsland 207 MysteryIslandInside 208 UpperSnekEntrance 209 UpperSnekTransition 210 UpperSnekSwitchPuzzle 211 UpperSnekBeforeBoss 212 UpperSnekPressurePlateRoom 213 UpperSnekBossRoom 214 UpperSnekMiddleRoom 215 UpperSnekPlatformRoom 216 UpperSnekRiverPuzzle 217 UpperSnekGeizerRoom 218 RubberPrisonPier 219 RubberPrisonCheckpointCorridor 220 RubberPrisonSpikeRoom 221 RubberPrisonCells1 222 RubberPrisonCells2 223 RubberPrisonLibrary 224 RubberPrisonCafeteria 225 RubberPrisonGym 226 RubberPrisonSecurity 227 HermitCave 228 MetalIslandAuditorium 229 RubberPrisonOffice 230 RubberPrisonThirdFloor 231 RubberPrisonGiantLairBridge 232 GiantLairEntrance 233 GiantLairDeadLands1 234 GiantLairDeadLands2 235 GiantLairFridgeOutside 236 GiantLairFridgeInside 237 GiantLairRoachVillage 238 GiantLairSaplingPlains 239 PitcherPlantArena 240 BugariaEndPlaza 241 BugariaEndBridge 242 BugariaEndThrone 243 WaspKingdomDrillRoom 244 GiantLairBeforeBoss 245 GiantLairBeforeBoss2"},{"location":"Enums%20and%20IDs/Medal/","title":"Medal / badge","text":"<p>A medal or sometimes internally refered to as <code>badge</code> is a collectible in the game that can be equipped. </p> <p>The medals in possession and their equipment statuses are saved in the Save File. </p> <p>Both Shades's and Merab's shops medals available pools and stock are also saved in the Save File. </p> <p>The IDs are mapped directly to the badge data entries and the name to the <code>BadgeTypes</code> enum value name.</p>"},{"location":"Enums%20and%20IDs/Medal/#medals-table","title":"Medals table","text":"<p>The following table shows all the <code>BadgeTypes</code> enum value and their English names for convenience.</p> Id Name English Name 0 HPPlus HP Plus 1 TPPlus TP Plus 2 Detector Detector 3 AttackUp Last Attack 4 DefenseUp Last Stand 5 SpeedUp Quick Flea 6 PoisonAttacker Poison Attacker 7 PoisonResistance Poison Resistance 8 Berserker Berserker 9 PoisonDefender Poison Defender 10 Empower Empower 11 DoublePain Hard Mode 12 SleepyResistance Sleep Resistance 13 MightyPeeble Mighty Pebble 14 SpikeBod Spiky Bod 15 Depower1 Break 16 Depower2 Break+ 17 HPScope Spy Specs 18 BumpAttack Bug Me Not! 19 SuperBlock Super Block+ 20 FavoriteOne Favorite One 21 NumbResis Numb Resistance 22 PoisonNeedle Poison Needles 23 StrongStart Strong Start 24 WeakStomach Weak Stomach 25 TPSaver TP Saver 26 ReversePoison Reverse Toxin 27 EternalPoison Eternal Venom 28 Beemerang2 A.D.B.P Enhancer 29 MightierPebble Mightier Pebble 30 DoublePainReal Hard Hits 31 Empower2 Empower+ 32 LifeSteal Life Stealer 33 FreezeResistance Freeze Resistance 34 ShockTrooper Shock Trooper 35 FrontSupport Front Support 36 BackSupport Back Support 37 Emfeeble Enfeeble 38 Emfeeble2 Enfeeble+ 39 Fortify Fortify 40 Fortify2 Fortify+ 41 NumbNeedle Sleepy Needles 42 EXPBoost EXP Booster 43 StatusBoost Status Booster 44 PoisonTouch Poison Touch 45 RelayTransfer Status Relay 46 FrostBite Frostbite 47 HeavySleeper Heavy Sleeper 48 SecurePouch Secure Pouch 49 PowerExchange Power Exchange 50 DefenseExchange Defense Exchange 51 Tardigrade Tardigrade Shield 52 ChargeUp Charge Up 53 ChargeUp2 Charge Up+ 54 LeafCloak Leaf Cloak 55 RandomStart Random Start 56 Meditation Meditation 57 ElecNeedles Electric Needles 58 NeedlePincer Block Heal 59 FreezeTime Extra Freeze 60 HeavyThrow Heavy Throw 61 Reflection Reflection 62 Prayer Prayer 63 AntlionJaws Antlion Jaws 64 HappyHeart HP Core 65 HappyTP TP Core 66 ResistAll Resist All 67 TauntPlus Deep Taunt 68 MiracleMatter Miracle Matter 69 VictoryBuzz Victory Buzz 70 HealingBuzz Triumph Buzz 71 CrazyPrepared Crazy Prepared 72 HPFunnel Life Cast 73 HardCharge Hard Charge 74 HealPlus Heal Plus 75 StatusMirror Status Mirror 76 LuckierDay Luckier Day 77 Plating First Plating 78 Seedling Seedling Affinity 79 BerryFinder Berry Finder"},{"location":"Enums%20and%20IDs/Musics/","title":"Musics","text":"<p>A <code>Musics</code> is an enum value that represent a song in the game. They are not to be confused with sound effects. Most of them have a corresponding int that tells whether the song is available and bougth at Samira's. The Samira list is saved in the Save File. </p> <p>The musics in the game are located at <code>Ressources/audio/music</code> from the game's asset tree.</p>"},{"location":"Enums%20and%20IDs/Musics/#notes-about-the-musics-table","title":"Notes about the musics table","text":"<p>Anything the game names <code>.</code> is either unused or its name display is explicitly excluded under normal gameplay.</p>"},{"location":"Enums%20and%20IDs/Musics/#musics-table","title":"Musics table","text":"<p>The following table shows all the <code>Musics</code> enum value and their English names for convenience.</p> ID Name English Name 0 Field0 Outskirts 1 Battle0 Let's fight, team! 2 Cave0 Snakemouth Den 3 Battle1 They Call Him Spuder 4 Calm The Everlasting Sapling 5 Inside0 Where Adventurers Gather 6 LevelUp Getting Stronger! 7 Theater Fine Arts 8 Tension It's Getting Scary! 9 Chef0 Let's Fry with Fry! 10 Moth The One Left Behind 11 Beetle . 12 Title Bug Fables 13 Field1 Blessed Golden Lands 14 Inside1 Dodgy Business 15 Inside2 In The Court of The Ant Queen 16 Dungeon0 The Sacred Hills 17 Mothiva Mothiva! SUPERSTAR! 18 Festival Harvest Festival 19 Battle2 Frenzied Sunflower Dance 20 Venus Venus, Goddess of Bountiful Harvests 21 Field2 Defiant Root 22 Dungeon1 The Bandits' Hideout 23 Miniboss Team, this one's stronger! 24 Field3 Lost Sands 25 Battle3 Oh no! WASPS! 26 Wind wind ambient 27 Water water ambient 28 Dungeon2 Work that Honey 29 Chef1 Kut it Up! 30 Chef2 Make it Crisbee! 31 Bee Bee Kingdom, Miles Above 32 Battle4 Mecha Bee Destroyer Blastlord 33 Dungeon2b Store that Honey 34 Sad The Ones Who... 35 MothivaCalm Bugaria's Latest Sensation! 36 BeeQ Bianca, Queen of All Bees 37 Tension2 Drums of War 38 MachineHum . 39 Battle5 The Watcher 40 Dungeon3 Lost Castle of Ancient Worship 41 Dungeon4 Swamp Where Dreams Drown 42 Field4 Forsaken Lands 43 Battle6 Team, it's getting serious! 44 Cave1 Caves 45 Sad2 Elizant II's Promise 46 Battle7 Cruel Beast, Devourer of Journeys 47 Field5 Lands Untamed 48 Submarine Snug as a Bug in a Sub 49 Termite Termite Capitol 50 Breathing breathing ambient 51 TermiteLoop DineMite Beats 52 WaspHive Wasp Kingdom 53 Dungeon5 Rubber Prison 54 Invasion Ant Kingdom, Under Attack...! 55 MetalIsland Summer Holiday at the Metal Island\u2122 56 Bounty Reckless For Glory 57 Centipede Centipede Attacks 58 Lab Lab Over Snakemouth 59 FlyingBee Flower Journey 60 Battle8 The Other One 61 Battle9 Battle Against Ultimax, Who Has A Tank 62 Alert ???? 63 Giant1 The Giant's Lair 64 Giant2 . 65 Giant3 . 66 Final1 The Usurper, Grasping for Power 67 Final2 Trascended, Overpowering, Everlasting 68 MiteKnight Mite Knight 69 Field6 Team... We've done it! 70 Pier The Sailors' Pier 71 Credits A Long Journey's End 72 Tension3 The Usurper 73 Field7 Bustling Ant Kingdom!"},{"location":"Enums%20and%20IDs/Skills/","title":"Skills","text":"<p>A <code>Skills</code> is an enum value that represent an ability that a player party member can use in battle if permitted by its skills data and RefreshSkills.</p>"},{"location":"Enums%20and%20IDs/Skills/#skills-table","title":"Skills table","text":"<p>The following table shows all the <code>Skills</code> enum value and their English names for convenience.</p> <p>For the order in which they are displayed in battle, consult the RefreshSkills documentation.</p> ID Name English Name 0 RESERVED RESERVED 1 RESERVED2 RESERVED 2 BeeRangMultiHit Tornado Toss 3 BeetleTaunt Taunt 4 Icefall Icefall 5 BeeFly Fly Drop 6 BeetleDig Under Strike 7 BubbleShield Bubble Shield 8 Empower Charge Up 9 PeebleToss Pebble Toss 10 HornDash Dash Through 11 SecretStash Secret Stash 12 DefenseBreak1 Break 13 DefenseBreakAll Break+ 14 AttackUp Empower 15 DefenseUp Fortify 16 NeedleToss Needle Toss 17 BubbleShieldLite Bubble Shield Lite 18 HurricaneBeemerang Hurricane Toss 19 PebbleTossPlus Boulder Toss 20 RevivalMassage Revival Massage 21 FrigidCoffin Frigid Coffin 22 ChargeUpPlus Charge Up+ 23 EmpowerPlus Empower+ 24 NeedlePincer Needle Pincer 25 IceRain Ice Rain 26 IceBeemerang Frost Relay 27 IceDrill Frozen Drill 28 AttackDown Enfeeble 29 AttackDownPlus Enfeeble+ 30 DefenseUpPlus Fortify+ 31 IceSphere Frost Bowling 32 HeavyStrike Heavy Strike 33 Sturdy Sturdy 34 FieldBeemerang Beemerang Toss 35 FieldHalt Beemerang Halt 36 FieldFly Bee Fly 37 FieldHorn Horn Slash 38 FieldDash Horn Dash 39 FieldDig Beetle Dig 40 FieldFreeze Freeze 41 FieldIcecle Icicle 42 FieldShield Shield 43 PepTalk Pep Talk 44 HeavyThrow Heavy Throw 45 SharingStash Sharing Stash 46 RoyalDecree Royal Decree 47 Cleanse Cleanse 48 HardCharge Hard Charge 49 FirstDash Dash"},{"location":"Enums%20and%20IDs/crystalbfflags/","title":"Crystalbflags","text":"<p>A crystel berry is a collectible bound to a bool that tells whether or not this crystal berry has been collected. They are saved in the Save File and there are 50 elements available in the MainManager.instance.<code>crystalbflags</code> array which corresponds to the amount of them available in the game.</p>"},{"location":"Enums%20and%20IDs/crystalbfflags/#crystal-berries-table","title":"Crystal berries table","text":"<p>The following table shows all the 50 <code>crystalbflags</code> slots defined with some descriptions.</p> ID Location Description 0 Bugaria Outskirts Right outside of Snakemouth Den is a Save Crystal and to the right of that is the Crystal Berry. 1 Snakemouth Den Same as the room with the HP Plus there is a Crystal Berry on the far left platform. It is inside of a weed that needs to be cut down by Kabbu. 2 Snakemouth Den In the 3-way room with the giant door in the middle and a Save Crystal infront of that there is a Crystal Berry behind a small wall on the back left part of the room. 3 Bugaria Outskirts After getting Kabbu's Horn Dash you can get this Crystal Berry behind Chuck's Abode. 4 Golden Settlement Inside the Windmill in the Golden Settlement's left-side area. 5 Ant Kingdom City Given to you for free after Chapter 1 for giving the queen the Ancient Artifact. 6 Bugaria Outskirts In a dig spot on a ledge outside the cavern that leads to the Golden Path accessible by Vi's fly ability. 7 Golden Settlement In the Aphid &amp; Cochinael farm use Kabbu's Dig ability to get in and dig out this Crystal Berry from a dig spot. 8 Golden Path In the first area of the Golden Path the same area with the Cable Car it can be accessed by cutting some bushes with Kabbu and taking a spring-mushroom up to a ledge 9 Golden Paradise In the first left-side room of Golden Paradise you go across the unspun bridge and go up the flytraps to reach this Crystal Berry. 10 Bugaria Pier On the docks by the bug selling the boat trip there is a Crystal Berry behind the land-side of the wooden docks. 11 Ant Kingdom City Reward for winning the Spy Card tournament. 12 Ant Kingdom City Given to you for free after Chapter 2 for giving the queen the Ancient Artifact. 13 Ant Kingdom City Found by repeatedly hitting the music box in the Theater with Kabbu's cut. 14 Lost Sands In the same room as the fight to protect the Travelling Caravan there is a quicksand pit you can fly over with Vi leading to a hill with a dig spot containing this Crystal Berry. 15 Lost Sands After the fight in the desert to protect the Travelling Caravan you're given this Crystal Berry for free. 16 The Honey Factory Ride the honey geyser to the top in the denmuki (ice block puzzle) room in Honey Factory processing area.  Berry will be on a platform to the right. 17 The Honey Factory Found at the top of the Box room in the honey storage section of the factory. Hold beemerang at switch and walk all the way across the top of the boxes before releasing. 18 Ant Kingdom City Given to you for free after Chapter 3 for giving the queen the Ancient Artifact. 19 Bandit Hideout In the cell across from your own there is a dig spot that has Cerise underneath. She'll give you a Crystal Berry after you talk to her. 20 Bandit Hideout In the Bandit Hideout's cafeteria there is a dig spot on the kitchen side of the room. 21 Lost Sands In the same area where the Heaven Key was obtained you can use Kabbu's Dig ability in a demolished building on the left to get this Crystal Berry. 22 Golden Settlement In the same area where the caravan used to be there is a dig spot accessible in the south surrounded by some large rocks. 23 Sand Castle In the left room with moving switch platforms one slow-moving platform moving off to the right will lead to this Crystal Berry. 24 Sand Castle In the right-side room with the falling boulders on the 2nd patch of thorns go through the room on the right leading to this Crystal Berry. 25 Ant Kingdom City \"Reward for clearing the \"\"Lost Books\"\" quest.   \" 26 Far Grasslands On a giant root in the foreground in the room one left of the entrance room from the Lost Sands. 27 Far Swamplands After getting Kabbu's Horn Dash in a room with switches and moving platforms there are breakable rocks that have a dig spot underneath holding this Crystal Berry. 28 Termite Kingdom Fly right from the catapults at the Termite Kingdom Pier to a pillar in the water. 29 Ant Kingdom City In the main plaza there's a dig spot by the gate to the Anthill Palace holding this Crystal Berry. 30 Bugaria Outskirts In the Explorer's Association Area there is a dig spot at the top right on a rock next to a bridge. The dig spot holds this Crystal Berry. 31 Far Grasslands Dig in a mound to the left of the fence in the first screen of the Far Grasslands when entering from the Lost Sands. 32 Snakemouth Den In the first room of Snakemouth Den use Vi's flying to get onto the pillars and use the beemerang to hit the vine holding this Crystal Berry. 33 Termite Kingdom Behind the stairs leading up to the throne on the far side of the Throne Room 34 Ant Kingdom City Dig up a mound in the back of the Ant Mines break room. 35 The Hive \"Reward for clearing the \"\"In Search of Paint...\"\" quest.   \" 36 Metal Island On top of Master Slice's restaurant on Metal Island. You have to dig with Kabbu to get under the fence next to the restaurant leading to a bounce shroom. 37 Far Grasslands Wizard's tower after falling from the hole a Crystal Berry is on top of a bookshelf grabbed with the Beemerang. 38 Forsaken Lands \"In the room where you find Nero for the \"\"Best Friend In The Fog!\"\" sidequest put a nice item in front of the hole and you'll be given back this Crystal Berry. \" 39 Golden Settlement Found by talking to the fortune teller after digging under the berry farm's fence behind him. 40 Golden Path In the side-area with a spinning platform leading up to the Devourer bounty boss it is on the right side of the room 41 Far Grasslands \"Reward for clearing the \"\"Sweets from Outside!\"\" quest found at the fishing villiage  \" 42 Snakemouth Lab In the room with the coloured switch puzzle on the back left side of the room 43 Ant Kingdom City Reward at the library for finding 10 discoveries. 44 Ant Kingdom City Reward at the library for finding 15 discoveries. 45 Ant Kingdom City Reward at the library for finding 35 discoveries. 46 Ant Kingdom City Reward at the library for finding 40 discoveries. 47 Ant Kingdom City Reward at the library for finding 45 discoveries. 48 Dead Lands Found in a dig spot in the front left corner of the 2nd room 49 Dead Lands Located behind the milk carton on the 2nd level of the fridge."},{"location":"Enums%20and%20IDs/librarystuff/Areas/","title":"Areas","text":"<p>An <code>Areas</code> enum value represents a group of Maps that belongs to a certain location in the game. Each map must belong to one <code>Areas</code> and they are important in determining the scope of any Regionalflags. </p> <p>The current area is saved on the Save File.</p>"},{"location":"Enums%20and%20IDs/librarystuff/Areas/#remarks-about-librarystuff","title":"Remarks about <code>librarystuff</code>","text":"<p>Each area is bound to a bool value stored in a 2 dimensional jagged array located at index 4 of the <code>MainManager.instance.librarystuff</code> array that indicates whether or not the area was seen. This allows the game to track which areas to show on the world map. The subarray of <code>librarystuff</code> contains 256 elements (most are not used as the array is overprosioned in size). </p> <p>The entire <code>librarystuff</code> two dimensional array is saved on the Save File.</p>"},{"location":"Enums%20and%20IDs/librarystuff/Areas/#areas-table","title":"Areas table","text":"<p>The following table shows all the <code>Areas</code> enum value and their English names for convenience.</p> ID Name English Name 0 BugariaOutskirts Bugaria Outskirts 1 BugariaCity Ant Kingdom City 2 Snakemouth Snakemouth Den 3 Desert Lost Sands 4 GoldenHills Golden Hills 5 GoldenWay Golden Path 6 GoldenSettlement Golden Settlement 7 BarrenLands Forsaken Lands 8 FarGrasslands Far Grasslands 9 WildGrasslands Wild Swamplands 10 DefiantRoot Defiant Root 11 SandCastle Ancient Castle 12 Beehive Bee Kingdom Hive 13 HoneyFactory Honey Factory 14 RubberPrison Rubber Prison 15 GiantLair Giant's Lair 16 MetalLake Metal Lake 17 MetalIsland Metal Island 18 TermiteCity Termite Capitol 19 WaspKingdom Wasp Kingdom Hive 20 BanditHideout Bandit Hideout 21 StreamMountain Stream Mountain 22 ChomperCaves Chomper Caves 23 FishingVillage Fishing Village 24 UpperSnakemouth Upper Snakemouth"},{"location":"Enums%20and%20IDs/librarystuff/Bestiary%20entry/","title":"Bestiary entry","text":"<p>A bestiary entry is a collectible bound to a bool that tells whether or not the specific entry for the enemy is unlocked in the library. Their values are saved in the Save File and the array of them is located at index 1 of the <code>MainManager.instance.librarystuff</code> 2 dimensional jagged array and it contains 256 elements (most are not used as the array is overprosioned in size).</p> <p>They are not to be confused with Enemies.</p> <p>The entire <code>librarystuff</code> two dimensional array is saved on the Save File.</p>"},{"location":"Enums%20and%20IDs/librarystuff/Bestiary%20entry/#bestiary-entries-table","title":"Bestiary entries table","text":"<p>The following table shows all bestiary entries with their English names for convenience.</p> ID English Name 0 Zombiant 1 Jellyshroom 2 Spider 3 Venus' Guardian 4 Zasp (Chp. 2) 5 Mothiva (Chp. 2) 6 Acolyte Aria 7 Monsieur Scarlet 8 Inichas 9 Cactiling 10 Psicorp 11 Thief 12 Bandit 13 Seedling 14 Numbnail 15 Acornling 16 Weevil 17 Venus' Bud 18 Chomper 19 Kabbu 20 Wasp Trooper 21 Midge 22 Underling 23 Golden Seedling 24 Burglar 25 Bee-Boop 26 Mother Chomper 27 Abomihoney 28 Carmina 29 Security Turret 30 Denmuki 31 Wasp Scout 32 Arrow Worm 33 Ahoneynation 34 Mender 35 Heavy Drone B-33 36 Broodmother 37 Astotheles 38 Dune Scorpion 39 Tidal Wyrm 40 Seedling King 41 Kali 42 Zombee 43 Zombeetle 44 The Watcher 45 Peacock Spider 46 Bloatshroom 47 Krawler 48 Haunted Cloth 49 Warden 50 Wasp King (Chp. 7) 51 Jumping Spider 52 Mimic Spider 53 Leafbug Ninja 54 Leafbug Archer 55 Leafbug Clubber 56 Madesphy 57 The Beast 58 Chomper Brute 59 Mantidfly 60 General Ultimax 61 ULTIMAX Tank 62 Wild Chomper 63 Cross 64 Poi 65 Primal Weevil 66 False Monarch 67 Mothfly 68 Mothfly Cluster 69 Ironnail 70 Belostoss 71 Ruffian 72 Water Strider 73 Diving Spider 74 Cenn 75 Pisci 76 Dead Lander \u03b1 77 Dead Lander \u03b2 78 Dead Lander \u03b3 79 The Everlasting King 80 Maki 81 Kina 82 Yin 83 Zommoth 84 Riz 85 Devourer 86 Wasp Bomber 87 Wasp Driller 88 Plumpling 89 Flowerling"},{"location":"Enums%20and%20IDs/librarystuff/Discoveries%20entry/","title":"Discovery entry","text":"<p>A discovery entry is a collectible bound to a bool that tells whether or not the specific entry for the discovery is unlocked in the library. Their values are saved in the Save File and the array of them is located at index 0 of the <code>MainManager.instance.librarystuff</code> 2 dimensional jagged array and it contains 256 elements (most are not used as the array is overprosioned in size).</p> <p>The entire <code>librarystuff</code> two dimensional array is saved on the Save File.</p>"},{"location":"Enums%20and%20IDs/librarystuff/Discoveries%20entry/#discovery-entries-table","title":"Discovery entries table","text":"<p>The following table shows all discovery entries with their English names for convenience.</p> ID English Name 0 Snakemouth Den 1 Snakemouth Depths 2 Explorer's Message 3 The Roaches' Village? 4 Inn Foremothers 5 The Settler Statue 6 The Ants 7 The Bees 8 The Termites 9 The Wasps 10 Queen Elizant I 11 The Anthill Palace 12 Aphids and Cochinaels 13 The Golden Festival 14 The Goddess' Statue 15 Honoured Employee 16 Sand Castle Mural 17 Snakemouth's Lab 18 Healing Sophie 19 Seedling Haven 20 Underground Tavern 21 The Ant Mines 22 Chomper Cavern 23 The Power Plant 24 The Bee Kingdom 25 Balcony Telescope 26 B.O.S.S. 27 Defiant Root 28 Relic Museum 29 The Lost Sands 30 Tardigrade Idol 31 Bandit Hideout 32 Stream Mountain 33 Far Grasslands 34 Fishing Village 35 Wizard's Tower 36 Far Swamplands 37 Wasp Kingdom 38 Forsaken Lands 39 Ancient City 40 Termite Kingdom 41 Termite Statue 42 Termite Coliseum 43 Termacade 44 Sailor's Statue 45 Metal Island 46 Spy Card 47 Peacock Island 48 Rubber Prison 49 Giant's Lair"},{"location":"Enums%20and%20IDs/librarystuff/Recipes%20entry/","title":"Recipe entry","text":"<p>A recipe entry is a collectible bound to a bool that tells whether or not the specific entry for the recipe is unlocked in the library. Their values are saved in the Save File and the array of them is located at index 2 of the <code>MainManager.instance.librarystuff</code> 2 dimensional jagged array and it contains 256 elements (most are not used as the array is overprosioned in size).</p> <p>The entire <code>librarystuff</code> two dimensional array is saved on the Save File.</p>"},{"location":"Enums%20and%20IDs/librarystuff/Recipes%20entry/#recipe-entries-table","title":"Recipe entries table","text":"<p>The following table shows all recipe entries with their English names for convenience.</p> ID English Name 0 Mistake 1 Leaf Salad 2 Glazed Honey 3 Abomihoney 4 Cooked Shroom 5 Cooked Danger 6 Sweet Shroom 7 Sweet Danger 8 Fried Egg 9 Leaf Omelet 10 Honey'd Leaf 11 Roasted Berries 12 Succulent Platter 13 Succulent Cookies 14 Berry Juice 15 Mushroom Skewer 16 Hearty Breakfast 17 Mushroom Salad 18 Sweet Dew 19 Baked Yam 20 Spicy Fries 21 Burly Chips 22 Danger Dish 23 Shaved Ice 24 Cold Salad 25 Ice Cream 26 Honey Ice Cream 27 Dry Bread 28 Nutty Cake 29 Poison Cake 30 Frost Pie 31 Yam Bread 32 Shock Candy 33 Mushroom Gummies 34 Sweet Pudding 35 Leaf Croissant 36 Honey Pancakes 37 Drowsy Cake 38 Hustle Candy 39 Spicy Candy 40 Burly Candy 41 Berry Jam 42 Hot Drink 43 Plain Tea 44 Spicy Tea 45 Burly Tea 46 Aphid Shake 47 Squash Puree 48 Squash Candy 49 Squash Tart 50 Plumpling Pie 51 Tangy Jam 52 Tangy Juice 53 Tangy Pie 54 Spicy Bomb 55 Burly Bomb 56 Poison Bomb 57 Sleep Bomb 58 Numb Bomb 59 Frost Bomb 60 Clear Bomb 61 Abombination 62 Cherry Bombs 63 Cherry Pie 64 Berry Smoothie 65 Miracle Shake 66 Tangy Carpaccio 67 Crisbee Doughnut 68 Queen's Dinner 69 Big Mistake"},{"location":"Enums%20and%20IDs/librarystuff/Records%20entry/","title":"Record entry","text":"<p>A record entry is a collectible bound to a bool that tells whether or not the specific entry for the record has been achieved in the library. Their values are saved in the Save File and the array of them is located at index 3 of the <code>MainManager.instance.librarystuff</code> 2 dimensional jagged array and it contains 256 elements (most are not used as the array is overprosioned in size). On compatible platforms, enabling a record also unlocks its associated achievement.</p> <p>The entire <code>librarystuff</code> two dimensional array is saved on the Save File.</p>"},{"location":"Enums%20and%20IDs/librarystuff/Records%20entry/#record-entries-table","title":"Record entries table","text":"<p>The following table shows all record entries with their English names for convenience.</p> ID English Name English Description 0 Ultimate Team! Defeat a very powerful foe. 1 Crystal Collector Find all Crystal Berries. 2 Medal Collector Find all Medals. 3 Music Collector Purchase all Songs. 4 Battle Ready Reach the maximum rank. 5 Chapter 1 Complete Finish Chapter 1. 6 Vicious Spider Defeat the Chapter 1's boss in Hard Mode. 7 Helping Hand Complete all requests. 8 Cooking Maestro Find all recipes. 9 Field Researcher Fill the bestiary. 10 Pro Explorers Find all Discoveries. 11 Good Deed Deliver something to someone that really wants it. 12 Chapter 2 Complete Finish Chapter 2. 13 The Guardian Defeat the Chapter 2's boss in Hard Mode. 14 Chapter 3 Complete Finish Chapter 3. 15 Heavy Duty Defeat the Chapter 3's boss in Hard Mode. 16 Chapter 4 Complete Finish Chapter 4. 17 Always Watchful Defeat the Chapter 4's boss in Hard Mode. 18 Chapter 5 Complete Finish Chapter 5. 19 The Terror Defeat the Chapter 5's boss in Hard Mode. 20 Chapter 6 Complete Finish Chapter 6. 21 All Geared Up Defeat the Chapter 6's boss in Hard Mode. 22 Chapter 7 Complete Finish Chapter 7. 23 The End Defeat the Chapter 7's boss in Hard Mode. 24 Plant Enchanter Find a new friend! 25 Reconciliation Help a friend out. 26 The Truth Find out the truth. 27 Our Job's Done! Complete the game! 28 A Better Bugaria Defeat all bounties. 29 Gamer Indulge in electronic games!"},{"location":"External%20data%20format/Save%20File/","title":"Bug Fables Save Format","text":"<p>A save file in Bug Fables is a XOR encrypted regular text file. It is a very simple symmetric encryption scheme where each bytes is XORed with a number called the key. This key is present in the TextAsset located at <code>Ressources/Data/Key</code> in the asset tree.</p> <p>The operation to encrypt or decrypt are identical.</p> <p>The file is composed of exactly 18 lines. There are 3 types of line format:</p> <ul> <li>Fields line: contain fields of various meaning, separated by \",\".</li> <li>List line: contain a list of items, separated by \",\" unless specified otherwise.</li> <li>Array line: contain an array, each element is separated by \"@\" and each element is either a list or fields.</li> </ul>"},{"location":"External%20data%20format/Save%20File/#format-differences-between-10x-and-11x","title":"Format differences between 1.0.x and 1.1.x","text":"<p>There were 2 changes done to the format in the 1.1.0 version of the game. Specifically, the amount of items in the flagvar and flags line have increased. When a 1.0.x save file is loaded into the game, it will load normally, but with the new items getting a default value (in this case, false). The game uses a specific flag to determine if the file is in 1.0.x format or 1.1.x format. If it detects it's a 1.0.5 file, it will perform some directives to adapt it as some logic changes and flags changes impacted it. Once it is done, it will set the flag checked earlier to true which will prevent the game from performing the conversion twice. This works because this flag slot is not used in 1.0.x so it will never be true until the conversion is done in 1.1.x. This will only persist once a save in the game is performed at which point, the save file is permanently converted to a 1.1.x format.</p>"},{"location":"External%20data%20format/Save%20File/#sections-of-a-save-file","title":"Sections of a save file","text":""},{"location":"External%20data%20format/Save%20File/#line-1-fields-line-header","title":"Line 1 (Fields line) Header","text":"<p>This line serves as a header.</p> Position Description Type Additional information 0-2 Save Position Vector3 (float x3) In the order X,Y,Z 3 RUIGEE Bool Same as flag 613 4 HARDEST Bool Same as flag 614 5 FRAMEONE Bool Same as flag 615 6 PUSHROCK Bool Same as flag 616 7 MOREFARM Bool Same as flag 656 8 MYSTERY? Bool Same as flag 681 9 Filename String Same as flagstring 10"},{"location":"External%20data%20format/Save%20File/#line-2-array-line-party-memeber-stats","title":"Line 2 (Array line) Party memeber stats","text":"<p>This line corresponds to each party members stats (their BattleData).</p> <p>If a party member is not present, its element is empty.</p> <p>An array element contains the following fields:</p> Position Description Type Additional information 0 trueid Int AnimID of the party member 1 HP Int 2 Max HP Int 3 Base HP Int 4 Attack Int 5 Base Attack Int 6 Defense Int 7 Base Defense Int"},{"location":"External%20data%20format/Save%20File/#line-3-field-line-global-information-and-party-information","title":"Line 3 (Field line) Global information and party information","text":"<p>This line contains global information about the party and the state of the game.</p> Position Description Type Additional information 0 Rank Int 1 Exp Int 2 Needed Exp for next rank Int 3 Max TP Int 4 TP Int 5 Berries count Int 6 Name of the current map String This is a string version of the Map 7 Current area's ID Int Refer to the Areas document 8 MP Int 9 Max MP Int 10 Number of items allowed in inventory Int 11 Number of items in storage allowed Int Normally set to 35 and never set again 12 Hours of the play time clock Int 13 Minutes of the play time clock Int 14 Seconds of the play time clock Int 15 Save progress icons Int 0 - no icons, 1 - Ancient Mask, 2 - Ancient Tablet, 3 - Ancient Key, 4 - Ancient half, 5 - Elizant II, 6 - Flame Brooch and 7 - Wasp King's crown"},{"location":"External%20data%20format/Save%20File/#line-4-array-line-medals-available-in-medal-shops","title":"Line 4 (Array line) Medals available in medal shops","text":"<p>This line corresponds the different medals available in each medal shops for purchase.</p> Element Description 0 Medal shop at Ant City 1 Shades's shop at the Underground Bar <p>Each array element contains a list:</p> Position Description Type Additional information ALL Medal ID Int -1 - empty slot, Refer to the Medal document <p>The way it works is this list is ordered in such a way that the first medals are going to be the ones displayed at the shop. For the Ant City medal shop, it's the first 3 and for Shade's shop, it's the first 2. An empty slot means there will be no medals (which occurs if there isn't enough available medals).</p>"},{"location":"External%20data%20format/Save%20File/#line-5-array-line-medals-shops-pool","title":"Line 5 (Array line) Medals shops pool","text":"<p>This line corresponds to the pool of medals each shop currently offers.</p> Element Description 0 Medal shop at Ant City 1 Shades's shop at the Underground Bar <p>Each array element contains a list:</p> Position Description Type Additional information ALL Medal ID Int Refer to the Medal document <p>Unlike line 4, this represents all the medals in the pool offered by each shop, but it does not indicate which ones are on display.</p>"},{"location":"External%20data%20format/Save%20File/#line-6-array-line-boardquests","title":"Line 6 (Array line) BoardQuests","text":"<p>This line contains information about the quests on the quests boards</p> Element Description 0 Open quests 1 Taken quests 2 Completed quests <p>Each array element contains a list:</p> Position Description Type Additional information ALL Quest ID Int Refer to the BoardQuests document <p>If the element is empty, there should only be one item in the list being the number 0 (No Quests).</p> <p>This includes ALL quests including main story ones.</p>"},{"location":"External%20data%20format/Save%20File/#line-7-array-line-items","title":"Line 7 (Array line) Items","text":"<p>This line contains information about the items in possession and in storage.</p> Element Description 0 Items 1 Key items 2 Stored items <p>Each array element contains a list:</p> Position Description Type Additional information ALL Item ID Int Refer to the Items document"},{"location":"External%20data%20format/Save%20File/#line-8-array-line-medals","title":"Line 8 (Array line) Medals","text":"<p>This line contains the medals in possession as well as how it is equipped.</p> <p>Each array element contains fields:</p> Position Description Type Additional information 0 Medal ID Int Refer to the Medal document 1 Equip target Int -2 - Unequipped, -1 - Equipped to the party, everything else is the AnimID of whom has it equipped"},{"location":"External%20data%20format/Save%20File/#line-9-array-line-samira-songs","title":"Line 9 (Array line) Samira songs","text":"<p>This line corresponds to all the songs available for Samira as well as their status.</p> <p>Each array element contains fields:</p> Position Description Type Additional information 0 Music ID Int Refer to Musics document 1 Unlock status Int -1 - Not bought, 1 - Bought"},{"location":"External%20data%20format/Save%20File/#line-10-array-line-stats-bonuses","title":"Line 10 (Array line) Stats bonuses","text":"<p>This line corresponds to all the stats bonus applied to the party.</p> <p>Each array element contains fields:</p> Position Description Type Additional information 0 Bonus type Int 0 - HP, 1 - Attack, 2 - Defense, 3 - TP, 4 - MP 1 Bonus amount Int 2 Target Int -1 for the Party or the AnimID of the specific party member"},{"location":"External%20data%20format/Save%20File/#line-11-array-line-librarystuff","title":"Line 11 (Array line) <code>librarystuff</code>","text":"<p>This line correspond to each element of the library menu as well as the seen areas.</p> Element Description Additional information 0 Discoveries Refer to the Discovery entry document 1 Bestiary Refer to the Bestiary entry document 2 Recipes Refer to the Recipes entry document 3 Records (achievements) Refer to the Records entry document 4 Seen areas Refer to the Areas document <p>Each array element contains a list:</p> Position Description Type Additional information 0-255 Unlocked Bool Refer to the appropriate document for the IDs <p>Each unused ID has the value false.</p>"},{"location":"External%20data%20format/Save%20File/#line-12-list-line-flags","title":"Line 12 (List line) Flags","text":"<p>This line correspond to the flags array.</p> Position Description Type Additional information 0-749 Value Bool Refer to the flags document <p>Saves before 1.1.x have 700 items making the position 0-699.</p>"},{"location":"External%20data%20format/Save%20File/#line-13-list-line-flagstring","title":"Line 13 (List line) Flagstring","text":"<p>This line correspond to flagstring array.</p> <p>The separator used here is \"|SPLIT|\", NOT \",\".</p> Position Description Type Additional information 0-14 Value String Refer to the flagstring document"},{"location":"External%20data%20format/Save%20File/#line-14-list-line-flagvar","title":"Line 14 (List line) Flagvar","text":"<p>This line correspond to flagvar array.</p> Position Description Type Additional information 0-69 Value Int Refer to the flagvar document <p>Saves before 1.1.x have 65 items making the position 0-64.</p>"},{"location":"External%20data%20format/Save%20File/#line-15-list-line-regionalflags","title":"Line 15 (List Line) Regionalflags","text":"<p>This line correspond to the regionalflags array.</p> Position Description Type Additional information 0-99 Value Bool Refer to the Regionalflags document <p>Each unused ID has the value false.</p>"},{"location":"External%20data%20format/Save%20File/#line-16-field-line-crystalbfflags","title":"Line 16 (Field line) crystalbfflags","text":"<p>This line to whether or not each crystal berry has been collected.</p> Position Description Type Additional information 0-49 Collected Bool Refer to the crystalbfflags document"},{"location":"External%20data%20format/Save%20File/#line-17-list-line-followers","title":"Line 17 (List line) Followers","text":"<p>This line corresponds to the extra followers of the party.</p> <p>Each follower ID won't do anything unless the game allows them to follow the party at the current map. For more information, check Follow</p> Position Description Type Additional information ALL Follower ID Int Refer to the AnimIDs document"},{"location":"External%20data%20format/Save%20File/#line-18-array-line-enemy-encounters","title":"Line 18 (Array line) Enemy encounters","text":"<p>This line corresponds to enemy encounters information for each enemies.</p> <p>The index of the array corresponds to each enemy ID, refer to the Enemies document for details.</p> <p>Each array element contains fields:</p> Position Description Type 0 Number seen Int 1 Number defeated Int <p>The array size is always 256, if the ID is unused, each fields contain 0.</p>"},{"location":"Flags%20arrays/Regionalflags/","title":"Regionalflags","text":"<p>A <code>regionalflag</code> is a bool which is a variable the game can access globally while its value is kept until an area change occurs in the game or until a reset is specifically requested by the game. When a reset occurs, all regionalflag are set to false. They are saved on the Save File and are used to track temporary progress in an area such as defeating an enemy in the overworld. There are 100 regional flags available in the <code>MainManager.instance.regionalflags</code> array.</p>"},{"location":"Flags%20arrays/Regionalflags/#notes-about-the-regionalflags-tables","title":"Notes about the regionalflags tables","text":"<p>Since the meaning of the regional flags depends on the Areas, there will be one table per area in this document.</p> <p>The instances in which the game specifically requests a reset will be mentioned in the table of the concerned area.</p> <p>When an enemy is mentioned (which is most of the regional flags), it is implied the value gets set to <code>true</code> when being defeated unless specified otherwise.</p> <p>Any ID not specified implies UNUSED.</p>"},{"location":"Flags%20arrays/Regionalflags/#regional-flags-tables","title":"Regional flags tables","text":""},{"location":"Flags%20arrays/Regionalflags/#bugaria-outskirts","title":"Bugaria Outskirts","text":"ID Description 0 Rightmost Seedling at the map on the west of the Explorers Association 1 Second Seedling from the right at the map on the west of the Explorers Association 2 Leftmost Seedling from the right at the map on the west of the Explorers Association 4 Third Seedling from the right at the map on the west of the Explorers Association 5 Cutting the leftmost bush at the map to the east of the Snakemouth Den entrance 6 Seedling at the map to the east of the Snakemouth Den entrance 7 Getting the Honey Drop by cutting the leftmost bush at the map next to Chuck's place 10 Seedling in the middle (near the elevated platform) at the map the the south of the Explorers Association 11 Leftmost Seedling (near the tunnel entrance) at the map the the south of the Explorers Association 12 Rightmost (near the loading zone) Seedling at the map the the south of the Explorers Association 13 Getting a Crunchy leaf by cutting the second bush from the left at the map to the east of the Snakemouth Den entrance 15 Midge at the tunnel near Golden Path 16 Numbnail at the tunnel near Golden Path 17 Leftmost Underling at the map to the east of the Explorers Association 18 Rightmost Underling at the east map of the association 19 Seedling near the Cave Of Trials entrance 20 Seedling at the map next to Chuck's place 21 Rightmost Underling at the map to the west of Bugaria Piers 22 Cutting the leftmost bush at Seedling Heaven (it has a chance to drop a Tangy Berry) 23 Right Seedling at Seedling Heaven 24 Bottom Seedling at Seedling Heaven 25 Left Seedling at Seedling Heaven 26 Belostoss in the cave with the wind blowers 27 Leftmost Underling at the map to the west of Bugaria Piers 28 Ironnail in the cave with the wind blowers 50 Ironnail in the tunnel near Golden Path 51 Belostoss in the tunnel near Golden Path"},{"location":"Flags%20arrays/Regionalflags/#ant-kingdom-city","title":"Ant Kingdom City","text":"ID Description 1 Talked to Fry once"},{"location":"Flags%20arrays/Regionalflags/#snakemouth-den","title":"Snakemouth Den","text":"<p>When reaching the Ancien Mask room, the regional flags are programmed to reset to false</p> ID Description 2 Depths, Zombiant in the center of the room located west of the Spider's room 3 Depths, leftmost Inichas in the room located west of the Spider's room 4 Depths, Inichas on the back right part in the room located west of the Spider's room 5 Depths, cutting the leftmost bush in the room located west of the Spider's room (drops a berry) 7 Depths, leftmost Zombiant in the room located west of the Spider's room 8 Depths, Jellyshroom on the back of the room located west of the Spider's room 9 Hit the coiled vine in the first room 10 Depths, got either an Aphid Egg, Honey drop or Crunchy Leaf by cutting the bush on the back left part of the room located west of the Spider's room 11 Depths, the closest Zombiant to the right exit of the room located west of the Spider's room 12 Depths, got the Magic Seed by cutting the rightmost bush in the room located east from the room with the doors 13 Depths, Inichas in the room located east from the room with the doors 14 Depths, Jellyshroom in the front of the mushrooms room 15 Depths, Jellyshroom in the back of the mushrooms room 17 Depths, Zombiant in the room located west from the room with the doors 18 Depths, Zombiant at the bottom of the room with the left door switch 19 Depths, Zombiant at the top of the room with the left door switch 20 Depths, Inichas in the room with the right door switch 21 Inichas in the second room (the one with the large door and the trap hole) 22 Rightmost Inichas in the first room 23 Leftmost Inichas in the first room 25 Depths, Inichas on the south part of the room with the doors 26 Depths, Zombiant on the right part of the room with the doors 27 Depths, Jellyshroom on the left part of the room with the doors 30 Depths, Jellyshroom in the room located east from the room with the doors 31 Depths, Jellyshroom in the room with the right door switch 32 Depths, got the red berry by cutting the rightmost bush in the room with the doors"},{"location":"Flags%20arrays/Regionalflags/#lost-sands","title":"Lost Sands","text":"ID Description 0 Bandit at the map located northwest from the map with the blue fortk (south entrance) 1 Cactiling located south at the large sand pit map 2 Psicorp located south at the large sand pit map 3 Cactiling located east at the large sand pit map 4 Psicorp at the map with the blue fork (south entrance) 5 Cactiling located on the back of the map with the Bandit Hideout entrance 6 Cactiling located the closest of the Bandit Hideout entrance 7 Thief at the map located east from the Caravan shop 8 Arrow Worm at the map located north of the map with the blue fork (south entrance) 10 Arrow Worm at the map located west from the map where the Caravan was ambushed by bandits and Wasps 11 Cactiling at the map located east from Defiant Root 12 Psicorp at the map located east from Defiant Root 13 Thief at the large sand pit map 14 Bandit at the large sand pit map 15 Midge at the map located north of the map where the Golden Settlement is accessible from 16 Psicorp at the map located north of the map where the Golden Settlement is accessible from 17 Chomper at the map located north of the Golden Settlement 18 Cactiling at the map located north of the Golden Settlement 19 Bandit at the map with the blue fork (south entrance) 20 Burglar at the map located north of the map where the Golden Settlement is accessible from 21 Bandit at the map located east from the map where the Golden Settlement is accessible from 22 Thief at the map located south from the Caravan shop 23 Burglar at the map located east from the Caravan shop 24 Burglar at the map where the Caravan was ambushed by bandits and Wasps 25 Getting the red berry by cutting a bush on an elevated platform at the map located north of the Golden Settlement 50 Psicorp at the map located south from the Caravan shop 51 Arrow Worm at the map located south from the Caravan shop 52 Leftmost Cactiling at the map located west from the map with the blue fork (south entrance) 53 Rightmost Cactiling at the map located west from the map with the blue fork (south entrance) 54 Underling at the map located northwest from the map with the blue fortk (south entrance) 55 Psicorp at the map located northwest from the map with the blue fortk (south entrance) 56 Bandit at the map where the Caravan was ambushed by bandits and Wasps 58 Cactiling at the map located east from the map with the large sand pit 59 Thief at the map located east from the map with the large sand pit 60 Getting a Crunchy leaf by cutting the leftmost bush at the map located south from the Caravan shop 65 Getting a blue berry by cutting the bush on the front right of the left side of the map located west from the map where the Caravan was ambushed by bandits and wasps 66 Cutting the bush on the front left of the left side of the map located west from the map where the Caravan was ambushed by bandits and wasps 67 Getting a blue berry by cutting the bush on the back left of the left side of the map located west from the map where the Caravan was ambushed by bandits and wasps 68 Getting a red berry by cutting the bush on the back right of the left side of the map located west from the map where the Caravan was ambushed by bandits and wasps"},{"location":"Flags%20arrays/Regionalflags/#golden-hills","title":"Golden Hills","text":"ID Description 0 Got a Magic Seed by cutting the bush next to the crank on the back right part of the map located west from the map with the right angle wooden spinning bridge 1 Weevil in the map located west from the map with the right angle wooden spinning bridge 2 Acornling in the map located west from the map with the right angle wooden spinning bridge 3 Chomper in the map located west from the map with the right angle wooden spinning bridge 4 Numbnail in map with the right angle wooden spinning bridge 5 Chomper in the map with the right angle wooden spinning bridge 6 Chomper in the map located east from the entrance 7 Got a Burly Berry by cutting the bush closest to the rightmost crank in the map located north from the map with the right angle wooden spinning bridge 8 MIdge in the map located north from the map with the right angle wooden spinning bridge 10 Numbnail in the map located north from the map with the right angle wooden spinning bridge 11 Acornling in the map located north from the map with the right angle wooden spinning bridge 60 Acornling in the map locatest east of the map with the offerings receptacle 61 Chomper in the map locatest east of the map with the offerings receptacle"},{"location":"Flags%20arrays/Regionalflags/#golden-path","title":"Golden Path","text":"<p>The regional flags are programmed to reset to false when crossing either the loading zone north of the map with the 2 cranks next to eachother or the loading zone back to it from the north map</p> ID Description 0 Got a Clear Water by cutting the bush closest to the green spring next to the sign in the first map from Bugaria Outskirts 1 Acornling in the map located east from the map with the shop 3 Weevil in the map located east from the map with the shop 4 Rightmost Acornling in the first map from Bugaria Outskirts 5 Numbnail in the map located east from the map with the shop 6 Leftmost Acornling in the first map from Bugaria Outskirts 7 Weevil in the map with 2 cranks next to eachother 11 Rightmost Numbnail in the map with the 2 cranks next to eachother 12 Numbnail in the map located north of the map with the 2 cranks next to eachother 13 Weevil in the map located north of the map with the 2 cranks next to eachother 14 Acornling in the map located north of the map with the 2 cranks next to eachother 15 Acornling in the map before the map where Devourer appears 16 Chomper in the map before the map where Devourer appears 17 Weevil in the map before the map where Devourer appears 30 Leftmost Numbnail in the map with 2 cranks next to eachother"},{"location":"Flags%20arrays/Regionalflags/#golden-settlement","title":"Golden Settlement","text":"ID Description 1 Talked to Kut once"},{"location":"Flags%20arrays/Regionalflags/#forsaken-lands","title":"Forsaken Lands","text":"ID Description 0 Mimic Spider in the map with the cut CD 1 Ironnail in the map with a pencil pointing towards the correct path 2 Plumpling in the map with a pencil pointing towards the correct path 3 Ironnail in the map located west from the Bugaria Outskirts entrance 4 Got a Squash by cutting the bush near the north exit of the map with a pencil pointing towards the correct path 6 Ironnail in the map with several wind blowers 7 Got a Squash by cutting the rightmost bush in the map with several pumpkins 8 Mimic Spider in the map located south of the map where the Primal Weevil appears 9 Ironnail in the map located south of the map where the Primal Weevil appears 10 Got a Magic Seed by cutting the bush to the left of the fountain on an elevated platform in the fake Ant Village 11 Got a Squash by cutting the rightmost bush in the map located south of the map where the Primal Weevil appears 13 Mothfly in the map with the cut CD pointing towards the correct path 23 Mothfly in the map with several wind blowers 24 Mothfly Cluster in the map with several wind blowers 25 Mimic Spider in the map with several wind blowers 26 Leftmost Ironnail in the map with several pumpkins 27 Rightmost Ironnail in the map with several pumpkins 30 Mothfly Cluster in the map located west of the map with several wind blowers 31 Mothfly in the map located west of the map with several wind blowers"},{"location":"Flags%20arrays/Regionalflags/#far-grasslands","title":"Far Grasslands","text":"ID Description 0 Destroyed the boulder on the back of the map located south of the map with the Ant Mines tunnel access 1 Destroyed the boulder on the front of the map located south of the map with the Ant Mines tunnel access 3 Flowerling in the map located north of the south entrance 4 Jumping Spider in the map of the south entrance 5 Topmost Wild Chomper in the map located east of the south entrance 6 Mantidly in the map located west of the Fishing Village 7 Flowerling in the map located west of the south entrance 8 Jumping Spider in the map located west of the south entrance 9 Got a red berry by cutting the bush in the back left corner (back of the cluster of 3) in the map located west of the south entrance 10 Got a blue berry by cutting the bush in the back left corner (left of the cluster of 3) in the map located west of the south entrance 11 Got a blue berry by cutting the bush in the back left corner (front of the cluster of 3) in the map located west of the south entrance 12 Jumping Spider in the map located east of the south entrance 13 Jumping Spider in the map located west of the Fishing Village 14 Flowerling in the map located west of the Fishing Village 15 Wild Chomper in the map of the south entrance 16 Lowermost Wild Chomper in the map located east of the south entrance 17 Mantidly in the map located west of the south entrance 18 Mantidly in the map located south of the map where Yin evolves 19 Flowerling in the map located south of the map where Yin evolves 20 Wild Chomper in the map located south of the map with the Ant Mines tunnel access 21 Jumping Spider in the map located south of the map with the Ant Mines tunnel access 22 Wild Chomper in the map located south of the map where Yin evolves 23 Mantidly in the map located north of the south entrance 25 Wild Chomper in the map located north of the south entrance"},{"location":"Flags%20arrays/Regionalflags/#wild-swamplands","title":"Wild Swamplands","text":"ID Description 0 Destroyed the boulder above a piece of wood in the map located south of the map with the broken wooden bridge 1 Destroyed the rightmost boulder of the map located south of the map with the broken wooden bridge 2 Madesphy in the south entrance 3 Destroyed the leftmost boulder of the map located south of the map with the broken wooden bridge 4 Got a red berry by cutting the closest bush to the green spring in the map located north from the south entrance 5 Got a blue berry by cutting the frontmost bush in the map located north from the south entrance 6 Got a Honey Drop by cutting the rightmost bush in the map located north from the south entrance 7 Madesphy in the map located north the south entrance 8 Leafbug Clubber in the map located west from the map with the broken wooden bridge 9 Leafbug Ninja in the map located west from the map with the broken wooden bridge 10 Destroyed the closest boulder of the Flowerling in the map located south of the map with the broken wooden bridge 11 Destroyed the leftmost boulder of the map with a lever surrounded by a spike pit 12 Destroyed the rightmost boulder of the map with a lever surrounded by a spike pit 13 Got a Magic Seed by digging in the dig spot in the map located east of the map with a lever surrounded by a spike pit 14 Wild Chomper in the map located north the south entrance 15 Leafbug Archer in the map located south of the map with the broken wooden bridge 16 Leafbug Ninja in the map located south of the map with the broken wooden bridge 17 Leafbug Clubber in the map with a lever surrounded by a spike pit 18 Madesphy in the map with a lever surrounded by a spike pit 20 Leafbug Archer in the map located south of the map with a lever surrounded by a spike pit 21 Madesphy in the map located south of the map with a lever surrounded by a spike pit 23 Leafbug Clubber in the map located east of the map with a lever surrounded by a spike pit 24 Madesphy in the map located east of the map with a lever surrounded by a spike pit 25 Leafbug Ninja in the map located east of the map with a lever surrounded by a spike pit 26 Rightmost Leafbug Archer in the map located east of the map with the broken wooden bridge 27 Madesphy in the map located east of the map with the broken wooden bridge 28 Leftmost Leafbug Archer (only set the first time deafeating it) in the map located east of the map with the broken wooden bridge 29 Leafbug Clubber in the map located east of the map with the broken wooden bridge 30 Wild Chomper in the map located south of the map with a lever surrounded by a spike pit 31 Mantidly in the map located north the south entrance 32 Leftmost Wild Chomper in the map with a lever surrounded by a spike pit 33 Rightmost Wild Chomper in the map with a lever surrounded by a spike pit 34 Got the Clear Bomb by hitting the coiled vine in the map with a lever surrounded by a spike pit"},{"location":"Flags%20arrays/Regionalflags/#defiant-root","title":"Defiant Root","text":"ID Description 10 Talked to Crisbee once"},{"location":"Flags%20arrays/Regionalflags/#ancient-castle","title":"Ancient Castle","text":"ID Description 0 Krawler in the entrance room 1 Leftmost Warden in the room located east from the central room first floor 2 Rightmost Warden in the room located east from the central room first floor 3 Haunted Cloth in the room located east from the central room first floor 4 Warden in the room with 4 pleasure plates 5 Psicorp in the central room 6 Arrow Worm in the room located north from the central room first floor 7 Haunted Cloth in the room located north from the central room first floor 8 Arrow Worm in the room with the rolling rocks 9 Haunted Cloth in the room with the rolling rocks 10 Psicorp in the room with the rolling rocks (the rightmost hidden part) 11 Krawler in the room located west from the central room 12 Warden in the central room 13 Haunted Cloth in the room before the Ancient Half room 14 Krawler in the room before the Ancient Half room 15 Warden in the room with the rolling rocks"},{"location":"Flags%20arrays/Regionalflags/#bee-kingdom-hive","title":"Bee Kingdom Hive","text":"<p>NO REGIONAL FLAGS ARE USED FOR THIS AREA</p>"},{"location":"Flags%20arrays/Regionalflags/#honey-factory","title":"Honey Factory","text":"ID Description 0 Processing area, Security Turret in the first room 1 Processing area, Denmuki in the first room 2 Processing area, Bee-Boop in the room located east from the central room 3 Processing area, Denmuki in the room located east from the central room 5 Processing area, Bee-Boop in the central room 6 Processing area, Denmuki in the central room 7 Processing area, Security Turret in the central room 8 Processing area, Security Turret in the room located west from the central room top floor 9 Processing area, Bee-Boop in the first room 10 Processing area, Security Turret in the room located east from the central room 11 Processing area, Denmuki in the room located west from the center room top floor 12 Processing area, leftmost Bee-Boop in the room located north from the central room top floor 13 Processing area, rightmost Bee-Boop in the room located north from the central room top floor 14 Storage area, Abomihoney in the pit of the north room 15 Storage area, leftmost Abomihoney in the north room 16 Storage area, rightmost Abomihoney in the north room 17 Storage area, Denmuki in the large room with many stacked boxes 18 Storage area, Security Turret in the large room with many stacked boxes 19 Storage area, Bee-Boop in the south room 20 Storage area, got the Magic Seed in the south room"},{"location":"Flags%20arrays/Regionalflags/#rubber-prison","title":"Rubber Prison","text":"ID Description 0 Wasp Trooper in the library 1 Ruffian in a cage with a grey lever neat a save point 2 Burglar in the room located north of the room with Venus and some cages 3 Wasp Trooper on the lowest bridge outside 4 Wasp Scout on the bridget that leads to Giant's Lair outside 5 Ruffian on the bridge that leads to Giant's Lair outside 6 Wasp Scout on the bridge that leads to the warden office outside 7 Wasp Driller in the first room of the first floor 8 Wasp Bomber in the room located south of the room with Venus and some cages 9 Wasp Scout in the room with Venus and some cages 10 Wasp Trooper in the room with Venus and some cages 11 Wasp Trooper in the gym 12 Ruffian in the room with the prison cells and the shock platforms 13 Wasp Driller in the gym 14 Wasp Bomber in the room located north of the room with Venus and some cages 16 Ruffian in the room located north of the room with Venus and some cages 17 Wasp Bomber in the cafeteria 19 Wasp Trooper in the security room 22 Ruffian in the library 24 Wasp Driller in the warden office"},{"location":"Flags%20arrays/Regionalflags/#giants-lair","title":"Giant's Lair","text":"ID Description 0 Krawler in the room above the oven roomm 1 Dead Lander \u03b1 in the room located west from the refrigirator entrance 2 Dead Lander \u03b2 in the room located west from the refrigirator entrance 3 Rightmost Dead Lander \u03b1 in the room located east from the entrance 4 Dead Lander \u03b2 in the room located east from the entrance 5 Leftmost Dead Lander \u03b1 in the room located east from the entrance 6 Krawler in the top floor of the refrigirator 8 Krawler in the first floor of the refrigirator 9 Got the Mystery Berry in the room located west from the refrigirator entrance 10 Krawler near the rightmost red spring in the oven room 11 Leftmost Warden in the oven room 12 Rightmost Krawler in the oven room 13 Destroyed the boulder on the large book in the oven room 14 Rightmost Haunted Cloth in the oven room 15 Haunted Cloth behind the large book in the oven room 16 Rightmost Warden in the oven room 17 Haunted Cloth in the room above the oven room 18 Dead Lander \u03b1 in the room above the oven room 19 Warden in the room above the oven room 20 Krawler near the leftmost red spring in the oven room 30 Got a Magic Seed by digging in the dig spot in the oven room"},{"location":"Flags%20arrays/Regionalflags/#metal-lake","title":"Metal Lake","text":"ID Description 0 Water Strider at the bottom middle near a piece of wood 1 Wasp Scout near the green carton box 2 Wasp Scout closest to Rubber Prison 3 Water Strider closest to the Fishing village 4 Water Strider between Metal Island and Bugaria Piers (topmost one) 5 Water Strider closest to the Termite Capitol 6 Water Strider closest to the bottom right Island 7 Water Strider between Metal Island and Bugaria Piers (bottommost one)"},{"location":"Flags%20arrays/Regionalflags/#metal-island","title":"Metal Island","text":"<p>NO REGIONAL FLAGS ARE USED FOR THIS AREA</p>"},{"location":"Flags%20arrays/Regionalflags/#termite-capitol","title":"Termite Capitol","text":"<p>NO REGIONAL FLAGS ARE USED FOR THIS AREA</p>"},{"location":"Flags%20arrays/Regionalflags/#wasp-kingdom-hive","title":"Wasp Kingdom Hive","text":"ID Description 0 Destroyed the boulder in the prison cells room 1 Wasp Trooper in the room with the blue save point 2 Wasp Trooper in the prison cells room 3 Wasp Scout in the prison cells room"},{"location":"Flags%20arrays/Regionalflags/#bandit-hideout","title":"Bandit Hideout","text":"ID Description 0 Burglar in the first room from the Defiant Root well passage 1 Bandit in the first room from the Defiant Root well passage 2 Thief in the first room from the Defiant Root well passage 3 Burglar in the room with a table and a water droplet 4 Bandit in the room located south from the prison cells 5 Thief in the room located south from the prison cells 6 Got a Squash in the cafeteria near the cook 13 Thief in the cafeteria 14 Burglar in the cafeteria"},{"location":"Flags%20arrays/Regionalflags/#stream-mountain","title":"Stream Mountain","text":"ID Description 4 Belostoss in the room located east of the room where the Tydal Wyrm appears 5 Rightmost Water Strider in the room located east of the room where the Tydal Wyrm appears 6 Leftmost Water Strider in the room located east of the room where the Tydal Wyrm appears 8 Water Strider in the room locates east from the west entrance 9 Belostoss in the room locates east from the west entrance 10 Diving Spider in the room locates east from the west entrance 12 Water Strider in room with a crystal and exactly 2 tree branches 13 Diving Spider in room with a crystal and exactly 2 tree branches 14 Belostoss in the first room from the east entrance"},{"location":"Flags%20arrays/Regionalflags/#chomper-caves","title":"Chomper Caves","text":"ID Description 0 Chomper Brute in the lower part of the first room from the entrance 1 Chomper in the first room from the entrance 2 Middle Chomper in the room located west from the first room 4 Chomper Brute in the upper part of the room located west from the first room 3 Chomper Brute in the lower part of the room located west from the first room 5 Leftmost Chomper in the room located west from the first room 6 Rightmost Chomper in the room located west from the first room 7 Chomper Brute in the upper part of the first room from the entrance"},{"location":"Flags%20arrays/Regionalflags/#fishing-village","title":"Fishing Village","text":"<p>NO REGIONAL FLAGS ARE USED FOR THIS AREA</p>"},{"location":"Flags%20arrays/Regionalflags/#upper-snakemouth","title":"Upper Snakemouth","text":"ID Description 0 Got a Mushroom on top of the gears in the room located west from the center room 1 Bloatshroom in the first room from the entrance 2 Bloatshroom in the center room 3 Bloatshroom in the room located northwest from the center room 4 Bloatshroom in the room located southwest from the center room 5 Zombiant in the room located southwest from the center room 6 Zombeetle in the room located directly north from the center room 7 Zombee in the room located northwest from the center room 8 Zombeetle in the room located southeast from the center room 9 Zombee near a moving platform in the room located southeast from the center room 10 Bloatshroom in the room located southeast from the center room 11 Zombee in the center room 12 Zombee at the top of the room located southeast from the center room 13 Bloatshroom in the room located west from the center room"},{"location":"Flags%20arrays/flags/","title":"Flags","text":"<p>A global <code>flags</code> (not to be confused with the generic programming term) is a bool which is a global variable the game can access for any purpose. They are saved on the Save File and typically have one reserved use, but some can be used temporarily notably number 400 and number 0 (reserved for debugging). There are 750 global flags available to the game in the <code>MainManager.instance.flags</code> array.</p> <p>Before 1.1.0, there were 700 available flags instead.</p>"},{"location":"Flags%20arrays/flags/#notes-about-the-global-flags-table","title":"Notes about the global flags table","text":"<p>An empty description means unknown.</p>"},{"location":"Flags%20arrays/flags/#global-flags-table","title":"Global Flags table","text":"ID Description 0 Chapter 1, went northwest on the map with Chuck at the Outskirt~Set to false at the start of Chapter 2, then to true when getting into the mines 1 Talked to Utter for the first time in the City plaza 2 False when new unchecked quests are available, set to true when talking to Utter about new quests or checking the board 3 Took the Inn Review Required quest 4 Slept at the Inn for the first time at Ant Kingdom City plaza after taking the Inn Review Required quest 5 Completed the Inn Review Required quest 6 Talked to Samira for the first time 7 Chapter 1, fixed the bridge in Snakemouth Den by hitting the switch 8 Examined the Underground Bar entrance for the first time at Ant Kingdom City commercial area 9 UNUSED (Had an unimplemented use in the public demo involving solving a riddle by Reed to enter the Underground Bar) 10 Chapter 1, received tattle tutorial~Set to false in Chapter 3 when the Overseer is following you at the Honey Factory, set to true afterwards 11 Chapter 1, got Vi\u2019s Beemerang Toss 12 Set to true when giving the first of the 2 ingredients to a chef, set to false afterwards (confirming or talking after cancelling) 13 Chapter 1, pushed both pressure plates in Snakemouth Den in front of the door 14 Chapter 1, opened the door behind 2 pressure plates at Snakemouth Den 15 Chapter 1, started (after combat tutorial) 16 Chapter 1, Leif is now able to fight in battle (also got Freeze) 17 Chapter 1, got Kabbu\u2019s Horn Slash 18 Chapter 4, got Kabbu\u2019s Beetle Dig 19 Chapter 6, got Vi\u2019s Bee Fly 20 Chapter 3, hit the switch on the first room of the Honey Factory (also got Shield) 21 Chapter 2, got Vi\u2019s Beemerang Halt 22 Chapter 1, after pan-in cutscene when arriving at the entrance of Snakemouth Den 23 Got the HP Plus medal in Snakemouth Den 24 Received the Turn Relay tutorial 25 Chapter 1, read an ancient tablet in Snakemouth Den (after Leif said they can decipher the text) 26 Chapter 1, talked for the first time to Gen and Eri after combat tutorial at the Explorers' Association 27 Chapter 1, met Leif (after the cutscene is done) 28 Chapter 1, opened the gate near the Explorers' Association 29 Chapter 1, hit the switch to raise the platform in Snakemouth Den 30 Chapter 1, Approached the first yellow crystal (or after save tutorial?) 31 Received medals tutorial 32 Received Hard Mode after talking to Artis 33 Chapter 1, hit the big switch on the left path of Snakemouth Den (for the door) 34 Chapter 1, hit the big switch on the right path of Snakemouth Den (for the door) 35 Chapter 1, unlocked the door in Snakemouth Den after hitting both big switches 36 Chapter 1, arrived at the map with the door in Snakemouth Den (water droplets explanation cutscene) 37 Used the B.O.S.S. system for the first time~Also set to false when doing EX mode, set back to true once done 38 Chapter 4, beaten the Watcher at the Ancient Castle 39 Chapter 5, got Kabbu\u2019s upgraded Horn Dash 40 UNKNOWN used in event 25? 41 End of Chapter 1 42 Got the Poison Resistance medal at Snakemouth Den 43 Talked to Samira for the second time (after she\u2019s happy you are back) 44 Took the I Want a New Taste quest 45 Completed the I Want a New Taste quest 46 Talked to Chuck about his abode for the first time 47 Took the Theater Help Wanted! quest 48 Talked to Chubee at the Theater after taking the Theater Help Wanted! quest 49 Completed the Theater Help Wanted! quest 50 Took the Lost Toy quest 51 UNKNOWN used in event 32 52 Gave the Dotted Ball to Tod, completing the Lost Toy quest 53 Took the My Brother is Gone! quest 54 Talked to Leby after taking the My Brother is Gone! quest 55 Completed the My Brother is Gone! quest 56 A hard mode boss is available for turn-in to Artis for a prize medal (set to false once turned in) 57 Talked to the Fuzzo in the Theater for the first time (Bug Ranger Plushie cutscene) 58 Bought the Bug Ranger Plushie in the Theater 59 Got the Bug Me Not! medal on the roof of the gray house at Ant Kingdom City residential area 60 Got the Poison Defender medal in Snakemouth Den 61 Talked to Kina for the first time at the Explorers' Association 62 Talked to Chubee after the festival of Golden Settlement before taking the Theater Help Wanted! quest at the Ant Theater 63 Completed the game 64 Received quest board tutorial from Utter 65 Talked to Tatel at the Underground Bar 66 Got to the Ant Kingdom City bridge for the first time after the end of Chapter 1 (after the cutscene) 67 Start of Chapter 2 (after the cutscene in the throne room of the Ant Palace) 68 Chapter 2, after the Leif\u2019s memory cutscene when getting out of the throne room of the Ant Palace 69 Talked to the closest miner of the entrance of the mine for the first time 70 Took the Lost Books quest 71 Got the Lore Book at the Ant Palace library 72 Talked to Gen &amp; Eri after the end of Chapter 1 at the Explorers' Association 73 Chapter 2, rescued Neolith (after all cutscenes) 74 UNKNOWN 75 Opened the tunnel from Defiant Root to the mines 76 Opened the tunnel from Golden Settlement to the mines 77 Opened the tunnel from Forsaken Lands to the mines 78 Opened the tunnel from Metal Island to the mines 79 Opened the tunnel from Rubber Prison to the mines 80 Opened the tunnel from Far Grasslands to the mines 81 Talked to Diana for the first time at Golden Settlement 82 Got the Dotted Ball in the Golden Path tunnel 83 Opened the door to Golden Settlement that leads to Lost Sands 84 Chapter 2, after the cutscene when approaching Aria at the center of Golden Settlement before the festival 85 Chapter 2, waited for nightfall 86 Chapter 2, beaten Acolyte Aria 87 Got the Lore Book behind the Sunset Inn at Golden Settlement 88 End of Chapter 2 (after all the cutscenes) 89 UNKNOWN 90 Chapter 2, opened the windmill doors at Golden Settlement 91 Chapter 2, got the Hard Seed from the worker in front of the windmill at Golden Settlement after opening its door 92 Chapter 1, talked to Zasp for the first time after combat tutorial 93 Chapter 2, talked to Zasp about the eating competition at Golden Settlement 94 Chapter 2, talked to Chubee about the eating competition at Golden Settlement 95 Chapter 2, finished the eating competition (win or lose) during the festival 96 Chapter 2, got 15+ points at Whack-A-Worm during the festival at Golden Settlement to get the Sun Offering 97 Chapter 2, arrived at the center map of Golden Settlement after getting both Offerings (after the cutscene) 98 Chapter 2, got Kabbu\u2019s Pep Talk 99 Chapter 2, lost the eating competition during the festival 100 Chapter 2, won the eating competition during the festival 101 Chapter 2, got the Moon Offering during the festival 102 Chapter 2, got the Weak Stomach medal from losing at the eating competition during the festival 103 Chapter 2, after the cutscene where the path to the Golden Hills has opened 104 Chapter 2, talked to The Mayor for the first time at Golden Settlement 105 Chapter 2, talked to Chubee after losing against her in the eating competition during the festival 106 Got the Mothiva Doll at Golden Settlement 107 Got to the Ant Kingdom City plaza for the first time after the end of Chapter 1 (after the cutscene) 108 Received the Crystal Berry tutorial 109 Chapter 2, placed the Wooden Crank on the right hole at the entrance of Golden Hills 110 Chapter 2, placed the Wooden Crank on the hole at the left path from the entrance of Golden Hills 111 Chapter 2, talked to Venus after arriving at the entrance of Golden Hills 112 Chapter 2, got the Wooden Crank on the left path from the entrance of Golden Hills 113 Chapter 2, got the Big Crank Top Half at the Golden Hills 114 Approached Eetl at the Explorers' Association after the end of Chapter 1 115 Chapter 2, after the hungry cutscene at the Ant Kingdom City plaza 116 Chapter 2, got the Wooden Crank on the right path from the entrance of Golden Hills 117 Chapter 2, got the Big Crank Bottom Half at Golden Hills 118 Chapter 2, beaten Zasp &amp; Mothiva at Golden Hills 119 Chapter 2, cooked for the first time 120 Chapter 2, after the eating cutscene at Ant Kingdom City commercial area 121 Got the Back Support medal on the map with the Big Crank Bottom Half at Golden Hills 122 Chapter 2, beaten the 2 Venus Buds on the backside of the map with the Big Crank Bottom Half at Golden Hills 123 Talked to the Fortune Teller for the first time at Golden Settlement 124 Chapter 2, arrived at the top of Golden Hills (after the cutscene) 125 Chapter 2, gave the Sun Offering at the top of Golden Hills 126 Chapter 2, gave the Moon Offering at the top of Golden Hills 127 Chapter 2, pulled the lever at the top of Golden Hills 128 Chapter 2, placed the Wooden Crank at the top of Golden Hills 129 Chapter 2, got the Wooden Crank at the top of Golden Hills 130 Start of Chapter 3 (after all the cutscenes at the throne room of the Ant Palace) 131 Took the Requesting Assistance quest (set to false upon completion) 132 Talked to Team Slacker for the first time 133 Arrived at Golden Settlement after the end of Chapter 2 (after the cutscene) 134 Talked to Levi after taking the Requesting Assistance quest 135 Completed the Requesting Assistance quest 136 Talked to Rebecca for the first time at the Ant Palace 137 Got the HP Plus at the Bugaria Outskirts waterfall near the Cave of Trials 138 Chapter 3, lowered the bridge to the Lost Sands entrance at the Bugaria Outskirts 139 Talked to Tanjerin for the first time 140 Gained access to the Underground Bar at Ant Kingdom City commercial area 141 Talked to Shades for the first time at the Underground Bar 142 Got the Lore Book behind a wooden box at Defiant Root 143 Got the Crystal Fruit after beating the Seedling King 144 UNUSED (Genow: broodmother quest start) 145 UNUSED (Genow: mother chomper quest start) 146 Took the Peacock Spider bounty quest 147 UNUSED (Genow: sandwyrm miniboss quest start) 148 UNUSED (Genow: centipede quest start) 149 Got the Fortify medal at Defiant Root 150 Rented a Bed Bug at Defiant Root, set to false after using it 151 Talked to the Fuzzo at Defiant Root for the first time 152 Talked to the Sun for the first time at Defiant Root 153 Got the Heart Berry from Sun at Defiant Root 154 Got the Bond Berry from Sun at Defiant Root 155 Got the Super Pepper from Sun at Defiant Root 156 Got the Iron Seed from Sun at Defiant Root 157 Received the first free Bed Bug at Defiant Root 158 Talked to Doppel for the first time (or checked the bounty quest board) at the Underground Bar 159 Chapter 3, got scanned at the Bee Kingdom Hive entrance 160 Chapter 3, after getting welcomed at Bee Kingdom Hive (before getting to Dr. HB\u2019s room)~Also allows the use of Bubble Shield Lite 161 Showed the Explorer Permit to Dr. HB at Bee Kingdom Hive which unlocks the B.O.S.S. system 162 Logged in to the B.O.S.S. system (set to false when logging off)~Also used when starting Cave of Trials (set to false when ending) 163 Unlocked the EX mode from the B.O.S.S. system 164 Got the Spy Specs medal from the B.O.S.S. system 165 Got the Detector medal from the B.O.S.S. system 166 EX mode active on the B.O.S.S. system 167 Chapter 3, told Gen &amp; Eri to go to the meeting point at Bee Kingdom Hive 168 Chapter 3, told Zasp to go to the meeting point at Bee Kingdom Hive 169 Chapter 3, met the Queen Bianca for the first time in her room at Bee Kingdom Hive (after all cutscenes) 170 Chapter 3, arrived at Defiant Root for the first time 171 Got Leif\u2019s Icicle 172 Chapter 3, used the elevator at Defiant Root for the first time 173 Chapter 3, told Mothiva to go to the meeting point at Bee Kingdom Hive 174 Chapter 3, after the cutscene when exiting the throne room at the Ant Palace 175 Got in Professor Honeycomb\u2019s room for the first time at Bee Kingdom Hive 176 Chapter 3, the shop in Honey Factory is unlocked 177 Chapter 3, arrived at Honey Factory for the first time 178 Chapter 3, got the Factory Pass in the Overseer\u2019s office 179 Chapter 3, unlocked the factory door at the Honey Factory lobby 180 Talked to Ms. Amber for the first time 181 Set to true when the tutorial on Spy Cards starts (set to false when the tutorial is done) 182 Took the Cable Car Bodyguard quest 183 Completed the Cable Car Bodyguard quest 184 Took the Team Snakemouth\u2026 quest 185 Talked to Aria after taking the Team Snakemouth\u2026 quest 186 Took the My Specialty quest (set to false after completing it) 187 Took the I Wanna Get Better! quest (set to false after completing it) 188 Took the Lost Item quest 189 Completed the Lost Item quest 190 Took the Butler Missing! quest 191 Crisbee can cook the Crisbee Donut, marking the completion of I Wanna Get Better! quest) 192 Gave the Tangy Berry to Kut, marking the completion of the My Specialty quest 193 Gave the Crisbee Donut and the Tangy Carpaccio to Fry, marking the completion of the A Smiling Dish quest 194 Gave the correct ingredients to Crisbee after taking the I Wanna Get Better! quest, set to false after the cutscene~Also used similarly for Kut after taking the My Specialty quest~Also used similarly for Fry after taking the A Smiling Dish quest 195 Talked to Kut after taking the My Specialty quest 196 Talked to Fry after taking the A Smiling Dish quest (set to false after cooking the Queen\u2019s Dinner) 197 Took the A Smiling Dish quest (set to false when completed) 198 Talked to Madeleine for the first time after taking the Butler Missing! quest 199 Found Seb after taking the Butler Missing! quest 200 Completed the Butler Missing! quest 201 Chapter 3, rescued the merchants at Lost Sands 202 hit the tree near the south exit at the platforming map of Lost Sands 203 hit the tree leading north to the northeast exit at the platforming map of Lost Sands 204 hit the tree near the east exit at the platforming map of Lost Sands 205 hit the tree near the northeast exit at the platforming map of Lost Sands 206 hit the tree leading north to the north exit at the platforming map of Lost Sands 207 hit the tree leading northeast near the west exit at the platforming map of Lost Sands 208 hit the tree leading south near the west exit at the platforming map of Lost Sands 209 hit the second tree leading west from the south exit at the platforming map of Lost Sands 210 Got the Succulent Berry dropped from the bush near the cactus at the map located west of the merchant rescue map 211 Chapter 3, rescued Malbee at the Honey Factory 212 Chapter 3, got the Factory Pass in the room on the upper north side of the Honey Factory 213 Chapter 3, got the Factory Pass in the room with Gen &amp; Eri using the switch at the Honey Factory 214 Hit the lever in the room with Gen &amp; Eri using a switch at the Honey Factory 215 Chapter 3, got the Factory Pass in the room on the upper west side at the Honey Factory 216 Chapter 3, beaten the Bee-Boops that were harassing Gen &amp; Eri at the Honey Factory 217 Chapter 3, unlocked the door with the 3 Factory Pass at the Honey Factory 218 Chapter 3, rescued the Overseer (after the cutscene) 219 Talked to Dr. HB after the end of Chapter 3 at Bee Kingdom Hive 220 Chapter 3, got the Shock Trooper medal in the first storage room at the Honey Factory 221 Chapter 3, beaten Ahoneynation (after all the cutscenes) 222 Chapter 3, unlocked the door in the storage room at the Honey Factory 223 Examined the Overseer portrait at the Honey Factory for the first time 224 After the cutscene that occurs when exiting the Honey Factory after the end of Chapter 3 225 Talked to Queen Bianca after the end of Chapter 3 at Bee Kingdom Hive 226 Took the Power Plant Investigation quest 227 Talked to the bee that is selling her house at Bee Kingdom Hive residential area 228 Got the Flower Key from Beette at the Bee Kingdom Hive residential area 229 Unlocked the red house with the Flower Key at Ant Kingdom City plaza 230 Got the Charge Up medal on the roof of the inn at Ant Kingdom City Plaza 231 Got the Blank Card from Carmina at the Underground Bar 232 Got the Suit Card from Chuck at Bugaria Outskirts 233 Got the Suit Card from Shay at Defiant Root 234 Got the Suit Card from Crow at Bee Kingdom Hive 235 Got the Suit Card from Arie at Golden Settlement 236 Talked to Carmina for the first time at the Underground Bar 237 Talked to Carmina after gathering the required Spy Cards 238 Received the Mysterious Piece from Neolith after starting Chapter 4 239 Chapter 4, got the Rusty Key from Astotheles at Defiant Root 240 Took the Book Return! quest 241 Received the Overdue Book from Ali at the Ant Kingdom City residential area 242 Delivered the Overdue Book at the Ant Palace library 243 Completed the Book Return! quest 244 Talked to Shay at Defiant Root for the first time after getting the Blank Card 245 Got the Full Suit Card 246 Talked to Crow about the Card Masters for the first time before the end of Chapter 3 247 Talked to Crow about Spy Cards for the first time at Bee Kingdom Hive after getting the Blank Card 248 Talked to Chuck about Spy Cards for the first time at Bugaria Outskirts after getting the Blank Card 249 Talked to Arie about Spy Cards for the first time at Golden Settlement after getting the Blank Card 250 Chapter 4, received berries from The Mayor at Defiant Root 251 Bought the Bee Hat at Bee Kingdom hive 252 Bought the Pretty Ribbon at Bee Kingdom Hive 253 After getting introduced to the Bank of Bugaria at Ant Kingdom City residential area 254 After signing up for a bank account at the Ant Kingdom City residential area 255 Hit the switch at the top of Stream Mountain at Lost Sands 256 Took the I Want a Souvenir\u2026 quest 257 Completed the I Want a Souvenir\u2026 quest 258 Chapter 4, used the Rusty Key on the Bandit Hideout entrance at Lost Sands 259 Chapter 4, arrived at the map south of the prison for the first time at Bandit Hideout 260 Chapter 4, after the cutscene of the bandits talking with the wasps near the large item chest at Bandit Hideout 261 Hit the tree leading west at the map with the orange spike floor at Lost Sands 262 Got the Meditation medal at Lost Sands 263 Talked to the bee in front of the Far Grasslands border gate for the first time at Lost Sands~Set to false at the start of Chapter 5, then to true when talking to him again 264 Talked to the Burglar at the map with the waterfall and the save point for the first time at Lost Sands 265 Took the Stolen Item quest 266 Took the Rare Item Wanted! quest 267 Got the Bond Berry at Bandit Hideout 268 Got the Orange Horn at Bandit Hideout 269 Chapter 4, retrieved your inventory as well as the Beemerang at Bandit Hideout 270 Got the Stolen Silk at Bandit Hideout 271 Got the Lore Book near the large item chest at Bandit Hideout 272 Took the Huuuuuuuuuu\u2026!!! quest 273 Talked to Tanjerin after taking the Huuuuuuuuuu\u2026!!! quest 274 Gave the Orange Horn to Tanjerin after taking the Huuuuuuuuuu\u2026!!! quest 275 Completed the Huuuuuuuuuu\u2026!!! quest 276 Got introduced to the Whack-A-Worm minigame at the Whacka Farms for the first time 277 UNUSED (Genow: reward from wackaworm highscore) 278 Talked to a healing Venus Bud for the first time 279 Talked to Team Slacker in front of the Ancient Castle\u2019s receptacle 280 Chapter 4, placed the Sand Castle Key in its receptacle at Lost Sands 281 Got the Agaric Shroom at the map with the green spike floor at Lost Sands 282 Hit the tree leading east at the map with the green spike floor at Lost Sands 283 Chapter 4, hit the switch in the rolling rocks room for the shortcut at Ancient Castle 284 Chapter 4, opened the upper left door in the west room on the first floor of Ancient Castle 285 Got the Frostbite medal at Ancient Castle 286 Approached Leif\u2019s family\u2019s house after the start of Chapter 3 (after the cutscene) 287 Talked to Levi after taking the Requesting Assistance quest~Set to false when talking to them after completing the quest near the Underground Bar entrance 288 Chapter 4, got the Ancient Key behind the spike bars at Ancient Castle 289 Chapter 4, got the Ancient Key in the 4 pressure plates room at the Ancient Castle 290 Chapter 4, hit the switch on the first floor of the main room for the shortcut at Ancient Castle 291 Chapter 4, hit the switch on the second floor of the main room for the shortcut at Ancient Castle 292 Chapter 4, unlocked the door on the first floor of the main room of Ancient Castle 293 Chapter 4, unlocked the door on the second floor of the main room of Ancient Castle 294 Chapter 4, got the Big Ancient Key at Ancient Castle 295 Chapter 4, unlocked the door with the Big Ancient Key at Ancient Castle 296 Chapter 4, opened the door in the 4 pressure plates room at Ancient Castle 297 Chapter 4, destroyed the rocks on the west side of the rolling rocks room at Ancient Castle 298 Chapter 4, approached the Dune Scorpion at Lost Sands (when the cutscene starts) 299 End of Chapter 3 (after all the cutscenes) 300 Start of Chapter 4 (after all the cutscenes) 301 Chapter 4, got the Earth Key from Astotheles at Bandit Hideout (after all cutscenes) 302 Chapter 4, got the Heaven Key from Hawk at Lost Sands 303 Chapter 4, got the Sand Castle Key 304 Used the Power Gen on the giant door in Snakemouth Den 305 Got the Heart Berry at the Whacka Farms by getting 25+ points at Whack-A-Worm 306 Examined the mural on the second floor of Ancient Castle for the first time 307 Took the Dropped My Hat! Quest 308 Completed the Dropped My Hat! quest 309 Found the Top Hat at Golden Settlement 310 Bought the Empower+ medal at the Termacade 311 Bought the Break+ medal at the Termacade 312 Bought the Enfeeble+ medal at the Termacade 313 Bought the Fortify+ medal at the Termacade 314 Bought the Charge Up+ medal at the Termacade 315 Showed the Full Suit Card at the Card Guard in front of the entrance to the Spy Cards tournament at Metal Island 316 The first water crystal switch encountered at Stream Mountain is activated 317 Hit the tree on the right of the map with the first water crystal switch at Stream Mountain 318 Hit the tree on the left of the map with the first water crystal switch at Stream Mountain 319 Got the Crimson Ore at the top of Stream Mountain at Lost Sands 320 Took the Ore Wanted quest 321 Completed the Ore Wanted quest 322 Chapter 5, talked to Maki near the Far Grasslands entrance at Lost Sands 323 Chapter 5, talked to Maki at the entrance of Far Grasslands 324 Took the Helpers Needed At Once! quest 325 Talked to Malbee after taking the Helpers Needed At Once! quest 326 Performed the reset on the Mender near the pump at the Honey Factory 327 Performed the reset on the Mender at the room before the pump at the Honey Factory 328 Performed the reset on the Mender near the crank in a glass enclosure at the Honey Factory 329 Performed the reset on all three Menders at the Honey Factory 330 Completed the Helpers Needed At Once! quest 331 Got the Lore Book at the Fishing Village 332 Destroyed the breakable rock at the entrance of the Power Plant / Far Grasslands passage at Far Grasslands 333 UNUSED (Genow: far grasslands cave wasp side) 334 Chapter 5, beaten the Leafbug tribes at the north exit of the second map at Wild Swamplands 335 Chapter 5, used Kabbu\u2019s horn on a rock that falls to open a path at Wild Swamplands 336 Chapter 5, got ambushed by the Leafbug tribes at the wooden bridge at Wild Swamplands 337 Hit a tree at the destroyed wooden bridge room at the Wild Swamplands 338 Got the Berserker medal at Chomper Caves 339 Beaten the Mother Chomper at Chomper Caves 340 Got the Chomper Seed at Chomper Caves 341 Hatched the Chomper Seed at Bee Kingdom Hive 342 Hit the donut shaped stone with Kabbu\u2019s horn at Lost Sands 343 Got the Tardigrade Shield medal at Lost Sands 344 Got the A.D.B.P Enhancer medal from Professor Honeycomb at Bee Hive Kingdom (after all cutscenes) 345 End of Chapter 4 (after all the cutscenes) 346 Chapter 6, got the Flame Brooch from Queen Vanessa II at Rubber Prison (after all the cutscenes) 347 Start of Chapter 6 (after all the cutscenes) 348 Start of Chapter 5 (same as 304???) 349 Currently using the Ant Storage Service (used in the multi select logic) 350 Chapter 6, dropped off Queen Elizant II at the Bugaria Outskirts (after all the cutscenes) 351 Talked to the person in front of the Termacade for the first time 352 Got the A.D.B.P Enhancer medal from Professor Honeycomb at Bee Hive Kingdom (set when receiving it) 353 Talked to Hawk after helping him at the Roach Village ruins at Bee Kingdom Hive 354 Hit a lever to create a shortcut at Wild Swamplands 355 Got the Eternal Venom medal at Wild Swamplands 356 Chapter 5, lowered the wooden cage by hitting a level at the Wild Swamplands 357 Chapter 5, arrived at Wild Swamplands for the first time 358 Chapter 5, talked to Maki for the first time after getting back to him after his injury at Wild Swamplands 359 Chapter 5, beaten The Beast at Wild Swamplands 360 Chapter 5, met with Maki after exiting Wild Swamplands at Far Grasslands (after the fade out) 361 Opened the east gate at the Power Plant / Far Grasslands passage 362 Opened the west gate at the Power Plant / Far Grasslands passage 363 Chapter 5, unlocked the first door at Wasp Kingdom Hive 364 Chapter 5, got the Wasp Key in the room with the fountain at Wasp Kingdom Hive (set to false if spotted without first exiting the room with it) 365 Chapter 5, unlocked the door in the food storage room at Wasp Kingdom Hive 366 Chapter 5, arrived at Jayde\u2019s room for the first time at Wasp Kingdom Hive (when the cutscene starts) 367 Chapter 5, arrived at the first room for the first time at Wasp Kingdom Hive 368 Chapter 5, arrived at the food storage room for the first time at the Wasp Kingdom Hive 369 Got the dark cherries in the prison room at the Wasp Kingdom Hive 370 Chapter 5, approached the back of the throne room for the first time at Wasp Kingdom Hive (when the cutscene starts) 371 Chapter 5, met with Queen Vanessa II for the first time at Wasp Kingdom Hive (after all the cutscenes) 372 Chapter 5, returned to the Ant Kingdom after leaving Wasp Kingdom Hive 373 Received the Ant Compass from the miner at the Ant Mines 374 Chapter 6, left the throne room of the Ant Palace after the start of Chapter 6 (after all the cutscenes) 375 Took the Butler Missing Again! quest 376 Chapter 6, talked to Queen Elizant II at the Golden Path tunnel 377 It is now possible to buy Dark Cherries at the Underground Bar 378 Talked to Cherry Guy for the first time at the Underground Bar 379 Chapter 6, talked about the Subaquatic Maritime Neotransport to the royal couple at Termite Capitol 380 Got the Lore Book at the Golden Path by digging under a rock at the map located east from Golden Settlement 381 Got the Lore Book at the Colosseum entrance at Termite Capitol 382 Hit the red ruler with Kabbu\u2019s horn at the Forsaken Lands 383 Chapter 5, arrived at the map where The Beast silhouette appears (at the beginning of the cutscene) 384 Chapter 5, got the Wasp Key in the west room at Wasp Kingdom~Chapter 6, arrived at Termite Capitol for the first time??? (error?) 385 Chapter 6, beaten the Primal Weevil (after all the cutscenes) 386 Chapter 6, talked to the royal couple at Termite Capitol for the first time 387 Talked to Team Slacker about the False Monarch for the first time at Termite Capitol 388 Got the Lore Book near the Underground Bar entrance at Ant Kingdom City commercial area 389 Talked to Madeleine after taking the Butler Missing Again! quest 390 Talked to Seb after taking the Butler Missing Again! quest 391 Completed the Butler Missing Again! quest 392 Got the Lore Book in Madeleine\u2019s house at the Explorer Association Area 393 Gave the Queen\u2019s Dinner to Aria after taking the Team Snakemouth\u2026 quest 394 Completed the Team Snakemouth\u2026 quest 395 Talked to Isau for the first time after taking the Rare Item Wanted! quest 396 Gave the Sophie Petal to Isau, completing the Rare Item Wanted! quest 397 Got the Dark Cherries at Golden Path 398 Grabbed the Dark Cherries underneath a breakable rock on the map located east of the Defiant Root map with the save point. 399 UNUSED 400 Gave the correct ingredients to Crisbee after taking the I Wanna Get Better! quest, set to false after the cutscene~Also used similarly with Fry after taking the A Smiling Dish quest~Also for Chapter 3, when it is possible to signal Gen &amp; Eri to use a switch at the Honey Factory~Also set to true then false when talking to Crow about Spy Cards~Also used in the Spy Cards tournament (true after the first match, false when the tournament is over)~Chapter 6, also used when the fight against Zasp &amp; Mothiva starts at the Colosseum (set to false when the fight is won)~Chapter 7, also used when the Wasp King is about to turn into Everlasting King (set to false when the transformation is complete) 401 Chapter 4, arrived at the map south of the prison for the first time at Bandit Hideout, set to false when exiting the map~Chapter 5, also used after arriving at the first room of Wasp Kingdom Hive (set to false after leaving Wasp Kingdom HiveChapter 7, also used when arriving in a room with an eye at Giant\u2019s Lair (set to false when leaving to a room with no eyes) 402 Chompy is with Team Snakemouth 403 Chompy is at the red house at Ant Kingdom City Plaza 404 Chompy has a ribbon on 405 Chompy is at Bee Kingdom Hive 406 UNUSED 407 Asked Wayde if they are okay at Defiant Root 408 Talked to Tynn at the Termite Capitol after asking Wayde if he was okay 409 Chapter 6, after winning all three rounds at the Colosseum 410 Gave the Bug Ranger Plushie at the child near the Colosseum entrance at Termite Capitol 411 Placed the Mysterious Piece in the receptacle at the Cave of Trials 412 Talked to the Holo Assistant for the first time at the Cave of Trials 413 Got the HP Plus medal at Lost Sands near the Bandit Hideout entrance 414 Showed the Explorer Permit to the Holo Assistant at the Cave of Trials 415 Got the Strong Start medal at Lost Sands 416 Hit an ice crystal switch for the first time at Ancient Castle 417 UNUSED (Opened the book object at Lost Sands, a remnant of a cut quest involving Neolith 418 Got the Antlion Jaws medal at Stream Mountain 419 Arrived at Metal Island for the first time 420 Chapter 6, arrived at Forsaken Lands for the first time 421 Got the Sophie Petal at the top of Snakemouth Den 422 Took the Help Me Get it Back! quest 423 Took the Explorer Check! Quest (set to false upon completion) 424 Took the Bandit Hunt quest 425 Took the In Search of Paint\u2026 quest 426 Took the Lunch Delivery! quest 427 Saw Mun get his Leaf Mask stolen by bandits at Bugaria Outskirts 428 Took the It\u2019s Time\u2026! quest 429 Talked to Ven after taking the Bandit Hunt quest 430 Completed the Bandit Hunt quest 431 Talked to Artia for the first time after taking the In Search of Paint\u2026 quest 432 Got the Shady note from Reed at the Underground Bar 433 Talked to Edgy after taking the In Search of Paint\u2026 quest at Termite Capitol 434 Got the Blackest Paint from Edgy at Termite Capitol 435 Completed the In Search of Paint\u2026 quest 436 Talked to Artia at Bee Kingdom Hive about Edgy after taking the In Search of Paint\u2026 quest 437 Talked to Madame Jaune for the first time at Bee Kingdom Hive 438 Talked to Dashy about the Red Paint at Golden Settlement 439 Talked to Genow at Defiant Root about the Root Cloth 440 Talked to Ann at the Ant Kingdom City plaza about the Ant Doll 441 Got the Eastern Doll from Jug at Metal Island 442 Gave the Eastern Doll to Ann in exchange for the Ant Doll at the Ant Kingdom City plaza 443 Gave the Ant Doll to Genow in exchange for the Root Cloth at Defiant Root 444 Gave the Root Cloth in exchange for the Red Paint to Dashy at Golden Settlement 445 Got the Vi\u2019s Sharing Stash battle skill 446 Gave the Red Paint to Madame Jaune at Bee Kingdom Hive 447 Chapter 6, talked about the Subaquatic Maritime Neotransport to Biggs near it at the Termite Capitol 448 Chapter 6, disembarked from the Subaquatic Maritime Neotransport at Bugaria Outskirts Piers 449 Fell into the pit near the Wizard Tower for the first time at Far Grasslands 450 Talked to The Wizard at the Wizard Tower for the first time at Far Grasslands 451 Got the Crystal Berry from the pink spider at Forsaken Lands 452 Arrived at the map located east from the pumpkin map for the first time at Forsaken Lands (the crate disappears when this turns on) 453 UNUSED (Genow: layna following) 454 Got the Crystal Crown by beating the False Monarch 455 Got the Lore Book at the map with the wind blowers at Forsaken Lands 456 Unlocked the door at the Power Plant after taking the Power Plant Investigation quest 457 Approached the back exit of the Power Plant after taking the Power Plant Investigation quest 458 Examined the Power Plant for the first time 459 Arrived at the Broodmother map after taking the Power Plant Investigation quest (this also marks completing the quest after the battle) 460 Got the Lore Book at the map with the wasps\u2019s border at Far Grasslands 461 Talked to Jayde for the first time at Golden Settlement 462 Got the Life Cast medal at the top of the Golden Path tunnel 463 Got the Lore Book on the map located west from Patton\u2019s hut at Forsaken Lands 464 Took the Best Friend In The Fog! quest 465 Talked to Layra after taking the Best Friend In The Fog! quest 466 Arrived at the area located north of Layra\u2019s friend for the first time after taking the Best Friend In The Fog! quest 467 Talked about fireflies with Layra at the foggy map after taking the Best Friend In The Fog! quest 468 Completed the Best Friend In The Fog! quest 469 Got the Lore Book in an apartment room located high up at Termite Capitol 470 Examined the view of Termite Capitol for the first time at the Forsaken Lands 471 Completed the Stolen Item quest 472 Talked to Kali after taking the Stolen Item quest 473 Took the Seedling Hunt quest 474 Talked to Takkun for the first time after taking the Seedling Hunt quest 475 Received the Wrapped Lunch from Yatanta after taking the Lunch Delivery! quest 476 Completed the Lunch Delivery! quest 477 Completed the Seedling Hunt quest 478 Talked to Team Slacker about the Seedling King for the first time 479 Took the Parts Delivery quest 480 Received the Package from Eetl after taking the Parts Delivery quest 481 Completed the Parts Delivery quest 482 Took the Hydration Crisis! quest 483 Talked to the farmer for the first time at Golden Settlement (Hydration Crisis! quest) 484 Completed the Hydration Crisis! quest 485 Talked to Alex for the first time after taking the It\u2019s Time\u2026! quest 486 Completed the It\u2019s Time\u2026! quest 487 Got the Danger Spud at the Explorers' Association area 488 Got the Lore Book at Monsieur Scarlet\u2019s place 489 Got the Lore Book in the locked room at Defiant Root 490 Got the Dark Cherries in the locked room at Defiant Root 491 Hit the tree in the map before Tidal Wyrm at Stream Mountain 492 The water crystal switch on the way to the Tidal Wyrm at Stream Mountain is activated 493 Got the Clear Water on the map located east of the Tidal Wyrm map 494 Got the Crystal Fang by beating the Devourer 495 Talked to Team Slacker about the Tidal Wyrm at Lost Sands for the first time 496 Got the Coal Crystal by beating Tidal Wyrm 497 Beat Cenn &amp; Pisci after taking the Explorer Check! quest at Ant Kingdom City commercial area 498 Completed the Explorer Check! quest 499 Got the Lore Book at the fake Ant Village at Forsaken Lands 500 Talked to Team Slacker about the Devourer for the first time at Golden Settlement 501 Talked to Team Slacker about the Peacock Spider for the first time at Metal Island 502 Got the Crystal Feather after beating the Peacock Spider 503 Beaten battle 10 of the Cave of Trials for the first time 504 Beaten battle 20 of the Cave of Trials for the first time 505 Beaten battle 30 of the Cave of Trials for the first time and got the Defense Exchange medal 506 Beaten battle 40 of the Cave of Trials for the first time and got the TP Saver medal 507 Got the Tangy Berry at the Cave of Trials 508 Got the Dark Cherries at the Cave of Trials 509 Beat Riz (after all the cutscenes) 510 Took the Sweets from Outside! quest by Rizza at the Fishing Village 511 Completed the Sweets from Outside! quest 512 Talked to Mun for the first time after taking the Help Me Get it Back! quest 513 Beat the bandits that took Mun\u2019s mask after taking the Help Me Get it Back! quest 514 Completed the Help Me Get it Back! quest 515 Talked to the child at the Colosseum entrance for the first time at Termite Capitol 516 Talked to the child at the Colosseum entrance for the first time after winning the Colosseum at Termite Capitol 517 Placed the Peculiar Gem in its receptacle at Snakemouth Den 518 Hit the switch to open the door in the first room of Upper Snakemouth 519 Solved the switches puzzle at Upper Snakemouth 520 Got the Medium Gear in the room with the switch puzzle at Upper Snakemouth 521 Got the Small Gear in the room with 4 pressure plates at Upper Snakemouth 522 Got the Extra Freeze medal at Upper Snakemouth 523 Got the Lab Card in the room located south from the main room at Upper Snakemouth 524 Opened the northeast door from the main room in Upper Snakemouth 525 Opened the northwest door from the main room in Upper Snakemouth 526 Got the Lab Card in the room located southwest from the main room at Upper Snakemouth 527 Got the Big Gear in the room located northwest from the main room at Upper Snakemouth 528 Placed all gears and opened the door in the room located west from the main room at Upper Snakemouth 529 Placed the Medium Gear in the room located west from the main room at Upper Snakemouth 530 Placed the Small Gear in the room located west from the main room at Upper Snakemouth 531 Placed the Big Gear in the room located west from the main room at Upper Snakemouth 532 Beat Zommoth at Upper Snakemouth (during the cutscenes) 533 Met Leif\u2019s family at their house in Ant Kingdom City residential area (after the first cutscene of meeting them) 534 Got the Super Block+ medal at Golden Path 535 Chapter 6, gray levers at Rubber Prison engaged (this is a toggle) 536 Chapter 6, got the Prison Key in the spike floor room of the first floor at Rubber Prison 537 Chapter 6, unlocked the door in the spike floor room of the first floor at Rubber Prison 538 Chapter 6, opened the door by presenting the Explorer Permit in the west room of the first floor at Rubber Prison 539 Chapter 6, opened the door to the cafeteria at the Rubber Prison 540 Chapter 6, hit the east wooden lever in the room with the save point on the second floor at Rubber Prison 541 Chapter 6, hit the lever for a shortcut to the third floor on the second floor of Rubber Prison 542 Chapter 6, unlocked the door in the cells room on the second floor of Rubber Prison 543 Taking the Find The Ingredients! quest from The Wizard 544 Completed the Find The Ingredients! quest from The Wizard 545 Chapter 6, got the Prison Key in the cell on the second floor of Rubber Prison 546 Examined the Wizard Tower from the front for the first time at the Far Grasslands 547 Got the Burly Tea in the Wizard Tower at the Far Grasslands 548 Chapter 6, got the blue History Book at the Rubber Prison 549 Chapter 6, hit the lever in the cafeteria to stop the rolling rocks at the Rubber Prison (this is a toggle) 550 Chapter 6, changed the position of the cafeteria tables at the Rubber Prison (this is a toggle) 551 Chapter 6, got the Prison Key on the third floor of Rubber Prison 552 Chapter 6, turned on the backup power at the Rubber Prison 553 Chapter 6, toggles between true and false a bunch of time when turning on the computer at the Rubber Prison 554 Chapter 6, solved the history books puzzle at the Rubber Prison 555 Chapter 7, the Everlasting Sapling\u2019s container is opened (set during the cutscene of it opening, set to false once the fight is done after the fade out)~Chapter 7, also used when arrived at Ant Kingdom City after beating Everlasting King~This is the post game flag 556 Took the Want to Relive Memories\u2026 quest 557 Talked to The Mayor after taking the Want to Relive Memories\u2026 quest 558 Brought The Mayor to Whacka Farms after taking the Want to Relive Memories\u2026 quest 559 Completed the Want to Relive Memories\u2026 quest 560 Unlocked the door at Defiant Root 561 Chapter 6, got the Wooden Crank at the Rubber Prison 562 Beat Carmina at Metal island (after all the cutscenes) 563 Chapter 6, got the green History Book at the Rubber Prison 564 Chapter 6, got the yellow History Book at the Rubber Prison 565 Chapter 6, placed the Wooden Crank at the Rubber Prison 566 Chapter 6, hit the lever for the shortcut platform on the first floor of Rubber Prison 567 Chapter 6, opened the final door which is a shortcut to the first floor of Rubber Prison 568 Start of Chapter 7 569 Chapter 7, talked to Venus for the first time at Giant\u2019s Lair 570 Took the It\u2019s Too Hot! quest 571 Talked to Eremi for the first time after taking the It\u2019s Too Hot! quest 572 Got the Leaf Umbrella from Madeleine 573 Completed the It\u2019s Too Hot! quest by giving a Magic Ice or a Shell Ointment 574 Gave the Leaf Umbrella to Eremi at Defiant Root after taking (or completing) the It\u2019s Too Hot! quest 575 Got the Heal Plus medal at the Fishing Village by talking to the Stickbug 576 Took the In Search of Something quest from Elom at the west cave at the Bugaria Outskirts 577 Talked to Tekci at the top of Golden Hills after taking the In Search of Something quest 578 Completed the In Search of Something quest 579 Talked to Librem in the Ant Palace library for the first time 580 Talked to Diana at the break room of the Ant Mines for the first time 581 Talked to Patton for the first time in post game at Forsaken Lands (right when the cutscene starts) 582 Chapter 6, got the red History Book at the Rubber Prison 583 Chapter 6, broke the bridge on the second floor of Rubber Prison 584 Chapter 6, beat ULTIMAX Tank (after the cutscene) 585 Got spotted by an eye at Giant\u2019s Lair for the first time 586 Chapter 7, arrived at the Roach Village for the first time at Giant\u2019s Lair (after all the cutscenes) 587 Bought all medals at the shop at Ant Kingdom City commercial area 588 Bought all of Shades\u2019s medals 589 Broke the breakable rock on the lowest floor at the Rubber Prison pier 590 Bought the Venom Ribbon at the Termacade 591 Bought the Shocking Ribbon at the Termacade 592 Bought the Drowsy Ribbon at the Termacade 593 Chapter 7, beat the Dead Landers trio near the refrigerator at Giant\u2019s Lair 594 Chapter 7, approached the refrigerator for the first time at Giant\u2019s Lair (as soon as the cutscene starts, set to false after the fight)~Chapter 7, also used similarly with the fire constructs 595 Chapter 7, convinced the roach elder to destroy the Everlasting Sapling at Giant\u2019s Lair 596 Spoke to the Roach Elder during the postgame at Giant's Lair 597 Went to another area then came back to Giant's Lair after speaking with the Roach Elder during the postgame 598 Talked to Kenny at Golden Settlement 599 Talked to Kenny at Bee Kingdom Hive residential area 600 Talked to Kenny at Defiant Root 601 Talked to Kenny at Ant Kingdom City commercial area 602 Talked to Kenny at Termite Capitol 603 Got the Lore Book by Kenny after talking to him at the end of his travel at Golden Settlement 604 Got the Lore Book in the room above the inn at Defiant Root 605 Completed the Lost Books quest 606 Chapter 6, after the second round of the Colosseum (during the Primal Weevil\u2019s appearance) 607 Took the Confidential quest 608 Talked to Maki after taking the Confidential quest 609 Completed the Confidential quest 610 Beaten Maki\u2019s team for the first time 611 Got the Status Mirror medal at Giant\u2019s Lair 612 Completed all bounties 613 RUIGEE code active 614 HARDEST code active 615 FRAMEONE code active 616 PUSHROCK code active 617 Took the Awful\u2019s Beauty quest 618 Talked to Reeves for the first time after taking the Awful\u2019s Beauty quest 619 Completed the Awful\u2019s Beauty quest 620 Got the Bad Book in the Wizard Tower at Far Grasslands 621 Got the Bad Book on the roof of Leif\u2019s family\u2019s house at Ant Kingdom city residential area 622 Got the Bad Book in Madame Jaune\u2019s room at Bee Kingdom Hive 623 Got the Mechanical Claw at Far Grasslands 624 Took the Can\u2019t Sleep\u2026! quest 625 Talked to Tarar after taking the Can\u2019t Sleep\u2026! quest 626 Gave the Drowsy Cake to Tarar after taking the Can\u2019t Sleep\u2026! quest 627 Gave the Shock Candy to Tarar, completing the Can\u2019t Sleep\u2026! quest 628 Talked to Maki for the first time after completing the Confidential quest 629 Got introduced to RUIGEE by Eetl for the first time 630 Reached a balance of 500 or above at the Bugaria Bank for the first time 631 Got the Dry Bread at Rubber Prison 632 Got the Dark Cherries at the map located south of the Wasp Kingdom Hive entrance at Far Grasslands 633 Got the Dark Cherries in a dig spot at the map located east from the Explorers Associations 634 Took the My Mecha Claw! quest 635 Talked to Engira for the first time after taking the My Mecha Claw! quest 636 Completed the Mecha Claw! quest 637 Took the They Took Her\u2026! quest 638 Talked to Bumble after taking the They Took Her\u2026! quest at Metal Island 639 Talked to Bumble after taking the They Took Her\u2026! quest at the Far Grasslands entrance 640 Completed the They Took Her\u2026! quest 641 Got the Cold Salad at Ancient Castle 642 Got the Dark Cherries at the Explorers' Association area 643 Talked to Jayde for the first time in post game at the Wasp Kingdom Hive 644 Talked to Queen Vanessa II for the first time in post game at the Wasp Kingdom Hive 645 Examined the spot where The Beast was beaten for the first time in post game (when the cutscene starts) 646 Talked to the Spy Cards tournament organizer for the first time at Metal Island 647 Won the Spy Cards tournament for the first time, set when all cutscenes are done 648 Won the Spy Cards tournament for the first time, set when the final match is won 649 Gave a berry to the homeless person at Termite Capitol 650 Talked to Neolith after the start of Chapter 5 651 Got the mushroom in the first room of Snakemouth Den 652 It is now possible to quick travel to Snakemouth Den from the mines 653 Got the Dark Cherries in a dig spot at the Mystery Island 654 Examined the steering wheel statue at the Outskirt Piers 655 Examined the view of the Colosseum for the first time at Termite Capitol 656 MOREFARM code active 657 Chapter 5, exited the west room with the Wasp Key at the Wasp Kingdom 658 Bought all the songs from Samira 659 Chapter 6, incorrectly placed the books on the bookshelf for the first time in the library room at Rubber Prison 660 Chapter 3, after the cutscene of Vi telling to get ready before entering the Honey Factory at its entrance 661 UNKNOWN used in event 215 662 Talked to the cricket at Golden Hills for the first time 663 Chapter 2, came back to the entrance of Golden Hills after getting the Big Crank 664 Chapter 7, approached the oven for the first time at Giant\u2019s Lair (as soon as the cutscene starts, set to false after beating the Everlasting King)~Chapter 7, also used when arrived at Ant Kingdom City after beating Everlasting King 665 Chapter 7, destroyed breakable rocks above the wind blower in the oven room at Giant\u2019s Lair 666 Chapter 7, turned the dial on the right stove at Giant\u2019s Lair 667 Chapter 7, turned the right dial on the left stove at Giant\u2019s Lair 668 Chapter 7, turned the left dial on the left stove at Giant\u2019s Lair 669 Got the Tangy Berry in a dig spot at the map located west from Bugaria Outskirt Pier 670 Chapter 7, turned all the dials in the oven room at Giant\u2019s Lair (after all the cutscenes) 671 Completed all quests 672 Talked to Venus in post game for the first time at Golden Hills 673 Completed the Cave of Trials for the first time 674 Dug Cerise out of the dig spot in her cell at Bandit Hideout 675 Went to the pink spider map by talking to the termite at Termite Capitol for the first time 676 Talked to Patton about his services for the first time at the Forsaken Lands 677 Got the Squash on the map located west of the Forsaken Lands entrance by cutting a bush located on the leftmost part of the map 678 Got the Squash on the map located west of the Forsaken Lands entrance by cutting the bush near the dead tree 679 Took the mistake in the tent at the map with the Explorer Association 680 Talked to the termite working in the security room for the first time at Rubber Prison 681 MYSTERY? code active 682 Talked to Cerise for the first time at Bandit Hideout 683 Got the Spicy Berry at the entrance of Snakemouth Den at the Bugaria Outskirts 684 Talked to Tanjerin &amp; Cerise when they are together at Golden Settlement 685 Got 30+ points at Whack-A-Worm at the Whacka Farms for the first time 686 Got the Burly Tea in Madeleine\u2019s house to the right of the Explorers' Association 687 Talked to Queen Elizant II for the first time in post game at the throne room of the Ant Palace 688 Got the Berry Juice on the roof of Morthy\u2019s stand at Defiant Root 689 Hit the tree at the Chomper Caves 690 Hit the tree leading west at the map directly north of Golden Settlement at Lost Sands 691 New game started 692 Got the trophy at the house for B.O.S.S. Mini Boss rush mode 693 Got the trophy at the house for B.O.S.S. Boss rush mode EX 694 File is a 1.1.x save 695 Talked to the food blogger for the first time at Metal Island 696 MYSTERY? started on 1.1.x 697 Talked to the secret tunnel ant for the first time 698 Talked to the Ant Guard that offers an escort to Lost Sands at Defiant Root 699 After getting Kabbu's overworld dash at Defiant Root 700 Took the Loose ends quest 701 Talked to Rebecca after taking the Loose Ends quest at the Ant Palace 702 Took the A New Hope quest 703 Talked to Roy after taking the A New Hope quest at Wasp Kingdom Hive 704 Won aginst the Dead Landers trio after taking the A New Hope quest (after the fade in when his plants are planted) 705 Took the Getting Bored quest 706 Talked to Team Slacker for the first time after taking the Getting Bored quest at the Underground Bar 707 Completed the Getting Bored quest 708 Set to true when the rightmost pillar becomes active in the pressure plates room at the Ancient Castle (this is an earlier implementation of the 1.1.x puzzle changes) 709 Completed the Loose Ends quest (when the prompt to come back to the Ant Kingdom appears) 710 Defeated Stratos and Delilah 711 Completed the Cave of Trials on Random Mode for the first time 712 Defeated TANGYBUG for the first time 713 Obtained the Agaric Shroom at the map located west of the Lost Sands entrance from the Bugaria Outskirt side 714 Obtained the Burly Berry on the first map in the way of the Devourer (note: this Burly berry is located behind branches out of bounds)) 715 UNUSED 716 UNUSED 717 UNUSED 718 UNUSED 719 UNUSED 720 UNUSED 721 UNUSED 722 UNUSED 723 UNUSED 724 UNUSED 725 UNUSED 726 UNUSED 727 UNUSED 728 UNUSED 729 UNUSED 730 UNUSED 731 UNUSED 732 UNUSED 733 UNUSED 734 UNUSED 735 UNUSED 736 UNUSED 737 UNUSED 738 UNUSED 739 UNUSED 740 UNUSED 741 UNUSED 742 UNUSED 743 UNUSED 744 UNUSED 745 UNUSED 746 UNUSED 747 UNUSED 748 UNUSED 749 UNUSED"},{"location":"Flags%20arrays/flagstring/","title":"Flagstring","text":"<p>A <code>flagstring</code> is a string which is a global variable the game can access for any purpose. They are saved on the Save File and typically have one reserved use, but some can be used temporarily notably in SetText operations. There are 15 flagstrings available to the game in the <code>MainManager.instance.flagstring</code> array.</p>"},{"location":"Flags%20arrays/flagstring/#notes-about-the-flagstrings-table","title":"Notes about the flagstrings table","text":"<p>A flagstring with the mention \"TEMP\" means its value in the save is meaningless since it is only used for temporary usage by the game.</p>"},{"location":"Flags%20arrays/flagstring/#flagstrings-table","title":"Flagstrings table","text":"ID Description 0 TEMP 1 TEMP 2 TEMP Only used for letter prompts 3 TEMP Only used for the prompt after each battle using the B.O.S.S system 4 TEMP Only used when getting a medal from H.B using the B.O.S.S system 5 UNUSED 6 UNUSED (had a use in 1.0.x inside dead code about the Ant Compass last dug spot) 7 TEMP Holds a comma separated list of the card ID (refer to Appendix J) corresponding to the current deck being built 8 Holds some informmation about the items, key items and berries in possession before the bandit ambush in Chapter 4. The format is the following: comma separated list of the items ID (refer to Appendix C) followed by a \"-\", followed by the same list for key items, followed by a \"-\" followed by the berry count. This is only used when recalling the list once the locked chest at the Bandits Hideout is opened 9 Chompy's name 10 Filename 11 TEMP Holds a comma separated list of the taken quest ID when the command Activateselectedquest is passed to SetText 12 Holds a comma separated list of the card ID (refer to Appendix J) corresponding to the saved deck for Spy Cards 13 Holds a comma separated list of the ordered medals ID (refer to Appendix A) in MYSTERY?, empty if the code is not active 14 UNUSED"},{"location":"Flags%20arrays/flagvar/","title":"Flagvar","text":"<p>A <code>flagvar</code> is an int which is a global variable the game can access for any purpose. They are saved on the Save File and typically have one reserved use, but some can be used temporarily notably in SetText operations. There are 70 flagvars available to the game in the <code>MainManager.instance.flagvar</code> array.</p> <p>Before 1.1.0, there were 65 slots instead</p>"},{"location":"Flags%20arrays/flagvar/#notes-about-the-flagvars-table","title":"Notes about the flagvars table","text":"<p>If a flagvar mentions \"Prize medal\", it means that the flagvar corresponds to the state of a medal given by Artis with Hard Mode on or bought in the medal shop without Hard Mode (not to be confused with the regular medal shops in the game). The possible values of a prize medal flagvar are as follows:</p> Value Description 0 not available 1 available from Artis 2 available from the caravan 3 obtained <p>A flagvar with the mention \"TEMP\" means its value in the save is only used for temporary usage by the game.</p>"},{"location":"Flags%20arrays/flagvar/#flagvars-table","title":"Flagvars table","text":"ID Description 0 TEMP 1 TEMP 2 TEMP 3 Allows fast cooking if its value is 5353, 0 otherwise 4 TEMP 5 TEMP 6 TEMP 7 UNUSED 8 UNUSED 9 TEMP number of battles left at the current attempt of boss rush on the B.O.S.S system 10 TEMP 11 TEMP 12 Number of big switches hit at Snakemouth Den (the ones that unlockes the large door) 13 Prize medal: Quick Flea 14 Amount of Crysal berries in possession 15 Number of Lore Book on the library shelf 16 Number of times Diana has been paid to build a tunnel 17 Prize medal: Weak Stomach 18 Prize medal: Spiky Bod 19 Prize medal: Break 20 Prize medal: TP Plus 21 Prize medal: Life Stealer 22 Number of charms left 23 Marks the state of the I Wanna Get Better! quest, 0 - no progress, 1 - cooked the Yam Bread, 2 - cooked the Succulent Platter, 3 - cooked the Abomination, 4 - Won the battle against the Abomihoney 24 Number of Factory Pass used on the door to the pump roomm at the Honey Factory 25 Prize Empower 26 Berry bank balance 27 Token count 28 Mite Knight high score 29 Flower Journey high score 30 Prize medal: Berry Finder 31 Prize medal: Block Heal 32 Whack-A-Worm high score 33 Prize medal: Hard Charge 34 Prize medal: Enfeeble 35 Number of crystal turned in to Doppel by completing a bounty 36 Prize medal: Reverse Toxin 37 TEMP? (used on DoClock and event 154) 38 Number of completed Cave of Trials run 39 Current streak count of completed Cave of Trials run 40 Number of battles fought 41 Highest damage in one turn 42 Number of battles fled from 43 Number of attempted Cave of Trials run 44 Prize medal: Resist All 45 Prize medal: Deep Taunt 46 Prize medal: TP Core 47 Number of quests completed (excluding the main story ones) 48 Prize medal: Heavy Throw 49 UNUSED 50 Last generated price for a Longleg Summoner (0 if the last price generated was bought OR there was no price generated yet) 51 Prize medal: Random Start 52 Prize medal: Reflection 53 Number of rewards obtained from Librem by turning in discoveries 54 Last amount of discoveries turned in to Librem 55 Number of prize medals available or obtained 56 Item ID (refer to Appendix C) of the ribbon that Chompy has on (0 if no ribbon) 57 Prize medal: HP Plus 58 UNUSED 59 UNUSED 60 UNUSED 61 Prize medal: Antlion Jaws 62 Number of items bought from the leftmost Metal Island merchant 63 Prize medal: Miracle Matter 64 Prize medal: Triumph Buzz 65 UNUSED 66 Amount of medals bought at Shades's medals shop 67 Seed used in MYSTERY?, 0 if not using MYSTERY? 68 UNUSED 69 UNUSED"},{"location":"ItemList/ItemList%20State%20Machine/","title":"ItemList State Machine","text":"<p>There are several static public fields of MainManager that represents the state of an ItemList. All of them can be accessed externally, but extra care must be given in doing so since it can lead to undefined behaviors. The fields are generally kept around between ShowItemList calls to preserve them between updates and only changed before doing a refresh.</p> <p>To denote that we are currently in an ItemList, <code>ItemList</code> gets assigned when the list gets active and it gets set to null when inactive. Additionally, the instance field <code>inlist</code> is set to true on the list creation and it is supposed to be set to false when it's handled, but due to the inlist issue, this is only guaranteed after a Pickitem command is fully done. This is different than <code>prompt</code> which tells if we are in a Prompt, NumberPrompt or LetterPrompt and it is managed differently.</p> <p>All fields are static to MainManager unless specified otherwise.</p>"},{"location":"ItemList/ItemList%20State%20Machine/#parameters-of-showitemlist","title":"Parameters of ShowItemList","text":"<p>These are sent to the method and they are kept in these fields so that the method will be called the same way during refreshes:</p> <ul> <li>listtype: The original <code>type</code> parameter. It does not take into consideration overrides. Each type specify different methods for generation <code>listvar</code>, the SetText input string used for each options and how its <code>listdescbox</code> is rendered.</li> <li><code>listpos</code>: The original <code>position</code> parameter.</li> <li><code>listdesc</code>: The original <code>showdescription</code> parameter.</li> <li><code>listsell</code>: The original <code>sell</code> parameter.</li> </ul>"},{"location":"ItemList/ItemList%20State%20Machine/#configuration","title":"Configuration","text":"<p>These are not sent to ShowItemList, but should be set externally before to configure aspects of the list prompt:</p> <ul> <li><code>listredirect</code>: The Dialogue line id when a confirmation is done (see Pickitem for more info)</li> <li><code>listcancel</code>: The Dialogue line id to redirect when a cancellation is done (see Pickitem for more info)</li> <li><code>storeid</code>: The store id if it's one.</li> <li>instance.<code>listammount</code>: The amount of items shown at once.</li> </ul>"},{"location":"ItemList/ItemList%20State%20Machine/#save-and-restore","title":"Save and restore","text":"<p>The list prompt system has the ability to save the browsing information on an ItemList after confirmation (but not cancellation) and to restore them the next time a new ItemList is requested via ShowItemList:</p> <ul> <li><code>savelastlist</code>: Tell whether or not to save the browsing info upon confirmation to <code>overridedlist</code>. Has to be set externally and gets cleared once the list has been saved.</li> <li><code>overridedlist</code>: The browsing info of the last saved list by <code>savelastlist</code>. Gets cleared on restore to the next new list call. It contains <code>option</code>, <code>listcursor</code>, <code>listlow</code>, <code>listmax</code> and <code>listoption</code>.</li> </ul> <p>This is only used in CardGame under normal gameplay.</p>"},{"location":"ItemList/ItemList%20State%20Machine/#options-management","title":"Options management","text":"<p>These are used to track a list prompt's options and selections:</p> <ul> <li><code>multiselect</code>: The list of selected items in the ItemList</li> <li><code>listcanceled</code>: Whether the ItemList has been cancelled or not</li> <li><code>listvar</code>: All the available options, depends on listtype</li> <li>instance.<code>maxoptions</code>: The number of available options in the entire list (same use as in a Prompt, NumberPrompt or LetterPrompt).</li> <li>instance.<code>option</code>: The option index in the entire list (same use as in a Prompt, NumberPrompt or LetterPrompt).</li> <li><code>listoption</code>: The same then option, but only after the ItemList destruction (which is done after a selection has been done).</li> </ul>"},{"location":"ItemList/ItemList%20State%20Machine/#scrolling-and-view","title":"Scrolling and view","text":"<p>These are used to maintain a separation between what the entire list is and what its visible part is located at:</p> <ul> <li><code>listlow</code>: Lower boundary of the visible part of the ItemList (this is visually the topmost item visible)</li> <li><code>listmax</code>: Upper boundary of the visible part of the ItemList (this is visually the bottomost item visible)</li> <li><code>listy</code>: The <code>listlow</code> or -1. This is how the game detects that an ItemList isn't fully scrolled by putting the value to -1 and then to <code>listlow</code> after fully scrolling it</li> <li><code>listcursor</code>: The option index of the currently visible part only (from 0 to <code>listammount</code> - 1)</li> </ul>"},{"location":"ItemList/ItemList%20State%20Machine/#user-interface","title":"User interface","text":"<p>These are the actual objects that contains all the UI for the ItemList:</p> <ul> <li>ItemList: The transform of the current ItemList, also tells if an ItemList is active if it's not null</li> <li><code>listdescbox</code>: The transform of the description box</li> </ul>"},{"location":"ItemList/ItemList/","title":"ItemList","text":"<p>Bug Fables has a way to present different kinds of lists that can be browsed with scrolling and prompt one selection, multiple incontiguous selection or cancellation from the options in the list. Such a list is called an ItemList and the current one can be accessed with the <code>ItemList</code> field (it is null when no ItemList is active). This is not to be confused with Prompt, NumberPrompt or LetterPrompt which are only usable in Dialogue mode in SetText while an ItemList can be used outside of SetText  via ShowItemList. Prompts also does not support scrolling as well as having other limitations in regards to rendering.</p> <p>The ItemList has the ability to have a description box rendered for the currently hovered item and to have special behaviors in the pause menu since the same method is used there, just presented differently. This is all maintained through the ItemList State Machine that MainManager is responsible to manage via mostly static fields.</p> <p>To show one, ShowItemList must be called or use its SetText command counterpart, Pickitem. The first call resets the state machine and renders the ItemList for the first time. From this point, MainManager's Update takes over (or PauseMenu's when paused) which has special routines to handle the ItemList after it is done being processed. Whenever the cursor moves or a change of selection with <code>multiselect</code> is performed, the ItemList is refreshed which causes another call to ShowItemList, but this time, it will only update the state machine rather than clear it and rerender the ItemList if it needs to be scrolled. This continues until a confirmation or a cancellation is processed which is handled differently depending on the listtype. If the ItemList came from a Pickitem command, SetText will do the final handling of it.</p>"},{"location":"ItemList/ItemList/#performance-concerns","title":"Performance concerns","text":"<p>There are known problems with this implementation regarding performance.</p> <p>The first one is no matter the conditions in which ShowItemList is called (ItemList creation or refresh), it will always regenerate the backend list of options available called <code>listvar</code> which is an array generation. While not too expensive by itself, it gets problematic due to the frequency it happens since it happens every time the user moves, scrolls or change the selection.</p> <p>The second and potentially more concerning one is the method will destroy and rerender the entire visible part of the ItemList every time it is scrolled. This can quickly get expensive because it means having to do a couple of SetText calls and also dealing with the constant deallocation/allocation of objects used to render such as sprites.</p> <p>These issues are known to cause noticeable lag on console such as the  Switch, but also on PC with low end hardware.</p>"},{"location":"ItemList/ItemList/#implementation-limitations","title":"Implementation limitations","text":"<p>Since this is using a state machine where most of its fields are globally accessible, it is not possible to have multiple ItemLists at once. If attempted, this will result in undefined behaviors.</p>"},{"location":"ItemList/ItemList/#known-issues","title":"Known issues","text":"<p>Additionally, there has been reported issues in the past due to the sensitivity of this state machine. Since most fields are globally accessible and carried over between ShowItemList calls, it can lead to a situation where fields are carried over between different ItemLists which can lead to undefined behaviors. One such case that affects this system globally is the inlist issue.</p>"},{"location":"ItemList/ShowItemList%20Life%20Cycle/","title":"ShowItemList Life Cycle","text":"<p>See ItemList State Machine to learn about the fields mentioned.</p>"},{"location":"ItemList/ShowItemList%20Life%20Cycle/#setup","title":"Setup","text":"<ul> <li>Sets <code>listy</code> to -1 and <code>multiselect</code> to a new list if we are creating a new ItemList.</li> <li>Sets <code>listpos</code> to <code>position</code>.</li> <li>Sets <code>listcanceled</code> to false.</li> </ul>"},{"location":"ItemList/ShowItemList%20Life%20Cycle/#listvar-generation","title":"<code>listvar</code> generation","text":"<p>Check the individual listtype to learn more.</p>"},{"location":"ItemList/ShowItemList%20Life%20Cycle/#rerendering-after-scroll","title":"Rerendering after scroll","text":"<ul> <li>if <code>listlow</code> isn't <code>listy</code> (meaning the list needs to be scrolled or it's a new ItemList) or listtype is the language selection list: <ul> <li>Rerendering after scroll</li> </ul> </li> </ul>"},{"location":"ItemList/ShowItemList%20Life%20Cycle/#listdescbox-rendering","title":"<code>listdescbox</code> rendering","text":"<ul> <li>if <code>showdescription</code> and <code>listvar</code> isn't empty.<ul> <li>Destroys the existing <code>listdescbox</code> if it isn't null.</li> <li>Description box rendering</li> </ul> </li> <li>Sets the ItemList's localEulerAngle to Vector3.zero.</li> </ul>"},{"location":"ItemList/ShowItemList/","title":"ShowItemList","text":"<p>A static method in MainManager. This method aims to display an ItemList or refresh an existing one.</p>"},{"location":"ItemList/ShowItemList/#signature","title":"Signature","text":"<pre><code>public static void ShowItemList(int type, Vector2 position, bool showdescription, bool sell)\n</code></pre>"},{"location":"ItemList/ShowItemList/#parameters","title":"Parameters","text":""},{"location":"ItemList/ShowItemList/#type","title":"<code>type</code>","text":"<p>The type of ItemList to display. For more details, see listtype.</p>"},{"location":"ItemList/ShowItemList/#position","title":"<code>position</code>","text":"<p>The position to render the ItemList relative to GUICamera.</p>"},{"location":"ItemList/ShowItemList/#showdescription","title":"<code>showdescription</code>","text":"<p>Whether to show the <code>listdescbox</code> of the selected option.</p>"},{"location":"ItemList/ShowItemList/#sell","title":"<code>sell</code>","text":"<p>Whether to define the ItemList as an item sell list. This influences the ability to multi select and the description rendering which will have a line detailing the selling price of the item hovered on when <code>showdescription</code> is true.</p>"},{"location":"ItemList/ShowItemList/#remarks","title":"Remarks","text":"<p>This can also be called via the Pickitem SetText command.</p> <p>For more information about how ItemLists work, check these documents:</p> <ul> <li>ItemList</li> <li>ShowItemList Life Cycle</li> </ul>"},{"location":"ItemList/inlist%20issue/","title":"<code>inlist</code> issue","text":"<p>The ItemList system has a complex issue with <code>inlist</code> as it is not always properly cleared after an ItemList is processed which can lead to issues when using the Pickitem command from SetText. This issue has, as of 1.1.2, 2 known reproduction under normal gameplay, but there used to have 3 known reproduction as the first known one was patched in 1.1.0. It is however affecting SetText and ItemList as a whole and its complexity is worth to be thoroughly explained.</p>"},{"location":"ItemList/inlist%20issue/#the-intent-of-inlist","title":"The intent of <code>inlist</code>","text":"<p><code>inlist</code> is used alongside ItemList to determine if an ItemList is currently being processed, but <code>inlist</code> is a boolean intended to be true as long as the ItemList is being processed while ItemList is the game object of the current ItemList which is intended to tell if a list is active. This is an important distinction because a Pickitem command relies on <code>inlist</code> staying true after ItemList goes to null to know that an ItemList has been confirmed or cancelled. When this happens, the ItemList gets destroyed, but the handling of the choice has yet to the handled by SetText.</p> <p>In other words, <code>inlist</code> should remain true as long as an ItemList is being processed and go to false once it has been processed even if the actual ItemList might no longer be active.</p>"},{"location":"ItemList/inlist%20issue/#the-issue-with-inlist","title":"The issue with <code>inlist</code>","text":"<p>The problem lies with <code>inlist</code> not having a guarantee to be set to false once processing is completed. While most situations such as any Pickitem command offers this guarantee, the same cannot be said for direct calls to ShowItemList and the situations that do offer such guarantees are done because a workaround was applied by having the caller set it to false. The only guarantee offered by <code>inlist</code> is that it will be set to false once done at the end of a Pickitem command.</p> <p>This creates an issue where the following occurs in order:</p> <ul> <li>ShowItemList is called directly which will set <code>inlist</code> to true</li> <li>The ItemList is done processing, but <code>inlist</code> remains true</li> <li>Any SetText calls in Dialogue mode occurs whose input string starts with anything except Pickitem</li> <li>The first char loop iteration gets done and now we are in SetText Life Cycle &gt; Dialogue post-processing while ItemList is null and <code>inlist</code> is true which is treated as if an ItemList is ready to be handled while no such ItemList happened during the course of this SetText call</li> <li>If <code>listredirect</code> was set from a previous Pickitem command, SetText will redirect to it which leads to undefined behaviors depending on what value it had before</li> </ul>"},{"location":"ItemList/inlist%20issue/#mitigations-in-place","title":"Mitigations in place","text":"<p>While this is a global issue affecting the interactions between both systems, there are some mitigations put in place that workarounds the issue in most situations.</p> <p>The first one is setting <code>inlist</code> to false at specific points such as when pausing or doing any actions in battle that isn't an item usage. There is also a workaround applied in the case an abomination is used leading to a game over where <code>listredirect</code> is set to -1 before the SetText call is done. This workaround was applied in 1.1.0.</p>"},{"location":"ItemList/inlist%20issue/#known-reproductions","title":"Known reproductions","text":"<p>Despite all those measures, there are 2 known cases to reproduce this issue:</p> <ol> <li>Have all turns in battle be item usage and use Chompy's change ribbon's function. This one is special as it is possible to reproduce the issue completely inside a battle because Chompy's change ribbons uses a Pickitem with the Chompy Ribbons List Type.</li> <li>Have all turns in battle be item usage until an EventDialogue is triggered with a SetText call in Dialogue mode. If the trigger requires to damage the enemy, all damages must be from items uses.</li> </ol>"},{"location":"ItemList/inlist%20issue/#possible-fixes","title":"Possible fixes","text":"<p>While it is possible to apply workarounds as reproductions are found by the caller or after the ItemList is fully handled, it is possible to permanently fix this issue.</p> <p>The first way would be to guarantee that <code>inlist</code> is set to false during the SetText Life Cycle &gt; Dialogue setup of SetText. This can work because it is not possible to make use of the value until a Pickitem is processed in which case, it is dangerous to leave it dangling at a false value. While it would still leave the value dangling in the end, any potential problems will be negated immediately by the next SetText call in Dialogue mode.</p> <p>The second way would be to clear <code>listredirect</code> right after a redirection is performed if any. This wouldn't entirely fix the problem, but it will neuter the potential problems to a safer level.</p>"},{"location":"ItemList/listtype/","title":"listtype","text":"<p>There are 34 types of ItemList available. Each type mainly dictates how <code>listvar</code> is generated, how its SetText input string for each options is generated (but also additional rendering on their bar sprite is done) and how its <code>listdescbox</code> is rendered. Some can have specific behaviors external to ShowItemList.</p> <p>The handling of the ItemList is usually done by MainManager's Update unless in the pause menu (which includes the settings window called from StartMenu and the change loadout option on game over). In these cases, the handling is done by PauseMenu instead.</p> <p>Sending any other value than the ones mentioned will lead to undefined behaviors.</p> Value Description -3 Third party member Skills List Type -2 Second party member Skills List Type -1 First party member Skills List Type 0 Standard Items List Type 1 Key Items List Type 2 Storage Items List Type 3 Medals List Type 9 Battle Strategy List Type 10 The ordered discoveries Library List Type 11 The ordered bestiary Library List Type 12 The ordered recipes Library List Type 13 The ordered records Library List Type 14 The open Quest Board List Type 15 The taken Quest Board List Type 16 The completed Quest Board List Type 17 The Settings List Type 18 The Samira Songs List Type 19 The Key Bindings List Type 20 The Languages list Type 21 The Overall Quests List Type 22 The Lore Book List Type 23 The Stat Bonuses List Type 24 The B.O.S.S Battles List Type 25 UNUSED (<code>listvar</code> is set to <code>multilist</code>) 26 The Termacade Prizes List Type 27 All items Enum List Type 28 All medals Enum List Type 29 All skills Enum List Type 30 UNUSED (the Controller Bindings List Type) 31 All maps Enum List Type 32 The Equipped Medals List Type 33 The Spy Cards List Type 34 The Caravan Prize Medals List Type 35 The Chompy Ribbons List Type"},{"location":"ItemList/List%20Types%20Group%20Details/B.O.S.S%20Battles%20List%20Type/","title":"B.O.S.S Battles list type","text":"<p>Display the list of available mini bosses or bosses to battle using the B.O.S.S system.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/B.O.S.S%20Battles%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is the return of the GetBosses method which expects <code>multilist</code> to be filled beforehand with enemy ids (-1 for Zasp and Mothiva fight). How this works is for everything that isn't -1, it is added to <code>listvar</code> if it the corresponding enemy has been seen at least once. If it is -1, it will only add it if flags 118 is true.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/B.O.S.S%20Battles%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text is the enemy name from <code>enemynames</code> of the option unless it is one of the following where it will pick a line from the current map dialogue:</p> <ul> <li>-1: line 13 (Zasp and Mothiva)</li> <li>51: line 74 (Kali and Kabbu)</li> <li>85: line 75 (Cenn and Pisci)</li> <li>92: line 76 (Team Maki)</li> <li>74: line 77 (Cross and Poi)</li> </ul> <p>After the text is determined, flagvar 6 is set to <code>option</code>.</p> <p>The x position of the text is overridden to -2.65.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/B.O.S.S%20Battles%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is empty. It should be noted that under normal gameplay, this list type is not called with <code>showdescription</code> set to true.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/B.O.S.S%20Battles%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>Confirmation is handled by MainManager's Update. First, the flagvar of the <code>storeid</code> is set to the selected option (bug?). Then, the ItemList gets destroyed which ends its processing and resets the ItemList State Machine.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Battle%20Strategy%20List%20Type/","title":"Battle Strategy list type","text":"<p>Display the battle strategy options during battle.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Battle%20Strategy%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> will be the following: { 0, 271, 1, 2, 3 }. These are used as offset to gather the different MenuText line id when rendering the options.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Battle%20Strategy%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The main text corresponds to a certain line from MenuText depending on the options (it is 65 + the option with the exception of anything larger than 3 which is the line id itself):</p> <ul> <li>Id 66 (Rotate Party)</li> <li>Id 271 (Swap Positions)</li> <li>Id 67 (Spy)</li> <li>Id 65 (Do Nothing)</li> <li>Id 68 (Flee)</li> </ul> <p>If the option is Spy while it is disabled or Flee while it isn't possible, the text is prepended with |color,1| and that will be the final string.</p> <p>Otherwise, if the option is Rotate Party,  + |size,0.55,0.6||button,6| is appended to the MenuText line and this is the final string.</p> <p>Otherwise, if the option is Do Nothing, |single| is prepended to the main text and  + |size,0.55,0.6| is appended to it. There are also Icon commands that can be appended if a certain medal is equipped which will be appended in this order if that is the case:</p> <ul> <li>Prayer, |Icon,187|</li> <li>Meditation, |Icon,188|</li> <li>Reflection, |Icon,189|</li> </ul> <p>Otherwise, if the option is Flee, |single| is prepended to the main text and  + |size,0.55,0.6| is appended to it. There are also Icon commands that can be appended if a certain medal is equipped which will be appended in this order if that is the case:</p> <ul> <li>Secure Pouch, |Icon,221|</li> <li>Quick Flea, |Icon,222|</li> </ul> <p>Otherwise, if the option is Spy and Spy Specs is equipped, |single| is prepended to the main text and  + |size,0.55,0.6||Icon,219| is appended to it. </p> <p>The x position of the main text is overridden to -2.6.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Battle%20Strategy%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is a certain line from MenuText depending on the options (it is 69 + the option with the exception of anything larger than 3 which is the line id itself):</p> <ul> <li>Id 70 (Rotate Party description)</li> <li>Id 272 (Swap Positions description)</li> <li>Id 71 (Spy description)</li> <li>Id 69 (Do Nothing description)</li> <li>Id 72 (Flee description)</li> </ul>"},{"location":"ItemList/List%20Types%20Group%20Details/Battle%20Strategy%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>The confirmation handling only applies when in battle in MainManager's Update which is the only circumstances this list type can be called under normal gameplay. If we weren't in battle, the Items List Type's confirmation handling logic will be used instead which will cause an exception to be thrown.</p> <p>In that handler, it checks if the option is available to be used and if it is, it calls BattleControl's SetItem on the current battle with the option selected. Otherwise, the buzzer sound plays. The specific logic on what to do with a valid option is entirely within SetItem.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Caravan%20Prize%20Medals%20List%20Type/","title":"Caravan prize medals list type","text":"<p>Display the list of available prize medals to purchase from the Caravan shop.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Caravan%20Prize%20Medals%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> will be set to caravanorder which contains all the medals ids that the caravan has available from the prize medals pool.</p> <p><code>showdescription</code> is overridden to false if flags 681 is true (MYSTERY? is active) or to true if that flags is false.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Caravan%20Prize%20Medals%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>If the option is -1 or lower, the text won't be changed and nothing will happen in this phase.</p> <p>Otherwise, the text is the medal's name from badgedata or MenuText line 59 (?????) if flags 681 is true (MYSTERY? is active). Additionally a sprite of the medal (or a ? in a grey hexagon if MYSTERY? is active) will be rendered on the leftmost portion of the bar with a localScale of (0.55, 0.6, 1.0). Finally, the y position of the text is overridden to -0.2.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Caravan%20Prize%20Medals%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is the medal's description obtained from badgedata using the id of the medal the player has located at the index of the option. If this is a <code>sell</code> list, the secondary string is the medal's name obtained in a similar manner.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Chompy%20Ribbons%20List%20Type/","title":"Chompy Ribbons list type","text":"<p>Display a list of items from <code>multilist</code>. This is intended to show the Chompy Ribbons available.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Chompy%20Ribbons%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> will set to <code>multilist</code> which is implied to have been set after the list's creation before a refresh.</p> <p>They type is overridden to the standard Items List Type.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Chompy%20Ribbons%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The behavior is the same then the overridden standard Items List Type.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Chompy%20Ribbons%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>The behavior is the same then the overridden standard Items List Type.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Chompy%20Ribbons%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>Confirmation is handled by MainManager's Update. First, the flagvar of the <code>storeid</code> is set to the selected option (bug?). Then, the list gets destroyed which ends this list's processing and resets the ItemList State Machine.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Chompy%20Ribbons%20List%20Type/#remarks","title":"Remarks","text":"<p>While the overridden type is the standard Items List Type, it is able to display any kind of items including key items. In fact, under normal gameplay, this is used to display only key items being the ribbons Chompy has available. The entire management after confirmation is done by BattleControl's Chompy coroutine.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Controller%20Bindings%20List%20Type/","title":"Controller Bindings list type","text":"<p>Display the list of inputs of the game and their bound controller inputs. This is an unfinished version of an older implementation of the controller input rebinder that ended up unused and inaccessible under normal gameplay.</p> <p>While there are several functionality left in the game in regards to rendering, a lot of it is incomplete and doesn't work properly even when forcing the ItemList to render. It was primarily intended as an older version of the controller input rebinder which used this list type to offer a way to rebind controller inputs. </p> <p>In 1.0.5, this list type was technically working, but it required the Use Controller settings from the Settings List Type to be set to CUSTOM BINDINGS which was prevented by the input handling of PauseMenu. 1.1.0 replaced the window intended for this list type entirely by the new input rebinder which does not involve any list type and just UI code that acts like a wizard in PauseMenu.</p> <p>Since the implementation is unfinished, its documentation is too spurious to define and it is recommended to view it as not working even outside of normal gameplay.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Enum%20List%20Type/","title":"Enum list type","text":"<p>Display a list of enums values for a given type, but render as if it was the corresponding list type.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Enum%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is all the integers from 0 to the amount of enum values for the corresponding type - 1.</p> <p>Additionally, the list type is overridden to be the one that corresponds to the enum. For Items, it's standard Items List Type (but it will include all standard and key items values), for BadgeType, it's Medals List Type, for Skills, it's the first party member's Skills List Type (but it will include all skills) and for Maps, it's its own list type.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Enum%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>If the list type has not been overridden, this is assumed to be the Maps enum list type in which case, the text is the textual representation of the enum value and the x position of the text is overridden to -2.65.</p> <p>Otherwise, the behavior is as described in the overridden list type document.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Enum%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>If the list type has not been overridden, this is assumed to be the Maps enum list type in which case, it uses the default rendering scheme described in Description box rendering where the text is empty.</p> <p>Otherwise, the behavior is as described in the overridden list type document.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Enum%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>Confirmation is handled by MainManager's Update. First, the flagvar of the <code>storeid</code> is set to the selected option (bug?). Then, the list gets destroyed which ends this list's processing and resets the ItemList State Machine.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Equipped%20Medals%20List%20Type/","title":"Equipped Medals list type","text":"<p>Display a list of medals from <code>multilist</code>, not to be confused with Medals List Type. This is intended to be used to display the list of equipped medals.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Equipped%20Medals%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> will set to <code>multilist</code> which is implied to have been set after the list's creation before a refresh.</p> <p>The list type is overridden to Medals List Type.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Equipped%20Medals%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The behavior is the same then the overridden Medals List Type.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Equipped%20Medals%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>The behavior is the same then the overridden Medals List Type.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Equipped%20Medals%20List%20Type/#remarks","title":"Remarks","text":"<p>Under normal gameplay, this list is only reachable via PauseMenu after pressing the show HUD input on the medals window. When pressing that input, the handler in PauseMenu's Update will be the one that sets <code>multilist</code> to the medals of the equipped bug. Then, UpdateText is called which is the one that calls the appropriate ShowItemList with this list type.</p> <p>It behaves exactly the same than Medals List Type with the only differences that it uses the medals only in <code>multilist</code> instead of all the ones the player has.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Items%20List%20Type/","title":"Items list type","text":"<p>Display the list of items, key items or storage items.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Items%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> will be the list of items in that specific item type or a single element with -1 as its value if there is no items.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Items%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>If the items id in question is -1, the string will be |color,1| followed by the no items message from MenuText line id 20.</p> <p>Otherwise, a sprite of the item matching its id will be rendered mostly on the left side of the bar. Its localScale is 0.55, 0.6, 1.0 when unpaused and 0.9, 0.9, 1.0 when paused. The string will be the item name from itemdata.</p> <p>When paused, the bar height used for calculating the y position of the down arrow is overridden to -0.9.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Items%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>Not rendered if the item id is -1.</p> <p>If it isn't, It uses the default rendering scheme described in Description box rendering where the text is the item's description obtained from itemdata using the item id. The secondary string used if <code>sell</code> is true is the item's name.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Items%20List%20Type/#confirmation-handling-when-unpaused","title":"Confirmation handling (when unpaused)","text":"<p>There are 2 possible handlers: the <code>inbattle</code> one and the regular one. The former only applies if instance.<code>inbattle</code> is true. It will call SetItem with the option selected on the <code>battle</code> followed by DestroyList being called. The entire confirmation handling is handled within SetItem in this case.</p> <p>If <code>inbattle</code> is false, the regular handler is used. First, flagvar of the <code>storeid</code> is set to the item id selected. If the item id selected is -1, the list is immediately destroyed which ends this list's processing.</p> <p>Otherwise, the flagstring 0 is set to the selected item's name from <code>itemdata</code>. If <code>listsell</code>, the behaviour depends if we were using <code>multiselect</code>:</p> <ul> <li>If we are, flagstring 0 is overridden to the MenuText line id 279 (which is \"Lot of Items\" in English), flagvar 10 is now the sum of each selected item's buying price / 2 floored clamped from 1 to 999. Flags 349 is now true</li> <li>If we aren't, flagvar 10 is the buying price of the selected item / 2 floored clamped from 1 to 999.</li> </ul> <p>At any case, the list gets destroyed afterwards which ends this list's processing.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Items%20List%20Type/#other-behaviors-when-unpaused","title":"Other behaviors (when unpaused)","text":"<p>If this is a storage items list, <code>multiselect</code> is allowed. If it is a standard items list, flags 349 has to be true to allow multi selection. Adding an item to the selection is restricted by not exceeding the current maximum amount of standard items for storage list or the maximum amount of storage items for items list (this maximum is always 35 under normal gameplay). A buzzer sound will play if adding an item to the selection would violate this restriction.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Key%20Bindings%20List%20Type/","title":"Key Bindings list type","text":"<p>Display the list of inputs of the game and their bound keyboard key.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Key%20Bindings%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is all the integers from 0 to the amount of inputs of the game - 1.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Key%20Bindings%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text is |button, followed by the option followed by <code>,0|</code> followed by MenuText line 88 + the option. In practice, it means that it will show the currently bound keyboard key of the input followed by the input description as they all fall between line 88 and 98 of MenuText.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Key%20Bindings%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is empty. It should be noted that under normal gameplay, this list type is not called with <code>showdescription</code> set to true.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Key%20Bindings%20List%20Type/#input-handling","title":"Input handling","text":"<p>The Input handling of the list is done by PauseMenu's Update instead of MainManager's.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Languages%20list%20Type/","title":"Languages list type","text":"<p>Display the list of the available languages of the game.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Languages%20list%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is the integers between 0 and 5, which represents the languageid of the game.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Languages%20list%20Type/#list-render-on-refresh","title":"List render on refresh","text":"<p>This list will always rerender whenever a refresh is done regardless if it needs to be scrolled or not. This is done to update the help text to the option being hovered on during the selection. This prompt is refreshed by doing a SetText call in non Dialogue mode where the input string is the text in languagehelp of the current option prepended with |color,4||center||sort,20|, the position is (1.0, 4.0) and the parent is the ItemList. This call is done on every refresh of the list.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Languages%20list%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text is |sort,20||color,4| followed by the name of the language of the option in languagenames.</p> <p>The size of the text is overridden to Vector2.one.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Languages%20list%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is empty. It should be noted that under normal gameplay, this list type is not called with <code>showdescription</code> set to true.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Languages%20list%20Type/#cursor-rendering","title":"Cursor rendering","text":"<p>Normally, any listtype where <code>questboardobj</code> is null and not handled by PauseMenu will have the cursor progressively go towards the current option using <code>listcursor</code> by an offset in the x position of 2.0 and 0.75 in the y position (which is around the right side of the screen). This list type is special because it changes this offset to be -2.0 on x and removes the y one. This is done because this is the only list like this where the options are positioned at the center of the screen rather than on the right.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Languages%20list%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>The confirmation will cause the languageid to be set to the selected option, a complete rewrite (or creation) of <code>config.dat</code> and SetVariables to be called which updates all the language dependent data of the game. The list is then destroyed with the ItemList State Machine being reset and finally, the Intro method on the StartMenu is called which starts the title screen.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Languages%20list%20Type/#cancellation-handling","title":"Cancellation handling","text":"<p>It it not possible to cancel in this list. Nothing will happen if it is attempted.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Library%20List%20Type/","title":"Library list type","text":"<p>Display a list of the Library content with the page being Discoveries entry, Bestiary entry, Recipes entry or Records entry.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Library%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is all the ids matching the page of the list ordered by their respective order from the game's data.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Library%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>First, the main text is set to the string representation of the option + 1 padded by 3 <code>0</code> followed by <code>-</code>.</p> <p>Then, the corresponding name of the library entry is appended to the string.</p> <p>If the language is set to <code>German</code> and the list is the Discoveries entry, |Sizemulti,0.7,1| is prepended to the string.</p> <p>If the language is set to <code>Japanese</code> and we are paused, |size,0.75,y,lock| is prepended to the string.</p> <p>Finally, |single| is prepended to the string which will serve as the final string.</p> <p>The x position of the text is overridden to -0.5 and the size to Vector2.one.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Library%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is empty. This list type does not have any behavior defined for this phase.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Lore%20Book%20List%20Type/","title":"Lore book list type","text":"<p>Display the list of the unlocked lore books.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Lore%20Book%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is all the integers from 0 to the flagvar 15 subtracted by 1. In practice, this represents the numbers from 0 to the amount of lore book unlocked - 1.</p> <p><code>listredirect</code> is overridden to -66 which, corresponds to the CommonDialogue line 65 and has the following: |tail,null||boxstyle,3||Bleep,2,1,1||Lore|.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Lore%20Book%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text is the name of the lore book obtained from LoreText. If the option is <code>option</code>, flagstring 0 is set to the text of the lore book from LoreText.</p> <p>The x position of the text is overridden to -2.65.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Lore%20Book%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is empty. It should be noted that under normal gameplay, this list type is not called with <code>showdescription</code> set to true.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Lore%20Book%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>Confirmation is handled by MainManager's Update. First, the flagvar of the <code>storeid</code> is set to the selected option (bug?). Then, the list gets destroyed which ends this list's processing and resets the ItemList State Machine.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Medals%20List%20Type/","title":"Medals list type","text":"<p>Display the list of medals currently in possession, not to be confused with Equipped Medals List Type.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Medals%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> will be all the numbers from 0 to the amount of medals in possession - 1.</p> <p>If paused, <code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Medals%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>If there is no options or the option is -1, the string will be |color,1| followed by the no medals text from MenuText line id 23. Nothing else is done once the string is assigned in this case. It should be noted that if there is indeed no options, this code will never be run because <code>maxoptions</code> will also report not having anything so this phase will not have any iterations.</p> <p>Otherwise, the input string will be |single| + <code></code> followed by the medal's name obtained from <code>badgedata</code> whose medal id is obtained from looking at the medal the player has located at the index of the option. From there a sprite of the medal is rendered on the rightmost part of the bar with different properties whether we are paused or not:</p> <ul> <li>When unpaused, localPosition is (-2.5, 0.0) and localScale is (0.55, 0.6, 1.0)</li> <li>When paused, localPosition is (-0.25, 0.0) and localScale is (0.7, 0.7, 1.0)</li> </ul> <p>Additionally, there are different additional behaviors depending if we are paused or not:</p> <ul> <li>When unpaused, the y position of the main text is overridden to -0.2.</li> <li>When paused, the position of the main text is overridden to (0.35, -0.3), the size to Vector2.one and the bar height used for calculating the y position of the down arrow is overridden to -0.9. There is also going to be a bar rendered at the background if the medal is equipped in any way. The color is FFC000 for Vi, 00B800 for Kabbu, 00AFE6 for Leif and FFAE00 for equipped to all. If the medal is equipped to a character, its character icon sprite will also be rendered towards the right of the bar.</li> </ul> <p>Finally, if this isn't a <code>sell</code> list, render the MP icon and the MP cost towards the right of the bar. The cost part is done via SetText in non Dialogue mode where the input string is |Font,0| followed by the cost obtained from badgedata clamped from 0 to 999 or from 0 to 1 if the RUIGEE flags is active.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Medals%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>Nothing is rendered if the option is -1.</p> <p>Otherwise, It uses the default rendering scheme described in Description box rendering where the text is the medal's description obtained from badgedata using the id of the medal the player has located at the index of the option. If this is a <code>sell</code> list, the secondary string is the medal's name obtained in a similar manner.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Overall%20Quests%20List%20Type/","title":"Overall BoardQuests list type","text":"<p>Display a sanitized version of the taken and completed quests. This is not to be confused with Quest Board List Type which renders all the BoardQuests of a given state.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Overall%20Quests%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is all the BoardQuests from the taken board followed by the quests from the completed board * -1 with the exception of quest 0 (No Quest).</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Overall%20Quests%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text is the name of the name of the quest corresponding to the absolute value of the option. If the language is set to <code>German</code>, |Sizemulti,0.7,1| is prepended to the string.</p> <p>If the quest is a story quest (id between 11 and 17), the icon of the corresponding quest is rendered using psprite and the index as the option on the right side of the bar. The y position is 0.2 when completed and 0.25 when taken and if it is taken, the sprite is rendered with a black color.</p> <p>Otherwise, if the quest isn't a story quest, but it is completed, a green checkmark is rendered instead of the icon.</p> <p>In all cases where a sprite is rendered, <code>\\t</code> is prepended to the string and |Tab,tabsize| is appended where tabsize is 6.0 except in <code>Japanese</code> where it is 3.0 (also multiplied by 0.85 if the sprite is the checkmark).</p> <p>If the language is set to <code>Japanese</code> and we are paused, |size,0.75,y,lock| is prepended to the string.</p> <p>Finally, |single| is prepended to the string which will serve as the final string.</p> <p>The x position of the text is overridden to -0.5 and the size to Vector2.one.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Overall%20Quests%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is empty. It should be noted that under normal gameplay, this list type is not called with <code>showdescription</code> set to true.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Overall%20Quests%20List%20Type/#input-handling","title":"Input handling","text":"<p>The Input handling of the list is done by PauseMenu's Update instead of MainManager's.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Quest%20Board%20List%20Type/","title":"BoardQuests board list type","text":"<p>Display the list of open, taken or completed BoardQuests on the quest board. This is not to be confused with Overall Quests List Type which renders a subset of all the quests in one list.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Quest%20Board%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is all the BoardQuests id contained in the boardquests depending on the board type of the list (open, taken or completed) with some restrictions that apply if the current map is not TestRoom:</p> <ul> <li>Leif's Request and Vi's Request are excluded (NOTE: Kabbu's Request should have been excluded, but its exclusion was forgotten).</li> <li>Any story request (id between 11 and 17) are excluded.</li> <li>Any of the following bounty requests are excluded if the current map isn't UndergroundBar and the board type of the list is the open quests:<ul> <li>Bounty: Seedling King</li> <li>Bounty: False Monarch</li> <li>Bounty: Devourer</li> <li>Bounty: Tidal Wyrm</li> <li>Bounty: Peacock Spider</li> </ul> </li> </ul> <p>If the end result has no quests, add quest id 0 (No Quests) as the only quest offered as option.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Quest%20Board%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text is the name of the corresponding quest from boardquestdata prepended with |size,0.5,0.8,lock| in <code>German</code> or |size,0.6,0.8,lock| in <code>Japanese</code>.</p> <p>The x position of the text is overridden to 0.0 and the size to Vector2.one.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Quest%20Board%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p><code>listdescbox</code> is rendered using a custom rendering scheme. If the quest id isn't No Quest, an image of the quest's author is rendered using <code>librarysprites</code> from the index obtained in boardquestdata which will have a name of <code>Image</code> and a tag of <code>Text</code> towards the top of the description box. Additionally SetText is called with the following in non Dialogue mode:</p> <ul> <li><code>text</code>: |size,0.75||sort,1| + The <code>By:</code> from MenuText line id 104 + <code></code> + The author of the quest obtained from boardquestdata + |line||halfline| + The <code>Difficulty:</code> from MenuText line id 105 + <code></code> + |Stars, + The amount of filled in stars of the quest obtained from boardquestdata + <code>|</code></li> <li><code>position</code>: (12, 0.35)</li> <li><code>parent</code>: <code>listdescbox</code></li> </ul> <p>Whether or not the quest was No Quest, SetText is called in non Dialogue mode with the following:</p> <ul> <li><code>text</code>: |sort,1||single| + |singlebreak,10||Sizemulti,0.8,1| on <code>German</code> or  |singlebreak,6| otherwise + the quest's description from boardquestdata before any <code>}</code> or <code>{</code></li> <li><code>fonttype</code>: <code>BubblegumSans</code></li> <li>No linebreak</li> <li>No tridimensional</li> <li><code>position</code>: (9.9, -1.75)</li> <li>No cameraoffset</li> <li><code>size</code>: (0.65, 0.75)</li> <li><code>parent</code>: <code>listdescbox</code></li> <li>No caller</li> </ul>"},{"location":"ItemList/List%20Types%20Group%20Details/Quest%20Board%20List%20Type/#input-handling","title":"Input handling","text":"<p>On top of the default input handling, this listtype overrides the handling of the left and right input to handle changing pages in the <code>questboardobj</code>.</p> <p>When pressing left or right, the PageFlip sound is played followed by a reset of the ItemList State Machine where the visible part, cursor and <code>option</code> are put back to the topmost item with <code>listy</code> set to -1. </p> <p>If left was pressed, listtype is decremented, but it will be set to 16 (completed quest board type) if it was set to open quest board type.</p> <p>If right was pressed, listtype is incremented, but it will be set to 14 (open quest board type) if it was set to completed quest board type.</p> <p>In either cases, <code>questboardobj</code> will be updated to reflect this page change and ShowItemList will be called using the new listtype, the existing <code>listpos</code> with <code>showdescription</code> to true and <code>sell</code> to false.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Quest%20Board%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>If type is the open quests board and a <code>boardcaller</code> exists, the quest must not be No Quest or a buzzer sound will be played and the confirmation rejected.</p> <p>If it is not No Quest, the <code>questboardobj</code> is closed which adds an <code>actioncooldown</code> of 20 frames, sets <code>minipause</code> to false and <code>inlist</code> to false. From there, every player entity is set to face towards the entity of the boardcaller. SetText is then called in Dialogue mode with the dialogue line id of the boardcaller (it's stored in its <code>data[1]</code> field, see the BoardQuest interaction for more details). That test gets prepended with <code>|</code>questprompt<code>|</code>. The entity of the boardcaller is the parent and its NPCControl is the caller. Flagvar 0 is set to the selected quest id and the list is finally destroyed which ends this confirmation handling.</p> <p>On the other hand, if the type isn't the open quest board and the current map is the TestRoom, the selected quest is removed from the corresponding board, the <code>questboardobj</code> is closed (which adds an <code>actioncooldown</code> of 20 frames, sets <code>minipause</code> to false and <code>inlist</code> to false) and the list is destroyed which ends this confirmation handling.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Quest%20Board%20List%20Type/#other-behaviors","title":"Other Behaviors","text":"<p>The parent of ItemList is set to the <code>questboardobj</code> instead of the GUICamera for this listtype as it is expected to not be null under normal gameplay. This means the list is rendered on the board rather than on the root of the GUI.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Samira%20Songs%20List%20Type/","title":"Samira Musics list type","text":"<p>Display the list of the currently available Musics from Samira.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Samira%20Songs%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is the list of Musics id in samiramusics which contains only the songs available for purchase or have been bought already. If there is at least one song that is available, but not purchased yet, a -1 option is added first before adding all the songs from samiramusics.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Samira%20Songs%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>If the option is -1, the text is |color,1| followed by CommonDialogue line 152 which is \"We'll buy all songs!\" in English.</p> <p>Otherwise, the entry in <code>samiramusics</code> is obtained by using the index of the option (1 is subtracted from it if -1 is in <code>listvar</code>). Then, the text becomes the name of the song in <code>musicnames</code> using the music id. This is prepended with |color,3| if the song was bought.</p> <p>The x position of the text is overridden to -2.65.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Samira%20Songs%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is empty. It should be noted that under normal gameplay, this list type is not called with <code>showdescription</code> set to true.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Samira%20Songs%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>The list gets destroyed when a confirmation occurs by MainManager's Update which ends this list's processing and resets the ItemList State Machine.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Settings%20List%20Type/","title":"Settings list type","text":"<p>Display the list of the game settings which is platform specific.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Settings%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> contains the indexes of the settingsindex array field. Here's a table that shows which settings is which in the exact order of the list options and under what conditions they are available:</p> listvar value settingsindex value Description Restrictions 0 33 Music Volume None 1 34 Sound Volume None 2 160 Dialogue Volume None 21 261 Audio (Stero/Mono) PC platforms only 19 239 Music After Battle (Resume/Restart) None 20 245 Mash Action Commands None 3 28 Resolution PC platforms only 4 29 Fullscreen PC platforms only 5 32 Downsampling* DISABLED ON ALL PLATFORMS 6 116 Anti-Aliasing PC platforms only 7 30 Shadow Quality PC platforms only 8 31 Texture Quality PC platforms only 9 147 3D Outlines None 11 156 Advanced Particles PC platforms only 10 140 Wind Effects PC platforms only 16 183 Vsync PC platforms only 12 80 Framerate PC platforms only, only when Vsync is OFF 23 255 Pause When Unfocused PC platforms only 13 157 Use Controller PC platforms only 17 222 Controller to Use PC platforms only, only if Use Controller is CHOOSE MANUALLY or PRE-CONFIGURED 22 270 Analog Sensitivity Only if Use Controller isn't DISABLED 18 231 Controller Bindings PC platforms only, only if Use Controller is CUSTOM BINDINGS 14 35 Key Bindings PC platforms only 15 36 Return to Main Menu / Exit Game None on PC platforms, only available after save load on console platforms 24 256 Reset Control. Bindings** DISABLED ON ALL PLATFORMS <p>*: Downsampling was intended to alleviate the load of the game on the hardware by scaling down the final render by a percentage before it gets to the screen. It had the options OFF, 90%, 80%, 75%, 60%, 50% and 40% available. While it is disabled in the setting, its feature is still present and is actually used on any of the Termacade screens at 80% downsampling.</p> <p>**: This setting was intended to unbind every input from the rebinder, but it was deemed redundant of simply using the keyboard to remedy binding problems as well as being known to have introduced bugs during the 1.1.0 beta.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Settings%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text string is rendered on the left side of the bar and it corresponds to the MenuText line id of the  settingindex value of the option prepended with |single|. Unless otherwise specified, all option will render 2 arrows on the left and right side of the value selection that is located towards the right side of the bar. All SetText calls done on the right side of the bar are done in non Dialogue mode where the position is (6.25, -0.15), the bar is the parent and the input string is prepended with |center||size,0.75|.   Here are the text and UI details per settings option:</p> listvar value settingsindex value Description UI rendering (right side of the bar) 0 33 Music Volume Render a bar slider by rendering 10 sprites next to each other left to right using an index from 0 to 9. If the index is lower then pausemenu.mvolume * 10.0, the sprite is a white circle, yellow hexagon otherwise 1 34 Sound Volume Render a bar slider by rendering 10 sprites next to each other left to right using an index from 0 to 9. If the index is lower then pausemenu.svolume * 10.0, the sprite is a white circle, yellow hexagon otherwise 2 160 Dialogue Volume Render a bar slider by rendering 10 sprites next to each other left to right using an index from 0 to 9. If the index is lower then pausemenu.dvolume * 10.0, the sprite is a white circle, yellow hexagon otherwise 21 261 Audio Calls SetText where the input string is MenuText line id 263 (STEREO) when monoaudio is false and 262 (MONO) when it is true 19 239 Music After Battle Calls SetText where the input string is MenuText line id 241 (RESTART) when keepmusicafterbattle is false and 240 (RESUME) when it is true 20 245 Mash Action Commands Calls SetText where the input string is MenuText line id 246 (FILL BAR) when pausemenu.mash is false and 247 (SEQUENTIAL KEYS) when it is true 3 28 Resolution Calls SetText where the input string is the floored x and y component of the vector2 among the MainManager.resolution array where the index is pausemenu.resolutionid and where both component is separated by <code>x</code> 4 29 Fullscreen Calls SetText where the input string is MenuText line id 39 (OFF) when pausemenu.fulls is false and 38 (ON) when it is true 5 32 Downsampling Calls SetText where the input string is MenuText line id 39 (OFF) when downsample is zero. Otherwise, the text is the number in the downsamples array * 100 whose index is downsample followed by <code>%</code> 6 116 Anti-Aliasing Calls SetText where the input string is MenuText line id 39 (OFF) when the FXAA component on the MainCamera is disabled and 38 (ON) when it is enabled 7 30 Shadow Quality Calls SetText where the input string is MenuText line id 40 (LOW) when pausemenu.lowshadow is true and 41 (FULL) when it is false 8 31 Texture Quality Calls SetText where the input string is MenuText line id 40 (LOW) when pausemenu.lowtex is true and 41 (FULL) when it is false 9 147 3D Outlines Calls SetText where the input string is MenuText line id 39 (OFF) when enableoutline is 0, 40 (LOW) when it is 1 and 41 (FULL) when it is 2 11 156 Advanced Particles Calls SetText where the input string is MenuText line id 39 (OFF) when particlelevel is 0, 40 (LOW) when it is 1 and 41 (FULL) when it is 2 10 140 Wind Effects Calls SetText where the input string is MenuText line id 39 (OFF) when nowindeffect is true and 38 (ON) when it is false 16 183 Vsync Calls SetText where the input string is MenuText line id 39 (OFF) when pausemenu.vsync is zero and 38 (ON) when it is not 12 80 Framerate Calls SetText where the input string is MenuText line id 81 (30 FPS) when pausemenu.fps is 0, 82 (60 FPS) when it is 1 and 107 (Unlimited) when it is 2 23 255 Pause When Unfocused Calls SetText where the input string is MenuText line id 39 (OFF) when pausemenu.pauseunfocus is false and 38 (ON) when it is true 13 157 Use Controller Calls SetText where the input string depends on pausemenu.joystick* 17 222 Controller to Use If Use Controller is set to PRE-CONFIGURED, Calls SetText where the input string depends on pausemenu.joystickid**. Otherwise, if pausemenu.joystickid is higher than -1, Calls SetText with ` 22 270 Analog Sensitivity First, if pausemenu.analog is higher than 2, it is set to 0. Then, SetText is called where the input string is MenuText line id 39 (OFF) when pausemenu.analog is 0, 40 (LOW) when it is 1 and 41 (FULL) when it is 2 18 231 Controller Bindings Does not render anything including the arrows 14 35 Key Bindings Does not render anything including the arrows 15 36 Return to Main Menu / Exit Game*** Does not render anything including the arrows 24 256 Reset Control. Bindings Does not render anything including the arrows <p>*: Here are all the pausemenu.joystick values with their corresponding text:</p> joystick MenuText line id Description 0 218 DISABLED 1 219 AUTO DETECT 2 220 FORCE XBOX 3 221 CHOOSE MANUALLY 4 224 PRE-CONFIGURED 5 230 CUSTOM BINDINGS <p>**: Here are all the pausemenu.joystickid values with their corresponding text when pausemenu.joystick is set to PRE-CONFIGURED:</p> joystickid MenuText line id Description 0 225 Xbox 360 1 226 Dualshock 4 2 227 Switch Pro Controller 3 232 Switch Joy-Con L 4 233 Switch Joy-Con R 5 228 Generic Controller 1 6 229 Generic Controller 2 7 242 Fight Pad Pro for Switch 8 269 Xbox Linux <p>***: An exception to the MenuText line id rule is the return to main menu option: the line id is the settingindex value only if it wasn't called from the StartMenu, but if it was, the line id is 37 instead.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Settings%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is MenuText line id 0 which is <code>berry</code> in English. It should be noted that under normal gameplay, this list type is not called with <code>showdescription</code> set to true.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Settings%20List%20Type/#input-handling","title":"Input handling","text":"<p>The Input handling of the list is done by PauseMenu's Update instead of MainManager's.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Skills%20List%20Type/","title":"Skills list type","text":"<p>Display the list of skills that a party member has access to.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Skills%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> will be the skills array field of the corresponding playerdata (-1, -2 and -3 means 0, 1 and 2 respectively). They corresponds the skills id of skilldata.</p> <p>The playerdata's skills are expected to be refreshed by using RefreshSkills which takes into account the party's rank and Medals equipped.</p> <p><code>listredirect</code> is overridden to null.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Skills%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>This behavior differs depending if we were paused or unpaused.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Skills%20List%20Type/#when-paused","title":"When paused","text":"<p>A first SetText call is done for the tp cost in non Dialogue mode where the input string is |sort,10||Font,0| followed by the cost padded left to 2 characters by  or <code>-</code> if there is no cost. This is rendered towards the right of the item bar. </p> <p>After, if the TP cost isn't 0, a TP icon (or HP icon if Life Cast is equipped) is rendered on the far right of the item bar. </p> <p>Finally, the input string is set to |single| followed by the skill's name from <code>skilldata</code>. </p> <p>The position of the input string is overridden to (-0.75, -0.2) and the bar height used for calculating the y position of the down arrow is overridden to -0.9.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Skills%20List%20Type/#when-unpaused","title":"When unpaused","text":"<p>A first SetText call is done for the tp cost in non Dialogue mode where the input string is |sort,10||size,0.75||Font,0| followed by |color,1| if the player doesn't have enough TP for the skill followed by the cost padded left to 2 characters by .  This is rendered towards the right of the item bar. </p> <p>After, if the TP cost isn't 0, a TP icon (or HP icon if Life Cast is equipped) is rendered on the far right of the item bar. </p> <p>Then, a string is built with Icon commands according to some medals being equipped (this is appended in the respective order if the medal is equipped):</p> <ul> <li>Needle Toss and Needle pincer:  + |size,0.55,0.6| + |Icon,192| if Electric Needles, + |Icon,191| if Sleepy Needles and + |Icon,193| if Poison Needles +  + |size,0.55,0.6| + |Icon,194| if A.D.B.P Enhancer</li> <li>Tornado Toss and Hurricane Toss:  + |size,0.55,0.6| + |Icon,194| if A.D.B.P Enhancer</li> <li>Secret Stash and Sharing Stash:  + |size,0.55,0.6| + |Icon,218| if Heal Plus</li> <li>Taunt:  + |size,0.55,0.6| + |Icon,195| if Deep Taunt</li> </ul> <p>Finally, the input string is set to the skill's name from skilldata prepended with |color,1| if the player doesn't have enough TP for the skill and appended with the icons string. </p> <p>The x position of the text is overridden to -2.65.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Skills%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is the skill's description obtained from skilldata using the skill id.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Skills%20List%20Type/#confirmation-handling-during-battle","title":"Confirmation handling (during battle)","text":"<p>The skill cost will then be checked if the player has enough and if they can use the skill in general. The cost is stored in flagvar 0. If the skill can be used and the player can pay the cost, SetItem is called on the battle with the selected skill and DestroyList is called which ends the processing of the list.</p> <p>If the skill can't be used, the buzzer sound will play. In addition, if the player couldn't pay the cost and the skill wasn't Hard Charge, the appropriate hud sprite will flash red (the TP one if it's TP cost or the party member's HP if we have Life Cast).</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Spy%20Cards%20List%20Type/","title":"Spy Cards list type","text":"<p>Display a list of spy cards provided by <code>multilist</code>. This is intended to display the list of available Spy Cards.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Spy%20Cards%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> will set to <code>multilist</code> which is implied to have been set after the list's creation before a refresh ordered by the cards order from the game data.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Spy%20Cards%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text is set to the enemy name of the enemy id associated with the card id from carddata. After, flagvar 6 is set to <code>option</code>.</p> <p>The x position of the text is overridden to -2.65.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Spy%20Cards%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>The behavior is the same then Caravan Prize Medals List Type (bug?).</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Stat%20Bonuses%20List%20Type/","title":"Stat Bonuses List Type","text":"<p>Display the list of all the stat bonuses applied.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Stat%20Bonuses%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> has one element being -1 if there are no statbonus in the array.</p> <p>Otherwise, <code>listvar</code> is all the bonus types of the statbonus in order. The amount and target are stored in a separate local 2 dimensional array where each element contains the amount and type respectively.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Stat%20Bonuses%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>If the option is -1, the text is |color,1| followed by MenuText line 20 which is \"No Items\" in English and flagvar 0 is set to -1.</p> <p>Otherwise, the text is set to the text representation of the StatBonus's name followed by <code>x</code> followed by the amount stored locally followed by <code>to</code> followed by the target's name stored locally. The target name is determined like the following: if it's -1, it's <code>All</code> and if it isn't, it's MenuText line 46 + the target which are Team Snakemouth's names in order. flagvar 1 is also set to <code>option</code>.</p> <p>The x position of the text is overridden to -2.65.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Stat%20Bonuses%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is empty.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Stat%20Bonuses%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>Confirmation is handled by MainManager's Update. First, the flagvar of the <code>storeid</code> is set to the selected option (bug?). Then, the list gets destroyed which ends this list's processing and resets the ItemList State Machine.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Stat%20Bonuses%20List%20Type/#remarks","title":"Remarks","text":"<p>This list is not available under normal gameplay because it is only used in the TestRoom.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Termacade%20Prizes%20List%20Type/","title":"Termacade prizes list type","text":"<p>Display the list of the Termacade prizes.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Termacade%20Prizes%20List%20Type/#options-generation","title":"Options generation","text":"<p><code>listvar</code> is the integers from 0 to the length of <code>termacadeprize</code> -1.</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Termacade%20Prizes%20List%20Type/#options-settext-input-string","title":"Option's SetText input string","text":"<p>The text is the name of the item from <code>itemdata</code> or medal from <code>badgedata</code> unless it is a medal and flags 681 (MYSTERY? activation) is true where the text is MenuText 59 which is \"?????\".</p> <p>The sprite of the item or medal will be rendered on the leftmost side of the bar. This sprite is a gray hexagon with a ? in it if it is a medal and flags 681 (MYSTERY? activation) is true. The localScale of the sprite is (0.55, 0.6, 1).</p> <p>If there is only one instance of the item available and its corresponding purchased flags is true, SetText is called where the parent is the bar, the position is (1.0, -0.15) and the input string is |sort,10||size,0.6,0.75||color,1| followed by MenuText 190 which is \"Sold Out!\".</p> <p>Otherwise, SetText is called where the parent is the bar, the position is (1.4, -0.15) and the input string is |sort,10||size,0.6,0.75| followed by the price of the items in tokens from termacadeprize. Additionally, a token sprite is rendering on the rightmost part of the bar. </p>"},{"location":"ItemList/List%20Types%20Group%20Details/Termacade%20Prizes%20List%20Type/#description-box-rendering","title":"Description box rendering","text":"<p>It uses the default rendering scheme described in Description box rendering where the text is the item's description from itemdata or the medal description from badgedata if flags 681 (MYSTERY? activation) is false (if it is, it's MenuText 59 which is \"?????\").</p>"},{"location":"ItemList/List%20Types%20Group%20Details/Termacade%20Prizes%20List%20Type/#confirmation-handling","title":"Confirmation handling","text":"<p>Confirmation is handled by MainManager's Update. First, the flagvar of the <code>storeid</code> is set to the selected option (bug?). Then, the list gets destroyed which ends this list's processing and resets the ItemList State Machine.</p>"},{"location":"ItemList/ShowItemList%20Life%20Cycle/Description%20box%20rendering/","title":"Description box rendering","text":"<ul> <li>If the listtype isn't a questboard list<ul> <li>Determine the text to render and if we are going to render at all via SetText according to the listtype</li> <li>Create a white 9Box at the bottom left portion of the screen that will have the description</li> <li>If <code>sell</code>:<ul> <li>Set the HUD to show the berry count.</li> <li>Set flagvar 10 to half the buying price rounded down of the item obtained from <code>itemdata</code> according to the listtype as the item type and <code>option</code> as the item id clamped from 1 to 999.</li> <li>Prepend the input string prepared earlier with the secondary string obtained earlier followed by <code>-</code> + the sell price display line with a Currency command at MenuText 49 + |line|</li> </ul> </li> <li>Calls SetText in non Dialogue mode with the following:<ul> <li>|single||singlebreak, + itemdescbreak (This is 10.5 normally) + <code>|</code> + the final text determined earlier</li> <li><code>BubblegumSans</code> font</li> <li>no linebreak</li> <li>no tridimensional</li> <li>position at (-5.25, 0.6)</li> <li>no cameraoffset</li> <li>size at (0.75, 0.75)</li> <li>parent is the 9Box created earlier</li> <li>no caller</li> </ul> </li> <li>Set <code>listdescbox</code> as the 9Box created earlier.</li> </ul> </li> <li>If the currently selected quest isn't None:<ul> <li>Create the <code>listdescbox</code>.</li> <li>Render an image of the quest id <code>option</code>'s author using <code>librarysprites</code> from the index obtained in BoardQuestData which will have a name of <code>Image</code> and a tag of <code>Text</code>.</li> <li>Calls SetText with the following in non Dialogue mode:<ul> <li><code>text</code>: |size,0.75||sort,1| + The <code>By:</code> from MenuText 104 + <code></code> + The author of the quest id <code>option</code> obtained from <code>boardquestdata</code> + |line||halfline| + The <code>Difficulty:</code> from MenuText 105 + <code></code> + |Stars, + The amount of filled in stars of the quest id <code>option</code> obtained from <code>boardquestdata</code> + <code>|</code>.</li> <li><code>position</code>: (12, 0.35).</li> <li><code>parent</code>: <code>listdescbox</code>.</li> </ul> </li> </ul> </li> </ul>"},{"location":"ItemList/ShowItemList%20Life%20Cycle/Rerendering%20after%20scroll/","title":"Rerendering after scroll","text":"<ul> <li>Sets <code>listy</code> to <code>listlow</code> to indicate the list has been scrolled.</li> <li>If this is a new ItemList, Initializes the static fields: <code>listmax</code> to <code>listammount</code>, <code>listlow</code> to 0, option to 0, <code>listcursor</code> to 0, <code>inlist</code> to true and create the cursor.</li> <li>If this is a refresh, free all the letter slots used in ItemList and itself.</li> <li>Resets ItemList to a new GameObject, set its parent to the GUICamera or to the <code>questboardobj</code> if it isn't null and set its localPosition to (<code>position</code>.x, <code>position</code>.y, 10.0).</li> <li>If listtype is the language selection list, Call SetText in non Dialogue mode where the text is set to the language selection prompt using the index of option of <code>listvar</code> prepended with |color,4||center||sort,20|. This effectively changes the line to match the selected language.</li> <li>If <code>listlow</code> is above 0 and <code>maxoptions</code> is higher than <code>listammount</code> (which means that there are more items than visible at once and we have scrolled below the top):<ul> <li>Setup the up arrow GUI sprite to appear at the top of the list as child of ItemList. The exact setup depends on listtype and if we are in the pause menu.</li> </ul> </li> <li>If we had a list in <code>overridedlist</code>, restore it and clear it.</li> <li>If we allow multi select <code>listsell</code> is true OR listtype is storage items OR (listtype is standard items and flags 349 is on), then setup the UI to instruct how to operate multiple selection.</li> <li>For each index in the visible part of the ItemList that does not exceed <code>maxoptions</code> (this means an empty ItemList will have no iteration):<ul> <li>Setup the SpriteRenderer that will contain the option as child of the ItemList. A 75% opaque rectangle will be rendered as background if we aren't paused and the listtype isn't one about quests, settings, language list or input lists (color is green if it is in <code>multiselect</code> or white otherwise). The layer is set to 5, scaled by 1.15 in x when not paused and the position is relative to its index.</li> <li>Set the default rendering param to send to SetText that can be overridden by listtype: x is -2, y is -0.15 and size is (0.75, 0.75).</li> <li>Obtain the text of the option according to listtype.</li> <li>Calls SetText in non Dialogue mode using the <code>BubblegumSans</code> font in non tridimensional at the position and size determined earlier without a Camoffset with the SpriteRenderer as the parent and without a caller with the text prepended with:<ul> <li>|size,0.6,0.8| when unpaused </li> <li>Nothing if paused and listtype is not the current medals list </li> <li><code></code> otherwise.</li> </ul> </li> </ul> </li> <li>If the ItemList isn't scrolled such that the bottom is visible:<ul> <li>Setup the down arrow GUI sprite to appear at the bottom of the ItemList as child of the <code>ItemList</code>. The exact setup depends on listtype and if we are in the pause menu.</li> </ul> </li> </ul>"},{"location":"SetText/Commands%20sorted%20by%20enum%20value/","title":"SetText Commands Sorted By Enum Value","text":"<p>This only shows the enum sorted list of commands. If you want to console their proper specification, consult this page</p>"},{"location":"SetText/Commands%20sorted%20by%20enum%20value/#commands-table","title":"Commands table","text":"<p>There are 217 commands as of 1.1.2.</p> ID Name 0 String 1 Var 2 Anstring 3 <code>Checkitem</code> 4 Prompt 5 <code>Getitem</code> 6 Line 7 Next 8 End 9 Break 10 Blank 11 Lock 12 Cancelaction 13 Center 14 Halfline 15 Stopskip 16 Noskip 17 Hide 18 Rainbow 19 Shaky 20 Wavy 21 Glitchy 22 <code>Buffer</code> 23 Overfollower 24 Choicewave 25 Spd 26 Speed 27 Color 28 Anim 29 Sort 30 Save 31 Parent 32 Tail 33 Flag 34 Checkmoney 35 Checkinvqtd 36 Additemtoss 37 Additem 38 Money 39 Goto 40 Currency 41 Kill 42 Boxstyle 43 Pickitem 44 Checktrue 45 Removeitem 46 Getstorage 47 Button 48 Movewait 49 Move 50 Forcewait 51 Wait 52 Face 53 Camtarget 54 Flip 55 Warp 56 Transfer 57 NumberPrompt 58 Common 59 Checkvar 60 Fwait 61 FadeIn 62 FadeOut 63 <code>LeafIn</code> 64 <code>LeafOut</code> 65 Align 66 Discovery 67 size 68 Minibubble 69 Destroyminibubble 70 Halt 71 Waitminibubble 72 Showmoney 73 Hidemoney 74 Innsleep 75 Event 76 Checkregional 77 Checkflag 78 Regionalflag 79 Createitem 80 Addboard 81 <code>Openboard</code> 82 Camangle 83 Camoffset 84 Completequest 85 Activateselectedquest 86 Resetcamera 87 Quarterline 88 Questprompt 89 Heal 90 Lockmovement 91 Teleportparty 92 Flagvalue 93 Removebadgeshop 94 Savecamera 95 Loadcamera 96 Camspeed 97 Stars 98 Giveitem 99 Tailextra 100 Setvar 101 Gettail 102 Jump 103 Position 104 Hidespeed 105 Breakflag 106 Bleep 107 Exitgame 108 Openpause 109 Font 110 Exp 111 Icon 112 Dropshadow 113 Level 114 Clonestring 115 Pauseline 116 Addfollower 117 Fadeletter 118 Setprize 119 Libraryline 120 Shopline 121 Shakecamera 122 Removemaplimits 123 Resetmaplimits 124 Music 125 Sound 126 Destroydescbox 127 Resetregion 128 Mapflag 129 Checkmapflag 130 Kinematicplayer 131 Removefollower 132 Shoppool 133 Optiontovar 134 <code>Librarybreak</code> 135 Setbreak 136 Librarybook 137 Area 138 Sstring 139 Menu 140 Battle 141 Removestat 142 Addstat 143 Checkpos 144 Triui 145 Backline 146 Cardbattle 147 Boxspeed 148 Battlewon 149 Switch 150 Checkminibubble 151 Breakend 152 DungeonGame 153 BeeGame 154 Copyvar 155 Addvar 156 Showtokens 157 Call 158 Igcolmove 159 PartyGame 160 LetterPrompt 161 Define 162 Loadmap 163 Checkanim 164 Camlimit 165 Waitcn 166 Faketail 167 Unpauseline 168 Cberrytotal 169 Medaltotal 170 Single 171 Tab 172 Singlebreak 173 Librarysize 174 Mothfly 175 Chapterintro 176 Backbox 177 Testdiag 178 Lore 179 Follow 180 Transitionsort 181 Moveahead 182 Addquest 183 Textangle 184 Particle 185 Itemname 186 Addprize 187 Entityalive 188 Scorecheck 189 Fademusic 190 Limit 191 Termacadecheck 192 Removeitemat 193 Unpausesize 194 Alwaysactive 195 Lockbacktrack 196 Fixchompy 197 Updateanim 198 Checkallquests 199 Takeopenquests 200 Deathsmoke 201 Emoticon 202 Checksum 203 Questsize 204 Questbreak 205 Mapsize 206 Caravanmedal 207 <code>Name</code> 208 Itemvalue 209 Sizemulti 210 Ignorenext 211 Rerollshops 212 Maxmedals 213 Battlesize 214 Pausesize 215 GetFromMap 216 Listsize"},{"location":"SetText/Commands/","title":"SetText Commands","text":"<p>A <code>Commands</code> is a enum used by SetText that indicates a command to processes something with or without parameters. When specifying the input string, a command and its parameters must be enclosed in <code>|</code>. The command name and each of its parameters must be separated by <code>,</code>. The command text is refered to anything between both <code>|</code> which the command has the ability to replace the text and resume processing at the same position.</p> <p>Commands also has the ability to perform what's called a redirection which overwrites the input string with a new one and then resumes processing at the start of this new string.</p>"},{"location":"SetText/Commands/#about-case-sensitivity","title":"About case sensitivity","text":"<p>While the actual parsing of the command's name is case insensitive, it is strongly recommended to specify it in all lowercase. This is because there are some logic which are only compatible with the name being in all lowercase notably OrganiseLines and some checks such as the commands allowed in testdiag mode. Not putting it in all lowercase can result in commands being misidentified in some special cases.</p> <p>For that reason, it is best to consider everything to be case sensitive unless specified otherwise.</p>"},{"location":"SetText/Commands/#about-the-notes-column","title":"About the notes column","text":"<p>The notes contain useful information about each commands, here are what they mean:</p> <ul> <li>NOT REFERENCED: The enum value exists, but no implementation or references exists, the command name can be parsed without errors, but it will do nothing and so, it does not have a documentation page.</li> <li>UNUSED: The command remains functional and has an implementation, but there are no known usage in the game. Whether the command is useful or not can be found in its details page.</li> <li>DIALOGUE MODE: The command requires Dialogue mode or works incorrectly in non Dialogue mode.</li> <li>REGULAR LETTER RENDERING: The command requires to be using Regular Letter Rendering or works incorrectly in Single Letter Rendering.</li> <li>SINGLE LETTER RENDERING: The command requires to be using Single Letter Rendering or works incorrectly in Regular Letter Rendering.</li> <li>TESTDIAG: The command is supported by Testdiag.</li> <li>BACKTRACK: The command is supported by the Backtracking system and its command text may be accumulated or it may directly interact with the system.</li> <li>REDIRECT: The command may cause a redirect and resume processing at the start of the new input string.</li> <li>REPLACE: The command may replace the command text and resume processing at the same position.</li> <li>PROCESSED IN ORGANISELINES: The command can be processed by OrganiseLines instead of SetText.</li> <li>INFLUENCES ORGANISELINES: The command may influence the logic of OrganiseLines without necessarily being processed by it.</li> </ul>"},{"location":"SetText/Commands/#about-the-enums-backing-value","title":"About the enum's backing value","text":"<p>The actual int form of the enum isn't used in any way. Only the enum values's name is used for parsing. This means the backing value isn't relevant and as such, the table presented below will not show them in enum value order, but rather by logical categories. The ID column will show the value still for the sake of completeness. If you wish to only view the commands list sorted by their enum value, consult this page</p>"},{"location":"SetText/Commands/#commands","title":"Commands","text":"<p>There are 217 commands as of 1.1.2. Here are the different commands grouped by categories.</p>"},{"location":"SetText/Commands/#line","title":"Line","text":"ID Name Summary Notes 6 Line Go to a new line below and continue rendering at the start of the new line INFLUENCES ORGANISELINES, BACKTRACK, TESTDIAG 14 Halfline An alias of <code>line</code> where <code>linespacing</code> is 0.5 INFLUENCES ORGANISELINES, BACKTRACK, TESTDIAG 87 Quarterline An alias of <code>line</code> where <code>linespacing</code> is 0.25 INFLUENCES ORGANISELINES, BACKTRACK, TESTDIAG 115 Pauseline An alias of <code>line</code> that is only processed by SetText when the pause menu is active and either in no window or in the following windows: top level window, \"Inventory\" and \"Medals and Stats\" INFLUENCES ORGANISELINES, BACKTRACK 119 Libraryline An alias of <code>line</code> that is only processed by SetText when the pause menu is active and the active window is \"library\" INFLUENCES ORGANISELINES, BACKTRACK 120 Shopline An alias of <code>line</code> that is only processed by SetText when unpaused and the player has control or an ItemList is getting processed INFLUENCES ORGANISELINES, BACKTRACK 145 Backline Does the same task than <code>line</code>, but with a different syntax and it only works in Regular Letter Rendering while <code>line</code> works for both letter rendering method REGULAR RENDERING 167 Unpauseline An alias of <code>line</code> that is only processed by SetText when the pause menu is not active INFLUENCES ORGANISELINES, BACKTRACK"},{"location":"SetText/Commands/#size","title":"Size","text":"ID Name Summary Notes 67 size Set the text size scaling to render from now on with the ability to prevent processing of further size commands temporarily INFLUENCE ORGANISELINES, BACKTRACK 173 Librarysize An alias of <code>size</code> where the command is only processed if the pause menu is active on the \"Library\" window INFLUENCE ORGANISELINES, BACKTRACK 193 Unpausesize An alias of <code>size</code> where the command is only processed if the pause menu and the <code>questboardobj</code> for the Quest Board List Type are inactive INFLUENCE ORGANISELINES, BACKTRACK 203 Questsize An alias of <code>size</code> where the command is only processed if the <code>questboardobj</code> for the Quest Board List Type is active INFLUENCE ORGANISELINES, BACKTRACK 205 Mapsize An alias of <code>size</code> where the command is only processed if the pause menu is active on the Map of Bugaria window INFLUENCE ORGANISELINES, BACKTRACK 209 Sizemulti An alias of <code>size</code> in its second syntax INFLUENCE ORGANISELINES, BACKTRACK 213 Battlesize An alias of <code>size</code> or <code>sizemulti</code> that is only processed if a battle is in progress BACKTRACK 214 Pausesize An alias of <code>size</code> where the command is only processed if the pause menu is active and the questboardobj for the Quest Board List Type is inactive INFLUENCE ORGANISELINES, BACKTRACK 216 Listsize An alias of <code>size</code> or <code>sizemulti</code> that is only processed if a battle is in progress, the pause menu is inactive and we are in an ItemList INFLUENCE ORGANISELINES, BACKTRACK"},{"location":"SetText/Commands/#flag-arrays-management","title":"Flag arrays management","text":"ID Name Summary Notes 0 String Replaces the text from this command to a flagstring text with horizontal size clamping support REPLACE 1 Var Replaces the text from this command to the textual representation of a flagvar with left padding support or set a flagvar to a value REPLACE 33 Flag Set a specific flag slot or a one whose id is in a flagvar to a value 66 Discovery Enable a Discoveries entry or enable all Discoveries entry, Bestiary entry, Recipes entry, Records entry and seen Areas 78 Regionalflag Set a Regionalflag slot to a value 92 Flagvalue Replace the text of this command by the string representation of a flag slot or one where the slot is contained in a flagvar slot REPLACE 100 Setvar Set a flagvar to a specific value, or increase/decrease a flagvar by a value or another flagvar 114 Clonestring Copy the value of a flagstring to another 127 Resetregion Reset all Regionalflags slot to false 128 Mapflag Changes a mapflags slot using a specific id directly or one coming from a flagvar slot 133 Optiontovar Set flagvar 0 or a specific slot to the last selected option from a <code>prompt</code>, <code>numberprompt</code> or ItemList 154 Copyvar Set the value of a flagvar slot UNUSED 155 Addvar Perform an arithmetic operation on a flagvar slot using a value as the other operand where the value is directly specified, corresponds to the current amount of berries or contained in another flagvar slot 168 Cberrytotal Replace the text of this command by the amount of crystalbfflags that are set to true REPLACE 185 Itemname Set a flagstring to an Item or Medal's name where the id is specified directly or contained in a flagvar 208 Itemvalue Set a flagvar to an Items or Medal's value (buying price) where the id is specified directly or contained in a flagvar"},{"location":"SetText/Commands/#dynamic-text-insertion","title":"Dynamic text insertion","text":"ID Name Summary Notes 2 Anstring Replaces the text from this command to a medal or item's prepender string from the game data REPLACE 40 Currency Replaces this command's text with a textual representation of a number followed by a space followed by either the singular form of the game's currency (berry in English) or the plural form (berries in English) depending on a specific amount or an amount contained in a flagvar REPLACE 46 Getstorage Replace the text of this command by the remaining amount of free items space of the storage (this is 35 - amount of items in storage under normal gameplay) REPLACE 58 Common Replace the input string to a parameterless blank command followed by a line in commondialogue and continue processing at the start of it REPLACE 138 Sstring Alias to <code>string</code> if processed by SetText directly, but it can also be processed before on OrganiseLines by replacing the text of this command to a flagstring PROCESSED IN ORGANISELINES 137 Area Replace the text of this command by the current Area's name REPLACE 139 Menu Alias to <code>string</code> if processed by SetText directly where <code>flagstring</code> is a menu text line id instead, but it can also be processed before by OrganiseLines with different behaviours PROCESSED IN ORGANISELINES 157 Call An alias of <code>string</code> where <code>flagstring</code> is a Dialogue line id instead REPLACE, TESTDIAG 169 Medaltotal Replace the text of this command by the amount of Medal in the player's possession REPLACE 178 Lore A helper of <code>string</code> where flagstring 0 is set to the Lore Book's text whose id is in flagvar 0 with additional commands then the same flagstring is sent to <code>string</code> in its fourth syntax REPLACE 212 Maxmedals Replace this command's text by the number of collectible medals in the game (hardcoded to 108) REPLACE 215 GetFromMap Replace the text of this command to a dialogue line that belongs to a specific Map REPLACE"},{"location":"SetText/Commands/#sprite-rendering","title":"Sprite rendering","text":"ID Name Summary Notes 47 Button Renders a ButtonSprite inline of the text and adjust the offset accordingly to resume processing after the sprite REGULAR RENDERING, INFLUENCE ORGANISELINES, BACKTRACK 97 Stars Renders a specific amount of white stars sprites in a row REGULAR RENDERING 111 Icon Render a gui sprite with a configurable size multiplier and sort value REGULAR RENDERING, BACKTRACK, TESTDIAG 174 Mothfly Replace the text of this command to a series of a specific amount of |icon,146,<code>size</code>| commands in a row where <code>size</code> is configurable REPLACE"},{"location":"SetText/Commands/#conditional-rediction-and-flow","title":"Conditional rediction and flow","text":"ID Name Summary Notes 34 Checkmoney Check that the berry count is less than a specific value or a value contained in a flagvar. If it is, redirect to another dialogue line REDIRECT 35 Checkinvqtd Check that the quantity of items in an inventory is equal or higher than a specific quantity or the maximum amount allowed by the game for this specific inventory. If it is, replaces the input string by another dialogue line REDIRECT 39 Goto Redirect to a particular dialogue line or a randomly selected one from a list. This has support for appending commands and to not blank the textbox before the replacement REDIRECT, BACKTRACK, TESTDIAG 44 Checktrue Check a flagvar for NOT being a specific integer, a single flag for being true or a set of flags for a specific state and either do nothing if all conditions are satisfied or redirect to a different line if they aren't REDIRECT 59 Checkvar Compare a flagvar against a value or another flagvar for a condition and redirect if this condition ends up being true or do nothing if it ends up being false REDIRECT 76 Checkregional Redirect to another dialogue line using a Dialogue line id if a Regionalflag slot is false or if it is in a specific state REDIRECT 77 Checkflag A variation of <code>checktrue</code> where the only difference is the flag condition are inverted REDIRECT 129 Checkmapflag Redirect to a Dialogue line id if a specific mapflags slot is true or continue processing as normal if it is false REDIRECT 143 Checkpos Redirect to a different line by a Dialogue line id if the current player's position on a specific axis isn't at least a specific value or do nothing otherwise REDIRECT 148 Battlewon Do nothing if the last battle or card battle was won, but redirect to a different dialogue line if it was lost or fled from REDIRECT 163 Checkanim Redirect to a different dialogue line if an Entity's animstate is a specific value REDIRECT 191 Termacadecheck A <code>goto</code> helper where the Dialogue line id can be one of 2 values depending if both high scores at the Termacade games were beaten or not from their default one REDIRECT, BACKTRACK 198 Checkallquests Redirect if 60 or more BoardQuests are in the completed board or do nothing otherwise REDIRECT 202 Checksum Process a <code>goto</code> in its first syntax if 2 values or flagvar slots added together is strictly bigger than another value or flagvar slot or do nothing otherwise REDIRECT, BACKTRACK 206 Caravanmedal Process a <code>goto</code> in syntax (2) if there are more than 1 prize Medal set to be available through the Caravan shop or do nothing otherwise REDIRECT, BACKTRACK"},{"location":"SetText/Commands/#dialogue-flow","title":"Dialogue flow","text":"ID Name Summary Notes 7 Next Signals the game that the current textbox is over and wait for a confirmation input before resuming with a fresh textbox BACKTRACK, TESTDIAG, INFLUENCES ORGANISELINES 8 End Signal to SetText to not wait for a confirmation input at the end after the input string has been fully processed DIALOGUE MODE 9 Break Wait for a confirmation input before resuming 10 Blank Clears the current textbox by freeing all letter slots and go at the start of the first line BACKTRACK, INFLUENCES ORGANISELINES 11 Lock Force a grab on the message and the <code>minipause</code> locks UNUSED, DIALOGUE MODE 15 Stopskip Forces a stop on the text skip if one was in progress DIALOGUE MODE 16 Noskip Forces a stop on the text skip if one was in progress and also prevents any text skip to occur from this point until it is allowed again DIALOGUE MODE 25 Spd Set the wait time in seconds between letters 26 Speed An alias of <code>spd</code> 31 Parent Change the caller to an Entity's NPCControl 32 Tail Set the tailtarget to an Entity and optionally change the animation state of the new target Entity  with a hide/unhide of the textbox DIALOGUE MODE, BACKTRACK, TESTDIAG 42 Boxstyle Sets the textbox's sprite or disable its rendering from now on DIALOGUE MODE 50 Forcewait Yields for a certain amount of seconds if unpaused and stop a Text advance <code>skiptext</code> if one was in progress 51 Wait Yields for a certain amount of seconds if a Text advance <code>skiptext</code> isn't in progress 60 Fwait An alias of <code>forcewait</code> 99 Tailextra An alias of <code>tail</code> where the int form of <code>entity</code> refers to a temporary follower index instead of an Entity id DIALOGUE MODE, BACKTRACK, TESTDIAG 101 Gettail An alias of <code>tail</code> where the int form of <code>entity</code> refers to the AnimID of the entity to set the tailtarget instead of its Entity id DIALOGUE MODE, BACKTRACK 104 Hidespeed Set the rate of the shrink/grow animation of the textbox when it is hidden/revealed DIALOGUE MODE 105 Breakflag Set <code>end</code> to true if a specific flag slot is false UNUSED 106 Bleep Change the current dialogue bleep sound and its pitch from an AnimID data, Entity field or specified directly DIALOGUE MODE 147 Boxspeed An alias of <code>hidespeed</code> DIALOGUE MODE 151 Breakend Replace the text of this command by |<code>break</code>||<code>destroyminibubble</code>||<code>end</code>| TESTDIAG 165 Waitcn Yield until the chapter intro coroutine is over UNUSED 166 Faketail Hide/shrink then reveal/grow the current textbox with a 0.15 seconds yield between after either operation TESTDIAG 177 Testdiag Enables the dialogue test mode until the end of SetText processing UNUSED 195 Lockbacktrack Prevent any Backtracking from happening during the rest of the SetText call BACKTRACK"},{"location":"SetText/Commands/#entity-control","title":"Entity control","text":"ID Name Summary Notes 23 Overfollower Toggles or set an override on followers to stop following their followee 28 Anim Change the animstate of the party or a specific Entity 41 Kill Kills an Entity by calling Death (with <code>activatekill</code> true) on it 48 Movewait Yield until a specific Entity's forcemove lock is released 49 Move Instruct the game to start a forcemove on an Entity to a specific position with a configurable speed, start and stop state 52 Face Instruct the party or an Entity to face towards another one and optionally have that Entity also face towards back 54 Flip Toggle or set the <code>flip</code> state of an Entity or the party 102 Jump Make an Entity jump up with a configurable velocity 116 Addfollower Add the caller as a follower to a new entity or add a new one via an AnimID or a flagvar slot containing it 161 Define Add a name that can be used to resolve an Entity id for this SetText call DIALOGUE MODE 179 Follow An shorthand of <code>addfollower</code> in its second syntax 181 Moveahead Instruct the game to start a forcemove on an Entity where the destination is relative to its current position with a configurable speed, start and stop state 184 Particle Play a particle effect at an Entity's position + a specific offset 187 Entityalive Redirect if an Entity id resolves to not null and enabled, otherwise, this will not do anything and continue processing REDIRECT 194 Alwaysactive Set the <code>alwaysactive</code> field of an Entity to a value 197 Updateanim Call <code>UpdateAnimSepecifc</code> on an Entity 200 Deathsmoke Emit 20 particles at the parent or an Entity's position with configurable size 201 Emoticon Show an emoticon above an Entity for a given amount of frames"},{"location":"SetText/Commands/#party-and-player-control","title":"Party and player control","text":"ID Name Summary Notes 12 Cancelaction Cancel the player's current field action UNUSED 65 Align Move the party and Chompy's Entity if present to be aligned in a row to the right or left of the caller via a forcemove 89 Heal Heals the party fully or only heal the party's TP 90 Lockmovement Lock any rotation and movement to the player's entity's RigidBody with the exception of Y movement 91 Teleportparty Teleports the party's entities near the player's Entity which optionally includes any temporary non party follower or teleport just the party entities at a specified distance and direction from the player's Entity 110 Exp Set, add or remove Exploration Points to the party by a value or by a value stored in a flagvar slot 141 Removestat Remove a stat bonus by its index or a flagvar slot containing it and optionally recalculate the party's stats after the removal 113 Level Set, add or remove ranks to the party by a value or by a value stored in a flagvar slot 130 Kinematicplayer Set the <code>isKinematic</code> property of the player's entity's RigidBody to a value or turn it on temporarily for the rest of this SetText call 131 Removefollower Remove a follower from the <code>extrafollowers</code> list by AnimID or remove all followers from it 142 Addstat Add a stat bonus by specifying its properties directly or by specifying flagvar slots containing them and optionally recalculate the party's stats after the removal 158 Igcolmove Ignore all collision with the player to a specific Entity during this SetText call DIALOGUE MODE 196 Fixchompy Set Chompy's <code>following</code> to the last party's Entity"},{"location":"SetText/Commands/#text-rendering","title":"Text rendering","text":"ID Name Summary Notes 13 Center Toggle the text centering during rendering 17 Hide Hide or unhide the current textbox DIALOGUE MODE 18 Rainbow Toggles the rainbow FontEffects that will be effective from this point REGULAR LETTER RENDERING, BACKTRACK, TESTDIAG 19 Shaky Toggles the shaky FontEffects that will be effective from this point REGULAR LETTER RENDERING, BACKTRACK, TESTDIAG 20 Wavy Toggles the wavy FontEffects that will be effective from this point REGULAR LETTER RENDERING, BACKTRACK, TESTDIAG 21 Glitchy Toggles the glitchy FontEffects that will be effective from this point REGULAR LETTER RENDERING, BACKTRACK, TESTDIAG 24 Choicewave Enable a PromptAnim on the textholder that will highlight the text with a wave visual effect if it is hovered on during a <code>prompt</code> 27 Color Set the text color to one of the game's text color palette for every letter from now on REGULAR LETTER RENDERING, TESTDIAG 29 Sort Changes the sorting order of every letter rendered from now on REGULAR LETTER RENDERING 103 Position Set the vertical position of the textholder relative to its parent UNUSED 109 Font Change the current fonttype used by SetText from now on 112 Dropshadow Set the text's drop shadow offset vector or turn off the effect 117 Fadeletter Toggle the fade letter font effect from inactive to active or from active to inactive REGULAR RENDERING 135 Setbreak Changes the OrganiseLines's <code>linebreak</code> value with the option to run OrganiseLines again after the change 144 Triui Toggle the camera used to render each letters to 3DGUI instead of GUICamara (main camera in <code>tridimensional</code>) REGULAR RENDERING 170 Single Toggle or set whether to render in Single Letter Rendering 171 Tab Set the tabsize of the current letter slot in Single Letter Rendering SINGLE LETTER RENDERING 172 Singlebreak Instruct OrganiseLines to use the specialized line breaks handling for Single Letter Rendering INFLUENCES ORGANISELINES, SINGLE LETTER RENDERING 176 Backbox Render a box behind the text with 40% transparency using one of the text colors 183 Textangle Reset or set the angles of the textholder 190 Limit Changes the OrganiseLines's <code>linebreak</code> value UNUSED, INFLUENCES ORGANISELINES"},{"location":"SetText/Commands/#camera-control","title":"Camera control","text":"ID Name Summary Notes 53 Camtarget Set the camera to target an Entity, target a specific position or remove any existing targets 82 Camangle Changes the main camera's angle 83 Camoffset Changes the main camera's base position 86 Resetcamera Resets the camera to a default state 94 Savecamera Saves the current camera's configuration and limits for retrieval later using <code>loadcamera</code> 95 Loadcamera Loads the saved camera's configuration and limits saved by <code>savecamera</code> 96 Camspeed Set the camera's movement speed's multiplier 121 Shakecamera Shakes the camera's position by a configurable amount, time and whether or not to return to the initial position 122 Removemaplimits Remove the position bound limits of the camera with the option to save the current ones to restore later using <code>resetmaplimits</code> 123 Resetmaplimits Restore the position bound limits of the camera from their original one when the map was loaded or from the ones saved using <code>removemaplimits</code> if they were saved to the temporary fields 164 Camlimit Set the camera's positional lower bound limits (this command is likely broken, see its documentation for details) UNUSED"},{"location":"SetText/Commands/#minibubble-management","title":"Minibubble management","text":"ID Name Summary Notes 68 Minibubble Show some text inside a Minibubble by a Dialogue line id or by directly specifying the text which will have its tail set to a specified entity. The Minibubble's lifecycle can then be controlled from the same SetText call using <code>waitminibubble</code> and <code>destroyminibubble</code> 69 Destroyminibubble Force the destruction of all or a specific <code>minibubble</code> by its index in the bubbles list if it wasn't destroyed yet 70 Halt Completely stall SetText via an infinite loop that yields a frame (useful with <code>minibubble</code>) 71 Waitminibubble Yield until all or a specific <code>minibubble</code> by its index in the bubbles list is destroyed 150 Checkminibubble Redirect if any <code>minibubble</code> are present to a different dialogue line or do nothing if none are present REDIRECT"},{"location":"SetText/Commands/#prompts","title":"Prompts","text":"ID Name Summary Notes 4 Prompt Display a prompt offering multiple options with cancellation support, then wait that an option has been chosen and process it in the same SetText call DIALOGUE MODE, REDIRECT 43 Pickitem Setup an ItemList using ShowItemList with the parameters sent which can get handled by SetText after the ItemList goes inactive DIALOGUE MODE, REDIRECT 57 NumberPrompt Displays a prompt where an integer number can be entered by entering each digits and redirects upon confirmation or cancellation. The result is stored in a flagvar slot upon confirmation DIALOGUE MODE, REDIRECT 160 LetterPrompt Displays a prompt where a flagstring can be edited by changing each letter and redirects upon confirmation DIALOGUE MODE, REDIRECT"},{"location":"SetText/Commands/#boardquest-control","title":"BoardQuest control","text":"ID Name Summary Notes 80 Addboard Add a BoardQuest to the open board UNUSED 84 Completequest Sets a BoardQuest as completed which removes it from the taken board and add it to the completed board 85 Activateselectedquest Mark a specific BoardQuest or the one whose id is in flagvar 0 as taken which removes it from the open board and adds it to the taken board 88 Questprompt Sets the last <code>prompt</code> as a quest prompt which needs specific handling 182 Addquest Add a BoardQuest to the open board or move an existing BoardQuest to another board 199 Takeopenquests Move all BoardQuests in the open board to the taken board with the exception of the 5 bounty ones 204 Questbreak Signal the char loop that processing is completed once this iteration ends under certain conditions (this command is broken, see its documentation section for details) UNUSED"},{"location":"SetText/Commands/#items-medals-and-currency-control","title":"Items, Medals and currency control","text":"ID Name Summary Notes 36 Additemtoss Give an Item or medal based on its id or a flagvar containing it. If it's an item and the item inventory is full, prompt to toss an item REDIRECT 37 Additem Give an Item based on its id or a flagvar containing it or transfer all the items selected to or from the storage if the last ItemList had a multi selection 38 Money Add or remove a certain amount of berries from the berries count which can optionally come from a flagvar 45 Removeitem Remove a medal by its id or an item by its index from a specific inventory type where the item index or medal id is specified directly or is contained into a specified flagvar slot. This can also remove all items that was multi selected in the last ItemList if it was a <code>listsell</code> 79 Createitem Create an item Entity of a specific Item, Medal or a Crystal Berry with configurable position and timer before disappearing 93 Removebadgeshop Removes a medal from a medal shop by its medal id or by a flagvar containing it 98 Giveitem Give an item, Medal, Crystal Berry or berries to the player where its identification or amount is specified directly or is retrieved from a flagvar with proper animations, presentations and checks that this action does not exceed the maximum amount of standard items if it is one REDIRECT 118 Setprize Mark a Caravan prize medal as obtained via its Medal id or the caller's animstate which also removes it from the caravan list. This can also mark any prize medal as obtained via its prize id 132 Shoppool Add a medal to a medal shop's pool by Medal id or one coming from a flagvar, remove all medals from a specific shop's pool using a store id or one coming from a flagvar or remove all medals from all shop pools 186 Addprize Mark a Caravan prize medal as available via its prize id 192 Removeitemat Remove an Item by its inventory type and its index in that inventory which may come from ItemList's <code>listoption</code> 211 Rerollshops Refresh all the shops and randomnise their available pool from their stock pool which changes which ones are on display"},{"location":"SetText/Commands/#transition-and-cutscenes","title":"Transition and cutscenes","text":"ID Name Summary Notes 61 FadeIn Play a fade in visual transition with options to specify the speed, color and the ability to destroy the caller after a <code>fadeout</code> done right after this one 62 FadeOut Play a fade out visual transition with options to specify the speed after a <code>fadein</code> 74 Innsleep Play the inn sleeping cutscene with configurable final positions and camera controls then yield until it is over 75 Event Start an Event or set if we are in an event or not 175 Chapterintro Play a chapter into and yield until it is done playing 180 Transitionsort Change the sortingOrder of the current sprite used for transitions"},{"location":"SetText/Commands/#battle","title":"Battle","text":"ID Name Summary Notes 140 Battle Starts an inescapable enemy battle with all or a specific list of Enemies with configurable battle map and music; then yield until the battle is over 146 Cardbattle Start a Spy Card battle with an opponent or the caller with a configurable map and deck; then yield until the battle is over"},{"location":"SetText/Commands/#termacade","title":"Termacade","text":"ID Name Summary Notes 152 DungeonGame Start a game of Mite Knight (aka MazeGame) and yield until it is over 153 BeeGame Start a game of Flower Journey (aka FlappyBee) and yield until it is over 159 PartyGame This command will cause an exception to be thrown (see its documentation for more details), do not use UNUSED 188 Scorecheck Render the Termacade's games high scores and yield until Confirm or Cancel is pressed"},{"location":"SetText/Commands/#audio-control","title":"Audio control","text":"ID Name Summary Notes 124 Music Change the current music from its filename with a configurable fade speed or fade the current music to silence 125 Sound Play a sound effect music from its file path with a configurable pitch and volume with the option to loop it at the first free AudioSource or a specific one by its id 189 Fademusic Fade the music to silence with a configurable fading speed"},{"location":"SetText/Commands/#hud-visibility","title":"HUD visibility","text":"ID Name Summary Notes 72 Showmoney Show the currency count HUD element 73 Hidemoney Hide the currency count HUD element 156 Showtokens Create or destroy a Game Tokens counter HUD element"},{"location":"SetText/Commands/#global-game-functions","title":"Global game functions","text":"ID Name Summary Notes 30 Save Attempts to save the game and continue processing with an output message REPLACE 107 Exitgame Immediately stops the game's execution if called from the StartMenu's settings or reset the game's scene after a transition if called from the pause menu after loading a file UNUSED 108 Openpause Change the active window of the existing pause menu"},{"location":"SetText/Commands/#map-load","title":"Map load","text":"ID Name Summary Notes 55 Warp Setup a map transfer to either a specific map id or one that is contained in a flagvar with the optional ability to set where to move the party after the new map is loaded 56 Transfer An alias of <code>warp</code> 162 Loadmap Reload the current Map or load another one"},{"location":"SetText/Commands/#char-loop-control","title":"Char loop control","text":"ID Name Summary Notes 210 Ignorenext Signal SetText to not process the next n commands where n is configurable UNUSED"},{"location":"SetText/Commands/#miscellaneous","title":"Miscellaneous","text":"ID Name Summary Notes 126 Destroydescbox Destroy the caller's description window if it exist no matter what or only do it if the caller's interaction type isn't Shop or CaravanBadge 136 Librarybook Signal the game that a Lore Book has been acquired and refresh the LibraryShelf 149 Switch Toggle or set the hit field of an Entity's NPCControl (this is meant to toggle or set the state of an Entity of type switch)"},{"location":"SetText/Commands/#not-referenced","title":"Not referenced","text":"ID Name Summary Notes 3 <code>Checkitem</code> N/A NOT REFERENCED 5 <code>Getitem</code> N/A NOT REFERENCED 22 <code>Buffer</code> N/A NOT REFERENCED 63 <code>LeafIn</code> N/A NOT REFERENCED 64 <code>LeafOut</code> N/A NOT REFERENCED 81 <code>Openboard</code> N/A NOT REFERENCED 134 <code>Librarybreak</code> N/A (This is processed by PauseMenu) NOT REFERENCED 207 <code>Name</code> N/A NOT REFERENCED"},{"location":"SetText/Dialogue%20mode/","title":"Dialogue mode","text":"<p>SetText has 2 main mode of operation: dialogue mode and non dialogue mode. The flag to use dialogue mode or not is sent as a parameter from the SetText Entry Points. </p>"},{"location":"SetText/Dialogue%20mode/#non-dialogue-mode","title":"Non dialogue mode","text":"<p>This mode restrict accesses to features dialogue mode would have and is in general a simpler mode of operation. The only notable exclusive behavior it has is in the Setup phase, a |spd,0| is prepended to the input string which forces wait times to be disabled. Other than that, many commands becomes not usable in non dialogue mode.</p> <p>One big advantage of non dialogue mode is it allows multiple SetText calls to execute at the same time and it supports recursion. This means that any SetText calls (even in dialogue mode) can itself calls SetText in non dialogue mode however it wants. Since non dialogue mode doesn't have accesses to the features dialogue mode offers, it prevents conflicts with the MainManager fields that dialogue mode uses. Additionally, this means any caller can call SetText in non dialogue mode however many times is needed.</p> <p>Generally, this mode is recommended for UI text because it greatly simplify the processing and in UI, most of the feature given by dialogue mode gets in the way as well as the inability to be called multiple times at once.</p>"},{"location":"SetText/Dialogue%20mode/#dialogue-mode_1","title":"Dialogue mode","text":"<p>Dialogue mode is a superset of non dialogue mode. It allows access to every features such as Text advance, Backtracking, Prompt, Pickitem, auto bleep on every letter and in general, anything that the game needs to do to present cutscenes. It also allows to control a textbox with the tailtarget set to the <code>parent</code> parameter and it gives access to the full set of commands features.</p> <p>To accomplish this, dialogue mode has additional phases in the SetText Life Cycle:</p> <ul> <li>Dialogue setup</li> <li>Dialogue pre-processing</li> <li>Dialogue post-processing</li> <li>Dialogue Cleanup</li> </ul> <p>A huge disadvantage of this mode is it is not possible to have 2 SetText calls in dialogue mode running at the same time. This not only prevents recursion, but it also means that any caller cannot calls SetText in dialogue mode more than once. Failure to respect this rule will cause undefined behaviors.</p> <p>Generally, anything that needs these features should operate in dialogue mode as long as that call can safely be the only one in this mode at a time. Only if none of these features are needed should non dialogue mode be used such as UI text.</p> <p>There is an exception to the one call at a time in dialogue mode rule: during the stall in Battle and Cardbattle. In these commands, the message lock gets released, then it will keep yielding until the battle is over. This is done because CardBattle and BattleControl may need to use dialogue mode. Since the caller is always yielding by this point, this is a safe exception to this rule because both calls should never execute at the same time still.</p>"},{"location":"SetText/Entry%20Points/","title":"SetText Entry Points","text":"<p>Calling SetText requires running a Coroutine called <code>SetText</code> that is static to MainManager. There are 4 overloads available, but all of them ends up at the (4) one.</p>"},{"location":"SetText/Entry%20Points/#signatures","title":"Signatures","text":"<p>(1)</p> <pre><code>public static IEnumerator SetText(string text, Vector3 position, Transform parent)\n</code></pre> <p>(2)</p> <pre><code>public static IEnumerator SetText(string text, Transform parent, NPCControl caller)\n</code></pre> <p>(3)</p> <pre><code>public static IEnumerator SetText(string text, bool dialogue, Vector3 position, Transform parent, NPCControl caller)\n</code></pre> <p>(4)</p> <pre><code>public static IEnumerator SetText(string text, int fonttype, float? linebreak, bool dialogue, bool tridimensional, Vector3 position, Vector3 cameraoffset, Vector2 size, Transform parent, NPCControl caller)\n</code></pre>"},{"location":"SetText/Entry%20Points/#parameters","title":"Parameters","text":""},{"location":"SetText/Entry%20Points/#text","title":"<code>text</code>","text":"<p>The starting input string to process. Must contains all the Commands inline. All CRLF (<code>\\r\\n</code>) are replaced by LF (<code>\\n</code>) to make the line endings consistent. A null value may act either as if it was an empty string or cause undefined behaviors.</p> <p>This may not be the only text that gets processed if the Commands in it replaces their text or if one of them perform a redirection which replaces the whole string.</p>"},{"location":"SetText/Entry%20Points/#fonttype","title":"<code>fonttype</code>","text":"<p>The starting font to use. This can be overridden by the Setup and Letter processing phases or the font command.</p>"},{"location":"SetText/Entry%20Points/#linebreak","title":"<code>linebreak</code>","text":"<p>The max width of a line enforced by OrganiseLines. If not null, the starting input string will be replaced by its OrganiseLines version as well as any redirected strings passing this parameter as the <code>maxoffset</code>. If it's null, this will not run OrganiseLines on the starting string or redirected strings.</p>"},{"location":"SetText/Entry%20Points/#dialogue","title":"<code>dialogue</code>","text":"<p>Tells SetText to operate in Dialogue mode. If false, an |spd,0| is prepended to the input string which will cause all wait times to be disabled by default. Refer to the Dialogue mode document for more information.</p>"},{"location":"SetText/Entry%20Points/#tridimensional","title":"<code>tridimensional</code>","text":"<p>Render the text using layer 0 (Default) instead of layer 5 (UI) which renders the text using the main camera instead of GUICamera. This is only supported in Regular Letter Rendering, this doesn't do anything meaningful in Single Letter Rendering.</p> <p>This is only used in narrow cases, for most cases, triui is a better option.</p>"},{"location":"SetText/Entry%20Points/#position","title":"<code>position</code>","text":"<p>Indicates the localPosition of the textholder. This is relative to the <code>parent</code> parameter in non dialogue mode and relative to the textbox in Dialogue mode which is positioned at 0.0, 3.25, 10.0 relative to the GUICamera. If this is effectively a zero vector, the localPosition of the textholder defaults to (-5.5, 0.9, 0.0).</p>"},{"location":"SetText/Entry%20Points/#cameraoffset","title":"<code>cameraoffset</code>","text":"<p>The vector to add to <code>camoffset</code> in Dialogue mode which offsets the camera's position. This is ignored  in non dialogue mode.</p>"},{"location":"SetText/Entry%20Points/#size","title":"<code>size</code>","text":"<p>The starting size scaling to apply to each letter from the start. This can be overridden with a size command.</p>"},{"location":"SetText/Entry%20Points/#parent","title":"<code>Parent</code>","text":"<p>The parent of the textholder in non dialogue mode. In Dialogue mode, this represents who is talking at the start and will have the tailtarget set to it. This can be overridden with a tail command.</p>"},{"location":"SetText/Entry%20Points/#caller","title":"<code>caller</code>","text":"<p>Represent who is the recipient of the dialogue in Dialogue mode at the start. This can be overridden with a parent command.</p>"},{"location":"SetText/Entry%20Points/#remarks","title":"Remarks","text":"<p>Every SetText call ends up at (4) with the other 3 being a simplified call to (4). Specifically:</p> <p>(1): starts (4) with</p> <pre><code>SetText(text, 0, null, false, false, position, Vector3.zero, Vector2.one, parent, null)\n</code></pre> <p>Then yields for a frame.</p> <p>(2): starts (4) with</p> <pre><code>SetText(text, 0, messagebreak, true, false, Vector3.zero, Vector3.zero, Vector2.one, parent, caller)\n</code></pre> <p>Then yields for a frame.</p> <p>(3): Sets <code>ll</code> to MainManger.messagebreak if MainManager.dialogue, <code>null</code> otherwise. Then, starts (4) with</p> <pre><code>SetText(text, 0, ll, dialogue, false, position, Vector3.zero, Vector2.one, parent, caller)\n</code></pre> <p>Then yields for a frame.</p> <p>(4): Does essentially all the work of the text processing. This is the main SetText coroutine.</p>"},{"location":"SetText/Life%20Cycle/","title":"SetText lifecycle","text":"<p>This will describe at a high level the full processing steps of SetText when the last entry point executes.</p>"},{"location":"SetText/Life%20Cycle/#setup","title":"Setup","text":"<p>This phase happens at the start of every call. It mainly initialises Commands specific temporary values and saves some fields that can change during the course of this call for restore later in the cleanup phase. It also perform universal initialization logic such as setting up defaults values.</p> <p>Here are the values saved for restoring them in cleanup:</p> <ul> <li>MainManager's <code>camoffset</code> This can be changed using the cameraoffset parameter in Dialogue mode or the camoffset command in any call, but the latter is only restored in dialogue cleanup in Dialogue mode.</li> <li>MainManager's <code>overridefollower</code>. This can changed using the overfollower command, but it is only restored in dialogue cleanup in Dialogue mode and the restore can be forced to true by using the Event command in syntax (1).</li> </ul> <p>The call starts with the current bleep sound volume set to the size's parameter's magnitude. </p> <p>The fonttype parameter is overridden in some languages if <code>BubblegumSans</code> was sent:</p> <ul> <li><code>Japanese</code>: <code>Uzura</code></li> <li><code>Korean</code>: <code>ONEMobilePOP</code></li> </ul> <p>Then, the textholder is initialized where its parent and position is set to their respective parameters. Finally, all line endings of the input string are normalized to LF if any were in CRLF and OrganiseLines is called if the linebreak parameter wasn't null.</p>"},{"location":"SetText/Life%20Cycle/#dialogue-setup","title":"Dialogue setup","text":"<p>This phase only occurs if we are in Dialogue mode, otherwise,  a |spd,0| is prepended to the input string which disables the wait times by default</p> <p>This phase is where all the initialization logic needed for Dialogue mode are done as well as some defaults values logic. The nature of this phase is why only a single Dialogue mode call can be running at a given time with the narrow exception of the battle and cardbattle commands during the yield. </p> <p>To enforce this and to setup some logic needed during the dialogue, this phase grabs/releases locks as well as interacts with entities:</p> <ul> <li>message lock is grabbed which is the main one that enforces one SetText call in Dialogue mode at a time. </li> <li><code>minipause</code> lock is also grabbed,</li> <li>waitinput lock is released here which resets it from a previous call.</li> <li><code>StopMovingEntities</code> is called on the map if it isn't null. This would pause most activities on the map while the dialogue is ongoing.</li> <li>The whole party and their followers's forcemove are stopped with the exception of the player and every party's entity's sprite is enabled except the lead.</li> <li>Make the player stop moving if it isn't null.</li> </ul> <p>This phase also sets some values as defaults:</p> <ul> <li>|size,0.8,0.9| gets prepended to the input string if languageid is <code>Japanese</code> (this doesn't affect OrganiseLines because it is disabled in that language)</li> <li>speed / spd: 0.02 or 0.03 in <code>Japanese</code></li> <li>The current Prompt, NumberPrompt and LetterPrompt's <code>promptpick</code> is reset to -1 which allows a fresh prompt to be used.</li> <li>The cameraoffset's parameter is added to the current <code>camoffset</code> if its magnitude is large enough (0.1).</li> <li>tailtarget: Set to the parent's parameter.</li> <li>bleep: The pitch and type are set from the parent's paremeter if it exists.</li> <li>textbox: It is initialized here with the default boxstyle with the ability to be hidden/shrunk and revealed/grown using <code>DialogueAnim</code>:<ul> <li>Parent: the GUICamera</li> <li>No angle and scale</li> <li>Position at (0.0, 3.25, 10.0)</li> </ul> </li> <li>textholder: Has different defaults than setup:<ul> <li>Parent: textbox</li> <li>No angles and scale</li> <li>Position at (-5.5, 0.9, 0.0) or the position parameter if its magnitude is large enough (0.1)</li> </ul> </li> <li>The MainManager's version of textbox: The textholder which allows global access.</li> <li><code>blinker</code>: Initialized here.</li> </ul> <p>Additionally, this phase includes some logic about the HUD: all of them are hidden except the berry count only if the caller's parameter isn't null, its <code>interacttype</code> is <code>Shop</code> or <code>CaravanBadge</code> and its <code>dialogues[1].y</code> isn't 1, but it is hidden otherwise</p> <p>Some special logic also happens if the player isn't null and we're not in an event:</p> <ul> <li>Make the player face the caller (or the caller's shopkeeper if its  <code>interacttype</code> is <code>Shop</code> or <code>CaravanBadge</code>)</li> <li>Set <code>initialflip</code> to the player's flip.</li> <li>Saves the player's rigid body's constraints to a temporary variable.</li> <li>if the caller's parameter isn't null, teleport following players and chompy closer to caller? (2.55 max distance, 1.5 away?). After, yield for a frame.</li> </ul> <p>Finally, this phase also does the following:</p> <ul> <li>Apply an <code>inputcooldown</code> of 10 frames.</li> <li>Setup the GlobalCommand system if the current map isn't null and supports it.</li> </ul> <p>Before going to the char loop, this will yield until the <code>switchcooldown</code> expires if there is one.</p>"},{"location":"SetText/Life%20Cycle/#char-loop","title":"Char loop","text":"<p>The char loop is the heart of SetText. It's a for loop on each char of the input string. It is not a linear loop however: Commands have the ability to not only reprocess the same index when the command's text is replaced and resume from there, but it is also possible to replace the entire input string and resume processing at the start of it. That action action is known as a redirect. It is up to the command to decide what to signal the char loop which will be taken into account on the next iteration.</p>"},{"location":"SetText/Life%20Cycle/#dialogue-preprocessing","title":"Dialogue preprocessing","text":"<p>This phase of the char loop only occurs in Dialogue mode. This is where the current horizontal size, the fonttype and the line break values are saved into MainManager's fields. This is needed by the backtracking system to add the OrganiseLines version of the current accumulator if we initiate a backtracking because OrganiseLines needs the values at the start of the char loop, not the ones once a next is yielding because they could have changed.</p> <p>if we are processing one of the first 10 characters, the player isn't null and we are not in an event, sets the player's entity's <code>flip</code> to its initial value that was set during the dialogue setup or the last align command (TODO: why the first 10?)</p>"},{"location":"SetText/Life%20Cycle/#lf-processing","title":"LF processing","text":"<p>This phase of the loop happens if the current char is a <code>\\n</code>. </p> <p>The current offset will be reset to 0.0 (the start of the line) and the current line to 0.7 * the vertical size's value (On <code>Japanese</code>, this is also multiplied by 1.25).</p>"},{"location":"SetText/Life%20Cycle/#vertical-bar-processing","title":"Vertical bar processing","text":"<p>This phase of the loop happens if the current char is a <code>|</code> which is the delimiter for a Commands. The command is first parsed into 2 parts: its enum value (case insensitive) and its syntax string (which includes both <code>|</code>, the command's name and all its parameters split by <code>,</code>). The command text is then accumulated to the backtracking system if the command supports it.</p> <p>Not all commands will be processed. Notably, if ignorenext is active, the command will be ignored. Same goes for testdiag which restricts commands processing to only work in Dialogue mode and to commands that it supports. For the actual command's processing, check the Commands documentation to learn more about each of them.</p> <p>After the command has been processed (or ignored), this is where the next position of the char loop is managed. Normally, it increments, but if the command changes it or wish to resume at the same position, it will not be incremented.</p>"},{"location":"SetText/Life%20Cycle/#space-processing","title":"Space processing","text":"<p>This phase of the loop happens if the current char is a . The space is accumulated in the backtracking system as well as in the current letter slot if we are using Single Letter Rendering. The current offset is incremented by 0.3 * the horizontal size's value which will essentially the next letter with a physical gap in Regular Letter Rendering. Finally, <code>written</code> is incremented ??? and the tailtarget is set to be talking if we were in Dialogue mode.</p>"},{"location":"SetText/Life%20Cycle/#letter-processing","title":"Letter processing","text":"<p>This phase of the loop occurs for everything else that isn't a <code>\\n</code>, <code>|</code>, <code></code> or <code>\\r</code> (the last one isn't processed in general). This is where the letter gets rendered as well as some additional logic.</p> <p>The first thing it does is if we had speed set to 0 (instant text scrolling) in Dialogue mode, am <code>inputcooldown</code> of 5 frames is applied. This enforces a wait of at least 5 frames before the next waitinput can be passed even if the scrolling speed is instant.</p> <p>Next, the fonttype is overridden again when in Dialogue mode and not in a NumberPrompt using a similar logic than the setup phase and the languageid, but this time, this will take into consideration the font locking feature of the font command. If the lock was enabled, this will not do the override:</p> <ul> <li><code>Japanese</code> and the letter being processed character is Japanese: <code>Uzura</code></li> <li><code>Korean</code> and the letter being processed character is Korean: <code>ONEMobilePOP</code></li> </ul> <p>From there, the rendering of the letter occurs. There are 2 rendering methods and it depends on the current state of single. Each method is documented in its own page:</p> <ul> <li>If not using single rendering<ul> <li>Render the letter using Regular Letter Rendering</li> </ul> </li> <li>If we are using single rendering<ul> <li>Render the letter using Single Letter Rendering</li> </ul> </li> </ul> <p>After the render is done, if a backbox was processed, the position of the backbox is set to (current offset / 2.0, size.y / 2.0 + 0.1, -5.0) and its scale to (current offset / 5.0 * size.x, size.y * 1.5, 1.0)</p>"},{"location":"SetText/Life%20Cycle/#dialogue-post-processing","title":"Dialogue post-processing","text":"<p>This phase of the loop only occurs in Dialogue mode. It mainly includes special handling logic which mostly takes effect after specific commands as well as interact with with the tailtarget:</p> <ul> <li>Sets the tailtarget to no longer be talking</li> <li>As long as we are in a Prompt, NumberPrompt, LetterPrompt or ItemList yield a frame (this waits it goes inactive)</li> </ul> <p>From there, there are 2 special handlers that run when applicalble: prompt handling and Pickitem handling, but no matter which one is ran, the following happens after:</p> <ul> <li>Sets the tailtarget to be talking again.</li> <li>Reset ItemList's <code>inlist</code> to false.</li> <li>If the player isn't null, sets its NPC to a new list</li> </ul>"},{"location":"SetText/Life%20Cycle/#prompt-handling","title":"Prompt handling","text":"<p>The prompt handler is run if the <code>promptpick</code> is higher than -1 with more than one <code>promptpointers</code> which only happens after the prompt, whatever its type, just went inactive, but still needs to be handled:</p> <ul> <li>if it was a LetterPrompt (usingflagvar 0 being -555 as a check), set the textbox to unhide itself.</li> <li>Perform a redirection where the input string is the selected prompt's choice's text prepended with |blank|.</li> <li>OrganiseLines the input string appended with the questprompt string if applicable.</li> <li>Sets the <code>promptbox</code> to hide itself and be destroyed in 0.5 seconds</li> <li>Reset the <code>promptpick</code> to -1</li> <li>Signal SetText to resume processing at the start of the new input string.</li> <li>yield a frame</li> </ul>"},{"location":"SetText/Life%20Cycle/#itemlist-handling","title":"ItemList handling","text":"<p>For the ItemList handler, it only runs if <code>inlist</code> is true and <code>listredirect</code> isn't null or -1 which normally happens when the ItemList of a pickitem command goes inactive, but still needs to be handled. Beware that this <code>inlist</code> value isn't guaranteed to be correct, see inlist issue for more details.</p>"},{"location":"SetText/Life%20Cycle/#normal-sub-handler","title":"Normal sub-handler","text":"<p>This sub-handler happens if <code>listredirect</code> isn't -2 or -3 (either gets handled by the other sub handler). It performs a redirect using an OrganiseLines version of the dialogue line where the Dialogue line id is <code>listredirect</code> prepanded with a |blank|. From there, processing resumes at the start of this new input string.</p>"},{"location":"SetText/Life%20Cycle/#additemtoss-special-sub-handler","title":"additemtoss Special sub-handler","text":"<p>There is a special case if <code>listredirect</code> is -2 or -3 which should only happens through the pickitem that comes from a toss prompt from an additemtoss command. For these 2 values, the handler is the following (for context, by this point, the caller should be an Items, flagvar 1 is the selected item if applicable and flagvar 0 is the tossed item):</p> <ul> <li>On the caller, enable its gravity and its ccol, freeze all rotations on is rigid, set its bounces to 0 and child it to the current map.</li> <li>Start a LateVelocity (velocity applied after a frame) to RandomItemBounce(6.0, 12.0). This will make the item toss in a random direction.</li> <li>Destroys the first child of the caller's entity's sprite</li> <li>Force unfix the caller's entity, apply a touchcooldown on it of 70 frames, set its <code>tossed</code> to true and is timer to 600 frames (which is the time it takes before the item disappears)</li> <li>If <code>listredirect</code> is -2 (The toss was confirmed to swap the item, -3 has this part omitted as it means the toss was cancelled which means to not swap the item)<ul> <li>Set the caller's entity's animstate, itemstate and basestate to flagvar 1 (this changes what the caller's item is to the swapped one)</li> <li>Remove the item from the inventory matching the <code>listtype</code> used whose id is in flagvar 1</li> <li>Add the item to the inventory matching the <code>listtype</code> used whose id is in flagvar 0</li> </ul> </li> <li>Set end to true</li> <li>Reset <code>listredirect</code> to null</li> <li>Apply an <code>actioncooldown</code> of 30 frames</li> <li>If <code>eventtoss</code> is above -1, set <code>eventcall</code> to it</li> </ul>"},{"location":"SetText/Life%20Cycle/#dialogue-cleanup","title":"Dialogue Cleanup","text":"<p>This phase only occurs if we are in Dialogue mode. It tries to mostly do the reverse of dialogue setup, but with some added logic.</p> <p>The first thing it will do is If we are using a transfer or a Warp command and the current caller isn't null, set the caller.interactcd to 15.0. After, it will set the tailtarget to stop talking if it isn't null and remove the Text advance's <code>skiptext</code>.</p> <p>After, it will grab the waitinput lock and yield until it goes to false. One exception to this is if an end was processed since it serve as a bypass to this. In either case, the lock is released after as well as the message lock.</p> <p>From there, it's mostly cleaning up:</p> <ul> <li>Stops looping the bleep if it was playing and fade its sound to silence.</li> <li>Free all the letter slots of the textholder and destroy it.</li> <li>The <code>minipause</code> lock is released If event's <code>inevent</code> is false and we are not in an actual event.</li> <li>Restores the camoffset to its original value if it was changed in dialogue setup.</li> <li><code>overridefollower</code> is restored to its original value or to true if Event's <code>inevent</code> is true.</li> <li>If the textbox isn't null, hide it with a shrink animation and Destroys the textbox in 1 second.</li> </ul> <p>Special cleanup logic if the player isn't null and we aren't in an event:</p> <ul> <li>Restores the player rigid body constraints to its original value.</li> <li>Apply an <code>actioncooldown</code> of 20 frames</li> <li>Stops ignoring every collisions between the player's ccol and each entities that were ignored using any igcolmove commands.</li> </ul> <p>The last step of this phase is If we are not in an event and battle is null, call <code>EndOfMessage</code> which does some final logic:</p> <ul> <li>if flag 347 (start of ch6) is true, sets the corresponding badgeshop's all bought flags to true (from 587 to 588) if the corresponding shop has 0 medals in stock. NOTE: 589 corresponds to an unused medal shop.</li> <li>If flag 470 (Examined the view of Termite Capitol for the first time at the Forsaken Lands) is true and the Termite Kingdom discovery isn't unlocked, unlock it (TODO: recheck this and determine why?)</li> <li>if flag 351 (Talked to the person in front of the Termacade for the first time) is true and the Termacade  discovery isn't unlocked, unlock it. TODO: recheck this</li> <li>if flag 605 (Completed the Lost Books quest) is true and the Lost Book quests isn't in the completed array of boardQuests, complete it.</li> <li>if the map isn't null, sets map.<code>currentline</code> to -1</li> <li>Check the achievements completion.</li> </ul>"},{"location":"SetText/Life%20Cycle/#cleanup","title":"Cleanup","text":"<p>This phase happens at the end of every SetText call. This is where some cleanups logic are performed, but also some Commands that needs some processing done at the very end rather than during the char loop:</p> <ul> <li>If we are in a minibubble command's inner call, the minibubble is destroyed. </li> <li>A frame is yielded here.</li> <li>This is where the warp or transfer are started if applicable.</li> <li>Something with additemtoss ??? TODO: recheck this</li> <li>If this call had a showtokens command, the Game Token HUD element is destroyed.</li> <li>If for some reasons, there was a Game Token in key Items, it is removed there.</li> <li>If the caller was an Items object, it is destroyed there.</li> </ul> <p>Finally, flag 349 is set to false if ItemList's <code>inlist</code> (check inlist issue) is false and we weren't in a Prompt, NumberPrompt or LetterPrompt.</p>"},{"location":"SetText/Notable%20states/","title":"Notable states","text":"<p>SetText contains some key fields and local variables that are important to understand. They especially have to do with Dialogue mode. </p>"},{"location":"SetText/Notable%20states/#message","title":"message","text":"<p>A global flag on MainManager behaving like a lock that enforces the restriction that only one Dialogue mode call can execute at a given time. It is used to prevent behaviors to take place until its value is set to false. In Dialogue mode, this lock is set to true on Dialogue setup and released on Dialogue Cleanup.</p> <p>White it is possible to bypass it this restriction by ignoring the value of message, doing so has undefined behaviors.</p>"},{"location":"SetText/Notable%20states/#waitinput","title":"waitinput","text":"<p>A global flag on MainManager that acts as a lock to wait for a confirmation input (confirm or cancel). This is used with the Text advance system in Dialogue mode by yielding during Dialogue post-processing.</p>"},{"location":"SetText/Notable%20states/#tailtarget","title":"tailtarget","text":"<p>The entity pointed by the textbox. This is meant to show who is talking. This can be overridden by tail.</p>"},{"location":"SetText/Notable%20states/#textbox","title":"textbox","text":"<p>The box that holds the text in Dialogue mode. This contains the textholder. It can be hidden with a shrink animation or revealed with a grow animation.</p>"},{"location":"SetText/Notable%20states/#textholder","title":"textholder","text":"<p>The GameObject that holds all the TextMesh SetText renders. Its parent is set to the <code>parent</code> parameter with a local position of the <code>position</code> parameter. Its localEulerAngles is set to zero if the <code>tridimensional</code> parameter is false and its scales is set to Vector3.one. Its name will be <code>Text:</code> followed by the input string and its tag will be set to <code>Text</code>.</p>"},{"location":"SetText/Notable%20states/#fonttype","title":"fonttype","text":"<p>This is a parameter sent to SetText that determines the font to render.</p>"},{"location":"SetText/Notable%20states/#font-id-table","title":"Font id table","text":"Name ID <code>BubblegumSans</code> 0 <code>D3Streetism</code> 1 UNUSED (gets overriden to <code>D3Streetism</code> by MainManager.FontID) 2 <code>Uzura</code> 3 <code>BalsamiqSans</code> 4 <code>ONEMobilePOP</code> 5"},{"location":"SetText/SetText/","title":"SetText","text":"<p>SetText is Bug Fables's text management system. It is a combination of a text renderer, a script processor and a dialogue management system. Its name comes from the name given to its main entry point which is a static Coroutine defined in MainManager.</p> <p>Its main features are:</p> <ul> <li>Serve as the only organised method in the game to render any textual information on screen using the different fonttype available.</li> <li>Supports 2 distinct modes of operation: Dialogue mode or non dialogue mode. The later is a stripped version of the former that offers the advantage of not having any limits on the amount of calls running at a given time which is ideal for UI texts.</li> <li>Supports 217 different Commands offering a wide variety of features ranging from FontEffects and rendering to a simplified form of a turing complete scripting system.</li> <li>Provides the different facilities needed to manage dialogues between entities such as a Text advance system, a Backtracking system and the management of a textbox that can optionally point to its speaker using the tailtarget.</li> <li>Include an automatic line breaker called OrganiseLines (with some caveats, see OrganiseLines Known Issues).</li> </ul> <p>For a more detailed understanding of the inner workings, see SetText Life Cycle and for using it, see SetText Entry Points and Commands.</p>"},{"location":"SetText/languageid/","title":"languageid","text":"<p>MainManager.languageid represents the current language's ID. Bug Fables is playable in 6 languages as of 1.1.2. A language is represented by a number which is also the suffix number to identify its dialogue folder. This influences the logic of SetText and OrganiseLines.</p>"},{"location":"SetText/languageid/#language-id-table","title":"Language ID table","text":"Name ID <code>English</code> 0 <code>Spanish</code> 1 <code>Portuguese</code> 2 <code>Japanese</code> 3 <code>German</code> 4 <code>Korean</code> 5"},{"location":"SetText/languageid/#definition-of-a-languageid","title":"Definition of a languageid","text":"<p>Here are the components that defines a language:</p> <ul> <li>A name hardcoded in the <code>languagenames</code> array whose index is the languageid</li> <li>Its own directory in <code>Ressources/data</code> <code>dialogue</code> followed by the languageid. It contains language specific data notably Dialogue data, names/descriptions of many different elements and others which are detailed further in the TextAsset folder of this documention</li> <li>Several logic changes in SetText and UI rendering (this is checked using the languageid directly) such as OrganiseLines</li> </ul> <p>The languageid is saved in the config file and the game will prompt for one if it isn't set, but it defaults to English on first boot. It can only be changed using the language selection screen which has its own listtype called Languages list Type.</p>"},{"location":"SetText/Common%20commands%20id%20schemes/Dialogue%20line%20id/","title":"Dialogue line ID","text":"<p>SetText commands often uses the same format for specifying a dialogue line id from the current map or from CommonDialogue which is an int value.</p>"},{"location":"SetText/Common%20commands%20id%20schemes/Dialogue%20line%20id/#current-map-line-id","title":"Current map line id","text":"<p>Any value &gt;= 0 is considered a current map line id. This means that it will check the current map, resolve its enum value name and pick the file of the same name inside the <code>maps</code> folder of the current language's dialogue folder. The value directly corresponds to a line index starting from 0. If no such line exists, an exception will be thrown.</p>"},{"location":"SetText/Common%20commands%20id%20schemes/Dialogue%20line%20id/#commondialogue-line-id","title":"CommonDialogue line id","text":"<p>To refer to a CommonDialogue line id instead of a current map line id, the value must be specified in the form <code>-id - 1</code>. Any value below 0 will be interpreted as a CommonDialogue line id with the id being the absolute version of the value - 1. For example, -1 refers to CommonDialogue line 0. The file is always the one named <code>CommonDialogue</code> located at the root of the current language's dialogue folder. If no such line exists, an exception will be thrown.</p>"},{"location":"SetText/Common%20commands%20id%20schemes/Dialogue%20line%20id/#what-about-menutext","title":"What about MenuText?","text":"<p>This format does not cover MenuText. To use menu text, it must be done by code, using a menu or prompt command which supports specifying one.</p>"},{"location":"SetText/Common%20commands%20id%20schemes/Entity%20id/","title":"Entity ID","text":"<p>An entity id is an int value sent to the GetEntity method in MainManager which is used often when parsing SetText parameters. This page explains how this format works. Please note it only concerns the int form as most Commands supports this form, but not all of them supports other designator such as define, refer to each Commands documentation to learn more.</p>"},{"location":"SetText/Common%20commands%20id%20schemes/Entity%20id/#when-not-in-battle","title":"When not in battle","text":"<p>An entity index is one of the following when not in battle:</p> <ul> <li>&gt;= 1000: Refers to a temporary non party follower whose index is the index - 1000. If no such follower exist at that index, an exception will be thrown.</li> <li>-1: Refers to the first player's entity if it exist, otherwise, this is null.</li> <li>-2: Refers to the second player's entity if it exist, otherwise,  this is null.</li> <li>-3: Refers to the third player's entity if it exist, otherwise,  this is null.</li> <li>-4: Refers to Vi's player entity if it exist, otherwise,  this is null.</li> <li>-5: Refers to Kabbu's player entity if it exist, otherwise,  this is null.</li> <li>-6: Refers to Leif's player entity if it exist, otherwise,  this is null.</li> <li>Any negative value below -6: This is null.</li> <li>Other positive values: Refers to the entity in the current map at the index corresponding to the value. If no such entity exists at the index, this is null.</li> </ul>"},{"location":"SetText/Common%20commands%20id%20schemes/Entity%20id/#when-in-battle","title":"When in battle","text":"<p>When in battle, the entity index is one of the following:</p> <ul> <li>If it is between 0 and the amount of player entities in the party - 1, it refers to the corresponding battle player entity at the index of playerdata (this will throw an exception if no player data exists at that index).</li> <li>If it is equal or above the amount of player entities in the party, it refers to the enemy battle entity at index - amount of player entities in the party (this will throw an exception if no such enemy data exists at that index).</li> <li>Otherwise, the index refers to a battle's extra entity at the absolute value of the index + 1. This is null if no extra battle entities exists (this will throw an exception if there are extra entities, but none exist at the index).</li> </ul>"},{"location":"SetText/Individual%20commands/Activateselectedquest/","title":"Activateselectedquest","text":"<p>Mark a specific BoardQuest or the one whose id is in flagvar 0 as taken which removes it from the open board and adds it to the taken board.</p>"},{"location":"SetText/Individual%20commands/Activateselectedquest/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|activateselectedquest|\n</code></pre> <p>(2)</p> <pre><code>|activateselectedquest,quest|\n</code></pre>"},{"location":"SetText/Individual%20commands/Activateselectedquest/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Activateselectedquest/#quest-int-vint-varint-money","title":"<code>quest</code>: int | <code>v</code>int | <code>var</code>int | <code>money</code>","text":"<p>The BoardQuest id to mark as taken. The int form specifies the id directly while either string forms specifies the flagvar slot used to get the id. The int form must be a valid BoardQuest or an exception will be thrown. </p> <p>Either string forms are equivalent, but they must contain <code>v</code> or <code>var</code> once or they will be interpreted as the int form which will cause an exception to be thrown. Additionally, the value inside of them must be a valid flagvar slot or an exception will be thrown. Finally, that flagvar slot must also contain a valid BoardQuest id or an exception will be thrown.</p> <p>Specifying <code>money</code> is technically possible, but is not recommended because it will interpret the current berry count as a BoardQuest id which will likely result in an exception being thrown.</p>"},{"location":"SetText/Individual%20commands/Activateselectedquest/#remarks","title":"Remarks","text":"<p>Syntax (1) is meant to be used in conjunction with the Quest Board List Type because flagvar 0 is where the selected BoardQuests is located upon confirmation. For more details, check Quest Board List Type &gt; Confirmation handling. This syntax is actually sent by SetText itself when a questprompt is confirmed as part of the normal quest prompting process.</p> <p>This command also makes sure that the open board has the <code>NoQuest</code> element if there are no more open quests after the transfer.</p> <p>This also changes some flags:</p> <ul> <li>The taken flag slot of the BoardQuest from boardquestdata is set to true if it exists (-1 denotes that)</li> <li>flagstring 11 is set to all open BoardQuests id after the transfer separated by <code>,</code></li> <li>flags 2 is set to true</li> </ul>"},{"location":"SetText/Individual%20commands/Addboard/","title":"Addboard","text":"<p>Add a BoardQuest to the open board.</p>"},{"location":"SetText/Individual%20commands/Addboard/#syntax","title":"Syntax","text":"<pre><code>|addboard,quest|\n</code></pre>"},{"location":"SetText/Individual%20commands/Addboard/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Addboard/#quest-int-string","title":"<code>quest</code>: int | string","text":"<p>The BoardQuest id or its enum value's string representation to add to the open board. The int form must be a valid BoardQuest and the string form must be a value BoardQuest enum value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Addboard/#remarks","title":"Remarks","text":"<p>This command is unused under normal gameplay, but remains functional.</p>"},{"location":"SetText/Individual%20commands/Addfollower/","title":"Addfollower","text":"<p>Add the caller as a follower to a new entity or add a new one via an AnimID or a flagvar slot containing it.</p>"},{"location":"SetText/Individual%20commands/Addfollower/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|addfollower,this|\n</code></pre> <p>(2)</p> <pre><code>|addfollower,this,true|\n</code></pre> <p>(3)</p> <pre><code>|addfollower,follower|\n</code></pre> <p>(4)</p> <pre><code>|addfollower,var,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Addfollower/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Addfollower/#follower-int","title":"<code>follower</code>: int","text":"<p>The follower's AnimID to add. This must be a valid AnimID or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Addfollower/#var","title":"<code>var</code>","text":"<p>The presence of this parameter indicates to operate in syntax (4). Any other value will be interpreted as <code>follower</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Addfollower/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot containing the follower's AnimID to add. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Addfollower/#this","title":"<code>this</code>","text":"<p>The presence of this parameter indicate to operate in syntax (1) or (2) which adds the caller to the follower by replacing its entity entry in the process. Any other value will be interpreted as <code>follower</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Addfollower/#true","title":"<code>true</code>","text":"<p>Indicate to operate in syntax (2) which, after the caller is added as follower, will shrink the textbox, start to move the party and followers into their regular formation and grow the textbox again. Any other value is the same as not sending the parameter which will not do these additional steps.</p>"},{"location":"SetText/Individual%20commands/Addfollower/#remarks","title":"Remarks","text":"<p>The way followers work is there are 3 lists/arrays involved:</p> <ul> <li><code>extrafollowers</code>: The list saved on the Save File that dictates which followers to consider following the last member of the party.</li> <li><code>map.canfollowID</code>: An array generated on a map's <code>Start</code> (specifically <code>AreaSpecific</code>) that acts as a whitelist to <code>extrafollowers</code>. This whitelist enforces who can follow the party on the first iteration of the map's <code>LateUpdate</code>. The TestRoom is however exempt from this.</li> <li><code>map.tempfollowers</code>: The list of non party followers currently following the party. This represents all the non party active followers.</li> </ul> <p>Adding a follower is done in 2 ways:</p> <ul> <li>Adding from an existing entity: This is what syntax (3) and (4) does. How it works is it destroys the caller's entity, but creates it back this time following the last member of the follower chain (in the order player, party members and existing <code>map.tempfollowers</code>). This also adds the follower to <code>extrafollowers</code> and <code>map.tempfollowers</code>. which makes the follower active immediately.</li> <li>Adding from AnimID: This is what syntax (1) and (2) does. All this do is add the AnimID to <code>extrafollowers</code>, but nothing else. This means the follower isn't going to be active until a map load is performed which implies the whitelisting of <code>map.canfollowID</code> needs to allow the follower. This is only used for troubleshooting purposes in the TestRoom.</li> </ul>"},{"location":"SetText/Individual%20commands/Additem/","title":"AddItem","text":"<p>Give an Item based on its id or a flagvar containing it or transfer all the items selected to or from the storage if the last ItemList had a multi selection.</p>"},{"location":"SetText/Individual%20commands/Additem/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|additem,itemtype,itemid|\n</code></pre> <p>(2)</p> <pre><code>|additem,itemtype,var,flagvar|\n</code></pre> <p>(3) (Not recommended, see remarks, only for transferring all multi selected items)</p> <pre><code>|additem|\n</code></pre>"},{"location":"SetText/Individual%20commands/Additem/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Additem/#itemtype-0-1-2","title":"<code>itemtype</code>: <code>0</code> | <code>1</code> | <code>2</code>","text":"<p>The inventory type this command should give the Item:</p> <ul> <li>0: Standard items.</li> <li>1: Key items. </li> <li>2: Storage items.</li> </ul> <p>Any other value will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Additem/#var","title":"<code>var</code>","text":"<p>This is just what determines how the Item id is obtained. Any other value will this parameter to be interpreted as the <code>itemid</code>.</p>"},{"location":"SetText/Individual%20commands/Additem/#itemid-int","title":"<code>itemid</code>: int","text":"<p>The Item id to attempt to give. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Additem/#flagvar-int","title":"<code>flagvar</code>:  int","text":"<p>The flagvar slot containing the item id. This must corresponds to a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Additem/#remarks","title":"Remarks","text":"<p>If the last ItemList was allowed to <code>multiselect</code> and a multi selection was performed, this overrides the behavior of this command to transfer to or from the storage depending on the listtype. Specifically, this will take all the selection from <code>multiselect</code>, remove them from the list it came from and add them to the other based on the listtype that tells which one is the source. Every parameters gets ignored so it behaves like syntax (3).</p> <p>Using syntax (3) directly is however not recommended. It can only work if <code>multiselect</code> was allowed and processed on the last ItemList. If it wasn't, this will throw an exception because there will be no check to determine that there are no parameters. It is best to send parameters in case no multi selection was performed.</p> <p>The other syntax forms adds an item, but unlike additemtoss, it will not check nor prompt for a toss. This means that it is possible to violate the constraint of having no more than the maximum amount of standard items or storage items by using this command. To check the quantity before giving the item, additemtoss or checkinvqtd are recommended, but it is always possible to manually perform this check in code.</p>"},{"location":"SetText/Individual%20commands/Additemtoss/","title":"AddItemToss","text":"<p>Give an Item or medal based on its id or a flagvar containing it. If it's an item and the item inventory is full, prompt to toss an item.</p>"},{"location":"SetText/Individual%20commands/Additemtoss/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|additemtoss,itemtype,itemid|\n</code></pre> <p>(2)</p> <pre><code>|additemtoss,itemtype,var,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Additemtoss/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Additemtoss/#itemtype-0-1-2","title":"<code>itemtype</code>: <code>0</code> | <code>1</code> | <code>2</code>","text":"<p>The inventory type this command should attempt to give the item:</p> <ul> <li>0: Standard items.</li> <li>1: Key items. </li> <li>2: Medals (it will be added as unequipped).</li> <li>3: This is ignored and no items will be added.</li> </ul> <p>Any other value will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Additemtoss/#var","title":"<code>var</code>","text":"<p>This is just what determines how the item id is obtained. Any other value will cause this parameter to be interpreted as the <code>itemid</code>.</p>"},{"location":"SetText/Individual%20commands/Additemtoss/#itemid-int","title":"<code>itemid</code>: int","text":"<p>The item or medal id to attempt to give. This must be a valid int value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Additemtoss/#flagvar-int","title":"<code>flagvar</code>:  int","text":"<p>The flagvar slot containing the item id. This must corresponds to an int of a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Additemtoss/#remarks","title":"Remarks","text":"<p>The toss prompt only happens if <code>itemtype</code> is 0 and the current standard item inventory is full. If we are into this situation, the caller will get some adjustments before displaying the prompt:</p> <ul> <li>Its <code>hit</code> is set to false.</li> <li>Its <code>descwindow</code> gets destroyed.</li> <li>eventtoss is set to its <code>data[1]</code> if it exists and is above -1 </li> </ul> <p>To display this prompt, the input string will be redirected to the toss prompt line from menu text 3 prepended with |blank||boxstyle,4||spd,0| and appended with |pickitem,0,1,true,false,-2,-3,5|. The blinker is then disabled and processing will resume at the start of the new input string. This pickitem will be handled differently than usual at Additemtoss Special sub-handler</p> <p>In the other case where the item can be given, it will be given immediately (if <code>itemtype</code> is 3, nothing will happen here). After, the caller's <code>descwindow</code> gets destroyed and finally, an end command is relayed.</p>"},{"location":"SetText/Individual%20commands/Addprize/","title":"Addprize","text":"<p>Mark a Caravan prize medal as available via its prize id.</p>"},{"location":"SetText/Individual%20commands/Addprize/#syntax","title":"Syntax","text":"<pre><code>|addprize,prizeid|\n</code></pre>"},{"location":"SetText/Individual%20commands/Addprize/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Addprize/#prizeid-int","title":"<code>prizeid</code>: int","text":"<p>The prize id to mark as available. This must be a valid prize id or an exception will be thrown. Since the prize arrays are hardcoded and there are 23 that exists in the game, a valid prize id is between 0 and 22.</p>"},{"location":"SetText/Individual%20commands/Addprize/#remarks","title":"Remarks","text":"<p>This also increments flagvar 55 (number of prize medals available or obtained).</p> <p>The actual availability depends on whether the Hard Mode medal is on or if flags 614 (HARDEST) is on. If either of them are, the flagvar corresponding to the prize is set to 1 (available through Artis). If neither are on, it will be set to 2 instead (available for purchase at the Caravan).</p>"},{"location":"SetText/Individual%20commands/Addquest/","title":"Addquest","text":"<p>Add a BoardQuest to the open board or move an existing BoardQuest to another board.</p>"},{"location":"SetText/Individual%20commands/Addquest/#syntax","title":"Syntax","text":"<p>(1) (Add the quest to the open board)</p> <pre><code>|addquest,quest|\n</code></pre> <p>(2)</p> <pre><code>|addquest,quest,newboard|\n</code></pre>"},{"location":"SetText/Individual%20commands/Addquest/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Addquest/#quest-int","title":"<code>quest</code>: int","text":"<p>The BoardQuest to add or move board. This must be a valid BoardQuest id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Addquest/#newboard-int","title":"<code>newboard</code>: int","text":"<p>The board to move the <code>quest</code> to. This must be 0 (open), 1 (taken) or 2 (completed) or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Addquest/#remarks","title":"Remarks","text":"<p>If syntax (2) is used with the <code>newboard</code> being taken or completed, this will also show the journal updated HUD.</p> <p>For all syntaxes, this handles the removal of NoQuest to the older board if applicable.</p>"},{"location":"SetText/Individual%20commands/Addstat/","title":"Addstat","text":"<p>Add a stat bonus by specifying its properties directly or by specifying flagvar slots containing them and optionally recalculate the party's stats after the removal.</p>"},{"location":"SetText/Individual%20commands/Addstat/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|addstat,type,amount,applyto|\n</code></pre> <p>(2)</p> <pre><code>|addstat,type,amount,applyto,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/Addstat/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Addstat/#type-int-varint-vint-money","title":"<code>type</code>: int | <code>var</code>int | <code>v</code>int | <code>money</code>","text":"<p>The stat bonus type to add to the stat bonuses list or the flagvar slot containing it. The int form must be a valid stat bonus type or an exception will be thrown. The flagvar string form must contain <code>var</code> or <code>v</code> only once with an integer portion corresponding to a valid flagvar slot or an exception will be thrown. </p> <p>The <code>money</code> value is allowed, but is not recommended because it will read the current berry count as a stat bonus type which is likely to cause an exception to be thrown.</p> <p>Here are the valid stat bonus type:</p> Value Stat increase 0 HP 1 Attack 2 Defense 3 TP 4 MP"},{"location":"SetText/Individual%20commands/Addstat/#amount-int-varint-vint-money","title":"<code>amount</code>: int | <code>var</code>int | <code>v</code>int | <code>money</code>","text":"<p>The stat bonus amount or the flagvar slot containing it. The int form must be a valid int or an exception will be thrown. The flagvar string form must contain <code>var</code> or <code>v</code> only once with an integer portion corresponding to a valid flagvar slot or an exception will be thrown. </p> <p>The <code>money</code> value is allowed, but is not recommended because it will read the current berry count as a stat bonus amount which is likely not desirable.</p>"},{"location":"SetText/Individual%20commands/Addstat/#applyto-int-varint-vint-money","title":"<code>applyto</code>: int | <code>var</code>int | <code>v</code>int | <code>money</code>","text":"<p>The AnimID of the recipient of the stat bonus or the flagvar slot containing it. The int form must be a valid AnimIDs or -1 or an exception will be thrown. The flagvar string form must contain <code>var</code> or <code>v</code> only once with an integer portion corresponding to a valid flagvar slot or an exception will be thrown. </p> <p>-1 means this stat bonus will apply to the entire party.</p> <p>The <code>money</code> value is allowed, but is not recommended because it will read the current berry count as the recipient which is likely not desirable.</p>"},{"location":"SetText/Individual%20commands/Addstat/#true","title":"<code>true</code>","text":"<p>This parameter indicates to operate in syntax (2) which will also recalculate the party's stats after the stat bonus removal has been done. Any other value is ignored and will cause the command to operate in syntax (1).</p>"},{"location":"SetText/Individual%20commands/Addstat/#remarks","title":"Remarks","text":"<p>For more information about how stat bonuses work and how they are saved on the Save File, check Save File &gt; Line 10 (Array line) Stats bonuses.</p> <p>Syntax (2) is recommended over syntax (1) because it allows the addition of the stat bonux to take immediate effect while syntax (1) will need to wait the next recalculation to take this into effect.</p> <p>This command is only used for testing purposes in the TestRoom.</p>"},{"location":"SetText/Individual%20commands/Addvar/","title":"Addvar","text":"<p>Perform an arithmetic operation on a flagvar slot using a value as the other operand where the value is directly specified, corresponds to the current amount of berries or contained in another flagvar slot.</p>"},{"location":"SetText/Individual%20commands/Addvar/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|addvar,flagvar,value|\n</code></pre> <p>(2)</p> <pre><code>|addvar,flagvar,value,operation|\n</code></pre>"},{"location":"SetText/Individual%20commands/Addvar/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Addvar/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot to set its value. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Addvar/#value-int-varint-vint-money","title":"<code>value</code>: int | <code>var</code>int | <code>v</code>int | <code>money</code>","text":"<p>The value to set <code>flagvar</code> flagvar slot to. The int form must be a valid int or an exception will be thrown. The flagvar string form must contain <code>var</code> or <code>v</code> only once with an integer portion corresponding to a valid flagvar slot or an exception will be thrown. The <code>money</code> value corresponds to the current amount of berries.</p>"},{"location":"SetText/Individual%20commands/Addvar/#operation-","title":"<code>operation</code>: <code>-</code> | <code>*</code> | <code>/</code>","text":"<p>The operation to perform between the <code>flagvar</code> slot and the resolved value. <code>-</code> is equivalent to do <code>flagvar</code> = <code>flagvar</code> + value * -1, <code>*</code> is equivalent to do <code>flagvar</code> = <code>flagvar</code> * value and <code>/</code> is equivalent to do <code>flagvar</code> = <code>flagvar</code> / value (this is an integer division which means any decimal part is truncated and it act as a floor). The default is to perform an addition or <code>flagvar</code> = <code>flagvar</code> + value. Any other value will be ignored and an addition will be performed instead.</p>"},{"location":"SetText/Individual%20commands/Addvar/#remarks","title":"Remarks","text":"<p>This is essentially a more flexible version of syntax (2) and (3) of setvar, but other than that, functionality is very similar. The main benefit of using this command over setvar is it allows multiplication and integer division as well as the value being the current berries amount. setvar or copyvar should still be used to set a flagvar to a specific value however.</p>"},{"location":"SetText/Individual%20commands/Align/","title":"Align","text":"<p>Move the party and Chompy's Entity if present to be aligned in a row to the right or left of the caller via a forcemove.</p>"},{"location":"SetText/Individual%20commands/Align/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|align,direction,hide|\n</code></pre> <p>(2)</p> <pre><code>|align,direction,hide,offsetorflipback|\n</code></pre>"},{"location":"SetText/Individual%20commands/Align/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Align/#direction-left-near-front","title":"<code>direction</code>: <code>left</code> | <code>near</code> | <code>front</code>","text":"<p>The logic to use to determine whether to move the party to the right or left of the caller. Any other value will cause the party to move to the right.</p> <p>Here are the logic of the different values:</p> <ul> <li><code>left</code>: Will always move to the left.</li> <li><code>near</code>: Moves to the relative position of the party and the caller from the camera's viewpoint. If the party is horizontally positioned on the left side of the caller, they will move to the left of them. If the party is on the same horizontal position or positioned on the right side of the caller, they will move to the right of them.</li> <li><code>front</code>: Moves towards the direction the caller's sprite is looking (more specifically, it depends if the caller's sprite is flipped or not). </li> </ul>"},{"location":"SetText/Individual%20commands/Align/#hide-true-var","title":"<code>hide</code>: <code>true</code> | var","text":"<p>Whether to toggle the shrink/reveal animation of the textbox if it exists in Dialogue mode. Any other value than <code>true</code> will indicate to not do so while <code>true</code> indicates to do it. If the textbox does not exist, this parameter does nothing.</p>"},{"location":"SetText/Individual%20commands/Align/#offsetorflipback-float-true-false","title":"<code>offsetorflipback</code>: float | <code>true</code> | <code>false</code>","text":"<p>Set how far the entities should be from the caller (offset) or set whether or not the caller will face towards the party after the alignement is complete (flipback). Any other value will be interpreted as the bool form and cause an exception to be thrown. It is not possible to specify both settings at once: only one can be specified at a time. The default value for the offset is the radius of the caller's ccol * 3.0 + 0.1 and the default value for flipback is <code>false</code>.</p> <p>The float form can only be used if the first char of the value is between <code>0</code> and <code>9</code> which means negative float are not supported and will be interpreted as the bool form which will cause an exception to be thrown. Likewise, the value as a whole needs to be a valid float or an exception will be thrown.</p> <p>The bool form must be <code>true</code> or <code>false</code> otherwise, an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Align/#remarks","title":"Remarks","text":"<p>This command does nothing if the caller is null.</p>"},{"location":"SetText/Individual%20commands/Align/#setup","title":"Setup","text":"<p>First, the <code>overridefollower</code> flag is set to true while making sure to save its old value for restoring it later. The same is done for Chompy's <code>following</code> target if she is present. The followers are then teleported 2.5 away from the player. The command then gathers all the parameters and disables the caller's pusher collider.</p>"},{"location":"SetText/Individual%20commands/Align/#partys-forcemove","title":"Party's forcemove","text":"<p>Then, the player entities are setup for the forcemove. Their <code>forcejump</code> are set to true except for the lead and <code>backsprite</code> to false. The forcemove is then setup so that each player entity will move at the desired position determined via <code>direction</code> (multiplied by the offset) * 1.3 * index  where the index is the order of the player entities starting from 0 and offset is the float form of <code>offsetorflipback</code> or its default value. This essentially will move the party so they are 1.3 apart at the position which is the <code>direction</code> combined with the offset. This is all done without speed multiplier or consideration of the y position. The animstate during the move are the default Walk and Idle when done. After the move, the player entities will face towards the caller. Finally, the collisions between the <code>ccol</code> of the player entities with the <code>ccol</code> of the caller are disabled.</p>"},{"location":"SetText/Individual%20commands/Align/#chompys-forcemove","title":"Chompy's forcemove","text":"<p>For Chompy's forcemove (if she is present), this works a bit differently. She is set to follow the player entity furthest away from the lead at the direction determined with <code>direction</code> (multiplied by the offset) * 0.95 towards the front of the camera * \u22120.45 (which means she will be slightly to the front compared to the party). Other than that, everything is the same (except chompy has no backsprite so this field isn't set).</p> <p>After everyone's forcemove is setup, this is where the textbox's hide/reveal animation is toggled if <code>hide</code> was true. </p>"},{"location":"SetText/Individual%20commands/Align/#monitoring-the-partys-forcemove","title":"Monitoring the party's forcemove","text":"<p>After, the command will monitor when the party stops moving. Every frame where the move is still ongoing, every player entity's <code>backsprite</code> is set to false, every entity whose forcemove is complete will be set to face the caller and a frame is yielded. There is also an additional failsafe that can trigger here: If it's been more than 300 frames that the forcemove is ongoing, the position of each player entities will be set to their target. This failsafe is an addition to the regular forcemove one described in the move command. The lowest timeout will be used in practice.</p>"},{"location":"SetText/Individual%20commands/Align/#monitoring-the-chompys-forcemove","title":"Monitoring the Chompy's forcemove","text":"<p>Once the player entities moves are complete, If Chompy is present and is still moving, the command will yield until she isn't. The failsafe however still applies here and the framecount is cumulated meaning if the party's move have triggered the failsafe, it will be immediately triggered for Chompy as well. It also means that Chompy can trigger it alone even if the party does not trigger it. Once done, her ccol collision with the caller's are enabled back, she will be facing the caller and her anim state reset to Idle.</p>"},{"location":"SetText/Individual%20commands/Align/#cleanups","title":"Cleanups","text":"<p>After everyone is done moving, the shrink animation of the textbox is toggled back to where it was if <code>hide</code> was true. </p> <p>The player entities's <code>ccol</code> are enabled back, their <code>backsprite</code> are set to false again and they are set to face the caller for the last time. The caller's pusher collider is enabled back and <code>overridefollower</code> is restored to its original value.</p> <p>Finally, skiptext from Text advance is set to false and the flipback is performed if <code>offsetorflipback</code> was true by having the caller face towards the player. Chompy's following target is restored to its older value if she is present and initialflip is set to the player's flip.</p>"},{"location":"SetText/Individual%20commands/Alwaysactive/","title":"Alwaysactive","text":"<p>Set the <code>alwaysactive</code> field of an Entity to a value.</p>"},{"location":"SetText/Individual%20commands/Alwaysactive/#syntax","title":"Syntax","text":"<pre><code>|alwaysactive,entity,value|\n</code></pre>"},{"location":"SetText/Individual%20commands/Alwaysactive/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Alwaysactive/#entity-int-string","title":"<code>entity</code>: int | string","text":"<p>The Entity that this command refers to. The int form is a regular Entity id and it must not resolve to null or an exception will be thrown. The string form can be one of the following when not in battle (if in battle, this is interpreted as an int which will cause an exception to be thrown):</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Alwaysactive/#value-true-false","title":"<code>value</code>: <code>true</code> | <code>false</code>","text":"<p>The value to set the <code>entity</code>'s <code>alwaysactive</code> field. This must be a valid bool or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Anim/","title":"Anim","text":"<p>Change the animstate of the party or a specific Entity.</p>"},{"location":"SetText/Individual%20commands/Anim/#syntax","title":"Syntax","text":"<pre><code>|anim,entity,anim|\n</code></pre>"},{"location":"SetText/Individual%20commands/Anim/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Anim/#entity-this-party-caller-parent-int","title":"<code>entity</code>:  <code>this</code> | <code>party</code> | <code>caller</code> | <code>parent</code> | int","text":"<p>The Entity to change the animation state:</p> <ul> <li><code>this</code>: Refers to tailtarget's entity (This only reliably works in Dialogue mode otherwise, it will take the last value of tailtarget which is potentially undefined behavior).</li> <li><code>party</code>: Refers to each of the party's entities.</li> <li><code>caller</code>: Refers to the caller if it is not null. If it is, this command does nothing.</li> <li><code>parent</code>: This value is not fully implemented and will cause this command to do nothing, but it was intended to refer to the parent's entity.</li> <li>int: Refers to an Entity id.</li> </ul> <p>Any non int value that isn't in one of the predefined values above will cause an exception to be thrown.</p> <p>Any other value is treated like a regular Entity id. If it resolves null, no changes will happen.</p>"},{"location":"SetText/Individual%20commands/Anim/#anim-string-int","title":"<code>anim</code>: string | int","text":"<p>The animation state to set. The string form must be a animstate &gt; Standard animation clips base name. Any non int value that isn't on this list will be interpreted as an int which will cause an exception to be thrown. Any int value is valid.</p>"},{"location":"SetText/Individual%20commands/Anim/#remarks","title":"Remarks","text":"<p>This command does nothing when the PauseMenu is up. Otherwise, after the change has been performed (or if the entity was resolved to null) It will yield for a frame.</p>"},{"location":"SetText/Individual%20commands/Anstring/","title":"Anstring","text":"<p>Replaces the text from this command to a medal or item's prepender string from the game data.</p>"},{"location":"SetText/Individual%20commands/Anstring/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|anstring,item|\n</code></pre> <p>(2)</p> <pre><code>|anstring,medal,ismedal|\n</code></pre>"},{"location":"SetText/Individual%20commands/Anstring/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Anstring/#item-int-varint","title":"<code>item</code>: int | <code>var</code>int","text":"<p>The Item to obtain the prepend string from. The int form must be a valid Items id or an exception will be thrown. The <code>var</code>int form must have an int portion be a valid flagvar slot containing a valid Item is or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Anstring/#medal-int-varint","title":"<code>medal</code>: int | <code>var</code>int","text":"<p>The Medal to obtain the prepend string from. The int form must be a valid Medal id or an exception will be thrown. The <code>var</code>int form must have an int portion be a valid flagvar slot containing a valid Medal is or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Anstring/#ismedal-int","title":"<code>ismedal</code>: int","text":"<p>When a non zero value is specified, syntax (2) is used. If the value is 0 or not specified, syntax (1) is used. This must corresponds to a valid int value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Anstring/#remarks","title":"Remarks","text":"<p>This command will cause SetText to resume processing at the same character position to accommodate the text replacement of the input string at the position this command is being processed.</p>"},{"location":"SetText/Individual%20commands/Area/","title":"Area","text":"<p>Replace the text of this command by the current Area's name.</p>"},{"location":"SetText/Individual%20commands/Area/#syntax","title":"Syntax","text":"<pre><code>|area|\n</code></pre>"},{"location":"SetText/Individual%20commands/Area/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Area/#remarks","title":"Remarks","text":"<p>Specifically, the name is pulled from <code>Data/DialogueX/AreaNames</code> where X is the current languageid.</p> <p>This command will cause SetText to resume processing at the same character position to accommodate the text replacement of the input string at the position this command is being processed.</p>"},{"location":"SetText/Individual%20commands/Backbox/","title":"Backbox","text":"<p>Render a box behind the text with 40% transparency using one of the text colors.</p>"},{"location":"SetText/Individual%20commands/Backbox/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|backbox|\n</code></pre> <p>(2)</p> <pre><code>|backbox,colorindex|\n</code></pre>"},{"location":"SetText/Individual%20commands/Backbox/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Backbox/#colorindex-int","title":"<code>colorindex</code>: int","text":"<p>The color index to render from the text color palette. This must be a valid color index or an exception will be thrown. Here are all the valid values:</p> <ul> <li>0: 000000 (pure black, fully opaque).</li> <li>1: EE0B0B (mostly red, fully opaque).</li> <li>2: 00E700 (mostly green, fully opaque).</li> <li>3: 0000FF (pure blue, fully opaque).</li> <li>4: FFFFFF (pure white, fully opaque).</li> <li>5: A9F1FF (sky blue, fully opaque).</li> <li>6: FFD500 (mostly yellow, fully opaque).</li> <li>7: 7C7C7C (gray, 214/255 opaque).</li> <li>8: 00CC01 (mostly darker green than 2, fully opaque).</li> <li>9: FFA400 (mostly orange, fully opaque).</li> </ul> <p>The default is 4.</p>"},{"location":"SetText/Individual%20commands/Backbox/#remarks","title":"Remarks","text":"<p>The backbox is a new UI object named <code>backbox</code> childed to the textholder with its sortingOrder set to the current sort - 2. It is set to cover the whole space of the textholder.</p> <p>The color always ends up with 40% transparency no matter what the original color was.</p>"},{"location":"SetText/Individual%20commands/Backline/","title":"Backline","text":"<p>Does the same task than line, but with a different syntax and it only works in Regular Letter Rendering while line works for both letter rendering method.</p>"},{"location":"SetText/Individual%20commands/Backline/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|backline|\n</code></pre> <p>(2)</p> <pre><code>|backline,dummy,linespacing|\n</code></pre>"},{"location":"SetText/Individual%20commands/Backline/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Backline/#dummy-var","title":"<code>dummy</code>: var","text":"<p>The value of this parameter does not matter. It needs to be present because <code>linespacing</code> needs to be the second parameter to operate in syntax (2).</p>"},{"location":"SetText/Individual%20commands/Backline/#linespacing-float","title":"<code>linespacing</code>:  float","text":"<p>A factor to multiply the standard line height to move below the current one. This value must be a valid float or an exception will be thrown. If this value is not specified, the default value is 1.0 (which will use the standard line spacing).</p>"},{"location":"SetText/Individual%20commands/Backline/#remarks","title":"Remarks","text":"<p>This command is basically a worse version of line and is therefore not recommended to be used over it. Use line instead.</p>"},{"location":"SetText/Individual%20commands/Battle/","title":"Battle","text":"<p>Starts an inescapable enemy battle with all or a specific list of Enemies with configurable battle map and music; then yield until the battle is over.</p>"},{"location":"SetText/Individual%20commands/Battle/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|battle,enemies|\n</code></pre> <p>(2)</p> <pre><code>|battle,enemies,music|\n</code></pre> <p>(3)</p> <pre><code>|battle,enemies,music,map|\n</code></pre>"},{"location":"SetText/Individual%20commands/Battle/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Battle/#enemies-all-array-split-by-int","title":"<code>enemies</code>: <code>all</code> | array split by <code>.</code>: int","text":"<p>The Enemies list to start the battle with. Every element of the array form must a valid Enemy id and the array must be split by <code>.</code> or an exception will be thrown. The <code>all</code> value is a shorthand to all Enemies in the game ordered by their id (NOTE: due to a quirk with the battle starting process, this will only end up like a standard Tydal Wyrm fight).</p>"},{"location":"SetText/Individual%20commands/Battle/#music-string-null","title":"<code>music</code>: string | <code>null</code>","text":"<p>The name of the music file without extensions to play during the battle from the <code>audio/music</code> resources directory. This must be a valid music filename or an exception will be thrown. TODO: document these? The default value is <code>null</code> which will determine the one to use automatically based on the Areas and flags.</p>"},{"location":"SetText/Individual%20commands/Battle/#map-int","title":"<code>map</code>: int","text":"<p>The battle map to use for the battle. This must be -1 or a valid battle map id or an exception will be thrown. Since there 73 battle maps defined, the value must be between 0 and 72 or -1 which means to automatically select it. TODO: Document these? The default value is -1.</p>"},{"location":"SetText/Individual%20commands/Battle/#remarks","title":"Remarks","text":"<p>The camera position is saved in the same way than savecamera before starting the StartBattle coroutines with the desired parameters. It is however, not restored after the battle, but it can be restored manually later using loadcamera.</p> <p>From there, the message lock value is saved temporarily before forcing its release. From there, the textbox is hidden with a shrink animation and a yield of 0.5 seconds occurs. Finally, the yield until the battle is over starts. When it is over, an additional yield is done of 0.5 seconds, the message lock is restored to its original value and the current textbox is set to reveal with a grow animation.</p> <p>This temporarily violates the rule that only one SetText call in Dialogue mode may run at a given time because it is now possible to have this command process in Dialogue mode while letting the battle itself call SetText in Dialogue mode, but this is safe because should this happen, this command will stall SetText until the battle is over. This means that the original call wouldn't do anything that can interfere with any calls done during the battle. It is anyway necessary: BattleControl sometime needs Dialogue mode in some scripted events.</p>"},{"location":"SetText/Individual%20commands/Battlesize/","title":"Battlesize","text":"<p>An alias of size or sizemulti that is only processed if a battle is in progress.</p>"},{"location":"SetText/Individual%20commands/Battlesize/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|battlesize,sizeuniform|\n</code></pre> <p>(2)</p> <pre><code>|battlesize,sizex,sizey|\n</code></pre> <p>(3)</p> <pre><code>|battlesize,unpause,sizex,sizey|\n</code></pre> <p>(4)</p> <pre><code>|battlesize,sizex,sizey,lockcontrol|\n</code></pre> <p>(5) (Alias of sizemulti)</p> <pre><code>|battlesize,multi,sizex,sizey|\n</code></pre>"},{"location":"SetText/Individual%20commands/Battlesize/#parameters","title":"Parameters","text":"<p>The same as size for syntax (1) to (4), check its documentation to learn more. For syntax (5), the same as sizemulti, check its documentation to learn more and the <code>multi</code> parameter must be sent to indicate using this syntax.</p>"},{"location":"SetText/Individual%20commands/Battlesize/#remarks","title":"Remarks","text":"<p>This command does nothing if a battle isn't in progress.</p> <p>Unlike size, this command does nothing in OrganiseLines because it is explicitly excluded.</p>"},{"location":"SetText/Individual%20commands/Battlewon/","title":"Battlewon","text":"<p>Do nothing if the last battle or card battle was won, but redirect to a different dialogue line if it was lost or fled from.</p>"},{"location":"SetText/Individual%20commands/Battlewon/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|battlewon,lineidlost|\n</code></pre> <p>(2) (May throw an exception, not recommended, see remarks)</p> <pre><code>|checktrue,flags,lineidfalse|\n</code></pre> <p>(3) (Will throw an exception, see remarks)</p> <pre><code>|battlewon,var,flagvar,value,lineidfalse|\n</code></pre>"},{"location":"SetText/Individual%20commands/Battlewon/#parameters","title":"Parameters","text":"<p>For syntax (2) and (3), the parameters are the same then checkflag and checktrue.</p>"},{"location":"SetText/Individual%20commands/Battlewon/#lineidlost-int","title":"<code>lineidlost</code>: int","text":"<p>The Dialogue line id to redirect to if the last battle or card battle was lost or fled from. In such cases, this must be a valid Dialogue line id or an exception will be thrown. Otherwise, this parameter is ignored.</p>"},{"location":"SetText/Individual%20commands/Battlewon/#remarks","title":"Remarks","text":"<p>While syntax (2) and (3) are technically possible, <code>flags</code> and <code>var</code> will get interpreted as <code>lineidlost</code>. This means (3) will always throw an exception while (2) will throw if it happens to not correspond to a valid Dialogue line id.</p> <p>If the last battle or card battle was won, this command will do nothing and processing resumes as normal.</p> <p>If the last battle was lost or fled from however, the input string will be overwritten to an OrganiseLines version of the dialogue line at id <code>lineidlost</code>. This will reset the character position of the Char loop to restart at the beginning of the input string which will cause processing to resume at the start of the new input string. This will also disable <code>skiptext</code> if it was enabled by the Text advance system.</p>"},{"location":"SetText/Individual%20commands/BeeGame/","title":"BeeGame","text":"<p>Start a game of Flower Journey (aka FlappyBee) and yield until it is over.</p>"},{"location":"SetText/Individual%20commands/BeeGame/#syntax","title":"Syntax","text":"<pre><code>|beegame|\n</code></pre>"},{"location":"SetText/Individual%20commands/BeeGame/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/BeeGame/#remarks","title":"Remarks","text":"<p>The startup process is as follow:</p> <ul> <li>Set the current textbox to hide with a shrink animation as well as a fade to black with a speed of 0.1 then yield for 1 second</li> <li>Save the values of the current music, the fog color and the camera limits</li> <li>Effectively remove any camera limit by setting the bounds from (-999.0, -999.0, -999.0) to (999.0, 999.0, 999.0)</li> <li>Set flagvar 6 to 0 (this is needed for the game later to know what game was completed to properly reward the tokens amount)</li> <li>Set the position of the game's transform to (0.0, 70.0, 0.0) and the camera speed to 1.0 (instant)</li> <li>Yield for a frame</li> <li>Set the camera speed to 0.1 (the default speed)</li> <li>Yield for a frame</li> <li>Yield until the FlappyBee's object goes to null (this is done some time after its destruction)</li> </ul> <p>Once the game is over:</p> <ul> <li>The camera limits are restored and the camera is reset instantaneously.</li> <li>The fog color and render distance are restored</li> <li>The music is changed to the one before the game started</li> <li>A fade out to reveal the main game is done</li> <li>Yield for a second</li> <li>Disable the Text advance's skiptext</li> <li>Reveal the textbox with a grow animation</li> <li>Reassign the blinker</li> </ul> <p>It should be noted that the game will write to flagvar 0 with the score during the process of ending the mini game.</p>"},{"location":"SetText/Individual%20commands/Blank/","title":"Blank","text":"<p>Clears the current textbox by freeing all letter slots and go at the start of the first line.</p>"},{"location":"SetText/Individual%20commands/Blank/#syntax","title":"Syntax","text":"<pre><code>|blank|\n</code></pre>"},{"location":"SetText/Individual%20commands/Blank/#parameters","title":"Parameters","text":"<p>The parameters corresponds to the ones sent to a tail command at the end of this command's processing. If no parameters are sent, the tail command isn't processed.</p>"},{"location":"SetText/Individual%20commands/Blank/#remarks","title":"Remarks","text":"<p>This also clears up the icons and sprites accumulated in the current box and resets the text color to black. It also resets the <code>tempdiag</code> accumulator from the Backtracking system to |size,size.x,size.y| using the size values. At the end of this command, if there were parameters sent, a tail command will be processed with them at the end of this command's processing.</p> <p>This commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it.</p>"},{"location":"SetText/Individual%20commands/Bleep/","title":"Bleep","text":"<p>Change the current dialogue bleep sound and its pitch in Dialogue mode from an AnimID data, Entity field or specified directly.</p>"},{"location":"SetText/Individual%20commands/Bleep/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|bleep,animid|\n</code></pre> <p>(2)</p> <pre><code>|bleep,entity|\n</code></pre> <p>(3)</p> <pre><code>|bleep,sound,pitch|\n</code></pre> <p>(4)</p> <pre><code>|bleep,sound,pitch,volume|\n</code></pre>"},{"location":"SetText/Individual%20commands/Bleep/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Bleep/#animid-int","title":"<code>animid</code>: int","text":"<p>The AnimID to get its bleep and pitch as the new dialogue bleep sound. This must be a valid AnimID or an exception will be thrown. While the AnimIDs data are using the enum format to index them, this parameter assumes the int format as it will convert it before indexing.</p>"},{"location":"SetText/Individual%20commands/Bleep/#entity-int-this-caller-string","title":"<code>entity</code>: <code>@</code>int | <code>@this</code>, <code>@caller</code>, <code>@</code>string","text":"<p>The Entity id or designator to get its bleep and pitch as the new dialogue bleep sound. The <code>@</code> indicates to use syntax (2) as not providing it will use syntax (1) which will have this parameter be interpreted as <code>animid</code> which may cause an exception to be thrown. The int form represents an Entity id and it must be a valid int or an exception will be thrown. For other values:</p> <ul> <li><code>this</code>: Refers to the tailtarget.</li> <li><code>caller</code>: Refers to the caller.</li> <li>Anything else: Refers to a define if it exists, otherwise, this is interpreted as a regular Entity id which will cause an exception to be thrown.</li> </ul> <p>The string form still must resolve to a non null entity or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Bleep/#sound-string","title":"<code>sound</code>: string","text":"<p>The new bleep sound id to set the new dialogue bleep sound. This must be a valid bleep sound id or an exception will be thrown. This value is essentially the filename of the dialogue bleep sound without extension and without the <code>Dialogue</code> at the beginning. The files are located at <code>Audio/Sounds/Dialogue</code> from the project's resources directory.  This gives the following valid values:</p> Value Description 0 A mid range pitch, brief and very fast sound 1 A high pitch, brief and fast sound 2 A typewriter sound 3 A high pitch, long and slow sound 3old A louder version of 3 4 A robotic sound 5 A low pitch and slow sound 6 A higher pitch, brief and fast sound 7 A low pitch, long and fast sound 8 A very low pitch, long and fast sound 9 A very high pitch, brief and fast sound 10 A very high pitch, brief and slow sound 11 A high pitch, brief and slow sound 12 A high pitch, slow and distorted sound 13 A low pitch, long and slow sound 14 A mid range pitch, brief and fast sound 15 A very low pitch, long and slow sound 16 A very low pitch, brief and very slow sound <p>Any other value will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Bleep/#pitch-float","title":"<code>pitch</code>: float","text":"<p>The pitch value to set the dialogue bleep. This must be a valid float or an exception will be thrown. The default value at the start of a SetText call is 1.0 which is the normal pitch of the sound.</p>"},{"location":"SetText/Individual%20commands/Bleep/#volume-float","title":"<code>volume</code>: float","text":"<p>The pitch volume to set the dialogue bleep. This must be a valid float or an exception will be thrown. The default value at the start of a SetText call is the size's magnitude which would be 1.0 if no scaling is desired and it is the normal volume.</p>"},{"location":"SetText/Individual%20commands/Bleep/#remarks","title":"Remarks","text":"<p>This command allows to override the normal behavior of the dialogue bleep, pitch and volume done during the Dialogue setup phase where the properties will be set using the AnimID data of the parent's Entity and the volume to the size's magnitude. Once this command is processed, every automatic bleep sound done in Letter processing will be using the new bleep settings.</p> <p>It is not possible to change the volume using syntax (1) and (2).</p>"},{"location":"SetText/Individual%20commands/Boxspeed/","title":"Boxspeed","text":"<p>An alias of hidespeed.</p>"},{"location":"SetText/Individual%20commands/Boxspeed/#syntax","title":"Syntax","text":"<pre><code>|boxspeed,speed|\n</code></pre>"},{"location":"SetText/Individual%20commands/Boxspeed/#parameters","title":"Parameters","text":"<p>The same as hidespeed.</p>"},{"location":"SetText/Individual%20commands/Boxspeed/#remarks","title":"Remarks","text":"<p>There aren't any differences between this command and hidespeed.</p>"},{"location":"SetText/Individual%20commands/Boxstyle/","title":"Boxstyle","text":"<p>Sets the textbox's sprite or disable its rendering from now on in Dialogue mode</p>"},{"location":"SetText/Individual%20commands/Boxstyle/#syntax","title":"Syntax","text":"<pre><code>|boxstyle,styleindex|\n</code></pre>"},{"location":"SetText/Individual%20commands/Boxstyle/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Boxstyle/#styleindex-int","title":"<code>styleindex</code>:  int","text":"<p>The textbox style index to use from now on:</p> <ul> <li>-1: Disables the rendering of the textbox</li> <li>0: The default rounded border style.</li> <li>1: A jagged border rectangular style.</li> <li>2: The same as style 1, but with rounded corners.</li> <li>3: A brown paper shaped style.</li> <li>4: A semi translucent gray rectangular style.</li> <li>5: A stone looking style (this is used when obtaining artifacts under normal gameplay).</li> <li>6: The same style than 2, but the borders are cyan and the inside is dark gray.</li> <li>7: The same style than 6, but the borders are red.</li> </ul> <p>Any other value will cause this command to do nothing.</p>"},{"location":"SetText/Individual%20commands/Boxstyle/#remarks","title":"Remarks","text":"<p>If <code>styleindex</code> is -1, this command also sets the tailtarget to null.</p> <p>This command does nothing in non Dialogue mode.</p>"},{"location":"SetText/Individual%20commands/Break/","title":"Break","text":"<p>Wait for a confirmation input before resuming.</p>"},{"location":"SetText/Individual%20commands/Break/#syntax","title":"Syntax","text":"<pre><code>|break|\n</code></pre>"},{"location":"SetText/Individual%20commands/Break/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Break/#remarks","title":"Remarks","text":"<p>This behaves the same way than next except it does not record the text for Backtracking and it does not process a blank command after. It only stops the tailtarget from talking in Dialogue mode and yields to the game using waitinput as well as reset the Text advance text skip values.</p>"},{"location":"SetText/Individual%20commands/Breakend/","title":"Breakend","text":"<p>Replace the text of this command by |break||destroyminibubble||end|.</p>"},{"location":"SetText/Individual%20commands/Breakend/#syntax","title":"Syntax","text":"<pre><code>|breakend|\n</code></pre>"},{"location":"SetText/Individual%20commands/Breakend/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Breakend/#remarks","title":"Remarks","text":"<p>This command will resume processing at the same character position to accommodate the text replacement.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Breakflag/","title":"Breakflag","text":"<p>Set end to true if a specific flag slot is false.</p>"},{"location":"SetText/Individual%20commands/Breakflag/#syntax","title":"Syntax","text":"<pre><code>|breakflag,flags|\n</code></pre>"},{"location":"SetText/Individual%20commands/Breakflag/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Breakflag/#flags-int","title":"<code>flags</code>: int","text":"<p>The flag slot to check its value. This must be a valid flag slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Breakflag/#remarks","title":"Remarks","text":"<p>This command is unused under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Button/","title":"Button","text":"<p>Renders a ButtonSprite inline of the text and adjust the offset accordingly to resume processing after the sprite.</p>"},{"location":"SetText/Individual%20commands/Button/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|button,buttonid|\n</code></pre> <p>(2) (Not compatible with OrganiseLines)</p> <pre><code>|button,buttonid,type|\n</code></pre> <p>(3) (Not compatible with OrganiseLines)</p> <pre><code>|button,buttonid,type,description|\n</code></pre>"},{"location":"SetText/Individual%20commands/Button/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Button/#buttonid-int","title":"<code>buttonid</code>: int","text":"<p>The button id to render. This must be a valid integer or an exception will be thrown. If it is not a valid button id, this is undefined behavior which may lead to an exception being thrown. Here are the different button ids available:</p> id name 0 Up 1 Down 2 Left 3 Right 4 Confirm / Jump / Interact 5 Cancel / Field Action 6 Scroll Faster / Switch Party 7 Show / Hide HUD 8 Pause 9 Help"},{"location":"SetText/Individual%20commands/Button/#type-int","title":"<code>type</code>: int","text":"<p>Determines how to render between keyboard input If no value is specified, this defaults to -1. This must be a valid integer or an exception will be thrown. Here are the different behaviors:</p> <ul> <li>-1: Automatically determine which input to render based on the current control scheme</li> <li>&gt;= 1: Always render the controller input</li> <li>Anything else: Always render the keyboard input</li> </ul> <p>This parameter is only used in the Key Bindings List Type under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Button/#description-string","title":"<code>description</code>: string","text":"<p>If no value is specified, this defaults to null. This render some text immediately after the button. This parameter is not used under normal gameplay and the text does not render correctly as its rendering is not considered during offset calculations.</p>"},{"location":"SetText/Individual%20commands/Button/#remarks","title":"Remarks","text":"<p>The command will first create a GameObject with a ButtonSprite which will get added to the <code>buts</code> list. This ButtonSprite will have the following properties:</p> <ul> <li>tridimentional: set to <code>tridimensional</code></li> <li>parent: set to the textholder</li> <li>localEulerAngles: Vector3.zero. </li> <li>If <code>tridimensional</code> is false, the layer is set to 5.</li> </ul> <p>The ButtonSprite is initialised like so:</p> <ul> <li><code>id</code>: <code>buttonid</code></li> <li><code>onlyone</code>: <code>type</code></li> <li><code>labeltext</code>: <code>description</code></li> <li><code>tposition</code>: (current offset + o, current line + 0.225 * size.y) where o is 0.25 or 0.55 if it is a longer button than usual</li> <li><code>size</code>: (size.x / 2.2, size.y / 2.2, 1.0)</li> <li><code>overridesortorder</code>: sort</li> <li><code>parent</code>: null</li> <li><code>basecolor</code>: pure white</li> <li><code>labeloffset</code>: Vector3.zero</li> </ul> <p>After the button has been fully setup, the current offset will be increased by 0.75 (1.5 if this was a longer button than usual). Finally, if the current speed is above 0 and Text advance is not reporting a text skipping, an additional yield will be performed using the current speed as amount of seconds. This will simulate an additional cycle of the Char loop.</p> <p>This command has special logic in OrganiseLines. It adds 0.7 to the line accumulator when encountered and another 0.7 if the the keyboard input text is not empty and it doesn't have <code>Arrow</code>. Then, it reset the word accumulator to 0.</p> <p>It should be noted that this command does not work correctly under Single Letter Rendering because the offset calculations are off which means the ButtonSprite may not render on the screen or it may render at the incorrect position.</p> <p>This command is accumulated for the Backtracking system.</p>"},{"location":"SetText/Individual%20commands/Button/#known-issue-with-spacing","title":"Known issue with spacing","text":"<p>While it is possible to place this command anywhere in the input string, it is strongly recommended to place it at the start of a line or after a space. This is because a known issue with the button rendering is that the render position is slightly off to the left and if this command is placed directly after some text, it will overlap said text by a slight amount. Putting a space before the command or ensuring the command is placed at the start of a line remedies this problem. Additionally, it also helps OrganiseLines because it increases the chance that the button will not overflow the line if it is placed at the end of it due to the method resetting the word width accumulator when encountering this command which would ignore the current word.</p>"},{"location":"SetText/Individual%20commands/Button/#compatibility-with-organiselines","title":"Compatibility with OrganiseLines","text":"<p>Syntax (2) and (3) are not recommended to use because while they technically work, if the linebreak requested isn't null, this will throw an exception during OrganiseLines. The auto line breaker assumes that the command will be in syntax (1) as far as parsing the <code>buttonid</code> parameter goes. It is still possible to use these syntaxes, but care must be given to make sure OrganiseLines is never called on the input string. The game uses syntax (2) only during the Key Bindings List Type.</p>"},{"location":"SetText/Individual%20commands/Call/","title":"Call","text":"<p>An alias of string where <code>flagstring</code> is a Dialogue line id instead.</p>"},{"location":"SetText/Individual%20commands/Call/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|call,lineid|\n</code></pre> <p>(2)</p> <pre><code>|call,lineid,clamp,maxwidth|\n</code></pre> <p>(3)</p> <pre><code>|call,lineid,clamp,maxwidth,widthscaleclamp|\n</code></pre> <p>(3)</p> <pre><code>|call,lineid,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/Call/#parameters","title":"Parameters","text":"<p>The same as string except <code>flagstring</code> is now <code>lineid</code>:</p>"},{"location":"SetText/Individual%20commands/Call/#lineid-int","title":"<code>lineid</code>:  int","text":"<p>The Dialogue line id where its text will replace this command's text. This must corresponds to a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Call/#remarks","title":"Remarks","text":"<p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Camangle/","title":"Camangle","text":"<p>Changes the main camera's angle.</p>"},{"location":"SetText/Individual%20commands/Camangle/#syntax","title":"Syntax","text":"<pre><code>|camangle,x,y,z|\n</code></pre>"},{"location":"SetText/Individual%20commands/Camangle/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Camangle/#x-float","title":"<code>x</code>: float","text":"<p>The angle in degrees on the x axis. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camangle/#y-float","title":"<code>y</code>: float","text":"<p>The angle in degrees on the y axis. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camangle/#z-float","title":"<code>z</code>: float","text":"<p>The angle in degrees on the z axis. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camlimit/","title":"Camlimit","text":"<p>Set the camera's positional lower bound limits (this command is likely broken, see remarks for details)</p>"},{"location":"SetText/Individual%20commands/Camlimit/#syntax","title":"Syntax","text":"<pre><code>|camlimit,dummy,dummy,dummy,lowerx,lowery,lowerz|\n</code></pre>"},{"location":"SetText/Individual%20commands/Camlimit/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Camlimit/#dummy-float","title":"<code>dummy</code>: float","text":"<p>Anything in here is ignored due to an issue with this command's processing. The value must still be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camlimit/#lowerx-float","title":"<code>lowerx</code>: float","text":"<p>The X coordinate of the lower bound limit to set the camera. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camlimit/#lowery-float","title":"<code>lowery</code>: float","text":"<p>The Y coordinate of the lower bound limit to set the camera. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camlimit/#lowerz-float","title":"<code>lowerz</code>: float","text":"<p>The Z coordinate of the lower bound limit to set the camera. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camlimit/#remarks","title":"Remarks","text":"<p>This command was presumably supposed to set the lower and upper bounds of the camera's positional limit, but due to a bug, it only sets the lower bound using the last 3 parameters. This makes it ignore the first 3.</p> <p>This command is unused under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Camoffset/","title":"Camoffset","text":"<p>Changes the main camera's base position.</p>"},{"location":"SetText/Individual%20commands/Camoffset/#syntax","title":"Syntax","text":"<pre><code>|camoffset,x,y,z|\n</code></pre>"},{"location":"SetText/Individual%20commands/Camoffset/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Camoffset/#x-float","title":"<code>x</code>: float","text":"<p>The x base position to set. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camoffset/#y-float","title":"<code>y</code>: float","text":"<p>The y base position to set. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camoffset/#z-float","title":"<code>z</code>: float","text":"<p>The z base position to set. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camoffset/#remarks","title":"Remarks","text":"<p>This doesn't entirely change the camera's position: it only sets the <code>camoffset</code> field while the actual position is <code>camoffset</code> + <code>camoffset2</code>. The later is by default Vector3.zero, but it is possible to change its value from code.</p>"},{"location":"SetText/Individual%20commands/Camspeed/","title":"Camspeed","text":"<p>Set the camera's movement speed's multiplier.</p>"},{"location":"SetText/Individual%20commands/Camspeed/#syntax","title":"Syntax","text":"<pre><code>|camspeed,speed|\n</code></pre>"},{"location":"SetText/Individual%20commands/Camspeed/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Camspeed/#speed-float","title":"<code>speed</code>: float","text":"<p>The value to set the camera's speed. This must be a valid float or an exception will be thrown. Any value of 0 or below will be overridden to 0.1 which is the default speed.</p>"},{"location":"SetText/Individual%20commands/Camspeed/#remarks","title":"Remarks","text":"<p>The default speed of the camera is 0.1 while 1 would make any movement instant.</p>"},{"location":"SetText/Individual%20commands/Camtarget/","title":"Camtarget","text":"<p>Set the camera to target an Entity, target a specific position or remove any existing targets.</p>"},{"location":"SetText/Individual%20commands/Camtarget/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|camtarget,target|\n</code></pre> <p>(1)</p> <pre><code>|camtarget,null|\n</code></pre> <p>(2)</p> <pre><code>|camtarget,x,y,z|\n</code></pre>"},{"location":"SetText/Individual%20commands/Camtarget/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Camtarget/#target-int-string","title":"<code>target</code>: int | string","text":"<p>The Entity to have the camera targets. The int form is a regular Entity id and its restriction for valid values applies. The string form can be one of the following:</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller's entity. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Camtarget/#null","title":"<code>null</code>","text":"<p>Indicate to remove any existing camera targets. Any other value will be interpreted as <code>target</code>.</p>"},{"location":"SetText/Individual%20commands/Camtarget/#x-float","title":"<code>x</code>: float","text":"<p>The x position for the camera to target. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camtarget/#y-float","title":"<code>y</code>: float","text":"<p>The y position for the camera to target. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Camtarget/#z-float","title":"<code>z</code>: float","text":"<p>The z position for the camera to target. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Cancelaction/","title":"Cancelaction","text":"<p>Cancel the player's current field action.</p>"},{"location":"SetText/Individual%20commands/Cancelaction/#syntax","title":"Syntax","text":"<pre><code>|cancelaction|\n</code></pre>"},{"location":"SetText/Individual%20commands/Cancelaction/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Cancelaction/#remarks","title":"Remarks","text":"<p>Calls player.CancelAction. This is done without keeping the Beemerang if any.</p> <p>This command is unused under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Caravanmedal/","title":"Caravanmedal","text":"<p>Process a goto in syntax (2) if there are more than 1 prize Medal set to be available through the Caravan shop or do nothing otherwise.</p>"},{"location":"SetText/Individual%20commands/Caravanmedal/#syntax","title":"Syntax","text":"<pre><code>|caravanmedal,redirect|\n</code></pre>"},{"location":"SetText/Individual%20commands/Caravanmedal/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Caravanmedal/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The Dialogue line id to send to goto if applicable. This must be a valid Dialogue line id or an exception will be thrown if goto is processed with it.</p>"},{"location":"SetText/Individual%20commands/Caravanmedal/#remarks","title":"Remarks","text":"<p>The goto command is processed immediately if applicable.</p>"},{"location":"SetText/Individual%20commands/Cardbattle/","title":"Cardbattle","text":"<p>Start a Spy Card battle with an opponent or the caller with a configurable map and deck; then yield until the battle is over.</p>"},{"location":"SetText/Individual%20commands/Cardbattle/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|cardbattle,opponent|\n</code></pre> <p>(2)</p> <pre><code>|cardbattle,opponent,map|\n</code></pre> <p>(3)</p> <pre><code>|cardbattle,opponentid,map,opponentdeck|\n</code></pre>"},{"location":"SetText/Individual%20commands/Cardbattle/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Cardbattle/#oppenentid-int-this","title":"<code>oppenentid</code>: int | <code>this</code>","text":"<p>The opponent the player will be against for the battle. The int form corresponds to the AnimID of the opponent and it must be a valid one or an exception will be thrown.</p> <p><code>this</code> corresponds to caller's AnimIDs and the caller must not be null when using this value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Cardbattle/#map-int","title":"<code>map</code>: int","text":"<p>The battle map to use for the battle. This must be -1 or a valid battle map id or an exception will be thrown. Since there 73 battle maps defined, the value must be between 0 and 72 or -1 which means to automatically select it based on the current map. TODO: Document these? The default value is -1.</p>"},{"location":"SetText/Individual%20commands/Cardbattle/#opponentdeck-int-array-split-by-int","title":"<code>opponentdeck</code>: <code>@</code>int | array split by <code>@</code>: int","text":"<p>The deck the opponent will use for the battle. The <code>@</code>int form corresponds to a preset deck and the int part must be a valid preset deck id or an exception will be thrown. Since there are 15 preset decks, only values from 0 to 14 are valid (TODO: document these?) The array form specifies the card ids directly and each int must be a valid card id or an exception may be thrown during the battle.</p> <p>TODO: document carddata in general so it's clear what is a valid card id.</p>"},{"location":"SetText/Individual%20commands/Cardbattle/#remarks","title":"Remarks","text":"<p>Before starting the battle, the texttail is saved. After starting the battle, the message lock is forced to be released. From there, the textbox is hidden with a shrink animation and a yield of 1 second. Finally, the yield until the battle is over starts. The message lock is grabbed again, the texttail is restored, the blinker is reassigned to the one it had before and the current textbox is set to reveal with a grow animation.</p> <p>It should be noted that unlike battle which restores the message lock using the previous value, this one forces it on after the battle. This means it is potentially very unsafe to process this command in non Dialogue mode because after the battle, the SetText call will have the message lock without being able to release it. This can result in a softlock.</p> <p>This temporarily violates the rule that only one SetText call in Dialogue mode may run because it is now possible to have this command process in Dialogue mode while letting the battle itself call SetText in Dialogue mode, but this is safe because should this happen, this command will stall SetText until the battle is over. This means that the original call wouldn't do anything that can interfere with any calls done during the battle. It is anyway necessary: CardBattle needs Dialogue mode in the event of a tutorial being given.</p>"},{"location":"SetText/Individual%20commands/Cberrytotal/","title":"Cberrytotal","text":"<p>Replace the text of this command by the amount of crystalbfflags that are set to true.</p>"},{"location":"SetText/Individual%20commands/Cberrytotal/#syntax","title":"Syntax","text":"<pre><code>|cberrytotal|\n</code></pre>"},{"location":"SetText/Individual%20commands/Cberrytotal/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Cberrytotal/#remarks","title":"Remarks","text":"<p>This command will resume processing at the same position than this command to accommodate the text replacement.</p>"},{"location":"SetText/Individual%20commands/Center/","title":"Center","text":"<p>Toggle the text centering during rendering.</p>"},{"location":"SetText/Individual%20commands/Center/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|center|\n</code></pre> <p>(2)</p> <pre><code>|center,reset|\n</code></pre>"},{"location":"SetText/Individual%20commands/Center/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Center/#reset-var","title":"<code>reset</code>:  var","text":"<p>If specified, also go back to the first line and reposition the textholder to <code>position</code> or (-5.5, 0.9, 0.0) if it was not specified. Any value is accepted here as the value itself does not matter, only its presence.</p>"},{"location":"SetText/Individual%20commands/Center/#remarks","title":"Remarks","text":"<p>This will toggle the centralize rendering from either false to true or true to false depending on its existing state. This rendering will reposition the textholder to the center in Letter processing during rendering each time. This allows the text to be rendered in the center of the parent.</p>"},{"location":"SetText/Individual%20commands/Chapterintro/","title":"Chapterinto","text":"<p>Play a chapter into and yield until it is done playing.</p>"},{"location":"SetText/Individual%20commands/Chapterintro/#syntax","title":"Syntax","text":"<pre><code>|chapterinto,ch|\n</code></pre>"},{"location":"SetText/Individual%20commands/Chapterintro/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Chapterintro/#ch-int","title":"<code>ch</code>: int","text":"<p>The chapter intro to play from 1 to 7. This must be a valid chapter id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Chapterintro/#remarks","title":"Remarks","text":"<p>This command also saved both the message lock and minipause value before starting the coroutine only to restore them to their original value after the yield is done.</p> <p>This command is only used for testing purposes in the TestRoom.</p>"},{"location":"SetText/Individual%20commands/Checkallquests/","title":"Checkallquests","text":"<p>Redirect if 60 or more BoardQuests are in the completed board or do nothing otherwise.</p>"},{"location":"SetText/Individual%20commands/Checkallquests/#syntax","title":"Syntax","text":"<pre><code>|checkallquests,redirect|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkallquests/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkallquests/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The Dialogue line id to redirect if applicable. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkallquests/#remarks","title":"Remarks","text":"<p>If a redirection happen, the input string is replaced by an OrganiseLines version of the resolved <code>redirect</code> dialogue line and processing resumes at the start of the input string to accommodate its replacement.</p>"},{"location":"SetText/Individual%20commands/Checkanim/","title":"Checkanim","text":"<p>Redirect to a different dialogue line if an Entity's animstate is a specific value.</p>"},{"location":"SetText/Individual%20commands/Checkanim/#syntax","title":"Syntax","text":"<pre><code>|checkanim,entity,animstate,redirect|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkanim/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkanim/#entity-int-this-caller-string","title":"<code>entity</code>: int | <code>this</code> | <code>caller</code> | string","text":"<p>The Entity id or designator to check the animstate. The int form represents an Entity id and it must be a valid int or an exception will be thrown. If the entity resolves to null, an exception will be thrown. This also supports other values:</p> <ul> <li><code>this</code>: Refers to the tailtarget.</li> <li><code>caller</code>: Refers to the caller.</li> <li>Anything else: Refers to a define if it exists, otherwise, this is interpreted as a regular Entity id which will cause an exception to be thrown.</li> </ul>"},{"location":"SetText/Individual%20commands/Checkanim/#animstate-int-int","title":"<code>animstate</code>: int | <code>!</code>int","text":"<p>The animstate to check for equality that <code>entity</code> has. The int portion must be a valid int or an exception will be thrown. The <code>!</code> prefix indicates to always redirect (NOTE: it is likely a bug because it is safe to assume it was supposed to invert the condition, but it instead always redirect due to the command's implementation).</p>"},{"location":"SetText/Individual%20commands/Checkanim/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The Dialogue line id to redirect if applicable. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkanim/#remarks","title":"Remarks","text":"<p>This command does nothing if the caller is null.</p> <p>If a redirect happens, the input string is overwritten with an OrganiseLines version of the <code>redirect</code> line and processing resumes at the start of the input string to accommodate its replacement.</p>"},{"location":"SetText/Individual%20commands/Checkflag/","title":"Checkflag","text":"<p>A variation of checktrue where the only difference is the flag condition are inverted (there are no changes to flagvar checks). See the remarks section of this page for the exact logic.</p>"},{"location":"SetText/Individual%20commands/Checkflag/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|checkflag,flags,lineidfalse|\n</code></pre> <p>(2)</p> <pre><code>|checkflag,var,flagvar,value,lineidfalse|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkflag/#parameters","title":"Parameters","text":"<p>The same as checktrue.</p>"},{"location":"SetText/Individual%20commands/Checkflag/#remarks","title":"Remarks","text":"<p>In its simplest form, this command will evaluate the following:</p> <ul> <li>If syntax (1) and <code>flags</code> is one flag slot, check if that slot is false</li> <li>If syntax (1) and <code>flags</code> is an array of integer, for each int:<ul> <li>if it is above 0, check if the corresponding flag slot is false</li> <li>If it is 0 or below, take the absolute value and check if the corresponding flag slot is true</li> </ul> </li> <li>If Syntax (2), check that the flagvar slot <code>flagvar</code> is NOT equal to <code>value</code></li> </ul> <p>If any the applicable conditions are false, this command will do nothing and processing resumes as normal.</p> <p>If all of the applicable conditions are true however, the input string will be overwritten to an OrganiseLines version of the dialogue line at id <code>lineidfalse</code>. This will reset the character position of the Char loop to restart at the beginning of the input string which will cause processing to resume at the start of the new input string. This will also disable <code>skiptext</code> if it was enabled by the Text advance system.</p>"},{"location":"SetText/Individual%20commands/Checkinvqtd/","title":"Checkinvqtd","text":"<p>Check that the quantity of items in an inventory is equal or higher than a specific quantity or the maximum amount allowed by the game for this specific inventory. If it is, replaces the input string by another dialogue line.</p>"},{"location":"SetText/Individual%20commands/Checkinvqtd/#syntax","title":"Syntax","text":"<pre><code>|checkinvqtd,invtype,quantity,dialogue|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkinvqtd/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkinvqtd/#invtype-0-1-2","title":"<code>invtype</code>: <code>0</code> | <code>1</code> | <code>2</code>","text":"<p>The inventory type to check the quantity:</p> <ul> <li>0: Standard items</li> <li>1: Key items (this will cause the command to do nothing). </li> <li>2: Storage items.</li> </ul> <p>Any other value will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkinvqtd/#quantity-full-int","title":"<code>quantity</code>: <code>full</code> | int","text":"<p>The quantity to compare against. If it is <code>full</code>, the quantity depends on <code>invtype</code>:</p> <ul> <li>0: The current amount of maximum standard items allowed in inventory.</li> <li>1: N/A (will never report to exceed the quantity)</li> <li>2: The amount of maximum storage items allowed (this is always 35 under normal gameplay).</li> </ul> <p>If it is an int, this refers to a specific quantity and it must corresponds to a valid int value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkinvqtd/#dialogue-int","title":"<code>dialogue</code>: int","text":"<p>The Dialogue line id to redirect if the quantity is equal or higher than <code>quantity</code>. This value must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkinvqtd/#remarks","title":"Remarks","text":"<p>Whenever the input string is replaced, it is done with an OrganiseLines version of dialogue string prepended with |blank|.</p> <p>If the input string is replaced, this command will resume processing at the start of the new input string.</p>"},{"location":"SetText/Individual%20commands/Checkmapflag/","title":"Checkmapflag","text":"<p>Redirect to a Dialogue line id if a specific mapflags slot is true or continue processing as normal if it is false.</p>"},{"location":"SetText/Individual%20commands/Checkmapflag/#syntax","title":"Syntax","text":"<pre><code>|checkmapflag,mapflags,redirect|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkmapflag/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkmapflag/#mapflag-int","title":"<code>mapflag</code>: int","text":"<p>The mapflags to check its value. This must be a valid mapflags slot or an exception will be thrown. Since there are only 10 mapflags, valid values ranges from 0 to 9 inclusive.</p>"},{"location":"SetText/Individual%20commands/Checkmapflag/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The Dialogue line id to redirect to if <code>mapflag</code>'s slot ends up being true. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkmapflag/#remarks","title":"Remarks","text":"<p><code>map.mapflags</code> is an array of 10 bools that belongs to the current map, but is reset explicitly on the map's Start and unlike other flags arrays, this one is never saved on the Save File. This gives it a very ephemeral and temporary usage because all their values are reset on every map loads.</p> <p>Their value can be set using mapflag.</p>"},{"location":"SetText/Individual%20commands/Checkminibubble/","title":"Checkminibubble","text":"<p>Redirect if any minibubble are present to a different dialogue line or do nothing if none are present.</p>"},{"location":"SetText/Individual%20commands/Checkminibubble/#syntax","title":"Syntax","text":"<pre><code>|checkminibubble,lineid|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkminibubble/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkminibubble/#lineid-int","title":"<code>lineid</code>: int","text":"<p>The Dialogue line id to redirect if applicable. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkminibubble/#remarks","title":"Remarks","text":"<p>This command was specifically made to allow the Gen &amp; Eri switch puzzle to work inside the Honey Factory.</p>"},{"location":"SetText/Individual%20commands/Checkmoney/","title":"Checkmoney","text":"<p>Check that the berry count is less than a specific value or a value contained in a flagvar. If it is, redirect to another dialogue line.</p>"},{"location":"SetText/Individual%20commands/Checkmoney/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|checkmoney,value,dialogue|\n</code></pre> <p>(2)</p> <pre><code>|checkmoney,var,flagvar,dialogue|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkmoney/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkmoney/#value-int","title":"<code>value</code>:  int","text":"<p>The value to compare the berry count against. This must corresponds to a valid int value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkmoney/#var","title":"<code>var</code>","text":"<p>This is what determines how to obtain the value to compare the berry count against. Any other value will cause this to be interpreted as the <code>value</code> parameter which will throw an exception.</p>"},{"location":"SetText/Individual%20commands/Checkmoney/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot containing the value to compare the berry count against. This must corresponds to an int of a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkmoney/#dialogue-int","title":"<code>dialogue</code>: int","text":"<p>The Dialogue line id to process if the berry count is inferior than the value to compare against. This value must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkmoney/#remarks","title":"Remarks","text":"<p>Whenever the input string is replaced, it is done with an OrganiseLines version of dialogue string prepended with |blank|.</p> <p>If the input string is replaced, this command will resume processing at the start of the new input string.</p>"},{"location":"SetText/Individual%20commands/Checkpos/","title":"Checkpos","text":"<p>Redirect to a different line by a Dialogue line id if the current player's position on a specific axis isn't at least a specific value or do nothing otherwise.</p>"},{"location":"SetText/Individual%20commands/Checkpos/#syntax","title":"Syntax","text":"<pre><code>|checkpos,axis,minvalue,redirect|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkpos/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkpos/#axis-x-y-z","title":"<code>axis</code>: <code>x</code> | <code>y</code> | <code>z</code>","text":"<p>The axis to perform the position test. Any other value will cause the redirection to occur no matter the current position.</p>"},{"location":"SetText/Individual%20commands/Checkpos/#minvalue-float","title":"<code>minvalue</code>: float","text":"<p>The minimal value the current position must have in the <code>axis</code> axis to not redirect. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkpos/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The Dialogue line id of the line to redirect if applicable. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkpos/#remarks","title":"Remarks","text":"<p>If the player is null, this command does nothing.</p> <p>If the redirect happens, it is done using an OrganiseLines version of the resolved dialogue line and the command will cause processing to resume at the start of the new input string. Additionally, Text advance's skiptext will be disabled.</p>"},{"location":"SetText/Individual%20commands/Checkregional/","title":"Checkregional","text":"<p>Redirect to another dialogue line using a Dialogue line id if a Regionalflag slot is false or if it is in a specific state.</p>"},{"location":"SetText/Individual%20commands/Checkregional/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|checkregional,regional,lineidredirect|\n</code></pre> <p>(2)</p> <pre><code>|checkregional,regional,lineidredirect,statecheck|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkregional/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkregional/#regional-int","title":"<code>regional</code>: int","text":"<p>The Regionalflag slot to check the state. This must be a valid Regionalflag slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkregional/#lineidredirect-int","title":"<code>lineidredirect</code>: int","text":"<p>The Dialogue line id to redirect if the regional slot is false or if its state is <code>statecheck</code>. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkregional/#statecheck-true-false","title":"<code>statecheck</code>: <code>true</code> | <code>false</code>","text":"<p>The state to compare the regional slot against. This must be <code>true</code> or <code>false</code> or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkregional/#remarks","title":"Remarks","text":"<p>The redirect is done using an OrganiseLines version of the dialogue line resolved using <code>lineidredirect</code> prepended with |blank|. This also ends the Text advance's <code>skiptext</code>.</p> <p>If a redirection happens, processing will resume at the start of the new input string.</p>"},{"location":"SetText/Individual%20commands/Checksum/","title":"Checksum","text":"<p>Process a goto in syntax (1) if 2 values or flagvar slots added together is strictly bigger than another value or flagvar slot or do nothing otherwise.</p>"},{"location":"SetText/Individual%20commands/Checksum/#syntax","title":"Syntax","text":"<pre><code>|checksum,value1,value2,checkvalue,redirect|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checksum/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checksum/#value1-int-vint-varint-money","title":"<code>value1</code>: int | <code>v</code>int | <code>var</code>int | <code>money</code>","text":"<p>The first value or flagvar slot to add together. The int form must be a valid int or an exception will be thrown. The <code>v</code>/<code>var</code> prefix indicates to use the value of a flagvar slot and it must be a valid one or an exception will be thrown. <code>money</code> indicates to use the current berries count as the value.</p>"},{"location":"SetText/Individual%20commands/Checksum/#value2-int-vint-varint-money","title":"<code>value2</code>: int | <code>v</code>int | <code>var</code>int | <code>money</code>","text":"<p>The second value or flagvar slot to add together. The int form must be a valid int or an exception will be thrown. The <code>v</code>/<code>var</code> prefix indicates to use the value of a flagvar slot and it must be a valid one or an exception will be thrown. <code>money</code> indicates to use the current berries count as the value.</p>"},{"location":"SetText/Individual%20commands/Checksum/#valuecheck-int-vint-varint-money","title":"<code>valuecheck</code>: int | <code>v</code>int | <code>var</code>int | <code>money</code>","text":"<p>The value or flagvar slot to test the sum of <code>value1</code> and <code>value2</code>. The int form must be a valid int or an exception will be thrown. The <code>v</code>/<code>var</code> prefix indicates to use the value of a flagvar slot and it must be a valid one or an exception will be thrown. <code>money</code> indicates to use the current berries count as the value. The redirection only happens if <code>value1</code> + <code>value2</code> is strictly bigger than this value.</p>"},{"location":"SetText/Individual%20commands/Checksum/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The Dialogue line id to send to goto if applicable. This must be a valid Dialogue line id or an exception will be thrown if goto is processed with it.</p>"},{"location":"SetText/Individual%20commands/Checksum/#remarks","title":"Remarks","text":"<p>The goto command is immediately processed if applicable.</p>"},{"location":"SetText/Individual%20commands/Checktrue/","title":"Checktrue","text":"<p>Check a flagvar for NOT being a specific integer, a single flag for being true or a set of flags for a specific state and either do nothing if all conditions are satisfied or redirect to a different line if they aren't.</p>"},{"location":"SetText/Individual%20commands/Checktrue/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|checktrue,flags,lineidfalse|\n</code></pre> <p>(2)</p> <pre><code>|checktrue,var,flagvar,value,lineidfalse|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checktrue/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checktrue/#flags-int-array-split-by-int","title":"<code>flags</code>: int | array split by <code>@</code>: int","text":"<p>The flag slot or array of flags slot to check for being true. It is possible to only specify one slot by omitting any <code>@</code>. </p> <p>In the singular form, the value must be a valid flag slot or an exception will be thrown. In this form, only checking for a single flag being true is supported.</p> <p>In the array form, each element of the array must be have its absolute value be a valid flags slot or an exception will be thrown. Any negative version of a slot or <code>0</code> will instruct to check for the flag being false instead of true.</p>"},{"location":"SetText/Individual%20commands/Checktrue/#var","title":"<code>var</code>","text":"<p>This value determines whether to operate in syntax (2) or not. Any other value will be interpreted as <code>flags</code>.</p>"},{"location":"SetText/Individual%20commands/Checktrue/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot to check. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checktrue/#value-int","title":"<code>value</code>: int","text":"<p>The value to compare the flagvar against for inequality. This must be a valid integer or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checktrue/#lineidfalse-int","title":"<code>lineidfalse</code>: int","text":"<p>The Dialogue line id to redirect to if the overall condition gets evaluated to false. If the condition gets evaluated to true, this parameter is ignored.</p>"},{"location":"SetText/Individual%20commands/Checktrue/#remarks","title":"Remarks","text":"<p>In its simplest form, this command will evaluate the following:</p> <ul> <li>If syntax (1) and <code>flags</code> is one flags slot, check if that slot is true</li> <li>If syntax (1) and <code>flags</code> is an array of integer, for each int:<ul> <li>if it is above 0, check if the corresponding flags slot is true</li> <li>If it is 0 or below, take the absolute value and check if the corresponding flags slot is false</li> </ul> </li> <li>If Syntax (2), check that the flagvar slot <code>flagvar</code> is NOT equal to <code>value</code></li> </ul> <p>If any the applicable conditions are false, this command will do nothing and processing resumes as normal.</p> <p>If all of the applicable conditions are true however, the input string will be overwritten to an OrganiseLines version of the dialogue line at id <code>lineidfalse</code>. This will reset the character position of the Char loop to restart at the beginning of the input string which will cause processing to resume at the start of the new input string. This will also disable <code>skiptext</code> if it was enabled by the Text advance system.</p>"},{"location":"SetText/Individual%20commands/Checkvar/","title":"Checkvar","text":"<p>Compare a flagvar against a value or another flagvar for a condition and redirect if this condition ends up being true or do nothing if it ends up being false.</p>"},{"location":"SetText/Individual%20commands/Checkvar/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|checkvar,flagvar,value,lineidtrue|\n</code></pre> <p>(2)</p> <pre><code>|checkvar,atleast,flagvar,varvalue,lineidtrue|\n</code></pre> <p>(3)</p> <pre><code>|checkvar,moreand,flagvar,varvalue,lineidtrue|\n</code></pre>"},{"location":"SetText/Individual%20commands/Checkvar/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Checkvar/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot to check. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkvar/#atleast-moreand","title":"<code>atleast</code> | <code>moreand</code>","text":"<p>This value determines which syntax to use. Any other value will be interpreted as <code>flagvar</code> and the command will operate in syntax (1).</p> <ul> <li>no value: redirect only if <code>flagvar</code> is equal to <code>value</code></li> <li><code>atleast</code>: redirect only if <code>flagvar</code> \\&lt; <code>varvalue</code></li> <li><code>moreand</code>: redirect only if <code>flagvar</code> &gt;= <code>varvalue</code></li> </ul>"},{"location":"SetText/Individual%20commands/Checkvar/#value-int","title":"<code>value</code>: int","text":"<p>The value to compare the flagvar against. This must be a valid integer or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkvar/#varvalue-int-varint","title":"<code>varvalue</code>: int | <code>var</code>int","text":"<p>The value to compare the flagvar against or the second flagvar slot to compare the first one against. </p> <p>The value form must be a valid integer or an exception will be thrown. </p> <p>The flagvar slot form must ONLY contain the text <code>var</code> with the flagvar slot next or before it. Any other non numerical text will be interpreted as the value form which will throw an exception. The integer part must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Checkvar/#lineidtrue-int","title":"<code>lineidtrue</code>: int","text":"<p>The Dialogue line id to redirect to if the overall condition gets evaluated to true. If the condition gets evaluated to false, this parameter is ignored.</p>"},{"location":"SetText/Individual%20commands/Checkvar/#remarks","title":"Remarks","text":"<p>It is not possible to use syntax (1) with a flagvar as the second operand of the condition. To do so, you can use checktrue or checkflag</p> <p>If the applicable condition is false, this command will do nothing and processing resumes as normal.</p> <p>If the applicable condition is true however, the input string will be overwritten to an OrganiseLines version of the dialogue line id <code>lineidfalse</code> prepended with a parameterless blank command. This will reset the character position of the Char loop to restart at the beginning of the input string which will cause processing to resume at the start of the new input string. This will also disable <code>skiptext</code> if it was enabled by the Text advance system.</p>"},{"location":"SetText/Individual%20commands/Choicewave/","title":"Choicewave","text":"<p>Enable a PromptAnim on the textholder that will highlight the text with a wave visual effect if it is hovered on during a prompt.</p>"},{"location":"SetText/Individual%20commands/Choicewave/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|choicewave,optionindex|\n</code></pre> <p>(2)</p> <pre><code>|choicewave,optionindex,underline|\n</code></pre>"},{"location":"SetText/Individual%20commands/Choicewave/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Choicewave/#optionindex-int","title":"<code>optionindex</code>: int","text":"<p>The index of the concerned prompt option. If the current prompt option is this value, the text will be rendered with the highlight effect enabled and disabled otherwise. This must corresponds to a valid int value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Choicewave/#underline-var","title":"<code>underline</code>: var","text":"<p>Whether to render a red <code>_</code> underneath the text once it is highlighted instead of highlighting the text in red. Any value is accepted here as the value itself does not matter, only its presence.</p>"},{"location":"SetText/Individual%20commands/Choicewave/#remarks","title":"Remarks","text":"<p>This command allows a prompt, numberPrompt and letterPrompt to highlight the currently hovered choice by applying a PromptAnim which apply a wave effect and a red color to the text or the <code>_</code> in syntax (2).</p>"},{"location":"SetText/Individual%20commands/Clonestring/","title":"Conestring","text":"<p>Copy the value of a flagstring to another.</p>"},{"location":"SetText/Individual%20commands/Clonestring/#syntax","title":"Syntax","text":"<pre><code>|clonestring,srcflagstring,destflagstring|\n</code></pre>"},{"location":"SetText/Individual%20commands/Clonestring/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Clonestring/#srcflagstring-int","title":"<code>srcflagstring</code>: int","text":"<p>The flagstring slot to copy. This must be a valid flagstring slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Clonestring/#destflagstring-int","title":"<code>destflagstring</code>: int","text":"<p>The flagstring slot to overwrite its value by <code>srcflagstring</code>. This must be a valid flagstring slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Color/","title":"Color","text":"<p>Set the text color to one of the game's text color palette for every letter from now on.</p>"},{"location":"SetText/Individual%20commands/Color/#syntax","title":"Syntax","text":"<pre><code>|color,colorindex|\n</code></pre>"},{"location":"SetText/Individual%20commands/Color/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Color/#colorindex-int","title":"<code>colorindex</code>:  int","text":"<p>The color index to use from the game's text color palette. This value must be an int value between 0 and 9 or an exception will be thrown.</p> <p>The colors available are:</p> <ul> <li>0: 000000 (pure black, fully opaque).</li> <li>1: EE0B0B (mostly red, fully opaque).</li> <li>2: 00E700 (mostly green, fully opaque).</li> <li>3: 0000FF (pure blue, fully opaque).</li> <li>4: FFFFFF (pure white, fully opaque).</li> <li>5: A9F1FF (sky blue, fully opaque).</li> <li>6: FFD500 (mostly yellow, fully opaque).</li> <li>7: 7C7C7C (gray, 214/255 opaque).</li> <li>8: 00CC01 (mostly darker green than 2, fully opaque).</li> <li>9: FFA400 (mostly orange, fully opaque).</li> </ul>"},{"location":"SetText/Individual%20commands/Color/#remarks","title":"Remarks","text":"<p>This commands works in Single Letter Rendering, but it will affect the whole line rather than each letter from now on.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Common/","title":"Common","text":"<p>Replace the input string to a parameterless blank command followed by a line in commondialogue and continue processing at the start of it.</p>"},{"location":"SetText/Individual%20commands/Common/#syntax","title":"Syntax","text":"<pre><code>|common,commonlineindex|\n</code></pre>"},{"location":"SetText/Individual%20commands/Common/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Common/#commonlineindex-int","title":"<code>commonlineindex</code>: int","text":"<p>The index of the commondialogue line to redirect to. Unlike a regular Dialogue line id, this must be a valid index of commondialogue or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Common/#remarks","title":"Remarks","text":"<p>The actual line goes through OrganiseLines before the blank command is prepanded and that string ends up being the new input string.</p> <p>This is essentially a stripped down version of goto which can do the same thing, but with Backtracking, testdiag and more. This command was presumably only used for debugging purposes.</p> <p>This command resumes processing at the start of the string to accommodate the new input string.</p>"},{"location":"SetText/Individual%20commands/Completequest/","title":"Completequest","text":"<p>Sets a BoardQuest as completed which removes it from the taken board and add it to the completed board.</p>"},{"location":"SetText/Individual%20commands/Completequest/#syntax","title":"Syntax","text":"<pre><code>|completequest,questid|\n</code></pre>"},{"location":"SetText/Individual%20commands/Completequest/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Completequest/#questid-int","title":"<code>questid</code>: int","text":"<p>The BoardQuest id to mark as completed. This must be a valid BoardQuest or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Completequest/#remarks","title":"Remarks","text":"<p>This command will also ensure that the <code>NoQuest</code> value is removed from the completed board and added to the taken board if no quests are taken after the transfer. It will also increment flagvar 47 and show the quest complete HUD message for 350 frames.</p> <p>It should be noted this command will still work even if the BoardQuest isn't in the taken board. In that case, it will be added to the completed board.</p>"},{"location":"SetText/Individual%20commands/Copyvar/","title":"Copyvar","text":"<p>Set the value of a flagvar slot.</p>"},{"location":"SetText/Individual%20commands/Copyvar/#syntax","title":"Syntax","text":"<pre><code>|copyvar,value,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Copyvar/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Copyvar/#value-int","title":"<code>value</code>: int","text":"<p>The value to set  the <code>flagvar</code> slot to. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Copyvar/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot to set the value to. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Copyvar/#remarks","title":"Remarks","text":"<p>This command is unused under normal gameplay. setvar allows the same functionality using syntax (1).</p>"},{"location":"SetText/Individual%20commands/Createitem/","title":"Createitem","text":"<p>Create an item Entity of a specific Item, Medal or a Crystal Berry with configurable position and timer before disappearing.</p>"},{"location":"SetText/Individual%20commands/Createitem/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|createitem,itemtype,itemid|\n</code></pre> <p>(2)</p> <pre><code>|createitem,itemtype,itemid,xposition,yposition,zposition|\n</code></pre> <p>(3)</p> <pre><code>|createitem,itemtype,itemid,xposition,yposition,zposition,timer|\n</code></pre>"},{"location":"SetText/Individual%20commands/Createitem/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Createitem/#itemtype-int","title":"<code>itemtype</code>: int","text":"<p>The type of the item. This must be a valid int or an exception will be thrown. Here are the defined types available:</p> <ul> <li>0: Standard item</li> <li>1: Key item</li> <li>2: Medal</li> <li>3: Crystal Berry   The type influences the specific behaviors when the item is collected and how to render it. Any other value has undefined behaviors.</li> </ul>"},{"location":"SetText/Individual%20commands/Createitem/#itemid-int","title":"<code>itemid</code>: int","text":"<p>The Item or Medal id. This must be a valid Item or Medal id or an exception will be thrown when rendering the Entity.</p>"},{"location":"SetText/Individual%20commands/Createitem/#xposition-float","title":"<code>xposition</code>: float","text":"<p>The x position of where to place the Entity. This must be a valid float or an exception will be thrown. The default value is the x position of the player.</p>"},{"location":"SetText/Individual%20commands/Createitem/#yposition-float","title":"<code>yposition</code>: float","text":"<p>The y position of where to place the Entity. This must be a valid float or an exception will be thrown. The default value is the y position of the player.</p>"},{"location":"SetText/Individual%20commands/Createitem/#zposition-float","title":"<code>zposition</code>: float","text":"<p>The z position of where to place the Entity. This must be a valid float or an exception will be thrown. The default value is the z position of the player.</p>"},{"location":"SetText/Individual%20commands/Createitem/#timer-int","title":"<code>timer</code>: int","text":"<p>The amount of frames before the item disappear. This must be a valid int or an exception will be thrown. The default value is 300.</p>"},{"location":"SetText/Individual%20commands/Createitem/#remarks","title":"Remarks","text":"<p>This will create the item without a velocity and it will also prepend the name with <code>Fixed</code> which gives the Entity the Fixed modifier. Additionally, the RigidBody's constraints of the Entity are frozen and the <code>insideid</code> field set to the current one.</p>"},{"location":"SetText/Individual%20commands/Currency/","title":"Currency","text":"<p>Replaces this command's text with a textual representation of a number followed by a space followed by either the singular form of the game's currency (berry in English) or the plural form (berries in English) depending on a specific amount or an amount contained in a flagvar.</p>"},{"location":"SetText/Individual%20commands/Currency/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|currency,amount|\n</code></pre> <p>(2)</p> <pre><code>|currency,var,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Currency/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Currency/#amount-int","title":"<code>amount</code>: int","text":"<p>The amount of berries to test the plurality. This must be a valid int value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Currency/#var","title":"<code>var</code>","text":"<p>This is just what determines how the amount of berries to test the plurality is obtained. Any other value will this parameter to be interpreted as the <code>amount</code>.</p>"},{"location":"SetText/Individual%20commands/Currency/#flagvar-int","title":"<code>flagvar</code>:  int","text":"<p>The flagvar slot containing the amount of berries to test for the plurality. This must corresponds to an int of a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Currency/#remarks","title":"Remarks","text":"<p>More specifically, this command expects line 0 of MenuText to contain the singular form and line 1 of MenuText to contain the plural form.</p> <p>This command will cause SetText to resume processing at the same character position to accommodate the text replacement of the input string at the position this command is being processed.</p>"},{"location":"SetText/Individual%20commands/Deathsmoke/","title":"Deathsmoke","text":"<p>Emit 20 particles at the parent or an Entity's position with configurable size.</p>"},{"location":"SetText/Individual%20commands/Deathsmoke/#syntax","title":"Syntax","text":"<p>(1) (Emits the particle at the parent's position at size Vector3.one)</p> <pre><code>|deathsmoke|\n</code></pre> <p>(2)</p> <pre><code>|deathsmoke,entity|\n</code></pre> <p>(3)</p> <pre><code>|deathsmoke,entity,size|\n</code></pre>"},{"location":"SetText/Individual%20commands/Deathsmoke/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Deathsmoke/#entity-int-string","title":"<code>entity</code>: int | string","text":"<p>The Entity that this command refers to. The int form is a regular Entity id and it must not resolve to null or an exception will be thrown. The string form can be one of the following when not in battle (if in battle, this is interpreted as an int which will cause an exception to be thrown):</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Deathsmoke/#size-float","title":"<code>size</code>: float","text":"<p>The size of the particles to emit. This must be a valid float or an exception will be thrown. The default value is 1.0.</p>"},{"location":"SetText/Individual%20commands/Define/","title":"Define","text":"<p>Add a name that can be used to resolve an Entity id for this SetText call in Dialogue mode.</p>"},{"location":"SetText/Individual%20commands/Define/#syntax","title":"Syntax","text":"<pre><code>|define,id,name|\n</code></pre>"},{"location":"SetText/Individual%20commands/Define/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Define/#id-int","title":"<code>id</code>: int","text":"<p>The Entity id to resolve using <code>name</code> from now on. This must be a valid Entity id or an exception will be thrown when resolving the entity.</p>"},{"location":"SetText/Individual%20commands/Define/#name-string","title":"<code>name</code>: string","text":"<p>The name that will be used to resolve the Entity id <code>id</code> from now on. Any string is allowed and it is case sensitive.</p>"},{"location":"SetText/Individual%20commands/Define/#remarks","title":"Remarks","text":"<p>This command allows access to a feature some commands supports which is to use the define list to resolve Entity by a string key rather than the traditional Entity id key. Not all commands supports this feature, check the command's documentation to learn if it is supported. Other commands only supports Entity id keys.</p> <p>In non Dialogue mode, this command technically works, but it will not clear the define list as this task is done in Dialogue setup.</p>"},{"location":"SetText/Individual%20commands/Destroydescbox/","title":"Destroydescbox","text":"<p>Destroy the caller's description window if it exist no matter what or only do it if the caller's interaction type isn't Shop or CaravanBadge.</p>"},{"location":"SetText/Individual%20commands/Destroydescbox/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|destroydescbox,soundname|\n</code></pre> <p>(2)</p> <pre><code>|destroydescbox,1|\n</code></pre>"},{"location":"SetText/Individual%20commands/Destroydescbox/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Destroydescbox/#1","title":"<code>1</code>","text":"<p>Whether to ignore the caller's interact type and attempt to destroy the description window anyway. Any other value is ignored and treated like syntax (1). The caller must not be null when sending this parameter or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Destroydescbox/#remarks","title":"Remarks","text":"<p>Syntax (1) will destroy the caller's description window in 0.5 seconds with a shrink animation if it exists and its interact type is anything other than Shop or CaravanBadge. Syntax (2) ignores all of this and tries to destroy it anyway, even if the caller is null which will throw an exception.</p> <p>In the case where the caller has no description window or syntax (1) is used without meeting the conditions, this command does nothing.</p> <p>This command is only used in very specific cases such as grabbing an item, during the course of giveitem and when regenerating the list of medals available at Merab's shop or Shades's shop.</p>"},{"location":"SetText/Individual%20commands/Destroyminibubble/","title":"Destroyminibubble","text":"<p>Force the destruction of all or a specific minibubble by its index in the bubbles list if it wasn't destroyed yet.</p>"},{"location":"SetText/Individual%20commands/Destroyminibubble/#syntax","title":"Syntax","text":"<p>(1) (This destroys all minibubble that aren't destroyed yet in the bubbles list)</p> <pre><code>|destroyminibubble|\n</code></pre> <p>(2)</p> <pre><code>|destroyminibubble,index|\n</code></pre>"},{"location":"SetText/Individual%20commands/Destroyminibubble/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Destroyminibubble/#index-int","title":"<code>index</code>: int","text":"<p>The index of the minibubble to destroy. This must be a valid int or an exception will be thrown. If the value is a valid int, but no element exists in the bubbles list at that index or the minibubble itself was already destroyed, this command will do nothing.</p>"},{"location":"SetText/Individual%20commands/Destroyminibubble/#remarks","title":"Remarks","text":"<p>This command has mainly 2 use cases. It can not only preemptively destroy a minibubble, but if the minibubble was setup with an halt command as the inner SetText call, this command now controls when to destroy it.</p> <p>For more details on how a minibubble destruction works, check minibubble &gt; Minibubble's destruction, for destroying it from the same SetText call than a minibubble command, check minibubble &gt; Managing Minibbubles from the outer SetText call and for how to use it with halt, check minibubble &gt; A note about Halt.</p>"},{"location":"SetText/Individual%20commands/Discovery/","title":"Discovery","text":"<p>Enable a Discoveries entry or enable all Discoveries entry, Bestiary entry, Recipes entry, Records entry and seen Areas.</p>"},{"location":"SetText/Individual%20commands/Discovery/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|discovery,discoveryid|\n</code></pre> <p>(2)</p> <pre><code>|discovery,all|\n</code></pre>"},{"location":"SetText/Individual%20commands/Discovery/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Discovery/#discoveryid-int","title":"<code>discoveryid</code>: int","text":"<p>The Discoveries entry id to enable. This must be between 0 and 255 or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Discovery/#all","title":"<code>all</code>","text":"<p>This indicates to operate in syntax (2) which will enable all <code>librarystuff</code> flags.</p>"},{"location":"SetText/Individual%20commands/Discovery/#remarks","title":"Remarks","text":"<p>Syntax (1) accepts any valid Discoveries entry slot, even unused ones.</p> <p>Syntax (2) enabled every single slot of every librarystuff flags including all the unused ones. This includes all Discoveries entry, Bestiary entry, Recipes entry, Records entry and seen Areas.</p>"},{"location":"SetText/Individual%20commands/Dropshadow/","title":"Dropshadow","text":"<p>Set the text's drop shadow offset vector or turn off the effect.</p>"},{"location":"SetText/Individual%20commands/Dropshadow/#syntax","title":"Syntax","text":"<p>(1) (To turn off drop shadows effect)</p> <pre><code>|dropshadow|\n</code></pre> <p>(2)</p> <pre><code>|dropshadow,size|\n</code></pre> <p>(3)</p> <pre><code>|dropshadow,sizex,sizey|\n</code></pre>"},{"location":"SetText/Individual%20commands/Dropshadow/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Dropshadow/#size-float","title":"<code>size</code>: float","text":"<p>The size in x and y to use for the vector of the dropshadow. This must be a valid float or an exception will be thrown. This will make a drop shadow positioned to the right and down by the value.</p>"},{"location":"SetText/Individual%20commands/Dropshadow/#sizex-float","title":"<code>sizex</code>: float","text":"<p>The horizontal offset to use for the vector of the dropshadow. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Dropshadow/#sizey-float","title":"<code>sizey</code>: float","text":"<p>The vertical offset to use for the vector of the dropshadow. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Dropshadow/#remarks","title":"Remarks","text":"<p>The drop shadows has slightly different behavior depending on the letter rendering method, but this command only changes its state.</p> <p>In Regular Letter Rendering, drop shadows uses a separate letter slot per letter to render a pure black, half transparent version of the same letter, but offset by the vector specified by this command.</p> <p>In Single Letter Rendering, this is instead done by using a second letter slot as opposed to one per line to do the same effect.</p> <p>In Regular Letter Rendering, It also supports fadeletter which will render the drop shadow letter in a fully transparent color, but progressively go to pure black, half transparent in the course of 200 frames.</p>"},{"location":"SetText/Individual%20commands/DungeonGame/","title":"DungeonGame","text":"<p>Start a game of Mite Knight (aka MazeGame) and yield until it is over.</p>"},{"location":"SetText/Individual%20commands/DungeonGame/#syntax","title":"Syntax","text":"<pre><code>|dungeongame|\n</code></pre>"},{"location":"SetText/Individual%20commands/DungeonGame/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/DungeonGame/#remarks","title":"Remarks","text":"<p>The startup process is as follow:</p> <ul> <li>Set the current textbox to hide with a shrink animation as well as a fade to black with a speed of 0.1 then yield for 1 second</li> <li>Save the values of the current music, the fog color and the camera limit</li> <li>Effectively remove any camera limit by setting the bounds from (-999.0, -999.0, -999.0) to (999.0, 999.0, 999.0)</li> <li>Set flagvar 6 to 1 (this is needed for the game later to know what game was completed if it was to properly reward the tokens amount)</li> <li>Set the position of the game's transform to (0.0, 70.0, 0.0) and the camera speed to 1.0 (instant)</li> <li>Yield for a frame</li> <li>Set the camera speed to 0.1 (the default speed)</li> <li>Yield for a frame</li> <li>Yield until the MazeGame's object goes to null (this is done some time after its destruction)</li> </ul> <p>Once the game is over:</p> <ul> <li>The camera limits are restored and the camera is reset instantaneously.</li> <li>The fog color and render distance are restored</li> <li>The music is changed to the one before the game started</li> <li>A fade out to reveal the main game is done</li> <li>Yield for a second</li> <li>Disable the Text advance's skiptext</li> <li>Reveal the textbox with a grow animation</li> <li>Reassign the blinker</li> </ul> <p>It should be noted that the game will write to flagvar 0 with the score during the process of ending the mini game.</p> <p>As for the camera change, this turns out to be the cause of a quirk because while the game initially was intended to move the camera instantaneously, it needs to use the default speed after it is fully initialized which is what SetText is doing. However, it does so too early so it affects the game's start which makes the camera slowly move towards its starting position on the first floor.</p>"},{"location":"SetText/Individual%20commands/Emoticon/","title":"Emoticon","text":"<p>Show an emoticon above an Entity for a given amount of frames.</p>"},{"location":"SetText/Individual%20commands/Emoticon/#syntax","title":"Syntax","text":"<pre><code>|emoticon,entity,type,time|\n</code></pre>"},{"location":"SetText/Individual%20commands/Emoticon/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Emoticon/#entity-int-string","title":"<code>entity</code>: int | string","text":"<p>The Entity that this command refers to. The int form is a regular Entity id and it must not resolve to null or an exception will be thrown. The string form are only applicable if the caller isn't null and it can be one of the following when not in battle (if in battle, this is interpreted as an int which will cause an exception to be thrown):</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Emoticon/#type-int","title":"<code>type</code>: int","text":"<p>The type of emoticon to use. This must be a valid emoticon type or an exception will be thrown. Here are the valid emoticon types:</p> Value Description -1 None 0 A talking face 1 A ? icon 2 A red ! icon 3 An animated ellipsis icon 4 The Detector medal icon 5 A green ! icon"},{"location":"SetText/Individual%20commands/Emoticon/#time-int","title":"<code>time</code>: int","text":"<p>The amount of frames to show the emoticon for. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/End/","title":"End","text":"<p>Signal to SetText to not wait for a confirmation input at the end after the input string has been fully processed in Dialogue mode</p>"},{"location":"SetText/Individual%20commands/End/#syntax","title":"Syntax","text":"<pre><code>|end|\n</code></pre>"},{"location":"SetText/Individual%20commands/End/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/End/#remarks","title":"Remarks","text":"<p>In Dialogue mode, SetText would normally yield control to the game by setting waitinput to true in the Dialogue Cleanup phase. This command allows to bypass this behavior and prevents the yield entirely. Additionally, if the caller was an Item, it will call Death on it. While it is generally preferred to place this command on the actual end of the line if the caller is an Item, as far as skipping the wait behavior, it does not matter where this command is placed. All it does is set the flag to skip it for later.</p> <p>This commands is only applicable in Dialogue mode. It will not do anything in non dialogue mode.</p>"},{"location":"SetText/Individual%20commands/Entityalive/","title":"Entityalive","text":"<p>Redirect if an Entity id resolves to not null and enabled, otherwise, this will not do anything and continue processing.</p>"},{"location":"SetText/Individual%20commands/Entityalive/#syntax","title":"Syntax","text":"<pre><code>|entityalive,entity,redirect|\n</code></pre>"},{"location":"SetText/Individual%20commands/Entityalive/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Entityalive/#entity-int","title":"<code>entity</code>: int","text":"<p>The Entity id to check for not being null and enabled. This must be a valid Entity id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Entityalive/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The Dialogue line id to redirect to if applicable. This must be a valid Dialogue line id or an exception will be thrown when redirecting.</p>"},{"location":"SetText/Individual%20commands/Entityalive/#remarks","title":"Remarks","text":"<p>The actual check is performed using the activeInHierarchy field of the entity's GameObject. This means that not only the Entity needs to be active to redirect, but all of its parent too.</p> <p>If a redirection happen, the input string is replaced by an OrganiseLines version of the resolved <code>redirect</code> dialogue line and processing resumes at the start of the input string to accommodate its replacement.</p>"},{"location":"SetText/Individual%20commands/Event/","title":"Event","text":"<p>Start an Event or set if we are in an event or not.</p>"},{"location":"SetText/Individual%20commands/Event/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|event,eventid|\n</code></pre> <p>(2)</p> <pre><code>|event,inevent|\n</code></pre>"},{"location":"SetText/Individual%20commands/Event/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Event/#eventid-int","title":"<code>eventid</code>: int","text":"<p>The Event id to start. This must be a valid event id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Event/#inevent-true-false","title":"<code>inevent</code>: <code>true</code> | <code>false</code>","text":"<p>Specify whether we are in an event or not. This must be <code>true</code> or <code>false</code> or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Event/#remarks","title":"Remarks","text":"<p>Starting an event will set end to true. During Dialogue Cleanup, <code>overridefollower</code> is set to true which disables automatic following behaviours from the followers and SetText is instructed to not release the <code>minipause</code> lock which the event starting procedure would have set beforehand. The caller of the EventControl is set to the caller of the SetText call.</p> <p>Syntax (2) is a way to have the game be restricted as if it was in an event without actually being in one. It is recommended to enclose the whole input string with <code>|event,true|</code> and <code>|event,false|</code> if this is desired. It should be noted that this is unnecessary with syntax (1): the event starting procedure will already set <code>inevent</code> to true.</p>"},{"location":"SetText/Individual%20commands/Exitgame/","title":"Exitgame","text":"<p>Immediately stops the game's execution if called from the StartMenu's settings or reset the game's scene after a transition if called from the pause menu after loading a file.</p>"},{"location":"SetText/Individual%20commands/Exitgame/#syntax","title":"Syntax","text":"<pre><code>|exitgame|\n</code></pre>"},{"location":"SetText/Individual%20commands/Exitgame/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Exitgame/#remarks","title":"Remarks","text":"<p>This command also sets end to true.</p> <p>The way the game determines if it should immediately stop the execution or reset is by checking the pause menu is present and that calledfrommain is true. This is the case on the StartMenu's settings because the settings menu actually requires the pausemenu to be present and the flag is set when going to this ItemList from the StartMenu. If it was called from the StartMenu, this will stop the execution. If it wasn't, it will first fade the music by a rate of 0.15, play a fadein transition with 0.1 speed and yield for 0.1 seconds before finally resetting the game's scene.</p> <p>This command is unused under normal gameplay. The game has more controlled ways to do the same task and it's all handled externally of SetText now. This command was presumably made obsolete.</p>"},{"location":"SetText/Individual%20commands/Exp/","title":"Exp","text":"<p>Set, add or remove Exploration Points to the party by a value or by a value stored in a flagvar slot.</p>"},{"location":"SetText/Individual%20commands/Exp/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|exp,value|\n</code></pre> <p>(2)</p> <pre><code>|exp,flagvar|\n</code></pre> <p>(3)</p> <pre><code>|exp,operation,value|\n</code></pre> <p>(4)</p> <pre><code>|exp,operation,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Exp/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Exp/#value-int","title":"<code>value</code>: int","text":"<p>The amount of Exploration Points to set/add/remove. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Exp/#flagvar-varint","title":"<code>flagvar</code>: <code>var</code>int","text":"<p>The flagvar slot to get the value of Exploration Points to set/add/remove. This must be a valid flagvar slot or an exception will be thrown. This must contains <code>var</code> once otherwise the value will be interpreted as <code>value</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Exp/#operation-add-sub","title":"<code>operation</code>: <code>add</code> | <code>sub</code>","text":"<p>The operation to perform using the current amount of Exploration Points and the resolved value. <code>add</code> will add the value to the current amount while <code>sub</code> will subtract the value to the current amount. The new value is clamped from 0 to the required amount for the next level - 1 after the operation. Any other value will be interpreted as syntax <code>value</code>/<code>flagvar</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Exp/#remarks","title":"Remarks","text":"<p>This command only manages the actual Exploration Points counter, it does not manage the rank. For that one, use level.</p>"},{"location":"SetText/Individual%20commands/Face/","title":"Face","text":"<p>Instruct the party or an Entity to face towards another one and optionally have that Entity also face towards back.</p>"},{"location":"SetText/Individual%20commands/Face/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|face,party,entity2|\n</code></pre> <p>(2)</p> <pre><code>|face,entity1,entity2|\n</code></pre> <p>(3)</p> <pre><code>|face,entity1,entity2,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/Face/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Face/#party","title":"<code>party</code>","text":"<p>This value indicates to operate with syntax (1) and will have each party's Entity face towards <code>entity2</code>. Any other value will be interpreted as <code>entity1</code>.</p>"},{"location":"SetText/Individual%20commands/Face/#entity1-int-string","title":"<code>entity1</code>: int | string","text":"<p>The Entity to instruct to face towards <code>entity2</code>. The int form is a regular Entity id and its restriction for valid values applies. The string is only applicable if caller isn't null and it will be interpreted as the int form otherwise. This form can be one of the following:</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Face/#entity2-int-string","title":"<code>entity2</code>: int | string","text":"<p>The target Entity that <code>entity1</code> will face towards. The int form is a regular Entity id and its restriction for valid values applies. The string is only applicable if caller isn't null and it will be interpreted as the int form otherwise. This form can be one of the following:</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Face/#true","title":"<code>true</code>","text":"<p>Indicate to have <code>entity2</code> also face towards <code>entity1</code>. Any other value will be ignored.</p>"},{"location":"SetText/Individual%20commands/Face/#remarks","title":"Remarks","text":"<p>In syntax (2) and (3), <code>entity1</code> will only change its flip to face towards <code>entity2</code>, but on syntax (1) and on syntax (3) when <code>entity2</code> faces towards <code>entity1</code>, FaceTowards is used instead.</p>"},{"location":"SetText/Individual%20commands/FadeIn/","title":"FadeIn","text":"<p>Play a fade in visual transition with options to specify the speed, color and the ability to destroy the caller after a fadeout done right after this one.</p>"},{"location":"SetText/Individual%20commands/FadeIn/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|fadein|\n</code></pre> <p>(2)</p> <pre><code>|fadein,speed|\n</code></pre> <p>(3)</p> <pre><code>|fadein,speed,data|\n</code></pre> <p>(4)</p> <pre><code>|fadein,speed,data,color|\n</code></pre> <p>(5)</p> <pre><code>|fadein,speed,data,kill|\n</code></pre>"},{"location":"SetText/Individual%20commands/FadeIn/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/FadeIn/#speed-float","title":"<code>speed</code>: float","text":"<p>The speed of the transition expressed in the desired percentage of color blending over the total amount of blending left to apply each frame. The speed is frame time independent, but the game will try its best to honor it. This must be a valid float or an exception will be thrown. The default value is 0.05.</p>"},{"location":"SetText/Individual%20commands/FadeIn/#data-int","title":"<code>data</code>: int","text":"<p>This parameter is parsed and sent to the transition coroutine, but is effectively not used. It still must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/FadeIn/#color-char","title":"<code>color</code>: char","text":"<p>The color index to use from the game's text color palette for the fade in. This value must be an int value between <code>0</code> and <code>9</code> or the value will be ignored. If a string is specified, only the first char counts. The default value is 0 or pure black.</p> <p>The colors available are:</p> <ul> <li>0: 000000 (pure black, fully opaque).</li> <li>1: EE0B0B (mostly red, fully opaque).</li> <li>2: 00E700 (mostly green, fully opaque).</li> <li>3: 0000FF (pure blue, fully opaque).</li> <li>4: FFFFFF (pure white, fully opaque).</li> <li>5: A9F1FF (sky blue, fully opaque).</li> <li>6: FFD500 (mostly yellow, fully opaque).</li> <li>7: 7C7C7C (gray, 214/255 opaque).</li> <li>8: 00CC01 (mostly darker green than 2, fully opaque).</li> <li>9: FFA400 (mostly orange, fully opaque).</li> </ul>"},{"location":"SetText/Individual%20commands/FadeIn/#kill","title":"<code>kill</code>","text":"<p>This parameter's presence instructs the command to operate using syntax (5) which also plays a fade out transition after the fade in and destroy the caller between the transitions. Any other value is ignored.</p>"},{"location":"SetText/Individual%20commands/FadeIn/#remarks","title":"Remarks","text":"<p>After the parameters are gathered, PlayTransition is called which first starts by stopping the previous transition coroutine if it exist as well as destroy all GameObjects used during said transition. After that, the transition coroutine is started.</p> <p>This Coroutine first creates a GameObject called \"Dimmer\" with a SpriteRender bound to a texture with a uniform transparent color. This dimmer is then set to cover the whole screen with the layer set to 5, the parent to the GUICamera, the sortingOrder to 9999 and the local position to (0.0, 0.0, 10.0) without angles. The transition itself is done by doing a Lerp from the texture's color to the target color at percentage <code>speed</code> per framestep (which is 1 ideally, but this is adjusted based on the frame time). This is done until the color is fully opaque with a yield for a frame between each iteration.</p> <p>Additionally, if the transition takes at least 600 frames (about 10 seconds), a failsafe will trigger that will force the transition to stop.</p> <p>As for using syntax (5), this will follow up with a special version of fadeout. First, the caller is set to not be talking. Then, a yield of 0.75 + (1 - <code>speed</code>) seconds is performed (which means the default is 1.7 seconds). The caller is then destroyed and PlayTransition is called with a fadeout instead using the same parameters than the one sent to this command. Finally, a second yield is done whose time is identical to the one performed before the fadeout. While the fadeout itself isn't a command getting processed, the actual transition is performed in an equivalent way semantically.</p> <p>If syntax (5) is not used, a fadeout has to happen after this command to be able to see the screen. The transition is only visual in nature.</p>"},{"location":"SetText/Individual%20commands/FadeOut/","title":"FadeOut","text":"<p>Play a fade out visual transition with options to specify the speed after a fadein.</p>"},{"location":"SetText/Individual%20commands/FadeOut/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|fadeout|\n</code></pre> <p>(2)</p> <pre><code>|fadeout,speed|\n</code></pre> <p>(3) (while it technically works, this is the same then syntax (2) in practice)</p> <pre><code>|fadeout,speed,data|\n</code></pre> <p>(4) (while it technically works, this is the same then syntax (2) in practice)</p> <pre><code>|fadeout,speed,data,color|\n</code></pre>"},{"location":"SetText/Individual%20commands/FadeOut/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/FadeOut/#speed-float","title":"<code>speed</code>: float","text":"<p>The speed of the transition expressed in the desired percentage of color blending over the total amount of blending left to apply each frame. The speed is frame time independent, but the game will try its best to honor it. This must be a valid float or an exception will be thrown. The default value is 0.05.</p>"},{"location":"SetText/Individual%20commands/FadeOut/#data-int","title":"<code>data</code>: int","text":"<p>This parameter is parsed and sent to the transition coroutine, but is effectively not used. If specified, it still must be a valid int or an exception will be thrown. This can be ignored entirely.</p>"},{"location":"SetText/Individual%20commands/FadeOut/#color-char","title":"<code>color</code>: char","text":"<p>This parameter is parsed and sent to the transition coroutine, but it is effectively not used. This can be ignored entirely.</p>"},{"location":"SetText/Individual%20commands/FadeOut/#remarks","title":"Remarks","text":"<p>After the parameters are gathered, PlayTransition is called which first starts by stopping the previous transition coroutine if it exist. After that, the transition coroutine is started.</p> <p>This coroutine will only do anything if there was an existing transition GameObject that was created during the previous fadein. Consequently, this command will do nothing if a fadein wasn't performed before. The transition itself is done by doing a Lerp from the dimmer's color to a transparent color at percentage <code>speed</code> per framestep (which is 1 ideally, but this is adjusted based on the frame time). This is done until the color is fully transparent with a yield for a frame between each iteration. After the transition is complete, the dimmer GameObject is destroyed.</p> <p>Additionally, if the transition takes at least 600 frames (about 10 seconds), a failsafe will trigger that will force the transition to stop.</p>"},{"location":"SetText/Individual%20commands/Fadeletter/","title":"Fadeletter","text":"<p>Toggle the fade letter font effect from inactive to active or from active to inactive.</p>"},{"location":"SetText/Individual%20commands/Fadeletter/#syntax","title":"Syntax","text":"<pre><code>|fadeletter|\n</code></pre>"},{"location":"SetText/Individual%20commands/Fadeletter/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Fadeletter/#remarks","title":"Remarks","text":"<p>Fade letter is a font effect that will have every letter initially render fully transparent, but slowly fade into their target color.</p> <p>This font effect only works in Regular Letter Rendering in conjunction with dropshadow.</p>"},{"location":"SetText/Individual%20commands/Fademusic/","title":"Fademusic","text":"<p>Fade the music to silence with a configurable fading speed.</p>"},{"location":"SetText/Individual%20commands/Fademusic/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|fademusic|\n</code></pre> <p>(2)</p> <pre><code>|fademusic,fadespeed|\n</code></pre>"},{"location":"SetText/Individual%20commands/Fademusic/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Fademusic/#fadespeed-float","title":"<code>fadespeed</code>: float","text":"<p>The speed at which the music will fade to silence. This must be a valid float or an exception will be thrown. The default value is 0.025.</p>"},{"location":"SetText/Individual%20commands/Faketail/","title":"Faketail","text":"<p>Hide/shrink then reveal/grow the current textbox with a 0.15 seconds yield between after either operation.</p>"},{"location":"SetText/Individual%20commands/Faketail/#syntax","title":"Syntax","text":"<pre><code>|faketail|\n</code></pre>"},{"location":"SetText/Individual%20commands/Faketail/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Faketail/#remarks","title":"Remarks","text":"<p>This command does nothing if the current textbox is null or it doesn't have a DialogueAnim.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Fixchompy/","title":"Fixchompy","text":"<p>Set Chompy's <code>following</code> to the last party's Entity.</p>"},{"location":"SetText/Individual%20commands/Fixchompy/#syntax","title":"Syntax","text":"<pre><code>|fixchompy|\n</code></pre>"},{"location":"SetText/Individual%20commands/Fixchompy/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Fixchompy/#remarks","title":"Remarks","text":"<p>If Chompy isn't present, this command does nothing.</p>"},{"location":"SetText/Individual%20commands/Flag/","title":"Flag","text":"<p>Set a specific flag slot or a one whose id is in a flagvar to a value.</p>"},{"location":"SetText/Individual%20commands/Flag/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|flag,flagid,value|\n</code></pre> <p>(2)</p> <pre><code>|flag,dummy,flagvar,value|\n</code></pre>"},{"location":"SetText/Individual%20commands/Flag/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Flag/#dummy-var","title":"<code>dummy</code>: var","text":"<p>This parameter has no meaning, but its presence is required to process this command using the (2) form since the amount of parameters is what determines how the flags slot is obtained.</p>"},{"location":"SetText/Individual%20commands/Flag/#flagid-int","title":"<code>flagid</code>:  int","text":"<p>The flag slot to set. This must corresponds to an integer of a valid flag slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Flag/#flagvar-int","title":"<code>flagvar</code>:  int","text":"<p>The flagvar containing the id of the flag slot to set. This must corresponds to an integer of a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Flag/#value-true-false","title":"<code>value</code>: <code>true</code> | <code>false</code>","text":"<p>The value to set the flag slot to. This must be equal to <code>true</code> or <code>false</code> without case sensitivity or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Flagvalue/","title":"Flagvalue","text":"<p>Replace the text of this command by the string representation of a flag slot or one where the slot is contained in a flagvar slot.</p>"},{"location":"SetText/Individual%20commands/Flagvalue/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|flagvalue,flags|\n</code></pre> <p>(2)</p> <pre><code>|flagvalue,dummy,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Flagvalue/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Flagvalue/#flags-int","title":"<code>flags</code>: int","text":"<p>The flag slot to print its the bool value's string representation. This must be a valid flag slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Flagvalue/#dummy-var","title":"<code>dummy</code>: var","text":"<p>This value is ignored, its presence is only to indicate to operate in syntax (2).</p>"},{"location":"SetText/Individual%20commands/Flagvalue/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot whose value is the flag value's string representation to print. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Flagvalue/#remarks","title":"Remarks","text":"<p>This command is intended for troubleshooting purposes. Its only usage is in the TestRoom.</p> <p>This command resumes processing at the same position than this command to accommodate for the text replacement.</p>"},{"location":"SetText/Individual%20commands/Flip/","title":"Flip","text":"<p>Toggle or set the <code>flip</code> state of an Entity or the party.</p>"},{"location":"SetText/Individual%20commands/Flip/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|flip,party|\n</code></pre> <p>(2)</p> <pre><code>|flip,party,newflip|\n</code></pre> <p>(3)</p> <pre><code>|flip,entity|\n</code></pre> <p>(4)</p> <pre><code>|flip,entity,newflip|\n</code></pre>"},{"location":"SetText/Individual%20commands/Flip/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Flip/#party","title":"<code>party</code>","text":"<p>This value indicates to operate with syntax (1) / (2) and will have each party Entity's <code>flip</code> state be affected. Any other value will be interpreted as <code>entity</code>.</p>"},{"location":"SetText/Individual%20commands/Flip/#entity-int-string","title":"<code>entity</code>: int | string","text":"<p>The Entity to set its flip state. The int form is a regular Entity id and its restriction for valid values applies. The string is only applicable if caller isn't null and it will be interpreted as the int form otherwise. This form can be one of the following:</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Flip/#newflip-true-false","title":"<code>newflip</code>: <code>true</code> | <code>false</code>","text":"<p>The new flip state to set <code>entity</code> or the party. Any other value than <code>true</code> or <code>false</code> will throw an exception.</p>"},{"location":"SetText/Individual%20commands/Flip/#remarks","title":"Remarks","text":"<p>Syntax (1) and (3) toggles the flip state while (2) and (4) sets it to a specific one.</p>"},{"location":"SetText/Individual%20commands/Follow/","title":"Follow","text":"<p>An shorthand of addfollower that uses syntax (2). </p>"},{"location":"SetText/Individual%20commands/Follow/#syntax","title":"Syntax","text":"<pre><code>|follow|\n</code></pre>"},{"location":"SetText/Individual%20commands/Follow/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Font/","title":"Font","text":"<p>Change the current fonttype used by SetText from now on.</p>"},{"location":"SetText/Individual%20commands/Font/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|font,fonttype|\n</code></pre> <p>(2)</p> <pre><code>|font,fonttype,lockcontrol|\n</code></pre>"},{"location":"SetText/Individual%20commands/Font/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Font/#fonttype-int","title":"<code>fonttype</code>: int","text":"<p>The fonttype to set the current one to. This must be a valid fonttype or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Font/#lockcontrol-lock-var","title":"<code>lockcontrol</code>: <code>lock</code> | var","text":"<p>Set whether or not to honor fonttype overrides rules concerning the current languageid during Letter processing. A value of <code>lock</code> indicates to not respect them while any other value indicates to honor them. This can be toggled back and forth during the SetText call, but the default at the start of the SetText call is to honor these rules.</p> <p>The default value is to not change this setting and keep using the current state of it.</p>"},{"location":"SetText/Individual%20commands/Font/#remarks","title":"Remarks","text":"<p>Normally, during the Setup phase, the font gets overridden to <code>Uzura</code> in <code>Japanese</code> and to <code>ONEMobilePOP</code> in <code>Korean</code>, but this command allows to override this behavior. It can even disregard it completely by placing this command at the start of the input string.</p> <p>However, doing so would still allow Letter processing to override the fonttype to the same values under the same languages if in Dialogue mode while not processing a numberprompt. The <code>lockcontrol</code> allows to also override this which effectively mean that this command allows complete control over which fonttype to use regardless of the languageid.</p>"},{"location":"SetText/Individual%20commands/Forcewait/","title":"Forcewait","text":"<p>Yields for a certain amount of seconds if unpaused and stop a Text advance <code>skiptext</code> if one was in progress.</p>"},{"location":"SetText/Individual%20commands/Forcewait/#syntax","title":"Syntax","text":"<pre><code>|forcewait,seconds|\n</code></pre>"},{"location":"SetText/Individual%20commands/Forcewait/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Forcewait/#seconds-float","title":"<code>seconds</code>: float","text":"<p>The amount of seconds to yield for. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Forcewait/#remarks","title":"Remarks","text":"<p>If the pause menu is active, this command does nothing.</p> <p>If honoring the skiptext is needed, use wait instead.</p>"},{"location":"SetText/Individual%20commands/Fwait/","title":"Fwait","text":"<p>An alias of forcewait</p>"},{"location":"SetText/Individual%20commands/Fwait/#syntax","title":"Syntax","text":"<pre><code>|fwait,seconds|\n</code></pre>"},{"location":"SetText/Individual%20commands/Fwait/#parameters","title":"Parameters","text":"<p>The same than forcewait.</p>"},{"location":"SetText/Individual%20commands/GetFromMap/","title":"GetFromMap","text":"<p>Replace the text of this command to a dialogue line that belongs to a specific Map.</p>"},{"location":"SetText/Individual%20commands/GetFromMap/#syntax","title":"Syntax","text":"<pre><code>|getfrommap,map,line|\n</code></pre>"},{"location":"SetText/Individual%20commands/GetFromMap/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/GetFromMap/#map-int","title":"<code>map</code>: int","text":"<p>The Map id to get the dialogue line from. This must be a valid Map id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/GetFromMap/#line-int","title":"<code>line</code>: int","text":"<p>The line id that belongs to the specific map. This must be an int between 0 and the amount of lines the map has - 1 or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/GetFromMap/#remarks","title":"Remarks","text":"<p>The text replacement occurs with an OrganiseLines version of the resolved line.</p> <p>This command also supports the GlobalCommand system by preprocessing the line before resuming processing at it.</p> <p>Processing will resume at the same position than this command to accommodate the text replacement.</p>"},{"location":"SetText/Individual%20commands/Getstorage/","title":"Getstorage","text":"<p>Replace the text of this command by the remaining amount of free items space of the storage (this is 35 - amount of items in storage under normal gameplay).</p>"},{"location":"SetText/Individual%20commands/Getstorage/#syntax","title":"Syntax","text":"<pre><code>|getstorage|\n</code></pre>"},{"location":"SetText/Individual%20commands/Getstorage/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Getstorage/#remarks","title":"Remarks","text":"<p>This command will cause SetText to resume processing at the same character position to accommodate the text replacement of the input string at the position this command is being processed.</p>"},{"location":"SetText/Individual%20commands/Gettail/","title":"Gettail","text":"<p>An alias of tail where the int form of <code>entity</code> refers to the AnimID of the entity to set the tailtarget instead of its Entity id.</p>"},{"location":"SetText/Individual%20commands/Gettail/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|gettail,entity|\n</code></pre> <p>(2)</p> <pre><code>|gettail,entity,transition|\n</code></pre>"},{"location":"SetText/Individual%20commands/Gettail/#parameters","title":"Parameters","text":"<p>Refer to the tail documentation, but the only change is for the <code>entity</code> parameter (otherwise, this command behaves exactly like tail).</p> <p>The int form of <code>entity</code> refers to an AnimID which allows to set the tailtarget without knowing the Entity id, but still knowing the AnimID. </p> <p>If it is between 0 and 2 (Team Snakemouth's AnimIDs), this will be resolve to the corresponding player entity first if it is in the party. </p> <p>For any other int (or if the Team Snakemouth AnimIDs isn't in the party), a search will be performed to get every EntityControl present and resolve to the first one that has the desired AnimID.</p> <p>If it isn't found, this can lead to undesired behaviors because it will resolve to a null entity, but unlike specifying <code>null</code> as the value, it will not remove the existing tailtarget. It will remove the bleep however as well as shrink the textbox if <code>tranistion</code> isn't instant which effectively leaves a hidden textbox with a dangling tailtarget.</p> <p>Any other value for this parameter functions the exact same way than tail and it supports every other value that aren't in the int form.</p>"},{"location":"SetText/Individual%20commands/Gettail/#remarks","title":"Remarks","text":"<p>It should be noted that for searching a non player Team Snakemouth entity, the list is obtained via FindObjectsOfType which does not guarantee its order. This means that if multiple entities with the desired AnimID are present, it is ambiguous which one the command will resolve to. For best results, it's best to use this command on a non Team Snakemouth entity only if it's possible to assume only one entity with the desired AnimID is present.</p> <p>By the same token, this method of searching is much slower than the traditional Entity id method offered by tail so this command should only be used if needed and not too often.</p>"},{"location":"SetText/Individual%20commands/Giveitem/","title":"Giveitem","text":"<p>Give an item, Medal, Crystal Berry or berries to the player where its identification or amount is specified directly or is retrieved from a flagvar with proper animations, presentations and checks that this action does not exceed the maximum amount of standard items if it is one.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|giveitem,type,itemid,redirect|\n</code></pre> <p>(2)</p> <pre><code>|giveitem,type,itemid,redirect,entityid|\n</code></pre> <p>(3)</p> <pre><code>|giveitem,type,var,flagvar,redirect|\n</code></pre> <p>(4)</p> <pre><code>|giveitem,type,var,flagvar,redirect,entityid|\n</code></pre> <p>(5) (Only use for testing purposes)</p> <pre><code>|giveitem,all|\n</code></pre>"},{"location":"SetText/Individual%20commands/Giveitem/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Giveitem/#type-int","title":"<code>type</code>: int","text":"<p>The type of the item to add. This must be a valid int or an exception will be thrown.</p> <p>Here are the different values available:</p> Value Type -1 Berries 0 Standard item 1 Key item 2 Medal 3 Crystal Berry <p>Any other value will cause undefined behaviors.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#itemid-int","title":"<code>itemid</code>: int","text":"<p>The item id whose meaning depends on <code>itemtype</code>. This must be a valid int or an exception will be thrown.</p> <ul> <li>If <code>itemtype</code> is berries, this corresponds to the amount of berries to add to the current amount (it can be negative which will decrease the amount).</li> <li>If <code>itemtype</code> is standard or key Item, this corresponds to the Item id to give and it must be a valid Item id or an exception will be thrown.</li> <li>If <code>itemtype</code> is a Medal, this corresponds to the medal id to give and it must be a valid Medal id or an exception will be thrown. (Note:  <code>itemid</code> is overridden to the next medal in flagstring 13 (the MYSTERY? Medal id list) if flags 681 (MYSTERY?) is true).</li> <li>If <code>itemtype</code> is a Crystal Berry, this corresponds to the crystalbfflags slot to enable and it must be a valid crystalbfflags slot or an exception will be thrown.</li> </ul>"},{"location":"SetText/Individual%20commands/Giveitem/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The Dialogue line id to continue processing at after giving the item if it is given. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#entityid-int","title":"<code>entityid</code>: int","text":"<p>The Entity id used to perform the animation of getting the item and to determine where to render the item sprite. This must be a valid Entity id or an exception will be thrown. The default value is -1 (the first player's Entity which is the current lead).</p>"},{"location":"SetText/Individual%20commands/Giveitem/#var","title":"<code>var</code>","text":"<p>The presence of this parameter indicates to operate in syntax (3) or (4) which allows to retrieve the <code>itemid</code> from a flagvar instead. Any other value will be interpreted as <code>itemid</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot to get the <code>itemid</code> from. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#all","title":"<code>all</code>","text":"<p>The presence of this parameter indicates to operate in syntax (5) which will add all Items in the standard inventory and nothing else without any checks with amount of standard items allowed. Any other value will be interpreted as the <code>type</code> which may thrown an exception.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#remarks","title":"Remarks","text":"<p>This is a broader version of additemtoss, but unlike it, it will not prompt to toss a standard item if giving it would exceed the maximum amount allowed in the inventory. If the prompt is desired under that condition, use additemtoss instead. Otherwise, this command provides more flexibility.</p> <p>This commands resumes processing at the start of the input string to accommodate its replacement if the item was given, otherwise, processing resumes normally.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#about-the-inventory-limit-of-standard-items","title":"About the inventory limit of standard items","text":"<p>It is not safe to use this command if it is possible to exceed the maximum amount because while the command processing gets stopped, it's done after the description box is created if applicable which leads to improper rendering. It is recommended to check this using checkinvqtd before processing this command or use additemtoss.</p> <p>Syntax (5) bypasses this check however giving all Items in the standard items inventory allowing to go over the maximum amount. This is done for testing purposes: its only usage is in the TestRoom and it has no other logic than that unlike the other syntax forms.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#flagstring-and-flagvar-used","title":"flagstring and flagvar used","text":"<p>This commands writes to the following:</p> <ul> <li>flagstring 0: The Item or Medal name if applicable or menu menutext 112 (<code>Crystal Berry</code>) if <code>itemtype</code> is set to Crystal Berry. This is used to render the item get text.</li> <li>flagstring 1: The default article (<code>a</code>) or the Item or Medal article if applicable which is used for rendering the item get text.</li> <li>flagvar 10: The buying price of the Item or Medal if applicable</li> <li>flagvar 14: This is incremented if <code>itemtype</code> is set to Crystal Berry.</li> <li>flag 31: if <code>itemtype</code> is set to Medal, this is set to true if it was false before because this command will give the medal tutorial if it wasn't given.</li> </ul>"},{"location":"SetText/Individual%20commands/Giveitem/#commands-logic","title":"Command's logic","text":"<p>This command's logic behaves very differently based on the <code>itemtype</code> and the resolved <code>itemid</code> because the different types and ids requires different presentations and different behaviors.</p>"},{"location":"SetText/Individual%20commands/Giveitem/#description-box-rendering","title":"Description box rendering","text":"<p>This uses a version of CreateDescWindow that is different than the one used for regular Item objects. It will be documented here as it's the only usage of it.</p> <p>A description box will be created if <code>itemtype</code> isn't berries or Crystal Berries and the caller isn't a CaravanBadge or a Shop (for key items, it also needs to not be Game Tokens and not be in an interior)</p> <ul> <li>Create a pure white standard 9box of type 0 relatively positioned at (0.0, -4.4, 10.0) of the GUICamera with a size of (11.0, 3.0) with a sort order of -3 with a grow animation and assign it to descwindow</li> <li>Sets flagvar 10 to the buying price price of the item or medal</li> <li>Calls SetText in non Dialogue mode with the input string |single||singlebreak,<code>itemdescbreak</code>| where <code>itemdescbreak</code> is 10.5 on <code>English</code> and 9.9 on any other language followed by the item or medal description:<ul> <li>Font is <code>BubblegumSans</code></li> <li>No line breaks (this is already manually controlled via the input string)</li> <li>No tridimensional</li> <li>Position is (-5.2, 0.65, 1.0)</li> <li>No camera offset</li> <li>Size is (0.675, 0.675)</li> <li>Parent is the descwindow created earlier</li> <li>No caller</li> </ul> </li> </ul>"},{"location":"SetText/Individual%20commands/Giveitem/#other-rendering-setup","title":"Other rendering setup","text":"<ul> <li>Setup a shrink animation to the textbox</li> <li>Stop the <code>entity</code> rigidBody's velocity</li> <li>Setup an array of 3 SpriteRender</li> <li>Assign the first element of the array to the sprite of the item named <code>tempitem</code> (the sprite is gui sprite 83 (the Crystal Berry icon) if <code>itemtype</code> is Crystal Berry and for berries, it's the berry sprite with the highest value that fits in the amount from <code>itemid</code>)<ul> <li>This is positioned at the <code>entity</code>'s location + (0.0, 2.75, -0.1) at the same angles than the camera.</li> <li>The layer is set to 14</li> </ul> </li> <li>Assign the second element of the array to a new object named <code>fauxmessage</code> at (0.0, 3.0, 10.0) from the GUICamera using the boxstyle 4</li> <li>Create a new SpriteRender named <code>back</code> childed to <code>tempitem</code> at (0.0, 0.0, 0.2) with no rotation using gui sprite 85 (this is the star shaped background rendered behind the item)</li> <li>Set the layer of <code>back</code> to 14 and its scale to Vector3.zero with a grow animation (this effectively setup a grow while the sprite is hidden at first).</li> <li>Set the color of <code>back</code> to 00B2B2 if <code>itemtype</code> is Standard item, FF4C66 if it's Key items and FF7F00 for everything else</li> </ul>"},{"location":"SetText/Individual%20commands/Giveitem/#itemtype-specific-handling","title":"<code>itemtype</code> specific handling","text":"<p>The <code>itemtype</code> have their own specific logic:</p> <ul> <li>berries: show the berries counter HUD and increase the current amount by <code>itemid2</code> clamped from 0 to 999 and set flagvar 0 to <code>itemid2</code>, otherwise, hide the HUD counter.</li> <li>Standard or Key items: set flagstring 0 to the Item's name and flagstring 1 to the item's article then add the item to its appropriate inventory.</li> <li>Medal: set flagstring 0 to the Medal's name and flagstring 1 to the Medal's article then add the Medal as unequipped.</li> <li>Crystal Berry: Activate the crystalbfflags slot of <code>itemid</code>, increment flagvar 14 and set flagstring 0 to menutext 112 (<code>Crystal Berry</code>).</li> </ul>"},{"location":"SetText/Individual%20commands/Giveitem/#presentation","title":"Presentation","text":"<ul> <li>Call SetText in non Dialogue mode with the input string |sort,1||center||halfline| followed by menutext 110 (<code>You got |currency,var,0|!</code>) if <code>itemtype</code> is Crystal berry or menutext 107 (<code>You got |string,1| |color,1||string,0||color,0|!</code>) otherwise at Vector3.zero and <code>fauxmessage</code> as the parent.</li> <li>Set the overrideanim of <code>entity</code> to true and its animstate to 4</li> <li>Yield for 0.45 seconds (this lets the grow animation plays).</li> <li>Assign the third element of the SpriteRenderer array to a new sprite called <code>fauxcursor</code> where the parent is <code>fauxmessage</code> using the standard cursor sprite without scaling at (6.0, -2.0, 1.0).</li> <li>Set up <code>fauxcursor</code> to bounce like a normal cursor would</li> <li>Grab the waitinput lock, yield one frame and then yield until the lock is released.</li> </ul>"},{"location":"SetText/Individual%20commands/Giveitem/#cleanup","title":"Cleanup","text":"<ul> <li>Destroy all the SpriteRenders created earlier.</li> <li>Set the textbox to grow.</li> <li>Reset the Text advance's <code>skiptext</code> to false.</li> <li>Set the <code>entity</code>'s animoverride to false and its anim state to 0</li> </ul>"},{"location":"SetText/Individual%20commands/Giveitem/#redirection","title":"Redirection","text":"<ul> <li>If <code>itemtype</code> is Medal and flag 31 is false (the player has yet to receive the medal tutorial):<ul> <li>Assign a string with the value |tail,null||destroydescbox||blank||boxstyle,4| followed by common dialogue 31 (the medal tutorial) followed by |flag,31,true||break||gettail,<code>tailid</code>||boxstyle,0| where <code>tailid</code> is the current tailtarget.</li> </ul> </li> <li>Assign the input string to an OrganiseLines version of <code>redirect</code> prepanded with |destroydescbox||blank| all prepanded with the medal tutorial if it was assigned above.</li> </ul>"},{"location":"SetText/Individual%20commands/Glitchy/","title":"Glitchy","text":"<p>Toggles the glitchy FontEffects that will be effective from this point in Regular Letter Rendering.</p>"},{"location":"SetText/Individual%20commands/Glitchy/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|glitchy|\n</code></pre> <p>(2)</p> <pre><code>|glitchy,1|\n</code></pre>"},{"location":"SetText/Individual%20commands/Glitchy/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Glitchy/#superglitch-1","title":"<code>superglitch</code>: <code>1</code>","text":"<p>Sets this effect to use the <code>superglitch</code> version which is the more aggressive version of glitchy. Any value other than <code>1</code> will be ignored and the behavior will be like (1).</p>"},{"location":"SetText/Individual%20commands/Glitchy/#remarks","title":"Remarks","text":"<p>This turns the glitchy FontEffects from false to true or from true to false depending on its existing state. The state change will affect every letter from the point this command is being processed. </p> <p>This command does nothing in Single Letter Rendering.</p> <p>This command is accumulated for the Backtracking system.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Goto/","title":"Goto","text":"<p>Redirect to a particular dialogue line or a randomly selected one from a list. This has support for appending commands and to not blank the textbox before the replacement.</p>"},{"location":"SetText/Individual%20commands/Goto/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|goto,line|\n</code></pre> <p>(2)</p> <pre><code>|goto,line,keep|\n</code></pre> <p>(3)</p> <pre><code>|goto,line,commands...|\n</code></pre> <p>(4)</p> <pre><code>|goto,random,lines...|\n</code></pre>"},{"location":"SetText/Individual%20commands/Goto/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Goto/#line-int","title":"<code>line</code>: int","text":"<p>The Dialogue line id to replace the input string with. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Goto/#commands-keep-string","title":"<code>commands</code>: <code>keep</code> | string...","text":"<p>When the value is <code>keep</code>, this instruct the command to not prepend a |blank| to the new input string. Any other value will be interpreted as a variable list of Commands syntax string without the delimiting <code>|</code>s. The <code>|</code>s must be omitted in the values as this command will add them during parameter parsing and failure to omit them in the values will break the command parser which will cause undefined behaviors. Refer to each command's syntax for how to properly form a valid command string for each values.</p>"},{"location":"SetText/Individual%20commands/Goto/#random","title":"<code>random</code>","text":"<p>Specifies to randomly select the line from the <code>lines</code> list with a uniform probability distribution. Any other value will be interpreted as the <code>line</code> parameter which will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Goto/#lines-int","title":"<code>lines</code>: int...","text":"<p>The list of dialogue lines to randomly choose from for (4). Each value must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Goto/#remarks","title":"Remarks","text":"<p>After the new input string is obtained, it will append in order the commands defined in <code>commands</code> if it's not <code>keep</code>. It will then call OrganiseLines on the result and prepend a |blank| on the organised string if <code>commands</code> was not <code>keep</code>. The result will become the new input string.</p> <p>After this command is done, processing will resume at the start of the new input string.</p> <p>This is one of the 2 commands alongside next that allows to delimit the textbox's text in the Backtracking system no matter the syntax form.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Halfline/","title":"Halfline","text":"<p>An alias of line where <code>linespacing</code> is 0.5.</p>"},{"location":"SetText/Individual%20commands/Halfline/#syntax","title":"Syntax","text":"<pre><code>|halfline|\n</code></pre>"},{"location":"SetText/Individual%20commands/Halfline/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Halfline/#remarks","title":"Remarks","text":"<p>See the line page for more details on the function of the command as this one behaves the same way where <code>linespacing</code> is set to 0.5.</p> <p>There is one issue specific to this command and quarterline however: In Regular Letter Rendering and Dialogue mode, this command is accumulated for the Backtracking system twice instead of only once. This is because being in Dialogue mode no matter the letter rendering method will accumulate it before processing the command in the Vertical bar processing, but since this command is also an alias of line, it will also accumulate it a second time if the rendering method is Regular Letter Rendering which makes it repeat twice in a row when backtracking to the textbox containing the command.</p> <p>This commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it.</p> <p>This is one of the command supported by testdiag if the command name part is written as <code>line</code> with case sensitivity.</p>"},{"location":"SetText/Individual%20commands/Halt/","title":"Halt","text":"<p>Completely stall SetText via an infinite loop that yields a frame.</p>"},{"location":"SetText/Individual%20commands/Halt/#syntax","title":"Syntax","text":"<pre><code>|halt|\n</code></pre>"},{"location":"SetText/Individual%20commands/Halt/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Halt/#remarks","title":"Remarks","text":"<p>This command will provoke an infinite stall by yielding every frames from now on. There are no way to stop it unless the entire SetText coroutine call is saved into a reference and StopCoroutine is called on it or if the GameObject that started it is destroyed.</p> <p>On Dialogue mode, this will completely softlock the game because of the message lock while on non dialogue mode, the call will linger forever, but so long as no locks were acquired before this command, the game should still function.</p> <p>This command has a special use case in conjunction with the minibubble and destroyminibubble commands which when used together can allow to decide when to destroy any minibubble if this command is sent at the end of the inner SetText call of the minibubble. For more details, check Minibubble &gt; A note about Halt from the minibubble command page.</p>"},{"location":"SetText/Individual%20commands/Heal/","title":"Heal","text":"<p>Heals the party fully or only heal the party's TP.</p>"},{"location":"SetText/Individual%20commands/Heal/#syntax","title":"Syntax","text":"<p>(1) (Fully heals the party)</p> <pre><code>|heal|\n</code></pre> <p>(2)</p> <pre><code>|heal,tp|\n</code></pre>"},{"location":"SetText/Individual%20commands/Heal/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Heal/#tp","title":"<code>tp</code>","text":"<p>This value tells to operate in syntax (2) which heals only the party's TP and shows the HUD after the heal. Any other value will have the healing done like syntax (1), but it will still show the HUD after the heal.</p>"},{"location":"SetText/Individual%20commands/Heal/#remarks","title":"Remarks","text":"<p>Syntax (1) heals both the HP and TP of the party to their max value with particles and healing sound. Syntax (2) only heals the TP, but it does so without particles and healing sound.</p>"},{"location":"SetText/Individual%20commands/Hide/","title":"Hide","text":"<p>Hide or unhide the current textbox in Dialogue mode.</p>"},{"location":"SetText/Individual%20commands/Hide/#syntax","title":"Syntax","text":"<pre><code>|hide|\n</code></pre>"},{"location":"SetText/Individual%20commands/Hide/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Hide/#remarks","title":"Remarks","text":"<p>This commands toggles the shrink property of the <code>DialogueAnim</code> component of the textbox which hides the textbox if it was shown before or it unhides it if it was hidden. This happens with a shrink and grow animation.</p>"},{"location":"SetText/Individual%20commands/Hidemoney/","title":"Hidemoney","text":"<p>Hide the currency count HUD element.</p>"},{"location":"SetText/Individual%20commands/Hidemoney/#syntax","title":"Syntax","text":"<pre><code>|hidemoney|\n</code></pre>"},{"location":"SetText/Individual%20commands/Hidemoney/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Hidemoney/#remarks","title":"Remarks","text":"<p>Specifically, it sets the timer to show it to -1 which will force to hide it.</p>"},{"location":"SetText/Individual%20commands/Hidespeed/","title":"Hidespeed","text":"<p>Set the rate of the shrink/grow animation of the textbox when it is hidden/revealed.</p>"},{"location":"SetText/Individual%20commands/Hidespeed/#syntax","title":"Syntax","text":"<pre><code>|hidespeed,speed|\n</code></pre>"},{"location":"SetText/Individual%20commands/Hidespeed/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Hidespeed/#speed-float","title":"<code>speed</code>: float","text":"<p>The shrink/grow speed to set the textbox to use. This must be a valid float or an exception will be thrown. The default one is 0.5.</p>"},{"location":"SetText/Individual%20commands/Icon/","title":"Icon","text":"<p>Render a gui sprite with a configurable size multiplier and sort value.</p>"},{"location":"SetText/Individual%20commands/Icon/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|icon,spriteindex|\n</code></pre> <p>(2)</p> <pre><code>|icon,spriteindex,size|\n</code></pre> <p>(3)</p> <pre><code>|icon,spriteindex,size,sort|\n</code></pre>"},{"location":"SetText/Individual%20commands/Icon/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Icon/#spriteindex-int","title":"<code>spriteindex</code>: int","text":"<p>The sprite index of the <code>Assets/Resources/sprites/gui</code> file to use. This must be a valid sprite index or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Icon/#size-float","title":"<code>size</code>: float","text":"<p>The multiplier to use for the size vector of the sprite which is normally set to size. This must be a valid float or an exception will be thrown. The default value is 1.0.</p>"},{"location":"SetText/Individual%20commands/Icon/#sort-int","title":"<code>sort</code>: int","text":"<p>The sortingOrder value to use when rendering the sprite. This must be a valid int or an exception will be thrown. The default value is sort.</p>"},{"location":"SetText/Individual%20commands/Icon/#remarks","title":"Remarks","text":"<p>This first creates the sprite childed to the textholder named after <code>spriteindex</code> prepanded with <code>icon</code> at the current offset/line with the resolved size and sort. The local position is adjusted so sprite.pivot / (sprite.pixelsPerUnit * 2.0) is added to it (see issue section below, this isn't correct). If the sprite is index 24 (the hp icon), (-0.1, -0.25) is added to the local position too.</p> <p>The tag of the sprite is set to <code>Letter</code> and it is added to the same list than the one button uses. The current offset/line are then adjusted to be after the icon. Then, the font effects are set so glitchy and fadein are forced to be disabled. The rotation effect is enabled if the sprite is index 146 (the Mothfly speaking scribble) on top of that.</p> <p>If in Dialogue mode, the tailtarget is set to be talking at the end followed by a bleep play and a yield of the current speed if that speed is higher than 0 and there is no Text advance's <code>skiptext</code>.</p> <p>It should be noted that this command does not work correctly under Single Letter Rendering because the offset calculations are off which means the sprite may not render on the screen or it may render at the incorrect position. There is still a mitigation in place where the text of this command is replaced by <code>\\t</code> and the char loop is set to resume at it, but the space gap is too small and it doesn't solve the rendering position of the sprite.</p> <p>This command is accumulated for the Backtracking system.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Icon/#issue-with-the-sprite-position-adjustment","title":"Issue with the sprite position adjustment","text":"<p>When rendering to the current offset/line, the sprite is going to get rendered there at its pivot point, but this is wrong because that point is too far left and down for the sprite to render correctly.</p> <p>The game tries to correct it by adding a vector that is the pivot point (its center) of the sprite divided by double the amount of pixels per unit. The issue is that this math is wrong: the correct math is to add half the width in local space horizontally and a quarter of the height in local space vertically. </p> <p>To get half the width/height in local space, all that's needed is to get the x or y of the sprite's pivot point and divide it by the amount of pixels per unit which is something the sprite knows. To get the quarter height/width, simply divide this by 2. However, this isn't enough: this will give the distance between the border and the center AT NO SCALE which is often larger than desired (hence the <code>size</code> parameter of this command). To fix this, it's possible to multiply the final factor by the localScale of the sprite.</p> <p>The result is a sprite that will be offset by half its width to the right and a quarter of its width up which fixes the original offset differences.</p> <p>This command might still work for some sprites with the broken math, but it is important to keep in mind that not all sprites work due to this.</p>"},{"location":"SetText/Individual%20commands/Igcolmove/","title":"Igcolmove","text":"<p>Ignore all collision with the player to a specific Entity during this SetText call in Dialogue mode.</p>"},{"location":"SetText/Individual%20commands/Igcolmove/#syntax","title":"Syntax","text":"<pre><code>|igcolmove,entity|\n</code></pre>"},{"location":"SetText/Individual%20commands/Igcolmove/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Igcolmove/#entity-int","title":"<code>entity</code>: int","text":"<p>The Entity id or designator to ignore collisions with the player. The int form represents an Entity id and it must be a valid int or an exception will be thrown. If the entity resolves to null, this command does nothing:</p> <ul> <li><code>this</code>: Refers to the tailtarget.</li> <li><code>caller</code>: Refers to the caller.</li> <li>Anything else: Refers to a define if it exists, otherwise, this is interpreted as a regular Entity id which will cause an exception to be thrown.</li> </ul>"},{"location":"SetText/Individual%20commands/Igcolmove/#remarks","title":"Remarks","text":"<p>This command does nothing if the player is null.</p> <p>Specifically, the collisions ignored concern the Entity's ccol, pusher, scol and boxcol if each exists. This also set the hitwall field of the player's Entity to false.</p> <p>In Dialogue mode, the collisions are restored in the Dialogue Cleanup phase if the player is still not null and the game isn't in an event, but in non Dialogue mode, they won't be restored after the SetText call.</p>"},{"location":"SetText/Individual%20commands/Ignorenext/","title":"Ignorenext","text":"<p>Signal SetText to not process the next n commands where n is configurable.</p>"},{"location":"SetText/Individual%20commands/Ignorenext/#syntax","title":"Syntax","text":"<pre><code>|ignorenext,amount|\n</code></pre>"},{"location":"SetText/Individual%20commands/Ignorenext/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Ignorenext/#amount-int","title":"<code>amount</code>: int","text":"<p>The amount of commands to ignore and not process after this one. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Ignorenext/#remarks","title":"Remarks","text":"<p>This command is unused under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Innsleep/","title":"Innsleep","text":"<p>Play the inn sleeping cutscene with configurable final positions and camera controls then yield until it is over.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|innsleep|\n</code></pre> <p>(2)</p> <pre><code>|innsleep,xposition,yposition,zposition|\n</code></pre> <p>(3)</p> <pre><code>|innsleep,xposition,yposition,zposition,true|\n</code></pre> <p>(4)</p> <pre><code>|innsleep,xposition,yposition,zposition,true,xcamlimitneg,ycamlimitneg,zcamlimitneg,xcamlimitpos,ycamlimitpos,zcamlimitpos|\n</code></pre>"},{"location":"SetText/Individual%20commands/Innsleep/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Innsleep/#xposition-float","title":"<code>xposition</code>: float","text":"<p>The x position to place the party after the cutscene. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#yposition-float","title":"<code>yposition</code>: float","text":"<p>The y position to place the party after the cutscene. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#zposition-float","title":"<code>zposition</code>: float","text":"<p>The z position to place the party after the cutscene. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#true","title":"<code>true</code>","text":"<p>Send this value to restore the music after the cutscene to the main map's music. Any other value means to not do it and keep the silence, but it must still be specified to respect the position of the parameters in syntax (4).</p>"},{"location":"SetText/Individual%20commands/Innsleep/#xcamlimitneg-float","title":"<code>xcamlimitneg</code>: float","text":"<p>The z component of the lower camera position limit to set after the cutscene. This must be a valid float or an exception will be thrown. This is mostly useful if the new position of the party is located outside of the current camera limits.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#ycamlimitneg-float","title":"<code>ycamlimitneg</code>: float","text":"<p>The y component of the lower camera position limit to set after the cutscene. This must be a valid float or an exception will be thrown. This is mostly useful if the new position of the party is located outside of the current camera limits.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#zcamlimitneg-float","title":"<code>zcamlimitneg</code>: float","text":"<p>The z component of the lower camera position limit to set after the cutscene. This must be a valid float or an exception will be thrown. This is mostly useful if the new position of the party is located outside of the current camera limits.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#xcamlimitpos-float","title":"<code>xcamlimitpos</code>: float","text":"<p>The x component of the upper camera position limit to set after the cutscene. This must be a valid float or an exception will be thrown. This is mostly useful if the new position of the party is located outside of the current camera limits.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#ycamlimitpos-float","title":"<code>ycamlimitpos</code>: float","text":"<p>The y component of the upper camera position limit to set after the cutscene. This must be a valid float or an exception will be thrown. This is mostly useful if the new position of the party is located outside of the current camera limits.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#zcamlimitpos-float","title":"<code>zcamlimitpos</code>: float","text":"<p>The z component of the upper camera position limit to set after the cutscene. This must be a valid float or an exception will be thrown. This is mostly useful if the new position of the party is located outside of the current camera limits.</p>"},{"location":"SetText/Individual%20commands/Innsleep/#remarks","title":"Remarks","text":"<p>This command plays the whole cutscene including playing the <code>Inn</code> SFX, starting the iris wipe transition and even includes the healing. It can be seen as a very specialized version of an Event, but the cutscene itself isn't one as it has its own coroutine called InnSleep.</p> <p>Before playing the cutscene, the current textbox will have its shrink animation start if it exist and it has a DialogueAnim component.</p> <p>The coroutine call is tracked via the chaptername field which is normally used to play chapter intros, but it is reused here (this is safe because its value will be null by the time the coroutine is over). The game will yield until the coroutine is over and once it is, end is set to true.</p>"},{"location":"SetText/Individual%20commands/Itemname/","title":"Itemname","text":"<p>Set a flagstring to an Item or Medal's name where the id is specified directly or contained in a flagvar.</p>"},{"location":"SetText/Individual%20commands/Itemname/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|itemname,item|\n</code></pre> <p>(2)</p> <pre><code>|itemname,item,flagstring|\n</code></pre> <p>(3)</p> <pre><code>|itemname,medal,flagstring,1|\n</code></pre>"},{"location":"SetText/Individual%20commands/Itemname/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Itemname/#item-int-vint-varint","title":"<code>item</code>: int | <code>v</code>int | <code>var</code>int","text":"<p>The Item id to get the name of. The int form must be a valid Item id or an exception will be thrown. The <code>v</code>/<code>var</code> prefix indicates that the int portion is a flagvar slot containing the id and it must be a valid one or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Itemname/#flagstring-int","title":"<code>flagstring</code>: int","text":"<p>The flagstring slot to set to the <code>item</code>'s name. This must be a valid flagstring slot or an exception will be thrown. The default value is 0.</p>"},{"location":"SetText/Individual%20commands/Itemname/#medal-int-vint-varint","title":"<code>medal</code>: int | <code>v</code>int | <code>var</code>int","text":"<p>The Medal id to get the name of. The int form must be a valid Medal id or an exception will be thrown. The <code>v</code>/<code>var</code> prefix indicates that the int portion is a flagvar slot containing the id and it must be a valid one or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Itemname/#1","title":"<code>1</code>","text":"<p>Indicate to operate in syntax (3) which will set <code>flagstring</code> flagstring slot to a Medal's instead of an Item's name. This also honor MYSTERY? and will set the value to menu text 59 (?????) if flag 681 is true. Any other value is ignores and will cause the command to operate in syntax (2).</p>"},{"location":"SetText/Individual%20commands/Itemvalue/","title":"Itemvalue","text":"<p>Set a flagvar to an Items or Medal's value (buying price) where the id is specified directly or contained in a flagvar.</p>"},{"location":"SetText/Individual%20commands/Itemvalue/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|itemvalue,item|\n</code></pre> <p>(2)</p> <pre><code>|itemvalue,item,flagvar|\n</code></pre> <p>(3)</p> <pre><code>|itemvalue,medal,flagvar,1|\n</code></pre>"},{"location":"SetText/Individual%20commands/Itemvalue/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Itemvalue/#item-int-vint-varint","title":"<code>item</code>: int | <code>v</code>int | <code>var</code>int","text":"<p>The Item id to get the value of. The int form must be a valid Item id or an exception will be thrown. The <code>v</code>/<code>var</code> prefix indicates that the int portion is a flagvar slot containing the id and it must be a valid one or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Itemvalue/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot to set to the <code>item</code>'s value. This must be a valid flagvar slot or an exception will be thrown. The default value is 0.</p>"},{"location":"SetText/Individual%20commands/Itemvalue/#medal-int-vint-varint","title":"<code>medal</code>: int | <code>v</code>int | <code>var</code>int","text":"<p>The Medal id to get the value of. The int form must be a valid Medal id or an exception will be thrown. The <code>v</code>/<code>var</code> prefix indicates that the int portion is a flagvar slot containing the id and it must be a valid one or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Itemvalue/#1","title":"<code>1</code>","text":"<p>Indicate to operate in syntax (3) which will set <code>flagvar</code> flagvar slot to a Medal's instead of an Item's name. This also honor MYSTERY? and will set the value to 35 if flag 681 is true. Any other value is ignores and will cause the command to operate in syntax (2).</p>"},{"location":"SetText/Individual%20commands/Jump/","title":"Jump","text":"<p>Make an Entity jump up with a configurable velocity.</p>"},{"location":"SetText/Individual%20commands/Jump/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|jump,entity|\n</code></pre> <p>(2)</p> <pre><code>|jump,entity,velocity|\n</code></pre>"},{"location":"SetText/Individual%20commands/Jump/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Jump/#entity-int-this-caller-string","title":"<code>entity</code>: int | <code>this</code>, <code>caller</code>, string","text":"<p>The Entity id or designator to jump up. The int form represents an Entity id and it must be a valid int or an exception will be thrown. For other values, they only apply if the caller isn't null otherwise, they will cause an exception to be thrown:</p> <ul> <li><code>this</code>: Refers to the tailtarget.</li> <li><code>caller</code>: Refers to the caller.</li> <li>Anything else: Refers to a define if it exists, otherwise, this is interpreted as a regular Entity id which will cause an exception to be thrown.</li> </ul>"},{"location":"SetText/Individual%20commands/Jump/#velocity-float","title":"<code>velocity</code>: float","text":"<p>The vertical velocity of the jump. This must be a valid float or an exception will be thrown. The default value is 10.0.</p>"},{"location":"SetText/Individual%20commands/Jump/#remarks","title":"Remarks","text":"<p>This uses the entity's Jump method which amongst its function will remove the constraint of an entity to perform the jump if it isn't an item or there is no battle in progress. Additionally, <code>offgroundframes</code> will be set to 20.0 and <code>jumpcooldown</code> to 30.0.</p>"},{"location":"SetText/Individual%20commands/Kill/","title":"Kill","text":"<p>Kills an Entity by calling Death (with <code>activatekill</code>) on it.</p>"},{"location":"SetText/Individual%20commands/Kill/#syntax","title":"Syntax","text":"<pre><code>|kill,entity|\n</code></pre>"},{"location":"SetText/Individual%20commands/Kill/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Kill/#entity-this-caller-int","title":"<code>entity</code>:  <code>this</code> | <code>caller</code> | int","text":"<p>The Entity to kill:</p> <ul> <li><code>this</code>: Refers to tailtarget's entity (This only reliably works in Dialogue mode otherwise, it will take the last value of tailtarget which is potentially undefined behavior).</li> <li><code>caller</code>: Refers to the caller if it is not null. If it is, this command does nothing.</li> <li>int: Refers to any other Entity id. If it resolves to null, an exception will be thrown.</li> </ul> <p>Any non int value that isn't in one of the predefined values above will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Kill/#remarks","title":"Remarks","text":"<p>There is a special case for Shop and CaravanBadge interactions on the caller where it will call SetBadgeShop(true) on the entity's NPCControl for the former and on the <code>shopkeeper</code> of the NPCControl for the latter.</p> <p>This command only kills the entity if its NPCControl isn't null and it doesn't have a <code>CaravanBadge</code> interaction.</p> <p>Once the entity has been killed if applicable, the player's list of NPCControl is reset to a new list.</p>"},{"location":"SetText/Individual%20commands/Kinematicplayer/","title":"Kinematicplayer","text":"<p>Set the <code>isKinematic</code> property of the player's entity's RigidBody to a value or turn it on temporarily for the rest of this SetText call (with caveats, see the remarks section).</p>"},{"location":"SetText/Individual%20commands/Kinematicplayer/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|kinematicplayer,value|\n</code></pre> <p>(2)</p> <pre><code>|kinematicplayer,temp|\n</code></pre>"},{"location":"SetText/Individual%20commands/Kinematicplayer/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Kinematicplayer/#value-true-false","title":"<code>value</code>: <code>true</code> | <code>false</code>","text":"<p>The value to set the isKinematic of the player's entity's RigidBody to. This must be a valid bool or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Kinematicplayer/#temp","title":"<code>temp</code>","text":"<p>The presence of this parameter indicates to operate in syntax (2) which will turn on the isKinematic, but will append <code>|kinematicplayer,false|</code> at the end of the input string which would cause it to turn it off at the end of the SetText call (with caveats, see the remarks section).</p>"},{"location":"SetText/Individual%20commands/Kinematicplayer/#remarks","title":"Remarks","text":"<p>Syntax (2) assumes the input string will not get redirected because if it is, the off command will not be processed. It is only guaranteed to work if the entire input string of the current call is processed to the end without redirection.</p> <p>This command is only used in syntax (2) when tattling a map or NPC.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/","title":"LetterPrompt","text":"<p>Displays a prompt where a flagstring can be edited by changing each letter and redirects upon confirmation.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#syntax","title":"Syntax","text":"<pre><code>|letterprompt,flagstring,confirmline,promptline,maxlength|\n</code></pre>"},{"location":"SetText/Individual%20commands/LetterPrompt/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/LetterPrompt/#flagstring-int","title":"<code>flagstring</code>: int","text":"<p>The flagstring slot to edit. This must be a valid flagstring slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#confirmline-int","title":"<code>confirmline</code>: int","text":"<p>This is the desired Dialogue line id to redirect when the letter prompt is confirmed. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#promptline-int-string","title":"<code>promptline</code>: int | <code>@</code>string","text":"<p>This is the desired string line or its corresponding Dialogue line id to show as a prompt message. The int form must be a valid Dialogue line id or an exception will be thrown. The string form must begin with a <code>@</code> and not contain any SetText commands in it or the command parser will behave incorrectly and will likely cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#maxlength-int","title":"<code>maxlength</code>: int","text":"<p>The maximum amount of letters allowed to be entered. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#remarks","title":"Remarks","text":"<p>This command requires to be in Dialogue mode or SetText will not wait for the prompt to finish and resume processing as normal which can cause undefined behaviors.</p> <p>Before creating the letter prompt, this command will first assign flagstring 2 to this command's text, assign flagvar 5 to -1 and hide the current textbox with a shrink animation. Only then is the letter prompt created.</p> <p>The handling of the letter prompt is done by MainManager's Update which restricts the inputs available to the 4 directions (to move the selected option), confirm, cancel (to erase the last character) and pause (to set the selected option to the confirm one). This is where the <code>maxlength</code> constraint is checked: if a letter is entered when the length of the current number text is the max, it will prevent the action. After the letter prompt is confirmed, the <code>flagstring</code> flagstring slot will have the value of the final result upon the confirmation.</p> <p>Once the outcome is determined, control goes back to SetText inside the Dialogue post-processing where it will redirect the input string to <code>confirmline</code>.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#how-letter-prompt-works-at-a-high-level","title":"How letter prompt works at a high level","text":"<p>A letter prompt is a complex system that acts as a superset of numberprompt, but with special fields set to differentiate it. There are multiple letter prompts with an id and a file corresponding to it that tells which letters can be entered. Here are the ids supported:</p> Id Description 0 Latin alphabet with numbers, accented letters and common punctuation 1 Japanese's Katakana alphabet 2 Japanese's hiragana alphabet 3 Korean's Hangul alphabet split into 3 sections with its own logic 4 Some uncommon symbols such as music note and spade <p>The current id can be cycled through using the Switch button and once done, it needs to recreate the whole prompt in a similar fashion than the first refresh which is the creation of the whole prompt. The Korean prompt is special as it has its own refreshing logic which is detailed in a section below.</p> <p>The actual option index works very differently than typical prompts because while it is contiguous, the navigation involves rows and columns. The first row's length is considered to be the length of every row and it is calculated as the prompt is generated on refresh which allows to determine what option should be selected when using the directional inputs. A prompt's data file is located at <code>Assets/Ressources/Data</code> and has the name <code>LetterPromptX</code> where <code>X</code> is the id. The file contains all the letters the prompt offers where each row is delimited by LF. It may contain spaces, but those spaces won't be selectable: they are only used for visual separations. Since this wouldn't allow to enter a space, a special option is appended after the Erase one for inputting an actual space.</p> <p>The important thing to note about a letter prompt is it is not possible to cancel it. It can only be confirmed and in that sense, it acts as a live flagstring editor because the backing flagstring changes as letters are removed or added. It's also the starting text which means it is both the input and the output.</p> <p>Due to extreme uses of SetText, it is technically possible to run SetText commands if the <code>flagstring</code> contains any prior to the prompt appearing, but it is not possible to enter any because the <code>|</code> is not available in any prompt. By the same token, this prompt does not support putting commands inside <code>promptmessage</code> as it is not handled and it will break the parser.</p> <p>One last thing to note: because the letter prompt consumes a lot of letter slots and nothing uses Single Letter Rendering, it should be noted that this UI in general is susceptible to do a lot of memory allocation and garbage collection which could be a performance concern.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#about-the-fields-flagvar-and-flagstring-used","title":"About the fields, flagvar and flagstring used","text":"<p>The way a letter prompt works is by reusing some fields used in the prompt and numberprompt command as well as sharing some fields used by ItemList. It's important to note that while it may shares some fields with these 2 systems, they are NOT equivalent semantically. This can in theory cause problems if they mix, but in practice, all fields mentioned here are properly reset by this command or their respective systems before usage so in practice, it's mostly safe.</p> <p>Here are the fields in question:</p> <ul> <li><code>letterprompt</code>: Set to to 1 in <code>Japanese</code>, 3 in <code>Korean</code> and 0 for any other languageid.</li> <li><code>prompt</code>: Since this command uses the same lock then prompt, it works the same way here (set to true during the command processing and to false when SetText is done yielding and handles the outcome)</li> <li><code>numberprompt</code>: Set to true during the command processing which is needed because a letter prompt is a superset of a numberprompt (it's not set to false because its value won't matter after until a prompt command happens which itself would set it to false anyway)</li> <li><code>option</code>: The current option index from 0 (includes spaces, but they are bypassed by the prompt handling)</li> <li><code>maxoptions</code>: The amount of options total (NOTE: this isn't the same than prompt or ItemList where it's the AMOUNT of options, not the index of the last one)</li> <li><code>promptbox</code>: The 9box containing the prompt itself</li> <li><code>npromptholder</code>: A GameObject that lives as a child of the <code>promptbox</code> and it contains the current text</li> <li><code>listtype</code>: This is the field used to store the <code>flagstring</code> temporarily until the number prompt is confirmed. It does NOT correspond to an actual listtype.</li> <li><code>listredirect</code>: This is the field used to store the <code>confirmline</code> until the number prompt is confirmed. It has nothing to do with its usage in ItemList</li> <li><code>listcancel</code>: This field has the same value than <code>listredirect</code> as it is impossible to cancel a letter prompt. It has nothing to do with its usage in ItemList.</li> <li><code>listcancelled</code>: This field is set temporarily to true when erasing a letter and back to false when confirming any options.</li> <li><code>multilist</code>: This has an unused purpose where if the letter prompt data had <code>}</code> in it, it would add the option to this list. It's set to a new list in practice still.</li> </ul> <p>As for the flagvar, this command and its handling uses the following slots:</p> <ul> <li>0: Set to -555. This is to tell MainManager that this is a letter prompt, not a numberprompt.</li> <li>1: Set to the number of letters in each row of the current letter prompt</li> <li>4: Set to 0 every time the letter prompt is refreshed (NOTE: why?)</li> <li>5: Set to -1 from this command, then changes to the button id if it's a direction input during the prompt handling. This is used to skip any space selection by repeating the last action of the last direction pressed.</li> <li>6: Set to the current section of the Korean prompt (id 3) if it's in use</li> <li>10: Set to <code>maxlength</code></li> </ul> <p>For flagstring:</p> <ul> <li>0: Set to the current text which is necessary to track the length constraint by <code>maxlength</code></li> <li>1: Set to the letter prompt's data before generating the letter holder and after, it will be have the LF and { removed so each option index corresponds directly to the character in the string at that index.</li> <li>2: Set to this command's text as a way to pass the parameters to CreateLetterPrompt on create and refresh.</li> <li><code>flagstring</code>: Set to the current text after confirmation</li> </ul>"},{"location":"SetText/Individual%20commands/LetterPrompt/#letter-prompt-rendering","title":"Letter prompt rendering","text":"<p>If the existing <code>promptbox</code> isn't null, it is first destroyed. This is because the same rendering procedure has to be done on refresh every time the letter prompt changes mode</p> <p>The <code>promptbox</code> is a regular 9box rendered at (0.0, -1.25, 10.0) of size (15.0, 7.5) with a sortingOrder of -3 with the color of the textbox with a grow animation. Another 9box is childed to the <code>promptbox</code> with a position of (0.0, 5.0, 0.0), a size of (13.0, 2.0), and a sorting order of -3 without a grow animation. </p> <p>The <code>promptbox</code> contains the prompt message which has its SetText call done in non Dialogue mode where the parent is the <code>promptbox</code> and the input string is |center| followed by the resolved text of <code>promptline</code> with a position of (0.0, 4.75, 9.0).</p> <p>The <code>npromptholder</code> is a new GameObject named <code>letter holder</code> that lives as the child of the <code>promptbox</code>. Its local position to (0.0, 2.7, 0.05) without angles or scaling.</p> <p>To render each options (the letters, Erase, Space and Confirm), the following is done:</p> <ul> <li>Start with the x and y position of the options be -6.35 and 1.8 respectively</li> <li>Render the options such that for each character in the letter prompt data (which is the value of flagstring 1 at this point):<ul> <li>If we encounter an LF:<ul> <li>Reset the x position to -6.35</li> <li>Remove a certain amount from the y position. This amount is 0.75 if we aren't in the Korean letter prompt or 1.1 if we are and it's not the 4th line.</li> <li>Set to no longer increment flagvar 1.</li> </ul> </li> <li>If we have yet to encounter the first LF:<ul> <li>Increment flagvar 1 (this means each row must have the same amount of options max than the first row as this value is going to be the number of options per row)</li> </ul> </li> <li>Have the option text be |choicewave,n,true| where n is <code>maxoptions</code>.</li> <li>Increment <code>maxoptions</code>.</li> <li>Call SetText in non Dialogue mode using the text with |center|:<ul> <li>fonttype is <code>BubblegumSans</code></li> <li>no <code>linebreak</code></li> <li>no <code>tridimensional</code></li> <li><code>position</code> is (x, y, 0.0) where x and y are the current value of the option's positions.</li> <li>no <code>camoffset</code></li> <li><code>size</code> of (1.0, 1.0)</li> <li><code>parent</code> is the <code>promptbox</code></li> <li>no <code>caller</code></li> </ul> </li> <li>Add 0.65 to x</li> </ul> </li> </ul> <p>After all the letters have been rendered, flagstring 1 will have its LF and { removed.</p> <p><code>maxoptions</code> is then incremented by 3 for the bottom 3 options. All the 3 options's SetText call are similar with the main differences between them is the position and the text, but they are all on non Dialogue mode with the <code>promptbox</code> as the parent with no size scaling or anything special. All are menutext prepanded with |center| and appended with |choicewave,n| where n is the option index (they are the last 3 in order):</p> <ol> <li>Cancel: menutext 74 at (-5.0, -3.0, 0.0)</li> <li>Space: menutext 192 at (0.0, -3.0, 0.0)</li> <li>Confirm: menutext 42 at (5.0, -3.0, 0.0)</li> </ol> <p>After, the help text to the next letter prompt with the switch button is rendered by creating a new GameObject parented to the <code>promptbox</code> called <code>button</code> with a ButtonSprite set to <code>Scroll Faster / Switch Party</code> whose label is the corresponding letterPromptHelp at the current id at (-2.25, -1.9) and a size of (0.5, 0.5).</p> <p>After the initial setup, the first refresh of the letter prompt is performed. This will destroy the text in <code>npromptholder</code> and rerender using the one in flagstring 0 which will get updated periodically as letters are added or removed during the prompt handling. This also sets flagvar 4 to 0. As for the rendering of the text itself, it is done via a SetText call in non Dialogue mode with the text padded to the right with <code>_</code> to fit into <code>maxlength</code> prepended with |center|:</p> <ul> <li>fonttype is <code>BubblegumSans</code></li> <li>no linebreak</li> <li>no tridimensional</li> <li>position is Vector3.zero.</li> <li>no camoffset</li> <li>size of Vector2.one</li> <li>parent is the npromptholder</li> <li>no caller</li> </ul> <p>After the first refresh is done, a refresh will only get done after a letter is added/removed during the letter prompt handling.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#about-the-korean-letter-prompt-id-3","title":"About the Korean letter prompt (id 3)","text":"<p>The Korean prompt has special logic related to it. There are 3 sections of different parts of a full letter and one option of each section in order must be confirmed before the full letter is appended at the end of the current text. To accomplish this, there are special fields for this mainly flagvar 6 corresponds to the current section starting from 0, <code>KoreanHL</code> corresponds to the 2 parts selected in the first 2 sections and a hardcoded array of the mappings of each sections's options called <code>koreanLimit</code> (which starts at 3 instead of 0). This letter prompt also has its own refresh handling to render it correctly throughout the selection.</p> <p>Just before the first prompt refresh mentioned above, the Korean one happens if we are using it. This will check each letter in the prompt:</p> <ul> <li>If the current selection includes the character, it is rendered with a pure red color</li> <li>If it corresponds to the current section, but no character was selected yet, it is rendered with a pure black color</li> <li>If it's a further section than the current one or the letter is in a past section, but isn't the selected one, it is rendered with a pure black color with half transparency</li> </ul> <p>This refresh is then done every time the prompt refreshes if the prompt is the Korean one during the handling.</p>"},{"location":"SetText/Individual%20commands/LetterPrompt/#letter-prompt-handling","title":"Letter prompt handling","text":"<p>After the command has been processed, SetText will keep yielding frames in the Dialogue post-processing phase until <code>prompt</code> is set to false from MainManager's Update. This Update event completely changes the input handling of the game and in general, it restricts actions to interact with the current letter prompt. Additionally, the <code>blinker</code> will be disabled. </p> <p>Here are the dpad handlers:</p> <ul> <li>Up: Moves the cursor to option - flagvar 1 (one row above) clamped from 0 to <code>maxoptions</code> - 1 and set flagvar 5 to 0</li> <li>Down: Moves the cursor to option + flagvar 1 (one row below) clamped from 0 to <code>maxoptions</code> - 1 and set flagvar 5 to 1</li> <li>Left: Moves the cursor to the option - 1 (the one on the left) or to the one at the end of the current line (using flagvar 1 to find it) and set flagvar 5 to 2 (NOTE: this has an issue: if the current row doesn't have an option at the end which is the case for prompt id 1 and 4, it will select PAST the last option of the row which can end up in unexpected places or in an option index located past the last one)</li> <li>Right: Moves the cursor to the option + 1 (the one on the left) or to the one at the start of the current line (using flagvar 1 to find it) and set flagvar 5 to 3</li> </ul> <p>After any dpad movement, if the option is still a letter, but it's a space, the option will change again as if the last direction will be pressed again (using flagvar 5 to determine it) until it isn't a space. The option is always clamped from 0 to <code>maxoptions</code> - 1 every time it is changed this way. flagvar 5 is then reset to -1.</p> <p>For other inputs, they are restricted to the following:</p> <ul> <li>Pause: Move the cursor to the confirm option which is <code>maxoptions</code> - 1</li> <li>Switch: Rerender the letter prompt, but the id is now the current one + 1 or go back to 0 on the last one</li> <li>Cancel: Sets <code>listcancelled</code> to true. Then, if there are no letters entered, play the buzzer. Otherwise, the last character of the <code>flagstring</code> is removed and the letter prompt refreshed. This also resets the Korean prompt to its original state if we are in it</li> <li>Confirm: <code>listcancelled</code> is set to false, a 5 frames input cooldown is applied and it also set <code>promptpick</code> to 0. The rest depends on the option currently selected before resetting the Backtracking system:<ul> <li>A letter: Add the entered letter to flagstring 0 (current text) and refresh the letter prompt unless the length is <code>maxlength</code> from flagvar 10 in which case, the buzzer plays. <ul> <li>For the Korean prompt, the option must be within the current accepted section's range or the buzzer will play (flagvar 6 tells the current one, the accepted options ranges per sections are hardcoded). If it is in the valid range, then it depends on the current section:</li> <li>Not last: flagvar 6 is incremented.</li> <li>Last: flagvar 6 is reset to 0, the cumulation of all the letter selected in each sections is appended to flagstring 0, the current letter selections is cleared and the option index is reset to 0.</li> <li>No matter what, if the selection was accepted, the prompt is refreshed and the Korean prompt logic is also refreshed</li> </ul> </li> <li>Erase: Remove the last entered letter from flagstring 0 (current text) and refresh the letter prompt unless the text was empty in which case, the buzzer plays.<ul> <li>For the Korean prompt, it also resets flagvar 6 (current section) to 0, clears the current selection and refresh the Korean prompt logic.</li> </ul> </li> <li>Space: Add a <code></code> to flagstring 0 (current text) and refresh the letter prompt unless the length is <code>maxlength</code> from flagvar 10 or we are during a Korean prompt character selection (flagvar 6 is higher than 0) in which case, the buzzer plays.</li> <li>Confirm: If flagstring 0 (current text) is empty, the buzzer is played, otherwise:<ul> <li><code>promptpointers</code> is set to one element containing <code>confirmline</code> fetched from <code>listredirect</code>, Text advance's <code>skiptext</code> is set to false and finally, the <code>prompt</code> lock is released</li> </ul> </li> </ul> </li> </ul>"},{"location":"SetText/Individual%20commands/LetterPrompt/#handling-the-letter-prompt-outcome","title":"Handling the letter prompt outcome","text":"<p>When SetText is done yielding, the prompt will be handled immediately after:</p> <ul> <li>The input string will be overwritten completely with the text obtained from the corresponding <code>promptpointers</code> associated with the option (which is always <code>confirmline</code> here since a letter prompt cannot be canceled) prepended with |blank| and then OrganiseLines will be called on using the <code>linebreak</code> value if it isn't null.</li> <li>Set the current textbox to reveal itself with a grow animation.</li> <li>Setup the <code>promptbox</code> to have a shrink animation.</li> <li>Destroys the <code>promptbox</code> in 0.5 seconds.</li> <li>Reset <code>promptpick</code> to -1.</li> <li>Reset the character position of the char loop to restart at the beginning of the input string. This essentially restarts the whole char loop with the new input string within the same call then this command.</li> <li>Yield for a frame to let the animation plays.</li> </ul> <p>After, processing continues as normal with a fresh input string once Dialogue post-processing is completed for this iteration of the char loop.</p>"},{"location":"SetText/Individual%20commands/Level/","title":"Level","text":"<p>Set, add or remove ranks to the party by a value or by a value stored in a flagvar slot.</p>"},{"location":"SetText/Individual%20commands/Level/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|level,value|\n</code></pre> <p>(2)</p> <pre><code>|level,flagvar|\n</code></pre> <p>(3)</p> <pre><code>|level,operation,value|\n</code></pre> <p>(4)</p> <pre><code>|level,operation,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Level/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Level/#value-int","title":"<code>value</code>: int","text":"<p>The amount of ranks to set/add/remove. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Level/#flagvar-varint","title":"<code>flagvar</code>: <code>var</code>int","text":"<p>The flagvar slot to get the value of ranks to set/add/remove. This must be a valid flagvar slot or an exception will be thrown. This must contains <code>var</code> once otherwise the value will be interpreted as <code>value</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Level/#operation-add-sub","title":"<code>operation</code>: <code>add</code> | <code>sub</code>","text":"<p>The operation to perform using the current rank and the resolved value. <code>add</code> will add the value to the current amount while <code>sub</code> will subtract the value to the current amount. The new value is clamped from 0 to the required amount for the next level - 1 after the operation. Any other value will be interpreted as syntax <code>value</code>/<code>flagvar</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Level/#remarks","title":"Remarks","text":"<p>This command only manages the rank, it does not manage the amount of Exploration Points. For that one, use exp.</p>"},{"location":"SetText/Individual%20commands/Librarybook/","title":"Librarybook","text":"<p>Signal the game that a Lore Book has been acquired and refresh the LibraryShelf.</p>"},{"location":"SetText/Individual%20commands/Librarybook/#syntax","title":"Syntax","text":"<pre><code>|librarybook|\n</code></pre>"},{"location":"SetText/Individual%20commands/Librarybook/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Librarybook/#remarks","title":"Remarks","text":"<p>This command does 2 tasks:</p> <ul> <li>It increments flagvar 15 (the amount of Lore Book on the shelf).</li> <li>It calls Refresh on the first LibraryShelf that exists in the Scene.</li> </ul> <p>This means that there must be at least one LibraryShelf in the Scene when this command is processed or an exception will be thrown.</p> <p>This command is specifically made to handle giving a Lore Book in a place with the shelf in the same room which is normally done at the AntPalaceLibrary maps.</p>"},{"location":"SetText/Individual%20commands/Libraryline/","title":"Libraryline","text":"<p>An alias of line that is only processed by SetText when the pause menu is active and the active window is \"library\".</p>"},{"location":"SetText/Individual%20commands/Libraryline/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|libraryline|\n</code></pre> <p>(2)</p> <pre><code>|libraryline,linespacing|\n</code></pre>"},{"location":"SetText/Individual%20commands/Libraryline/#parameters","title":"Parameters","text":"<p>The same as line. Check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Libraryline/#remarks","title":"Remarks","text":"<p>Just like line, this commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it.</p> <p>This command was presumably done as a workaround to the OrganiseLines Known Issues &gt; Not counting a whole word's width after the first line problem.</p>"},{"location":"SetText/Individual%20commands/Librarysize/","title":"Librarysize","text":"<p>An alias of size where the command is only processed if the pause menu is active on the \"Library\" window.</p>"},{"location":"SetText/Individual%20commands/Librarysize/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|librarysize,sizeuniform|\n</code></pre> <p>(2)</p> <pre><code>|librarysize,sizex,sizey|\n</code></pre> <p>(3)</p> <pre><code>|librarysize,unpause,sizex,sizey|\n</code></pre> <p>(4)</p> <pre><code>|librarysize,sizex,sizey,lockcontrol|\n</code></pre>"},{"location":"SetText/Individual%20commands/Librarysize/#parameters","title":"Parameters","text":"<p>The same as size, check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Librarysize/#remarks","title":"Remarks","text":"<p>Just like size, this command affects OrganiseLines by changing the horizontal size scaling used to predict the amount of space further letters will take. This is done ignoring the size's locking system so even if the command isn't going to change the size once processed, it will still be taken as a width change for the auto line breaker which can cause problems.</p>"},{"location":"SetText/Individual%20commands/Limit/","title":"Limit","text":"<p>Changes the OrganiseLines's <code>linebreak</code> value.</p>"},{"location":"SetText/Individual%20commands/Limit/#syntax","title":"Syntax","text":"<pre><code>|limit,value|\n</code></pre>"},{"location":"SetText/Individual%20commands/Limit/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Limit/#value-float-null","title":"<code>value</code>: float | <code>null</code>","text":"<p>The new value to set the line break to. This must be a valid float or <code>null</code> or an exception will be thrown. <code>null</code> means to remove the existing linebreak and set it to null.</p>"},{"location":"SetText/Individual%20commands/Limit/#remarks","title":"Remarks","text":"<p>This is essentially the exact same command than setbreak, but without the ability to run OrganiseLines after the change.</p> <p>It is preferred to send the desired line break value as a parameter to SetText from the start instead of using this command. While it is used in very specific scenarios in the game, it is redundant because it is simpler to pass the correct value at first.</p>"},{"location":"SetText/Individual%20commands/Line/","title":"Line","text":"<p>Go to a new line below and continue rendering at the start of the new line</p>"},{"location":"SetText/Individual%20commands/Line/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|line|\n</code></pre> <p>(2)</p> <pre><code>|line,linespacing|\n</code></pre>"},{"location":"SetText/Individual%20commands/Line/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Line/#linespacing-float","title":"<code>linespacing</code>:  float","text":"<p>A factor to multiply the standard line height to move below the current one. This value must be a valid float or an exception will be thrown. The default value is 1.0 (which will use the standard line spacing).</p>"},{"location":"SetText/Individual%20commands/Line/#remarks","title":"Remarks","text":"<p>This command functions slightly differently than the regular LF processing in Dialogue mode when the language is set to <code>Japanese</code>. When an LF gets processed in Japanese, it acts like this command with <code>linespacing</code> set to 1.25. In other cases, it behaves like syntax (1).</p> <p>In Regular Letter Rendering, this command is accumulated for the Backtracking system.</p> <p>This commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it.</p> <p>This is one of the command supported by testdiag if the command name part is written as <code>line</code> with case sensitivity.</p>"},{"location":"SetText/Individual%20commands/Listsize/","title":"Listsize","text":"<p>An alias of size or sizemulti that is only processed if a battle is in progress, the pause menu is inactive and we are in an ItemList.</p>"},{"location":"SetText/Individual%20commands/Listsize/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|listsize,sizeuniform|\n</code></pre> <p>(2)</p> <pre><code>|listsize,sizex,sizey|\n</code></pre> <p>(3)</p> <pre><code>|listsize,unpause,sizex,sizey|\n</code></pre> <p>(4)</p> <pre><code>|listsize,sizex,sizey,lockcontrol|\n</code></pre> <p>(5) (Alias of sizemulti)</p> <pre><code>|listsize,multi,sizex,sizey|\n</code></pre>"},{"location":"SetText/Individual%20commands/Listsize/#parameters","title":"Parameters","text":"<p>The same as size for syntax (1) to (4), check its documentation to learn more. For syntax (5), the same as sizemulti, check its documentation to learn more and the <code>multi</code> parameter must be sent to indicate using this syntax.</p>"},{"location":"SetText/Individual%20commands/Listsize/#remarks","title":"Remarks","text":"<p>This command does nothing if a battle isn't in progress, the pause menu is active or we aren't in an ItemList.</p> <p>Unless syntax (5) is used, just like size, this command affects OrganiseLines by changing the horizontal size scaling used to predict the amount of space further letters will take. This is done ignoring the size's locking system so even if the command isn't going to change the size once processed, it will still be taken as a width change for the auto line breaker which can cause problems. </p> <p>If syntax (5) is used however, this command does nothing in OrganiseLines.</p>"},{"location":"SetText/Individual%20commands/Loadcamera/","title":"Loadcamera","text":"<p>Loads the saved camera's configuration and limits saved by savecamera.</p>"},{"location":"SetText/Individual%20commands/Loadcamera/#syntax","title":"Syntax","text":"<pre><code>|loadcamera|\n</code></pre>"},{"location":"SetText/Individual%20commands/Loadcamera/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Loadcamera/#remarks","title":"Remarks","text":"<p>Specifically, it loads the following fields using <code>SaveCameraPosition(false)</code>:</p> <ul> <li><code>camtargetpos</code> is set to <code>tempcampos</code></li> <li><code>camspeed</code> is set to <code>tempcamspeed</code></li> <li><code>camoffset</code> is set to <code>tempcamoffset</code></li> <li><code>camangleoffset</code> is set to <code>tempcamangleoffset</code></li> <li><code>camtarget</code> is set to <code>tempcamtarget</code></li> <li><code>map.camlimitpos</code> is set to <code>tempmaplp</code></li> <li><code>map.camlimitneg</code> is set to <code>tempmapln</code></li> </ul>"},{"location":"SetText/Individual%20commands/Loadmap/","title":"Loadmap","text":"<p>Reload the current Map or load another one</p>"},{"location":"SetText/Individual%20commands/Loadmap/#syntax","title":"Syntax","text":"<p>(1) (Reload the current map)</p> <pre><code>|loadmap|\n</code></pre> <p>(2)</p> <pre><code>|loadmap,map|\n</code></pre>"},{"location":"SetText/Individual%20commands/Loadmap/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Loadmap/#map-int","title":"<code>map</code>: int","text":"<p>The Map id to load. This must be a valid Map id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Loadmap/#remarks","title":"Remarks","text":"<p>After the load is complete, this command will yield for a frame.</p>"},{"location":"SetText/Individual%20commands/Lock/","title":"Lock","text":"<p>Force a grab on the message and the <code>minipause</code> locks.</p>"},{"location":"SetText/Individual%20commands/Lock/#syntax","title":"Syntax","text":"<pre><code>|lock|\n</code></pre>"},{"location":"SetText/Individual%20commands/Lock/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Lock/#remarks","title":"Remarks","text":"<p>This command should only be used in Dialogue mode because the locks will only get released as part of the Dialogue Cleanup. That being said, these locks are normally grabbed in the Dialogue setup so this command should only be used to regrab them if they were released during SetText.</p> <p>This command is unused under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Lockbacktrack/","title":"Lockbacktrack","text":"<p>Prevent any Backtracking from happening during the rest of the SetText call.</p>"},{"location":"SetText/Individual%20commands/Lockbacktrack/#syntax","title":"Syntax","text":"<pre><code>|lockbacktrack|\n</code></pre>"},{"location":"SetText/Individual%20commands/Lockbacktrack/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Lockbacktrack/#remarks","title":"Remarks","text":"<p>This only takes effect until the end of the SetText call. Backtracking is enabled again on the next call.</p>"},{"location":"SetText/Individual%20commands/Lockmovement/","title":"Lockmovement","text":"<p>Lock any rotation and movement to the player's entity's RigidBody with the exception of Y movement.</p>"},{"location":"SetText/Individual%20commands/Lockmovement/#syntax","title":"Syntax","text":"<pre><code>|lockmovement|\n</code></pre>"},{"location":"SetText/Individual%20commands/Lockmovement/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Lore/","title":"Lore","text":"<p>A helper of string where flagstring 0 is set to the Lore Book's text whose id is in flagvar 0 with additional commands then the same flagstring is sent to string in syntax (4).</p>"},{"location":"SetText/Individual%20commands/Lore/#syntax","title":"Syntax","text":"<pre><code>|lore|\n</code></pre>"},{"location":"SetText/Individual%20commands/Lore/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Lore/#remarks","title":"Remarks","text":"<p>More specifically, this command sets flagstring 0 to the Lore Book text appended with |break||hide||fwait,0.05||boxstyle,3||fwait,0.05||hide||goto,1|. Then, a |string,0,true| is immediately processed which will use the newly set value of flagstring 0.</p> <p>This is meant to be used as a confirmation handler to Lore Book List Type which would have already set flagvar 0 to the Lore Book id. This command simply does the setup needed to render it.</p>"},{"location":"SetText/Individual%20commands/Mapflag/","title":"Mapflag","text":"<p>Changes a mapflags slot using a specific id directly or one coming from a flagvar slot</p>"},{"location":"SetText/Individual%20commands/Mapflag/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|mapflag,mapflags,value|\n</code></pre> <p>(2)</p> <pre><code>|mapflag,var,flagvar,value|\n</code></pre>"},{"location":"SetText/Individual%20commands/Mapflag/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Mapflag/#mapflag-int","title":"<code>mapflag</code>: int","text":"<p>The mapflags to set its value to. This must be a valid mapflags slot or an exception will be thrown. Since there are only 10 mapflags, valid values ranges from 0 to 9 inclusive.</p>"},{"location":"SetText/Individual%20commands/Mapflag/#value-true-false","title":"<code>value</code>: <code>true</code> | <code>false</code>","text":"<p>The value to set the map flag to. This must be a valid bool or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Mapflag/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot containing the mapflags slot. This must be a valid flagvar slot or an exception will be thrown. The value of the flagvar must be a valid mapflags slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Mapflag/#var","title":"<code>var</code>","text":"<p>The presence of this parameter indicate to operate in syntax (3). Its value does not matter, only its presence.</p>"},{"location":"SetText/Individual%20commands/Mapflag/#remarks","title":"Remarks","text":"<p><code>map.mapflags</code> is an array of 10 bools that belongs to the current map, but is reset explicitly on the map's Start and unlike other flags arrays, this one is never saved on the Save File. This gives it a very ephemeral and temporary usage because all their values are reset on every map loads.</p>"},{"location":"SetText/Individual%20commands/Mapsize/","title":"Mapsize","text":"<p>An alias of size where the command is only processed if the pause menu is active on the Map of Bugaria window.</p>"},{"location":"SetText/Individual%20commands/Mapsize/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|mapsize,sizeuniform|\n</code></pre> <p>(2)</p> <pre><code>|mapsize,sizex,sizey|\n</code></pre> <p>(3)</p> <pre><code>|mapsize,unpause,sizex,sizey|\n</code></pre> <p>(4)</p> <pre><code>|mapsize,sizex,sizey,lockcontrol|\n</code></pre>"},{"location":"SetText/Individual%20commands/Mapsize/#parameters","title":"Parameters","text":"<p>The same as size, check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Mapsize/#remarks","title":"Remarks","text":"<p>Just like size, this command affects OrganiseLines by changing the horizontal size scaling used to predict the amount of space further letters will take. This is done ignoring the size's locking system so even if the command isn't going to change the size once processed, it will still be taken as a width change for the auto line breaker which can cause problems.</p>"},{"location":"SetText/Individual%20commands/Maxmedals/","title":"Maxmedals","text":"<p>Replace this command's text by the number of collectible medals in the game (hardcoded to 108)</p>"},{"location":"SetText/Individual%20commands/Maxmedals/#syntax","title":"Syntax","text":"<pre><code>|maxmedals|\n</code></pre>"},{"location":"SetText/Individual%20commands/Maxmedals/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Maxmedals/#remarks","title":"Remarks","text":"<p>Processing will resume at the same position than this command to accommodate the text replacement.</p>"},{"location":"SetText/Individual%20commands/Medaltotal/","title":"Medaltotal","text":"<p>Replace the text of this command by the amount of Medal in the player's possession.</p>"},{"location":"SetText/Individual%20commands/Medaltotal/#syntax","title":"Syntax","text":"<pre><code>|medaltotal|\n</code></pre>"},{"location":"SetText/Individual%20commands/Medaltotal/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Medaltotal/#remarks","title":"Remarks","text":"<p>This command will resume processing at the same position than this command to accommodate the text replacement.</p>"},{"location":"SetText/Individual%20commands/Menu/","title":"Menu","text":"<p>Alias to string if processed by SetText directly where <code>flagstring</code> is a menu text line id instead, but it can also be processed before by OrganiseLines with different behaviours.</p>"},{"location":"SetText/Individual%20commands/Menu/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|menu,menutext|\n</code></pre> <p>(2)</p> <pre><code>|menu,menutext,clamp,maxwidth|\n</code></pre> <p>(3)</p> <pre><code>|menu,menutext,clamp,maxwidth,widthscaleclamp|\n</code></pre> <p>(3)</p> <pre><code>|menu,menutext,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/Menu/#parameters","title":"Parameters","text":"<p>The same as string except <code>flagstring</code> is now a menu text line id:</p>"},{"location":"SetText/Individual%20commands/Menu/#menutext-int","title":"<code>menutext</code>:  int","text":"<p>The menu text line id whose value will be appended at the end of the input string. This must corresponds to an integer of a valid menu text id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Menu/#remarks","title":"Remarks","text":"<p>This command can get processed by OrganiseLines's ReplaceFunctions's own char loop if it is called at least once with the input string before the char loop reaches this command.</p>"},{"location":"SetText/Individual%20commands/Menu/#organiseliness-processing","title":"OrganiseLines's processing","text":"<p>Syntax (1) is fully supported and behaves the same way, but the other ones are not. This is because OrganiseLines also adds a different syntax involving the second parameter:</p> <pre><code>|menu,menutext,formatting|\n</code></pre> <p>The <code>formatting</code> parameter adds some formatting to the menu text and it can be any of the following values (any other values is ignored):</p> <ul> <li><code>1</code>: The text of the command is replaced by the first character of the menu text followed by a <code>-</code> followed by the entire menu text.</li> <li><code>2</code>: The text of the command is replaced by an uppercased version of the menu text</li> <li><code>3</code>: The same as <code>1</code>, but the portion after the <code>-</code> is uppercased.</li> </ul>"},{"location":"SetText/Individual%20commands/Menu/#about-processing-order","title":"About processing order","text":"<p>Since this command has the unique property that it is processed very differently between SetText and OrganiseLines, it is important to be mindful who will run the command first. </p> <p>It should be noted that if SetText runs it first using syntax (3), it will not cause interference because OrganiseLines will be run after the command text was replaced which means it will not process the command a second time, but it means it is no longer possible to process it using the special OrganiseLines syntax. </p> <p>If OrganiseLines runs it first, then SetText can no longer process it because the command will disappear from the input string and in such case, only syntax (1) and the special syntax of OrganiseLines are supported.</p>"},{"location":"SetText/Individual%20commands/Minibubble/","title":"Minibubble","text":"<p>Show some text inside a Minibubble by a Dialogue line id or by directly specifying the text which will have its tail set to a specified entity. The Minibubble's lifecycle can then be controlled from the same SetText call using waitminibubble and destroyminibubble.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#syntax","title":"Syntax","text":"<p>(1) (Only tells SetText that we are in control of an existing Minibubble, see the remarks section for more details)</p> <pre><code>|minibubble|\n</code></pre> <p>(2)</p> <pre><code>|minibubble,text,entity|\n</code></pre> <p>(3)</p> <pre><code>|minibubble,text,entity,yposition|\n</code></pre> <p>(4)</p> <pre><code>|minibubble,text,entity,xposition,yposition|\n</code></pre>"},{"location":"SetText/Individual%20commands/Minibubble/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Minibubble/#text-int-string","title":"<code>text</code>: int | <code>@</code>string","text":"<p>The input string of the SetText call that will show in the Minibubble. The int form specify the Dialogue line id to use while the string form specify the text directly. The int form must be a valid Dialogue line id or an exception will be thrown. The string form must start with <code>@</code> otherwise it will be interpreted as an int which will cause an exception to be thrown.</p> <p>The string form supports having commands without interfering the main parser. To put commands in it, every <code>|</code> must be <code>{</code> and every <code>,</code> must be <code>}</code>. Failure to do so will cause undefined behaviors with the command parser which will likely result in an exception being thrown.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#entity-caller-this-int","title":"<code>entity</code>: <code>caller</code> | <code>this</code> | int","text":"<p>The Entity that the Minibubble's tail will point to. The int form refers to an Entity id which must be a valid int or an exception will be thrown. This form is valid no matter if caller is null or not. If the caller isn't null however, additional values are possible:</p> <ul> <li><code>this</code>: Refers to tailtarget's entity (This only reliably works in Dialogue mode otherwise, it will take the last value of tailtarget which is potentially undefined behavior) Since it is setting the tailtarget to its current entity, this effectively doesn't change it.</li> <li><code>caller</code>: Refers to the caller's entity.</li> </ul> <p>Any non int value that isn't in one of the predefined values above will be interpreted as an int which will cause an exception to be thrown. Additionally, if the caller is null, the int form must be specified as any other value will be interpreted as an int which will cause an exception to be thrown.</p> <p>If the entity resolves to null, this command will do nothing.</p> <p>This parameter is completely ignored in testdiag, but must still be specified to any value in syntax (3) and (4).</p>"},{"location":"SetText/Individual%20commands/Minibubble/#xposition-float","title":"<code>xposition</code>: float","text":"<p>The x position of the Minibubble relative to the GUICamera. This must be a valid float or an exception will be thrown. The default value is calculated using  the <code>entity</code>'s viewportPoint.x which represents a value between 0 and 1 that indicates where is <code>entity</code> rendered on the screen horizontally (0 is leftmost, 1 is rightmost). This is brought to the range between -0.5 and 1.5 and then multiplied by 33.0 all clamped from -5.0 to 5.0.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#yposition-float","title":"<code>yposition</code>: float","text":"<p>The y position of the Minibubble relative to the GUICamera. This must be a valid float or an exception will be thrown. The default value is 0.85.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#remarks","title":"Remarks","text":"<p>The Minibubble will be setup using the text determined from <code>text</code>, the entity determined from <code>entity</code>, the position determined from <code>xposition</code> and <code>yposition</code> with a z component of 10.0, a sortingOrder of 10 + 3 * the amount of active Minibubbles and a wait time of 1.5 seconds.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#minibubble-setup","title":"Minibubble SetUp","text":"<p>When the Minibubble is setup, this will create a GameObject that has a minibubble component and it will be stored in the SetText's bubbles list. This game object will have a name of <code>MiniBubble-</code> followed by the final text. The actual text gets prepanded with |minibubble||sort,sortingOrder + 1| where sortingOrder is the value calculated from above. The minibubble command uses syntax (1) which is important because it allows SetText to know it is in control of an existing minibubble. The text also gets appended with |fwait,1.5| where 1.5 is not configurable via this command. The final fields of the component are as follows:</p> <ul> <li><code>basesort</code>: The sortingOrder</li> <li><code>text</code>: The final text determined above</li> <li><code>pos</code>: The final position determined above</li> <li><code>target</code>: The entity determined above</li> </ul>"},{"location":"SetText/Individual%20commands/Minibubble/#minibubble-start","title":"Minibubble Start","text":"<p>The component will setup 3 UI GameObjects:</p> <ul> <li><code>Bubble</code>: The Minibubble sprite. This is childed to the Minibubble component with a position of Vector3.zero and a size of (0.8, 0.65, 1.0). The sortingOrder of the SpriteRenderer is set to basesort - 1 with a color of E5D8BF (a similar color to the main textbox color).</li> <li><code>Tail</code>: The tail sprite that will point to the target. This is childed to the Minibubble component with a position of Vector3.zero and a size of (0.75, 0.75, 0.75). The sortingOrder of the SpriteRenderer is set to basesort with a color of E5D8BF (a similar color to the main textbox color). This object is stored in the <code>tail</code> field of the component.</li> <li><code>Tailback</code>: The background of the <code>Tail</code> sprite. This is childed to the <code>tail</code> with a position of Vector3.zero and a size of (1.2, 1.2, 1.2). The sortingOrder of the SpriteRenderer is set to basesort - 2 with a color of pure black.</li> </ul> <p>The parent of the transform is then set to the GUICamera with a localPosition of <code>pos</code> and without any scaling. A dialogueAnim is added to the component in the <code>anim</code> field with a shrinkspeed of 0.3 which effectively makes the shrink animation of the Minibubble take 30% of the time of the default time that textbox uses.</p> <p>Finally, the SetText call is done in non Dialogue mode with the <code>text</code> field as the input string:</p> <ul> <li><code>fonttype</code>: <code>BubblegumSans</code></li> <li><code>linebreak</code>: 3.5 in <code>English</code> or 3.25 on any other language (this is to workaround the broken auto line breaker, see OrganiseLines Known Issues &gt; Not counting a whole word's width after the first line for more details on why)</li> <li>No <code>tridimensional</code></li> <li><code>position</code>: (-1.55, 0.15)</li> <li>No <code>cameraoffset</code></li> <li><code>size</code>: (0.75, 0.75)</li> <li><code>parent</code>: The Minibubble's transform</li> <li><code>caller</code>: null</li> </ul>"},{"location":"SetText/Individual%20commands/Minibubble/#minibubble-lateupdate","title":"Minibubble LateUpdate","text":"<p>While the Minibubble is active, the <code>tail</code> will track the position of <code>target</code> by dynamically changing its angle (max 45 degrees) and localPosition depending on its horizontal location on the screen. Additionally, each lateUpdate will have the <code>target</code>'s entity set to be talking. If the <code>target</code> goes null, the <code>tail</code> will be disabled.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#minibubble-destruction","title":"Minibubble destruction","text":"<p>Syntax (1) is a special syntax that doesn't create a Minibubble, but instead tells SetText that we are in control of an existing one created by the parent. This is how the inner SetText call can track the Minibubble created by the outer SetText call. This means that this command should not be used in syntax (1) unless the parent has a Minibubble component.</p> <p>Once the inner SetText call is done and it has reached the Cleanup phase, the Minibubble if it exists will get automatically destroyed due to the parameterless command specified above being prepended to the input string. This destruction not only destroys the GameObject (in 1 second to let the shrink animation play) and its Minibubble component, but it also sets the <code>target</code> (if it exists) to no longer be talking.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#managing-minibbubles-from-the-outer-settext-call","title":"Managing Minibbubles from the outer SetText call","text":"<p>It is possible however to preemptively destroy a Minibubble using the destroyminibubble command. It is meant to be used in the outer SetText call, but while it can be used in the inner call, this is not recommended as it can lead to undefined behaviors.</p> <p>It is also possible to wait for wait for a Minibubble to complete from the outer call using a waitminibubble command. This will yield until the Minibubble goes null which only happens shortly after its destruction.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#a-note-about-halt","title":"A note about Halt","text":"<p>The halt command has a special use here: it can be used to let the outer call decide when the destruction of the Minibubble should occur, even after the 1.5 seconds default time. This can be done by placing a halt command at the end of <code>text</code> which will cause the inner call to stall indefinitely and thus prevents the destruction of the Minibubble. While it prevents the inner call to end, it can be ended by force from the outer call by using the destroyminibubble command mentioned above. Since the inner called is owned by the Minibubble GameObject, destroying it will stop the coroutine with it. This is safe to do because the inner call isn't in Dialogue mode which would have softlocked the game if it was.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#special-behaviors-when-in-control-of-a-minibubble","title":"Special behaviors when in control of a Minibubble","text":"<p>As syntax (1) of the inner call is done, this also changes the Letter processing behavior: it will no longer consider Text advance state and Dialogue mode to decide whether to yield between each iteration of the Char loop. Even if the speed is set to 0, it will still do a yield of 0 seconds. Additionally, the same happens with the wait command: it will always cause the yield to occur regardless of the Text advance state.</p>"},{"location":"SetText/Individual%20commands/Minibubble/#additional-remarks","title":"Additional remarks","text":"<p>This is one of the command supported by testdiag and it has special behaviors in that mode where <code>entity</code> is ignored and the player's entity is used instead.</p>"},{"location":"SetText/Individual%20commands/Money/","title":"Money","text":"<p>Add or remove a certain amount of berries from the berries count which can optionally come from a flagvar.</p>"},{"location":"SetText/Individual%20commands/Money/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|money,amount|\n</code></pre> <p>(2)</p> <pre><code>|money,var,flagvar|\n</code></pre> <p>(3)</p> <pre><code>|money,var,-,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Money/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Money/#amount-int","title":"<code>amount</code>: int","text":"<p>The amount of berries to add. This must be a valid int value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Money/#var","title":"<code>var</code>","text":"<p>This is just what determines how the amount of berries to add or remove is obtained. Any other value will this parameter to be interpreted as the <code>amount</code>.</p>"},{"location":"SetText/Individual%20commands/Money/#-","title":"<code>-</code>","text":"<p>This indicates to remove berries instead of adding them from the amount in <code>flagvar</code>. Any other value will behave like (2). if <code>var</code> is sent accordingly. An empty value will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Money/#flagvar-int","title":"<code>flagvar</code>:  int","text":"<p>The flagvar slot containing the amount of berries to add or remove. This must corresponds to an int of a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Money/#remarks","title":"Remarks","text":"<p>After the addition or subtraction has been performed, the berries count is clamped from 0 to 999.</p>"},{"location":"SetText/Individual%20commands/Mothfly/","title":"Mothfly","text":"<p>Replace the text of this command to a series of a specific amount of |icon,146,<code>size</code>| commands in a row where <code>size</code> is configurable.</p>"},{"location":"SetText/Individual%20commands/Mothfly/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|mothfly|\n</code></pre> <p>(2)</p> <pre><code>|mothfly,amount|\n</code></pre> <p>(3)</p> <pre><code>|mothfly,amount,size|\n</code></pre>"},{"location":"SetText/Individual%20commands/Mothfly/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Mothfly/#amount-int","title":"<code>amount</code>: int","text":"<p>The amount of icon commands to place in a row. This must be a valid int or an exception will be thrown. The default value is 1.</p>"},{"location":"SetText/Individual%20commands/Mothfly/#size-float","title":"<code>size</code>: float","text":"<p>The <code>size</code> parameter to send to each icon command. This must be a valid float or an exception will be thrown. The default value is 0.35.</p>"},{"location":"SetText/Individual%20commands/Mothfly/#remarks","title":"Remarks","text":"<p>If there are less than 2 rendered icon in Dialogue mode,  or any letter in Regular Letter Rendering, this command will also append  after the first occurrence and  after the second one.</p> <p>Char loop processing will resume at the same position than this command to accommodate the text replacement.</p>"},{"location":"SetText/Individual%20commands/Move/","title":"Move","text":"<p>Instruct the game to start a forcemove on an Entity to a specific position with a configurable speed, start and stop state.</p>"},{"location":"SetText/Individual%20commands/Move/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|move,entity,x,y,z|\n</code></pre> <p>(2)</p> <pre><code>|move,entity,x,y,z,multiplier|\n</code></pre> <p>(3)</p> <pre><code>|move,entity,x,y,z,multiplier,state|\n</code></pre> <p>(4)</p> <pre><code>|move,entity,x,y,z,multiplier,state,stopstate|\n</code></pre>"},{"location":"SetText/Individual%20commands/Move/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Move/#entity-int-string","title":"<code>entity</code>: int | string","text":"<p>The Entity that this command refers to. The int form is a regular Entity id and its restriction for valid values applies. The string is only applicable if caller isn't null and it will be interpreted as the int form otherwise. This form can be one of the following:</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Move/#x-float","title":"<code>x</code>: float","text":"<p>The x position to move the Entity to. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Move/#y-float-null","title":"<code>y</code>: float | <code>null</code>","text":"<p>The y position to move the <code>entity</code> to. The float form must be a valid float or an exception will be thrown. If the value is <code>null</code>, this will default to 0.0.</p> <p>It presumably was intended to be used to ignore the y value during the forcemove, but this logic gets overridden before the forcemove starts which negates this feature.</p>"},{"location":"SetText/Individual%20commands/Move/#z-float","title":"<code>z</code>: float","text":"<p>The z position to move the Entity to. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Move/#multiplier-float","title":"<code>multiplier</code>: float","text":"<p>The multiplier to apply to the regular speed at which the Entity will be moved. This must be a valid float or an exception will be thrown. If no value is specified, 1.0 is the default value.</p>"},{"location":"SetText/Individual%20commands/Move/#state-int","title":"<code>state</code>: int","text":"<p>The animation state to set the Entity when the forcemove will start. This must be a valid int or an exception will be thrown. If no value is specified, 1 is the default value.</p>"},{"location":"SetText/Individual%20commands/Move/#stopstate-int","title":"<code>stopstate</code>: int","text":"<p>The animation state to set the Entity when the forcemove is completed. This must be a valid int or an exception will be thrown. If no value is specified, 0 is the default value.</p>"},{"location":"SetText/Individual%20commands/Move/#remarks","title":"Remarks","text":"<p>This command moves the Entity to a specific position. If moving the entity relative to its current position is more desired, use moveahead instead.</p> <p>If for whatever reason, the entity cannot complete its forcemove after a while, a failsafe will trigger after it times out. This failsafe will instantly teleport the entity to its destination with smokes particles and end the forcemove. The specific time for a player entity is 250 frames or 375 frames during an event and if it is not a player entity, it's 500 frames when not in battle (or during a battle, but a checking dead is running) and 225 frames otherwise. The amount is doubled if extratimer is enabled on the entity.</p> <p>It should be noted however that due to a regression, this failsafe does not work in 1.1.1 and any situations that would have triggered it may results in a softlock instead. This issue was fixed in 1.1.2.</p>"},{"location":"SetText/Individual%20commands/Moveahead/","title":"Moveahead","text":"<p>Instruct the game to start a forcemove on an Entity where the destination is relative to its current position with a configurable speed, start and stop state.</p>"},{"location":"SetText/Individual%20commands/Moveahead/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|moveahead,entity,x,y,z|\n</code></pre> <p>(2)</p> <pre><code>|moveahead,entity,x,y,z,multiplier|\n</code></pre> <p>(3)</p> <pre><code>|moveahead,entity,x,y,z,multiplier,state|\n</code></pre> <p>(4)</p> <pre><code>|moveahead,entity,x,y,z,multiplier,state,stopstate|\n</code></pre>"},{"location":"SetText/Individual%20commands/Moveahead/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Moveahead/#entity-int-string","title":"<code>entity</code>: int | string","text":"<p>The Entity that this command refers to. The int form is a regular Entity id and its restriction for valid values applies. The string is only applicable if caller isn't null and it will be interpreted as the int form otherwise. This form can be one of the following:</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Moveahead/#x-float","title":"<code>x</code>: float","text":"<p>The x offset to move the Entity to. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Moveahead/#y-float-null","title":"<code>y</code>: float | <code>null</code>","text":"<p>This parameter value is ignored as its value is overridden to 0.0, but it must have a value for the command to be properly parsed. If it is not <code>null</code>, it must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Moveahead/#z-float","title":"<code>z</code>: float","text":"<p>The z offset to move the Entity to. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Moveahead/#multiplier-float","title":"<code>multiplier</code>: float","text":"<p>The multiplier to apply to the regular speed at which the Entity will be moved. This must be a valid float or an exception will be thrown. If no value is specified, 1.0 is the default value.</p>"},{"location":"SetText/Individual%20commands/Moveahead/#state-int","title":"<code>state</code>: int","text":"<p>The animation state to set the Entity when the forcemove will start. This must be a valid int or an exception will be thrown. If no value is specified, 1 is the default value.</p>"},{"location":"SetText/Individual%20commands/Moveahead/#stopstate-int","title":"<code>stopstate</code>: int","text":"<p>The animation state to set the Entity when the forcemove is completed. This must be a valid int or an exception will be thrown. If no value is specified, 0 is the default value.</p>"},{"location":"SetText/Individual%20commands/Moveahead/#remarks","title":"Remarks","text":"<p>This command is very similar to move, but it has 2 main differences. The first one is the <code>y</code> parameter is ignored, its value will always be 0.0. The second one is the final position to move the Entity isn't directly given, but rather is the result of adding (<code>x</code>,0,<code>z</code>) to the current entity's position. This allows to move the entity using a vector relative to its position rather than directly specify the new position.</p> <p>If for whatever reason, the entity cannot complete its forcemove after a while, a failsafe will trigger after it times out. This failsafe will instantly teleport the entity to its destination with smokes particles and end the forcemove. The specific time for a player entity is 250 frames or 375 frames during an event and if it is not a player entity, it's 500 frames when not in battle (or during a battle, but a checking dead is running) and 225 frames otherwise. The amount is doubled if extratimer is enabled on the entity.</p> <p>It should be noted however that due to a regression, this failsafe does not work in 1.1.1 and any situations that would have triggered it may results in a softlock instead. This issue was fixed in 1.1.2.</p>"},{"location":"SetText/Individual%20commands/Movewait/","title":"Movewait","text":"<p>Yield until a specific Entity's forcemove lock is released.</p>"},{"location":"SetText/Individual%20commands/Movewait/#syntax","title":"Syntax","text":"<pre><code>|movewait,entity|\n</code></pre>"},{"location":"SetText/Individual%20commands/Movewait/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Movewait/#entity-int-string","title":"<code>entity</code>: int | string","text":"<p>The Entity that this command refers to. The int form is a regular Entity id and its restriction for valid values applies. The string form can be one of the following:</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller's entity. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Music/","title":"Music","text":"<p>Change the current music from its filename with a configurable fade speed or fade the current music to silence.</p>"},{"location":"SetText/Individual%20commands/Music/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|music,musicname|\n</code></pre> <p>(2)</p> <pre><code>|music,musicname,fadespeed|\n</code></pre> <p>(3)</p> <pre><code>|music,null|\n</code></pre>"},{"location":"SetText/Individual%20commands/Music/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Music/#musicname-string","title":"<code>musicname</code>: string","text":"<p>The name of the music file without extensions to play from the <code>audio/music</code> resources directory. This must be a valid music filename or an exception will be thrown. TODO: document these?</p>"},{"location":"SetText/Individual%20commands/Music/#fadespeed-float","title":"<code>fadespeed</code>: float","text":"<p>The speed to fade the current music expressed in approximate percentage to fade every frame. This must be a valid float or an exception will be thrown. The default value is 0.1.</p>"},{"location":"SetText/Individual%20commands/Music/#null","title":"<code>null</code>","text":"<p>The presence of this value indicates to operate in syntax (3) which will fade the current music to silence, but not play another one.</p>"},{"location":"SetText/Individual%20commands/Music/#remarks","title":"Remarks","text":"<p>It is not possible to configure the <code>fadespeed</code> while using syntax (3) which means the fade speed will be 0.1.</p>"},{"location":"SetText/Individual%20commands/Next/","title":"Next","text":"<p>Signals the game that the current textbox is over and wait for a confirmation input before resuming with a fresh textbox.</p>"},{"location":"SetText/Individual%20commands/Next/#syntax","title":"Syntax","text":"<pre><code>|next|\n</code></pre>"},{"location":"SetText/Individual%20commands/Next/#parameters","title":"Parameters","text":"<p>The parameters corresponds to the ones sent to a tail command when the blank command is processed at the end of processing this command. If no parameters are sent, the tail command will not be processed at the end of the blank command.</p>"},{"location":"SetText/Individual%20commands/Next/#remarks","title":"Remarks","text":"<p>This commands will first reset <code>skiptext</code> and <code>Noskip</code> to false (See Text advance) and set the tailtarget to stop talking. It will then yield control back to MainManager's Update by setting waitinput to true and yielding until it becomes false. This causes the blinker to be enabled and for the standard input processing to occur until the textbox has been passed. When that happens, the text processed so far until this command is recorded for the Backtracking system if a backtracking wasn't in progress. The current backtracking if any is ended and finally, a blank command is processed.</p> <p>This command is essential to the Backtracking system as it is the only one that will give control back to the game allowing a backtracking to be initiated and it is also alongside goto one of the 2 commands that delimits what a textbox text is.</p> <p>This command is meant to work in Dialogue mode as it directly interacts with the dialogue system, but it may work without it.</p> <p>This commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Noskip/","title":"Noskip","text":"<p>Forces a stop on the text skip if one was in progress and also prevents any text skip to occur from this point until it is allowed again in Dialogue mode.</p>"},{"location":"SetText/Individual%20commands/Noskip/#syntax","title":"Syntax","text":"<pre><code>|noskip|\n</code></pre>"},{"location":"SetText/Individual%20commands/Noskip/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Noskip/#remarks","title":"Remarks","text":"<p>This commands does the same actions then stopskip with the addition that it sets <code>Noskip</code> to false which prevents further text skip. It also sets <code>isholdingskip</code> to fadeletter. For more information, see Text advance.</p> <p>This command does nothing in non Dialogue mode mode.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/","title":"NumberPrompt","text":"<p>Displays a prompt where an integer number can be entered by entering each digits and redirects upon confirmation or cancellation. The result is stored in a flagvar slot upon confirmation.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/#syntax","title":"Syntax","text":"<pre><code>|numberprompt,outflagvar,naxlength,confirmline,cancelline|\n</code></pre>"},{"location":"SetText/Individual%20commands/NumberPrompt/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/NumberPrompt/#outflagvar-int","title":"<code>outflagvar</code>: int","text":"<p>The flagvar slot to place the result upon confirmation. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/#maxlength-int","title":"<code>maxlength</code>: int","text":"<p>The maximum amount of digits allowed to be entered. Assigned to flagvar 10. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/#confirmline-int","title":"<code>confirmline</code>: int","text":"<p>This is the desired Dialogue line id to redirect when the number prompt is confirmed. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/#cancelline-int","title":"<code>cancelline</code>: int","text":"<p>This is the desired Dialogue line id to redirect when the number prompt is cancelled. This must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/#remarks","title":"Remarks","text":"<p>This command requires to be in Dialogue mode or SetText will not wait for the prompt to finish and resume processing as normal which can cause undefined behaviors.</p> <p>This command will first setup a number prompt to be displayed and yield until its outcome is determined using the same prompt lock used by prompt. </p> <p>The handling of the number prompt is done by MainManager's Update which restricts the inputs available to the 4 directions (to move the selected), confirm, cancel and pause (to set the selected option to the confirm one). This is where the <code>maxlength</code> constraint is checked: if a number is entered when the length of the current number text is the max, it will prevent the action. If the number prompt is confirmed, the <code>outflagvar</code> flagvar slot is assigned to the result before releasing the prompt lock. </p> <p>Once the outcome is determined, control goes back to SetText inside the Dialogue post-processing where it will redirect the input string to <code>cancelline</code> if cancelled and to <code>confirmline</code> if confirmed.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/#about-the-fields-flagvar-and-flagstring-used","title":"About the fields, flagvar and flagstring used","text":"<p>The way a number prompt works is by reusing some fields used in the prompt and letterprompt command as well as sharing some fields used by ItemList. It's important to note that while it may shares some fields with these 2 systems, they are NOT equivalent semantically. This can in theory cause problems if they mix, but in practice, all fields mentioned here are properly reset by this command or their respective systems before usage so in practice, it's mostly safe.</p> <p>Here are the fields in question:</p> <ul> <li><code>letterprompt</code>: Set to -1 to indicate this is not a letterprompt which is a superset of number prompt</li> <li><code>listcancelled</code>: Set to false during the command processing and to true if the number prompt was cancelled</li> <li><code>prompt</code>: Since this command uses the same lock then prompt, it works the same way here (set to true during the command processing and to false when SetText is done yielding and handles the outcome)</li> <li><code>numberprompt</code>: Set to true during the command processing (it's not set to false because its value won't matter after until a prompt command happens which itself would set it to false anyway)</li> <li><code>option</code>: The current option index from 0 to 11</li> <li><code>maxoptions</code>: The index of the last option being 11 here (NOTE: this isn't the same than prompt or ItemList where it's the AMOUNT of options)</li> <li><code>promptbox</code>: The 9box containing the prompt itself</li> <li><code>npromptholder</code>: A GameObject that lives as a child of the <code>promptbox</code> and it contains the current number text</li> <li><code>listtype</code>: This is the field used to store the <code>outflagvar</code> temporarily until the number prompt is confirmed. It does NOT correspond to an actual listtype.</li> <li><code>listredirect</code>: This is the field used to store the <code>confirmline</code> until the number prompt is confirmed. It has nothing to do with its usage in ItemList</li> <li><code>listcancel</code>: This is the field used to store the <code>cancelline</code> until the number prompt is cancelled. It has nothing to do with its usage in ItemList</li> </ul> <p>As for the flagvar, this command and its handling uses the following slots:</p> <ul> <li><code>outflagvar</code>: Will be used to output the result only if the prompt is confirmed (it is not touched if the prompt is cancelled)</li> <li>0: Will be set to 0 if its value was -555 before. This is to prevent this prompt from being seen as a letterprompt which is a superset of number prompt.</li> <li>4: Set to 0 every time the number prompt is refreshed (NOTE: why?)</li> <li>5: Set to -1 from this command, then changes to the button id if it's a direction input during the prompt handling. At the end of the prompt, this value will correspond to the last direction pushed during the prompt handling. This is actively used by numberprompt, but is still used here as a leftover feature without having any impact on the prompt handling.</li> <li>10: Set to <code>maxlength</code></li> </ul> <p>This command also uses flagstring 0 to store the number's text while the number prompt is being handled. Its integer representation is assigned to the <code>outflagvar</code> flagvar slot when the number prompt is confirmed. This temporary storage is necessary to track the length constraint by <code>maxlength</code>.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/#number-prompt-rendering","title":"Number prompt rendering","text":"<p>The <code>promptbox</code> is a regular 9box rendered at (0.0, -1.2, 10.0) of size (7.0, 3.0) with a sortingOrder of -3 with the color of the textbox with a grow animation</p> <p>The <code>npromptholder</code> is a new GameObject named <code>number holder</code> that lives as the child of the <code>promptbox</code>. Its local position to (0.0, 0.5, 0.05) without angles or scaling.</p> <p>To render each 12 options (the 10 digits, Confirm and Erase), the following is done:</p> <ul> <li>Start with the x and y position of the options be -2.25 and -0.25 respectively</li> <li>Render the options such that for each options:<ul> <li>Have each text be |choicewave,n,true| where n is the option index from 0 to 11. This is prepanded with menutext 42 (<code>Confirm</code>) for option 10 and menutext 74 (<code>Erase</code>) for option 11. Option 0-9 are the digits.</li> <li>Call SetText in non Dialogue mode using the text prepanded with |center|:<ul> <li>fonttype is <code>BubblegumSans</code></li> <li>no <code>linebreak</code></li> <li>no <code>tridimensional</code></li> <li><code>position</code> is (x, y, 0.0) where x and y are the current value of the option's positions.</li> <li>no <code>camoffset</code></li> <li><code>size</code> of (0.85, 0.85)</li> <li><code>parent</code> is the promptbox</li> <li>no <code>caller</code></li> </ul> </li> <li>Add 0.5 to x</li> <li>if we had just rendered option 9<ul> <li>Remove -1.5 to x and 0.75 to y</li> </ul> </li> <li>If we had just rendered option 10<ul> <li>Set x to 1.5</li> </ul> </li> </ul> </li> </ul> <p>After the initial setup, the first refresh of the number prompt is performed. This will destroy the text in <code>npromptholder</code> and rerender using the one in flagstring 0 which will get updated periodically as digits are added in removed during the prompt handling. This also sets flagvar 4 to 0. As for the rendering of the number text itself, it is done via a SetText call in non Dialogue mode with the text padded to the right with <code>_</code> to fit into <code>maxlength</code> prepended with |center|:</p> <ul> <li>fonttype is <code>BubblegumSans</code></li> <li>no <code>linebreak</code></li> <li>no <code>tridimensional</code></li> <li><code>position</code> is Vector3.zero.</li> <li>no <code>camoffset</code></li> <li><code>size</code> of Vector2.one</li> <li><code>parent</code> is the <code>npromptholder</code></li> <li>no <code>caller</code></li> </ul> <p>After the first refresh is done, a refresh will only get done after a digit is added/removed during the number prompt handling.</p>"},{"location":"SetText/Individual%20commands/NumberPrompt/#number-prompt-handling","title":"Number prompt handling","text":"<p>Just before ending the command processing, a 5 frame input cooldown is applied which allows the number prompt to appear on the screen. After the command has been processed, SetText will keep yielding frames in the Dialogue post-processing phase until <code>prompt</code> is set to false from MainManager's Update. This Update event completely changes the input handling of the game and in general, it restricts actions to interact with the current number prompt. Additionally, the <code>blinker</code> will be disabled. </p> <p>The actions will be restricted to the following:</p> <ul> <li>Up: Moves the cursor to option 0 (digit 0) and set flagvar 5 to 0</li> <li>Down: Moves the cursor to option 11 (Confirm) and set flagvar 5 to 1</li> <li>Left: Moves the cursor to the option below the current one and set flagvar 5 to 2</li> <li>Right: Moves the cursor to the option above the current one and set flagvar 5 to 3</li> <li>Pause: Move the cursor to the confirm option</li> <li>Cancel: Sets <code>listcancelled</code> to true, <code>promptpick</code> to 0, <code>promptpointers</code> to be one element containing <code>cancelline</code> fetched from <code>listcancel</code> and Text advance's <code>skiptext</code> to false. This will also apply a 15 frames inputcooldown, reset the Backtracking system and finally, release the <code>prompt</code> lock</li> <li>Confirm: A 5 frames input cooldown is applied and it also set <code>promptpick</code> to 0. The rest depends on the option currently selected before resetting the Backtracking system:<ul> <li>A number: Add the entered digit to flagstring 0 (current number text) and refresh the number prompt unless the length is <code>maxlength</code> from flagvar 10 in which case, the buzzer plays</li> <li>Erase: Remove the last entered digit from flagstring 0 (current number text) and refresh the number prompt unless the text was empty in which case, the buzzer plays</li> <li>Confirm: If flagstring 0 (current number text) is empty<ul> <li>This is treated the same way than if cancel was pressed with the exception that the input cooldown is 5 frames instead of 15 and <code>listcancelled</code> isn't set to false. </li> <li>If it wasn't empty, the <code>outflagvar</code> flagvar slot is set to the integer version of flagstring 0 (the current number text), <code>promptpointers</code> is set to one element containing <code>confirmline</code> fetched from <code>listredirect</code>, Text advance's <code>skiptext</code> is set to false, the Backtracking system is reset and finally, the <code>prompt</code> lock is released</li> </ul> </li> </ul> </li> </ul>"},{"location":"SetText/Individual%20commands/NumberPrompt/#handling-the-number-prompt-outcome","title":"Handling the number prompt outcome","text":"<p>When SetText is done yielding, the prompt will be handled immediately after in Prompt handling.</p> <p>After, processing continues as normal with a fresh input string once Dialogue post-processing is completed for this iteration of the char loop.</p>"},{"location":"SetText/Individual%20commands/Openpause/","title":"Openpause","text":"<p>Change the active window of the existing pause menu.</p>"},{"location":"SetText/Individual%20commands/Openpause/#syntax","title":"Syntax","text":"<pre><code>|openpause,windowid|\n</code></pre>"},{"location":"SetText/Individual%20commands/Openpause/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Openpause/#windowid-int","title":"<code>windowid</code>: int","text":"<p>The window id of the pause menu to open to. This must be a valid int or an exception will be thrown. Here are the different window id available:</p> Id Description -1 No window shown 0 Top level pause window (only offers \"Inventory\" and \"Medals and Stats\" during a battle) 1 \"Inventory\" window 2 \"Medals and Stats\" window 3 \"Library\" window 4 \"Settings\" window 5 Key Bindings's window 6 Map of Bugaria's window 7 Controller Bindings's window <p>Any other value has undefined behaviors.</p>"},{"location":"SetText/Individual%20commands/Openpause/#remarks","title":"Remarks","text":"<p>This command does nothing if the pause menu isn't present and it also sets end to true.</p> <p>This command is used in the very specific case where the pause menu is already opened, but navigation to a different window needs to happen via SetText. Its main application in the game is when returning to the pause menu after a key item usage prompt occurred.</p>"},{"location":"SetText/Individual%20commands/Optiontovar/","title":"Optionvar","text":"<p>Set flagvar 0 or a specific slot to the last selected option from a prompt, numberprompt or ItemList.</p>"},{"location":"SetText/Individual%20commands/Optiontovar/#syntax","title":"Syntax","text":"<p>(1) (Set flagvar 0 to <code>option</code>)</p> <pre><code>|optionvar|\n</code></pre> <p>(2)</p> <pre><code>|optionvar,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Optiontovar/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Optiontovar/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot to set the <code>option</code> value to. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Optiontovar/#remarks","title":"Remarks","text":"<p><code>option</code> is a notable field used to indicate the currently selected option starting from 0 in any prompt, numberprompt or ItemList. It is an essential field for handling a confirmation with them. For more information, see Prompt &gt; Prompt handling, NumberPrompt &gt; About the fields, flagvar and flagstring used and ItemList State Machine &gt; Options management.</p>"},{"location":"SetText/Individual%20commands/Overfollower/","title":"Overfollower","text":"<p>Toggles or set an override on followers to stop following their followee.</p>"},{"location":"SetText/Individual%20commands/Overfollower/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|overfollower|\n</code></pre> <p>(2)</p> <pre><code>|overfollower,enable|\n</code></pre>"},{"location":"SetText/Individual%20commands/Overfollower/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Overfollower/#enable-true-false","title":"<code>enable</code>: <code>true</code> | <code>false</code>","text":"<p>Whether to enable the follower override or to disable it. This must be equal to <code>true</code> or <code>false</code> without case sensitivity or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Overfollower/#remarks","title":"Remarks","text":"<p>(1) Toggles the follower overridefrom false to true or true to false depending on its existing state and does a StopForceMove on all party entities except the lead. (2) Set the follower override depending on the value of <code>enable</code>.</p> <p>This toggles <code>overridefollower</code> which is an instance field of MainManager. It is a way for the game to force followers (including player ones) to not follow their followee. Setting it to true will force followers to not follow while setting it to false will have followers do their standard behaviors.</p>"},{"location":"SetText/Individual%20commands/Parent/","title":"Parent","text":"<p>Change the caller to an Entity's NPCControl.</p>"},{"location":"SetText/Individual%20commands/Parent/#syntax","title":"Syntax","text":"<pre><code>|parent,entity|\n</code></pre>"},{"location":"SetText/Individual%20commands/Parent/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Parent/#entity-int","title":"<code>entity</code>:  int","text":"<p>The Entity id used to set the caller to its NPCControl. This must be a valid int value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Particle/","title":"Particle","text":"<p>Play a particle effect at an Entity's position + a specific offset.</p>"},{"location":"SetText/Individual%20commands/Particle/#syntax","title":"Syntax","text":"<pre><code>|particle,name,entity,offsetx,offsety,offsetz|\n</code></pre>"},{"location":"SetText/Individual%20commands/Particle/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Particle/#name-string","title":"<code>name</code>: string","text":"<p>The name of the particle to play. This must be a valid filename inside the <code>Assets/Ressources/Prefabs/Particles</code> or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Particle/#entity-int-caller-this-string","title":"<code>entity</code>: int | <code>caller</code> | <code>this</code> | string","text":"<p>The Entity id or designator to play the particle relative to. The int form represents an Entity id and it must be a valid int or an exception will be thrown. If the entity resolves to null, an exception will be thrown. These other values are only applicable if the caller isn't null:</p> <ul> <li><code>this</code>: Refers to the tailtarget.</li> <li><code>caller</code>: Refers to the caller.</li> <li>Anything else: Refers to a define if it exists, otherwise, this is interpreted as a regular Entity id which will cause an exception to be thrown.</li> </ul>"},{"location":"SetText/Individual%20commands/Particle/#offsetx-float","title":"<code>offsetx</code>: float","text":"<p>The X coordinate of the offset to play the particle relative to <code>entity</code>'s position. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Particle/#offsety-float","title":"<code>offsety</code>: float","text":"<p>The Y coordinate of the offset to play the particle relative to <code>entity</code>'s position. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Particle/#offsetz-float","title":"<code>offsetz</code>: float","text":"<p>The Z coordinate of the offset to play the particle relative to <code>entity</code>'s position. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/PartyGame/","title":"PartyGame","text":"<p>This command will cause an exception to be thrown (see remarks for more details), do not use. </p>"},{"location":"SetText/Individual%20commands/PartyGame/#syntax","title":"Syntax","text":"<pre><code>|partygame|\n</code></pre>"},{"location":"SetText/Individual%20commands/PartyGame/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/PartyGame/#remarks","title":"Remarks","text":"<p>This command was intended to start a third minigame similarly to how beeGame and dungeongame operates. However, this minigame ended up being scrapped earlier in development and this command as well as a few unused assets remained as relics from it.</p> <p>It is technically a valid command and it will process and attempt to start a minigame in a similar manner to the other 2, but because no object is assigned to the game, SetText will throw.</p> <p>This command is unused under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Pauseline/","title":"Pauseline","text":"<p>An alias of line that is only processed by SetText when the pause menu is active and either in no window or in the following windows: top level window, \"Inventory\" and \"Medals and Stats\".</p>"},{"location":"SetText/Individual%20commands/Pauseline/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|pauseline|\n</code></pre> <p>(2)</p> <pre><code>|pauseline,linespacing|\n</code></pre>"},{"location":"SetText/Individual%20commands/Pauseline/#parameters","title":"Parameters","text":"<p>The same as line. Check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Pauseline/#remarks","title":"Remarks","text":"<p>Just like line, this commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it.</p> <p>This command was presumably done as a workaround to the OrganiseLines Known Issues &gt; Not counting a whole word's width after the first line problem.</p>"},{"location":"SetText/Individual%20commands/Pausesize/","title":"Pausesize","text":"<p>An alias of size where the command is only processed if the pause menu is active and the questboardobj for the Quest Board List Type is inactive.</p>"},{"location":"SetText/Individual%20commands/Pausesize/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|pausesize,sizeuniform|\n</code></pre> <p>(2)</p> <pre><code>|pausesize,sizex,sizey|\n</code></pre> <p>(3)</p> <pre><code>|pausesize,unpause,sizex,sizey|\n</code></pre> <p>(4)</p> <pre><code>|pausesize,sizex,sizey,lockcontrol|\n</code></pre>"},{"location":"SetText/Individual%20commands/Pausesize/#parameters","title":"Parameters","text":"<p>The same as size, check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Pausesize/#remarks","title":"Remarks","text":"<p>Just like size, this command affects OrganiseLines by changing the horizontal size scaling used to predict the amount of space further letters will take. This is done ignoring the size's locking system so even if the command isn't going to change the size once processed, it will still be taken as a width change for the auto line breaker which can cause problems.</p>"},{"location":"SetText/Individual%20commands/Pickitem/","title":"PickItem","text":"<p>Setup an ItemList using ShowItemList with the parameters sent in Dialogue mode which can get handled by SetText after the ItemList goes inactive.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|pickitem,type,redirect,cancel|\n</code></pre> <p>(2)</p> <pre><code>|pickitem,type,storeid,desc,sell,redirect,cancel|\n</code></pre> <p>(3)</p> <pre><code>|pickitem,type,storeid,desc,sell,redirect,cancel,ammount|\n</code></pre>"},{"location":"SetText/Individual%20commands/Pickitem/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Pickitem/#type-int","title":"<code>type</code>: int","text":"<p>The listtype. This must be a valid int value or an exception will be thrown. For more information on how each value behaves, consult the listtype document.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#redirect-int","title":"<code>redirect</code>: int","text":"<p>The <code>listredirect</code>. This must be a valid int value or an exception will be thrown. This is the desired Dialogue line id to redirect when the ItemList is confirmed. There are special values that can be specified which are exceptions to this:</p> <ul> <li>null: No redirection, just run the post ItemList handler.</li> <li>-1: This acts like null.</li> <li>-2: No redirection, but assume in the post ItemList handler that this an items was selected to be tossed after a additemtoss command. By this point, the selected item id must be in flagvar 1 and the original item passed in additemtoss to be in flagvar 0. The caller (which is assumed to be the item above the player's Entity) will have its appearance set to the selected item. It will get tossed in a random direction and disappear after 600 frames. This will also remove the selected item id from the inventory of the <code>itemtype</code> sent to additemtoss (which is now the listtype) and it will add the item id sent to additemtoss in that same inventory.</li> <li>-3: No redirection, same as -2, but assume that we are tossing the same item sent to additemtoss which means everything happens the same way except the inventory operations and the change of the caller's appearance.</li> </ul> <p>-2 and -3 should never be sent outside of an additemtoss context or undefined behaviors will occur.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#cancel-int","title":"<code>cancel</code>: int","text":"<p>The <code>listcancel</code>. This must be a valid int value or an exception will be thrown. This works the same way than <code>redirect</code>, but the value will only become the outcome in the post ItemList handler if the list has been cancelled.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#storeid-int","title":"<code>storeid</code>: int","text":"<p>The <code>storeid</code>. This must be a valid int value or an exception will be thrown. The default value is 0.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#desc-true-false","title":"<code>desc</code>: <code>true</code> | <code>false</code>","text":"<p>The <code>listdesc</code>. This must be equal to <code>true</code> or <code>false</code> without case sensitivity or an exception will be thrown. The default value is <code>true</code>.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#sell-true-false","title":"<code>sell</code>: <code>true</code> | <code>false</code>","text":"<p>The <code>listsell</code>. This must be equal to <code>true</code> or <code>false</code> without case sensitivity or an exception will be thrown. The default value is <code>false</code>.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#amount-int","title":"<code>amount</code>: int","text":"<p>The <code>listammount</code>. This must be a valid int value or an exception will be thrown. The default value is 5.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#remarks","title":"Remarks","text":"<p>This command will first reset <code>multiselect</code> to a new list and an <code>inputcooldown</code> of 5 frames is applied. It will then set all the ItemList State Machine fields mentioned above to each of their respective parameter value.</p> <p>After, it will call ShowItemList with <code>type</code> as the type, (4.0, 0.5) as the position, <code>listdesc</code> as the <code>showdescription</code> and <code>listsell</code> as the sell.</p> <p>This command requires Dialogue mode otherwise, SetText will not wait for the ItemList to finish processing and as such, it will not get handled.</p>"},{"location":"SetText/Individual%20commands/Pickitem/#post-itemlist-handler","title":"Post ItemList handler","text":"<p>After the call is made, the regular ItemList system kicks in just like it would without SetText. For more information on how this system and its state machine works, consult the ItemList document. The key difference is SetText will handle the outcome of the ItemList which is <code>listredirect</code> in the case of a confirmation and <code>listcancel</code> in the case of a cancellation. This is done in 2 parts during the ItemList handling</p> <p>Additionally, if -2 or -3 was the outcome, end is set to true, <code>listredirect</code> is set to null, an <code>actioncooldown</code> of 30 frames is applied and <code>eventcall</code> is set to the one determined from the additemtoss command processing.</p>"},{"location":"SetText/Individual%20commands/Position/","title":"Position","text":"<p>Set the vertical position of the textholder relative to its parent.</p>"},{"location":"SetText/Individual%20commands/Position/#syntax","title":"Syntax","text":"<pre><code>|position,verticalposition|\n</code></pre>"},{"location":"SetText/Individual%20commands/Position/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Position/#velocity-float","title":"<code>velocity</code>: float","text":"<p>The vertical position to set the textholder to. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Position/#remarks","title":"Remarks","text":"<p>This command is unused under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Prompt/","title":"Prompt","text":"<p>Display a prompt offering multiple options with cancellation support, then wait that an option has been chosen and process it in the same SetText call.</p>"},{"location":"SetText/Individual%20commands/Prompt/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|prompt,yesno,yespoointer,nopointer|\n</code></pre> <p>(2)</p> <pre><code>|prompt,yesno,yespoointer,nopointer,canceloption|\n</code></pre> <p>(3)</p> <pre><code>|prompt,type,xminsizeyoffset,maxoptions,promptpointers...,prompttexts...,canceloption|\n</code></pre>"},{"location":"SetText/Individual%20commands/Prompt/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Prompt/#type-yesno-map-card-main-menu","title":"<code>type</code>: <code>yesno</code> | <code>map</code> | <code>card</code> | <code>main</code> | <code>menu</code>","text":"<p>The type of the prompt to use which dictates what <code>promptpointers</code> and <code>prompttexts</code> (in int form) refers to (this is case sensitive):</p> <ul> <li><code>yesno</code>: An alias for syntax (3) where the <code>type</code> is <code>map</code>, <code>xminsizeypos</code> is 0.5 (which is a dummy value), <code>maxoptions</code> is 2, <code>promptpointers</code> are the <code>yespointer</code> and <code>nopointer</code> values respectively, <code>prompttexts</code> are the yes and no line ids from MenuText respectively and <code>canceloption</code> will be the one provided in syntax (2) or default to 1 in syntax (1) which is the no option.</li> <li><code>map</code>: The <code>promptpointers</code> and the int form of <code>prompttexts</code> refers to Dialogue line ids. If any pointer is an invalid Dialogue line id, an exception will be thrown.</li> <li><code>card</code>: The <code>promptpointers</code> refers to a CardDialogue line id and the int form of <code>prompttexts</code> refers to a Dialogue line ids. If any pointer is an invalid id or a Spy Cards battle isn't in progress, an exception will be thrown.</li> <li><code>main</code>, <code>menu</code>: The <code>promptpointers</code> and the int form of <code>prompttexts</code> refers to a MenuText line id. If any pointer is an invalid id, an exception will be thrown.</li> </ul> <p>Any other value will default to <code>map</code>.</p>"},{"location":"SetText/Individual%20commands/Prompt/#yespointer-int","title":"<code>yespointer</code>: int","text":"<p>The Dialogue line id for the yes option in syntax (1) and (2). This value must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Prompt/#nopointer-int","title":"<code>nopointer</code>: int","text":"<p>The Dialogue line id for the no option in syntax (1) and (2). This value must be a valid Dialogue line id or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Prompt/#xminsizeyoffset-array-split-by-xfloat-float","title":"<code>xminsizeyoffset</code>: array split by <code>;</code>: <code>x</code>float | <code>$</code>float","text":"<p>This allows to specify a minimum horizontal size and a vertical offset when rendering the prompt. The last <code>x</code>float element refers to the the former while the last <code>$</code>float element refers to the later. Any other element prefixes will cause the element to be ignored and the float part of the elements must be valid float values or an exception will be thrown. Any separator other than <code>;</code> will be ignored and be parsed as if it was part of the element. Either values are optional and it is possible to provide a dummy value to this parameter to not specify either. The order of the values in the array does not matter, but if a value is specified in multiple element, the last one takes priority.</p>"},{"location":"SetText/Individual%20commands/Prompt/#maxoptions-int","title":"<code>maxoptions</code>: int","text":"<p>The number of options this prompt has. This value must be a valid int value or an exception will be thrown. Additionally, this value dictates the amount of <code>promptpointers</code> and <code>prompttexts</code> the command has. If this value is higher than the amount of either of these parameters, an exception will be thrown and if it is lower than either, SetText will only read the amount specified by this parameter and ignore the remaining ones.</p>"},{"location":"SetText/Individual%20commands/Prompt/#promptpointers-int","title":"<code>promptpointers</code>: int...","text":"<p>The line ids of each of the prompt options. The amount to specify must be equal or higher than <code>maxoptions</code> and each must be a valid line id value or an exception will be thrown. The type of line id to use is dictated by the <code>type</code> value.</p>"},{"location":"SetText/Individual%20commands/Prompt/#prompttexts-string-int","title":"<code>prompttexts</code>: <code>@</code>string... | int","text":"<p>The displayed texts or Dialogue line id of each of the prompt options. The amount to specify must be equal or higher than <code>maxoptions</code> and each int form must be a valid Dialogue line id value or an exception will be thrown. </p> <p>For the <code>@</code>string form, this specifies the text directly with inline commands support. Every <code>}</code> will be replaced by <code>,</code> and every <code>{</code> will be replaced by <code>|</code> which allows the command parser to process commands from a separate SetText after parsing this prompt one. This form takes priority over the int one and any other prefix of the string will be ignored and the value will be taken as an int.</p>"},{"location":"SetText/Individual%20commands/Prompt/#canceloption-none-1-int","title":"<code>canceloption</code>: <code>none</code> | <code>-1</code> | <code>$</code>int","text":"<p>The cancel option index for the <code>$</code>int form or disables the ability to cancel with <code>none</code> or <code>-1</code>. Specifying <code>$-1</code> is equivalent to <code>-1</code> or <code>none</code>. Otherwise, the int must be between 0 and <code>maxoptions</code> - 1. Any other int will cause an exception to be thrown upon the prompt's option being chosen. Any other value or any int prefixed with anything other than <code>$</code> will be ignored and the value will default to the equivalent of <code>none</code> or <code>-1</code>. If this option is not specified, the last parameter sent to this command (which is the last <code>prompttexts</code> value) is used as this parameter's value instead.</p>"},{"location":"SetText/Individual%20commands/Prompt/#remarks","title":"Remarks","text":"<p>This command requires to be in Dialogue mode or SetText will not wait for the prompt to finish and resume processing as normal which can cause undefined behaviors.</p> <p>For the <code>xminsize</code> part of <code>xminsizeyoffset</code>, the horizontal length of the prompt is calculated by taking the longest among the <code>prompttexts</code> text. If that length is smaller than the <code>xminsize</code>, the <code>xminsize</code> will be the horizontal length of the prompt. Otherwise, the calculated length takes precedence.</p>"},{"location":"SetText/Individual%20commands/Prompt/#prompt-handling","title":"Prompt handling","text":"<p>While this command manages the creation and setup of the prompt, its handling is left to be handled in MainManager's Update. There are several MainManager instance fields in this command to make this possible:</p> <ul> <li><code>promptbox</code>: The 9box containing the prompt, created during processing using <code>xminsizeyoffset</code> and the texts obtained from <code>prompttexts</code> using separate SetText calls for each in non Dialogue mode. These calls are done with the following parameters:<ul> <li>The input string is the text value appended with |choicewave,o| where o is the corresponding option index. </li> <li>fonttype is <code>BubblegumSans</code></li> <li>No <code>linebreak</code></li> <li>No <code>tridimensional</code></li> <li><code>position</code> is (0.0 - <code>xminsize</code> - 0.1, <code>yoffset</code>, 0.0)</li> <li>No <code>camoffset</code></li> <li>size is (0.85, 0.85, 1.0)</li> <li><code>parent</code> is the <code>promptbox</code> itself</li> <li><code>caller</code> is null</li> </ul> </li> <li><code>prompt</code>: The flag tracking if a prompt is active, set to true during this command's processing and set to false by MainManager's Update once an option has been chosen.</li> <li><code>promptpick</code>: The option index chosen, already been set to -1 from the Setup phase and set by MainManager's Update when an option has been chosen to <code>option</code> (if a cancel was performed, <code>listcancel</code> will be used instead).</li> <li><code>promptpointers</code>: The pointers specified by <code>promptpointers</code> which are set during the processing of this command.</li> <li><code>maxoptions</code>: The amount of option the prompt has which is set from this command's <code>maxoptions</code> during processing.</li> <li><code>option</code>: The option index the cursor is currently at, initialized to 0 from this command's processing.</li> <li><code>listcancel</code>: The option index that will be the promptpick if a cancel is performed or -1 if cancelling is disabled, set by <code>canceloption</code> during this command's processing (-1 is set if the value is <code>-1</code> or <code>none</code>).</li> </ul> <p>Just before ending the command processing, a 5 frame input cooldown is applied which allows the prompt to appear on the screen. After the command has been processed, SetText will keep yielding frames in the Dialogue post-processing phase until <code>prompt</code> is set to false from MainManager's Update. This Update event completely changes the input handling of the game and in general, it restricts actions to interact with the current prompt. Additionally, the <code>blinker</code> will be disabled. The actions will be restricted to the following:</p> <ul> <li>Up: Moves the cursor to the option above or to the last option if it was on the first one (also sets <code>option</code> accordingly).</li> <li>Down: Moves the cursor to the option below or to the first option if it was on the last one (also sets <code>option</code> accordingly).</li> <li>Cancel: If <code>listcancel</code> is not -1, sets <code>prompt</code> to false with <code>listcancel</code> as the <code>promptpick</code> and play the cancel sound, otherwise, nothing happens.</li> <li>Confirm: Sets <code>prompt</code> to false and <code>promptpick</code> to <code>option</code> and play the confirm sound.</li> </ul> <p>Once the prompt handling is complete, MainManager.Update will set Text advance's <code>skiptext</code> to false, apply an input cooldown of 10 frames on cancel or 5 frames on confirm and revert its input processing to the standard method.</p>"},{"location":"SetText/Individual%20commands/Prompt/#handling-the-chosen-option","title":"Handling the chosen option","text":"<p>When SetText is done yielding, the prompt will be handled immediately after in Prompt handling. To note, flagvar 0 being -555 is supposed to be false because this is the way the game can know it was a letterprompt, but its value isn't written by this command. This may cause the textbox to unhide itself if a letterprompt was processed before.</p> <p>After, processing continues as normal with a fresh input string once Dialogue post-processing is completed for this iteration of the char loop.</p>"},{"location":"SetText/Individual%20commands/Quarterline/","title":"Quarterline","text":"<p>An alias of line where <code>linespacing</code> is 0.25.</p>"},{"location":"SetText/Individual%20commands/Quarterline/#syntax","title":"Syntax","text":"<pre><code>|quarterline|\n</code></pre>"},{"location":"SetText/Individual%20commands/Quarterline/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Quarterline/#remarks","title":"Remarks","text":"<p>See the line page for more details on the function of the command as this one behaves the same way where <code>linespacing</code> is set to 0.25.</p> <p>There is one issue specific to this command and halfline however: In Regular Letter Rendering and Dialogue mode, this command is accumulated for the Backtracking system twice instead of only once. This is because being in Dialogue mode no matter the letter rendering method will accumulate it before processing the command in the Vertical bar processing, but since this command is also an alias of line, it will also accumulate it a second time if the rendering method is Regular Letter Rendering which makes it repeat twice in a row when backtracking to the textbox containing the command.</p> <p>This commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it.</p> <p>This is one of the command supported by testdiag if the command name part is written as <code>line</code> with case sensitivity.</p>"},{"location":"SetText/Individual%20commands/Questbreak/","title":"Questbreak","text":"<p>Signal the char loop that processing is completed once this iteration ends under certain conditions (this command is broken, see the remarks section for details).</p>"},{"location":"SetText/Individual%20commands/Questbreak/#syntax","title":"Syntax","text":"<p>(1) (This will throw an exception, do not use)</p> <pre><code>|questbreak|\n</code></pre> <p>(2)</p> <pre><code>|questbreak,condition|\n</code></pre>"},{"location":"SetText/Individual%20commands/Questbreak/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Questbreak/#condition-true-false","title":"<code>condition</code>: <code>true</code> | <code>false</code>","text":"<p>This must be a valid bool or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Questbreak/#remarks","title":"Remarks","text":"<p>The exact conditions depends if the <code>questboardobj</code> of the Quest Board List Type is active or not:</p> <ul> <li>If it's active, the signal to the char loop is sent if <code>condition</code> is true AND syntax (1) is used. Since both of these conditions are incompatible, the former's check will throw an exception.</li> <li>If it's inactive, the signal to the char loop is sent if syntax (2) is used (this will throw an exception if syntax (1) is used because it still checks for the value of <code>condition</code> which wouldn't exist).</li> </ul>"},{"location":"SetText/Individual%20commands/Questprompt/","title":"Questprompt","text":"<p>Sets the last prompt as a quest prompt which needs specific handling.</p>"},{"location":"SetText/Individual%20commands/Questprompt/#syntax","title":"Syntax","text":"<pre><code>|questprompt|\n</code></pre>"},{"location":"SetText/Individual%20commands/Questprompt/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Questprompt/#remarks","title":"Remarks","text":"<p>When confirming an ItemList whose type is Quest Board List Type, this will call SetText with a prompt command to ask if it should be taken. If it is, it will redirect like a normal prompt command, but this isn't enough: the actual BoardQuests needs to be transferred using activateselectedquest as well as some special handling logic that are specific to quest prompts such as showing the tutorial if applicable.</p> <p>This commands allows SetText to know that it is dealing with such prompts. How it works is during the Quest Board List Type &gt; Confirmation handling, it will call SetText with the boardcaller's dialogue line, but it will be prepended with this command. This command will be in effect for the rest of the SetText call, but it is typically used only once. The effect will only be taken into account during Dialogue post-processing.</p> <p>If it is in effect and we have confirmed a prompt, after obtaining the OrganiseLines version of the dialogue text to redirect, that text is appended with a string that handles the quest prompt.</p> <p>If we confirmed any other option than the first one (which is the Yes one), this string is |break||loadcamera||end|.</p> <p>If we confirmed the first option (Yes), this string starts with |activateselectedquest||break|. If flag 64 is false (received the quest board tutorial), this is also added to it: |tail,null||blank||boxstyle,4| followed by menutext 170 (the quest board tutorial) followed by |flag,64,true||break|. Finally, this last portion is added in either cases: |loadcamera||end|.</p>"},{"location":"SetText/Individual%20commands/Questsize/","title":"Questsize","text":"<p>An alias of size where the command is only processed if the questboardobj for the Quest Board List Type is active.</p>"},{"location":"SetText/Individual%20commands/Questsize/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|questsize,sizeuniform|\n</code></pre> <p>(2)</p> <pre><code>|questsize,sizex,sizey|\n</code></pre> <p>(3)</p> <pre><code>|questsize,unpause,sizex,sizey|\n</code></pre> <p>(4)</p> <pre><code>|questsize,sizex,sizey,lockcontrol|\n</code></pre>"},{"location":"SetText/Individual%20commands/Questsize/#parameters","title":"Parameters","text":"<p>The same as size, check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Questsize/#remarks","title":"Remarks","text":"<p>Just like size, this command affects OrganiseLines by changing the horizontal size scaling used to predict the amount of space further letters will take. This is done ignoring the size's locking system so even if the command isn't going to change the size once processed, it will still be taken as a width change for the auto line breaker which can cause problems.</p>"},{"location":"SetText/Individual%20commands/Rainbow/","title":"Rainbow","text":"<p>Toggles the rainbow FontEffects that will be effective from this point in Regular Letter Rendering.</p>"},{"location":"SetText/Individual%20commands/Rainbow/#syntax","title":"Syntax","text":"<pre><code>|rainbow|\n</code></pre>"},{"location":"SetText/Individual%20commands/Rainbow/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Rainbow/#remarks","title":"Remarks","text":"<p>This turns the rainbow FontEffects from false to true or from true to false depending on its existing state. The state change will affect every letter from the point this command is being processed.</p> <p>This command does not work correctly in Single Letter Rendering. While it will toggle the effect correctly on the letter slot, it will not look correctly.</p> <p>This command is accumulated for the Backtracking system.</p> <p>This is one of the command supported by testdiag if the command name part is written as <code>line</code> with case sensitivity.</p>"},{"location":"SetText/Individual%20commands/Regionalflag/","title":"Regionalflag","text":"<p>Set a Regionalflag slot to a value.</p>"},{"location":"SetText/Individual%20commands/Regionalflag/#syntax","title":"Syntax","text":"<pre><code>|regionalflag,regional,value|\n</code></pre>"},{"location":"SetText/Individual%20commands/Regionalflag/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Regionalflag/#regional-int","title":"<code>regional</code>: int","text":"<p>The Regionalflag slot to set its value. This must be a valid Regionalflag slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Regionalflag/#value-true-false","title":"<code>value</code>: <code>true</code> | <code>false</code>","text":"<p>The value to set the regional slot. This must be <code>true</code> or <code>false</code> or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Removebadgeshop/","title":"Removebadgeshop","text":"<p>Removes a medal from a medal shop by its medal id or by a flagvar containing it.</p>"},{"location":"SetText/Individual%20commands/Removebadgeshop/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|removebadgeshop,medalshopid,medalid|\n</code></pre> <p>(2)</p> <pre><code>|removebadgeshop,medalshopid,var,flagvar|\n</code></pre>"},{"location":"SetText/Individual%20commands/Removebadgeshop/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Removebadgeshop/#medalshopid-int","title":"<code>medalshopid</code>: int","text":"<p>The medal shop id to remove the medal from. This must be a valid medal shop id or an exception will be thrown.</p> <p>Here are the different values available:</p> Id Name 0 Merab's shop 1 Shades's shop"},{"location":"SetText/Individual%20commands/Removebadgeshop/#medalid-int","title":"<code>medalid</code>: int","text":"<p>The Medal to remove from the medal shop. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Removebadgeshop/#var","title":"<code>var</code>","text":"<p>The presence of this is only to indicate to operate in syntax (1). Any other value will be interpreted as <code>medalid</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Removebadgeshop/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot containing the Medal to remove from the medal shop. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Removebadgeshop/#remarks","title":"Remarks","text":"<p>If the Medal does not exist in the given shop, this command does nothing.</p> <p>If the concerned medal shop is Shades's shop, this will also increment flagvar 66 with the assumption that the medal was bought before the removal.</p>"},{"location":"SetText/Individual%20commands/Removefollower/","title":"Removefollower","text":"<p>Remove a follower from the <code>extrafollowers</code> list by AnimID or remove all followers from it</p>"},{"location":"SetText/Individual%20commands/Removefollower/#syntax","title":"Syntax","text":"<p>(1) (Removes all followers by clearing the extrafollowers list)</p> <pre><code>|removefollower|\n</code></pre> <p>(2)</p> <pre><code>|removefollower,follower|\n</code></pre>"},{"location":"SetText/Individual%20commands/Removefollower/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Removefollower/#follower-int","title":"<code>follower</code>: int","text":"<p>The follower's AnimID to remove. This must be a valid AnimID or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Removefollower/#remarks","title":"Remarks","text":"<p>For syntax (2), Only the first occurrence of the follower will be removed if multiple exists with the same AnimID. If no such follower exists, this command does nothing.</p> <p>Since this only removes the follower(s) from the <code>extrafollowers</code> list, a map change needs to be done for the removal to take effect because the follower(s) is still in the <code>map.tempfollowers</code> list if it was allowed by the <code>canfollowID</code> whitelist.</p>"},{"location":"SetText/Individual%20commands/Removeitem/","title":"Removeitem","text":"<p>Remove a medal by its id or an item by its index from a specific inventory type where the item index or medal id is specified directly or is contained into a specified flagvar slot. This can also remove all items that was multi selected in the last ItemList if it was a <code>listsell</code>.</p>"},{"location":"SetText/Individual%20commands/Removeitem/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|removeitem,itemtype,item|\n</code></pre> <p>(2)</p> <pre><code>|removeitem,itemtype,var,itemflagvar|\n</code></pre> <p>(3) (Not recommended, see remarks, only for removing all multi selected items)</p> <pre><code>|removeitem|\n</code></pre>"},{"location":"SetText/Individual%20commands/Removeitem/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Removeitem/#itemtype-0-1-2-3","title":"<code>itemtype</code>: <code>0</code> | <code>1</code> | <code>2</code> | <code>3</code>","text":"<p>The inventory type this command should give the item:</p> <ul> <li>0: Standard items.</li> <li>1: Key items. </li> <li>2: Storage items.</li> <li>3: Medals (will cause <code>item</code>/<code>itemflagvar</code> to resolve to a medal id instead of an item index).</li> </ul> <p>Any other value will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Removeitem/#var","title":"<code>var</code>","text":"<p>This value instructs the parser to use syntax (2). If <code>itemtype</code> is <code>3</code>, any other value will cause this parameter to be interpreted as <code>item</code> while if <code>itemtype</code> is NOT <code>3</code>, any value not containing <code>var</code> will cause this parameter to be interpreted as <code>item</code>.</p>"},{"location":"SetText/Individual%20commands/Removeitem/#item-int","title":"<code>item</code>: int","text":"<p>The item index or the medal id to remove. </p> <p>For an item index, this must be a non negative number lower than the number of items in possession of the <code>itemtype</code> inventory type or an exception will be thrown.</p> <p>For a medal id, this must be a valid integer or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Removeitem/#itemflagvar-int","title":"<code>itemflagvar</code>: int","text":"<p>The flagvar slot to get the item index or the medal id to remove. This must be a valid flagvar slot or an exception will be thrown. After the value was obtained from the flagvar, the restrictions from <code>item</code> applies the same way.</p>"},{"location":"SetText/Individual%20commands/Removeitem/#remarks","title":"Remarks","text":"<p>This command will first check if <code>multiselect</code> was allowed and performed on the last ItemList that was processed. If it was, this completely ignores any parameters which makes it behave like syntax (3) where it will remove all items that was selected from the list (<code>multiselect</code> already contains the options indexes which should already match the inventory indexes). If <code>multiselect</code> was allowed and performed, but <code>listsell</code> is false, this command will do nothing. Otherwise, this command proceeds as normal to remove the item or medal.</p> <p>Using syntax (3) directly is however not recommended. It can only work if <code>multiselect</code> was allowed and processed on the last ItemList. If it wasn't, this will throw an exception because there will be no check to determine that there are no parameters. It is best to send parameters in case no multi selection was performed.</p>"},{"location":"SetText/Individual%20commands/Removeitemat/","title":"Removeitemat","text":"<p>Remove an Item by its inventory type and its index in that inventory which may come from ItemList's <code>listoption</code>.</p>"},{"location":"SetText/Individual%20commands/Removeitemat/#syntax","title":"Syntax","text":"<p>(1) (Remove the item at ItemList's <code>listoption</code>)</p> <pre><code>|removeitemat,type|\n</code></pre> <p>(2)</p> <pre><code>|removeitemat,type,index|\n</code></pre>"},{"location":"SetText/Individual%20commands/Removeitemat/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Removeitemat/#type-int","title":"<code>type</code>: int","text":"<p>The inventory type of the Item to remove. This must be a valid inventory type or an exception will be thrown. The valid values are 0 for standard items, 1 for key items and 2 for stored items.</p>"},{"location":"SetText/Individual%20commands/Removeitemat/#index-int-vint-varint-opt","title":"<code>index</code>: int | <code>v</code>int | <code>var</code>int | <code>opt</code>","text":"<p>The index to remove the item at or a flagvar slot containing it. The int form must be a valid index in the <code>type</code> inventory type array or an exception will be thrown. The <code>v</code>/<code>var</code> prefix means the int porition is a flagvar slot containing the index and it must be a valid one or an exception will be thrown. <code>opt</code> is equivalent to syntax (1) which will use ItemList's <code>listoption</code> instead.</p>"},{"location":"SetText/Individual%20commands/Removeitemat/#remarks","title":"Remarks","text":"<p>If the ItemList is in multi selection, this command does nothing.</p> <p>Using syntax (1) implies that an ItemList has been confirmed in single selection and this command is used as handler.</p>"},{"location":"SetText/Individual%20commands/Removemaplimits/","title":"Removemaplimits","text":"<p>Remove the position bound limits of the camera with the option to save the current ones to restore later using resetmaplimits.</p>"},{"location":"SetText/Individual%20commands/Removemaplimits/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|removemaplimits|\n</code></pre> <p>(2)</p> <pre><code>|removemaplimits,savetemp|\n</code></pre>"},{"location":"SetText/Individual%20commands/Removemaplimits/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Removemaplimits/#savetemp-true-false","title":"<code>savetemp</code>: <code>true</code> | <code>false</code>","text":"<p>Whether or not to save the current bound limits before removing them to temporary fields. This must be a valid bool or an exception will be thrown. The default value is <code>false</code>.</p>"},{"location":"SetText/Individual%20commands/Removemaplimits/#remarks","title":"Remarks","text":"<p>If <code>savetemp</code> is true, the current limits are saved to <code>tempcneg</code> and <code>tempcpos</code> for the lower and upper bounds respectively. They can be restored later using resetmaplimits.</p>"},{"location":"SetText/Individual%20commands/Removestat/","title":"Removestat","text":"<p>Remove a stat bonus by its index or a flagvar slot containing it and optionally recalculate the party's stats after the removal.</p>"},{"location":"SetText/Individual%20commands/Removestat/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|removestat,statbonus|\n</code></pre> <p>(2)</p> <pre><code>|removestat,statbonus,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/Removestat/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Removestat/#statbonus-int-varint-vint-money","title":"<code>statbonus</code>: int | <code>var</code>int | <code>v</code>int | <code>money</code>","text":"<p>The stat bonus index to remove from the stat bonuses list or the flagvar slot containing it. The int form be a valid index of the stat bonuses list or an exception will be thrown. The flagvar string form must contain <code>var</code> or <code>v</code> only once with an integer portion corresponding to a valid flagvar slot or an exception will be thrown. The <code>money</code> value is allowed, but is not recommended because it will read the current berry count as a stat bonus index which is most likely not desirable.</p>"},{"location":"SetText/Individual%20commands/Removestat/#true","title":"<code>true</code>","text":"<p>This parameter indicates to operate in syntax (2) which will also recalculate the party's stats after the stat bonus removal has been done. Any other value is ignored and will cause the command to operate in syntax (1).</p>"},{"location":"SetText/Individual%20commands/Removestat/#remarks","title":"Remarks","text":"<p>For more information about how stat bonuses work and how they are saved on the Save File, check Save File &gt; Line 10 (Array line) Stats bonuses.</p> <p>Syntax (2) is recommended over syntax (1) because it allows the removal to take immediate effect while syntax (1) will need to wait the next recalculation to take the removal into effect.</p> <p>This command is only used for testing purposes in the TestRoom.</p>"},{"location":"SetText/Individual%20commands/Rerollshops/","title":"Rerollshops","text":"<p>Refresh all the shops and randomnise their available pool from their stock pool which changes which ones are on display.</p>"},{"location":"SetText/Individual%20commands/Rerollshops/#syntax","title":"Syntax","text":"<pre><code>|rerollshops|\n</code></pre>"},{"location":"SetText/Individual%20commands/Rerollshops/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Rerollshops/#remarks","title":"Remarks","text":"<p>This command does nothing if the caller is null.</p>"},{"location":"SetText/Individual%20commands/Resetcamera/","title":"Resetcamera","text":"<p>Resets the camera to a default state.</p>"},{"location":"SetText/Individual%20commands/Resetcamera/#syntax","title":"Syntax","text":"<pre><code>|resetcamera|\n</code></pre>"},{"location":"SetText/Individual%20commands/Resetcamera/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Resetcamera/#remarks","title":"Remarks","text":"<p>Specifically, this sets the following fields:</p> <ul> <li><code>camspeed</code>: 0.1</li> <li><code>camoffsetspeed</code>: 0.1</li> <li><code>changecamspeed</code>: false</li> <li><code>camanglechange</code>: false</li> <li><code>camoffset2</code>: Vector3.zero</li> <li><code>camanglespeed</code>: 0.1</li> <li><code>camtargetpos</code>: null</li> <li><code>camoffset</code>: The default one (0.0, 2.25, -8.25) or the one defined in the Map</li> <li><code>camangleoffset</code>: The default one (10.0, 0.0, 0.0) or the one defined in the Map</li> <li><code>camtarget</code>: null or the player if it exists.</li> </ul>"},{"location":"SetText/Individual%20commands/Resetmaplimits/","title":"Resetmaplimits","text":"<p>Restore the position bound limits of the camera from their original one when the map was loaded or from the ones saved using removemaplimits if they were saved to the temporary fields.</p>"},{"location":"SetText/Individual%20commands/Resetmaplimits/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|resetmaplimits|\n</code></pre> <p>(2)</p> <pre><code>|resetmaplimits,resetfromtemp|\n</code></pre>"},{"location":"SetText/Individual%20commands/Resetmaplimits/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Resetmaplimits/#savetemp-true-false","title":"<code>savetemp</code>: <code>true</code> | <code>false</code>","text":"<p>Whether or not to restore the bound limits before from the temporary fields. This must be a valid bool or an exception will be thrown. The default value is <code>false</code>.</p>"},{"location":"SetText/Individual%20commands/Resetmaplimits/#remarks","title":"Remarks","text":"<p>If <code>resetfromtemp</code> is true, the limit bounds are restored from <code>tempcneg</code> and <code>tempcpos</code> for the lower and upper bounds respectively which are only saved using removemaplimits. Otherwise, they are restored from the values saved on the last map load.</p>"},{"location":"SetText/Individual%20commands/Resetregion/","title":"Resetregion","text":"<p>Reset all Regionalflags slot to false.</p>"},{"location":"SetText/Individual%20commands/Resetregion/#syntax","title":"Syntax","text":"<pre><code>|resetregion|\n</code></pre>"},{"location":"SetText/Individual%20commands/Resetregion/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Resetregion/#remarks","title":"Remarks","text":"<p>This reset all Regionalflags, even if they aren't used in the current Area.</p>"},{"location":"SetText/Individual%20commands/Save/","title":"Save","text":"<p>Attempts to save the game and continue processing with an output message.</p>"},{"location":"SetText/Individual%20commands/Save/#syntax","title":"Syntax","text":"<pre><code>|save|\n</code></pre>"},{"location":"SetText/Individual%20commands/Save/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Save/#remarks","title":"Remarks","text":"<p>This command does the following:</p> <ul> <li>Disables the ability for the GC and unused resources to be cleared.</li> <li>Yields a frame.</li> <li>Attempts to save using the caller's first vectordata as the starting position saved on the Save File.</li> <li>On Success:<ul> <li>Play the AtkSuccess sound effect at 60% volume.</li> <li>Replaces the input string with an OrganiseLines version of the save success message from MenuText with a |blank| prepended to it and a |stopskip| appended to it.</li> </ul> </li> <li>On failure:<ul> <li>Replaces the input string with an OrganiseLines version of  the save failed message from MenuText with a |blank| prepended to it and a |stopskip| appended to it.</li> </ul> </li> <li>Yields for a frame.</li> <li>Restores the ability for the GC and unused resources to be cleared.</li> </ul> <p>This command will cause SetText to resume processing at the start position to accommodate the text replacement of the input string.</p>"},{"location":"SetText/Individual%20commands/Savecamera/","title":"Savecamera","text":"<p>Saves the current camera's configuration and limits for retrieval later using loadcamera.</p>"},{"location":"SetText/Individual%20commands/Savecamera/#syntax","title":"Syntax","text":"<pre><code>|savecamera|\n</code></pre>"},{"location":"SetText/Individual%20commands/Savecamera/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Savecamera/#remarks","title":"Remarks","text":"<p>Specifically, it saves the following fields using <code>SaveCameraPosition(true)</code>:</p> <ul> <li><code>tempcampos</code> is set to <code>camtargetpos</code></li> <li><code>tempcamoffset</code> is set to <code>camoffset</code></li> <li><code>tempcamspeed</code> is set to <code>camspeed</code></li> <li><code>tempcamangleoffset</code> is set to <code>camangleoffset</code></li> <li><code>tempcamtarget</code> is set to <code>camtarget</code></li> <li><code>tempmaplp</code> is set to <code>map.camlimitpos</code></li> <li><code>tempmapln</code> is set to <code>map.camlimitneg</code></li> </ul> <p>They can be loaded back to their saved value using loadcamera, but it is also possible to do the same by calling <code>SaveCameraPosition(false)</code>.</p>"},{"location":"SetText/Individual%20commands/Scorecheck/","title":"Scorecheck","text":"<p>Render the Termacade's games high scores and yield until Confirm or Cancel is pressed.</p>"},{"location":"SetText/Individual%20commands/Scorecheck/#syntax","title":"Syntax","text":"<pre><code>|scorecheck|\n</code></pre>"},{"location":"SetText/Individual%20commands/Scorecheck/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Scorecheck/#remarks","title":"Remarks","text":"<p>This command will do the following:</p> <ul> <li>Start a fade to black and yield for one second</li> <li>Remove the camera positional limits by settings the bounds from (-999.0, -999.0, -999.0) to (999.0, 999.0, 999.0) and save the existing ones in the temporary fields.</li> <li>Set the camera to move instantaneously to (0.0, 70.0, 0.0).</li> <li>Save the state of the anti aliasing and then force enable it.</li> <li>Set the render texture of the camera with down sampling of 80%.</li> <li>Setup a solid color object named <code>score</code> whose color is 75% between white and black at 0.01 pixels per unit positioned at (0.0, 70.0, 0.0) with the pivot set at the center (0.5, 0.5).</li> <li>Call SetText in non Dialogue mode where the input string is |center||color,4||dropshadow,0.1,-0.1||textangle| followed by menu text 237 (|rainbow|!! HIGH SCORES !!) where the parent is <code>score</code>:<ul> <li>fonttype is <code>D3Streetism</code></li> <li>Rendered using <code>tridimensional</code> at true</li> <li><code>position</code> is (0.0, 4.8, 0.0)</li> <li><code>camoffset</code> is Vector3.one</li> <li><code>size</code> is (2.0, 2.0)</li> <li>No <code>caller</code></li> </ul> </li> <li>Create a new GameObject and child <code>score</code> to it.</li> <li>Start a fade back to the game and yield for one second</li> <li>Render each game score like the following:<ul> <li>Call SetText in non Dialogue mode where the input string is |center||color,4||dropshadow,0.1,-0.1||textangle| followed by |center| followed by menu text 210 for Flower Journey and 211 for Mite Knight (it contains the name of the game) where the parent is <code>score</code>:<ul> <li>fonttype is <code>D3Streetism</code></li> <li>Rendered using <code>tridimensional</code> at true</li> <li><code>position</code> is (-7.0, <code>y</code>, -3.0) where <code>y</code> is 2.0 for Flowey Journey and 0.35 for Mite Knight</li> <li><code>camoffset</code> is Vector3.one</li> <li><code>size</code> is (1.5, 2.0)</li> <li>No <code>caller</code></li> </ul> </li> <li>Yield for 0.5 seconds.</li> <li>Call SetText in non Dialogue mode where the input string is |center||color,4||dropshadow,0.1,-0.1||textangle| followed by |center| followed by the string representation of flagvar 28 for Flower Journey or 29 for Mite Knight padded by 5 to the left with <code>0</code> (each contains the high score of the game) where the parent is <code>score</code>:<ul> <li>fonttype is <code>D3Streetism</code></li> <li>Rendered using <code>tridimensional</code> at true</li> <li><code>position</code> is (4.0, <code>y</code>, -3.0) where <code>y</code> is 2.0 for Flowey Journey and 0.35 for Mite Knight</li> <li><code>camoffset</code> is Vector3.one</li> <li><code>size</code> is (2.0, 2.0)</li> <li>No <code>caller</code></li> </ul> </li> <li>Yield for 0.5 seconds.</li> </ul> </li> <li>Call SetText in non Dialogue mode where the input string is |center||color,4||dropshadow,0.1,-0.1||textangle| followed by menu text 238 (Press |button,4| or |button,5| to exit.) where the parent is the unnamed GameObject created earlier:<ul> <li>fonttype is <code>D3Streetism</code></li> <li>Rendered using <code>tridimensional</code> at true</li> <li><code>position</code> is (0.0, 0.0, -3.0)</li> <li><code>camoffset</code> is Vector3.one</li> <li><code>size</code> is (1.5, 2.0)</li> <li>No <code>caller</code></li> </ul> </li> <li>Yield for 0.5 seconds.</li> <li>While Confirm or Cancel aren't pressed:<ul> <li>Set the position of the unnamed GameObject to (0.0, <code>y</code>, 0.0) where <code>y</code> is -2.0 if Mathf.Sin of Time.time is above 0 or 999.0 otherwise (this makes it oscillate between being visible or not by rendering the object way above the camera).</li> <li>Yield for a frame.</li> </ul> </li> <li>Once the yielding is done, make the bottom prompt disappear by moving it to (0.0, 999.0, 0.0).</li> <li>Start a fade to black and yield for a second.</li> <li>Restore the render texture to not have any down sampling.</li> <li>Restore the camera's anti aliasing state.</li> <li>Destroy <code>score</code>.</li> <li>Restore the camera positional limits using the temporary fields saved earlier.</li> <li>Reset the camera instantly.</li> <li>Yield for a frame.</li> <li>Fade back to the game.</li> <li>Yield for a second.</li> </ul>"},{"location":"SetText/Individual%20commands/Setbreak/","title":"Setbreak","text":"<p>Changes the OrganiseLines's <code>linebreak</code> value with the option to run OrganiseLines again after the change.</p>"},{"location":"SetText/Individual%20commands/Setbreak/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|setbreak,linebreak|\n</code></pre> <p>(2)</p> <pre><code>|setbreak,linebreak,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/Setbreak/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Setbreak/#linebreak-float-null","title":"<code>linebreak</code>: float | <code>null</code>","text":"<p>The maximum width to use by OrganiseLines from now on. The float form must be a valid float or an exception will be thrown. <code>null</code> allows to not have any line breaking occur, but this is incompatible with syntax (2) as it will throw an exception since it still expects the line break value to not be null.</p>"},{"location":"SetText/Individual%20commands/Setbreak/#true","title":"<code>true</code>","text":"<p>The presence of this parameter indicates to operate in syntax (2) which will run OrganiseLines after the new line break value has been set. Any other value is ignored and essentially is equivalent to syntax (1).</p>"},{"location":"SetText/Individual%20commands/Setbreak/#remarks","title":"Remarks","text":"<p>It is preferred to send the desired line break value as a parameter to SetText from the start instead of using this command. While it is used in very specific scenarios in the game, it is redundant because it is simpler to pass the correct value at first.</p>"},{"location":"SetText/Individual%20commands/Setprize/","title":"Setprize","text":"<p>Mark a Caravan prize medal as obtained via its Medal id or the caller's animstate which also removes it from the caravan list. This can also mark any prize medal as obtained via its prize id.</p>"},{"location":"SetText/Individual%20commands/Setprize/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|setprize,find,medal|\n</code></pre> <p>(2)</p> <pre><code>|setprize,this|\n</code></pre> <p>(3) (Unused)</p> <pre><code>|setprize,prizeid|\n</code></pre> <p>(4) (Unused, same as (3))</p> <pre><code>|setprize,var,prizeid|\n</code></pre>"},{"location":"SetText/Individual%20commands/Setprize/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Setprize/#find","title":"<code>find</code>","text":"<p>This parameter indicates to operate in syntax (1) which marks the prize containing the <code>medal</code> as obtained and removed from the caravan list.</p>"},{"location":"SetText/Individual%20commands/Setprize/#medal-int-vint-varint","title":"<code>medal</code>: int | <code>v</code>int | <code>var</code>int","text":"<p>The Medal id or a flagvar slot containing it to mark its corresponding prize as obtained and removed from the Caravan list. The int form must be a valid int or an exception will be thrown. The <code>v</code> and <code>var</code> form both means that the int part is a flagvar slot and it must be a valid one otherwise, an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Setprize/#this","title":"<code>this</code>","text":"<p>This parameter indicates to operate in syntax (2) which marks the caller's Medal as obtained and removed from the Caravan list.</p>"},{"location":"SetText/Individual%20commands/Setprize/#prizeid-int","title":"<code>prizeid</code>: int","text":"<p>The prize id to mark as obtained. This must be a valid prize id or an exception will be thrown. Since the prize arrays are hardcoded and there are 23 that exists in the game, a valid prize id is between 0 and 22.</p>"},{"location":"SetText/Individual%20commands/Setprize/#var","title":"<code>var</code>","text":"<p>This parameter does nothing. Its value is completely ignored and specifying it is the same then omitting it.</p>"},{"location":"SetText/Individual%20commands/Setprize/#remarks","title":"Remarks","text":"<p>This command's purpose is to mark a prize medal bough from the Caravan as obtained. This is not meant to be used with Artis's ones because these are handled in a different way using Events. Syntax (1) is meant as a handler for using the Caravan Prize Medals List Type while syntax (2) is meant to handle buying the medal from the Caravan's counter because by the time this happens, the caller is the medal which knows its own Medal id via its animstate.</p> <p>If the prize medal doesn't exists, isn't available through the Caravan (the flagvar slot of the prize medal is 2) or is already obtained, this command does nothing. If found, this command writes to the flagvar slot bound to the prize medal (the value 3 which means obtained).</p> <p>Syntax (3) and (4) are equivalent and unused in the game, but they allow to unconditionally mark any prize medal as obtained via their prize id.</p>"},{"location":"SetText/Individual%20commands/Setvar/","title":"Setvar","text":"<p>Set a flagvar to a specific value, or increase/decrease a flagvar by a value or another flagvar.</p>"},{"location":"SetText/Individual%20commands/Setvar/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|setvar,flagvar,value|\n</code></pre> <p>(2)</p> <pre><code>|setvar,operation,flagvarslot,value|\n</code></pre> <p>(3)</p> <pre><code>|setvar,operation,flagvarslot,var,flagvarvalue|\n</code></pre>"},{"location":"SetText/Individual%20commands/Setvar/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Setvar/#flagvar-int","title":"<code>flagvar</code>: int","text":"<p>The flagvar slot to set its value. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Setvar/#operation-add-sub","title":"<code>operation</code>: <code>add</code> | <code>sub</code>","text":"<p>The operation to perform between the <code>flagvar</code> slot and the resolved value. <code>add</code> is equivalent to do <code>flagvar</code> = <code>flagvar</code> + value * 1 while <code>sub</code> is equivalent to do <code>flagvar</code> = <code>flagvar</code> + value * -1. Any other value will be interpreted as <code>flagvar</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Setvar/#value-int","title":"<code>value</code>: int","text":"<p>The value used to calculate the new value to set the <code>flagvar</code> slot to. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Setvar/#var","title":"<code>var</code>","text":"<p>The presence of this parameter indicates to operate in syntax (3) which retrieves <code>value</code> using <code>flagvarvalue</code> instead. Any other value will be interpreted as <code>value</code> which may cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Setvar/#flagvarvalue-int","title":"<code>flagvarvalue</code>: int","text":"<p>The flagvar slot used to retrieve the value used to calculate the new value of <code>flagvar</code>. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Setvar/#remarks","title":"Remarks","text":"<p>Syntax (2) and (3) are a less flexible version of addvar. While the functionalities are equivalent, addvar provides multiplication and integer division as well as the ability for the value to be the current berries amount.</p>"},{"location":"SetText/Individual%20commands/Shakecamera/","title":"Shakecamera","text":"<p>Shakes the camera's position by a configurable amount, time and whether or not to return to the initial position.</p>"},{"location":"SetText/Individual%20commands/Shakecamera/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|shakecamera,amount,time|\n</code></pre> <p>(2)</p> <pre><code>|shakecamera,amount,time,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/Shakecamera/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Shakecamera/#amount-float","title":"<code>amount</code>: float","text":"<p>The amount of maximum units to displace the camera horizontally and half the maximum amount vertically. This must be a valid float or an exception will be thrown. This essentially allows to move the camera from (-amount, -(amount / 2)) to (amount, amount / 2). every FixedUpdate.</p>"},{"location":"SetText/Individual%20commands/Shakecamera/#time-float","title":"<code>time</code>: float","text":"<p>The amount of time in seconds before stopping the shaking. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Shakecamera/#true","title":"<code>true</code>","text":"<p>The presence of this parameter indicates to not reset the camera's position to its initial one after the shake. Any other value or its absence indicates to reset the position after the shake.</p>"},{"location":"SetText/Individual%20commands/Shaky/","title":"Shaky","text":"<p>Toggles the shaky FontEffects that will be effective from this point in Regular Letter Rendering.</p>"},{"location":"SetText/Individual%20commands/Shaky/#syntax","title":"Syntax","text":"<pre><code>|shaky|\n</code></pre>"},{"location":"SetText/Individual%20commands/Shaky/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Shaky/#remarks","title":"Remarks","text":"<p>This turns the shaky FontEffects from false to true or from true to false depending on its existing state. The state change will affect every letter from the point this command is being processed.</p> <p>This command overrides wavy, if it is issued while wavy is active, it will remain active, but the effect will not render, only shaky.</p> <p>This command does nothing in Single Letter Rendering.</p> <p>This command is accumulated for the Backtracking system.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Shopline/","title":"Shopline","text":"<p>An alias of line that is only processed by SetText when unpaused and the player has control or an ItemList is getting processed.</p>"},{"location":"SetText/Individual%20commands/Shopline/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|shopline|\n</code></pre> <p>(2)</p> <pre><code>|shopline,linespacing|\n</code></pre>"},{"location":"SetText/Individual%20commands/Shopline/#parameters","title":"Parameters","text":"<p>The same as line. Check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Shopline/#remarks","title":"Remarks","text":"<p>Just like line, this commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it. However, this is only applicable if ItemList State Machine's <code>inlist</code> is true (see inlist issue) or if the player is interacting with an entity with an interaction of type Shop. If neither of these are true, this won't be treated as a line break.</p> <p>This command was presumably done as a workaround to the OrganiseLines Known Issues &gt; Not counting a whole word's width after the first line problem.</p>"},{"location":"SetText/Individual%20commands/Shoppool/","title":"Shoppool","text":"<p>Add a medal to a medal shop's pool by Medal id or one coming from a flagvar, remove all medals from a specific shop's pool using a store id or one coming from a flagvar or remove all medals from all shop pools.</p>"},{"location":"SetText/Individual%20commands/Shoppool/#syntax","title":"Syntax","text":"<p>(1) (Removes all medals from all medal shops's pools)</p> <pre><code>|shoppool,reset|\n</code></pre> <p>(2)</p> <pre><code>|shoppool,reset,storeid|\n</code></pre> <p>(3)</p> <pre><code>|shoppool,storeid,medalid|\n</code></pre>"},{"location":"SetText/Individual%20commands/Shoppool/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Shoppool/#reset","title":"<code>reset</code>","text":"<p>This parameters indicates to use syntax (1) or (2). Any other value will be interpreted as using syntax (3).</p>"},{"location":"SetText/Individual%20commands/Shoppool/#storeid-int-varint","title":"<code>storeid</code>: int | <code>var</code>int","text":"<p>The medal shop store id or a flagvar containing it to add a Medal to or to remove all Medal. The resolved value must be a valid medal shop id (0 for Merab's, 1 for Shades's) or an exception will be thrown. The string form must contain <code>var</code> and have an int portion be a valid flagvar or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Shoppool/#medalid-int-varint","title":"<code>medalid</code>: int | <code>var</code>int","text":"<p>The Medal is to add to the shop pool or a flagvar containing it. The resolved value must be a valid Medal id or an exception will be thrown. The string form must contain <code>var</code> and have an int portion be a valid flagvar or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Shoppool/#remarks","title":"Remarks","text":"<p>This manages the shop pools which is saved at line 5 on the Save File, it does not deal with the available pools (which is line 4 on the Save File). This means that it will not immediately cause changes to the displayed Medals until the available pool is updated. Removing a Medal from a medal shop from both lists after purchasing it can be done with removebadgeshop.</p> <p>This command is only used for testing purposes in the TestRoom.</p>"},{"location":"SetText/Individual%20commands/Shoppool/#a-different-way-to-add-a-medal-to-both-the-shop-pool-and-the-available-shop-pool","title":"A different way to add a medal to both the shop pool and the available shop pool","text":"<p>Interestingly, this command accidentally allows a use case where it is possible to add a Medal to a shop pool, but also have the available pool take into account this change. It is done by processing this command in syntax (3) and later on, process a rerollshops which will have the secondary effect of regenerating the available pool using the updated shop pool. This allows to add a Medal to shop and have it immediately available using SetText. Alternatively, it is possible to simply change area which will automatically do the same task.</p> <p>This was not intended to be possible because this command was only meant as a testing command, not something used in game and rerollshops wasn't implemented in the 1.0.0 release of the game, but was added later as a way to shuffle the existing pools that would already have been updated. The game never intended to use SetText to add a Medal to a shop because it uses events to do so.</p>"},{"location":"SetText/Individual%20commands/Showmoney/","title":"Showmoney","text":"<p>Show the currency count HUD element.</p>"},{"location":"SetText/Individual%20commands/Showmoney/#syntax","title":"Syntax","text":"<pre><code>|showmoney|\n</code></pre>"},{"location":"SetText/Individual%20commands/Showmoney/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Showmoney/#remarks","title":"Remarks","text":"<p>Specifically, it sets the timer to show it for 10 frames, but this timer only decreases in non Dialogue mode while as in Dialogue mode, the timer does not decrease. This is based on the message lock being in effect.</p>"},{"location":"SetText/Individual%20commands/Showtokens/","title":"Showtokens","text":"<p>Create or destroy a Game Tokens counter HUD element.</p>"},{"location":"SetText/Individual%20commands/Showtokens/#syntax","title":"Syntax","text":"<p>(1) (Destroy the existing HUD element if any before creating it)</p> <pre><code>|showtokens|\n</code></pre> <p>(1) (To destroy the HUD element if it exists)</p> <pre><code>|showtokens,null|\n</code></pre>"},{"location":"SetText/Individual%20commands/Showtokens/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Showtokens/#null","title":"<code>null</code>","text":"<p>This parameter indicates to operate in syntax (2) which will destroy the HUD element if it exists (this command does nothing if it doesn't exist). Any other value will cause this command to do nothing.</p>"},{"location":"SetText/Individual%20commands/Showtokens/#remarks","title":"Remarks","text":"<p>Unlike showmoney, this doesn't just show or hide the counter, it creates or destroy it inside the command.</p> <p>The HUD element is creating with a new UI object named <code>TokenBar</code> parented to the GUICamera with size (0.55, 0.6, 1.0) using the gui sprite 4, a sort order of 0 and a color of E57F00 (mostly orange). Its position depends on if the berries counter HUD element is shown or not. If it's hidden, the position is (15.0, -4.25, 10.0) and if it's shown, it's (15.0, -3.0, 10.0).</p> <p>The counter is rendered using a SetText call where the object created earlier is the parent in non Dialogue mode with the input string being |sort,10||color,4||dropshadow,0.1,-0.1|\" appended with the value of flagvar 27 padded with to 4 characters with 0s:</p> <ul> <li>fonttype: UNUSED ???</li> <li>No <code>linebreak</code></li> <li>No <code>tridimensional</code></li> <li><code>position</code> of (-0.75, -0.4, 0.0)</li> <li>No <code>camoffset</code></li> <li><code>size</code> of (1.75, 1.75)</li> <li>No <code>caller</code></li> </ul> <p>For the icons, it is a new UI object named <code>icon</code> parented to the HUD element created earlier with a position of (-2.25, 0.1, 0.0), a size of (2.0, 2.0, 2.0) using the Game Tokens Item sprite with a sort order of 1.</p> <p>Finally, a DialogueAnim is added to <code>TokenBar</code> with a targetpos of (7.0, <code>y</code>, 10.0) where <code>y</code> is where the the <code>TokenBar</code>'s y position, a targetscale of (0.55, 0.6, 1.0) and a speed of 0.4.</p>"},{"location":"SetText/Individual%20commands/Single/","title":"Single","text":"<p>Toggle or set whether to render in Single Letter Rendering</p>"},{"location":"SetText/Individual%20commands/Single/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|single|\n</code></pre> <p>(2)</p> <pre><code>|single,enable|\n</code></pre>"},{"location":"SetText/Individual%20commands/Single/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Single/#enable-true-false","title":"<code>enable</code>:  <code>true</code> | <code>false</code>","text":"<p>Whether to enable Single Letter Rendering or to disable it. This must be equal to <code>true</code> or <code>false</code> without case sensitivity or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Single/#remarks","title":"Remarks","text":"<p>(1) Toggles Single Letter Rendering from false to true or true to false depending on its existing state. (2) Enables Single Letter Rendering if <code>enable</code> is true, disable it if it is <code>false</code>.</p> <p>Single Letter Rendering is a different text rendering method in SetText that involves rendering every line into their own letter slot rather than having one slot per letter. This is done to save a significant amount of letter slots. Visually, it mainly affects <code></code>'s gaps as they are no longer actual gap, but rather a <code></code> that gets amended to the Text property of the TextMesh used to render the line. While the kerning is managed by Unity in this rendering method, the kerning looks very similar than in normal rendering.</p>"},{"location":"SetText/Individual%20commands/Single/#about-line-offset-calculation","title":"About line offset calculation","text":"<p>There is an issue where the offset to render in the current line is miscalculated compared to normal SetText rendering (it is much lower than it should be). This doesn't affect letter rendering since all the line is set in the <code>Text</code> property of the TextMesh, but it does affect other commands that needs this offset to be calculated properly. For example, many commands which renders sprites will not render the sprite at the correct position and the text will not get adequate spacing for the sprite to show correctly. This means this command should not be used when sprite rendering is performed later in the input string.</p>"},{"location":"SetText/Individual%20commands/Single/#about-fonteffects","title":"About FontEffects","text":"<p>Since the FontEffects component was only designed to work on one letter per mesh, they do not work in Single Letter Rendering.</p>"},{"location":"SetText/Individual%20commands/Singlebreak/","title":"Singlebreak","text":"<p>Instruct OrganiseLines to use the specialized line breaks handling for Single Letter Rendering</p>"},{"location":"SetText/Individual%20commands/Singlebreak/#syntax","title":"Syntax","text":"<pre><code>|singlebreak,maxoffset|\n</code></pre>"},{"location":"SetText/Individual%20commands/Singlebreak/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Singlebreak/#maxoffset-float","title":"<code>maxoffset</code>: float","text":"<p>The max offset a line can grow until inserting a line break. The value must a valid float value or an Exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Singlebreak/#remarks","title":"Remarks","text":"<p>Overwrite the input string with OrganiseLines starting with a maximum line width of 99999. The maximum line width gets overridden from the point where this command is located until the end of the input string by <code>maxoffset</code>. </p> <p>This also changes the way OrganiseLines works by changing the final line breaks scheme and by changing how letter widths are accumulated (0.975x of each letter's width is accumulated instead of their full width). Normally, OrganiseLines inserts LF for every new lines, but because this scheme isn't supported in Single Letter Rendering, this wouldn't work. This command aims to fix this by changing the LF to line command without parameters which works in Single Letter Rendering.</p> <p>This command only works in Single Letter Rendering which can be enabled via the single command. No operation occurs if it is not enabled, however, if OrganiseLines is ran on the input string through any ways, it will still change its logic because it is processed there no matter the rendering method. This means that this command can change the line breaker logic without necessarily using Single Letter Rendering.</p>"},{"location":"SetText/Individual%20commands/Sizemulti/","title":"Sizemulti","text":"<p>An alias of size in syntax (2).</p>"},{"location":"SetText/Individual%20commands/Sizemulti/#syntax","title":"Syntax","text":"<pre><code>|sizemulti,sizex,sizey|\n</code></pre>"},{"location":"SetText/Individual%20commands/Sizemulti/#parameters","title":"Parameters","text":"<p>The same as size in syntax (2), check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Sizemulti/#remarks","title":"Remarks","text":"<p>Just like size, this command affects OrganiseLines by changing the horizontal size scaling used to predict the amount of space further letters will take. This is done ignoring the size's locking system so even if the command isn't going to change the size once processed, it will still be taken as a width change for the auto line breaker which can cause problems.</p>"},{"location":"SetText/Individual%20commands/Sort/","title":"Sort","text":"<p>Changes the sorting order of every letter rendered from now on.</p>"},{"location":"SetText/Individual%20commands/Sort/#syntax","title":"Syntax","text":"<pre><code>|sort,sortingorder|\n</code></pre>"},{"location":"SetText/Individual%20commands/Sort/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Sort/#sortingorder-int","title":"<code>sortingorder</code>:  int","text":"<p>The sortingorder value to use. This value must be a valid int value or an exception will be thrown. Only values between -32768 and 32767 are accepted by Unity. Any value outside this range is undefined behavior.</p>"},{"location":"SetText/Individual%20commands/Sort/#remarks","title":"Remarks","text":"<p>In Single Letter Rendering, this affects the whole line at once including letters rendered before this command on that line.</p>"},{"location":"SetText/Individual%20commands/Sound/","title":"Sound","text":"<p>Play a sound effect music from its file path with a configurable pitch and volume with the option to loop it at the first free AudioSource or a specific one by its id.</p>"},{"location":"SetText/Individual%20commands/Sound/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|sound,soundname|\n</code></pre> <p>(2)</p> <pre><code>|sound,soundname,audiosourceid|\n</code></pre> <p>(3)</p> <pre><code>|sound,soundname,audiosourceid,pitch|\n</code></pre> <p>(4)</p> <pre><code>|sound,soundname,audiosourceid,pitch,volume|\n</code></pre> <p>(5)</p> <pre><code>|sound,soundname,audiosourceid,pitch,volume,loop|\n</code></pre>"},{"location":"SetText/Individual%20commands/Sound/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Sound/#soundname-string","title":"<code>soundname</code>: string","text":"<p>The file path of the sound effect file without extensions to play relative from the <code>audio/sounds</code> resources directory. This must be a valid sound file path or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Sound/#audiosourceid-int","title":"<code>audiosourceid</code>: int","text":"<p>The audio source id used to play the sound effect out of the 15 available normally. This must be an int between -1 and 14 or an exception will be thrown. The default value is -1 which will pick the first one that isn't playing or the last one if all of them are playing.</p>"},{"location":"SetText/Individual%20commands/Sound/#pitch-float","title":"<code>pitch</code>: float","text":"<p>The pitch to play the sound effect. This must be a valid float or an exception will be thrown. The default value is 1.0 which is the normal pitch.</p>"},{"location":"SetText/Individual%20commands/Sound/#volume-float","title":"<code>volume</code>: float","text":"<p>The volume to play the sound effect. This must be a valid float or an exception will be thrown. The default value is 1.0 which is the normal volume.</p>"},{"location":"SetText/Individual%20commands/Sound/#loop-true-false","title":"<code>loop</code>: <code>true</code> | <code>false</code>","text":"<p>Whether or not to loop the sound effect. This must be a valid bool or an exception will be thrown. The default value is <code>false</code>.</p>"},{"location":"SetText/Individual%20commands/Sound/#remarks","title":"Remarks","text":"<p>It is possible for this command to be used in non Dialogue mode which means it is possible to play bleeps sound using this command instead of letting SetText handle it with bleep which requires Dialogue mode as it only uses a single AudioSource while this command can interact with 15 of them.</p>"},{"location":"SetText/Individual%20commands/Spd/","title":"Spd","text":"<p>Set the wait time in seconds between letters.</p>"},{"location":"SetText/Individual%20commands/Spd/#syntax","title":"Syntax","text":"<pre><code>|spd,interval|\n</code></pre>"},{"location":"SetText/Individual%20commands/Spd/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Spd/#interval-float","title":"<code>interval</code>:  float","text":"<p>The time in seconds to wait between letters. This value must be a valid float or an exception will be thrown. If -1.0 is specified, the value defaults to 0.02.</p>"},{"location":"SetText/Individual%20commands/Spd/#remarks","title":"Remarks","text":"<p>This is an alias of speed.</p> <p>By default, the wait time between letters is 0.02 seconds or 0.03 in <code>Japanese</code>. This command allows to change this. If a wait time of 0.0 is specified, it disables it entirely.</p> <p>While this command works in Dialogue mode or not, in non dialogue mode, an |spd,0| command is prepended to the input string. This means that the default speed in non dialogue mode is effectively 0.0. It is still possible to override it with this command inside the input string itself.</p>"},{"location":"SetText/Individual%20commands/Speed/","title":"Speed","text":"<p>An alias of spd.</p>"},{"location":"SetText/Individual%20commands/Speed/#syntax","title":"Syntax","text":"<pre><code>|speed,interval|\n</code></pre> <p>See the spd page for the parameters and logic details.</p>"},{"location":"SetText/Individual%20commands/Sstring/","title":"Sstring","text":"<p>Alias to string if processed by SetText directly, but it can also be processed before on OrganiseLines by replacing the text of this command to a flagstring. For the char loop processing, refer to the string command documentation.</p>"},{"location":"SetText/Individual%20commands/Sstring/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|sstring,flagstring|\n</code></pre> <p>(2)</p> <pre><code>|sstring,flagstring,clamp,maxwidth|\n</code></pre> <p>(3)</p> <pre><code>|sstring,flagstring,clamp,maxwidth,widthscaleclamp|\n</code></pre> <p>(3)</p> <pre><code>|sstring,flagstring,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/Sstring/#parameters","title":"Parameters","text":"<p>The same as string.</p>"},{"location":"SetText/Individual%20commands/Sstring/#remarks","title":"Remarks","text":"<p>This command can get processed by OrganiseLines's ReplaceFunctions's own char loop if it is called at least once with the input string before the char loop reaches this command. This only supports syntax (1) however and any other syntax will be processed as if it was syntax (1). The other syntaxes are only supported if SetText processes the command before OrganiseLines.</p> <p>This command is unused under normal gameplay, but it remains functional.</p>"},{"location":"SetText/Individual%20commands/Stars/","title":"Stars","text":"<p>Renders a specific amount of white stars sprites in a row.</p>"},{"location":"SetText/Individual%20commands/Stars/#syntax","title":"Syntax","text":"<pre><code>|stars,amount|\n</code></pre>"},{"location":"SetText/Individual%20commands/Stars/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Stars/#amount-int","title":"<code>amount</code>: int","text":"<p>The amount of white stars sprites to render. This must be a valid int or an exception will be thrown. Anything 0 or below will have this command do nothing.</p>"},{"location":"SetText/Individual%20commands/Stars/#remarks","title":"Remarks","text":"<p>The sprite is the id 100 from the gui's sprite sheet. Each sprite is childed to the textholder and rendered with the following properties:</p> <ul> <li>localScale: (0.5, 0.5, 0.5) or (0.5, 0.25, 0.5) when in a battle</li> <li>No angles</li> <li>White color</li> <li>layer: 5</li> <li>sortingOrder: sort + an offset from 0 to <code>amount</code> - 1 depending on which one is rendered from the series (this makes them render on to of their left neighbor)</li> <li>localPosition: (offset, line, 1.0) where offset and line are the current offset and line position.</li> </ul> <p>This command will increase the current offset by the horizontal sprite's extent - 0.15 for each one rendered.</p> <p>It should be noted that this command does not work correctly under Single Letter Rendering because the offset calculations are off which means the stars may not render on the screen or it may render at the incorrect position.</p>"},{"location":"SetText/Individual%20commands/Stopskip/","title":"Stopskip","text":"<p>Forces a stop on the text skip if one was in progress in Dialogue mode.</p>"},{"location":"SetText/Individual%20commands/Stopskip/#syntax","title":"Syntax","text":"<pre><code>|stopskip|\n</code></pre>"},{"location":"SetText/Individual%20commands/Stopskip/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Stopskip/#remarks","title":"Remarks","text":"<p>This command sets <code>skiptext</code> to false and <code>isholdingskip</code> to the current state of fadeletter. For more information on how text skip works, see Text advance.</p> <p>This command does nothing in non Dialogue mode.</p>"},{"location":"SetText/Individual%20commands/String/","title":"String","text":"<p>Replaces the text from this command to a flagstring text with horizontal size clamping support.</p>"},{"location":"SetText/Individual%20commands/String/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|string,flagstring|\n</code></pre> <p>(2)</p> <pre><code>|string,flagstring,clamp,maxwidth|\n</code></pre> <p>(3)</p> <pre><code>|string,flagstring,clamp,maxwidth,widthscaleclamp|\n</code></pre> <p>(4)</p> <pre><code>|string,flagstring,true|\n</code></pre>"},{"location":"SetText/Individual%20commands/String/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/String/#flagstring-int","title":"<code>flagstring</code>:  int","text":"<p>The flagstring slot to replace this command with. This must be a valid flagstring slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/String/#postprocessing-clamp-true","title":"<code>postprocessing</code>: <code>clamp</code> | <code>true</code>","text":"<p>Specify the optional post processing step to perform after obtaining the flagstring text (this is case sensitive):</p> <ul> <li><code>clamp</code>: Before replacing the text of this command, Clamps the horizontal size of the flagstring text if it is wider than <code>maxwidth</code> .</li> <li><code>true</code>: After the text replacement, reorganize the lines of the input string via OrganiseLines just like in the SetText Setup</li> </ul> <p>Any other value of this parameter will be ignored and the behavior will be like (1). If the value is <code>clamp</code>, but no <code>maxwidth</code> is specified, an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/String/#maxwidth-float","title":"<code>maxwidth</code>: float","text":"<p>When <code>postprocessing</code> is <code>clamp</code>, specify the maximum length allowed for the flagstring text to take horizontally. The value must a valid float or an Exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/String/#widthscaleclamp-float","title":"<code>widthscaleclamp</code>: float","text":"<p>When <code>postprocessing</code> is <code>clamp</code>, specify the horizontal scale to apply to the flagstring text if its width exceeds <code>maxwidth</code>. If this value is not specified, the default is 0.5. The value must a valid float or an Exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/String/#remarks","title":"Remarks","text":"<p>The flagstring is expected to be set in code beforehand and its line endings will be normalized to LF if any CRLF is in the flagstring text.</p> <p>If <code>postprocessing</code> is <code>clamp</code> and a clamping occurs, the flagstring text will be prepended with |sizemulti,<code>widthscaleclamp</code>,1| and appended with |size,size.x,size.y| where size is the parameter sent to SetText. This resizes the text using <code>widhscaleclamp</code>, but turns the size value back to its normal one.</p> <p>This command will cause SetText to resume processing at the same character position to accommodate the text replacement.</p>"},{"location":"SetText/Individual%20commands/Switch/","title":"Switch","text":"<p>Toggle or set the hit field of an Entity's NPCControl (this is meant to toggle or set the state of an Entity of type switch).</p>"},{"location":"SetText/Individual%20commands/Switch/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|switch,entity|\n</code></pre> <p>(2)</p> <pre><code>|switch,entity,value|\n</code></pre>"},{"location":"SetText/Individual%20commands/Switch/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Switch/#entity-int","title":"<code>entity</code>: int","text":"<p>The Entity id to toggle or set its npc's hit field. This must be a valid Entity id resolving to a non null value or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Switch/#value-true-false","title":"<code>value</code>: <code>true</code> | <code>false</code>","text":"<p>The value to set the hit field of the <code>entity</code>'s npc. This must be a valid bool or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Switch/#remarks","title":"Remarks","text":"<p>This command was specifically made to allow the Gen &amp; Eri switch puzzle to work inside the Honey Factory.</p>"},{"location":"SetText/Individual%20commands/Tab/","title":"Tab","text":"<p>Set the tabsize of the current letter slot in Single Letter Rendering</p>"},{"location":"SetText/Individual%20commands/Tab/#syntax","title":"Syntax","text":"<pre><code>|tab,tabsize|\n</code></pre>"},{"location":"SetText/Individual%20commands/Tab/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Tab/#tabsize-int","title":"<code>tabsize</code>: int","text":"<p>The amount of spaces a <code>\\t</code> character corresponds to. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Tab/#remarks","title":"Remarks","text":"<p>This command while functional doesn't do anything practical in Regular Letter Rendering because it only affects the letter slot used in Single Letter Rendering.</p>"},{"location":"SetText/Individual%20commands/Tail/","title":"Tail","text":"<p>Set the tailtarget to an Entity and optionally change the animation state of the new target Entity  with a hide/unhide of the textbox in Dialogue mode.</p>"},{"location":"SetText/Individual%20commands/Tail/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|tail,entity|\n</code></pre> <p>(2)</p> <pre><code>|tail,entity,transition|\n</code></pre>"},{"location":"SetText/Individual%20commands/Tail/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Tail/#entity-caller-parent-null-this-int","title":"<code>entity</code>: <code>caller</code> | <code>parent</code> | <code>null</code> | <code>this</code> | int","text":"<p>The Entity to set the tailtarget to (the predefined values are case sensitive):</p> <ul> <li><code>this</code>: Refers to tailtarget's entity (This only reliably works in Dialogue mode otherwise, it will take the last value of tailtarget which is potentially undefined behavior) Since it is setting the tailtarget to its current entity, this effectively doesn't change it.</li> <li><code>caller</code>: Refers to the caller if it is not null. If it is, the value is interpreted as an int which will cause an exception to be thrown.</li> <li><code>parent</code>:  Refers to the parent If it is, the value is interpreted as an int which will cause an exception to be thrown.</li> <li><code>null</code>:  Refers to the null value. This makes the textbox not point to anyone. Usage of this value mandates that <code>transition</code> is <code>instant</code> or not specified due to an incompatibility with the anim command that will cause an exception to be thrown. See the <code>transition</code> parameter section for more details.</li> <li>int: Refers to any other Entity id.</li> </ul> <p>Any non int value that isn't in one of the predefined values above be interpreted as an int which will cause an exception to be thrown.</p>"},{"location":"SetText/Individual%20commands/Tail/#transition-instant-string-int","title":"<code>transition</code>: <code>instant</code> | string | int","text":"<p>The transition method to use when changing the tailtarget. <code>instant</code> (case sensitive) will prevent the textbox to hide/unhide itself after 0.035 seconds and the command will not have the entity change its animation state via an anim command. If this value is not specified, the same behavior happens, but without the animation state change.</p> <p>Any other value will cause a relay to an anim command in the form |anim,<code>entity</code>,<code>transition</code>| at the end of this command's processing. This means that any other value of this parameter must adhere to the specification of the <code>anim</code> parameter of the anim command which implies <code>null</code> is not a valid value for <code>entity</code> if the relay happens. This means that to specify <code>null</code> as the <code>entity</code> parameter, this parameter needs to either be <code>instant</code> or not specified.</p>"},{"location":"SetText/Individual%20commands/Tail/#remarks","title":"Remarks","text":"<p>This command will perform the following operations:</p> <ul> <li>Resets the state of the Backtracking system effectively clearing the history, current accumulator and set the current dialogue to the start. </li> <li>Sets the existing tailtarget's Entity to stop talking.</li> <li>Obtains the new entity of the tailtarget is obtained, but it will only be set immediately if <code>entity</code> is null or <code>transition</code> is <code>instant</code>. Otherwise, it will first set the textbox to hide itself and yield for 0.035 seconds. Only after this yield is completed will the tailtarget change entity. An exception to this rule is if the tailtarget's entity is the same than the one to set it to in which case, the yield and hiding of the textbox are skipped.</li> <li>Yields a frame.</li> <li>Change the bleep sound and pitch according to the new tailtarget's entity (the sound is set to null if the new entity is null).</li> <li>Yields a frame.</li> <li>If <code>transition</code> isn't <code>instant</code>, set the textbox to unhide itself. </li> <li>If <code>transition</code> was specified with a value other than <code>instant</code>, relay processing to an anim command with the same parameters as this command. If <code>transition</code> is <code>instant</code>, this will not be done which ends this command's processing.</li> </ul> <p>It is technically possible to use this command in non Dialogue mode as long as <code>transition</code> isn't <code>instant</code> (otherwise, an exception will be thrown). However, doing this can cause undefined behaviors as this command was primarily made to operate in Dialogue mode.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Tailextra/","title":"Tailextra","text":"<p>An alias of tail where the int form of <code>entity</code> refers to a temporary follower index instead of an Entity id (which is redundant, see remarks why).</p>"},{"location":"SetText/Individual%20commands/Tailextra/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|tailextra,entity|\n</code></pre> <p>(2)</p> <pre><code>|tailextra,entity,transition|\n</code></pre>"},{"location":"SetText/Individual%20commands/Tailextra/#parameters","title":"Parameters","text":"<p>Refer to the tail documentation, but the only changes are for the <code>entity</code> parameter if the current map isn't null (otherwise, this command exactly like tail):</p> <ul> <li>The int form refers to a temporary follower index and it must be a valid one or an exception will be thrown.</li> <li><code>this</code> is not a valid value and it will throw an exception if specified anyway.</li> </ul> <p>Any other value for this parameter functions the exact same way than tail.</p>"},{"location":"SetText/Individual%20commands/Tailextra/#remarks","title":"Remarks","text":"<p>This command should be redundant because tail takes an Entity id which supports temporary followers. There are only 2 possible reasons one would use this command over tail:</p> <ul> <li>There is no null check performed on the map before accessing the temporary followers array for an Entity id meaning it will throw instead of interpreting the value as a regular Entity id like this command does (which is potentially not desired so this difference may not matter anyway)</li> <li>This allows to have more than 1000 Entity id being specified on the map without the followers because it is now possible to index the desired follower independently. While this is a possible usecase, it should be noted that most commands uses Entity id as a standard meaning should this ever happen, it is likely some other command will behave incorrectly making this usecase not as relevant.</li> </ul> <p>Due to this redundancy and the simplicity of just using tail, usage of this command isn't recommended: use tail instead.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/Takeopenquests/","title":"Takeopenquests","text":"<p>Move all BoardQuests in the open board to the taken board with the exception of the 5 bounty ones.</p>"},{"location":"SetText/Individual%20commands/Takeopenquests/#syntax","title":"Syntax","text":"<pre><code>|takeopenquests|\n</code></pre>"},{"location":"SetText/Individual%20commands/Takeopenquests/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Takeopenquests/#remarks","title":"Remarks","text":"<p>This will not interact with the Bounty BoardQuests even if any is in the open board.</p> <p>This command also handles placing and removing the <code>NoQuest</code> element from the open or taken board whenever applicable as well as enable each BoardQuests's taken flagvar slot.</p>"},{"location":"SetText/Individual%20commands/Teleportparty/","title":"Teleportparty","text":"<p>Teleports the party's entities near the player's Entity which optionally includes any temporary non party follower or teleport just the party entities at a specified distance and direction from the player's Entity.</p>"},{"location":"SetText/Individual%20commands/Teleportparty/#syntax","title":"Syntax","text":"<p>(1) (Teleports only the party followers near the player's entity)</p> <pre><code>|teleportparty|\n</code></pre> <p>(2)</p> <pre><code>|teleportparty,includetemp|\n</code></pre> <p>(3)</p> <pre><code>|teleportparty,distance,direction|\n</code></pre>"},{"location":"SetText/Individual%20commands/Teleportparty/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Teleportparty/#includetemp-true-false","title":"<code>includetemp</code>: <code>true</code> : <code>false</code>","text":"<p>Whether to include any non party temporary followers to teleport near the player. This must be a valid bool or an exception will be thrown. Specifying <code>false</code> is equivalent to syntax (1) and is thus the default value.</p>"},{"location":"SetText/Individual%20commands/Teleportparty/#distance-float","title":"<code>distance</code>: float","text":"<p>The distance to teleport the party entities from the player. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Teleportparty/#direction-int-string","title":"<code>direction</code>: int | <code>string</code>","text":"<p>The direction to teleport the party entities from the player. Here are the different values possible in int and string form (the string form is case insensitive):</p> int string 0 Right 1 Left 2 Up 3 Down 4 Away 5 Center"},{"location":"SetText/Individual%20commands/Teleportparty/#remarks","title":"Remarks","text":"<p>For syntax (1) and (2), the party entities are teleported so they match the position of the player with removal of velocity, but each party Entity is offset forward to the camera by 0.025 from each other and the player. This is done to combat possible Z fighting.</p> <p>For syntax (2), it does the same than (1), but it also teleports the temporary non party followers at the player's position. Unlike the party teleport, there is no Z fighting mitigation here. </p> <p>For either (1) and (2), Chompy if she exists gets teleported 0.3 in front of the player after a frame.</p> <p>Syntax (3) operates using a different override of TeleportFollowers which accepts the <code>distance</code> and <code>direction</code> parameters. This only applies to the party entities and it will not teleport the temporary non party followers. The teleport happens only if the current distance between the entity is more than <code>distance</code> and it is done relative to the entity's following target (which prevents Z fighting). The teleport for the party entities includes removing any velocity.</p> <p>Here are the different directions's logic in determining the position:</p> Direction Description Right Teleports to the right of the entity's following Left Teleports to the left of the entity's following Up Teleports behind the entity's following Down Teleports in front of the entity's following Away Teleports away from the caller with 0.1 forward to the camera relative to the entity's following Center Teleports each at the entity's following with an offset of 0.1 forward of the camera between each other and the entity's following <p>This will also teleports Chompy if she exists 0.1 forward to the camera if she is further away from the player than <code>distance</code>.</p>"},{"location":"SetText/Individual%20commands/Termacadecheck/","title":"Termacadecheck","text":"<p>A goto helper where the Dialogue line id can be one of 2 values depending if both high scores at the Termacade games were beaten or not from their default one.</p>"},{"location":"SetText/Individual%20commands/Termacadecheck/#syntax","title":"Syntax","text":"<pre><code>|termacadecheck,notbeatenline,beatenline|\n</code></pre>"},{"location":"SetText/Individual%20commands/Termacadecheck/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Termacadecheck/#notbeatenline-int","title":"<code>notbeatenline</code>: int","text":"<p>The Dialogue line id to send to goto if any of the high scores are not higher than their default one. This must be a valid Dialogue line id or an exception will be thrown if goto is processed with it.</p>"},{"location":"SetText/Individual%20commands/Termacadecheck/#beatenline-int","title":"<code>beatenline</code>: int","text":"<p>The Dialogue line id to send to goto if both high scores are higher than their default one. This must be a valid Dialogue line id or an exception will be thrown if goto is processed with it.</p>"},{"location":"SetText/Individual%20commands/Termacadecheck/#remarks","title":"Remarks","text":"<p>The goto command is immediately processed with the resolved line in syntax (1) depending on flagvar 28 (Mite Knight's high score) being strictly higher than 9500 or not and flagvar 29 (Flower Journey's high score) being strictly higher than 4500 or not.</p>"},{"location":"SetText/Individual%20commands/Testdiag/","title":"Testdiag","text":"<p>Enables the dialogue test mode until the end of SetText processing.</p>"},{"location":"SetText/Individual%20commands/Testdiag/#syntax","title":"Syntax","text":"<pre><code>|testdiag|\n</code></pre>"},{"location":"SetText/Individual%20commands/Testdiag/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Testdiag/#remarks","title":"Remarks","text":"<p>The dialogue test mode will restrict what commands will be processed from this point and will ignore any commands when in non dialogue mode. In dialogue mode, command processing is restricted to the following commands:</p> <ul> <li>next</li> <li>blank</li> <li>speed</li> <li>icon</li> <li>menu</li> <li>color</li> <li>shaky</li> <li>faketail</li> <li>rainbow</li> <li>glitchy</li> <li>wavy</li> <li>goto</li> <li>call</li> <li>minibubble</li> <li>breakend</li> <li>Any commands that contains <code>line</code> in their name as specified in the input string (this is case sensitive). This means the following list are also processed if the command is written to satisfy this condition:<ul> <li>line</li> <li>halfline</li> <li>quarterline</li> <li>pauseline</li> <li>libraryline</li> <li>shopline</li> <li>backline</li> <li>unpauseline</li> </ul> </li> </ul> <p>Any other commands will not be processed. (tail and tailextra will be technically be processed too, but their command processing will break immediately under dialogue test mode).</p> <p>This does not impact ignorenext functionality which takes priority over deciding to process the commands or not. Additionally, there is no way to disable test mode meaning when processing this command, the rest of the input string will be processed.</p> <p>This command is unused under normal gameplay, but it remains functional.</p>"},{"location":"SetText/Individual%20commands/Testdiag/#about-line-commands-case-sensitivity","title":"About line commands case sensitivity","text":"<p>It is possible to have a line command not be processed in test mode by writing <code>line</code> differently such as <code>Line</code>. Since the comparison is done with case sensitivity, these line commands can be selectively processed in test mode or not depending on the syntax specified in the input string. This means if the intent is to process all of them, it is important to make sure they are specified in lowercase. While the command parsing is case insensitive, the line comparison in test mode is not. </p>"},{"location":"SetText/Individual%20commands/Textangle/","title":"Textangle","text":"<p>Reset or set the angles of the textholder.</p>"},{"location":"SetText/Individual%20commands/Textangle/#syntax","title":"Syntax","text":"<p>(1) (Reset the angles to Vector3.zero)</p> <pre><code>|textangle|\n</code></pre> <p>(2)</p> <pre><code>|textangle,anglex,angley,anglez|\n</code></pre>"},{"location":"SetText/Individual%20commands/Textangle/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Textangle/#anglex-float","title":"<code>anglex</code>: float","text":"<p>The Euler angle value on the X axis to set to the textholder. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Textangle/#angley-float","title":"<code>angley</code>: float","text":"<p>The Euler angle value on the Y axis to set to the textholder. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Textangle/#anglez-float","title":"<code>anglez</code>: float","text":"<p>The Euler angle value on the Z axis to set to the textholder. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Transfer/","title":"Transfert","text":"<p>An alias of warp.</p>"},{"location":"SetText/Individual%20commands/Transfer/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|transfert,map|\n</code></pre> <p>(2)</p> <pre><code>|transfert,map,x,y,z|\n</code></pre>"},{"location":"SetText/Individual%20commands/Transfer/#parameters","title":"Parameters","text":"<p>Same as warp.</p>"},{"location":"SetText/Individual%20commands/Transitionsort/","title":"Transitionsort","text":"<p>Change the sortingOrder of the current sprite used for transitions.</p>"},{"location":"SetText/Individual%20commands/Transitionsort/#syntax","title":"Syntax","text":"<pre><code>|transitionsort,sort|\n</code></pre>"},{"location":"SetText/Individual%20commands/Transitionsort/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Transitionsort/#sort-int","title":"<code>sort</code>: int","text":"<p>The sortingOrder to set the transition sprite to. This must be a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Transitionsort/#remarks","title":"Remarks","text":"<p>This command does nothing if there are not transition sprites.</p> <p>This command is used in a very specific case where a minibubble needed to be rendered over a fadein transition.</p>"},{"location":"SetText/Individual%20commands/Triui/","title":"Triui","text":"<p>Toggle the camera used to render each letters to 3DGUI instead of GUICamara (main camera in <code>tridimensional</code>) in Regular Letter Rendering.</p>"},{"location":"SetText/Individual%20commands/Triui/#syntax","title":"Syntax","text":"<pre><code>|triui|\n</code></pre>"},{"location":"SetText/Individual%20commands/Triui/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Triui/#remarks","title":"Remarks","text":"<p>This command will function in Single Letter Rendering, but its effect are not implemented with this method effectively doing nothing.</p> <p>When toggled on, this will overwrite the layer that each letter renders at. Normally, it is rendered with the layer 5 (UI, uses GUICamera) or 0 (default, uses the main camera) in <code>tridimensional</code>, but this command, if enabled, will use layer 15 (3DUI) instead. This causes a different camera to render the text: the 3DGUI one instead of the regular GUICamera one and the main difference is it is in perspective mode rather than orthographic mode. This is needed to allow the depth of the text to look correct relative to where it is rendered in the world. The regular GUICamera cannot do this because it is in orthographic mode which renders everything at the same depth.</p> <p>When toggled off, the text after will render using the GUICamera again.</p> <p>This is different than passing <code>tridimensional</code> at true because it renders on a camera that is above the game while <code>tridimensional</code> renders using the main game's camera. Unless in very specific scenario, this command is preferred over <code>tridimensional</code>.</p>"},{"location":"SetText/Individual%20commands/Unpauseline/","title":"Unpauseline","text":"<p>An alias of line that is only processed by SetText when the pause menu is not active.</p>"},{"location":"SetText/Individual%20commands/Unpauseline/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|unpauseline|\n</code></pre> <p>(2)</p> <pre><code>|unpauseline,linespacing|\n</code></pre>"},{"location":"SetText/Individual%20commands/Unpauseline/#parameters","title":"Parameters","text":"<p>The same as line. Check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Unpauseline/#remarks","title":"Remarks","text":"<p>Just like line, this commend is treated like a manual line break by OrganiseLines since it logically resets the line to the first one and goes at the start of it, but it only does so if the pause menu is inactive. If it is active, this will not be treated like a logical line break.</p> <p>This command was presumably done as a workaround to the OrganiseLines Known Issues &gt; Not counting a whole word's width after the first line problem.</p>"},{"location":"SetText/Individual%20commands/Unpausesize/","title":"Unpausesize","text":"<p>An alias of size where the command is only processed if the pause menu and the <code>questboardobj</code> for the Quest Board List Type are inactive.</p>"},{"location":"SetText/Individual%20commands/Unpausesize/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|unpausesize,sizeuniform|\n</code></pre> <p>(2)</p> <pre><code>|unpausesize,sizex,sizey|\n</code></pre> <p>(3)</p> <pre><code>|unpausesize,unpause,sizex,sizey|\n</code></pre> <p>(4)</p> <pre><code>|unpausesize,sizex,sizey,lockcontrol|\n</code></pre>"},{"location":"SetText/Individual%20commands/Unpausesize/#parameters","title":"Parameters","text":"<p>The same as size, check its documentation to learn more.</p>"},{"location":"SetText/Individual%20commands/Unpausesize/#remarks","title":"Remarks","text":"<p>Just like size, this command affects OrganiseLines by changing the horizontal size scaling used to predict the amount of space further letters will take. This is done ignoring the size's locking system so even if the command isn't going to change the size once processed, it will still be taken as a width change for the auto line breaker which can cause problems.</p>"},{"location":"SetText/Individual%20commands/Updateanim/","title":"Updateanim","text":"<p>Call <code>UpdateAnimSepecifc</code> on an Entity.</p>"},{"location":"SetText/Individual%20commands/Updateanim/#syntax","title":"Syntax","text":"<pre><code>|updateanim,entity|\n</code></pre>"},{"location":"SetText/Individual%20commands/Updateanim/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Updateanim/#entity-int-string","title":"<code>entity</code>: int | string","text":"<p>The Entity that this command refers to. The int form is a regular Entity id and it must not resolve to null or an exception will be thrown. The string form can be one of the following when not in battle (if in battle, this is interpreted as an int which will cause an exception to be thrown):</p> <ul> <li><code>this</code>: Refers to the tailtarget. This must not be null or an exception will be thrown.</li> <li><code>caller</code>: Refers to the caller. This must not be null or an exception will be thrown.</li> <li>Anything else: if the string is in the define list, it will refer to it. Otherwise, the value will be interpreted as the int form.</li> </ul>"},{"location":"SetText/Individual%20commands/Var/","title":"Var","text":"<p>Replaces the text from this command to the textual representation of a flagvar with left padding support or set a flagvar to a value.</p>"},{"location":"SetText/Individual%20commands/Var/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|var,flagvar|\n</code></pre> <p>(2)</p> <pre><code>|var,flagvar,pad,totalwidth|\n</code></pre> <p>(3)</p> <pre><code>|var,flagvar,pad,totalwidth,padchar|\n</code></pre> <p>(4)</p> <pre><code>|var,flagvar,newvalue|\n</code></pre>"},{"location":"SetText/Individual%20commands/Var/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Var/#flagvar-int","title":"<code>flagvar</code>:  int","text":"<p>The flagvar slot to get or set. This must be a valid flagvar slot or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Var/#pad-pad","title":"<code>pad</code>: <code>pad</code>","text":"<p>After obtaining the flagvar, this can optionally be specified to pad the beginning of the number with <code>padchar</code> such that the final length of the string is <code>totalwidth</code>. Any other value of this parameter will be ignored (with case sensitivity) and the behavior will be like syntax (4). If this is specified and <code>totalwidth</code> is not specified, an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Var/#totalwidth-int","title":"<code>totalwidth</code>: int","text":"<p>When <code>pad</code> is specified, the designed length of the string after padding. The value must a valid int or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Var/#padchar-char","title":"<code>padchar</code>: char","text":"<p>When <code>pad</code> is specified, the character to pad the text with. If this is not specified, the default value is <code>0</code>. If the length of this parameter exceeds 1, the first character is assumed to be the value.</p>"},{"location":"SetText/Individual%20commands/Var/#newvalue-int-varint-money","title":"<code>newvalue</code>: int |  <code>v[ar]</code>int | <code>money</code>","text":"<p>Value to set the flagvar to: </p> <ul> <li>int: Sets the flagvar in slot <code>flagvar</code> to this parameter's value. The value must a valid int value or an exception will be thrown.</li> <li><code>v[ar]</code>int: Sets the flagvar in slot <code>flagvar</code> to the flagvar at the slot of the int after the <code>v</code> or <code>var</code> prefix. The int part must be a valid int value of a valid flagvar slot or an exception will be thrown. Any other prefix is not allowed and will cause an exception to be thrown.</li> <li><code>money</code>: Sets the flagvar in slot <code>flagvar</code> to the current berry count.</li> </ul>"},{"location":"SetText/Individual%20commands/Var/#remarks","title":"Remarks","text":"<p>With the exception of syntax (4), this command will cause SetText to resume processing at the same character position to accommodate the text replacement.</p>"},{"location":"SetText/Individual%20commands/Wait/","title":"Wait","text":"<p>Yields for a certain amount of seconds if a Text advance <code>skiptext</code> isn't in progress.</p>"},{"location":"SetText/Individual%20commands/Wait/#syntax","title":"Syntax","text":"<pre><code>|forcewait,seconds|\n</code></pre>"},{"location":"SetText/Individual%20commands/Wait/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Wait/#seconds-float","title":"<code>seconds</code>: float","text":"<p>The amount of seconds to yield for. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Wait/#remarks","title":"Remarks","text":"<p>If a Text advance's <code>skiptext</code> was in progress, this command will do nothing. An exception to this is when in control of a minibubble which will always yield regardless.</p> <p>To override the <code>skiptext</code>, use forcewait / fwait instead.</p>"},{"location":"SetText/Individual%20commands/Waitcn/","title":"Waitcn","text":"<p>Yield until the chapter intro coroutine is over.</p>"},{"location":"SetText/Individual%20commands/Waitcn/#syntax","title":"Syntax","text":"<pre><code>|waitcn|\n</code></pre>"},{"location":"SetText/Individual%20commands/Waitcn/#parameters","title":"Parameters","text":"<p>None.</p>"},{"location":"SetText/Individual%20commands/Waitcn/#remarks","title":"Remarks","text":"<p>While this coroutine is typically used for actually playing chapter introductions in Events and in chapterintro, there are other usages of this coroutine that will affect this command. The other ones are innsleep and LoadEverything (which occurs on boot).</p> <p>This command is unused under normal gameplay.</p>"},{"location":"SetText/Individual%20commands/Waitminibubble/","title":"Waitminibubble","text":"<p>Yield until all or a specific minibubble by its index in the bubbles list is destroyed.</p>"},{"location":"SetText/Individual%20commands/Waitminibubble/#syntax","title":"Syntax","text":"<p>(1) (This yields until all minibubble are destroyed in the bubbles list)</p> <pre><code>|waitminibubble|\n</code></pre> <p>(2)</p> <pre><code>|waitminibubble,index|\n</code></pre>"},{"location":"SetText/Individual%20commands/Waitminibubble/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Waitminibubble/#index-int","title":"<code>index</code>: int","text":"<p>The index of the minibubble to yield until its destruction. This must be a valid index in the bubbles list or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Waitminibubble/#remarks","title":"Remarks","text":"<p>In syntax (1), this will loop through the list until there are no elements in it. In each iteration, if the minibubble got destroyed, it is removed from the bubbles list before the yield for a frame is performed which removes its consideration in the test to know if we are done.</p> <p>For more details, check Minibubble &gt; Managing Minibbubles from the outer SetText call.</p>"},{"location":"SetText/Individual%20commands/Warp/","title":"Warp","text":"<p>Setup a map transfer to either a specific map id or one that is contained in a flagvar with the optional ability to set where to move the party after the new map is loaded.</p>"},{"location":"SetText/Individual%20commands/Warp/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|warp,map|\n</code></pre> <p>(2)</p> <pre><code>|warp,map,x,y,z|\n</code></pre>"},{"location":"SetText/Individual%20commands/Warp/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/Warp/#map-int-varint","title":"<code>map</code>: int | <code>var</code>int","text":"<p>The maps to go to. The int form indicates the maps id directly and it must be a non negative int or an exception will be thrown during the transfer. </p> <p>The string form indicates to get the map id from a flagvar slot and it must have a value such that it contains <code>var</code> and a valid flagvar slot. If after removal of <code>var</code>, the result is not a valid flagvar slot, an exception will be thrown. The flagvar must contain a non negative int or an exception will be thrown during the transfer.</p> <p>In either form, if the map id resolves to a value higher than the max map id, it defaults to the map NearSnakemouth.</p>"},{"location":"SetText/Individual%20commands/Warp/#x-float","title":"<code>x</code>: float","text":"<p>The x position to move the party after the new map is loaded. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Warp/#y-float","title":"<code>y</code>: float","text":"<p>The y position to move the party after the new map is loaded. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Warp/#z-float","title":"<code>z</code>: float","text":"<p>The z position to move the party after the new map is loaded. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/Warp/#remarks","title":"Remarks","text":"<p>The map transfer won't occur during this commands's processing, but rather during Cleanup at end of the SetText call. This only setup the transfer to happen at that moment.</p> <p>This commands also sets end to true.</p>"},{"location":"SetText/Individual%20commands/Wavy/","title":"Wavy","text":"<p>Toggles the wavy FontEffects that will be effective from this point in Regular Letter Rendering.</p>"},{"location":"SetText/Individual%20commands/Wavy/#syntax","title":"Syntax","text":"<pre><code>|wavy|\n</code></pre>"},{"location":"SetText/Individual%20commands/Wavy/#parameters","title":"Parameters","text":"<p>None</p>"},{"location":"SetText/Individual%20commands/Wavy/#remarks","title":"Remarks","text":"<p>This turns the wavy FontEffects from false to true or from true to false depending on its existing state. The state change will affect every letter from the point this command is being processed.</p> <p>This command can be overridden by shaky, if it is issued while wavy is active, it will remain active, but the effect will not render, only shaky.</p> <p>This command does nothing in Single Letter Rendering.</p> <p>This command is accumulated for the Backtracking system.</p> <p>This is one of the command supported by testdiag.</p>"},{"location":"SetText/Individual%20commands/size/","title":"Size","text":"<p>Set the text size scaling to render from now on with the ability to prevent processing of further size commands temporarily.</p>"},{"location":"SetText/Individual%20commands/size/#syntax","title":"Syntax","text":"<p>(1)</p> <pre><code>|size,sizeuniform|\n</code></pre> <p>(2)</p> <pre><code>|size,sizex,sizey|\n</code></pre> <p>(3)</p> <pre><code>|size,unpause,sizex,sizey|\n</code></pre> <p>(4)</p> <pre><code>|size,sizex,sizey,lockcontrol|\n</code></pre>"},{"location":"SetText/Individual%20commands/size/#parameters","title":"Parameters","text":""},{"location":"SetText/Individual%20commands/size/#sizeuniform-float","title":"<code>sizeuniform</code>: float","text":"<p>The text size scaling to set uniformly in the vertical and horizontal direction. This must be a valid float or an exception will be thrown.</p>"},{"location":"SetText/Individual%20commands/size/#sizex-float-x","title":"<code>sizex</code>: float | <code>x</code>","text":"<p>The text size scaling to set horizontally. The float form must be a valid float or an exception will be thrown. <code>x</code> will cause the existing y size (NOT X SIZE which is likely an error!) to be used instead. Any other value will be interpreted as the float form which will cause an exception to be thrown if it isn't one.</p>"},{"location":"SetText/Individual%20commands/size/#sizey-float-y","title":"<code>sizey</code>: float | <code>y</code>","text":"<p>The text size scaling to set vertically. The float form must be a valid float or an exception will be thrown. <code>x</code> will cause the existing y size to be used instead which essentially ignores the value. Any other value will be interpreted as the float form which will cause an exception to be thrown if it isn't one.</p>"},{"location":"SetText/Individual%20commands/size/#unpause","title":"<code>unpause</code>","text":"<p>Tells this command to only change the size when unpaused and <code>inlist</code> from the ItemList State Machine is true (NOTE: see inlist issue for potential issues). If paused or <code>inlist</code> is false, the size will not change, but the rest of the command will still be processed (see remarks for details). Any other value will process the command in syntax (2) which will throw an exception.</p>"},{"location":"SetText/Individual%20commands/size/#lockcontrol-lock-force-unlock","title":"<code>lockcontrol</code>: <code>lock</code> | <code>force</code> | <code>unlock</code>","text":"<p>Tells how to treat this command in regards to the size locks which tells SetText to not process further size commands:</p> <ul> <li><code>lock</code>: Engages the size lock. Any further size commands not sent with this parameter set to <code>force</code> or <code>unlock</code> will do nothing.</li> <li><code>force</code>: Ignores the size lock when processing the command, but do not disengage the size lock. Only this command will process normally.</li> <li><code>unlock</code>: Disengages the size lock. Further size commands will process normally.</li> </ul> <p>Any other value is ignored.</p>"},{"location":"SetText/Individual%20commands/size/#remarks","title":"Remarks","text":"<p>In Single Letter Rendering, this also sets the localScale of the letter slot to (size.x, size.y, 1.0) * 0.07. This essentially scales everything down to 7% of the new size.</p> <p>Additionally, the bleep volume is adjusted to the new size's magnitude which will make bleeps go louder or softer depending on the new size.</p> <p>This command affects OrganiseLines by changing the horizontal size scaling used to predict the amount of space further letters will take. This is done ignoring the locking system so even if the command isn't going to change the size once processed, it will still be taken as a width change for the auto line breaker which can cause problems.</p> <p>This command is accumulated for the Backtracking system, but it does so by adding the same command twice in a row. (NOTE: Why?)</p>"},{"location":"SetText/Letter%20Rendering%20Methods/Regular%20Letter%20Rendering/","title":"Regular Letter Rendering","text":"<p>This letter rendering method is the default one and it is generally the most stable because it was implemented from the start. Every letter is rendered with this method unless single is explicitly toggled on. It involves rendering each letter as individual TextMesh objects (called letter slots) with a maximum of 500 letters that can be rendered using this method alone.</p> <p>Its main advantage is its compatibility: it works with every features because having each letter be its own TextMesh allows fine control over its meshes. This allows several font effects and other rendering Commands to work correctly while Single Letter Rendering would be incompatible with them.</p> <p>Its main problem is its inefficiency because it renders each letter in its own object and it each of them uses its own material instance instead of sharing the same one for a given font. This creates a ton of allocations/garbage collection every time rendering needs to happen with several letters on the screen which can lead to poor performance especially on embedded consoles such as the Nintendo Switch. Additionally, it limits more the amount of text that can be shown on screen at once since it is limited to 500.</p>"},{"location":"SetText/Letter%20Rendering%20Methods/Regular%20Letter%20Rendering/#rendering-process","title":"Rendering process","text":"<ul> <li>In Dialogue mode, sets tailtarget to be talking</li> <li>If in Dialogue mode and the current letter isn't the last one, play the current bleep sound with the current pitch and volume settings and accumulate the letter in the backtracking system.</li> <li>Get the first free letter slot and store it in letter</li> <li>If a slot was available<ul> <li>Set the appropriate layer of the letter (this changes the camera that renders the letter):<ul> <li>15 (3DUI) if triui is enabled (will render using the 3DGUI camera)</li> <li>5 (UI) if the <code>tridimensional</code> parameter is false (will render using the GUICamera, this is the default)</li> <li>0 (Default) if the <code>tridimensional</code> parameter is true (will render using the main camera of the game)</li> </ul> </li> <li>Set the letter's tag to <code>Letter</code></li> <li>Reserve the letter slot to be the current char, with a font of fonttype, with the parent being the textholder at (current offset, current line - 0.1, 0.0) + (0.0, -0.1), using the current text color, a sort of sort and a size of (size.x, size.y, 1.0) * 0.07</li> <li>If we are using a dropshadow<ul> <li>Sets the <code>ds</code> field to the first free slot and set its layer to the letter's layer</li> <li>Reserve the <code>ds</code> slot to be letter's text, with a font of fonttype, with the parent being the textholder at the letter's localPosition + the dropshadow offset, using a half transparent black color if fadeletter is disabled and clear color otherwise, a sort of the current sort and a size of the letter's scale.</li> <li>If fadeletter is true, starts a fade of <code>ds</code>'s MeshRender to half transparent over the course of 200 frames</li> <li>Increment the letter's MeshRenderer's sortingOrder so it is rendered above the <code>ds</code> one</li> </ul> </li> <li>If any of the font effects is enabled, add a <code>FontEffects</code> to letter with the current effects desired (also sets <code>superglitch</code>)</li> <li>Add GetLetterOffset of the current character with font fonttype and size.x to current offset</li> </ul> </li> <li>Sets <code>maxlength</code> to the current offset if it is larger than the current value</li> <li>If center is enabled, sets the textholder's localPosition to (position.x - <code>maxlenght</code> / 2.0, position.y, position.z)</li> <li>Decide whether to do the letter yield. The conditions are:<ul> <li>We are in a minibubble's inner call in which case, it will always do the yield</li> <li>If not, we need to be in Dialogue mode </li> <li>If we are, the current speed needs to be above 0 </li> <li>If it is, this is dependant on the Text advance: if <code>skiptext</code> isn't active OR  noskip is active, then the yield will happen</li> </ul> </li> <li>If we decided to yield, do it for Speed seconds</li> <li>An additional yield could be done of 0.15 seconds except on some conditions using the same base condition than the general yield (with the exception that this ignores noskip). The additional conditions to do this yield are that the current letter passed to charIsPunctuation is true AND it's not among <code>|</code>, <code>)</code>, <code>\u00bf</code>, <code>\u00a1</code>, <code>'</code>, <code>/</code>, <code>\u00bf</code>, <code>)</code> or <code>\u00a1</code> AND It's not among the last 2 letters</li> </ul>"},{"location":"SetText/Letter%20Rendering%20Methods/Single%20Letter%20Rendering/","title":"Single Letter Rendering","text":"<p>This letter rendering method is disabled by default, but it can be opted in using single so it needs to be explicitly toggled on. It involves rendering each line as individual TextMesh objects (called letter slots) with a maximum of 500 lines that can be rendered using this method alone.</p> <p>It was introduced relatively late in development to counter Regular Letter Rendering's main problem: inefficiency. Instead of taking one letter slot per letter, single letter rendering takes one letter slot per line. This significantly reduces the amount of letter slot taken which has shown to increase performances. It also allows to render more letters on screen at once.</p> <p>This comes at a huge cost: compatibility. Because the entire letter slot is a whole line, not all features like font effects and other rendering Commands work correctly as they weren't all made to support this rendering method. As a result, some features still aren't using this rendering method mostly because it uses an incompatible feature. </p> <p>Notably, lacking features are bleep playing, backtracking accumulation, triui, <code>tridimensional</code>, any FontEffects, yield on letters and others Commands involving sprite rendering does not work correctly such as icon, button and stars. </p> <p>The performance gain is however still significant to use it when it is possible such as in UI text which was why it was introduced in the first place. The kerning turns out to be very close to Regular Letter Rendering which means the text appearance doesn't change much, but spaces aren't physical gaps anymore which means they visually are narrower</p>"},{"location":"SetText/Letter%20Rendering%20Methods/Single%20Letter%20Rendering/#rendering-process","title":"Rendering process","text":"<ul> <li>if the single letter slot is null<ul> <li>Set the single letter slot to the first free slot and if no slot is available, yield for a frame until one is free.</li> <li>Reserve the single letter slot slot to be empty string, with a font of fonttype, with the parent being the textholder at Vector3.zero, using the current text color, a sort of sort and a size of (size.x, size.y, 1.0) * 0.07, 0.0</li> </ul> </li> <li>Add GetLetterOffset of the single letter slot with a size of size.x to the current offset</li> <li>Append the current letter to the single letter slot.</li> <li>Set the localPosition of the single letter slot to (<code>x</code>, current line, 0.0) + (0.0, -0.1) where <code>x</code> is 0.0 or (0 - the length of the letter slot's text / 2.0) if center is enabled</li> <li>If dropshadow is enabled<ul> <li>If the <code>ds</code> letter is null<ul> <li>Sets <code>ds</code> to the first free letter slot (NOTE: NO CHECK IF A SLOT IS AVAILABLE!)</li> <li>Reserve the <code>ds</code> slot to be empty string, with a font of fonttype, with the parent being the single letter at the dropshadow offset, using a half transparent black color, a sort of sort - 1 and a size of Vector3.one</li> </ul> </li> <li>Sets <code>ds</code>'s text to the single letter's text</li> </ul> </li> </ul>"},{"location":"SetText/Related%20Systems/Backtracking/","title":"Backtracking","text":"<p>SetText supports a system called dialogue backtracking which allows in Dialogue mode to see previous textbox that have been passed in the same SetText call. This system only works correctly in Regular Letter Rendering because in Single Letter Rendering, it will not accumulate any letters to the history.</p> <p>This system is mainly possible using some important static field of MainManager:</p> <ul> <li><code>currentdialogue</code>: Stores the index of the current textbox text being displayed (counted from 0).</li> <li><code>diagstring</code>: Stores the textbox backtrack history. This includes the textbox SetText is waiting on if a backtracking is initiated.</li> <li><code>tempdiag</code>: Accumulates a stripped version of the current textbox text until it is done so it can be added to <code>diagstring</code>.</li> <li><code>backtacking</code>: Tracks if a backtrack is in progress.</li> </ul> <p>Everything starts by tracking the current textbox using <code>tempdiag</code> which serves as an accumulator.  During Dialogue setup, it is set to |size,size.x,size.y| which serves as the starting value using the size values. Then, it will accumulate every letters (except in Single Letter Rendering where it's not supported) and spaces during processing, but only a subset of the commands will be accumulated. These commands are:</p> <ul> <li>icon</li> <li>button</li> <li>size</li> <li>shaky</li> <li>wavy</li> <li>rainbow</li> <li>glitchy</li> <li>halfline</li> <li>quarterline</li> <li>line (only in Regular Letter Rendering)</li> <li>backline</li> </ul> <p>Any other command will not be accumulated to this static field.</p> <p>The storage of the textbox in <code>diagstring</code> only happens upon a next or goto command which delimits what constitutes a textbox in backtracking. At the end of processing either command, <code>currentdialogue</code> is incremented and <code>tempdiag</code> added to <code>diagstring</code>. </p> <p>Additionally, <code>tempdiag</code> is reset to its starting value which is |size,size.x,size.y|. Every time next is processed, but before adding the textbox to <code>diagstring</code>, it will yield control to MainManager's Update by grabbing waitinput. This is where the game allows a backtracking to be initiated, but only after at least one textbox has passed. It is also possible to backtrack on the last textbox if an end command has not been processed. Additionally, It is possible to disable any backtracking for happening by using the Lockbacktrack command.</p> <p>Once a backtrack is initiated, the current line that SetText is waiting on waitinput to be released is added to <code>diagstring</code>, <code>currentdialogue</code> is decremented and <code>backtacking</code> is set to true. The reason adding the current line is done is because since it has already been processed by SetText, waitinput can only come back to false once that current line is passed during a backtrack. The only way for this to happen is if the current line is added to backtracking itself in <code>diagstring</code>.</p> <p>From there, it is possible to freely go back and forth between the lines in <code>diagstring</code> which is tracked by <code>currentdialogue</code> that gets incremented and decremented accordingly. To render the text, all child of the textbox gets destroyed which blanks it and a separate SetText call is performed with the appropriate line from <code>diagstring</code>. This call is done with the string prepended with |color,7| on the same textbox as the parent. This occurs in non dialogue mode which prevents conflicts with the fields mentioned above. This all happen every time a change in the textbox is performed.</p> <p>Once the last textbox from <code>diagstring</code> is passed, MainManager's Update detects that <code>currentdialogue</code> and <code>diagstring.Count</code> are the same upon passing the textbox and releases the waitinput. This causes the original SetText call to resume, but since <code>backtacking</code> hasn't been set to false yet, it knows to not add the current textbox since it has been added to <code>diagstring</code> already. At the very end of the next processing, <code>backtacking</code> is finally set to false which allows SetText to continue processing as if nothing happened.</p>"},{"location":"SetText/Related%20Systems/FontEffects/","title":"FontEffects","text":"<p>Bug Fables contains a component called FontEffects which is meant to be applied to a TextMesh corresponding to a letter. It allows through a very simple state machine to render the letter with fancy visual effects.</p> <p>This state machine simply offers boolean fields that enables or disable the effect on the letter with the ability to receive an integer value as variant. The idea of the variant is to offset the way the effect is applied so multiple letters looks nice together.</p> <p>Here are what the effects this component supports via SetText Commands (the field name of the FontEffects is the same than the command name in lowercase):</p> <ul> <li>wavy: Make the mesh move in wave using oscillation functions through time.</li> <li>shaky: Make the mesh displace itself randomly in a range from its starting position every frame.</li> <li>rainbow: Render the mesh with a color that makes multiple meshes in a row look like a flowing rainbow.</li> <li>glitchy: Have the mesh change its text to a random letter among a set with 0.125% chance every frame. The set is <code>'@', '?', '!', '#', '*', '+', '-', '$', '&amp;'</code>. Once a letter has changed, it has 10% chance to restore itself every frame. Additionally, there is a more aggressive version of this effect called <code>superglitch</code> that has 20% to change the letter each frame instead which is accessible via a parameter to the glitchy command.</li> <li>fadeletter: The letter starts to be fully transparent and slowly fades into the original color the letter had.</li> </ul> <p>Additionally, it supports the ability to <code>rotate</code>, randomly by 0, 90, 180 or 270 degrees every frames, but this has to be configured manually and it is not directly accessible via a command.</p> <p>Since the FontEffects was intended to work per letter, they do not work in Single Letter Rendering. The commands that uses the effects will not do any operation if they are processed in Single Letter Rendering mode with the exception of rainbow which will render, but incorrectly.</p>"},{"location":"SetText/Related%20Systems/GlobalCommand/","title":"GlobalCommands","text":"<p>This system was an experiment to improve one of the flaws of SetText which was that every commands had to be specified inline with its text. This meant that localisation could create a lot of mishaps from copy pasting the lines and changing the commands around which can lead to problems as bad as softlocks.</p> <p>The system has to be enabled for each Maps via <code>useglobalcommand</code>, but the game only has it enabled on the Map SnakemouthEmpty which is a map that was only used in the demo and ended up unused in the final version. Nonetheless, the code to support it is still in and in theory, accessible if <code>useglobalcommand</code> is enabled for the map.</p> <p>Instead of specifying every commands in the same line, a global command SetText line has <code>@</code> to denote placeholders. From there, GlobalCommand replaces these with strings contained in the map's <code>commandlines</code> using <code>;</code> as separator which ends up like a normal SetText line. This meant that every line in the map could have common commands shared positionally without actually needing to specify them. This is meant to operate on the current map's current line.</p> <p>In theory, it would only solve the problem partially since it could allow map's lines to have less SetText errors after translation, but considering how SetText is used in many ways outside of the map lines, it's safe to say that this system was incomplete. It doesn't account for the many lines needed for things like descriptions or enemy tattles.</p> <p>It's safe to speculate that it was left unused as an artifact for its experimentation. It wouldn't have been possible to implement it in any significant ways in the game as this was done too late to make it possible.</p>"},{"location":"SetText/Related%20Systems/Text%20advance/","title":"Text advances","text":"<p>SetText in Regular Letter Rendering and Dialogue mode has a normal yield time when a text skip isn't happening of 0.02 seconds or 0.03 seconds in <code>Japanese</code> for every standard letter. Every spaces do not get a wait and some punctuation has an additional fixed wait of 0.15 seconds. In non dialogue mode, an |spd,0| is prepended which already disables wait time and in Single Letter Rendering, wait times aren't supported at all. </p> <p>There are ways to skip the wait times on demand such as from the input string itself If the speed is set to 0, but it is also possible to reduce it on demand by the player using either text skip system.</p>"},{"location":"SetText/Related%20Systems/Text%20advance/#text-skip","title":"Text skip","text":"<p>SetText allows to skip the wait time that would normally happen at the end of the Dialogue post-processing in Dialogue mode.</p> <p>There are 2 instance fields of MainManager involved in this feature:</p> <ul> <li><code>skiptext</code>: Tells if a text skip was requested by either pressing the confirm input or the cancel input without holding it. Initialized to false in Dialogue setup and overridden to false in multiple Commands if applicable.</li> <li><code>isholdingskip</code>: Tells if the cancel input is held which implies that <code>skiptext</code> is true as this is a super set of the <code>skiptext</code>. Initialized to false in Dialogue setup</li> </ul> <p>When <code>skiptext</code> turns to true, SetText will process every letter without yielding until some conditions happens. For example, if a next command is processed, it will force the text skip to stop before yielding for the next textbox, but there are other commands that stops it.</p> <p><code>isholdingskip</code> on the other hand is more aggressive: it will automatically pass confirmation inputs needed to release a waitinput lock. This allows to pass textboxes as soon as the cooldown expires which for either skipping method is set to 16 frames. What this means is in the best case scenario, holding the Cancel input will still leave 16 frames of waiting between textboxes, but it will not require mashing.</p>"},{"location":"SetText/Related%20Systems/Text%20advance/#override-a-text-skip","title":"Override a text skip","text":"<p>SetText can force a textskip to end via noskip which ignores any request to text skip and will still upheld the normal yield time.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/Organisation%20procedure/","title":"Automatic Line Breaking","text":"<p>This page lists the procedure of OrganiseLines in other languageid then <code>Japanese</code> (in that language, the input string is returned with nothing on it).</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/Organisation%20procedure/#replace-functions","title":"Replace functions","text":"<p>The input string is set to the return of ReplaceFunctions. This is where there is some look ahead and preprocessing of the string, but only sstring and menu are supported. Check the documentation of either commands to learn more.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/Organisation%20procedure/#char-loop","title":"Char Loop","text":"<p>This is the heart of the auto line breaker. For each char in the input string:</p> <ul> <li>Pseudo switch on the char (skip every LF):<ul> <li><code>|</code>:<ul> <li>For next, blank or any commands with <code>line</code> in it (except if paused with unpauseline and when a Shopkeeper isn't in the interact range of the player for a shopline):<ul> <li>Act as if a <code></code> was processed, but without adding a space width to the line accumulator.</li> </ul> </li> <li>For button:<ul> <li>Add 0.7 to the line accumulator. Add another 0.7 if the keyboard input text is not empty and it doesn't have <code>Arrow</code>. Reset the word accumulator to 0.</li> </ul> </li> <li>For any commands with <code>size</code> (except battlesize) where the first param isn't <code>multi</code>:<ul> <li>Change the size to the x size parameter of the command</li> </ul> </li> <li>For singlebreak:<ul> <li>Enable single break mode and set the <code>maxoffset</code> to the one sent in parameter of the command.</li> </ul> </li> </ul> </li> <li><code></code>: <ul> <li>Add 0.3 * size to the line accumulator width (0.3 is the width of a space gap)</li> <li>If the line accumulator width + the word accumulator width exceeds <code>maxoffset</code><ul> <li>Add an LF or a line command if singlebreak was seen to the result string</li> <li>Set the line accumulator width to the start of the line:<ul> <li>If languageid is <code>English</code>, unless map.<code>englishbreakfix</code> is true AND the message lock is grabbed, this is 0 which is broken (more details here)</li> <li>Otherwise, this is the word accumulator which is only slightly wrong as it is missing a space gap (more details here)</li> </ul> </li> <li>Otherwise<ul> <li>Add the word accumulator width to the line accumulator width</li> </ul> </li> <li>Append the accumulated word and a space to the result string</li> <li>Reset the current word to empty and current word accumulator width to 0</li> </ul> </li> <li>Anything else:<ul> <li>Add the width of the char to the current word accumulator width and add the char to the current word. The width is floor(offset * 25.0) / 25.0. This width is multiplied by 0.975 if in single break mode</li> </ul> </li> </ul> </li> </ul> </li> <li>if the last line accumulator width + the last word accumulator width exceeds <code>maxoffset</code><ul> <li>Add an LF at the end of the result string</li> </ul> </li> <li>if singlebreak has been seen in the string:<ul> <li>Normalize every LF and every double line to be single line commands without parameters</li> </ul> </li> <li>Return the result string</li> </ul>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines%20Known%20Issues/","title":"OrganiseLines known issues","text":"<p>The line breaking logic has some known issues that are important enough to be mentioned in its own page. These issues impact any public versions of the game from 1.0.0 to the latest one.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines%20Known%20Issues/#not-counting-a-whole-words-width-after-the-first-line","title":"Not counting a whole word's width after the first line","text":"<p>While a partial fix is applied to this one, it was intentionally disabled for the <code>English</code> language and is also explains why <code>Japanese</code> has no auto line breakers. Since this issue is still present in some ways and is historically relevant, an explanation is warranted.</p> <p>After processing the first line and inserting the first line break, there was an error present from early development when resetting the line accumulator width. It was reset to 0 and that failed to take into account the first word of the following line. This frequently lead to overflow because the line breaker thought there was more space than there actually was. The cause of the issue wasn't known for a very long time during development and what was done instead was to tune the default maxoffset to 9.75 instead of what it should have been which is 10.5. This was a partial workaround to the problem, but the issue still persisted.</p> <p>It wasn't a huge problem until efforts to localize the game happened. When it came time to implement the <code>Japanese</code> language, it was clear that the current state of the auto line breaker would not work. As the cause of the issue wasn't known still and no investigations was done to figure it out, it was decided to manually insert line commands in the <code>Japanese</code> script for every single point where a line break was needed. This is why this language's dialogues files have a very high amount of line and related commands, but it also explains why OrganiseLines does nothing on <code>Japanese</code>; every line break was done by hand instead.</p> <p>After a while, the issue was uncovered and a fix was ready, but applying it posed problems for both <code>Japanese</code> and <code>English</code> which were already implemented. The former would potentially break the manual line commands while the later was completely written with the assumption that OrganiseLines stayed broken which made fixing the issue risky.</p> <p>Ultimately, it was decided to apply the fix for every language except <code>English</code> which already was acceptable with the issue and leave <code>Japanese</code> without an auto line breaker. Hence why this issue is still present on <code>English</code>, but since the whole script was written with this broken logic in mind, it isn't a huge issue with the script the game ships with.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines%20Known%20Issues/#not-counting-a-trailing-spaces-width-after-the-first-line","title":"Not counting a trailing space's width after the first line","text":"<p>This is similar to the issue above, but this one affects every languages other than <code>Japanese</code> which doesn't have the auto line breaker. When inserting a line break, the new line contains the current word with a space gap. The fix for the above issue accounts for the word, but it fails to account for the space gap. This can make the difference where a small word is barely overflowing the max offset due to this as a space isn't counted when accumulating the line's width.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines%20Known%20Issues/#the-default-messagebreak-is-too-low","title":"The default messagebreak is too low","text":"<p>For every other languages than <code>English</code> and <code>Japanese</code> (which doesn't have the auto line breaker), there can be situations where a word barely doesn't fit on the line despite the fact that it would visually look fine with the word included. While it doesn't sound like a huge issue, it can push relatively large words below leaving a wide gap at the end of the line which can make the text less dense. The default value of 10.5 is slightly too low compared to what can visually fit in one line.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/","title":"OrganiseLines","text":"<p>A static method in MainManager that automatically inserts line breaks to fit inside a constrained width (typically the textbox or other GUI elements). This is mostly used in SetText, but it is also used when calling the dialog via backtracking.</p> <p>This method works on all languages except <code>Japanese</code> where it will immediately return <code>text</code>.</p> <p><code>English</code> works slightly differently as the line width calculations are broken (see OrganiseLines Known Issues for more details).</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/#signature","title":"Signature","text":"<pre><code>private static string OrganizeLines(string text, float maxoffset, float size, int fontid)\n</code></pre>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/#parameters","title":"Parameters","text":""},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/#text-string","title":"<code>text</code>: string","text":"<p>The text to have the line breaks inserted.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/#maxoffset-float","title":"<code>maxoffset</code>: float","text":"<p>The maximum width of a line. This is usually the linebreak's parameter sent to SetText, but it can be overridden by setbreak (doing so is not recommended).</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/#size-float","title":"<code>size</code>: float","text":"<p>The horizontal scale of the text. This is usually sent by SetText and corresponds to the current size.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/#fontid-int","title":"<code>fontid</code>: int","text":"<p>The fonttype that will be used to render. Typically comes from SetText using the current one.</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/#returns","title":"Returns","text":"<p>On <code>Japanese</code>, <code>text</code> is returned with no changes. On other languages, the same string is returned, but with LF inserted at places to indicate a line change (the LF are line commands without parameters in case singlebreak is present in the input string).</p>"},{"location":"SetText/Related%20Systems/Automatic%20Line%20Breaks/OrganiseLines/#remarks","title":"Remarks","text":"<p>There are a couple of caveats to this method because of its design. The main one is it is not able to \"look ahead\" of the input string so for example, it cannot know if there will be redirection or text replacement performed during processing. While there are some specific cases where this method actually processes commands (such as sstring and menu), they are far from exhaustive.</p> <p>Additionally, there are some known issues that are important to mention which you can learn more at OrganiseLines Known Issues.</p> <p>For details of the automatic line breaking procedure, see Organisation procedure.</p>"},{"location":"TextAsset%20Data/BoardQuests%20data/","title":"BoardQuests","text":"<p>BoardQuests are split in 3 TextAssets in the game loaded on boot: </p> <ul> <li>By LoadEssentials:<ul> <li><code>Ressources/data/QuestChecks</code></li> </ul> </li> <li>By SetVariables:<ul> <li><code>Ressources/data/BoardData</code></li> <li><code>BoardQuests</code> from the corresponding dialogue directory of the current languageid</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/BoardQuests%20data/#questchecks-data","title":"<code>QuestChecks</code> data","text":"<p>The asset contains one line per BoardQuests whose id corresponds to the line index. Each line contains one a <code>@</code> separated list of one field per element:</p> Name Type Description Prerequisite int &gt; 0: a required flags slot for the quest to be true --- --- = 0: No prerequisite if it's the first element, having seen Areas 0 (Bugaria Outskirt) otherwise --- --- \\&lt; 0: A required Areas id to have been seen <p>The data will be loaded into <code>questchecks[id, x]</code> where <code>id</code> is the BoardQuests id and <code>x</code> is the index of each elements of the list starting from 0.</p> <p>It should be noted that a prerequisite of 0 is only supported as it being the only element to indicate there are no prerequisite. Everything after will be ignored as the first element being 0 takes priority.</p>"},{"location":"TextAsset%20Data/BoardQuests%20data/#boarddata-data","title":"<code>BoardData</code> data","text":"<p>The asset contains one line per BoardQuests whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 3 Taken flags int The flags slot telling if the quest was taken 4 Icon int Index of the sprite in <code>Sprites/Items/EnemyPortraits</code> to render using the Quest Board List Type 5 Difficulty int The amount of stars to render as a difficulty indicator using the Quest Board List Type <p>The data will be loaded into <code>boardquestdata[id, x]</code> where <code>id</code> is the BoardQuests id and <code>x</code> is the loaded index.</p>"},{"location":"TextAsset%20Data/BoardQuests%20data/#boardquests-data","title":"<code>BoardQuests</code> data","text":"<p>The asset contains one line per BoardQuests whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 0 Name SetText string The name of the quest 1 Description SetText string The description of the quest 2 Sender SetText string The name of the sender of the quest <p>The data will be loaded into <code>boardquestdata[id, x]</code> where <code>id</code> is the BoardQuests id and <code>x</code> is the loaded index</p>"},{"location":"TextAsset%20Data/Cave%20Of%20Trials%20data/","title":"Cave Of Trials data","text":"<p>The game contains a TextAsset located at <code>Ressources/data/Trials</code> from the root of the assets tree that contains data about Cave of Trials. It is only loaded during the course of Event 156 (Cave of Trials event) to gather the enemies ids used to start the battle for each round using StartBattle directly.</p> <p>The asset contains a list of battles of a standard run in order, one for each line. Each lines contains one field:</p> Name Type Description Enemy list <code>,</code> separated list of Enemies id The list of Enemies for the fight"},{"location":"TextAsset%20Data/Cave%20Of%20Trials%20data/#about-the-amount-of-fights","title":"About the amount of fights","text":"<p>Interestingly, while the handling of this data is meant to function regardless of the number of lines in the asset, it is not meant to go above 50. This is because while the game doesn't specifically limit the number of battles to 50, the rewards Giveitem's <code>itemid</code> array, their corresponding flags slot and their corresponding Giveitem's <code>type</code> are hardcoded to each contain 5 elements and are only given every 10 fights (called a fight block in the section below). Going beyond that would cause an exception to be thrown because there are no 6th element in each of the array.</p> <p>It is worth noting that this is the only reason the amount of battles are limited to 50. Even the dialogue lines in the <code>CaveOfTrials</code> Maps contains special strings (<code>@VAR@</code> and <code>@VAR2@</code>) that are replaced during the event by the appropriate number (current battle, amount of all battles in the run and amount of battles left).</p>"},{"location":"TextAsset%20Data/Cave%20Of%20Trials%20data/#random-mode","title":"Random mode","text":"<p>Random mode still loads this asset, but the difference is that the actual battles are a randomized set of enemies. This implies that the amount of fights is still dependent on this asset rather than 50.</p>"},{"location":"TextAsset%20Data/Cave%20Of%20Trials%20data/#hardcoded-rewards-data","title":"Hardcoded rewards data","text":"<p>Here are the hardcoded rewards data present in the event:</p> Fight block GiveItem's id GiveItem's type Reward description flags slot 0 77 0 Tangy Berry 503 1 121 0 Dark Cherries 504 2 50 2 Defense Exchange 505 3 25 2 TP Saver 506 4 185 1 Team Ribbon 673"},{"location":"TextAsset%20Data/Dialogue%20data/","title":"Dialogue data","text":"<p>The dialogue lines are present in some TextAssets which are either global to the game or belong to a specific Maps. The lines are however language specific with the exception of the TestRoom map which is language agnostic and the data is inside the <code>TestRoom</code> asset. Each lines contains a single SetText string and the line index is how the game can access it (they are generally hardcoded or referenced somewhere else like in asset data).</p> <p>In <code>Ressources/data</code>, there are multiple directories named <code>dialogueX</code> where X is the corresponding languageid. All the data belonging specifically to that language are inside. The different files are documented in each of their respective pages, but this one will focus more on the dialogue lines aspect; the ones notably used in Events, UI and others.</p>"},{"location":"TextAsset%20Data/Dialogue%20data/#global-dialogue-data","title":"Global dialogue data","text":"<p>There are 2 files that are notable for containing global language specific data: <code>CommonDialogue</code> and <code>MenuText</code>.</p>"},{"location":"TextAsset%20Data/Dialogue%20data/#common-dialogue-lines","title":"Common dialogue lines","text":"<p>Some SetText lines are shared across Maps in the game and needs global access via the standard Dialogue line id system. These lines are located in the <code>CommonDialogue</code> TextAsset which is loaded on boot by SetVariables into <code>commondialogue</code>. It is also possible to access a line using the Common command.</p>"},{"location":"TextAsset%20Data/Dialogue%20data/#menu-dialogue-lines","title":"Menu dialogue lines","text":"<p><code>MenuText</code> behaves similarly to <code>CommonDialogue</code>, but the lines cannot be resolved using a standard Dialogue line id as each SetText Commands have to specifically support them. They are mainly intended for UI rendering. The asset is loaded on boot by SetVariables into <code>menutext</code>. The main way to use a line directly via a command is by using Menu.</p>"},{"location":"TextAsset%20Data/Dialogue%20data/#maps-specific-dialogue-lines","title":"Maps specific dialogue lines","text":"<p>The <code>maps</code> directory in each dialogue directory contains several TextAsset, each named after a Map's name and it contains dialogue lines specific to that map. This means that under normal operation, SetText commands can only access the lines via the standard Dialogue line id system if the current map matches the file the line is in. There is however a way to load a line from another map using the GetFromMap command.</p>"},{"location":"TextAsset%20Data/Discoveries%20data/","title":"Discoveries data","text":"<p>Discoveries entry data are split in 2 TextAssets in the game that are loaded on boot in SetVariables: </p> <ul> <li><code>Ressources/data/DiscoveryOrder</code></li> <li><code>Discoveries</code> from the corresponding dialogue directory of the current languageid</li> </ul>"},{"location":"TextAsset%20Data/Discoveries%20data/#discoveryorder-data","title":"<code>DiscoveryOrder</code> data","text":"<p>The asset contains one line per Discoveries entry which contains the ordered list of the entries shown in game where each entry is one line. Each line contains 2 fields separated by <code>,</code>:</p> Name Type Description Id Discoveries entry id The id this line refers to Icon int Index of the sprite in <code>Sprites/Items/EnemyPortraits</code> <p>The id is loaded into <code>libraryorder[0, id]</code>  and the icon is loaded into <code>discoveryicons[id]</code> where <code>id</code> is the Discoveries entry id.</p> <p>The ordering is managed by PauseMenu and the Library List Type.</p>"},{"location":"TextAsset%20Data/Discoveries%20data/#discoveries-language-specific-data","title":"<code>Discoveries</code> language specific data","text":"<p>The asset contains one line per Discoveries entry whose id corresponds to the line index. Each line contains 2 fields separated by <code>@</code>:</p> Loaded index Name Type Description 0 Name SetText string The name of the Discoveries entry 1 Description SetText string The paginated description of the Discoveries entry <p>The data will be loaded into <code>librarydata[0, id, x]</code> where <code>id</code> is the Discoveries entry id and <code>x</code> is the loaded index.</p> <p>The name of the entry is handled by the Library List Type, but the description has special handling in the pause menu. The string can contain <code>{</code> to delimit pages in that menu. The pause menu provides UI to only call SetText with the current page's text and a way to browse the different pages. </p> <p>It is also possible to conditionally decide to not render further pages by using <code>}flags}</code> as delimiter instead where <code>flags</code> is a flags slot that must be true to process any further pages. If it's false, the preceding page of the corresponding delimiter will be the last processed page. This allows to render further details only after progress has been done in the game.</p>"},{"location":"TextAsset%20Data/Enemies%20data/","title":"Enemies","text":"<p>Enemies data are split in 3 TextAssets in the game loaded on boot:</p> <ul> <li>By LoadEssentials:<ul> <li><code>Ressources/data/EnemyData</code></li> </ul> </li> <li>By SetVariables:<ul> <li><code>Ressources/data/TattleList</code></li> <li><code>EnemyTattle</code> from the corresponding dialogue directory of the current languageid</li> </ul> </li> </ul> <p><code>EnemyData</code> is also loaded on the Start and Update of the PauseMenu.</p>"},{"location":"TextAsset%20Data/Enemies%20data/#enemydata-data","title":"<code>EnemyData</code> data","text":"<p>The asset contains one line per enemy whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 0 battleentity.animid int The AnimID of the entity bound to this enemy (can be overriden if it's a variant, see the section below about it for details) 1 hp int The base max HP of the enemy (can be influenced by difficulty scaling, see the section below about it for details) 2 def int The base defense of the enemy (can be influenced by difficulty scaling, see the section below about it for details) 3 exp int The base amount of exploration points this enemy gives (can be overriden to 0 or be scaled by the instance.<code>partylevel</code>, see the section below about it for details) 4 money int The base amount of berries this enemy drops 5 cursoroffset.x float The x component of the offset to apply to the selection cursor upon targeting the enemy 6 cursoroffset.y float The y component of the offset to apply to the selection cursor upon targeting the enemy 7 cursoroffset.z float The z component of the offset to apply to the selection cursor upon targeting the enemy 8 poisonres int The base poison resistance of the enemy 9 freezeres int The base freeze resistance of the enemy 10 numbres int The base numb resistance of the enemy 11 sleepres int The base sleep resistance of the enemy 12 size float The width of the enemy used for calculating positioning 13 battleentity.freezesize.x float The x component of the ice cube size when the entity is frozen 14 battleentity.freezesize.y float The y component of the ice cube size when the entity is frozen 15 battleentity.freezesize.z float The z component of the ice cube size when the entity is frozen 16 battleentity.freezeoffset.x float The x component of the ice cube offset from the entity's center when the entity is frozen 17 battleentity.freezeoffset.y float The y component of the ice cube offset from the entity's center when the entity is frozen 18 battleentity.freezeoffset.z float The z component of the ice cube offset from the entity's center when the entity is frozen 19 position <code>BattlePosition</code> (string or int) The starting battle position of the enemy on the battle field (<code>Random</code> has special logic, see the special fields logic section below for details) 20 battleentity.height float The <code>height</code> of the entity, If the position is <code>Flying</code> and the value is below 2.0, it is overriden to 2.0 21 battleentity.bobspeed float The <code>bobspeed</code> of the entity 22 battleentity.bobrange float The <code>bobrange</code> of the entity 23 weakness <code>{</code> separated list of AttackProperty (int or string) The list of AttackProperty that applies to this enemy 24 weight float A visual modifier that controls if and how much the enemy can get launched if attacked, should be between 0.0 (furthest launch) and 100.0 (no launch) 25 Base Enemy id (loaded as animid) int The Enemy id that this is a variant of (see the section below about enemy variant for details), can be omitted if it's a negative number 26 eventondeath int The EventDialogue to trigger when the enemy dies as detected by CheckDead, can be ommited if it's -1 27 moves int The amount of actor turn the enemy has normally each main turn during the enemy phase 28 notaunt bool Tells if the enemy can't receive the Taunted condition by using the <code>Taunt</code> skill 29 cantfall bool Tells if the enemy cannot drop or have its position set to <code>Ground</code> 30 fixedexp bool Tells if the exp field should not be scaled and is a fixed number (see the section below about EXP for details) 31 notired bool Tells if exhaution increases won't happen if they were set to happen normally (with caveats, check the documentation of the feature to learn more) 32 hidehp bool Tells if the <code>hp</code> and <code>def</code> stats of the enemy should not be shown even after spying 33 deathtype int The manner in which the enemy dies (This isn't a <code>DeathType</code>, more on the feature's documentation) 34 chargeonotherenemy <code>;</code> separated list of int or <code>-1</code> or empty The list of enemy ids that will cause this enemy to perform a hitaction when any enemy id in that list takes damages in the player phase. See the feature's documentation to learn more. This field also has special loading logic, check the section below for more details 35 hardatk int The amount to increase the attack on Hard Mode or EX (see the section below about difficulty scaling for details). Not loaded if the hard difficulty scaling doesn't apply and the value remains at 0 36 int The base amount to increase the max HP on Hard Mode, EX or HARDEST (this is NOT <code>hardhp</code> which stays at 0 and is UNUSED). See the section below about difficulty scaling for details 37 int The base amount to increase the defense on Hard Mode, EX or HARDEST (this is NOT <code>hardef</code> which stays at 0 and is UNUSED). See the section below about difficulty scaling for details 38 defenseonhit int The amount of point of defenses granted to the enemy when <code>isdefending</code> is true (check the feature's documentation to learn more) 39 itemoffset.x float The x component of the offset to render an item relative to the enemy 40 itemoffset.y float The y component of the offset to render an item relative to the enemy 41 itemoffset.z float The z component of the offset to render an item relative to the enemy 42 bool If true, the battleentity.<code>basestate</code> is set to 13 (<code>BattleIdle</code>) 43 Portrait sprite index int Index of the sprite in <code>Sprites/Items/EnemyPortraits</code> (if this is negative, this defaults to the enemy id, see the GetEnemyPortrait section below about this for more details) 44 notattle bool Tells if the enemy is not spy-able. Check the feature's documentation for more details. This fields also has special loading logic that can override it to true, check the section below for more detials 45 eventonfall int The EventDialogue to trigger when the enemy drops, can be ommited if it's -1 46 onhitaction int If 1, the enemy will process a hitaction when hit. If 2, it will only when its position is <code>Flying</code> and if 3, it will only when its <code>position</code> is <code>Ground</code> 47 actimmobile bool Prevent <code>cantmove</code> to be anything higher than 0 or IsStopped to return true as a result of being inflicted with a stopping condition. This works for most, but not all cases, check the feature's documentation to learn more 48 sizeonfreeze float The size of the enemy on freeze. If the value is less than 0.1, it is be overriden to <code>size</code> + 0.25, check the feature's documentation to learn more <p>The data will be loaded by into <code>enemydata[id, x]</code>, where <code>id</code> is the enemy id and <code>x</code> is the loaded index. On the pause menu, every lines is loaded into <code>enemydata</code> all at once, but the meanings do not change.</p>"},{"location":"TextAsset%20Data/Enemies%20data/#getenemydata","title":"GetEnemyData","text":"<p>While the data loading happens in <code>LoadEssentials</code>, the actual parsing and usage of it is done by another method called <code>GetEnemyData</code>. It receives an enemy to obtain the data, a bool called createentity that tells whether or not the <code>battleentity</code> should be created too and a bool called noexp that disallows any positive numbers to be set to <code>exp</code>. This returns a <code>BattleData</code> containing all the informations of the enemy. </p> <pre><code>public static BattleData GetEnemyData(int id, bool createentity, bool noexp)\n</code></pre> <p>All <code>battleentity</code> fields are loaded only when the createentity parameter is true. When that happens, <code>battleentity</code> will be created via CreateNewEntity with name <code>enemyX</code> where X is the enemy id with dummy animid and position (animid 0 which is <code>Bee</code> and position (0.0, -10.0, 0.0)) as those can be overriden later.</p>"},{"location":"TextAsset%20Data/Enemies%20data/#enemy-variant","title":"Enemy variant","text":"<p>The base Enemy id field uses a feature to redirect most of the fields loaded to be the ones belonging to another enemy entirely. It is used to add an enemy variant which only shares some fields with its base enemy, but it has its own id. It also has the effect of overriden the <code>animid</code> field to be the base enemy id instead. Here are the list of fields that are shared:</p> <ul> <li><code>eventondeath</code></li> <li><code>battleentity.height</code></li> <li><code>battleentity.bobspeed</code></li> <li><code>battleentity.bobrange</code></li> <li><code>moves</code></li> <li><code>notaunt</code></li> <li><code>cantfall</code></li> <li><code>notired</code></li> <li><code>fixedexp</code></li> <li><code>position</code></li> </ul> <p>There are however some fields that are excluded from this if the createentity is true and the original Enemies id is <code>FireKrawler</code>, <code>FireWarden</code>, <code>FireCape</code>, <code>IceKrawler</code> or <code>IceWarden</code>. They will load the following fields from their base entry (<code>Krawler</code>, <code>Warden</code> or <code>CursedSkull</code>) instead on top of the standard variant system:</p> <ul> <li><code>moves</code></li> <li><code>notaunt</code></li> <li><code>cantfall</code></li> <li><code>notired</code></li> <li><code>fixedexp</code></li> <li><code>position</code></li> </ul> <p>Every other loading logic or fields will be loaded as if it was the enemy of the corresponding base Enemy id. This imply that every other field of the actual enemy will be ignored and they can be left as dummy values.</p>"},{"location":"TextAsset%20Data/Enemies%20data/#battleentity-special-initialisation","title":"BattleEntity special initialisation","text":"<p>When createentity is true, on top of actually creating the entity and setting it to the <code>battleentity</code> field, the entity itself has special logic when it comes to initialise it. This section will only mention anything that's outside the scope of loading a data field:</p> <ul> <li><code>battleentity.overridejump</code> is set to true</li> <li><code>battleentity.battle</code> is set to true</li> <li><code>battleentity.alwaysactive</code> is set to true</li> <li><code>battleentity.onground</code> is set to true</li> <li>If this enemy hasn't been seen while the map is <code>CaveOfTrials</code> or it's a <code>TANGYBUG</code> or the enemy is <code>FireKrawler</code>, <code>FireCape</code> or <code>FireWarden</code> while flag 664 is false (not yet approached the oven during Chapter 7), the following happens (this can have an impact on the <code>exp</code> field of the <code>BattleData</code>, see the section below for more details):<ul> <li><code>battleentity.name</code> gets prepended with the <code>COT</code> Modifier</li> <li><code>battleentity.hologram</code> is set to true</li> <li><code>battleentity.cotunknown</code> is set to true</li> <li>RefreshCOT is invoked in 0.1 seconds on the <code>battleentity</code></li> </ul> </li> <li><code>battleentity.tag</code> is set to <code>Enemy</code></li> <li><code>battleentity.gameObject.layer</code> is set to 9 (<code>Follower</code>)</li> <li><code>entity</code> is set to the <code>battleentity</code></li> <li>If the <code>position</code> is <code>Flying</code> and <code>battleentity.height</code> is below 2.0, <code>battleentity.height</code> is overriden to 2.0</li> <li><code>battleentity.initialheight</code> is set to <code>battleentity.height</code></li> <li>CreateHPBar is called on the entity</li> <li><code>battleentity.emoticonoffset</code> is set to the <code>cursoroffset</code></li> <li>If the <code>position</code> is <code>Underground</code>:<ul> <li>InstantDig is called on the <code>battleentity</code></li> <li><code>battleentity.height</code> and <code>battleentity.initialheight</code> are set to 0.0</li> </ul> </li> <li>If the field 42 of <code>enemydata</code> is true, <code>battleentity.basestate</code> is set to 13 (<code>BattleIdle</code>)</li> </ul> <p>After this, the <code>entity.destroytype</code> gets mapped to a DeathType depending on the value of the <code>BattleData</code>'s deathtype (this also changes the <code>battleentity</code>'s because they hold the same reference).</p>"},{"location":"TextAsset%20Data/Enemies%20data/#exp-logic","title":"Exp logic","text":"<p>The <code>exp</code> field has particularily complex logic to determine its value:</p> <ul> <li>It is always 0 if the sent noexp value is true</li> <li>It is left at the default value of 0 if instance.<code>partylevel</code> is at least 27 (it's maxed) or if flag 613 is true (RUIGEE is active)</li> <li>If the <code>fixedexp</code> field is true, then the amount is always the raw one coming from <code>enemydata</code> with no modifications to it</li> <li>If none of the cases above applied, the result is the return of MainManager.GetEXP with the <code>exp</code> field from <code>enemydata</code>, the instance.<code>partylevel</code> and the enemy id (the base id if it's a variant)</li> </ul> <p>The return of MainManager.GetEXP implies even more logic where the base <code>exp</code> field can be changed. Here is the process used to calculate the final value:</p> <ol> <li>The base EXP amount is determined. It's the same than the sent exp value unless the enemy is a <code>WaspTrooper</code> or <code>WaspHealer</code> which can increase this value:<ul> <li>If the current map is <code>MetalLake</code> or the area is <code>WaspKingdom</code>, the value is multiplied by 1.65 and then ceiled</li> <li>Otherwise, if the current area is <code>RubberPrison</code>, the value is multiplied by 2.5 ceiled. On top of this, if it's a <code>WaspHealer</code>, 10 is added to the amount</li> </ul> </li> <li>The value gets multiplied by map.<code>expmulti</code> which is a field that must be defined on the map's prefab. The result isn't rounded yet</li> <li>The value gets subtracted by (level - 1) * 2.5 and the result is clamped from 1.0 to 99.0 then floored</li> <li>The now integer value is decremented and returned</li> </ol> <p>Additionally, GetEnemyData can also change yet again the value after it was calculated in 2 special cases (they both can happen and stack and they can happen regardless of how the initial <code>exp</code> value was determined):</p> <ol> <li>flag 162 is true (during a B.O.S.S or Cave Of Trials session): the value gets multiplied by 0.2, floored and then clamped from 0 to 5</li> <li>createentity is true, flag 166 is false (EX mode isn't active on the B.O.S.S. system) and the <code>battleentity</code> is a <code>hologram</code> (see the section above about the <code>battleentity</code> initialisation for when this happens): the value is multiplied by 0.1 and floored</li> </ol> <p>Then, StartBattle can further change the <code>exp</code> If all of the following conditions are true:</p> <ul> <li>The enemy is a <code>Krawler</code>, <code>CursedSkull</code> or <code>Cape</code></li> <li>battleentity.<code>forcefire</code> is true or we are in the <code>GiantLair</code> area except for the <code>GiantLairFridgeInside</code> map</li> <li>instance.<code>partylevel</code> is less than 27 (meaning it's not maxed)</li> <li>flags 613 is false (RUIGEE is inactive)</li> </ul> <p>If that happens, the <code>exp</code> is incremented by the floored result of a lerp from 10.0 to 3.0 with a factor of instance.<code>partylevel</code> / 27.0</p> <p>Finally, while all of the above describes the <code>exp</code> field itself, CheckDead calls BattleControl.GetEXP (not to be confused with MainManager.GetEXP) to determine the rewarded exp amount. This method contains further special logic where it receives the <code>exp</code> and <code>fixedexp</code> fields of the enemy as well as its enemy id. Here's what the method does:</p> <ul> <li>If flags 613 is true (RUIGEE is active) or <code>partylevel</code> is 27 (max rank), the return is 0 (effectively disables all exp gains to the player)</li> <li>Otherwise:<ul> <li>If the <code>DoublePain</code> medal is equipped or flags 614 is true (HARDEST is active), <code>exp</code> increases by (<code>exp</code> * 0.15 ceiled which is basically 15% ceiled)</li> <li>If the <code>EXPBoost</code> medal is equipped, <code>exp</code> increases by (<code>exp</code> * 0.50 ceiled which is basically 50% ceiled)</li> <li>A result is determined from there (only the first one that applies is returned):<ul> <li>If Flags 166 is true (during a B.O.S.S session in EX mode), the return is <code>exp</code> clamped from 0 to 5</li> <li>Otherwise, if <code>fixedexp</code> is true, <code>exp</code> is returned without any clamping</li> <li>Otherwise, if the enemy is among ChomperBrute, ToeBitter, DeadLanderA, DeadLanderB or DeadLanderG, the return is <code>exp</code> clamped from 0 to 20</li> <li>Otherwise (neither of the above applied), the return is clamped from 0 to 15</li> </ul> </li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Enemies%20data/#special-fields-logic","title":"Special fields logic","text":"<p>Additionally, some BattleData fields have special logic attached to them:</p> <ul> <li><code>entityname</code>: See the section about <code>EnemyTattle</code> below</li> <li><code>holditem</code>: always set to -1</li> <li><code>chargeonotherenemy</code>: The value depends on the loaded data:<ul> <li>If it's <code>-1</code>, the value is an empty array</li> <li>If it's empty, the value is null</li> <li>If it's a <code>;</code> separated list of enemy ids, each element will be converted to int and the value will be that array, but for any element that's empty in that list, the element will be -1 instead</li> </ul> </li> <li><code>notattle</code>: If the loaded data value is false, it will still be overriden to true if any of these is true:<ul> <li>This enemy hasn't been seen while the map is <code>CaveOfTrials</code></li> <li>createentity is true and this is a <code>FireKrawler</code>, <code>FireCape</code> or <code>FireWarden</code> enemy while flag 664 is false (not yet approached the oven during Chapter 7)</li> </ul> </li> <li><code>sizeonfreeze</code> If the loaded value is less than 0.1, it will be overriden to <code>size</code> + 0.25</li> <li><code>hardatk</code>, <code>hp</code> and <code>def</code>: See the section below detailing how enemy stats difficulty scaling works</li> <li><code>maxhp</code>: Always set to <code>hp</code> after it was calculated post difficulty scaling</li> <li><code>position</code>: If its value is Random, then it will be determined randomly and uniformly between Ground and Flying, but there's an exception if the enemy is a <code>Mushroom</code> and flag 24 is true (received the Turn Relay tutorial) in which case, the position field is Flying</li> <li><code>entity</code>: If createentity is true, this is set to the <code>battleenentity</code> being created</li> <li><code>condition</code>: Always set to a new list</li> <li><code>cantmove</code>: Always set to -<code>moves</code> + 1 which gives it <code>moves</code> amount of actions available</li> <li><code>harddef</code> and <code>hardhp</code>: These fields are practicaly unused because they always have a value of 0 which doesn't have any impact in the game</li> </ul>"},{"location":"TextAsset%20Data/Enemies%20data/#stats-difficulty-scaling","title":"Stats difficulty scaling","text":"<p>There are some fields in enemy data that are influenced by the different difficulty tiers the game has. This only happens if any of the following is true:</p> <ul> <li>The <code>DoublePain</code> Medal is equipped</li> <li>Flags 614 is true (HARDEST is active)</li> <li>Flags 166 is true (EX mode is active on the B.O.S.S. system)  </li> </ul> <p>If the above is met, it will always have the following effect:</p> <ul> <li><code>hardatk</code>: Set to the loaded data value (this is left at 0 if hard scaling didn't apply in the first place)</li> <li><code>hp</code>: Increased by <code>enemydata</code> field 36</li> <li><code>def</code>: Increased by <code>enemydata</code> field 37</li> </ul> <p>On top of this, if HARDEST was active, the following applies after:</p> <ul> <li><code>hardatk</code>: Gets incremented</li> <li><code>hp</code>: Gets increased by 15% then ceiled</li> <li><code>def</code>: If flags 300 is true (Chapter 4 started) and the existing <code>def</code> wasn't negative, it gets incremented</li> </ul> <p>On top of this, if EX mode is active on the B.O.S.S. system, then there are additional effects after everything if the enemy isn't <code>WaspGeneral</code>, <code>KeyR</code>, <code>KeyL</code> or <code>Tablet</code>:</p> <ul> <li><code>hardatk</code>: Gets increased by 15% ceiled</li> <li><code>hp</code>: Gets increased by 15% ceiled. If the result ends up above 90, it is then decreased by 15% ceiled.</li> <li><code>def</code>: Gets clamped from 1 to 99</li> </ul>"},{"location":"TextAsset%20Data/Enemies%20data/#getenemyportrait","title":"GetEnemyPortrait","text":"<p>This field is loaded, but never written to. Its only usage is in the GetEnemyPortrait method which by default returns the value directly (or the enemy id if the value is negative).</p> <p>However, the return can be overridden to 225 for a <code>Cape</code>, 226 for a <code>Krawler</code> and 227 for a <code>CursedSkull</code> if flag 664 is true (approached the oven during Chapter 7). This overrides the portrait sprite to include the fire variants of the enemy under this condition.</p>"},{"location":"TextAsset%20Data/Enemies%20data/#enemytattle-data","title":"<code>EnemyTattle</code> data","text":"<p>The asset contains one line per Enemy whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 0 Name SetText string The name of the enemy 1 Biography SetText string The biography of the enemy 2 Vi's spy SetText string Vi's Spy dialogue 3 Kabbu's spy SetText string Kabbu's Spy dialogue 4 Leif's spy SetText string Leif's Spy dialogue <p>The data will be loaded into <code>librarydata[1, id, x]</code> where <code>id</code> is the Enemy id and <code>x</code> is the loaded index. The name is also loaded into <code>enemynames</code>.</p> <p>Enemies not meant to have a Bestiary entry by convention have only the name field defined and the rest are dummy fields. The biography's dummy value is typically \"biotattle\" as well as the spy text fields being \"beetattle\", \"beetletattle\" and \"mothtattle\" respectively.</p> <p>During <code>GetEnemyData</code>, the typical <code>entityname</code> value is the one loaded into <code>enemynames</code> but it will be menutext 59 (?????) during Cave Of Trials for an unseen enemy or if createentity is true and the enemy is <code>FireKrawler</code>, <code>FireCape</code> or <code>FireWarden</code> while flag 664 is false (not yet approached the oven during Chapter 7).</p>"},{"location":"TextAsset%20Data/Enemies%20data/#tattlelist-data","title":"<code>TattleList</code> data","text":"<p>The asset contains the order to render the Bestiary entry in the Library List Type where each line contains one field:</p> Name Type Description Enemy id int The Enemies id of the enemy to render at the position of the line index <p>The data will be loaded into <code>libraryorder[1, i]</code> where i is the line index.</p>"},{"location":"TextAsset%20Data/Entity%20data/","title":"Entity data","text":"<p>Entity data are split into 2 TextAssets in the game loaded on boot:</p> <ul> <li><code>Resources/data/EntityValues</code></li> <li>The <code>Resources/data/entitydata</code> directory</li> </ul>"},{"location":"TextAsset%20Data/Entity%20data/#animid-data","title":"animid data","text":"<p>The TextAsset <code>Resources/data/EntityValues</code> from the root of the asset tree contains data that apply to every entities of a given AnimID. Each line id of the data corresponds to the matching AnimID. The data is loaded on boot during LoadEssentials in the <code>endata</code> static field of MainManager. The field is an array of struct of type <code>Entity_Data</code>.</p> <p>NOTE: This asset uses the enum form of the AnimIDs, NOT the int form which means the first line represents <code>None</code>.</p>"},{"location":"TextAsset%20Data/Entity%20data/#a-word-on-the-assets-format","title":"A word on the asset's format","text":"<p>This format is very unique in the game: it is not encoded in a similar fashion than other TextAssets in the game. Here is how the data is serialiazed:</p> <ul> <li>The fields are split by <code>,</code></li> <li>Every primitives types are encoded as normal (int, float, string, boolean, etc...)</li> <li>A <code>Vector3</code> is NOT encoded using 3 fields. It is encoded using 1 field with the format <code>(x, y, z)</code> where <code>x</code>, <code>y</code> and <code>z</code> are the floats of the vector. Note that the inner separators are expected: the parser will expect the parenthesizes delimiters to know this is parsed differently.</li> <li>An empty string is an empty field.</li> </ul>"},{"location":"TextAsset%20Data/Entity%20data/#textasset-and-entity_data-layout","title":"TextAsset and <code>Entity_Data</code> layout","text":"<p>Here is the layout of the data and the fields associated with this struct (NOTE: the position is given according to the TextAsset which means <code>Vector3</code> are treated as one position):</p> Position Description Type Additional information 0 shadowsize float The default value is 1.0 if the AnimIDs is higher than the max line id contained in the asset 1 startscale Vector3 The default value is Vector3.one if the AnimIDs is higher than the max line id contained in the asset 2 bleeppitch float The default value is 1.0 if the AnimIDs is higher than the max line id contained in the asset. See bleep to learn more 3 bleepid int See bleep to learn more 4 ismodel bool See AddModel to learn more 5 modelscale Vector3 See AddModel to learn more 6 modeloffset Vector3 See AddModel to learn more 7 freezesize Vector3 8 freezeoffset Vector3 9 freezeflipoffset Vector3 10 preloaddata string[] The strings are split by <code>?</code>, can be left empty in which case, the array is left to <code>null</code>. The strings represents asset paths relative from the Asset directory. A <code>$</code> prefix means to not preload outside of battle while a <code>$</code> indicate it is a sprite instead of a game object from a prefab 11 shakeondrop bool 12 diganim bool 13 dontoverridejump bool 14 freezenofall bool 15 noshadow bool 16 walktype WalkType Encoded in its int form, see below for the possible values 17 basestate int This field is loaded, but not used. A value must still be provided or an exception will be thrown. 18 basewalk int This field is loaded, but not used. A value must still be provided or an exception will be thrown. 19 minheight float 20 startheight float This field is loaded, but not used. A value must still be provided or an exception will be thrown. 21 startbobspd float 22 startbobfreq float 23 hasiceanim bool 24 noflyanim bool This field is optional, it can be omitted which leaves a default value of false 25 forceshadow bool This field is optional, it can be omitted which leaves a default value of false 26 Object bool This field is optional, it can be omitted which leaves a default value of false <p>NOTE: Fields 24, 25 and 26 must be omitted TOGETHER if any are to be omitted. Failure to do so will result in an exception to be thrown when parsing the asset.</p>"},{"location":"TextAsset%20Data/Entity%20data/#walktype-values","title":"WalkType values","text":"<p>Here are the possible values for a WalkType enum value:</p> Value Name 0 Normal 1 Jump <p>The only thing this field does is if it's <code>Jump</code>, Move will have the entity continuously jump when it can during the movement.</p>"},{"location":"TextAsset%20Data/Entity%20data/#map-entity-data","title":"Map entity data","text":"<p>The <code>entitydata</code> directory contains the names and details that applies to each specific entities that should be loaded upon a specific Map load. The data only gets loaded during MapControl's CreateEntities for the concerned Maps which happens on the MapControl's Start. The data ends up in the <code>entities</code> field of the MapControl which is an array of EntityControl and each index of that array ends up in the npcdata.<code>mapid</code> field of each NPCControl. The loaded data ends up in <code>endata</code> and it is possible to retrieve the fields later. This is how CheckSpecialID reads some of them.</p> <p>Each line of an entity map asset contains one line per entity. It contains fields about its EntityControl and its NPCControl (via the <code>npcdata</code> field) separated by <code>}</code>. Each asset corresponds to each map in the game where its asset's filename is the Map's id.</p> <p>The names of each entity are not contained in the data assets. They are contained in a <code>names</code> directory next to the data assets. An entity name asset contains one string per line that corresponds to the name of entity of the matching line in the matching data asset. The names asset filename is <code>Xnames</code> where X is the Map id.</p> <p>This gives the following layout:</p> <ul> <li>Path to the entity data files: <code>Resources/data/entitydata</code></li> <li>Path to the entity name files: <code>Resources/data/entitydata/names</code></li> </ul> <p>The name of an entity can contain special strings to act as modifiers on it which means the name is both used for debugging purposes as well as to modify its behavior.</p>"},{"location":"TextAsset%20Data/Entity%20data/#entity-data-file-fields","title":"Entity Data File Fields","text":"<p>While a lot of these fields have shared meanings, a lot are dependant of the specifics of the NPCControl (for example, the <code>data</code> fields completely changes between them). It is recommended to check the NPCControl documentation to understand where each field is used in what circumstances. The EntityControl fields however tends to remain shared.</p> Position Description Type Additional information 0 npcdata.entitytype NPCControl.NPCType 1 npcdata.objecttype NPCControl.ObjectTypes 2 npcdata.behaviors[0] NPCControl.ActionBehaviors 3 npcdata.behaviors[1] NPCControl.ActionBehaviors 4 npcdata.interacttype NPCControl.Interaction If it's Shop, this tells the game to build a shop system 5 destroytype NPCControl.DeathType Used in Death to determine how to destroy the entity 6 startpos.x float 7 startpos.y float 8 startpos.z float 9 animid int This is the item type for an Item object 10 flip bool 11 ccol.height float 12 ccol.radius float Also assigned to npcdata.colliderheight 13 npcdata.radius float Regulates how close the player needs to be to become <code>inrange</code> which affects behaviors and interactions 14 npcdata.timer float For a lot of objects, this is a timer in frame that when expired, Death is called on the entity. -1 means to not have a timer 15 speed float 16 npcdata.actionfrequency[0] float 17 npcdata.actionfrequency[1] float 18 npcdata.speedmultiplier float 19 npcdata.radiuslimit float The radius the entity can be in and will not go outside of it in multiple cases 20 npcdata.wanderradius float For a Wander behavior or derivative, this is the radius the entity can move to between wanders 21 npcdata.teleportradius float For a Wander behavior or derivative, this is the radius the entity can teleport to in the case of a failsafe situation 22 NPCControl has a BoxCollider? bool 23 npcdata.boxcol.isTrigger bool Requires field at position 22 to be true 24 npcdata.boxcol.size.x float Requires field at position 22 to be true 25 npcdata.boxcol.size.y float Requires field at position 22 to be true 26 npcdata.boxcol.size.z float Requires field at position 22 to be true 27 npcdata.boxcol.center.x float Requires field at position 22 to be true 28 npcdata.boxcol.center.y float Requires field at position 22 to be true 29 npcdata.boxcol.center.z float Requires field at position 22 to be true 30 npcdata.freezetime float 31 freezesize.x float 32 freezesize.y float 33 freezesize.z float 34 freezeoffset.x float 35 freezeoffset.y float 36 freezeoffset.z float 37 npcdata.eventid int 38 Length of npcdata.requires int Maximum of 10 39-48 npcdata.requires int[] lists of flags slots that needs to be true for the entity to exist 49 Length of npcdata.limit int Maximum of 10 50-59 npcdata.limit int[] lists of flags slots that needs to be false for the entity to exist 60 Length of npcdata.data int Maximum of 10 61-70 npcdata.data int[] General purpose int array 71 Length of npcdata.vectordata int Maximum of 10 72-101 npcdata.vectordata Vector3[] General purpose triplets of floats array 102 Length of npcdata.dialogues int Maximum of 20 103-162 npcdata.dialogues Vector3[] For an NPC, consult the documentation of GetDialogue to learn how this array is managed 163 transform.eulerAngles.x float 164 transform.eulerAngles.y float 165 transform.eulerAngles.z float 166 Length of npcdata.battleids int Maximum of 4 167-170 npcdata.battleids int[] For an Enemy, this is the list of enemy id the encounter consists of 171 npcdata.tagcolor.r float Doesn't affect gameplay, only used in the Unity editor 172 npcdata.tagcolor.g float Doesn't affect gameplay, only used in the Unity editor 173 npcdata.tagcolor.b float Doesn't affect gameplay, only used in the Unity editor 174 npcdata.tagcolor.a float Doesn't affect gameplay, only used in the Unity editor 175 emoticonoffset.x float 176 emoticonoffset.y float 177 emoticonoffset.z float 178 npcdata.insideid int The interior id of the map the entity starts in 179-188 npcdata.emoticonflag string[10] See CheckEmoteFlag 189 npcdata.tattleid int The dialogue line id corresponding to tattling the NPCControl 190 npcdata.regionalflag int The Regionalflags slot bound to this entity 191 initialheight float 192 bobrange float 193 bobspeed float 194 npcdata.activationflag int The flag slot bound to this entity 195 npcdata.returntoheight bool or int Int if the length in string is 1, bool otherwise"},{"location":"TextAsset%20Data/Fortune%20Teller%20data/","title":"Fortune teller data","text":"<p>Musics data are split in 3 TextAssets in the game loaded in Event 71 (talking to the Fortune Teller) and located in the corresponding dialogue directory of the current languageid:</p> <ul> <li><code>FortuneTeller0</code></li> <li><code>FortuneTeller1</code></li> <li><code>FortuneTeller2</code></li> </ul>"},{"location":"TextAsset%20Data/Fortune%20Teller%20data/#fortuneteller0-data","title":"<code>FortuneTeller0</code> data","text":"<p>The asset contains one line per crystalbfflags slot which contains 1 field per line:</p> Name Type Description Hint SetText string The hint given for the corresponding crystalbfflags <p>The hint is selected randomly among every crystalbfflags slots whose value is false. None is given if all of them are true.</p>"},{"location":"TextAsset%20Data/Fortune%20Teller%20data/#fortuneteller1-data","title":"<code>FortuneTeller1</code> data","text":"<p>The asset contains one line per Lore Book which contains 1 field per line:</p> Name Type Description Hint SetText string The hint given for the corresponding Lore Book <p>Each Lore Book is expected to be bound to a specific flag slot which are hardcoded. Here are the flags slots expected for each line index:</p> Line Flags slot 0 71 1 87 2 142 3 271 4 331 5 380 6 381 7 388 8 392 9 455 10 460 11 463 12 200 13 243 14 55 15 469 16 471 17 486 18 468 19 488 20 489 21 498 22 499 23 578 24 604 25 603 <p>The hint can only be selected if the flag slot is false. No hints will be given if they are all true.</p>"},{"location":"TextAsset%20Data/Fortune%20Teller%20data/#fortuneteller2-data","title":"<code>FortuneTeller2</code> data","text":"<p>The asset contains one line per Medal that has a hint which contains 1 field per line:</p> Name Type Description Hint SetText string The hint given for the corresponding Medal <p>Each of these hints is expected to be a Medal bound to a specific flag slot which are hardcoded. Here are the flags slots expected for each line index:</p> Line Flags slot 0 338 1 121 2 230 3 137 4 611 5 462 6 220 7 149 8 415 9 285 10 355 11 534 12 575 13 42 14 23 15 60 <p>The hint can only be selected if the flag slot is false. No hints will be given if they are all true.</p>"},{"location":"TextAsset%20Data/Items%20data/","title":"Items","text":"<p>Items data are split in 2 TextAssets in the game loaded on boot by SetVariables: </p> <ul> <li><code>Ressources/data/ItemData</code></li> <li><code>Items</code> from the corresponding dialogue directory of the current languageid</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#itemdata","title":"<code>itemdata</code>","text":"<p>The asset contains one line per Item whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 4 Value int The buying price of the item in berries (the selling price is half of it) 5 Effects <code>;</code> separated list of ItemUse The list of effects this item has (see below for details) 6 Target AttackArea The target this item can be used on <p>The data will be loaded into <code>itemdata[0, id, x]</code> where <code>id</code> is the Item id and <code>x</code> is the loaded index. It should be noted that the id dimension of the array is overprovisioned to exactly 256 elements, this is hardcoded. The first dimension is hardcoded to only have one element, this is also hardcoded.</p> <p>The attack area must be specified as a string or int representation of an AttackArea enum value. Here are the valid values, anything else is considered invalid:</p> Value Name 0 SingleEnemy 1 AllEnemy 2 SingleAlly 3 AllParty 4 All 5 None 6 User <p>An ItemUse is defined by 2 fields separated by <code>,</code>:</p> Name Type Description usetype ItemUsage The effect the item has value int A value that influences the usetype (usually amount or amount of turns) <p>The usetype must be specified as a string or int representation of an ItemUsage enum value. Here are the valid values, anything else is considered invalid:</p> Value Name 0 None 1 HPRecover 2 TPRecover 3 HPRecoverAll 4 HPRecoverFull 5 TPRecoverFull 6 HPUP 7 TPUP 8 AttackUp 9 DefenseUp 10 Battle 11 Revive 12 ReviveAll 13 AutoRevive 14 CurePoison 15 CureFreeze 16 CureNumb 17 CureSleep 18 CureParty 19 AddPoison 20 AddSleep 21 AddNumb 22 AddFreeze 23 HPto1 24 TPto1 25 HPto1All 26 GradualHP 27 GradualTP 28 GradualHPParty 29 DefUpStat 30 AtkUpStat 31 Sturdy 32 HPUPAll 33 MPUP 34 ChargeUp 35 AtkDownAfter 36 CureFire 37 CureAll 38 TurnNextTurn 39 HPorDamage 40 CurePoisonAll"},{"location":"TextAsset%20Data/Items%20data/#doitemeffect","title":"DoItemEffect","text":"<p>The ItemUse effects are applied in a static method on MainManager called DoItemEffect which applies no matter how the items was used (out or in battle). There are extra logic in battle managed by UseItem.</p> <pre><code>public static int DoItemEffect(ItemUsage type, int value, int? characterid)\n</code></pre> <p>The type and value comes from the ItemUse and the characterid is the <code>playerdata</code> index that is using the item. While the characterid is nullable, in practice, null is never sent and sending it leads to an exception being thrown the vast majority of the time.</p> <p>Once the effect is applied, if <code>battle</code> is not null (a battle is in progress), UpdateConditionIcons is called on it which calls UpdateConditionBubbles on all battleentity (all <code>playerdata</code> with right to false and all <code>enemydata</code> with <code>hp</code> above 0 with right to true). Finally, the method returns the final value (which may be changed by the effects).</p> <p>Here's all the ItemUsage's effects from this method:</p>"},{"location":"TextAsset%20Data/Items%20data/#hprecover-or-revive","title":"<code>HPRecover</code> or <code>Revive</code>","text":"<ul> <li>The <code>Heal</code> sound is played</li> <li>If we are instance.<code>inbattle</code>, value is incremented by the amount of <code>HealPlus</code> medal equipped on <code>lastitemuser</code></li> <li>The <code>hp</code> of the characterid player party member is increased by value then clamped from 0 to its <code>maxhp</code></li> <li>If we are instance.<code>inbattle</code> and the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#hpordamage","title":"<code>HPorDamage</code>","text":"<ul> <li>If <code>battle</code> is null (no battle is in progress):<ul> <li>value is incremented by the amount of <code>HealPlus</code> medal equipped on <code>lastitemuser</code></li> <li>An RNG check is performed with 2 possible outcomes at 59% and 41% respectively:<ul> <li>59%: The <code>Heal</code> sound is played followed by the <code>hp</code> of the characterid player party member being increased by value then clamped from 0 to its <code>maxhp</code></li> <li>41%: The <code>Damage0</code> sound is played followed by the <code>hp</code> of the characterid player party member being decreased by value then clamped from 1 to its <code>maxhp</code></li> </ul> </li> </ul> </li> <li>If we are instance.<code>inbattle</code> and the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#hprecoverall","title":"<code>HPRecoverAll</code>","text":"<ul> <li>The <code>Heal</code> sound is played</li> <li>If we are instance.<code>inbattle</code>, value is incremented by the amount of <code>HealPlus</code> medal equipped on <code>lastitemuser</code></li> <li>For each player party member that isn't <code>eatenby</code> with an <code>hp</code> above 0:<ul> <li>The <code>hp</code> of the player party member is increased by value then clamped from 0 to its <code>maxhp</code></li> <li>If we are instance.<code>inbattle</code> and the <code>WeakStomach</code> medal is equipped on the player party member, an <code>AddPoison</code> effect is processed with the corresponding characterid being the player party member's. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#reviveall","title":"<code>ReviveAll</code>","text":"<p>The same then <code>HPRecoverAll</code>, but the player party members don't need an <code>hp</code> above 0 for the effects to apply.</p>"},{"location":"TextAsset%20Data/Items%20data/#tprecover","title":"<code>TPRecover</code>","text":"<ul> <li>The <code>Heal2</code> sound is played</li> <li>instance.<code>tp</code> is increased by value then clamped from 0 to instance.<code>maxtp</code></li> <li>If we are instance.<code>inbattle</code> and the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#turnnextturn","title":"<code>TurnNextTurn</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>If we are instance.<code>inbattle</code>, the <code>moreturnnextturn</code> of the characterid player party member is incremented</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#hpup","title":"<code>HPUP</code>","text":"<ul> <li>The <code>StatUp</code> sound is played</li> <li>An <code>HP</code> stat bonus with the amount being the value is added to the characterid player party member (learn more here)</li> <li>ApplyStatBonus is called</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#tpup","title":"<code>TPUP</code>","text":"<ul> <li>The <code>StatUp</code> sound is played</li> <li>An <code>TP</code> stat bonus with the amount being the value is added to the party (learn more here)</li> <li>ApplyStatBonus is called</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#hpupall","title":"<code>HPUPAll</code>","text":"<ul> <li>The <code>StatUp</code> sound is played</li> <li>An <code>HP</code> stat bonus with the amount being the value is added to the party (learn more here)</li> <li>ApplyStatBonus is called</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#attackup","title":"<code>AttackUp</code>","text":"<ul> <li>The <code>StatUp</code> sound is played</li> <li>An <code>Attack</code> stat bonus with the amount being the value is added to the characterid player party member (learn more here)</li> <li>ApplyStatBonus is called</li> <li>If we are instance.<code>inbattle</code> and the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#atkdownafter","title":"<code>AtkDownAfter</code>","text":"<p>The <code>atkdownonloseatkup</code> of the characterid player party member is set to true</p>"},{"location":"TextAsset%20Data/Items%20data/#chargeup","title":"<code>ChargeUp</code>","text":"<ul> <li>The <code>charge</code> of the characterid player party member is incremented then clamped from 0 to 3</li> <li>If we are instance.<code>inbattle</code> and the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#defenseup","title":"<code>DefenseUp</code>","text":"<ul> <li>The <code>StatUp</code> sound is played</li> <li>An <code>Defense</code> stat bonus with the amount being the value is added to the characterid player party member (learn more here)</li> <li>ApplyStatBonus is called</li> <li>If we are instance.<code>inbattle</code> and the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#addpoison","title":"<code>AddPoison</code>","text":"<p>This effect only applies if we are instance.<code>inbattle</code> and the characterid player party member doesn't have the Sturdy condition</p> <ul> <li>The <code>Poison</code> sound is played</li> <li>If the characterid player party member doesn't have any <code>PoisonResistance</code> or <code>ResistAll</code> medals equipped:<ul> <li>SetCondition is called with the Poison condition on the characterid player party member for value amount of turns. The amount is overriden to 9999999 if the characterid player party member has an <code>EternalPoison</code> medals equipped and if not, it is increased by 1 if it has the <code>WeakStomach</code> medal equipped</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#addnumb","title":"<code>AddNumb</code>","text":"<p>This effect only applies if we are instance.<code>inbattle</code> and the characterid player party member doesn't have the Sturdy condition</p> <ul> <li>The <code>Shock</code> sound is played</li> <li>If the characterid player party member doesn't have any <code>NumbResis</code> or <code>ResistAll</code> medals equipped:<ul> <li>SetCondition is called with the Numb condition on the characterid player party member for value amount of turns</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#addfreeze","title":"<code>AddFreeze</code>","text":"<p>This effect only applies if we are instance.<code>inbattle</code> and the characterid player party member doesn't have the Sturdy condition</p> <ul> <li>The <code>Freeze</code> sound is played</li> <li>If the characterid player party member doesn't have any <code>FreezeResistance</code> or <code>ResistAll</code> medals equipped:<ul> <li>SetCondition is called with the Freeze condition on the characterid player party member for value amount of turns</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#addsleep","title":"<code>AddSleep</code>","text":"<p>This effect only applies if we are instance.<code>inbattle</code> and the characterid player party member doesn't have the Sturdy condition</p> <ul> <li>The <code>Sleep</code> sound is played</li> <li>If the characterid player party member doesn't have any <code>SleepyResistance</code> or <code>ResistAll</code> medals equipped:<ul> <li>SetCondition is called with the Sleep condition on the characterid player party member for value amount of turns</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#curefire","title":"<code>CureFire</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>RemoveCondition is called on the characterid player party member to remove the Fire condition</li> <li>If we are instance.<code>inbattle</code> and the characterid player party member's <code>firepart</code> isn't null, it is destroyed</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#cureall","title":"<code>CureAll</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>A bunch of RemoveCondition calls happens in sucession on the characterid player party member to remove the following condition:<ul> <li>Poison</li> <li>Sleep</li> <li>Freeze</li> <li>Numb</li> <li>Fire</li> <li>Inked</li> <li>Sticky</li> </ul> </li> <li>If we are instance.<code>inbattle</code>, the following happens on the characterid player party member:<ul> <li>If <code>firepart</code> isn't null, it is destroyed</li> <li>BreakIce is called on the battleentity</li> <li><code>isasleep</code> is set to false</li> <li><code>isnumb</code> is set to false</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#curepoisonall","title":"<code>CurePoisonAll</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>RemoveCondition is called on each of the player party members to remove the Poison condition</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#curepoison","title":"<code>CurePoison</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>RemoveCondition is called on the characterid player party member to remove the Poison condition</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#curesleep","title":"<code>CureSleep</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>The characterid player party member's <code>isasleep</code> is set to false</li> <li>RemoveCondition is called on the characterid player party member to remove the Sleep</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#curefreeze","title":"<code>CureFreeze</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>RemoveCondition is called on the characterid player party member to remove the Freeze</li> <li>If we are instance.<code>inbattle</code>, BreakIce is called on the battleentity of the characterid player party member</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#curenumb","title":"<code>CureNumb</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>The characterid player party member's <code>isnumb</code> is set to false</li> <li>RemoveCondition is called on the characterid player party member to remove the Numb</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#cureparty","title":"<code>CureParty</code>","text":"<ul> <li>The <code>Heal3</code> sound is played</li> <li>A bunch of RemoveCondition calls happens in sucession on each of the player party members that isn't <code>eatenby</code> with an <code>hp</code> above 0 to remove the following condition:<ul> <li>Poison</li> <li>Sleep</li> <li>Freeze</li> <li>Numb</li> <li>Fire</li> <li>Inked</li> <li>Sticky</li> </ul> </li> <li>If we are instance.<code>inbattle</code>, the following happens on each of the player party members:<ul> <li>If <code>firepart</code> isn't null, it is destroyed</li> <li>BreakIce is called on the battleentity</li> <li><code>isasleep</code> is set to false</li> <li><code>isnumb</code> is set to false</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#hpto1","title":"<code>HPto1</code>","text":"<ul> <li>If we aren't instance.<code>inbattle</code>, the <code>Damage0</code> sound is played</li> <li>The <code>hp</code> of the characterid player party member is set to 1</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#gradualhp","title":"<code>GradualHP</code>","text":"<ul> <li>If we are instance.<code>inbattle</code><ul> <li>The <code>Heal3</code> sound is played</li> <li>SetCondition is called to apply the GradualHP condition on the characterid player party member for value amount of turn</li> <li>If the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul> </li> <li>Otherwise, an <code>HPRecover</code> is processed with the same characterid, but the value is doubled</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#gradualhpparty","title":"<code>GradualHPParty</code>","text":"<ul> <li>If we are instance.<code>inbattle</code><ul> <li>The <code>Heal3</code> sound is played</li> <li>SetCondition is called to apply the GradualHP condition on each player party members that have an <code>hp</code> above 0 for value amount of turn</li> <li>If the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul> </li> <li>Otherwise, an <code>HPRecoverAll</code> is processed with the same characterid, but the value is doubled</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#gradualtp","title":"<code>GradualTP</code>","text":"<ul> <li>If we are instance.<code>inbattle</code><ul> <li>The <code>Heal3</code> sound is played</li> <li>SetCondition is called to apply the GradualTP condition on the characterid player party member for value amount of turn</li> <li>If the <code>WeakStomach</code> medal is equipped on the characterid player party member, an <code>AddPoison</code> effect is processed with the current value and characterid. The only difference is if <code>EternalPoison</code> isn's equipped, the amount of turn to apply the Poison condition is always 3</li> </ul> </li> <li>Otherwise, an <code>TPRecover</code> is processed with the same characterid, but the value is doubled</li> </ul>"},{"location":"TextAsset%20Data/Items%20data/#items-data","title":"<code>Items</code> data","text":"<p>The asset contains one line per Item whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 0 Name SetText string The name of the item 1 Unused description SetText string An unused version of the item's description 2 Description SetText string The description of the item 3 Prepender SetText string The prepender string used with the Anstring command for this item <p>The data will be loaded into <code>itemdata[0, id, x]</code> where <code>id</code> is the item id and <code>x</code> is the loaded index.</p> <p>The unused description is, as its name says, not used in the game. It is safe to leave it empty or a dummy value, but its value must exist for the actual description which needs a valid value.</p> <p>The prepender is optional: it will not be loaded if it does not exist. which leaves its spot in <code>itemdata</code> as null.</p>"},{"location":"TextAsset%20Data/Lore%20Books%20data/","title":"Lore Books data","text":"<p>The game contains a TextAsset named <code>LoreText</code> in the corresponding dialogue folder of the current languageid and it contains information about the Lore Books. The data is loaded each time by the Lore Book List Type and the Lore command's processing.</p> <p>The asset contains the list of Lore Books, one per line, in the order they are unlocked as the player turns in Lore Books to Brooke. Each lines contains fields separated by <code>@</code>:</p> Name Type Description Title SetText string The title of the book shown in the Lore Book List Type Content SetText string The content of the book's text. <p>The content of the book is expected to be rendered using a Lore command which happens through the handling of the Lore Book List Type.</p>"},{"location":"TextAsset%20Data/Medals%20data/","title":"Medals","text":"<p>Medal data are split in 3 TextAssets in the game loaded on boot by SetVariables: </p> <ul> <li><code>Ressources/data/BadgeData</code></li> <li><code>Ressources/data/BadgeOrder</code></li> <li><code>BadgeName</code> from the corresponding dialogue directory of the current languageid</li> </ul>"},{"location":"TextAsset%20Data/Medals%20data/#badgedata-data","title":"<code>BadgeData</code> data","text":"<p>The asset contains one line per Medal whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 2 MP cost int The cost of the medal in MP to equip 3 Party equipable bool Tells if this medal can be equipped to the whole party or not. 4 Medal effects <code>;</code> separated list of string[] separated by <code>,</code> The list of effects this medal has (see below for details) 5 Value int The buying price of the medal in berries 7 Crystal Berries value int The buying price of the medal in Crystal Berries <p>The data will be loaded into <code>badgedata[id, x]</code>, where <code>id</code> is the Medal id and <code>x</code> is the loaded index.</p>"},{"location":"TextAsset%20Data/Medals%20data/#medal-effects","title":"Medal effects","text":"<p>A medal effect is defined by 2 fields separated by <code>,</code>:</p> Name Type Description effect BadgeEffects The effect the medal has value int A value that influences the BadgeEffects (usually an amount) <p>The BadgeEffects must be specified as a string or int representation of an BadgeEffects enum value. </p> <p>These effects doesn't necessarily tell everything the medal can do. These are a category of effects that can be applied statically without the need for checking if the medal is equipped at a particular moment. The method that applies all of the equipped ones at once is called ApplyBadges.</p> <p>Here are the valid values, anything else is considered invalid (the apply to column specify if the effect is compatible with member equip or party equip or both):</p> Value Name Apply to Value Meaning Description 0 None N/A None No effects 1 HPUP Member only The amount to add to the <code>hp</code> Add the value to the <code>playerdata</code>'s <code>hp</code> 2 TPUP Party only The amount to add to the instance.<code>maxtp</code> Add the value to instance.<code>maxtp</code> 3 HPRecover N/A None UNUSED 4 TPRecover N/A None UNUSED 5 AttackUp Member / Party The amount to add to the attack value(s) For a member, add the value to the <code>playerdata</code>'s <code>atk</code> and for the party, add the value to all <code>playerdata</code>'s <code>atk</code> 6 DefenseUp Member only The amount to add to the <code>def</code> Add the value to the <code>playerdata</code>'s <code>def</code> 7 LockSkills Member only None Set the <code>playerdata</code>'s <code>lockskills</code> to true 8 Detect N/A None UNUSED (The <code>Detector</code> medal has it defined, but no logic backs this effect) 9 SpeedUp Party only None Set instance.<code>speedup</code> to true (this field is never read making the whole effect practically UNUSED) 10 PoisonRes Member only The amount to add to the <code>poisonres</code> Add the value to the <code>playerdata</code>'s <code>poisonres</code> 11 SleepRes Member only The amount to add to the <code>sleepres</code> Add the value to the <code>playerdata</code>'s <code>sleepres</code> 12 NumbRes Member only The amount to add to the <code>numbres</code> Add the value to the <code>playerdata</code>'s <code>numbres</code> 13 FreezeRes Member only The amount to add to the <code>freezeres</code> Add the value to the <code>playerdata</code>'s <code>freezeres</code> 14 PoisonAttack N/A None UNUSED (the <code>PoisonAttacker</code> medal has it defined, but no logic backs this effect) 15 PoisonDefense N/A None UNUSED (the <code>PoisonDefender</code> medal has it defined, but no logic backs this effect) 16 SleepDefense N/A None UNUSED 17 NumbDefense N/A None UNUSED 18 FreezeDefense N/A None UNUSED 19 AttackMultiply Member only The multiplier to multiply the <code>atk</code> by Multiply the <code>playerdata</code>'s <code>atk</code> by the value. No medals defines this effect under normal gameplay making it practically UNUSED 20 DefenseMuliply N/A None UNUSED 21 LockItems Member only None Set the <code>playerdata</code>'s <code>lockitems</code> to true 22 LockRelay Member only None Set the <code>playerdata</code>'s <code>locktri</code> to true 23 LockRelayPass Member only None Set the <code>playerdata</code>'s <code>lockrelayreceive</code> to true"},{"location":"TextAsset%20Data/Medals%20data/#badgename-data","title":"<code>BadgeName</code> data","text":"<p>The asset contains one line per Medal whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 0 Name SetText string The name of the medal 1 Description SetText string The description of the medal 6 Prepender SetText string The prepender string used with the Anstring command for this medal <p>The data will be loaded into <code>badgedata[id, x]</code>, where <code>id</code> is the Medal id and <code>x</code> is the loaded index.</p> <p>Unlike Items data, the prepender is mandatory.</p>"},{"location":"TextAsset%20Data/Medals%20data/#badgeorder-data","title":"<code>BadgeOrder</code> data","text":"<p>The asset contains the order to render the medals in the Medals List Type where each line contains one field:</p> Name Type Description Medal id int The Medal id of the medal to render at the position of the line index <p>The data will be loaded into <code>badgeorder[i]</code> where i is the line index.</p> <p>It should be noted that this data doesn't just affect the rendering, but also the backing list containing the medals currently in possession. The whole thing is done in RefreshBadgeOrder.</p>"},{"location":"TextAsset%20Data/Miscellaneous%20global%20data/","title":"Miscellaneous global data","text":"<p>This page contains documentations about some minor languageid agnostic data the game uses.</p>"},{"location":"TextAsset%20Data/Miscellaneous%20global%20data/#language-prompt-help-lines","title":"Language prompt help lines","text":"<p><code>LanguageHelp</code> is a TextAsset in <code>Ressources/data</code> loaded on boot by LoadEssentials into the <code>languagehelp</code> array. Each lines contains the prompt text to render during the languageid selection whose line corresponds to the selected languageid. This is meant to be refreshed every time the selection changes which is handled by the Languages list Type.</p>"},{"location":"TextAsset%20Data/Miscellaneous%20global%20data/#letterprompts","title":"LetterPrompts","text":"<p>There are several TextAssets in <code>Ressources/data</code> whose name starts with <code>LetterPrompt</code> followed by the corresponding letter prompt id. Each of them corresponds to the text shown in a LetterPrompt command depending on the prompt presented. The data gets loaded in the course of the command on <code>CreateLetterPrompt</code>, but also on boot by <code>FontSet</code>. This is because due to the way TextMesh data gets cached on Unity, the game will reserve the first letter slot permanently on boot by doing a SetText call in non Dialogue mode where the text is every letter prompt data in a row, one for each fonttype all in Single Letter Rendering. This very large string forces Unity to put the text meshes data into its cache which improves performance.</p> <p>For more information on each letter prompt id, consult the details of the LetterPrompt commands. The files are named like so:</p> <ul> <li><code>LetterPrompt0</code></li> <li><code>LetterPrompt1</code></li> <li><code>LetterPrompt2</code></li> <li><code>LetterPrompt3</code></li> <li><code>LetterPrompt4</code></li> </ul>"},{"location":"TextAsset%20Data/Miscellaneous%20global%20data/#leaves-destination-positions-during-battle-transition","title":"Leaves destination positions during battle transition","text":"<p><code>LeafPos</code> is a TextAsset in <code>Ressources/data</code> loaded on boot by LoadEssentials into the <code>leafpos</code> array that tells where the leaves in the standard battle transitions will end up on the screen once they are done moving. While their starting position and final rotation are random, their destination position aren't and they are determined by this data. It is possible to add or remove leaves by changing the amount of lines as each leaf corresponds to one line.</p>"},{"location":"TextAsset%20Data/Miscellaneous%20global%20data/#unused","title":"Unused","text":"<p>There are some unused TextAsset in the game located in <code>Ressources/data</code> that are never loaded by the game, but the data is still present:</p> <ul> <li><code>boardgame/1data</code>: This is presumably a remnant of the unused PartyGame which had a SetText commands and other assets left. It is unknown how the layout of the data was layed out, but it seems this represented the data of a board whose id was 1.</li> <li><code>commands/SnakemouthEmpty</code>: This is a remnant of the unused GlobalCommand feature.</li> <li><code>BoardData</code>: Seems to be similar to <code>boardgame/1data</code>, but the placement of the asset suggests it was intended to refer to every board. The layout is unknown.</li> <li><code>CookIcons</code>: It seems to be an earlier version of Recipes data as the name and the contents suggests it was intended to contain sprite index information as well as a custom description. The final version of the game ended up determining both of them dynamically from the Item associated with the recipes.</li> <li><code>MapOrder</code>: It seems to be an early version of an ordering system similar to the other library pages, but for the areas. It only contains the numbers from 0 to 10 in order which would indicate the file became redundant. It ended up being unneeded anyway because the game never needs to present an ItemList of Areas.</li> <li><code>Letters</code>: It seems to be an earlier version of the optimization mentioned above about LetterPrompt data where the text was directly specified in its own asset.</li> <li><code>FortuneData</code>: It seems to be an earlier version of Fortune Teller data before this information ended up being hardcoded.</li> </ul>"},{"location":"TextAsset%20Data/Miscellaneous%20language%20specific%20data/","title":"Miscellaneous language specific data","text":"<p>This page contains documentations about some minor languageid specific data the game uses. Each TextAsset mentioned is present in the corresponding language's dialogue directory.</p>"},{"location":"TextAsset%20Data/Miscellaneous%20language%20specific%20data/#action-commands-instructions","title":"Action commands instructions","text":"<p><code>ActionCommands</code> is a TextAsset loaded on boot by SetVariables into the <code>commandhelptext</code> array that contains instructions to perform an action command in battle. Each line corresponds to one action command refered by its id. TODO: document what each id means exactly.</p>"},{"location":"TextAsset%20Data/Miscellaneous%20language%20specific%20data/#areas","title":"Areas","text":"<p>There are 2 TextAsset that describes each Areas: <code>AreaNames</code> and <code>AreaDesc</code>. <code>AreaNames</code> is loaded on boot by SetVariables into the <code>areanames</code> array and it contains an area name whose line index corresponds to an Area id. <code>AreaDesc</code> is loaded by PauseMenu's MapSetup into the <code>enemydata</code> array and it contains an area description whose line index corresponds to an Area id.</p>"},{"location":"TextAsset%20Data/Miscellaneous%20language%20specific%20data/#credits","title":"Credits","text":"<p><code>Credits</code> contains the text rendered in the credits which has its own rendering scheme. It is loaded on Event 204 (credits) and it gets rendered using a list of TextMesh in rich text mode. It is the only notable textual information not rendered using SetText.</p>"},{"location":"TextAsset%20Data/Miscellaneous%20language%20specific%20data/#unused","title":"Unused","text":"<p>There is one unused TextAsset called <code>BoardGame</code> which presumably was a remnant of the unused PartyGame which had its own command. It presumably acted similarly to <code>CardGame</code> where it would contain SetText lines used for the game only.</p> <p>TODO: there's a LibraryMap.asset ???</p>"},{"location":"TextAsset%20Data/Musics%20data/","title":"Musics data","text":"<p>Musics data are split in 2 TextAssets in the game:</p> <ul> <li>Loaded by LoopPoint which will only run on the first FixedUpdate after LoadEverything:<ul> <li><code>Ressources/data/LoopPoints</code></li> </ul> </li> <li>Loaded on boot by SetVariables<ul> <li><code>MusicList</code> from the corresponding dialogue directory of the current languageid</li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Musics%20data/#looppoints-data","title":"<code>LoopPoints</code> data","text":"<p>The asset contains one line per Music which contains the loop points of each music where the line index corresponds to the music. Each line contains 2 fields separated by <code>;</code>:</p> Loaded index Name Type Description 0 End boundary float The timestamp in seconds to stop playing the audio and resume at the restart boundary 1 Restart boundary float The timestamp in seconds to continue playing the audio once it reaches the end boundary <p>The data will be loaded into <code>musicloop[id, x]</code> where <code>id</code> is the Music id and <code>x</code> is the loaded index.</p>"},{"location":"TextAsset%20Data/Musics%20data/#musiclist-data","title":"<code>MusicList</code> data","text":"<p>The asset contains one line per Music whose id corresponds to the line index. Each line contains 1 field:</p> Name Type Description Name SetText string The name of the Musics as shown by Samira Songs List Type <p>The data will be loaded into <code>musicnames[i]</code> where <code>i</code> is the line index. The convention is to name any songs not intended to be shown as <code>.</code>.</p> <p>The name of the entry is used by the Samira Songs List Type for rendering.</p>"},{"location":"TextAsset%20Data/Rank%20data/","title":"Rank data","text":"<p>The game contains a TextAsset located at <code>Ressources/data/LevelData</code> from the root of the assets tree that contains data about special bonuses gained for specific ranks reached after a rank up. It is loaded each time in LevelUpMessage (which also applies the bonus on top of presenting the message) and Event 208 (Talking to Eetl in RUIGEE) to gather the bonus information if one exist. If no bonus exists for the given new rank, no extra bonus is applied on top of the standard one (chosen in battle or 1 MP under RUIGEE).</p> <p>The asset contains a list of bonuses to apply given a rank reached, one per line. Each lines contains fields:</p> Name Type Description Rank int The rank to reach for this bonus to be given Bonus type int The type of the bonus to apply First parameter int The first parameter of the bonus to apply Second parameter int The second parameter of the bonus to apply Third parameter int The third parameter of the bonus to apply <p>The available bonus types are the followings along with their parameters meaning:</p> Id Description Parameters 0 Grants a skill to a party member First: AnimID of the recipient of the skill -- -- Second: Skill id to grant -- -- Third: NOT USED 1 Grant a stat bonus to a party member First: AnimID of the recipient of the stat bonus -- -- Second: Stat to increase (0 = Attack, 1 = Defense, 2 = HP) -- -- Third: Amount to increase the stat 2 Grants a stat bonus to the whole party First: The stat to increase (0 = TP, MP otherwise) -- -- Second: Amount to increase the stat -- -- Third: NOT USED 3 Grant an inventory capacity increase First: Amount to increase the capacity -- -- Second: NOT USED -- -- Third: NOT USED"},{"location":"TextAsset%20Data/Rank%20data/#about-skills-rank-up-data","title":"About skills rank up data","text":"<p>The bonus type 0 doesn't actually grant anything. The actual rank check is done in RefreshSkills, but the data is still used to present the message informing that a skill was available. That however means there is 2 sources of truths about this: the data tells what the game needs to present the message of getting the skill while RefreshData tells if the skill is actually available with the new rank. For the skill availability to function correctly, both information should match. Failure to do so will cause the rank up message to advertise a new skill, but it wouldn't be available or vice versa.</p>"},{"location":"TextAsset%20Data/Rank%20data/#a-few-notes-about-how-the-data-is-handled","title":"A few notes about how the data is handled","text":"<p>For bonus type 0 and 1, the AnimID can only be 0 (<code>Bee</code>), 1 (<code>Beetle</code>) or 2 (<code>Moth</code>) because not doing so can lead to undefined behaviors. Specifically, the game will not be able to get the correct member's name as it is expected to be at menutext 46, 47 and 48 respectively. Any other will resolve to the wrong menutext as it will go past them.</p> <p>Additionally, the game has a provision that disallow showing the rank up upgrade message if no member with the AnimID exists in the party. The bonus will be applied regardless, but the SetText command will not be done.</p> <p>Bonus type 1 and 2 are ignored under RUIGEE.</p>"},{"location":"TextAsset%20Data/Recipes%20data/","title":"Recipes data","text":"<p>Recipes entry data are split in 3 TextAssets in the game:</p> <ul> <li>Loaded on boot by SetVariables: <ul> <li><code>Ressources/data/CookLibrary</code></li> <li><code>Ressources/data/CookOrder</code></li> </ul> </li> <li>Loaded on boot by LoadEssentials:<ul> <li><code>Ressources/data/RecipeData</code></li> </ul> </li> </ul>"},{"location":"TextAsset%20Data/Recipes%20data/#cooklibrary-data","title":"<code>CookLibrary</code> data","text":"<p>The asset contains one line per Recipes entry whose id corresponds to the line index. Each line contains fields separated by <code>@</code>, but only one is defined:</p> Name Type Description Recipe shown Items ids list separated by <code>,</code> (or -1 for incompatible ingredients) The Items that constitute the recipe to show as description and in the details page <p>The data will be loaded into <code>librarydata[2, id, 0]</code> where <code>id</code> is the Discoveries entry id. There may be empty second fields, but since only the first one is defined, it should be considered that <code>librarydata[2, id, 1]</code> won't be defined either (it will be an empty string most of the time).</p> <p>The game only supports a single recipe to be shown as the description and in the details page. It will be rendered using the corresponding Items's names. The exception is if the value is -1 which means any incompatible recipes which will use menutext 150 for the details page and menutext 59 for the description underneath the icon.</p> <p>This is not the same then the recipe in <code>RecipeData</code> which means it is possible to specify an invalid or incorrect recipes here.</p>"},{"location":"TextAsset%20Data/Recipes%20data/#cookorder-data","title":"<code>CookOrder</code> data","text":"<p>The asset contains one line per Recipes entry whose id corresponds to the line index. Each line contains one field</p> Name Type Description Result item shown Items id The resulting Items that will be shown in the library page <p>The data will be loaded into <code>libraryorder[2, id]</code>  where <code>id</code> is the Recipes entry id.</p> <p>This field is used to generate the icon which is done by using the corresponding the Items sprites childed to an instance of sprite 10 of <code>Sprites/Items/EnemyPortraits</code> (which is a blank sprite). It is also used to generate the text of the details page by using the Items's description. It's also used with the Library List Type to determine the name of the Items. </p> <p>This is not the same than the resulting Items present in <code>RecipeData</code> which means it is possible to specify the incorrect Items for the corresponding recipe used in <code>CookLibrary</code>.</p>"},{"location":"TextAsset%20Data/Recipes%20data/#recipesdata-data","title":"<code>RecipesData</code> data","text":"<p>The asset contains one line per valid recipes. It is not the same than a Recipes entry as each of them can contain multiple valid recipes. Each line contains fields separated by <code>,</code>:</p> Name Type Description First item Items id The first Items of the combination Second item Items id (-1 if not present) The second Items of the combination if it exists Result item Items id The resulting Items of the combination <p>The data will be loaded into <code>recipedata[i, x]</code> where i is the line index and x depends on the field and their value:</p> <ul> <li>First item: x is 0 if second item is &gt; -1 AND the first item is \\&lt;= than the second item. Otherwise, x is 1.</li> <li>Second item: x is 1 if second item is &gt; -1 AND the first item is \\&lt;= than the second item. Otherwise, x is 0.</li> <li>Result item: x is always 2.</li> </ul> <p>This means that the first 2 elements of the array for a given recipe are the Items ordered by their id and the third element is the result item.</p> <p>Any combination of Items not listed in this file will produce Items 8 (Mistake).</p>"},{"location":"TextAsset%20Data/Records%20data/","title":"Records data","text":"<p>Records entry data are split in 2 TextAssets in the game loaded on boot by SetVariables: </p> <ul> <li><code>Ressources/data/SynopsisOrder</code></li> <li><code>Synopsis</code> from the corresponding dialogue directory of the current languageid</li> </ul>"},{"location":"TextAsset%20Data/Records%20data/#synopsisorder-data","title":"<code>SynopsisOrder</code> data","text":"<p>The asset contains one line per Records entry which contains the ordered list of the entries shown in game where each entry is one line. Each line contains 2 fields separated by <code>,</code>:</p> Name Type Description Id Records entry id The id this line refers to Icon int Index of the sprite in <code>Sprites/Items/EnemyPortraits</code> <p>The id is loaded into <code>libraryorder[3, id]</code>  and the icon is loaded into <code>achiveicons[id]</code> where <code>id</code> is the Discoveries entry id.</p> <p>The ordering is managed by PauseMenu and the Library List Type.</p>"},{"location":"TextAsset%20Data/Records%20data/#synopsis-data","title":"<code>Synopsis</code> data","text":"<p>The asset contains one line per Records entry whose id corresponds to the line index. Each line contains 2 fields separated by <code>@</code>:</p> Loaded index Name Type Description 0 Name SetText string The name of the Records entry 1 Description SetText string The description of the Records entry <p>The data will be loaded into <code>librarydata[2, id, x]</code> where <code>id</code> is the Records entry id and <code>x</code> is the loaded index.</p> <p>The name of the entry is handled by the Library List Type while the description is only rendered underneath the icon in the PauseMenu.</p>"},{"location":"TextAsset%20Data/Skills%20data/","title":"Skills data","text":"<p>Skills data are split in 2 TextAssets in the game loaded on boot by SetVariables: </p> <ul> <li><code>Ressources/data/SkillData</code></li> <li><code>Skills</code> from the corresponding dialogue directory of the current languageid</li> </ul>"},{"location":"TextAsset%20Data/Skills%20data/#skilldata","title":"<code>SkillData</code>","text":"<p>The asset contains one line per skill whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Loaded index Name Type Description 2 Cost int The cost of the skill in TP if not negative or in HP if it is negative 3 Attack area AttackArea Tells who this skills affects on usage 4 Usable by Vi bool Tells if the skill is usable by Vi 5 Usable by Kabbu bool Tells if the skill is usable by Kabbu 6 Usable by Leif bool Tells if the skill is usable by Leif 7 Target ground only bool Tells if the skill can only target grounded enemies 8 Target front only bool Tells if the skill can only target the front enemy 9 Action command int The id of the action command 10 Target alive only bool Tells if the skill can only target alive entities 11 Exclude self target bool Tells if the skill excludes targeting its user 12 Target fainted only bool Tells if the skill can only target fainted entities <p>The data will be loaded into <code>skilldata[id, x]</code> where <code>id</code> is the skill id and <code>x</code> is the loaded index.</p> <p>The attack area must be specified as a string or int representation of an AttackArea enum value. Here are the valid values, anything else is considered invalid:</p> Value Name 0 SingleEnemy 1 AllEnemy 2 SingleAlly 3 AllParty 4 All 5 None 6 User"},{"location":"TextAsset%20Data/Skills%20data/#about-the-usable-by-fields","title":"About the usable by fields","text":"<p>These 3 fields does tell if the skill can be used and it will be enforced when trying to confirm its selection. However, they do not actually tell if the skill is available in battle because this is managed in a different way where this information is hardcoded in the return of RefreshSkills. This means that there is 2 different sources of truth: RefreshSkills enforces that the skill is available for usage given a particular member and the data field enforces that it is usable once it is available by the same member. It implies that for the skills usability to correctly function, both RefreshSkills and the usable by fields should have matching information. Failure to do so will result in a skill being unavailable, but usable or vice versa which isn't logical.</p>"},{"location":"TextAsset%20Data/Skills%20data/#skills-data_1","title":"<code>Skills</code> data","text":"<p>The asset contains one line per skill whose id corresponds to the line index. Each line contains 2 fields separated by <code>@</code>:</p> Loaded index Name Type Description 0 Name SetText string The name of the skill 1 Description SetText string The description of the skill <p>The data will be loaded into <code>skilldata[id, x]</code> where <code>id</code> is the skill id and <code>x</code> is the loaded index.</p>"},{"location":"TextAsset%20Data/Spy%20Cards%20data/","title":"Spy Cards","text":"<p>Spy Cards data are split in 4 TextAssets in the game only loaded during the course of a CardGame (everything is handled independently by CardGame, not MainManager):</p> <ul> <li>By LoadCardData:<ul> <li><code>Ressources/data/CardData</code></li> <li><code>CardText</code> from the corresponding dialogue directory of the current languageid</li> </ul> </li> <li>By CardStart:<ul> <li><code>Ressources/data/CardOrder</code></li> </ul> </li> </ul> <p>The <code>CardData</code> is also loaded during the course of Events 210 (Spy Card tournament event).</p>"},{"location":"TextAsset%20Data/Spy%20Cards%20data/#carddata-data","title":"<code>CardData</code> data","text":"<p>The asset contains one line per Spy Card whose id corresponds to the line index. Each line contains fields separated by <code>,</code>:</p> Name Type Description tp int The cost of the card in TP attack int The attack value of the card enemyid int The Enemy id this card is bound to namesizeX (unused) float The unused version of namesizeX type Type (int only) The type of the card effects <code>@</code> separated list of effects The effects of the card (see below for details) tribe <code>@</code> separated list of Tribe (int only) The list of tribes this card belongs to <p>The data will be loaded into <code>carddata[id]</code>, where <code>id</code> is the Spy Card id using the respective fields of a CardData struct except for namesizeX which is not loaded from here, it's loaded from <code>CardText</code>.</p> <p>A Type can be one of the following values:</p> Value Name 0 Attacker 1 Effect 2 Miniboss 3 Boss <p>A Tribe can be one of the following values:</p> Value Name 0 Seedling 1 Wasp 2 Fungi 3 Zombie 4 Plant 5 Bug 6 Machine 7 Thief 8 Unknown 9 Chomper 10 Leafbug 11 DeadLander 12 Mothfly 13 Spider <p>A card effect contains 3 fields separated by <code>#</code>:</p> Name Type Description Effect Effects (int only) The specific effect this has First parameter int The first parameter of the effect Second parameter int The second parameter of the effect <p>The first and second parameters's meaning depends on the effect. Here are the valid values for an Effects:</p> Value Name 0 Attack 1 Defense 2 RandomMiniboss 3 Heal 4 HealIfWin 5 Summon 6 AttackOnCoin 7 DefenseOnCoin 8 SummonOnCoin 9 NumbFront 10 NumbFrontCoin 11 MultiplyPerTribe 12 AttackPerTribe 13 MultiplyAttackPerID 14 NumbAll 15 NumbAllCoin 16 DamageOnWin 17 AttackPerID 18 AttackIfOtherCard 19 HealIfOtherCard 20 AttackIfOpponentID 21 AttackIfOpponentTribe 22 MultiplyIfOpponentID 23 MultiplyIfOpponentTribe 24 DefenseIfOpponentID 25 DefenseIfOpponentTribe 26 IgnoreDefense 27 HealIfAttackAmmount 28 AttackPerOpponentTribe 29 AttackPerOpponentID 30 DefensePerOpponentTribe 31 DefensePerOpponentID 32 AttackOrDefenseCoin 33 HealIfWinOnce 34 AttackPerTribeOnce 35 AttackPerIDOnce 36 AttackOnce 37 Heal1OnTribeQuanity 38 NumbIfTribeAmmount 39 SummonRandomFromTribe 40 NumbIfOtherCard 41 DefenseOnOtherCard 42 AttackNextTurn <p>TODO: Document the specific effects.</p>"},{"location":"TextAsset%20Data/Spy%20Cards%20data/#cardtext-data","title":"<code>CardText</code> data","text":"<p>The asset contains one line per Spy Card whose id corresponds to the line index. Each line contains fields separated by <code>@</code>:</p> Name Type Description Description SetText string The description of the card namesizeX float The horizontal scaling to apply to the SetText string of the Enemy's name <p>The data will be loaded into <code>carddata[id]</code>, where <code>id</code> is the Spy Card id using the respective fields of a CardData struct.</p> <p>It should be noted that <code>namesizeX</code> is ignored when the languageid is set to <code>Japanese</code>. Under that language, there is no scaling applied horizontally if the Enemy name is at most 3 characters. If the name is longer, then it's a Lerp from 0.45 to 1.0 where the value is 1 - the length of the name string / 10.0.</p> <p>How the <code>namesizeX</code> work is normally, the SetText call for the enemy name is sent with a size parameter of (0.5, 0.5), but the field is multiplied by the horizontal component. A value of 1.0 means 0.5 while a value of 0.5 means 0.25. It does not change the vertical component, only the horizontal one.</p>"},{"location":"TextAsset%20Data/Spy%20Cards%20data/#cardorder-data","title":"<code>CardOrder</code> data","text":"<p>The asset contains the order to render the Spy Cards in the Spy Cards List Type where each line contains one field:</p> Name Type Description Spy Card id int The Spy Card id of the card to render at the position of the line index <p>The data will be loaded into <code>order[i]</code> where i is the line index.</p>"},{"location":"TextAsset%20Data/Termacade%20Prizes%20data/","title":"Termacade Prizes data","text":"<p>The game contains a TextAsset located at <code>Ressources/data/Termacade</code> that contains data about the purchasable prizes at Termacade. It is loaded on boot in LoadEssentials.</p> <p>The asset contains a list of prizes in the order they appear in the Termacade Prizes List Type, one for each line. Each lines contains field separated by <code>,</code>:</p> Loaded index Name Type Description 0 Type int The type of the item (0 = standard items, 1 = key items, 2 = medal) 1 Item id int The Item or Medal id of the prize 2 Game Tokens cost int The cost in Game Tokens to purchase the prize 3 Availability int How available the prize is (1 = only once as long as the flags is false, always available otherwise) 4 Flags int The flag slot that determines if the prize was purchased if its availability is 1 (doesn't do anything if it isn't) <p>The data will be loaded into <code>termacadeprize[i, x]</code> where <code>i</code> is the line index and <code>x</code> the loaded index.</p> <p>This information is both used in the Termacade Prizes List Type to render each item, but also in Event 121 which is expected to be called right after the ItemList of the aforementioned list type is handled. The event essentially acts like a custom ItemList handler which uses the data to check and perform the transaction.</p>"}]}